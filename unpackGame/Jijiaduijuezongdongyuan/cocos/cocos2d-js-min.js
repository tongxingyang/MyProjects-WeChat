(function(n,t,i){function u(i){var r=t[i],f,e;if(!r){if(f=n[i],!f)return;e={};r=t[i]={exports:e};f[0](function(n){return u(f[1][n]||n)},r,e)}return r.exports}for(var r=0;r<i.length;r++)u(i[r])})({1:[function(n){"use strict";n("../core/platform/CCClass");var t=n("../core/utils/misc");cc.Action=cc.Class({name:"cc.Action",ctor:function(){this.originalTarget=null;this.target=null;this.tag=cc.Action.TAG_INVALID},clone:function(){var n=new cc.Action;return n.originalTarget=null,n.target=null,n.tag=this.tag,n},isDone:function(){return!0},startWithTarget:function(n){this.originalTarget=n;this.target=n},stop:function(){this.target=null},step:function(){cc.logID(1006)},update:function(){cc.logID(1007)},getTarget:function(){return this.target},setTarget:function(n){this.target=n},getOriginalTarget:function(){return this.originalTarget},setOriginalTarget:function(n){this.originalTarget=n},getTag:function(){return this.tag},setTag:function(n){this.tag=n},retain:function(){},release:function(){}});cc.Action.TAG_INVALID=-1;cc.FiniteTimeAction=cc.Class({name:"cc.FiniteTimeAction","extends":cc.Action,ctor:function(){this._duration=0},getDuration:function(){return this._duration*(this._timesForRepeat||1)},setDuration:function(n){this._duration=n},reverse:function(){return cc.logID(1008),null},clone:function(){return new cc.FiniteTimeAction}});cc.Speed=cc.Class({name:"cc.Speed","extends":cc.Action,ctor:function(n,t){this._speed=0;this._innerAction=null;n&&this.initWithAction(n,t)},getSpeed:function(){return this._speed},setSpeed:function(n){this._speed=n},initWithAction:function(n,t){return n?(this._innerAction=n,this._speed=t,!0):(cc.errorID(1021),!1)},clone:function(){var n=new cc.Speed;return n.initWithAction(this._innerAction.clone(),this._speed),n},startWithTarget:function(n){cc.Action.prototype.startWithTarget.call(this,n);this._innerAction.startWithTarget(n)},stop:function(){this._innerAction.stop();cc.Action.prototype.stop.call(this)},step:function(n){this._innerAction.step(n*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return new cc.Speed(this._innerAction.reverse(),this._speed)},setInnerAction:function(n){this._innerAction!==n&&(this._innerAction=n)},getInnerAction:function(){return this._innerAction}});cc.speed=function(n,t){return new cc.Speed(n,t)};cc.Follow=cc.Class({name:"cc.Follow","extends":cc.Action,ctor:function(n,t){this._followedNode=null;this._boundarySet=!1;this._boundaryFullyCovered=!1;this._halfScreenSize=null;this._fullScreenSize=null;this.leftBoundary=0;this.rightBoundary=0;this.topBoundary=0;this.bottomBoundary=0;this._worldRect=cc.rect(0,0,0,0);n&&(t?this.initWithTarget(n,t):this.initWithTarget(n))},clone:function(){var t=new cc.Follow,n=this._worldRect,i=new cc.Rect(n.x,n.y,n.width,n.height);return t.initWithTarget(this._followedNode,i),t},isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(n){this._boundarySet=n},initWithTarget:function(n,t){if(!n)return cc.errorID(1022),!1;t=t||cc.rect(0,0,0,0);this._followedNode=n;this._worldRect=t;this._boundarySet=!(0===t.width&&0===t.height);this._boundaryFullyCovered=!1;var i=cc.winSize;return this._fullScreenSize=cc.v2(i.width,i.height),this._halfScreenSize=this._fullScreenSize.mul(.5),this._boundarySet&&(this.leftBoundary=-(t.x+t.width-this._fullScreenSize.x),this.rightBoundary=-t.x,this.topBoundary=-t.y,this.bottomBoundary=-(t.y+t.height-this._fullScreenSize.y),this.rightBoundary<this.leftBoundary&&(this.rightBoundary=this.leftBoundary=(this.leftBoundary+this.rightBoundary)/2),this.topBoundary<this.bottomBoundary&&(this.topBoundary=this.bottomBoundary=(this.topBoundary+this.bottomBoundary)/2),this.topBoundary===this.bottomBoundary&&this.leftBoundary===this.rightBoundary&&(this._boundaryFullyCovered=!0)),!0},step:function(){var i=this.target.convertToWorldSpaceAR(cc.Vec2.ZERO),r=this._followedNode.convertToWorldSpaceAR(cc.Vec2.ZERO),u=i.sub(r),n=this.target.parent.convertToNodeSpaceAR(u.add(this._halfScreenSize));if(this._boundarySet){if(this._boundaryFullyCovered)return;this.target.setPosition(t.clampf(n.x,this.leftBoundary,this.rightBoundary),t.clampf(n.y,this.bottomBoundary,this.topBoundary))}else this.target.setPosition(n.x,n.y)},isDone:function(){return!this._followedNode.activeInHierarchy},stop:function(){this.target=null;cc.Action.prototype.stop.call(this)}});cc.follow=function(n,t){return new cc.Follow(n,t)}},{"../core/platform/CCClass":195,"../core/utils/misc":269}],2:[function(){"use strict";function r(n,t,i,r,u,f){var e=f*f,o=e*f,s=(1-u)/2,h=s*(2*e-o-f),c=s*(-o+e)+(2*o-3*e)+1,l=s*(o-2*e+f)+-2*o+3*e,a=s*(o-e),v=n.x*h+t.x*c+i.x*l+r.x*a,y=n.y*h+t.y*c+i.y*l+r.y*a;return cc.v2(v,y)}function n(n,t){return n[Math.min(n.length-1,Math.max(t,0))]}function i(n){for(var i=[],t=n.length-1;t>=0;t--)i.push(cc.v2(n[t].x,n[t].y));return i}function t(n){for(var i=[],t=0;t<n.length;t++)i.push(cc.v2(n[t].x,n[t].y));return i}cc.CardinalSplineTo=cc.Class({name:"cc.CardinalSplineTo","extends":cc.ActionInterval,ctor:function(n,t,i){this._points=[];this._deltaT=0;this._tension=0;this._previousPosition=null;this._accumulatedDiff=null;void 0!==i&&cc.CardinalSplineTo.prototype.initWithDuration.call(this,n,t,i)},initWithDuration:function(n,t,i){return t&&0!==t.length?!!cc.ActionInterval.prototype.initWithDuration.call(this,n)&&(this.setPoints(t),this._tension=i,!0):(cc.errorID(1024),!1)},clone:function(){var n=new cc.CardinalSplineTo;return n.initWithDuration(this._duration,t(this._points),this._tension),n},startWithTarget:function(n){cc.ActionInterval.prototype.startWithTarget.call(this,n);this._deltaT=1/(this._points.length-1);this._previousPosition=cc.v2(this.target.x,this.target.y);this._accumulatedDiff=cc.v2(0,0)},update:function(t){var i,c,u,s,f,e,h,o;t=this._computeEaseTime(t);u=this._points;1===t?(i=u.length-1,c=1):(s=this._deltaT,c=(t-s*(i=0|t/s))/s);h=r(n(u,i-1),n(u,+i),n(u,i+1),n(u,i+2),this._tension,c);cc.macro.ENABLE_STACKABLE_ACTIONS&&(f=this.target.x-this._previousPosition.x,e=this.target.y-this._previousPosition.y,0!==f||0!==e)&&(o=this._accumulatedDiff,f=o.x+f,e=o.y+e,o.x=f,o.y=e,h.x+=f,h.y+=e);this.updatePosition(h)},reverse:function(){var n=i(this._points);return cc.cardinalSplineTo(this._duration,n,this._tension)},updatePosition:function(n){this.target.setPosition(n);this._previousPosition=n},getPoints:function(){return this._points},setPoints:function(n){this._points=n}});cc.cardinalSplineTo=function(n,t,i){return new cc.CardinalSplineTo(n,t,i)};cc.CardinalSplineBy=cc.Class({name:"cc.CardinalSplineBy","extends":cc.CardinalSplineTo,ctor:function(n,t,i){this._startPosition=cc.v2(0,0);void 0!==i&&this.initWithDuration(n,t,i)},startWithTarget:function(n){cc.CardinalSplineTo.prototype.startWithTarget.call(this,n);this._startPosition.x=n.x;this._startPosition.y=n.y},reverse:function(){for(var u,n,f=this._points.slice(),t=f[0],r=1;r<f.length;++r)n=f[r],f[r]=n.sub(t),t=n;for(u=i(f),t=u[u.length-1],u.pop(),t.x=-t.x,t.y=-t.y,u.unshift(t),r=1;r<u.length;++r)(n=u[r]).x=-n.x,n.y=-n.y,n.x+=t.x,n.y+=t.y,u[r]=n,t=n;return cc.cardinalSplineBy(this._duration,u,this._tension)},updatePosition:function(n){var t=this._startPosition,i=n.x+t.x,r=n.y+t.y;this._previousPosition.x=i;this._previousPosition.y=r;this.target.setPosition(i,r)},clone:function(){var n=new cc.CardinalSplineBy;return n.initWithDuration(this._duration,t(this._points),this._tension),n}});cc.cardinalSplineBy=function(n,t,i){return new cc.CardinalSplineBy(n,t,i)};cc.CatmullRomTo=cc.Class({name:"cc.CatmullRomTo","extends":cc.CardinalSplineTo,ctor:function(n,t){t&&this.initWithDuration(n,t)},initWithDuration:function(n,t){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,n,t,.5)},clone:function(){var n=new cc.CatmullRomTo;return n.initWithDuration(this._duration,t(this._points)),n}});cc.catmullRomTo=function(n,t){return new cc.CatmullRomTo(n,t)};cc.CatmullRomBy=cc.Class({name:"cc.CatmullRomBy","extends":cc.CardinalSplineBy,ctor:function(n,t){t&&this.initWithDuration(n,t)},initWithDuration:function(n,t){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,n,t,.5)},clone:function(){var n=new cc.CatmullRomBy;return n.initWithDuration(this._duration,t(this._points)),n}});cc.catmullRomBy=function(n,t){return new cc.CatmullRomBy(n,t)}},{}],3:[function(){"use strict";function n(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375}var t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st;cc.easeIn=function(n){return{_rate:n,easing:function(n){return Math.pow(n,this._rate)},reverse:function(){return cc.easeIn(1/this._rate)}}};cc.easeOut=function(n){return{_rate:n,easing:function(n){return Math.pow(n,1/this._rate)},reverse:function(){return cc.easeOut(1/this._rate)}}};cc.easeInOut=function(n){return{_rate:n,easing:function(n){return(n*=2)<1?.5*Math.pow(n,this._rate):1-.5*Math.pow(2-n,this._rate)},reverse:function(){return cc.easeInOut(this._rate)}}};t={easing:function(n){return 0===n?0:Math.pow(2,10*(n-1))},reverse:function(){return i}};cc.easeExponentialIn=function(){return t};i={easing:function(n){return 1===n?1:1-Math.pow(2,-10*n)},reverse:function(){return t}};cc.easeExponentialOut=function(){return i};r={easing:function(n){return 1!==n&&0!==n?(n*=2)<1?.5*Math.pow(2,10*(n-1)):.5*(2-Math.pow(2,-10*(n-1))):n},reverse:function(){return r}};cc.easeExponentialInOut=function(){return r};u={easing:function(n){return 0===n||1===n?n:-1*Math.cos(n*Math.PI/2)+1},reverse:function(){return f}};cc.easeSineIn=function(){return u};f={easing:function(n){return 0===n||1===n?n:Math.sin(n*Math.PI/2)},reverse:function(){return u}};cc.easeSineOut=function(){return f};e={easing:function(n){return 0===n||1===n?n:-.5*(Math.cos(Math.PI*n)-1)},reverse:function(){return e}};cc.easeSineInOut=function(){return e};o={easing:function(n){return 0===n||1===n?n:(n-=1,-Math.pow(2,10*n)*Math.sin((n-.075)*Math.PI*2/.3))},reverse:function(){return s}};cc.easeElasticIn=function(n){return n&&.3!==n?{_period:n,easing:function(n){return 0===n||1===n?n:(n-=1,-Math.pow(2,10*n)*Math.sin((n-this._period/4)*Math.PI*2/this._period))},reverse:function(){return cc.easeElasticOut(this._period)}}:o};s={easing:function(n){return 0===n||1===n?n:Math.pow(2,-10*n)*Math.sin((n-.075)*Math.PI*2/.3)+1},reverse:function(){return o}};cc.easeElasticOut=function(n){return n&&.3!==n?{_period:n,easing:function(n){return 0===n||1===n?n:Math.pow(2,-10*n)*Math.sin((n-this._period/4)*Math.PI*2/this._period)+1},reverse:function(){return cc.easeElasticIn(this._period)}}:s};cc.easeElasticInOut=function(n){return{_period:n=n||.3,easing:function(n){var i=0,t=this._period,r;return 0===n||1===n?i=n:(n*=2,t||(t=this._period=.3*1.5),r=t/4,i=(n-=1)<0?-.5*Math.pow(2,10*n)*Math.sin((n-r)*Math.PI*2/t):Math.pow(2,-10*n)*Math.sin((n-r)*Math.PI*2/t)*.5+1),i},reverse:function(){return cc.easeElasticInOut(this._period)}}};h={easing:function(t){return 1-n(1-t)},reverse:function(){return c}};cc.easeBounceIn=function(){return h};c={easing:function(t){return n(t)},reverse:function(){return h}};cc.easeBounceOut=function(){return c};l={easing:function(t){return t<.5?.5*(1-n(1-(t*=2))):.5*n(2*t-1)+.5},reverse:function(){return l}};cc.easeBounceInOut=function(){return l};a={easing:function(n){return 0===n||1===n?n:n*n*(2.70158*n-1.70158)},reverse:function(){return v}};cc.easeBackIn=function(){return a};v={easing:function(n){return 0===n?0:(n-=1)*n*(2.70158*n+1.70158)+1},reverse:function(){return a}};cc.easeBackOut=function(){return v};y={easing:function(n){return(n*=2)<1?n*n*(3.5949095*n-2.5949095)/2:(n-=2)*n*(3.5949095*n+2.5949095)/2+1},reverse:function(){return y}};cc.easeBackInOut=function(){return y};cc.easeBezierAction=function(n,t,i,r){return{easing:function(u){return Math.pow(1-u,3)*n+3*u*Math.pow(1-u,2)*t+3*Math.pow(u,2)*(1-u)*i+Math.pow(u,3)*r},reverse:function(){return cc.easeBezierAction(r,i,t,n)}}};p={easing:function(n){return Math.pow(n,2)},reverse:function(){return p}};cc.easeQuadraticActionIn=function(){return p};w={easing:function(n){return-n*(n-2)},reverse:function(){return w}};cc.easeQuadraticActionOut=function(){return w};b={easing:function(n){return(n*=2)<1?n*n*.5:-.5*(--n*(n-2)-1)},reverse:function(){return b}};cc.easeQuadraticActionInOut=function(){return b};k={easing:function(n){return n*n*n*n},reverse:function(){return k}};cc.easeQuarticActionIn=function(){return k};d={easing:function(n){return-((n-=1)*n*n*n-1)},reverse:function(){return d}};cc.easeQuarticActionOut=function(){return d};g={easing:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)},reverse:function(){return g}};cc.easeQuarticActionInOut=function(){return g};nt={easing:function(n){return n*n*n*n*n},reverse:function(){return nt}};cc.easeQuinticActionIn=function(){return nt};tt={easing:function(n){return(n-=1)*n*n*n*n+1},reverse:function(){return tt}};cc.easeQuinticActionOut=function(){return tt};it={easing:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)},reverse:function(){return it}};cc.easeQuinticActionInOut=function(){return it};rt={easing:function(n){return-1*(Math.sqrt(1-n*n)-1)},reverse:function(){return rt}};cc.easeCircleActionIn=function(){return rt};ut={easing:function(n){return n-=1,Math.sqrt(1-n*n)},reverse:function(){return ut}};cc.easeCircleActionOut=function(){return ut};ft={easing:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):(n-=2,.5*(Math.sqrt(1-n*n)+1))},reverse:function(){return ft}};cc.easeCircleActionInOut=function(){return ft};et={easing:function(n){return n*n*n},reverse:function(){return et}};cc.easeCubicActionIn=function(){return et};ot={easing:function(n){return(n-=1)*n*n+1},reverse:function(){return ot}};cc.easeCubicActionOut=function(){return ot};st={easing:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)},reverse:function(){return st}};cc.easeCubicActionInOut=function(){return st}},{}],4:[function(){"use strict";cc.ActionInstant=cc.Class({name:"cc.ActionInstant","extends":cc.FiniteTimeAction,isDone:function(){return!0},step:function(){this.update(1)},update:function(){},reverse:function(){return this.clone()},clone:function(){return new cc.ActionInstant}});cc.Show=cc.Class({name:"cc.Show","extends":cc.ActionInstant,update:function(){for(var t=this.target.getComponentsInChildren(cc.RenderComponent),n=0;n<t.length;++n)t[n].enabled=!0},reverse:function(){return new cc.Hide},clone:function(){return new cc.Show}});cc.show=function(){return new cc.Show};cc.Hide=cc.Class({name:"cc.Hide","extends":cc.ActionInstant,update:function(){for(var t=this.target.getComponentsInChildren(cc.RenderComponent),n=0;n<t.length;++n)t[n].enabled=!1},reverse:function(){return new cc.Show},clone:function(){return new cc.Hide}});cc.hide=function(){return new cc.Hide};cc.ToggleVisibility=cc.Class({name:"cc.ToggleVisibility","extends":cc.ActionInstant,update:function(){for(var i,t=this.target.getComponentsInChildren(cc.RenderComponent),n=0;n<t.length;++n)i=t[n],i.enabled=!i.enabled},reverse:function(){return new cc.ToggleVisibility},clone:function(){return new cc.ToggleVisibility}});cc.toggleVisibility=function(){return new cc.ToggleVisibility};cc.RemoveSelf=cc.Class({name:"cc.RemoveSelf","extends":cc.ActionInstant,ctor:function(n){this._isNeedCleanUp=!0;void 0!==n&&this.init(n)},update:function(){this.target.removeFromParent(this._isNeedCleanUp)},init:function(n){return this._isNeedCleanUp=n,!0},reverse:function(){return new cc.RemoveSelf(this._isNeedCleanUp)},clone:function(){return new cc.RemoveSelf(this._isNeedCleanUp)}});cc.removeSelf=function(n){return new cc.RemoveSelf(n)};cc.DestroySelf=cc.Class({name:"cc.DestroySelf","extends":cc.ActionInstant,update:function(){this.target.destroy()},reverse:function(){return new cc.DestroySelf},clone:function(){return new cc.DestroySelf}});cc.destroySelf=function(){return new cc.DestroySelf};cc.FlipX=cc.Class({name:"cc.FlipX","extends":cc.ActionInstant,ctor:function(n){this._flippedX=!1;void 0!==n&&this.initWithFlipX(n)},initWithFlipX:function(n){return this._flippedX=n,!0},update:function(){this.target.scaleX=Math.abs(this.target.scaleX)*(this._flippedX?-1:1)},reverse:function(){return new cc.FlipX(!this._flippedX)},clone:function(){var n=new cc.FlipX;return n.initWithFlipX(this._flippedX),n}});cc.flipX=function(n){return new cc.FlipX(n)};cc.FlipY=cc.Class({name:"cc.FlipY","extends":cc.ActionInstant,ctor:function(n){this._flippedY=!1;void 0!==n&&this.initWithFlipY(n)},initWithFlipY:function(n){return this._flippedY=n,!0},update:function(){this.target.scaleY=Math.abs(this.target.scaleY)*(this._flippedY?-1:1)},reverse:function(){return new cc.FlipY(!this._flippedY)},clone:function(){var n=new cc.FlipY;return n.initWithFlipY(this._flippedY),n}});cc.flipY=function(n){return new cc.FlipY(n)};cc.Place=cc.Class({name:"cc.Place","extends":cc.ActionInstant,ctor:function(n,t){this._x=0;this._y=0;void 0!==n&&(void 0!==n.x&&(t=n.y,n=n.x),this.initWithPosition(n,t))},initWithPosition:function(n,t){return this._x=n,this._y=t,!0},update:function(){this.target.setPosition(this._x,this._y)},clone:function(){var n=new cc.Place;return n.initWithPosition(this._x,this._y),n}});cc.place=function(n,t){return new cc.Place(n,t)};cc.CallFunc=cc.Class({name:"cc.CallFunc","extends":cc.ActionInstant,ctor:function(n,t,i){this._selectorTarget=null;this._function=null;this._data=null;this.initWithFunction(n,t,i)},initWithFunction:function(n,t,i){return n&&(this._function=n),t&&(this._selectorTarget=t),void 0!==i&&(this._data=i),!0},execute:function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},update:function(){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(n){n!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=n)},clone:function(){var n=new cc.CallFunc;return n.initWithFunction(this._function,this._selectorTarget,this._data),n}});cc.callFunc=function(n,t,i){return new cc.CallFunc(n,t,i)}},{}],5:[function(){"use strict";function n(n,t,i,r,u){return Math.pow(1-u,3)*n+3*u*Math.pow(1-u,2)*t+3*Math.pow(u,2)*(1-u)*i+Math.pow(u,3)*r}cc.ActionInterval=cc.Class({name:"cc.ActionInterval","extends":cc.FiniteTimeAction,ctor:function(n){this.MAX_VALUE=2;this._elapsed=0;this._firstTick=!1;this._easeList=null;this._speed=1;this._timesForRepeat=1;this._repeatForever=!1;this._repeatMethod=!1;this._speedMethod=!1;void 0!==n&&cc.ActionInterval.prototype.initWithDuration.call(this,n)},getElapsed:function(){return this._elapsed},initWithDuration:function(n){return this._duration=0===n?cc.macro.FLT_EPSILON:n,this._elapsed=0,this._firstTick=!0,!0},isDone:function(){return this._elapsed>=this._duration},_cloneDecoration:function(n){n._repeatForever=this._repeatForever;n._speed=this._speed;n._timesForRepeat=this._timesForRepeat;n._easeList=this._easeList;n._speedMethod=this._speedMethod;n._repeatMethod=this._repeatMethod},_reverseEaseList:function(n){if(this._easeList){n._easeList=[];for(var t=0;t<this._easeList.length;t++)n._easeList.push(this._easeList[t].reverse())}},clone:function(){var n=new cc.ActionInterval(this._duration);return this._cloneDecoration(n),n},easing:function(){this._easeList?this._easeList.length=0:this._easeList=[];for(var n=0;n<arguments.length;n++)this._easeList.push(arguments[n]);return this},_computeEaseTime:function(n){var t=this._easeList,i,r;if(!t||0===t.length)return n;for(i=0,r=t.length;i<r;i++)n=t[i].easing(n);return n},step:function(n){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=n;var t=this._elapsed/(this._duration>1192092896e-16?this._duration:1192092896e-16);t=1>t?t:1;this.update(t>0?t:0);this._repeatMethod&&this._timesForRepeat>1&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},startWithTarget:function(n){cc.Action.prototype.startWithTarget.call(this,n);this._elapsed=0;this._firstTick=!0},reverse:function(){return cc.logID(1010),null},setAmplitudeRate:function(){cc.logID(1011)},getAmplitudeRate:function(){return cc.logID(1012),0},speed:function(n){return n<=0?(cc.logID(1013),this):(this._speedMethod=!0,this._speed*=n,this)},getSpeed:function(){return this._speed},setSpeed:function(n){return this._speed=n,this},repeat:function(n){return n=Math.round(n),isNaN(n)||n<1?(cc.logID(1014),this):(this._repeatMethod=!0,this._timesForRepeat*=n,this)},repeatForever:function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this}});cc.actionInterval=function(n){return new cc.ActionInterval(n)};cc.Sequence=cc.Class({name:"cc.Sequence","extends":cc.ActionInterval,ctor:function(n){var t,i,f,u,r;if(this._actions=[],this._split=null,this._last=0,this._reversed=!1,t=n instanceof Array?n:arguments,1!==t.length){if(i=t.length-1,i>=0&&null==t[i]&&cc.logID(1015),i>=0){for(u=t[0],r=1;r<i;r++)t[r]&&(f=u,u=cc.Sequence._actionOneTwo(f,t[r]));this.initWithTwoActions(u,t[i])}}else cc.errorID(1019)},initWithTwoActions:function(n,t){if(!n||!t)return cc.errorID(1025),!1;var i=n._duration,r=t._duration,u=(i*=n._repeatMethod?n._timesForRepeat:1)+(r*=t._repeatMethod?t._timesForRepeat:1);return this.initWithDuration(u),this._actions[0]=n,this._actions[1]=t,!0},clone:function(){var n=new cc.Sequence;return this._cloneDecoration(n),n.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),n},startWithTarget:function(n){cc.ActionInterval.prototype.startWithTarget.call(this,n);this._split=this._actions[0]._duration/this._duration;this._split*=this._actions[0]._repeatMethod?this._actions[0]._timesForRepeat:1;this._last=-1},stop:function(){-1!==this._last&&this._actions[this._last].stop();cc.Action.prototype.stop.call(this)},update:function(n){var i,f,r=0,u=this._split,t=this._actions,e=this._last;(n=this._computeEaseTime(n))<u?(i=0!==u?n/u:1,0===r&&1===e&&this._reversed&&(t[1].update(0),t[1].stop())):(r=1,i=1===u?1:(n-u)/(1-u),-1===e&&(t[0].startWithTarget(this.target),t[0].update(1),t[0].stop()),0===e&&(t[0].update(1),t[0].stop()));f=t[r];e===r&&f.isDone()||(e!==r&&f.startWithTarget(this.target),i*=f._timesForRepeat,f.update(i>1?i%1:i),this._last=r)},reverse:function(){var n=cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(n),this._reverseEaseList(n),n._reversed=!0,n}});cc.sequence=function(n){var t=n instanceof Array?n:arguments,i,r,u;if(1===t.length)return cc.errorID(1019),null;if(i=t.length-1,i>=0&&null==t[i]&&cc.logID(1015),r=null,i>=0)for(r=t[0],u=1;u<=i;u++)t[u]&&(r=cc.Sequence._actionOneTwo(r,t[u]));return r};cc.Sequence._actionOneTwo=function(n,t){var i=new cc.Sequence;return i.initWithTwoActions(n,t),i};cc.Repeat=cc.Class({name:"cc.Repeat","extends":cc.ActionInterval,ctor:function(n,t){this._times=0;this._total=0;this._nextDt=0;this._actionInstant=!1;this._innerAction=null;void 0!==t&&this.initWithAction(n,t)},initWithAction:function(n,t){var i=n._duration*t;return!!this.initWithDuration(i)&&(this._times=t,this._innerAction=n,n instanceof cc.ActionInstant&&(this._actionInstant=!0,this._times-=1),this._total=0,!0)},clone:function(){var n=new cc.Repeat;return this._cloneDecoration(n),n.initWithAction(this._innerAction.clone(),this._times),n},startWithTarget:function(n){this._total=0;this._nextDt=this._innerAction._duration/this._duration;cc.ActionInterval.prototype.startWithTarget.call(this,n);this._innerAction.startWithTarget(n)},stop:function(){this._innerAction.stop();cc.Action.prototype.stop.call(this)},update:function(n){n=this._computeEaseTime(n);var t=this._innerAction,u=this._duration,r=this._times,i=this._nextDt;if(n>=i){for(;n>i&&this._total<r;)t.update(1),this._total++,t.stop(),t.startWithTarget(this.target),i+=t._duration/u,this._nextDt=i>1?1:i;n>=1&&this._total<r&&(t.update(1),this._total++);this._actionInstant||(this._total===r?t.stop():t.update(n-(i-t._duration/u)))}else t.update(n*r%1)},isDone:function(){return this._total===this._times},reverse:function(){var n=new cc.Repeat(this._innerAction.reverse(),this._times);return this._cloneDecoration(n),this._reverseEaseList(n),n},setInnerAction:function(n){this._innerAction!==n&&(this._innerAction=n)},getInnerAction:function(){return this._innerAction}});cc.repeat=function(n,t){return new cc.Repeat(n,t)};cc.RepeatForever=cc.Class({name:"cc.RepeatForever","extends":cc.ActionInterval,ctor:function(n){this._innerAction=null;n&&this.initWithAction(n)},initWithAction:function(n){return n?(this._innerAction=n,!0):(cc.errorID(1026),!1)},clone:function(){var n=new cc.RepeatForever;return this._cloneDecoration(n),n.initWithAction(this._innerAction.clone()),n},startWithTarget:function(n){cc.ActionInterval.prototype.startWithTarget.call(this,n);this._innerAction.startWithTarget(n)},step:function(n){var t=this._innerAction;t.step(n);t.isDone()&&(t.startWithTarget(this.target),t.step(t.getElapsed()-t._duration))},isDone:function(){return!1},reverse:function(){var n=new cc.RepeatForever(this._innerAction.reverse());return this._cloneDecoration(n),this._reverseEaseList(n),n},setInnerAction:function(n){this._innerAction!==n&&(this._innerAction=n)},getInnerAction:function(){return this._innerAction}});cc.repeatForever=function(n){return new cc.RepeatForever(n)};cc.Spawn=cc.Class({name:"cc.Spawn","extends":cc.ActionInterval,ctor:function(n){var t,i,f,u,r;if(this._one=null,this._two=null,t=n instanceof Array?n:arguments,1!==t.length){if(i=t.length-1,i>=0&&null==t[i]&&cc.logID(1015),i>=0){for(u=t[0],r=1;r<i;r++)t[r]&&(f=u,u=cc.Spawn._actionOneTwo(f,t[r]));this.initWithTwoActions(u,t[i])}}else cc.errorID(1020)},initWithTwoActions:function(n,t){if(!n||!t)return cc.errorID(1027),!1;var u=!1,i=n._duration,r=t._duration;return this.initWithDuration(Math.max(i,r))&&(this._one=n,this._two=t,i>r?this._two=cc.Sequence._actionOneTwo(t,cc.delayTime(i-r)):i<r&&(this._one=cc.Sequence._actionOneTwo(n,cc.delayTime(r-i))),u=!0),u},clone:function(){var n=new cc.Spawn;return this._cloneDecoration(n),n.initWithTwoActions(this._one.clone(),this._two.clone()),n},startWithTarget:function(n){cc.ActionInterval.prototype.startWithTarget.call(this,n);this._one.startWithTarget(n);this._two.startWithTarget(n)},stop:function(){this._one.stop();this._two.stop();cc.Action.prototype.stop.call(this)},update:function(n){n=this._computeEaseTime(n);this._one&&this._one.update(n);this._two&&this._two.update(n)},reverse:function(){var n=cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(n),this._reverseEaseList(n),n}});cc.spawn=function(n){var t=n instanceof Array?n:arguments,r,i;if(1===t.length)return cc.errorID(1020),null;for(t.length>0&&null==t[t.length-1]&&cc.logID(1015),r=t[0],i=1;i<t.length;i++)null!=t[i]&&(r=cc.Spawn._actionOneTwo(r,t[i]));return r};cc.Spawn._actionOneTwo=function(n,t){var i=new cc.Spawn;return i.initWithTwoActions(n,t),i};cc.RotateTo=cc.Class({name:"cc.RotateTo","extends":cc.ActionInterval,statics:{_reverse:!1},ctor:function(n,t){this._startAngle=0;this._dstAngle=0;this._angle=0;void 0!==t&&this.initWithDuration(n,t)},initWithDuration:function(n,t){return!!cc.ActionInterval.prototype.initWithDuration.call(this,n)&&(this._dstAngle=t,!0)},clone:function(){var n=new cc.RotateTo;return this._cloneDecoration(n),n.initWithDuration(this._duration,this._dstAngle),n},startWithTarget:function(n){cc.ActionInterval.prototype.startWithTarget.call(this,n);var i=n.angle%360,t=cc.RotateTo._reverse?this._dstAngle-i:this._dstAngle+i;t>180&&(t-=360);t<-180&&(t+=360);this._startAngle=i;this._angle=cc.RotateTo._reverse?t:-t},reverse:function(){cc.logID(1016)},update:function(n){n=this._computeEaseTime(n);this.target&&(this.target.angle=this._startAngle+this._angle*n)}});cc.rotateTo=function(n,t){return new cc.RotateTo(n,t)};cc.RotateBy=cc.Class({name:"cc.RotateBy","extends":cc.ActionInterval,statics:{_reverse:!1},ctor:function(n,t){t*=cc.RotateBy._reverse?1:-1;this._deltaAngle=0;this._startAngle=0;void 0!==t&&this.initWithDuration(n,t)},initWithDuration:function(n,t){return!!cc.ActionInterval.prototype.initWithDuration.call(this,n)&&(this._deltaAngle=t,!0)},clone:function(){var n=new cc.RotateBy;return this._cloneDecoration(n),n.initWithDuration(this._duration,this._deltaAngle),n},startWithTarget:function(n){cc.ActionInterval.prototype.startWithTarget.call(this,n);this._startAngle=n.angle},update:function(n){n=this._computeEaseTime(n);this.target&&(this.target.angle=this._startAngle+this._deltaAngle*n)},reverse:function(){var n=new cc.RotateBy;return n.initWithDuration(this._duration,-this._deltaAngle),this._cloneDecoration(n),this._reverseEaseList(n),n}});cc.rotateBy=function(n,t){return new cc.RotateBy(n,t)};cc.MoveBy=cc.Class({name:"cc.MoveBy","extends":cc.ActionInterval,ctor:function(n,t,i){this._positionDelta=cc.v2(0,0);this._startPosition=cc.v2(0,0);this._previousPosition=cc.v2(0,0);void 0!==t&&cc.MoveBy.prototype.initWithDuration.call(this,n,t,i)},initWithDuration:function(n,t,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,n)&&(void 0!==t.x&&(i=t.y,t=t.x),this._positionDelta.x=t,this._positionDelta.y=i,!0)},clone:function(){var n=new cc.MoveBy;return this._cloneDecoration(n),n.initWithDuration(this._duration,this._positionDelta),n},startWithTarget:function(n){cc.ActionInterval.prototype.startWithTarget.call(this,n);var t=n.x,i=n.y;this._previousPosition.x=t;this._previousPosition.y=i;this._startPosition.x=t;this._startPosition.y=i},update:function(n){if(n=this._computeEaseTime(n),this.target){var i=this._positionDelta.x*n,r=this._positionDelta.y*n,t=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var f=this.target.x,e=this.target.y,u=this._previousPosition;t.x=t.x+f-u.x;t.y=t.y+e-u.y;i+=t.x;r+=t.y;u.x=i;u.y=r;this.target.setPosition(i,r)}else this.target.setPosition(t.x+i,t.y+r)}},reverse:function(){var n=new cc.MoveBy(this._duration,cc.v2(-this._positionDelta.x,-this._positionDelta.y));return this._cloneDecoration(n),this._reverseEaseList(n),n}});cc.moveBy=function(n,t,i){return new cc.MoveBy(n,t,i)};cc.MoveTo=cc.Class({name:"cc.MoveTo","extends":cc.MoveBy,ctor:function(n,t,i){this._endPosition=cc.v2(0,0);void 0!==t&&this.initWithDuration(n,t,i)},initWithDuration:function(n,t,i){return!!cc.MoveBy.prototype.initWithDuration.call(this,n,t,i)&&(void 0!==t.x&&(i=t.y,t=t.x),this._endPosition.x=t,this._endPosition.y=i,!0)},clone:function(){var n=new cc.MoveTo;return this._cloneDecoration(n),n.initWithDuration(this._duration,this._endPosition),n},startWithTarget:function(n){cc.MoveBy.prototype.startWithTarget.call(this,n);this._positionDelta.x=this._endPosition.x-n.x;this._positionDelta.y=this._endPosition.y-n.y}});cc.moveTo=function(n,t,i){return new cc.MoveTo(n,t,i)};cc.SkewTo=cc.Class({name:"cc.SkewTo","extends":cc.ActionInterval,ctor:function(n,t,i){this._skewX=0;this._skewY=0;this._startSkewX=0;this._startSkewY=0;this._endSkewX=0;this._endSkewY=0;this._deltaX=0;this._deltaY=0;void 0!==i&&cc.SkewTo.prototype.initWithDuration.call(this,n,t,i)},initWithDuration:function(n,t,i){var r=!1;return cc.ActionInterval.prototype.initWithDuration.call(this,n)&&(this._endSkewX=t,this._endSkewY=i,r=!0),r},clone:function(){var n=new cc.SkewTo;return this._cloneDecoration(n),n.initWithDuration(this._duration,this._endSkewX,this._endSkewY),n},startWithTarget:function(n){cc.ActionInterval.prototype.startWithTarget.call(this,n);this._startSkewX=n.skewX%180;this._deltaX=this._endSkewX-this._startSkewX;this._deltaX>180&&(this._deltaX-=360);this._deltaX<-180&&(this._deltaX+=360);this._startSkewY=n.skewY%360;this._deltaY=this._endSkewY-this._startSkewY;this._deltaY>180&&(this._deltaY-=360);this._deltaY<-180&&(this._deltaY+=360)},update:function(n){n=this._computeEaseTime(n);this.target.skewX=this._startSkewX+this._deltaX*n;this.target.skewY=this._startSkewY+this._deltaY*n}});cc.skewTo=function(n,t,i){return new cc.SkewTo(n,t,i)};cc.SkewBy=cc.Class({name:"cc.SkewBy","extends":cc.SkewTo,ctor:function(n,t,i){void 0!==i&&this.initWithDuration(n,t,i)},initWithDuration:function(n,t,i){var r=!1;return cc.SkewTo.prototype.initWithDuration.call(this,n,t,i)&&(this._skewX=t,this._skewY=i,r=!0),r},clone:function(){var n=new cc.SkewBy;return this._cloneDecoration(n),n.initWithDuration(this._duration,this._skewX,this._skewY),n},startWithTarget:function(n){cc.SkewTo.prototype.startWithTarget.call(this,n);this._deltaX=this._skewX;this._deltaY=this._skewY;this._endSkewX=this._startSkewX+this._deltaX;this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){var n=new cc.SkewBy(this._duration,-this._skewX,-this._skewY);return this._cloneDecoration(n),this._reverseEaseList(n),n}});cc.skewBy=function(n,t,i){return new cc.SkewBy(n,t,i)};cc.JumpBy=cc.Class({name:"cc.JumpBy","extends":cc.ActionInterval,ctor:function(n,t,i,r,u){this._startPosition=cc.v2(0,0);this._previousPosition=cc.v2(0,0);this._delta=cc.v2(0,0);this._height=0;this._jumps=0;void 0!==r&&cc.JumpBy.prototype.initWithDuration.call(this,n,t,i,r,u)},initWithDuration:function(n,t,i,r,u){return!!cc.ActionInterval.prototype.initWithDuration.call(this,n)&&(void 0===u&&(u=r,r=i,i=t.y,t=t.x),this._delta.x=t,this._delta.y=i,this._height=r,this._jumps=u,!0)},clone:function(){var n=new cc.JumpBy;return this._cloneDecoration(n),n.initWithDuration(this._duration,this._delta,this._height,this._jumps),n},startWithTarget:function(n){cc.ActionInterval.prototype.startWithTarget.call(this,n);var t=n.x,i=n.y;this._previousPosition.x=t;this._previousPosition.y=i;this._startPosition.x=t;this._startPosition.y=i},update:function(n){var f,i,r,t;if(n=this._computeEaseTime(n),this.target)if(f=n*this._jumps%1,i=4*this._height*f*(1-f),i+=this._delta.y*n,r=this._delta.x*n,t=this._startPosition,cc.macro.ENABLE_STACKABLE_ACTIONS){var e=this.target.x,o=this.target.y,u=this._previousPosition;t.x=t.x+e-u.x;t.y=t.y+o-u.y;r+=t.x;i+=t.y;u.x=r;u.y=i;this.target.setPosition(r,i)}else this.target.setPosition(t.x+r,t.y+i)},reverse:function(){var n=new cc.JumpBy(this._duration,cc.v2(-this._delta.x,-this._delta.y),this._height,this._jumps);return this._cloneDecoration(n),this._reverseEaseList(n),n}});cc.jumpBy=function(n,t,i,r,u){return new cc.JumpBy(n,t,i,r,u)};cc.JumpTo=cc.Class({name:"cc.JumpTo","extends":cc.JumpBy,ctor:function(n,t,i,r,u){this._endPosition=cc.v2(0,0);void 0!==r&&this.initWithDuration(n,t,i,r,u)},initWithDuration:function(n,t,i,r,u){return!!cc.JumpBy.prototype.initWithDuration.call(this,n,t,i,r,u)&&(void 0===u&&(i=t.y,t=t.x),this._endPosition.x=t,this._endPosition.y=i,!0)},startWithTarget:function(n){cc.JumpBy.prototype.startWithTarget.call(this,n);this._delta.x=this._endPosition.x-this._startPosition.x;this._delta.y=this._endPosition.y-this._startPosition.y},clone:function(){var n=new cc.JumpTo;return this._cloneDecoration(n),n.initWithDuration(this._duration,this._endPosition,this._height,this._jumps),n}});cc.jumpTo=function(n,t,i,r,u){return new cc.JumpTo(n,t,i,r,u)};cc.BezierBy=cc.Class({name:"cc.BezierBy","extends":cc.ActionInterval,ctor:function(n,t){this._config=[];this._startPosition=cc.v2(0,0);this._previousPosition=cc.v2(0,0);t&&cc.BezierBy.prototype.initWithDuration.call(this,n,t)},initWithDuration:function(n,t){return!!cc.ActionInterval.prototype.initWithDuration.call(this,n)&&(this._config=t,!0)},clone:function(){var t=new cc.BezierBy,i,n,r;for(this._cloneDecoration(t),i=[],n=0;n<this._config.length;n++)r=this._config[n],i.push(cc.v2(r.x,r.y));return t.initWithDuration(this._duration,i),t},startWithTarget:function(n){cc.ActionInterval.prototype.startWithTarget.call(this,n);var t=n.x,i=n.y;this._previousPosition.x=t;this._previousPosition.y=i;this._startPosition.x=t;this._startPosition.y=i},update:function(t){if(t=this._computeEaseTime(t),this.target){var r=this._config,o=r[0].x,s=r[1].x,h=r[2].x,c=r[0].y,l=r[1].y,a=r[2].y,u=n(0,o,s,h,t),f=n(0,c,l,a,t),i=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var v=this.target.x,y=this.target.y,e=this._previousPosition;i.x=i.x+v-e.x;i.y=i.y+y-e.y;u+=i.x;f+=i.y;e.x=u;e.y=f;this.target.setPosition(u,f)}else this.target.setPosition(i.x+u,i.y+f)}},reverse:function(){var n=this._config,u=n[0].x,f=n[0].y,e=n[1].x,o=n[1].y,t=n[2].x,i=n[2].y,s=[cc.v2(e-t,o-i),cc.v2(u-t,f-i),cc.v2(-t,-i)],r=new cc.BezierBy(this._duration,s);return this._cloneDecoration(r),this._reverseEaseList(r),r}});cc.bezierBy=function(n,t){return new cc.BezierBy(n,t)};cc.BezierTo=cc.Class({name:"cc.BezierTo","extends":cc.BezierBy,ctor:function(n,t){this._toConfig=[];t&&this.initWithDuration(n,t)},initWithDuration:function(n,t){return!!cc.ActionInterval.prototype.initWithDuration.call(this,n)&&(this._toConfig=t,!0)},clone:function(){var n=new cc.BezierTo;return this._cloneDecoration(n),n.initWithDuration(this._duration,this._toConfig),n},startWithTarget:function(n){cc.BezierBy.prototype.startWithTarget.call(this,n);var t=this._startPosition,i=this._toConfig,r=this._config;r[0]=i[0].sub(t);r[1]=i[1].sub(t);r[2]=i[2].sub(t)}});cc.bezierTo=function(n,t){return new cc.BezierTo(n,t)};cc.ScaleTo=cc.Class({name:"cc.ScaleTo","extends":cc.ActionInterval,ctor:function(n,t,i){this._scaleX=1;this._scaleY=1;this._startScaleX=1;this._startScaleY=1;this._endScaleX=0;this._endScaleY=0;this._deltaX=0;this._deltaY=0;void 0!==t&&cc.ScaleTo.prototype.initWithDuration.call(this,n,t,i)},initWithDuration:function(n,t,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,n)&&(this._endScaleX=t,this._endScaleY=null!=i?i:t,!0)},clone:function(){var n=new cc.ScaleTo;return this._cloneDecoration(n),n.initWithDuration(this._duration,this._endScaleX,this._endScaleY),n},startWithTarget:function(n){cc.ActionInterval.prototype.startWithTarget.call(this,n);this._startScaleX=n.scaleX;this._startScaleY=n.scaleY;this._deltaX=this._endScaleX-this._startScaleX;this._deltaY=this._endScaleY-this._startScaleY},update:function(n){n=this._computeEaseTime(n);this.target&&(this.target.scaleX=this._startScaleX+this._deltaX*n,this.target.scaleY=this._startScaleY+this._deltaY*n)}});cc.scaleTo=function(n,t,i){return new cc.ScaleTo(n,t,i)};cc.ScaleBy=cc.Class({name:"cc.ScaleBy","extends":cc.ScaleTo,startWithTarget:function(n){cc.ScaleTo.prototype.startWithTarget.call(this,n);this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX;this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){var n=new cc.ScaleBy(this._duration,1/this._endScaleX,1/this._endScaleY);return this._cloneDecoration(n),this._reverseEaseList(n),n},clone:function(){var n=new cc.ScaleBy;return this._cloneDecoration(n),n.initWithDuration(this._duration,this._endScaleX,this._endScaleY),n}});cc.scaleBy=function(n,t,i){return new cc.ScaleBy(n,t,i)};cc.Blink=cc.Class({name:"cc.Blink","extends":cc.ActionInterval,ctor:function(n,t){this._times=0;this._originalState=!1;void 0!==t&&this.initWithDuration(n,t)},initWithDuration:function(n,t){return!!cc.ActionInterval.prototype.initWithDuration.call(this,n)&&(this._times=t,!0)},clone:function(){var n=new cc.Blink;return this._cloneDecoration(n),n.initWithDuration(this._duration,this._times),n},update:function(n){if(n=this._computeEaseTime(n),this.target&&!this.isDone()){var t=1/this._times,i=n%t;this.target.opacity=i>t/2?255:0}},startWithTarget:function(n){cc.ActionInterval.prototype.startWithTarget.call(this,n);this._originalState=n.opacity},stop:function(){this.target.opacity=this._originalState;cc.ActionInterval.prototype.stop.call(this)},reverse:function(){var n=new cc.Blink(this._duration,this._times);return this._cloneDecoration(n),this._reverseEaseList(n),n}});cc.blink=function(n,t){return new cc.Blink(n,t)};cc.FadeTo=cc.Class({name:"cc.FadeTo","extends":cc.ActionInterval,ctor:function(n,t){this._toOpacity=0;this._fromOpacity=0;void 0!==t&&cc.FadeTo.prototype.initWithDuration.call(this,n,t)},initWithDuration:function(n,t){return!!cc.ActionInterval.prototype.initWithDuration.call(this,n)&&(this._toOpacity=t,!0)},clone:function(){var n=new cc.FadeTo;return this._cloneDecoration(n),n.initWithDuration(this._duration,this._toOpacity),n},update:function(n){n=this._computeEaseTime(n);var t=void 0!==this._fromOpacity?this._fromOpacity:255;this.target.opacity=t+(this._toOpacity-t)*n},startWithTarget:function(n){cc.ActionInterval.prototype.startWithTarget.call(this,n);this._fromOpacity=n.opacity}});cc.fadeTo=function(n,t){return new cc.FadeTo(n,t)};cc.FadeIn=cc.Class({name:"cc.FadeIn","extends":cc.FadeTo,ctor:function(n){null==n&&(n=0);this._reverseAction=null;this.initWithDuration(n,255)},reverse:function(){var n=new cc.FadeOut;return n.initWithDuration(this._duration,0),this._cloneDecoration(n),this._reverseEaseList(n),n},clone:function(){var n=new cc.FadeIn;return this._cloneDecoration(n),n.initWithDuration(this._duration,this._toOpacity),n},startWithTarget:function(n){this._reverseAction&&(this._toOpacity=this._reverseAction._fromOpacity);cc.FadeTo.prototype.startWithTarget.call(this,n)}});cc.fadeIn=function(n){return new cc.FadeIn(n)};cc.FadeOut=cc.Class({name:"cc.FadeOut","extends":cc.FadeTo,ctor:function(n){null==n&&(n=0);this._reverseAction=null;this.initWithDuration(n,0)},reverse:function(){var n=new cc.FadeIn;return n._reverseAction=this,n.initWithDuration(this._duration,255),this._cloneDecoration(n),this._reverseEaseList(n),n},clone:function(){var n=new cc.FadeOut;return this._cloneDecoration(n),n.initWithDuration(this._duration,this._toOpacity),n}});cc.fadeOut=function(n){return new cc.FadeOut(n)};cc.TintTo=cc.Class({name:"cc.TintTo","extends":cc.ActionInterval,ctor:function(n,t,i,r){this._to=cc.color(0,0,0);this._from=cc.color(0,0,0);t instanceof cc.Color&&(r=t.b,i=t.g,t=t.r);void 0!==r&&this.initWithDuration(n,t,i,r)},initWithDuration:function(n,t,i,r){return!!cc.ActionInterval.prototype.initWithDuration.call(this,n)&&(this._to=cc.color(t,i,r),!0)},clone:function(){var t=new cc.TintTo,n;return this._cloneDecoration(t),n=this._to,t.initWithDuration(this._duration,n.r,n.g,n.b),t},startWithTarget:function(n){cc.ActionInterval.prototype.startWithTarget.call(this,n);this._from=this.target.color},update:function(n){n=this._computeEaseTime(n);var t=this._from,i=this._to;t&&(this.target.color=cc.color(t.r+(i.r-t.r)*n,t.g+(i.g-t.g)*n,t.b+(i.b-t.b)*n))}});cc.tintTo=function(n,t,i,r){return new cc.TintTo(n,t,i,r)};cc.TintBy=cc.Class({name:"cc.TintBy","extends":cc.ActionInterval,ctor:function(n,t,i,r){this._deltaR=0;this._deltaG=0;this._deltaB=0;this._fromR=0;this._fromG=0;this._fromB=0;void 0!==r&&this.initWithDuration(n,t,i,r)},initWithDuration:function(n,t,i,r){return!!cc.ActionInterval.prototype.initWithDuration.call(this,n)&&(this._deltaR=t,this._deltaG=i,this._deltaB=r,!0)},clone:function(){var n=new cc.TintBy;return this._cloneDecoration(n),n.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB),n},startWithTarget:function(n){cc.ActionInterval.prototype.startWithTarget.call(this,n);var t=n.color;this._fromR=t.r;this._fromG=t.g;this._fromB=t.b},update:function(n){n=this._computeEaseTime(n);this.target.color=cc.color(this._fromR+this._deltaR*n,this._fromG+this._deltaG*n,this._fromB+this._deltaB*n)},reverse:function(){var n=new cc.TintBy(this._duration,-this._deltaR,-this._deltaG,-this._deltaB);return this._cloneDecoration(n),this._reverseEaseList(n),n}});cc.tintBy=function(n,t,i,r){return new cc.TintBy(n,t,i,r)};cc.DelayTime=cc.Class({name:"cc.DelayTime","extends":cc.ActionInterval,update:function(){},reverse:function(){var n=new cc.DelayTime(this._duration);return this._cloneDecoration(n),this._reverseEaseList(n),n},clone:function(){var n=new cc.DelayTime;return this._cloneDecoration(n),n.initWithDuration(this._duration),n}});cc.delayTime=function(n){return new cc.DelayTime(n)};cc.ReverseTime=cc.Class({name:"cc.ReverseTime","extends":cc.ActionInterval,ctor:function(n){this._other=null;n&&this.initWithAction(n)},initWithAction:function(n){return n?n===this._other?(cc.errorID(1029),!1):!!cc.ActionInterval.prototype.initWithDuration.call(this,n._duration)&&(this._other=n,!0):(cc.errorID(1028),!1)},clone:function(){var n=new cc.ReverseTime;return this._cloneDecoration(n),n.initWithAction(this._other.clone()),n},startWithTarget:function(n){cc.ActionInterval.prototype.startWithTarget.call(this,n);this._other.startWithTarget(n)},update:function(n){n=this._computeEaseTime(n);this._other&&this._other.update(1-n)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop();cc.Action.prototype.stop.call(this)}});cc.reverseTime=function(n){return new cc.ReverseTime(n)};cc.TargetedAction=cc.Class({name:"cc.TargetedAction","extends":cc.ActionInterval,ctor:function(n,t){this._action=null;this._forcedTarget=null;t&&this.initWithTarget(n,t)},initWithTarget:function(n,t){return!!this.initWithDuration(t._duration)&&(this._forcedTarget=n,this._action=t,!0)},clone:function(){var n=new cc.TargetedAction;return this._cloneDecoration(n),n.initWithTarget(this._forcedTarget,this._action.clone()),n},startWithTarget:function(n){cc.ActionInterval.prototype.startWithTarget.call(this,n);this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(n){n=this._computeEaseTime(n);this._action.update(n)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(n){this._forcedTarget!==n&&(this._forcedTarget=n)}});cc.targetedAction=function(n,t){return new cc.TargetedAction(n,t)}},{}],6:[function(n){"use strict";n("../core/platform/CCClass");var t=n("../core/platform/js"),i=function(){this.actions=[];this.target=null;this.actionIndex=0;this.currentAction=null;this.paused=!1;this.lock=!1};cc.ActionManager=function(){this._hashTargets=t.createMap(!0);this._arrayTargets=[];this._currentTarget=null;cc.director._scheduler&&cc.director._scheduler.enableForTarget(this)};cc.ActionManager.prototype={constructor:cc.ActionManager,_elementPool:[],_searchElementByTarget:function(n,t){for(var i=0;i<n.length;i++)if(t===n[i].target)return n[i];return null},_getElement:function(n,t){var r=this._elementPool.pop();return r||(r=new i),r.target=n,r.paused=!!t,r},_putElement:function(n){n.actions.length=0;n.actionIndex=0;n.currentAction=null;n.paused=!1;n.target=null;n.lock=!1;this._elementPool.push(n)},addAction:function(n,t,i){if(n&&t){var r=this._hashTargets[t._id];r?r.actions||(r.actions=[]):(r=this._getElement(t,i),this._hashTargets[t._id]=r,this._arrayTargets.push(r));r.actions.push(n);n.startWithTarget(t)}else cc.errorID(1e3)},removeAllActions:function(){for(var r,i=this._arrayTargets,n=0;n<i.length;n++)r=i[n],r&&this._putElement(r);this._arrayTargets.length=0;this._hashTargets=t.createMap(!0)},removeAllActionsFromTarget:function(n){if(null!=n){var t=this._hashTargets[n._id];t&&(t.actions.length=0,this._deleteHashElement(t))}},removeAction:function(n){var r,t,i;if(n&&(r=n.getOriginalTarget(),t=this._hashTargets[r._id],t))for(i=0;i<t.actions.length;i++)if(t.actions[i]===n){t.actions.splice(i,1);t.actionIndex>=i&&t.actionIndex--;break}},_removeActionByTag:function(n,t,i){for(var u,r=0,f=t.actions.length;r<f;++r)if(u=t.actions[r],u&&u.getTag()===n){if(i&&u.getOriginalTarget()!==i)continue;this._removeActionAtIndex(r,t);break}},removeActionByTag:function(n,t){var i,r,u,f;if(n===cc.Action.TAG_INVALID&&cc.logID(1002),i=this._hashTargets,t)r=i[t._id],r&&this._removeActionByTag(n,r,t);else for(u in i)f=i[u],this._removeActionByTag(n,f)},getActionByTag:function(n,t){var i,r,u;if(n===cc.Action.TAG_INVALID&&cc.logID(1004),i=this._hashTargets[t._id],i){if(null!=i.actions)for(r=0;r<i.actions.length;++r)if(u=i.actions[r],u&&u.getTag()===n)return u;cc.logID(1005,n)}return null},getNumberOfRunningActionsInTarget:function(n){var t=this._hashTargets[n._id];return t&&t.actions?t.actions.length:0},pauseTarget:function(n){var t=this._hashTargets[n._id];t&&(t.paused=!0)},resumeTarget:function(n){var t=this._hashTargets[n._id];t&&(t.paused=!1)},pauseAllRunningActions:function(){for(var n,i=[],r=this._arrayTargets,t=0;t<r.length;t++)n=r[t],n&&!n.paused&&(n.paused=!0,i.push(n.target));return i},resumeTargets:function(n){if(n)for(var t=0;t<n.length;t++)n[t]&&this.resumeTarget(n[t])},pauseTargets:function(n){if(n)for(var t=0;t<n.length;t++)n[t]&&this.pauseTarget(n[t])},purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdate(this)},_removeActionAtIndex:function(n,t){t.actions[n];t.actions.splice(n,1);t.actionIndex>=n&&t.actionIndex--;0===t.actions.length&&this._deleteHashElement(t)},_deleteHashElement:function(n){var r=!1;if(n&&!n.lock&&this._hashTargets[n.target._id]){delete this._hashTargets[n.target._id];for(var i=this._arrayTargets,t=0,u=i.length;t<u;t++)if(i[t]===n){i.splice(t,1);break}this._putElement(n);r=!0}return r},update:function(n){for(var t,u,r=this._arrayTargets,i=0;i<r.length;i++){if(this._currentTarget=r[i],!(t=this._currentTarget).paused&&t.actions){for(t.lock=!0,t.actionIndex=0;t.actionIndex<t.actions.length;t.actionIndex++)(t.currentAction=t.actions[t.actionIndex],t.currentAction)&&((t.currentAction.step(n*(t.currentAction._speedMethod?t.currentAction._speed:1)),t.currentAction&&t.currentAction.isDone())&&(t.currentAction.stop(),u=t.currentAction,t.currentAction=null,this.removeAction(u)),t.currentAction=null);t.lock=!1}0===t.actions.length&&this._deleteHashElement(t)&&i--}}}},{"../core/platform/CCClass":195,"../core/platform/js":216}],7:[function(n){"use strict";n("./CCActionManager");n("./CCAction");n("./CCActionInterval");n("./CCActionInstant");n("./CCActionEase");n("./CCActionCatmullRom");n("./tween")},{"./CCAction":1,"./CCActionCatmullRom":2,"./CCActionEase":3,"./CCActionInstant":4,"./CCActionInterval":5,"./CCActionManager":6,"./tween":8}],8:[function(n){"use strict";function t(n){this._actions=[];this._finalAction=null;this._target=n;this._tag=cc.Action.TAG_INVALID}function h(n){return function(){var f,r,u;for(i.length=0,f=arguments.length,r=0;r<f;r++)u=i[r]=arguments[r],u instanceof t&&(i[r]=u._union());return n.apply(this,i)}}var u=n("../animation/bezier"),v=0,e=cc.Class({name:"cc.TweenAction","extends":cc.ActionInterval,ctor:function(n,t,i){var e,s,f,u;(this._opts=i=i||Object.create(null),this._props=Object.create(null),i.progress=i.progress||this.progress,i.easing&&"string"==typeof i.easing)&&(e=i.easing,i.easing=cc.easing[e],i.easing||cc.warnID(1031,e));s=this._opts.relative;for(f in t){var r=t[f],o=void 0,h=void 0;(void 0!==r.value&&(r.easing||r.progress)&&("string"==typeof r.easing?!(o=cc.easing[r.easing])&&cc.warnID(1031,r.easing):o=r.easing,h=r.progress,r=r.value),"number"==typeof r||r.lerp&&(!s||r.add||r.mul)&&r.clone)?(u=Object.create(null),u.value=r,u.easing=o,u.progress=h,this._props[f]=u):cc.warn("Can not animate "+f+" property, because it do not have [lerp, (add|mul), clone] function.")}this._originProps=t;this.initWithDuration(n)},clone:function(){var n=new e(this._duration,this._originProps,this._opts);return this._cloneDecoration(n),n},startWithTarget:function(n){var r,u,f,i,t;cc.ActionInterval.prototype.startWithTarget.call(this,n);r=!!this._opts.relative;u=this._props;for(f in u)i=n[f],t=u[f],"number"==typeof i?(t.start=i,t.current=i,t.end=r?i+t.value:t.value):(t.start=i.clone(),t.current=i.clone(),t.end=r?(i.add||i.mul).call(i,t.value):t.value)},update:function(n){var i=this._opts,o=n,r,u,s,f,e;if(i.easing&&(o=i.easing(n)),r=this.target,r){u=this._props;s=i.progress;for(f in u){var t=u[f],h=t.easing?t.easing(n):o,c=t.current=(t.progress||s)(t.start,t.end,t.current,h);r[f]=c}e=i.onUpdate;e&&e(r,n)}},progress:function(n,t,i,r){return"number"==typeof n?i=n+(t-n)*r:n.lerp(t,r,i),i}}),s=cc.Class({name:"cc.SetAction","extends":cc.ActionInstant,ctor:function(n){this._props={};void 0!==n&&this.init(n)},init:function(n){for(var t in n)this._props[t]=n[t];return!0},update:function(){var n=this._props,i=this.target;for(var t in n)i[t]=n[t]},clone:function(){var n=new s;return n.init(this._props),n}}),i,a,f;t.stopAll=function(){cc.director.getActionManager().removeAllActions()};t.stopAllByTag=function(n){cc.director.getActionManager().removeActionByTag(n)};t.stopAllByTarget=function(n){cc.director.getActionManager().removeAllActionsFromTarget(n)};t.prototype.then=function(n){return n instanceof cc.Action?this._actions.push(n.clone()):this._actions.push(n._union()),this};t.prototype.target=function(n){return this._target=n,this};t.prototype.start=function(){var n=this._target;return n?n instanceof cc.Object&&!n.isValid?void 0:(this._finalAction&&cc.director.getActionManager().removeAction(this._finalAction),this._finalAction=this._union(),void 0===n._id&&(n._id=++v),this._finalAction.setTag(this._tag),cc.director.getActionManager().addAction(this._finalAction,n,!1),this):(cc.warn("Please set target to tween first"),this)};t.prototype.stop=function(){return this._finalAction&&cc.director.getActionManager().removeAction(this._finalAction),this};t.prototype.tag=function(n){return this._tag=n,this};t.prototype.clone=function(n){var t=this._union();return cc.tween(n).then(t.clone())};t.prototype.union=function(){var n=this._union();return this._actions.length=0,this._actions.push(n),this};t.prototype._union=function(){var n=this._actions;return 1===n.length?n[0]:cc.sequence(n)};Object.assign(t.prototype,{bezierTo:function(n,t,i,r,f){var e=t.x,o=t.y,s=i.x,h=i.y;return(f=f||Object.create(null)).progress=function(n,t,i,r){return i.x=u.bezier(n.x,e,s,t.x,r),i.y=u.bezier(n.y,o,h,t.y,r),i},this.to(n,{position:r},f)},bezierBy:function(n,t,i,r,f){var e=t.x,o=t.y,s=i.x,h=i.y;return(f=f||Object.create(null)).progress=function(n,t,i,r){var f=n.x,c=n.y;return i.x=u.bezier(f,e+f,s+f,t.x,r),i.y=u.bezier(c,o+c,h+c,t.y,r),i},this.by(n,{position:r},f)},flipX:function(){var n=this;return this.call(function(){n._target.scaleX*=-1},this)},flipY:function(){var n=this;return this.call(function(){n._target.scaleY*=-1},this)},blink:function(n,t,i){var r=1/t;return(i=i||Object.create(null)).progress=function(n,t,i,u){return u>=1?n:u%r>r/2?255:0},this.to(n,{opacity:1},i)}});i=[];for(var c={to:function(n,t,i){return(i=i||Object.create(null)).relative=!1,new e(n,t,i)},by:function(n,t,i){return(i=i||Object.create(null)).relative=!0,new e(n,t,i)},set:function(n){return new s(n)},delay:cc.delayTime,call:cc.callFunc,hide:cc.hide,show:cc.show,removeSelf:cc.removeSelf,sequence:h(cc.sequence),parallel:h(cc.spawn)},l={repeat:cc.repeat,repeatForever:function(n){return cc.repeat(n,1e9)},reverseTime:cc.reverseTime},r=Object.keys(c),y=function(n){var i=r[n];t.prototype[i]=function(){var n=c[i].apply(this,arguments);return this._actions.push(n),this}},o=0;o<r.length;o++)y(o);for(r=Object.keys(l),a=function(n){var i=r[n];t.prototype[i]=function(){var t=this._actions,n=arguments[arguments.length-1],f=arguments.length-1,u,r;for(n instanceof cc.Tween?n=n._union():n instanceof cc.Action||(n=t[t.length-1],t.length-=1,f+=1),u=[n],r=0;r<f;r++)u.push(arguments[r]);return n=l[i].apply(this,u),t.push(n),this}},f=0;f<r.length;f++)a(f);cc.tween=function(n){return new t(n)};cc.Tween=t},{"../animation/bezier":14}],9:[function(n,t){"use strict";function r(n,t){f.call(this);this.target=n;this.animation=t;this._anims=new u.array.MutableForwardIterator([])}function s(n,t){var r=t.clip,a,u,i,f,v;if(t.duration=r.duration,t.speed=r.speed,t.wrapMode=r.wrapMode,t.frameRate=r.sample,t.repeatCount=(t.wrapMode&o.Loop)===o.Loop?1/0:1,a=t.curves=r.createCurves(t,n),u=r.events,u)for(f=0,v=u.length;f<v;f++){i||((i=new h).target=n,a.push(i));var s=u[f],y=s.frame/t.duration,e=void 0,p=l(i.ratios,y);p>=0?e=i.events[p]:(e=new c,i.ratios.push(y),i.events.push(e));e.add(s.func,s.params)}}var u=cc.js,f=n("./playable"),e=n("./animation-curves"),h=e.EventAnimCurve,c=e.EventInfo,o=n("./types").WrapModeMask,l=n("../core/utils/binary-search").binarySearchEpsilon,i;u.extend(r,f);i=r.prototype;i.playState=function(n,t){n.clip&&(n.curveLoaded||s(this.target,n),n.animator=this,n.play(),"number"==typeof t&&n.setTime(t),this.play())};i.stopStatesExcept=function(n){var t=this._anims,r=t.array,i;for(t.i=0;t.i<r.length;++t.i)i=r[t.i],i!==n&&this.stopState(i)};i.addAnimation=function(n){-1===this._anims.array.indexOf(n)&&this._anims.push(n);n._setEventTarget(this.animation)};i.removeAnimation=function(n){var t=this._anims.array.indexOf(n);t>=0?(this._anims.fastRemoveAt(t),0===this._anims.array.length&&this.stop()):cc.errorID(3907);n.animator=null};i.sample=function(){var n=this._anims,t=n.array;for(n.i=0;n.i<t.length;++n.i)t[n.i].sample()};i.stopState=function(n){n&&n.stop()};i.pauseState=function(n){n&&n.pause()};i.resumeState=function(n){n&&n.resume();this.isPaused&&this.resume()};i.setStateTime=function(n,t){var r,i,u;if(void 0!==t)n&&(n.setTime(t),n.sample());else for(t=n,r=this._anims.array,i=0;i<r.length;++i)u=r[i],u.setTime(t),u.sample()};i.onStop=function(){var n=this._anims,t=n.array;for(n.i=0;n.i<t.length;++n.i)t[n.i].stop()};i.onPause=function(){for(var i,t=this._anims.array,n=0;n<t.length;++n)i=t[n],i.pause(),i.animator=null};i.onResume=function(){for(var i,t=this._anims.array,n=0;n<t.length;++n)i=t[n],i.animator=this,i.resume()};i._reloadClip=function(n){s(this.target,n)};t.exports=r},{"../core/utils/binary-search":262,"./animation-curves":11,"./playable":18,"./types":19}],10:[function(n,t){"use strict";var f=n("./types").WrapMode,r=n("./animation-curves"),i=r.DynamicAnimCurve,e=r.quickFindIndex,o=n("./motion-path-helper").sampleMotionPaths,s=n("../core/utils/binary-search").binarySearchEpsilon,u=cc.Class({name:"cc.AnimationClip","extends":cc.Asset,properties:{_duration:{"default":0,type:cc.Float},duration:{get:function(){return this._duration}},sample:{"default":60},speed:{"default":1},wrapMode:{"default":f.Normal},curveData:{"default":{},visible:!1},events:{"default":[],visible:!1}},statics:{createWithSpriteFrames:function(n,t){var i;if(!Array.isArray(n))return cc.errorID(3905),null;i=new u;i.sample=t||i.sample;i._duration=n.length/i.sample;for(var f=[],e=1/i.sample,r=0,o=n.length;r<o;r++)f[r]={frame:r*e,value:n[r]};return i.curveData={comps:{"cc.Sprite":{spriteFrame:f}}},i}},onLoad:function(){this._duration=Number.parseFloat(this.duration);this.speed=Number.parseFloat(this.speed);this.wrapMode=Number.parseInt(this.wrapMode);this.frameRate=Number.parseFloat(this.sample)},createPropCurve:function(n,t,r){var p=[],w=n instanceof cc.Node&&"position"===t,u=new i,a,b,c,k,d,f,h;for(u.target=n,u.prop=t,a=0,b=r.length;a<b;a++){if(c=r[a],k=c.frame/this.duration,u.ratios.push(k),w&&p.push(c.motionPath),d=c.value,u.values.push(d),f=c.curve,f){if("string"==typeof f){u.types.push(f);continue}if(Array.isArray(f)){f[0]===f[1]&&f[2]===f[3]?u.types.push(i.Linear):u.types.push(i.Bezier(f));continue}}u.types.push(i.Linear)}w&&o(p,u,this.duration,this.sample,n);for(var v,g,y=u.ratios,nt=!0,l=1,tt=y.length;l<tt;l++)if(v=y[l]-y[l-1],1===l)g=v;else if(Math.abs(v-g)>1e-6){nt=!1;break}return u._findFrameIndex=nt?e:s,h=u.values[0],null==h||u._lerp||("number"==typeof h?u._lerp=i.prototype._lerpNumber:h instanceof cc.Quat?u._lerp=i.prototype._lerpQuat:h instanceof cc.Vec2?u._lerp=i.prototype._lerpVector2:h instanceof cc.Vec3?u._lerp=i.prototype._lerpVector3:h.lerp&&(u._lerp=i.prototype._lerpObject)),u},createTargetCurves:function(n,t,i){var r=t.props,u=t.comps,f,c,l,e,o,s,h,a,v;if(r)for(f in r)c=r[f],l=this.createPropCurve(n,f,c),i.push(l);if(u)for(e in u)if(o=n.getComponent(e),o){s=u[e];for(h in s)a=s[h],v=this.createPropCurve(o,h,a),i.push(v)}},createCurves:function(n,t){var f=this.curveData,e=f.paths,i=[],r,u,o;for(r in this.createTargetCurves(t,f,i),e)u=cc.find(r,t),u&&(o=e[r],this.createTargetCurves(u,o,i));return i}});cc.AnimationClip=t.exports=u},{"../core/utils/binary-search":262,"./animation-curves":11,"./motion-path-helper":17,"./types":19}],11:[function(n,t){"use strict";function s(n,t){if("string"==typeof t){var i=cc.easing[t];i?n=i(n):cc.errorID(3906,t)}else Array.isArray(t)&&(n=l(t,n));return n}var l=n("./bezier").bezierByTime,r=n("../core/utils/binary-search").binarySearchEpsilon,i=n("./types").WrapModeMask,o=n("./types").WrappedInfo,u=cc.Class({name:"cc.AnimCurve",sample:function(){},onTimeChangedManually:void 0}),h,f=cc.Class({name:"cc.DynamicAnimCurve","extends":u,ctor:function(){this._cachedIndex=0},properties:{target:null,prop:"",values:[],ratios:[],types:[]},_findFrameIndex:r,_lerp:void 0,_lerpNumber:function(n,t,i){return n+(t-n)*i},_lerpObject:function(n,t,i){return n.lerp(t,i)},_lerpQuat:(h=cc.quat(),function(n,t,i){return n.lerp(t,i,h)}),_lerpVector2:function(){var n=cc.v2();return function(t,i,r){return t.lerp(i,r,n)}}(),_lerpVector3:function(){var n=cc.v3();return function(t,i,r){return t.lerp(i,r,n)}}(),sample:function(n,t){var e=this.values,r=this.ratios,o=r.length,f,h,u,a,v,i,c,w;if(0!==o){if(h=!0,u=this._cachedIndex,u<0&&(u=~u)>0&&u<r.length&&(a=r[u-1],v=r[u],t>a&&t<v&&(h=!1)),h&&(this._cachedIndex=this._findFrameIndex(r,t)),i=this._cachedIndex,i<0)if((i=~i)<=0)f=e[0];else if(i>=o)f=e[o-1];else if(c=e[i-1],this._lerp){var y=r[i-1],b=r[i],p=this.types[i-1],l=(t-y)/(b-y);p&&(l=s(l,p));w=e[i];f=this._lerp(c,w,l)}else f=c;else f=e[i];this.target[this.prop]=f}}}),e,c;f.Linear=null;f.Bezier=function(n){return n};e=function(){this.events=[]};e.prototype.add=function(n,t){this.events.push({func:n||"",params:t||[]})};c=cc.Class({name:"cc.EventAnimCurve","extends":u,properties:{target:null,ratios:[],events:[],_wrappedInfo:{"default":function(){return new o}},_lastWrappedInfo:null,_ignoreIndex:NaN},_wrapIterations:function(n){return n-(0|n)==0&&(n-=1),0|n},sample:function(n,t,u){var c=this.ratios.length,h=u.getWrappedInfo(u.time,this._wrappedInfo),s=h.direction,f=r(this.ratios,h.ratio);if(f<0&&(f=~f-1,s<0&&(f+=1)),this._ignoreIndex!==f&&(this._ignoreIndex=NaN),h.frameIndex=f,!this._lastWrappedInfo)return this._fireEvent(f),void(this._lastWrappedInfo=new o(h));var v=u.wrapMode,y=this._wrapIterations(h.iterations),a=this._lastWrappedInfo,l=this._wrapIterations(a.iterations),e=a.frameIndex,w=a.direction,p=-1!==l&&y!==l;if(e===f&&p&&1===c)this._fireEvent(0);else if(e!==f||p){s=w;do{if(e!==f){if(-1===s&&0===e&&f>0?((v&i.PingPong)===i.PingPong?s*=-1:e=c,l++):1===s&&e===c-1&&f<c-1&&((v&i.PingPong)===i.PingPong?s*=-1:e=-1,l++),e===f)break;if(l>y)break}e+=s;cc.director.getAnimationManager().pushDelayEvent(this,"_fireEvent",[e])}while(e!==f&&e>-1&&e<c)}this._lastWrappedInfo.set(h)},_fireEvent:function(n){var i,r,t,f,e;if(!(n<0||n>=this.events.length||this._ignoreIndex===n)&&(i=this.events[n].events,this.target.isValid))for(r=this.target._components,t=0;t<i.length;t++)for(var o=i[t],s=o.func,u=0;u<r.length;u++)f=r[u],e=f[s],e&&e.apply(f,o.params)},onTimeChangedManually:function(n,t){this._lastWrappedInfo=null;this._ignoreIndex=NaN;var u=t.getWrappedInfo(n,this._wrappedInfo),f=u.direction,i=r(this.ratios,u.ratio);i<0&&(i=~i-1,f<0&&(i+=1),this._ignoreIndex=i)}});t.exports={AnimCurve:u,DynamicAnimCurve:f,EventAnimCurve:c,EventInfo:e,computeRatioByType:s,quickFindIndex:function(n,t){var f=n.length-1,r,e,u,i;return 0===f?0:(r=n[0],t<r)?0:(e=n[f],t>e)?~n.length:(u=(t=(t-r)/(e-r))/(1/f),i=0|u,u-i<1e-6?i:i+1-u<1e-6?i+1:~(i+1))}}},{"../core/utils/binary-search":262,"./bezier":14,"./types":19}],12:[function(n,t){"use strict";var i=cc.js,r=cc.Class({ctor:function(){this._anims=new i.array.MutableForwardIterator([]);this._delayEvents=[];cc.director._scheduler&&cc.director._scheduler.enableForTarget(this)},update:function(n){var t=this._anims,e=t.array,r,u,f,i;for(t.i=0;t.i<e.length;++t.i)r=e[t.i],r._isPlaying&&!r._isPaused&&r.update(n);for(u=this._delayEvents,f=0;f<u.length;f++)i=u[f],i.target[i.func].apply(i.target,i.args);u.length=0},destruct:function(){},addAnimation:function(n){-1===this._anims.array.indexOf(n)&&this._anims.push(n)},removeAnimation:function(n){var t=this._anims.array.indexOf(n);t>=0?this._anims.fastRemoveAt(t):cc.errorID(3907)},pushDelayEvent:function(n,t,i){this._delayEvents.push({target:n,func:t,args:i})}});cc.AnimationManager=t.exports=r},{}],13:[function(n,t){"use strict";function o(n,t){s.call(this);this._currentFramePlayed=!1;this._delay=0;this._delayTime=0;this._wrappedInfo=new e;this._lastWrappedInfo=null;this._process=h;this._clip=n;this._name=t||n&&n.name;this.animator=null;this.curves=[];this.delay=0;this.repeatCount=1;this.duration=1;this.speed=1;this.wrapMode=c.Normal;this.time=0;this._target=null;this._lastframeEventOn=!1;this.emit=function(){for(var t=new Array(arguments.length),n=0,i=t.length;n<i;n++)t[n]=arguments[n];cc.director.getAnimationManager().pushDelayEvent(this,"_emit",t)}}function h(){var t,n=this.sample();this._lastframeEventOn&&(t=this._lastWrappedInfo?this._lastWrappedInfo:this._lastWrappedInfo=new e(n),this.repeatCount>1&&(0|n.iterations)>(0|t.iterations)&&this.emit("lastframe",this),t.set(n));n.stopped&&(this.stop(),this.emit("finished",this))}function l(){var n=this.time,t=this.duration;n>t?0==(n%=t)&&(n=t):n<0&&0!=(n%=t)&&(n+=t);for(var i=n/t,u=this.curves,r=0,f=u.length;r<f;r++)u[r].sample(n,i,this);this._lastframeEventOn&&(void 0===this._lastIterations&&(this._lastIterations=i),(this.time>0&&this._lastIterations>i||this.time<0&&this._lastIterations<i)&&this.emit("lastframe",this),this._lastIterations=i)}var u=cc.js,s=n("./playable"),f=n("./types"),e=f.WrappedInfo,c=f.WrapMode,r=f.WrapModeMask,i;u.extend(o,s);i=o.prototype;i._emit=function(n,t){this._target&&this._target.isValid&&this._target.emit(n,n,t)};i.on=function(n,t,i){return this._target&&this._target.isValid?("lastframe"===n&&(this._lastframeEventOn=!0),this._target.on(n,t,i)):null};i.once=function(n,t,i){if(this._target&&this._target.isValid){"lastframe"===n&&(this._lastframeEventOn=!0);var r=this;return this._target.once(n,function(n){t.call(i,n);r._lastframeEventOn=!1})}return null};i.off=function(n,t,i){this._target&&this._target.isValid&&("lastframe"===n&&(this._target.hasEventListener(n)||(this._lastframeEventOn=!1)),this._target.off(n,t,i))};i._setEventTarget=function(n){this._target=n};i.onPlay=function(){this.setTime(0);this._delayTime=this._delay;cc.director.getAnimationManager().addAnimation(this);this.animator&&this.animator.addAnimation(this);this.emit("play",this)};i.onStop=function(){this.isPaused||cc.director.getAnimationManager().removeAnimation(this);this.animator&&this.animator.removeAnimation(this);this.emit("stop",this)};i.onResume=function(){cc.director.getAnimationManager().addAnimation(this);this.emit("resume",this)};i.onPause=function(){cc.director.getAnimationManager().removeAnimation(this);this.emit("pause",this)};i.setTime=function(n){var i;this._currentFramePlayed=!1;this.time=n||0;for(var r=this.curves,t=0,u=r.length;t<u;t++)i=r[t],i.onTimeChangedManually&&i.onTimeChangedManually(n,this)};i.update=function(n){this._delayTime>0&&(this._delayTime-=n,this._delayTime>0)||(this._currentFramePlayed?this.time+=n*this.speed:this._currentFramePlayed=!0,this._process())};i._needRevers=function(n){var i=this.wrapMode,t=!1;return(i&r.PingPong)===r.PingPong&&(n-(0|n)==0&&n>0&&(n-=1),1&n&&(t=!t)),(i&r.Reverse)===r.Reverse&&(t=!t),t};i.getWrappedInfo=function(n,t){var o,h,s,c,l;t=t||new e;var a=!1,i=this.duration,u=this.repeatCount,f=n>0?n/i:-n/i;return f>=u&&(f=u,a=!0,o=u-(0|u),0===o&&(o=1),n=o*i*(n>0?1:-1)),n>i?(h=n%i,n=0===h?i:h):n<0&&0!=(n%=i)&&(n+=i),s=!1,c=this._wrapMode&r.ShouldWrap,c&&(s=this._needRevers(f)),l=s?-1:1,this.speed<0&&(l*=-1),c&&s&&(n=i-n),t.ratio=n/i,t.time=n,t.direction=l,t.stopped=a,t.iterations=f,t};i.sample=function(){for(var n=this.getWrappedInfo(this.time,this._wrappedInfo),i=this.curves,t=0,r=i.length;t<r;t++)i[t].sample(n.time,n.ratio,this);return n};u.get(i,"clip",function(){return this._clip});u.get(i,"name",function(){return this._name});u.obsolete(i,"AnimationState.length","duration");u.getset(i,"curveLoaded",function(){return this.curves.length>0},function(){this.curves.length=0});u.getset(i,"wrapMode",function(){return this._wrapMode},function(n){this._wrapMode=n;this.time=0;this.repeatCount=n&r.Loop?1/0:1});u.getset(i,"repeatCount",function(){return this._repeatCount},function(n){this._repeatCount=n;var t=this._wrapMode&r.ShouldWrap,i=(this.wrapMode&r.Reverse)===r.Reverse;this._process=n!==1/0||t||i?h:l});u.getset(i,"delay",function(){return this._delay},function(n){this._delayTime=this._delay=n});cc.AnimationState=t.exports=o},{"./playable":18,"./types":19}],14:[function(n,t){"use strict";function r(n){return n<0?-Math.pow(-n,1/3):Math.pow(n,1/3)}function s(n,t){var y,h,s,c,p=+t,rt=t-n[0],ut=3*p,ft=3*rt,et=3*(t-n[2]),w=1/(-p+ft-et+(t-1)),l=(ut-6*rt+et)*w,v=l*(1/3),ot=(-ut+ft)*w,st=1/3*(3*ot-l*l),b=st*(1/3),ht=(2*l*l*l-9*l*ot+p*w*27)/27,a=ht/2,k=a*a+b*b*b,it;if(k<0){var d=1/3*-st,ct=e(d*d*d),g=-ht/(2*ct),nt=o(g<-1?-1:g>1?1:g),tt=2*r(ct);return h=tt*u(nt*(1/3))-v,s=tt*u((nt+f)*(1/3))-v,c=tt*u((nt+2*f)*(1/3))-v,0<=h&&h<=1?0<=s&&s<=1?0<=c&&c<=1?i(h,s,c):i(h,s):0<=c&&c<=1?i(h,c):h:0<=s&&s<=1?0<=c&&c<=1?i(s,c):s:c}return 0===k?(s=-(y=a<0?r(-a):-r(a))-v,0<=(h=2*y-v)&&h<=1?0<=s&&s<=1?i(h,s):h:s):(it=e(k),(y=r(-a+it))-r(a+it)-v)}var u=Math.cos,o=Math.acos,i=Math.max,f=2*Math.PI,e=Math.sqrt;t.exports={bezier:function(n,t,i,r,u){var f=1-u;return f*(f*(n+(3*t-n)*u)+3*i*u*u)+r*u*u*u},bezierByTime:function(n,t){var i=s(n,t),r=n[1];return((1-i)*(r+(n[3]-r)*i)*3+i*i)*i}}},{}],15:[function(n,t){"use strict";function r(n,t){return function(i){return i<.5?t(2*i)/2:n(2*i-1)/2+.5}}var i={constant:function(){return 0},linear:function(n){return n},quadIn:function(n){return n*n},quadOut:function(n){return n*(2-n)},quadInOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)},cubicIn:function(n){return n*n*n},cubicOut:function(n){return--n*n*n+1},cubicInOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)},quartIn:function(n){return n*n*n*n},quartOut:function(n){return 1- --n*n*n*n},quartInOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)},quintIn:function(n){return n*n*n*n*n},quintOut:function(n){return--n*n*n*n*n+1},quintInOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)},sineIn:function(n){return 1-Math.cos(n*Math.PI/2)},sineOut:function(n){return Math.sin(n*Math.PI/2)},sineInOut:function(n){return.5*(1-Math.cos(Math.PI*n))},expoIn:function(n){return 0===n?0:Math.pow(1024,n-1)},expoOut:function(n){return 1===n?1:1-Math.pow(2,-10*n)},expoInOut:function(n){return 0===n?0:1===n?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(2-Math.pow(2,-10*(n-1)))},circIn:function(n){return 1-Math.sqrt(1-n*n)},circOut:function(n){return Math.sqrt(1- --n*n)},circInOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)},elasticIn:function(n){var i,t=.1;return 0===n?0:1===n?1:(!t||t<1?(t=1,i=.1):i=.4*Math.asin(1/t)/(2*Math.PI),-t*Math.pow(2,10*(n-=1))*Math.sin(2*(n-i)*Math.PI/.4))},elasticOut:function(n){var i,t=.1;return 0===n?0:1===n?1:(!t||t<1?(t=1,i=.1):i=.4*Math.asin(1/t)/(2*Math.PI),t*Math.pow(2,-10*n)*Math.sin(2*(n-i)*Math.PI/.4)+1)},elasticInOut:function(n){var i,t=.1;return 0===n?0:1===n?1:(!t||t<1?(t=1,i=.1):i=.4*Math.asin(1/t)/(2*Math.PI),(n*=2)<1?t*Math.pow(2,10*(n-=1))*Math.sin(2*(n-i)*Math.PI/.4)*-.5:t*Math.pow(2,-10*(n-=1))*Math.sin(2*(n-i)*Math.PI/.4)*.5+1)},backIn:function(n){var t=1.70158;return n*n*((t+1)*n-t)},backOut:function(n){var t=1.70158;return--n*n*((t+1)*n+t)+1},backInOut:function(n){var t=2.5949095;return(n*=2)<1?n*n*((t+1)*n-t)*.5:.5*((n-=2)*n*((t+1)*n+t)+2)},bounceIn:function(n){return 1-i.bounceOut(1-n)},bounceOut:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},bounceInOut:function(n){return n<.5?.5*i.bounceIn(2*n):.5*i.bounceOut(2*n-1)+.5},smooth:function(n){return n<=0?0:n>=1?1:n*n*(3-2*n)},fade:function(n){return n<=0?0:n>=1?1:n*n*n*(n*(6*n-15)+10)}};i.quadOutIn=r(i.quadIn,i.quadOut);i.cubicOutIn=r(i.cubicIn,i.cubicOut);i.quartOutIn=r(i.quartIn,i.quartOut);i.quintOutIn=r(i.quintIn,i.quintOut);i.sineOutIn=r(i.sineIn,i.sineOut);i.expoOutIn=r(i.expoIn,i.expoOut);i.circOutIn=r(i.circIn,i.circOut);i.backOutIn=r(i.backIn,i.backOut);i.bounceIn=function(n){return 1-i.bounceOut(1-n)};i.bounceInOut=function(n){return n<.5?.5*i.bounceIn(2*n):.5*i.bounceOut(2*n-1)+.5};i.bounceOutIn=r(i.bounceIn,i.bounceOut);cc.easing=t.exports=i},{}],16:[function(n){"use strict";n("./bezier");n("./easing");n("./types");n("./motion-path-helper");n("./animation-curves");n("./animation-clip");n("./animation-manager");n("./animation-state");n("./animation-animator")},{"./animation-animator":9,"./animation-clip":10,"./animation-curves":11,"./animation-manager":12,"./animation-state":13,"./bezier":14,"./easing":15,"./motion-path-helper":17,"./types":19}],17:[function(n,t){"use strict";function u(n){this.points=n||[];this.beziers=[];this.ratios=[];this.progresses=[];this.length=0;this.computeBeziers()}function r(){this.start=i();this.end=i();this.startCtrlPoint=i();this.endCtrlPoint=i()}function h(n){var t,r,i;if(!Array.isArray(n))return!1;for(t=0,r=n.length;t<r;t++)if(i=n[t],!Array.isArray(i)||6!==i.length)return!1;return!0}var f=n("./animation-curves").DynamicAnimCurve,e=n("./animation-curves").computeRatioByType,o=n("./bezier").bezier,s=n("../core/utils/binary-search").binarySearchEpsilon,i=cc.v2;u.prototype.computeBeziers=function(){var t,n,i,u,f;for(this.beziers.length=0,this.ratios.length=0,this.progresses.length=0,this.length=0,n=1;n<this.points.length;n++)i=this.points[n-1],u=this.points[n],(t=new r).start=i.pos,t.startCtrlPoint=i.out,t.end=u.pos,t.endCtrlPoint=u.in,this.beziers.push(t),this.length+=t.getLength();for(f=0,n=0;n<this.beziers.length;n++)t=this.beziers[n],this.ratios[n]=t.getLength()/this.length,this.progresses[n]=f+=this.ratios[n];return this.beziers};r.prototype.getPointAt=function(n){var t=this.getUtoTmapping(n);return this.getPoint(t)};r.prototype.getPoint=function(n){var t=o(this.start.x,this.startCtrlPoint.x,this.endCtrlPoint.x,this.end.x,n),r=o(this.start.y,this.startCtrlPoint.y,this.endCtrlPoint.y,this.end.y,n);return new i(t,r)};r.prototype.getLength=function(){var n=this.getLengths();return n[n.length-1]};r.prototype.getLengths=function(n){if(n||(n=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===n+1)return this.cacheArcLengths;var t,r,u=[],f=this.getPoint(0),e=i(),o=0;for(u.push(0),r=1;r<=n;r++)t=this.getPoint(r/n),e.x=f.x-t.x,e.y=f.y-t.y,o+=e.mag(),u.push(o),f=t;return this.cacheArcLengths=u,u};r.prototype.getUtoTmapping=function(n,t){var e,r=this.getLengths(),i=0,o=r.length,h,f,u,s;for(e=t||n*r[o-1],f=0,u=o-1;f<=u;)if((h=r[i=Math.floor(f+(u-f)/2)]-e)<0)f=i+1;else{if(!(h>0)){u=i;break}u=i-1}return r[i=u]===e?i/(o-1):(s=r[i],(i+(e-s)/(r[i+1]-s))/(o-1))};t.exports={sampleMotionPaths:function(n,t,r,o,c){function ct(n){return n instanceof cc.Vec2?{"in":n,pos:n,out:n}:Array.isArray(n)&&6===n.length?{"in":i(n[2],n[3]),pos:i(n[0],n[1]),out:i(n[4],n[5])}:{"in":cc.Vec2.ZERO,pos:cc.Vec2.ZERO,out:cc.Vec2.ZERO}}function ti(n,t,i){ri.push(n);ui.push(t);at.push(i)}var k=t.values=t.values.map(function(n){return Array.isArray(n)&&(n=2===n.length?cc.v2(n[0],n[1]):cc.v3(n[0],n[1],n[2])),n}),lt,nt,d,tt,a,et,gt,p,wt,ot,w,st,ht,b,ni;if(0!==n.length&&0!==k.length){for(lt=!1,nt=0;nt<n.length;nt++)if(d=n[nt],d&&!h(d)&&(cc.errorID(3904,c?c.name:"","position",nt),d=null),d&&d.length>0){lt=!0;break}if(lt&&1!==k.length){for(var ii=t.types,g=t.ratios,ri=t.values=[],ui=t.types=[],at=t.ratios=[],vt=0,yt=f.Linear,v=0,fi=n.length;v<fi-1;v++){var l,it=n[v],bt=g[v],rt=g[v+1]-bt,kt=k[v],dt=k[v+1],ut=ii[v],ft=[],y=vt/rt,pt=1/(rt*r*o);if(it&&it.length>0){for(tt=[],tt.push(ct(kt)),a=0,et=it.length;a<et;a++)gt=ct(it[a]),tt.push(gt);for(tt.push(ct(dt)),p=new u(tt),p.computeBeziers(),wt=p.progresses;1-y>1e-6;)(l=e(l=y,ut))<0?(ht=(0-l)*(w=p.beziers[0]).getLength(),st=w.start.sub(w.endCtrlPoint).normalize(),ot=w.start.add(st.mul(ht))):l>1?(ht=(l-1)*(w=p.beziers[p.beziers.length-1]).getLength(),st=w.end.sub(w.startCtrlPoint).normalize(),ot=w.end.add(st.mul(ht))):(b=s(wt,l),b<0&&(b=~b),l-=b>0?wt[b-1]:0,l/=p.ratios[b],ot=p.beziers[b].getPointAt(l)),ft.push(ot),y+=pt}else for(;1-y>1e-6;)l=e(l=y,ut),ft.push(kt.lerp(dt,l)),y+=pt;for(yt="constant"===ut?ut:f.Linear,a=0,et=ft.length;a<et;a++)ni=bt+vt+pt*a*rt,ti(ft[a],yt,ni);vt=Math.abs(y-1)>1e-6?(y-1)*rt:0}g[g.length-1]!==at[at.length-1]&&ti(k[k.length-1],yt,g[g.length-1])}}},Curve:u,Bezier:r}},{"../core/utils/binary-search":262,"./animation-curves":11,"./bezier":14}],18:[function(n,t){"use strict";function f(){this._isPlaying=!1;this._isPaused=!1;this._stepOnce=!1}var u=cc.js,e=n("../core/CCDebug"),i=f.prototype,r;u.get(i,"isPlaying",function(){return this._isPlaying},!0);u.get(i,"isPaused",function(){return this._isPaused},!0);r=function(){};i.onPlay=r;i.onPause=r;i.onResume=r;i.onStop=r;i.onError=r;i.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError(e.getError(3912)):(this._isPlaying=!0,this.onPlay())};i.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)};i.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())};i.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())};i.step=function(){this.pause();this._stepOnce=!0;this._isPlaying||this.play()};t.exports=f},{"../core/CCDebug":26}],19:[function(n,t){"use strict";function u(n){n?this.set(n):(this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0)}var i={Loop:2,ShouldWrap:4,PingPong:22,Reverse:36},r=cc.Enum({Default:0,Normal:1,Reverse:i.Reverse,Loop:i.Loop,LoopReverse:i.Loop|i.Reverse,PingPong:i.PingPong,PingPongReverse:i.PingPong|i.Reverse});cc.WrapMode=r;u.prototype.set=function(n){this.ratio=n.ratio;this.time=n.time;this.direction=n.direction;this.stopped=n.stopped;this.iterations=n.iterations;this.frameIndex=n.frameIndex};t.exports={WrapModeMask:i,WrapMode:r,WrappedInfo:u}},{}],20:[function(n,t){"use strict";var i,o,s=n("../core/event/event-target"),e=n("../core/platform/CCSys"),c=n("../core/assets/CCAudioClip").LoadMode,h=!1,u=[],r=function n(t){s.call(this);this._shouldRecycleOnEnded=!1;this._src=t;this._element=null;this.id=0;this._state=n.State.INITIALZING;var i=this;this._onended=function(){i._state=n.State.STOPPED;i.emit("ended")};this._onendedSecond=function(){i._unbindEnded(i._onendedSecond);i._bindEnded()}},f;cc.js.extend(r,s);r.State={ERROR:-1,INITIALZING:0,PLAYING:1,PAUSED:2,STOPPED:3};(i=r.prototype)._bindEnded=function(n){if(!(n=n||this._onended)._binded){n._binded=!0;var t=this._element;this._src&&t instanceof HTMLAudioElement?t.addEventListener("ended",n):t.onended=n}};i._unbindEnded=function(n){if((n=n||this._onended)._binded){n._binded=!1;var t=this._element;t instanceof HTMLAudioElement?t.removeEventListener("ended",n):t&&(t.onended=null)}};i._onLoaded=function(){this._createElement();this._state=r.State.INITIALZING;this.setVolume(1);this.setLoop(!1)};i._createElement=function(){var n=this._src._nativeAsset;n instanceof HTMLAudioElement?(this._element||(this._element=document.createElement("audio")),this._element.src=n.src):this._element=new f(n,this)};i.play=function(){var n=this;this._src&&this._src._ensureLoaded(function(){n._state=r.State.PLAYING;n._bindEnded();var t=n._element.play();window.Promise&&t instanceof Promise&&t.catch(function(){});n._touchToPlay()})};i._touchToPlay=function(){if(this._src&&this._src.loadMode===c.DOM_AUDIO&&this._element.paused&&u.push({instance:this,offset:0,audio:this._element}),!h){h=!0;var n="ontouchend"in window?"touchend":"mousedown";cc.game.canvas.addEventListener(n,function(){for(var n;n=u.pop();)n.audio.play(n.offset)})}};i.destroy=function(){this._element=null};i.pause=function(){if(this.getState()===r.State.PLAYING){var n=this;this._src&&this._src._ensureLoaded(function(){n._unbindEnded();n._element.pause();n._state=r.State.PAUSED})}};i.resume=function(){if(this.getState()===r.State.PAUSED){var n=this;this._src&&this._src._ensureLoaded(function(){n._bindEnded();n._element.play();n._state=r.State.PLAYING})}};i.stop=function(){var n=this;this._src&&this._src._ensureLoaded(function(){n._element.pause();n._element.currentTime=0;for(var t=0;t<u.length;t++)if(u[t].instance===n){u.splice(t,1);break}n._unbindEnded();n.emit("stop");n._state=r.State.STOPPED})};i.setLoop=function(n){var t=this;this._src&&this._src._ensureLoaded(function(){t._element.loop=n})};i.getLoop=function(){return!!this._element&&this._element.loop};i.setVolume=function(n){var t=this;this._src&&this._src._ensureLoaded(function(){t._element.volume=n})};i.getVolume=function(){return this._element?this._element.volume:1};i.setCurrentTime=function(n){var t=this;this._src&&this._src._ensureLoaded(function(){t._unbindEnded();t._bindEnded(t._onendedSecond);t._element.currentTime=n})};i.getCurrentTime=function(){return this._element?this._element.currentTime:0};i.getDuration=function(){return this._src?this._src.duration:0};i.getState=function(n){return void 0===n&&(n=!0),n&&this._forceUpdatingState(),this._state};i._forceUpdatingState=function(){var n=this._element;n&&(r.State.PLAYING===this._state&&n.paused?this._state=r.State.STOPPED:r.State.STOPPED!==this._state||n.paused||(this._state=r.State.PLAYING))};Object.defineProperty(i,"src",{get:function(){return this._src},set:function(n){if(this._unbindEnded(),n){if(n!==this._src)if(this._src=n,n.loaded)this._onLoaded();else{var t=this;n.once("load",function(){n===t._src&&t._onLoaded()})}}else this._src=null,this._element instanceof f?this._element=null:this._element&&(this._element.src=""),this._state=r.State.INITIALZING;return n},enumerable:!0,configurable:!0});Object.defineProperty(i,"paused",{get:function(){return!this._element||this._element.paused},enumerable:!0,configurable:!0});o=cc.sys.browserType===cc.sys.BROWSER_TYPE_EDGE||cc.sys.browserType===cc.sys.BROWSER_TYPE_BAIDU||cc.sys.browserType===cc.sys.BROWSER_TYPE_UC?.01:0;f=function(n,t){this._audio=t;this._context=e.__audioSupport.context;this._buffer=n;this._gainObj=this._context.createGain();this.volume=1;this._gainObj.connect(this._context.destination);this._loop=!1;this._startTime=-1;this._currentSource=null;this.playedLength=0;this._currentTimer=null;this._endCallback=function(){this.onended&&this.onended(this)}.bind(this)},function(n){n.play=function(n){var t,f,o,i,e,r;this._currentSource&&!this.paused&&(this._currentSource.onended=null,this._currentSource.stop(0),this.playedLength=0);t=this._context.createBufferSource();t.buffer=this._buffer;t.connect(this._gainObj);t.loop=this._loop;this._startTime=this._context.currentTime;(n=n||this.playedLength)&&(this._startTime-=n);o=this._buffer.duration;i=n;(this._loop?t.start?t.start(0,i):t.notoGrainOn?t.noteGrainOn(0,i):t.noteOn(0,i):(f=o-n,t.start?t.start(0,i,f):t.noteGrainOn?t.noteGrainOn(0,i,f):t.noteOn(0,i,f)),this._currentSource=t,t.onended=this._endCallback,t.context.state&&"suspended"!==t.context.state||0!==this._context.currentTime)||(e=this,clearTimeout(this._currentTimer),this._currentTimer=setTimeout(function(){0===e._context.currentTime&&u.push({instance:e._audio,offset:n,audio:e})},10));r=cc.sys;r.os===r.OS_IOS&&r.isBrowser&&r.isMobile&&("suspended"===t.context.state&&0!==this._context.currentTime||"interrupted"===t.context.state)&&t.context.resume()};n.pause=function(){if(clearTimeout(this._currentTimer),!this.paused){this.playedLength=this._context.currentTime-this._startTime;this.playedLength%=this._buffer.duration;var n=this._currentSource;this._currentSource=null;this._startTime=-1;n&&n.stop(0)}};Object.defineProperty(n,"paused",{get:function(){return(!this._currentSource||!this._currentSource.loop)&&(-1===this._startTime||this._context.currentTime-this._startTime>this._buffer.duration)},enumerable:!0,configurable:!0});Object.defineProperty(n,"loop",{get:function(){return this._loop},set:function(n){return this._currentSource&&(this._currentSource.loop=n),this._loop=n},enumerable:!0,configurable:!0});Object.defineProperty(n,"volume",{get:function(){return this._volume},set:function(n){if(this._volume=n,this._gainObj.gain.setTargetAtTime)try{this._gainObj.gain.setTargetAtTime(n,this._context.currentTime,o)}catch(t){t={};this._gainObj.gain.setTargetAtTime(n,this._context.currentTime,.01)}else this._gainObj.gain.value=n;e.os===e.OS_IOS&&!this.paused&&this._currentSource&&(this._currentSource.onended=null,this.pause(),this.play())},enumerable:!0,configurable:!0});Object.defineProperty(n,"currentTime",{get:function(){return this.paused?this.playedLength:(this.playedLength=this._context.currentTime-this._startTime,this.playedLength%=this._buffer.duration,this.playedLength)},set:function(n){return this.paused?this.playedLength=n:(this.pause(),this.playedLength=n,this.play()),n},enumerable:!0,configurable:!0});Object.defineProperty(n,"duration",{get:function(){return this._buffer.duration},enumerable:!0,configurable:!0})}(f.prototype);t.exports=cc._Audio=r},{"../core/assets/CCAudioClip":63,"../core/event/event-target":142,"../core/platform/CCSys":204}],21:[function(n,t){"use strict";var f=n("./CCAudio"),c=n("../core/assets/CCAudioClip"),h=cc.js,l=0,i=h.createMap(!0),e={},u=[],a=function(n){n._shouldRecycleOnEnded&&(n._finishCallback=null,n.off("ended"),n.off("stop"),n.src=null,u.includes(n)||(u.length<32?u.push(n):n.destroy()),n._shouldRecycleOnEnded=!1)},v=function(n){var h=l++,s=e[n],v,t,c;return(s||(s=e[n]=[]),o._maxAudioInstance<=s.length)&&(v=s.shift(),r(v).stop()),t=u.pop()||new f,c=function(){if(r(this.id)){delete i[this.id];var n=s.indexOf(this.id);cc.js.array.fastRemoveAt(s,n)}a(this)},t.on("ended",function(){this._finishCallback&&this._finishCallback();this.getLoop()||c.call(this)},t),t.on("stop",c,t),t.id=h,i[h]=t,s.push(h),t},r=function(n){return i[n]},s=function(n){return void 0===n?n=1:"string"==typeof n&&(n=Number.parseFloat(n)),n},o={AudioState:f.State,_maxAudioInstance:24,_id2audio:i,play:function(n,t,i){if(!(n instanceof c))return cc.error("Wrong type of AudioClip.");var u=n.nativeUrl,r=v(u);return r.src=n,n._ensureLoaded(),r._shouldRecycleOnEnded=!0,r.setLoop(t||!1),i=s(i),r.setVolume(i),r.play(),r.id},setLoop:function(n,t){var i=r(n);i&&i.setLoop&&i.setLoop(t)},isLoop:function(n){var t=r(n);return!(!t||!t.getLoop)&&t.getLoop()},setVolume:function(n,t){var i=r(n);i&&i.setVolume(t)},getVolume:function(n){var t=r(n);return t?t.getVolume():1},setCurrentTime:function(n,t){var i=r(n);return!!i&&(i.setCurrentTime(t),!0)},getCurrentTime:function(n){var t=r(n);return t?t.getCurrentTime():0},getDuration:function(n){var t=r(n);return t?t.getDuration():0},getState:function(n){var t=r(n);return t?t.getState():this.AudioState.ERROR},setFinishCallback:function(n,t){var i=r(n);i&&(i._finishCallback=t)},pause:function(n){var t=r(n);return!!t&&(t.pause(),!0)},_pauseIDCache:[],pauseAll:function(){var n,t;for(n in i)t=i[n],t.getState()===f.State.PLAYING&&(this._pauseIDCache.push(n),t.pause())},resume:function(n){var t=r(n);t&&t.resume()},resumeAll:function(){for(var i,t,n=0;n<this._pauseIDCache.length;++n)i=this._pauseIDCache[n],t=r(i),t&&t.resume();this._pauseIDCache.length=0},stop:function(n){var t=r(n);return!!t&&(t.stop(),!0)},stopAll:function(){var t,n;for(t in i)n=i[t],n&&n.stop()},setMaxAudioInstance:function(){},getMaxAudioInstance:function(){return this._maxAudioInstance},uncache:function(n){var r=n,t,u,f;if("string"==typeof n)cc.warnID(8401,"cc.audioEngine","cc.AudioClip","AudioClip","cc.AudioClip","audio"),r=n;else{if(!n)return;r=n.nativeUrl}if(t=e[r],t)for(;t.length>0;)u=t.pop(),f=i[u],f&&(f.stop(),delete i[u])},uncacheAll:function(){var n;for(var t in this.stopAll(),i)(n=i[t])&&n.destroy();for(;n=u.pop();)n.destroy();i=h.createMap(!0);e={}},_breakCache:null,_break:function(){var n,t;for(n in this._breakCache=[],i)t=i[n],t.getState()===f.State.PLAYING&&(this._breakCache.push(n),t.pause())},_restore:function(){if(this._breakCache){for(;this._breakCache.length>0;){var t=this._breakCache.pop(),n=r(t);n&&n.resume&&n.resume()}this._breakCache=null}},_music:{id:-1,loop:!1,volume:1},_effect:{volume:1,pauseCache:[]},playMusic:function(n,t){var i=this._music;return this.stop(i.id),i.id=this.play(n,t,i.volume),i.loop=t,i.id},stopMusic:function(){this.stop(this._music.id)},pauseMusic:function(){return this.pause(this._music.id),this._music.id},resumeMusic:function(){return this.resume(this._music.id),this._music.id},getMusicVolume:function(){return this._music.volume},setMusicVolume:function(n){n=s(n);var t=this._music;return t.volume=n,this.setVolume(t.id,t.volume),t.volume},isMusicPlaying:function(){return this.getState(this._music.id)===this.AudioState.PLAYING},playEffect:function(n,t){return this.play(n,t||!1,this._effect.volume)},setEffectsVolume:function(n){var u,t,r;n=s(n);u=this._music.id;for(t in this._effect.volume=n,i)r=i[t],r&&r.id!==u&&o.setVolume(t,n)},getEffectsVolume:function(){return this._effect.volume},pauseEffect:function(n){return this.pause(n)},pauseAllEffects:function(){var u=this._music.id,r=this._effect,t,n;for(t in r.pauseCache.length=0,i)n=i[t],n&&n.id!==u&&n.getState()===this.AudioState.PLAYING&&(r.pauseCache.push(t),n.pause())},resumeEffect:function(n){this.resume(n)},resumeAllEffects:function(){for(var u,r,t=this._effect.pauseCache,n=0;n<t.length;++n)u=t[n],r=i[u],r&&r.resume()},stopEffect:function(n){return this.stop(n)},stopAllEffects:function(){var r=this._music.id,t,n;for(t in i)n=i[t],n&&n.id!==r&&n.getState()===o.AudioState.PLAYING&&n.stop()}};t.exports=cc.audioEngine=o},{"../core/assets/CCAudioClip":63,"./CCAudio":20}],22:[function(n,t){"use strict";var i={name:"Jacob__Codec"};i.Base64=n("./base64");i.GZip=n("./gzip");i.unzip=function(){return i.GZip.gunzip.apply(i.GZip,arguments)};i.unzipBase64=function(){var n=i.Base64.decode.apply(i.Base64,arguments);try{return i.GZip.gunzip.call(i.GZip,n)}catch(t){return t={},n.slice(7)}};i.unzipBase64AsArray=function(n,t){t=t||1;for(var r,e=this.unzipBase64(n),u=[],i=0,f=e.length/t;i<f;i++)for(u[i]=0,r=t-1;r>=0;--r)u[i]+=e.charCodeAt(i*t+r)<<8*r;return u};i.unzipAsArray=function(n,t){t=t||1;for(var r,e=this.unzip(n),u=[],i=0,f=e.length/t;i<f;i++)for(u[i]=0,r=t-1;r>=0;--r)u[i]+=e.charCodeAt(i*t+r)<<8*r;return u};cc.codec=t.exports=i},{"./base64":23,"./gzip":24}],23:[function(n,t){"use strict";var i=n("../core/utils/misc").BASE64_VALUES,r={name:"Jacob__Codec__Base64",decode:function(n){var f,e,o,s,u,h,r=[],t=0;for(n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");t<n.length;)f=i[n.charCodeAt(t++)]<<2|(s=i[n.charCodeAt(t++)])>>4,e=(15&s)<<4|(u=i[n.charCodeAt(t++)])>>2,o=(3&u)<<6|(h=i[n.charCodeAt(t++)]),r.push(String.fromCharCode(f)),64!==u&&r.push(String.fromCharCode(e)),64!==h&&r.push(String.fromCharCode(o));return r.join("")},decodeAsArray:function(n,t){for(var r,e=this.decode(n),u=[],i=0,f=e.length/t;i<f;i++)for(u[i]=0,r=t-1;r>=0;--r)u[i]+=e.charCodeAt(i*t+r)<<8*r;return u}};t.exports=r},{"../core/utils/misc":269}],24:[function(n,t){"use strict";var i=function(n){this.data=n;this.debug=!1;this.gpflags=void 0;this.files=0;this.unzipped=[];this.buf32k=new Array(32768);this.bIdx=0;this.modeZIP=!1;this.bytepos=0;this.bb=1;this.bits=0;this.nameBuf=[];this.fileout=void 0;this.literalTree=new Array(i.LITERALS);this.distanceTree=new Array(32);this.treepos=0;this.Places=null;this.len=0;this.fpos=new Array(17);this.fpos[0]=0;this.flens=void 0;this.fmax=void 0};i.gunzip=function(n){return n.constructor===Array||(n.constructor,String),new i(n).gunzip()[0][0]};i.HufNode=function(){this.b0=0;this.b1=0;this.jump=null;this.jumppos=-1};i.LITERALS=288;i.NAMEMAX=256;i.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255];i.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];i.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99];i.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];i.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];i.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];i.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped};i.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1};i.prototype.byteAlign=function(){this.bb=1};i.prototype.readBit=function(){var n;return this.bits++,n=1&this.bb,this.bb>>=1,0===this.bb&&(this.bb=this.readByte(),n=1&this.bb,this.bb=this.bb>>1|128),n};i.prototype.readBits=function(n){for(var t=0,r=n;r--;)t=t<<1|this.readBit();return n&&(t=i.bitReverse[t]>>8-n),t};i.prototype.flushBuffer=function(){this.bIdx=0};i.prototype.addBuffer=function(n){this.buf32k[this.bIdx++]=n;this.outputArr.push(String.fromCharCode(n));32768===this.bIdx&&(this.bIdx=0)};i.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}};i.prototype.Rec=function(){var t,n=this.Places[this.treepos];if(17===this.len)return-1;if(this.treepos++,this.len++,(t=this.IsPat())>=0)n.b0=t;else if(n.b0=32768,this.Rec())return-1;if((t=this.IsPat())>=0)n.b1=t,n.jump=null;else if(n.b1=32768,n.jump=this.Places[this.treepos],n.jumppos=this.treepos,this.Rec())return-1;return this.len--,0};i.prototype.CreateTree=function(n,t,i){var r;for(this.Places=n,this.treepos=0,this.flens=i,this.fmax=t,r=0;r<17;r++)this.fpos[r]=0;return this.len=0,this.Rec()?-1:0};i.prototype.DecodeValue=function(n){for(var u,i,r=0,t=n[r];;)if(this.readBit()){if(!(32768&t.b1))return t.b1;for(t=t.jump,u=n.length,i=0;i<u;i++)if(n[i]===t){r=i;break}}else{if(!(32768&t.b0))return t.b0;t=n[++r]}return-1};i.prototype.DeflateLoop=function(){var v,c,t,s,y,e,n,h,o,l,p,r,w,a,u,f;do if(v=this.readBit(),0===(c=this.readBits(2)))for(this.byteAlign(),s=this.readByte(),s|=this.readByte()<<8,y=this.readByte(),65535&(s^~(y|=this.readByte()<<8))&&document.write("BlockLen checksum mismatch\n");s--;)e=this.readByte(),this.addBuffer(e);else if(1===c)for(;;)if((n=i.bitReverse[this.readBits(7)]>>1)>23?(n=n<<1|this.readBit())>199?n=(n-=128)<<1|this.readBit():(n-=48)>143&&(n+=136):n+=256,n<256)this.addBuffer(n);else{if(256===n)break;for(n-=257,u=this.readBits(i.cplext[n])+i.cplens[n],n=i.bitReverse[this.readBits(5)]>>3,i.cpdext[n]>8?(f=this.readBits(8),f|=this.readBits(i.cpdext[n]-8)<<8):f=this.readBits(i.cpdext[n]),f+=i.cpdist[n],n=0;n<u;n++)e=this.buf32k[this.bIdx-f&32767],this.addBuffer(e)}else if(2===c){for(r=new Array(320),o=257+this.readBits(5),l=1+this.readBits(5),p=4+this.readBits(4),n=0;n<19;n++)r[n]=0;for(n=0;n<p;n++)r[i.border[n]]=this.readBits(3);for(u=this.distanceTree.length,t=0;t<u;t++)this.distanceTree[t]=new i.HufNode;if(this.CreateTree(this.distanceTree,19,r,0))return this.flushBuffer(),1;for(h=o+l,t=0;t<h;)if((n=this.DecodeValue(this.distanceTree))<16)r[t++]=n;else if(16===n){if(t+(n=3+this.readBits(2))>h)return this.flushBuffer(),1;for(w=t?r[t-1]:0;n--;)r[t++]=w}else{if(t+(n=17===n?3+this.readBits(3):11+this.readBits(7))>h)return this.flushBuffer(),1;for(;n--;)r[t++]=0}for(u=this.literalTree.length,t=0;t<u;t++)this.literalTree[t]=new i.HufNode;if(this.CreateTree(this.literalTree,o,r,0))return this.flushBuffer(),1;for(u=this.literalTree.length,t=0;t<u;t++)this.distanceTree[t]=new i.HufNode;for(a=[],t=o;t<r.length;t++)a[t-o]=r[t];if(this.CreateTree(this.distanceTree,l,a,0))return this.flushBuffer(),1;for(;;)if((n=this.DecodeValue(this.literalTree))>=256){if(0==(n-=256))break;for(n--,u=this.readBits(i.cplext[n])+i.cplens[n],n=this.DecodeValue(this.distanceTree),i.cpdext[n]>8?(f=this.readBits(8),f|=this.readBits(i.cpdext[n]-8)<<8):f=this.readBits(i.cpdext[n]),f+=i.cpdist[n];u--;)e=this.buf32k[this.bIdx-f&32767],this.addBuffer(e)}else this.addBuffer(n)}while(!v);return this.flushBuffer(),this.byteAlign(),0};i.prototype.unzipFile=function(n){var t;for(this.gunzip(),t=0;t<this.unzipped.length;t++)if(this.unzipped[t][1]===n)return this.unzipped[t][0]};i.prototype.nextFile=function(){var n,u,f,e,r,t;if(this.outputArr=[],this.modeZIP=!1,n=[],n[0]=this.readByte(),n[1]=this.readByte(),120===n[0]&&218===n[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),31===n[0]&&139===n[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),80===n[0]&&75===n[1]&&(this.modeZIP=!0,n[2]=this.readByte(),n[3]=this.readByte(),3===n[2]&&4===n[3])){for(n[0]=this.readByte(),n[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8,u=this.readByte(),u|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),f=this.readByte(),f|=this.readByte()<<8,e=this.readByte(),e|=this.readByte()<<8,t=0,this.nameBuf=[];f--;)r=this.readByte(),"/"===r|":"===r?t=0:t<i.NAMEMAX-1&&(this.nameBuf[t++]=String.fromCharCode(r));for(this.fileout||(this.fileout=this.nameBuf),t=0;t<e;)r=this.readByte(),t++;8===u&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++);this.skipdir()}};i.prototype.skipdir=function(){var t,r,n=[];if(8&this.gpflags&&(n[0]=this.readByte(),n[1]=this.readByte(),n[2]=this.readByte(),n[3]=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte()),this.modeZIP&&this.nextFile(),n[0]=this.readByte(),8!==n[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),4&this.gpflags)for(n[0]=this.readByte(),n[2]=this.readByte(),this.len=n[0]+256*n[1],t=0;t<this.len;t++)this.readByte();if(8&this.gpflags)for(t=0,this.nameBuf=[];r=this.readByte();)"7"!==r&&":"!==r||(t=0),t<i.NAMEMAX-1&&(this.nameBuf[t++]=r);if(16&this.gpflags)for(;r=this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte());this.DeflateLoop();this.readByte();this.readByte();this.readByte();this.readByte();this.modeZIP&&this.nextFile()};t.exports=i},{}],25:[function(n,t){"use strict";(function(){function t(n){throw n;}function e(n,t){var u,f=n.split("."),i=ki;for((f[0]in i)||!i.execScript||i.execScript("var "+f[0]);f.length&&(u=f.shift());)f.length||t===r?i=i[u]?i[u]:i[u]={}:i[u]=t}function gt(n){var t,e,i;if("string"==typeof n){for(i=n.split(""),t=0,e=i.length;t<e;t++)i[t]=(255&i[t].charCodeAt(0))>>>0;n=i}for(var o,u=1,f=0,r=n.length,s=0;0<r;){r-=o=1024<r?1024:r;do f+=u+=n[s++];while(--o);u%=65521;f%=65521}return(f<<16|u)>>>0}function v(i,r){this.index="number"==typeof r?r:0;this.i=0;this.buffer=i instanceof(n?Uint8Array:Array)?i:new(n?Uint8Array:Array)(32768);2*this.buffer.length<=this.index&&t(Error("invalid index"));this.buffer.length<=this.index&&this.f()}function nt(t){this.buffer=new(n?Uint16Array:Array)(2*t);this.length=0}function c(t){for(var s,h,u,e,c,o,l,r,v=t.length,f=0,a=Number.POSITIVE_INFINITY,i=0;i<v;++i)t[i]>f&&(f=t[i]),t[i]<a&&(a=t[i]);for(s=1<<f,h=new(n?Uint32Array:Array)(s),u=1,e=0,c=2;u<=f;){for(i=0;i<v;++i)if(t[i]===u){for(o=0,l=e,r=0;r<u;++r)o=o<<1|1&l,l>>=1;for(r=o;r<s;r+=c)h[r]=u<<16|i;++e}++u;e<<=1;c<<=1}return[h,f,a]}function ti(t,i){this.h=tt;this.w=0;this.input=t;this.b=0;i&&(i.lazy&&(this.w=i.lazy),"number"==typeof i.compressionType&&(this.h=i.compressionType),i.outputBuffer&&(this.a=n&&i.outputBuffer instanceof Array?new Uint8Array(i.outputBuffer):i.outputBuffer),"number"==typeof i.outputIndex&&(this.b=i.outputIndex));this.a||(this.a=new(n?Uint8Array:Array)(32768))}function gi(n,t){this.length=n;this.G=t}function nr(){var n=k;switch(i){case 3===n:return[257,n-3,0];case 4===n:return[258,n-4,0];case 5===n:return[259,n-5,0];case 6===n:return[260,n-6,0];case 7===n:return[261,n-7,0];case 8===n:return[262,n-8,0];case 9===n:return[263,n-9,0];case 10===n:return[264,n-10,0];case 12>=n:return[265,n-11,1];case 14>=n:return[266,n-13,1];case 16>=n:return[267,n-15,1];case 18>=n:return[268,n-17,1];case 22>=n:return[269,n-19,2];case 26>=n:return[270,n-23,2];case 30>=n:return[271,n-27,2];case 34>=n:return[272,n-31,2];case 42>=n:return[273,n-35,3];case 50>=n:return[274,n-43,3];case 58>=n:return[275,n-51,3];case 66>=n:return[276,n-59,3];case 82>=n:return[277,n-67,4];case 98>=n:return[278,n-83,4];case 114>=n:return[279,n-99,4];case 130>=n:return[280,n-115,4];case 162>=n:return[281,n-131,5];case 194>=n:return[282,n-163,5];case 226>=n:return[283,n-195,5];case 257>=n:return[284,n-227,5];case 258===n:return[285,n-258,0];default:t("invalid length: "+n)}}function ri(u,f){function k(n,r){var o,f,c,l,u=n.G,e=[],s=0;switch(o=ii[n.length],e[s++]=65535&o,e[s++]=o>>16&255,e[s++]=o>>24,i){case 1===u:f=[0,u-1,0];break;case 2===u:f=[1,u-2,0];break;case 3===u:f=[2,u-3,0];break;case 4===u:f=[3,u-4,0];break;case 6>=u:f=[4,u-5,1];break;case 8>=u:f=[5,u-7,1];break;case 12>=u:f=[6,u-9,2];break;case 16>=u:f=[7,u-13,2];break;case 24>=u:f=[8,u-17,3];break;case 32>=u:f=[9,u-25,3];break;case 48>=u:f=[10,u-33,4];break;case 64>=u:f=[11,u-49,4];break;case 96>=u:f=[12,u-65,5];break;case 128>=u:f=[13,u-97,5];break;case 192>=u:f=[14,u-129,6];break;case 256>=u:f=[15,u-193,6];break;case 384>=u:f=[16,u-257,7];break;case 512>=u:f=[17,u-385,7];break;case 768>=u:f=[18,u-513,8];break;case 1024>=u:f=[19,u-769,8];break;case 1536>=u:f=[20,u-1025,9];break;case 2048>=u:f=[21,u-1537,9];break;case 3072>=u:f=[22,u-2049,10];break;case 4096>=u:f=[23,u-3073,10];break;case 6144>=u:f=[24,u-4097,11];break;case 8192>=u:f=[25,u-6145,11];break;case 12288>=u:f=[26,u-8193,12];break;case 16384>=u:f=[27,u-12289,12];break;case 24576>=u:f=[28,u-16385,13];break;case 32768>=u:f=[29,u-24577,13];break;default:t("invalid distance")}for(o=f,e[s++]=o[0],e[s++]=o[1],e[s++]=o[2],c=0,l=e.length;c<l;++c)v[w++]=e[c];a[e[0]]++;ut[e[3]]++;ft=n.length+r-1;h=null}var e,d,o,nt,y,l,p,h,c,rt={},v=n?new Uint16Array(2*f.length):[],w=0,ft=0,a=new(n?Uint32Array:Array)(286),ut=new(n?Uint32Array:Array)(30),st=u.w;if(!n){for(o=0;285>=o;)a[o++]=0;for(o=0;29>=o;)ut[o++]=0}for(a[256]=1,e=0,d=f.length;e<d;++e){for(o=y=0,nt=3;o<nt&&e+o!==d;++o)y=y<<8|f[e+o];if(rt[y]===r&&(rt[y]=[]),l=rt[y],!(0<ft--)){for(;0<l.length&&32768<e-l[0];)l.shift();if(e+3>=d){for(h&&k(h,-1),o=0,nt=d-e;o<nt;++o)c=f[e+o],v[w++]=c,++a[c];break}if(0<l.length){var tt=r,et=r,b=0,s=r,it=r,g=r,ht=f.length,ot=(it=0,l.length);n:for(;it<ot;it++){if(tt=l[ot-it-1],s=3,3<b){for(g=b;3<g;g--)if(f[tt+g-1]!==f[e+g-1])continue n;s=b}for(;258>s&&e+s<ht&&f[tt+s]===f[e+s];)++s;if(s>b&&(et=tt,b=s),258===s)break}p=new gi(b,e-et);h?h.length<p.length?(c=f[e-1],v[w++]=c,++a[c],k(p,0)):k(h,-1):p.length<st?h=p:k(p,0)}else h?k(h,-1):(c=f[e],v[w++]=c,++a[c])}l.push(e)}return v[w++]=256,a[256]++,u.L=a,u.K=ut,n?v.subarray(0,w):v}function yt(t,i){function g(n){var t=y[n][p[n]];t===s?(g(n+1),g(n+1)):--d[t];++p[n]}var l,a,ut,u,b,tt=t.length,v=new nt(572),w=new(n?Uint8Array:Array)(tt);if(!n)for(u=0;u<tt;u++)w[u]=0;for(u=0;u<tt;++u)0<t[u]&&v.push(u,t[u]);if(l=Array(v.length/2),a=new(n?Uint32Array:Array)(v.length/2),1===l.length)return w[v.pop().index]=1,w;for(u=0,b=v.length/2;u<b;++u)l[u]=v.pop(),a[u]=l[u].value;var o,r,f,it,k,s=a.length,e=new(n?Uint16Array:Array)(i),h=new(n?Uint8Array:Array)(i),d=new(n?Uint8Array:Array)(s),c=Array(i),y=Array(i),p=Array(i),rt=(1<<i)-s,ft=1<<i-1;for(e[i-1]=s,r=0;r<i;++r)rt<ft?h[r]=0:(h[r]=1,rt-=ft),rt<<=1,e[i-2-r]=(e[i-1-r]/2|0)+s;for(e[0]=h[0],c[0]=Array(e[0]),y[0]=Array(e[0]),r=1;r<i;++r)e[r]>2*e[r-1]+h[r]&&(e[r]=2*e[r-1]+h[r]),c[r]=Array(e[r]),y[r]=Array(e[r]);for(o=0;o<s;++o)d[o]=i;for(f=0;f<e[i-1];++f)c[i-1][f]=a[f],y[i-1][f]=f;for(o=0;o<i;++o)p[o]=0;for(1===h[i-1]&&(--d[0],++p[i-1]),r=i-2;0<=r;--r){for(it=o=0,k=p[r+1],f=0;f<e[r];f++)(it=c[r+1][k]+c[r+1][k+1])>a[o]?(c[r][f]=it,y[r][f]=s,k+=2):(c[r][f]=a[o],y[r][f]=o,++o);p[r]=0;1===h[r]&&g(r)}for(ut=d,u=0,b=l.length;u<b;++u)w[l[u].index]=ut[u];return w}function pt(i){for(var o,c,e=new(n?Uint16Array:Array)(i.length),s=[],h=[],u=0,r=0,f=i.length;r<f;r++)s[i[r]]=1+(0|s[i[r]]);for(r=1,f=16;r<=f;r++)h[r]=u,(u+=0|s[r])>1<<r&&t("overcommitted"),u<<=1;for(65536>u&&t("undercommitted"),r=0,f=i.length;r<f;r++)for(u=h[i[r]],h[i[r]]+=1,o=e[r]=0,c=i[r];o<c;o++)e[r]=e[r]<<1|1&u,u>>>=1;return e}function wt(t,i){this.input=t;this.a=new(n?Uint8Array:Array)(32768);this.h=o.j;var r,u={};for(r in!i&&(i={})||"number"!=typeof i.compressionType||(this.h=i.compressionType),i)u[r]=i[r];u.outputBuffer=this.a;this.z=new ti(this.input,u)}function h(i,r){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=n?new Uint8Array(i):i,this.s=!1,this.m=ut,this.B=!1,!r&&(r={})||(r.index&&(this.c=r.index),r.bufferSize&&(this.l=r.bufferSize),r.bufferType&&(this.m=r.bufferType),r.resize&&(this.B=r.resize)),this.m){case bt:this.b=32768;this.a=new(n?Uint8Array:Array)(32768+this.l+258);break;case ut:this.b=0;this.a=new(n?Uint8Array:Array)(this.l);this.f=this.J;this.t=this.H;this.o=this.I;break;default:t(Error("invalid inflate mode"))}}function f(n,i){for(var u,e=n.g,f=n.e,s=n.input,o=n.c;f<i;)(u=s[o++])===r&&t(Error("input buffer is broken")),e|=u<<f,f+=8;return u=e&(1<<i)-1,n.g=e>>>i,n.e=f-i,n.c=o,u}function g(n,i){for(var o,s,f,e=n.g,u=n.e,l=n.input,h=n.c,a=i[0],c=i[1];u<c;)(o=l[h++])===r&&t(Error("input buffer is broken")),e|=o<<u,u+=8;return f=(s=a[e&(1<<c)-1])>>>16,n.g=e>>f,n.e=u-f,n.c=h,65535&s}function tr(t){function u(n,t,i){for(var o,e,r,u=0;u<n;)switch(o=g(this,t)){case 16:for(r=3+f(this,2);r--;)i[u++]=e;break;case 17:for(r=3+f(this,3);r--;)i[u++]=0;e=0;break;case 18:for(r=11+f(this,7);r--;)i[u++]=0;e=0;break;default:e=i[u++]=o}return i}for(var r,e,o,s=f(t,5)+257,h=f(t,5)+1,a=f(t,4)+4,l=new(n?Uint8Array:Array)(ei.length),i=0;i<a;++i)l[ei[i]]=f(t,3);r=c(l);e=new(n?Uint8Array:Array)(s);o=new(n?Uint8Array:Array)(h);t.o(c(u.call(t,s,r,e)),c(u.call(t,h,r,o)))}function dt(n,i){var r,u;switch(this.input=n,this.c=0,!i&&(i={})||(i.index&&(this.c=i.index),i.verify&&(this.M=i.verify)),r=n[this.c++],u=n[this.c++],15&r){case y:this.method=y;break;default:t(Error("unsupported compression method"))}0!=((r<<8)+u)%31&&t(Error("invalid fcheck flag:"+((r<<8)+u)%31));32&u&&t(Error("fdict flag is not supported"));this.A=new h(n,{index:this.c,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}var r=void 0,i=!0,ki=this,n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,p,at,s,k,it,rt,ii,o,ot,vi,yi,st,pi,a,wi,ht,ct,bi,lt,y;for(v.prototype.f=function(){var t,i=this.buffer,u=i.length,r=new(n?Uint8Array:Array)(u<<1);if(n)r.set(i);else for(t=0;t<u;++t)r[t]=i[t];return this.buffer=r},v.prototype.d=function(n,t,i){var o,u=this.buffer,f=this.index,e=this.i,r=u[f];if(i&&1<t&&(n=8<t?(s[255&n]<<24|s[n>>>8&255]<<16|s[n>>>16&255]<<8|s[n>>>24&255])>>32-t:s[n]>>8-t),8>t+e)r=r<<t|n,e+=t;else for(o=0;o<t;++o)r=r<<1|n>>t-o-1&1,8==++e&&(e=0,u[f++]=s[r],r=0,f===u.length&&(u=this.f()));u[f]=r;this.buffer=u;this.i=e;this.index=f},v.prototype.finish=function(){var r,t=this.buffer,i=this.index;return 0<this.i&&(t[i]<<=8-this.i,t[i]=s[t[i]],i++),n?r=t.subarray(0,i):(t.length=i,r=t),r},at=new(n?Uint8Array:Array)(256),p=0;256>p;++p){for(var vt=w=p,ni=7,w=w>>>1;w;w>>>=1)vt<<=1,vt|=1&w,--ni;at[p]=(vt<<ni&255)>>>0}s=at;n&&new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);nt.prototype.getParent=function(n){return 2*((n-2)/4|0)};nt.prototype.push=function(n,t){var r,u,f,i=this.buffer;for(r=this.length,i[this.length++]=t,i[this.length++]=n;0<r&&(u=this.getParent(r),i[r]>i[u]);)f=i[r],i[r]=i[u],i[u]=f,f=i[r+1],i[r+1]=i[u+1],i[u+1]=f,r=u;return this.length};nt.prototype.pop=function(){var u,f,r,t,i,n=this.buffer;for(f=n[0],u=n[1],this.length-=2,n[0]=n[this.length],n[1]=n[this.length+1],i=0;!((t=2*i+2)>=this.length)&&(t+2<this.length&&n[t+2]>n[t]&&(t+=2),n[t]>n[i]);)r=n[i],n[i]=n[t],n[t]=r,r=n[i+1],n[i+1]=n[t+1],n[t+1]=r,i=t;return{index:u,value:f,length:this.length}};for(var tt=2,di={NONE:0,r:1,j:tt,N:3},b=[],u=0;288>u;u++)switch(i){case 143>=u:b.push([u+48,8]);break;case 255>=u:b.push([u- -256,9]);break;case 279>=u:b.push([u-256,7]);break;case 287>=u:b.push([u-88,8]);break;default:t("invalid literal: "+u)}for(ti.prototype.n=function(){var at,si,rt,ni,ht=this.input,g,p,li,wt,nt,d,di,lt,fi,gi,nr,tr,ir,ei,oi;switch(this.h){case 0:for(rt=0,ni=ht.length;rt<ni;){var hi,ti,ii,ut=si=n?ht.subarray(rt,rt+65535):ht.slice(rt,rt+65535),rr=(rt+=si.length)===ni,vt=r,ci=r,e=this.a,h=this.b;if(n){for(e=new Uint8Array(this.a.buffer);e.length<=h+ut.length+5;)e=new Uint8Array(e.length<<1);e.set(this.a)}if(hi=rr?1:0,e[h++]=0|hi,ii=65536+~(ti=ut.length)&65535,e[h++]=255&ti,e[h++]=ti>>>8&255,e[h++]=255&ii,e[h++]=ii>>>8&255,n)e.set(ut,h),h+=ut.length,e=e.subarray(0,h);else{for(vt=0,ci=ut.length;vt<ci;++vt)e[h++]=ut[vt];e.length=h}this.b=h;this.a=e}break;case 1:for(g=new v(new Uint8Array(this.a.buffer),this.b),g.d(1,1,i),g.d(1,2,i),nt=ri(this,ht),p=0,li=nt.length;p<li;p++)if(wt=nt[p],v.prototype.d.apply(g,b[wt]),256<wt)g.d(nt[++p],nt[++p],i),g.d(nt[++p],5),g.d(nt[++p],nt[++p],i);else if(256===wt)break;this.a=g.finish();this.b=this.a.length;break;case tt:var ai,it,ft,et,ot,bt,vi,kt,yi,dt,pi,st,gt,o,wi,s=new v(new Uint8Array(this.a),this.b),ur=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ui=Array(19);for(ai=tt,s.d(1,1,i),s.d(ai,2,i),it=ri(this,ht),vi=pt(bt=yt(this.L,15)),yi=pt(kt=yt(this.K,7)),ft=286;257<ft&&0===bt[ft-1];ft--);for(et=30;1<et&&0===kt[et-1];et--);for(var w,f,ct,c,l,bi=ft,ki=et,y=new(n?Uint32Array:Array)(bi+ki),a=new(n?Uint32Array:Array)(316),k=new(n?Uint8Array:Array)(19),u=w=0;u<bi;u++)y[w++]=bt[u];for(u=0;u<ki;u++)y[w++]=kt[u];if(!n)for(u=0,ct=k.length;u<ct;++u)k[u]=0;for(u=c=0,ct=y.length;u<ct;u+=w){for(w=1;u+w<ct&&y[u+w]===y[u];++w);if(f=w,0===y[u])if(3>f)for(;0<f--;)a[c++]=0,k[0]++;else for(;0<f;)(l=138>f?f:138)>f-3&&l<f&&(l=f-3),10>=l?(a[c++]=17,a[c++]=l-3,k[17]++):(a[c++]=18,a[c++]=l-11,k[18]++),f-=l;else if(a[c++]=y[u],k[y[u]]++,3>--f)for(;0<f--;)a[c++]=y[u],k[y[u]]++;else for(;0<f;)(l=6>f?f:6)>f-3&&l<f&&(l=f-3),a[c++]=16,a[c++]=l-3,k[16]++,f-=l}for(at=n?a.subarray(0,c):a.slice(0,c),dt=yt(k,7),o=0;19>o;o++)ui[o]=dt[ur[o]];for(ot=19;4<ot&&0===ui[ot-1];ot--);for(pi=pt(dt),s.d(ft-257,5,i),s.d(et-1,5,i),s.d(ot-4,4,i),o=0;o<ot;o++)s.d(ui[o],3,i);for(o=0,wi=at.length;o<wi;o++)if(st=at[o],s.d(pi[st],dt[st],i),16<=st){switch(o++,st){case 16:gt=2;break;case 17:gt=3;break;case 18:gt=7;break;default:t("invalid code: "+st)}s.d(at[o],gt,i)}for(ei=[vi,bt],oi=[yi,kt],gi=ei[0],nr=ei[1],tr=oi[0],ir=oi[1],d=0,di=it.length;d<di;++d)if(lt=it[d],s.d(gi[lt],nr[lt],i),256<lt)s.d(it[++d],it[++d],i),fi=it[++d],s.d(tr[fi],ir[fi],i),s.d(it[++d],it[++d],i);else if(256===lt)break;this.a=s.finish();this.b=this.a.length;break;default:t("invalid compression type")}return this.a},rt=[],k=3;258>=k;k++)it=nr(),rt[k]=it[2]<<24|it[1]<<16|it[0];ii=n?new Uint32Array(rt):rt;o=di;wt.prototype.n=function(){var e,c,s,h,f,u,i,r=0;switch(i=this.a,e=y){case y:c=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}switch(s=c<<4|e,i[r++]=s,e){case y:switch(this.h){case o.NONE:f=0;break;case o.r:f=1;break;case o.j:f=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}return h=f<<6|0,i[r++]=h|31-(256*s+h)%31,u=gt(this.input),this.z.b=r,r=(i=this.z.n()).length,n&&((i=new Uint8Array(i.buffer)).length<=r+4&&(this.a=new Uint8Array(i.length+4),this.a.set(i),i=this.a),i=i.subarray(0,r+4)),i[r++]=u>>24&255,i[r++]=u>>16&255,i[r++]=u>>8&255,i[r++]=255&u,i};e("Zlib.Deflate",wt);e("Zlib.Deflate.compress",function(n,t){return new wt(n,t).n()});e("Zlib.Deflate.CompressionType",o);e("Zlib.Deflate.CompressionType.NONE",o.NONE);e("Zlib.Deflate.CompressionType.FIXED",o.r);e("Zlib.Deflate.CompressionType.DYNAMIC",o.j);var bt=0,ut=1,d={D:bt,C:ut};h.prototype.p=function(){for(var a;!this.s;){a=f(this,3);switch(1&a&&(this.s=i),a>>>=1){case 0:var h=this.input,u=this.c,s=this.a,e=this.b,c=r,o=r,v=r,y=s.length,l=r;switch(this.e=this.g=0,(c=h[u++])===r&&t(Error("invalid uncompressed block header: LEN (first byte)")),o=c,(c=h[u++])===r&&t(Error("invalid uncompressed block header: LEN (second byte)")),o|=c<<8,(c=h[u++])===r&&t(Error("invalid uncompressed block header: NLEN (first byte)")),v=c,(c=h[u++])===r&&t(Error("invalid uncompressed block header: NLEN (second byte)")),o===~(v|=c<<8)&&t(Error("invalid uncompressed block header: length verify")),u+o>h.length&&t(Error("input buffer is broken")),this.m){case bt:for(;e+o>s.length;){if(o-=l=y-e,n)s.set(h.subarray(u,u+l),e),e+=l,u+=l;else for(;l--;)s[e++]=h[u++];this.b=e;s=this.f();e=this.b}break;case ut:for(;e+o>s.length;)s=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(n)s.set(h.subarray(u,u+o),e),e+=o,u+=o;else for(;o--;)s[e++]=h[u++];this.c=u;this.b=e;this.a=s;break;case 1:this.o(yi,pi);break;case 2:tr(this);break;default:t(Error("unknown BTYPE: "+a))}}return this.t()};for(var fi=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ei=n?new Uint16Array(fi):fi,oi=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],si=n?new Uint16Array(oi):oi,hi=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],ft=n?new Uint8Array(hi):hi,ci=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],li=n?new Uint16Array(ci):ci,ai=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],et=n?new Uint8Array(ai):ai,kt=new(n?Uint8Array:Array)(288),l=0,ui=kt.length;l<ui;++l)kt[l]=143>=l?8:255>=l?9:279>=l?7:8;for(yi=c(kt),st=new(n?Uint8Array:Array)(30),ot=0,vi=st.length;ot<vi;++ot)st[ot]=5;for(pi=c(st),h.prototype.o=function(n,t){var u=this.a,i=this.b,r,e,o,s,h;for(this.u=n,h=u.length-258;256!==(r=g(this,n));)if(256>r)i>=h&&(this.b=i,u=this.f(),i=this.b),u[i++]=r;else for(s=si[e=r-257],0<ft[e]&&(s+=f(this,ft[e])),r=g(this,t),o=li[r],0<et[r]&&(o+=f(this,et[r])),i>=h&&(this.b=i,u=this.f(),i=this.b);s--;)u[i]=u[i++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=i},h.prototype.I=function(n,t){var r=this.a,u=this.b,i,s,h,o,e;for(this.u=n,e=r.length;256!==(i=g(this,n));)if(256>i)u>=e&&(e=(r=this.f()).length),r[u++]=i;else for(o=si[s=i-257],0<ft[s]&&(o+=f(this,ft[s])),i=g(this,t),h=li[i],0<et[i]&&(h+=f(this,et[i])),u+o>e&&(e=(r=this.f()).length);o--;)r[u]=r[u++-h];for(;8<=this.e;)this.e-=8,this.c--;this.b=u},h.prototype.f=function(){var t,f,r=new(n?Uint8Array:Array)(this.b-32768),u=this.b-32768,i=this.a;if(n)r.set(i.subarray(32768,r.length));else for(t=0,f=r.length;t<f;++t)r[t]=i[t+32768];if(this.k.push(r),this.q+=r.length,n)i.set(i.subarray(u,u+32768));else for(t=0;32768>t;++t)i[t]=i[u+t];return this.b=32768,i},h.prototype.J=function(t){var u,f,e,r=this.input.length/this.c+1|0,o=this.input,i=this.a;return t&&("number"==typeof t.v&&(r=t.v),"number"==typeof t.F&&(r+=t.F)),f=2>r?(e=(o.length-this.c)/this.u[2]*129|0)<i.length?i.length+e:i.length<<1:i.length*r,n?(u=new Uint8Array(f)).set(i):u=i,this.a=u},h.prototype.t=function(){var e,t,i,r,o,s=0,h=this.a,u=this.k,f=new(n?Uint8Array:Array)(this.q+(this.b-32768));if(0===u.length)return n?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(t=0,i=u.length;t<i;++t)for(r=0,o=(e=u[t]).length;r<o;++r)f[s++]=e[r];for(t=32768,i=this.b;t<i;++t)f[s++]=h[t];return this.k=[],this.buffer=f},h.prototype.H=function(){var i,t=this.b;return n?this.B?(i=new Uint8Array(t)).set(this.a.subarray(0,t)):i=this.a.subarray(0,t):(this.a.length>t&&(this.a.length=t),i=this.a),this.buffer=i},dt.prototype.p=function(){var i,n=this.input;return i=this.A.p(),this.c=this.A.c,this.M&&(n[this.c++]<<24|n[this.c++]<<16|n[this.c++]<<8|n[this.c++])>>>0!==gt(i)&&t(Error("invalid adler-32 checksum")),i},e("Zlib.Inflate",dt),e("Zlib.Inflate.BufferType",d),d.ADAPTIVE=d.C,d.BLOCK=d.D,e("Zlib.Inflate.prototype.decompress",dt.prototype.p),n&&new Uint16Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),n&&new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]),n&&new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),n&&new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]),n&&new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),ht=new(n?Uint8Array:Array)(288),a=0,wi=ht.length;a<wi;++a)ht[a]=143>=a?8:255>=a?9:279>=a?7:8;for(c(ht),lt=new(n?Uint8Array:Array)(30),ct=0,bi=lt.length;ct<bi;++ct)lt[ct]=5;c(lt);y=8}).call(window);var i=window.Zlib;i.Deflate=i.Deflate;i.Deflate.compress=i.Deflate.compress;i.Inflate=i.Inflate;i.Inflate.BufferType=i.Inflate.BufferType;i.Inflate.prototype.decompress=i.Inflate.prototype.decompress;t.exports=i},{}],26:[function(n,t){"use strict";function u(n){return function(){var i=arguments[0],t=n+" "+i+", please go to "+c+"#"+i+" to see details.",r;return 1===arguments.length?t:2===arguments.length?t+" Arguments: "+arguments[1]:(r=cc.js.shiftArguments.apply(null,arguments),t+" Arguments: "+r.join(", "))}}var i,h=n("./platform/utils"),c=(n("../../DebugInfos"),"https://github.com/cocos-creator/engine/blob/master/EngineErrorMap.md"),f,e,o,s,r;cc.log=cc.warn=cc.error=cc.assert=console.log.bind?console.log.bind(console):console.log;cc._throw=function(n){h.callInNextTick(function(){throw n;})};f=u("Log");cc.logID=function(){cc.log(f.apply(null,arguments))};e=u("Warning");cc.warnID=function(){cc.warn(e.apply(null,arguments))};o=u("Error");cc.errorID=function(){cc.error(o.apply(null,arguments))};s=u("Assert");cc.assertID=function(n){n||cc.assert(!1,s.apply(null,cc.js.shiftArguments.apply(null,arguments)))};r=cc.Enum({NONE:0,INFO:1,WARN:2,ERROR:3,INFO_FOR_WEB_PAGE:4,WARN_FOR_WEB_PAGE:5,ERROR_FOR_WEB_PAGE:6});t.exports=cc.debug={DebugMode:r,_resetDebugSetting:function(n){if(cc.log=cc.warn=cc.error=cc.assert=function(){},n!==r.NONE){if(n>r.ERROR){var t=function(n){var r,u,t;cc.game.canvas&&(i||(r=document.createElement("Div"),r.setAttribute("id","logInfoDiv"),r.setAttribute("width","200"),r.setAttribute("height",cc.game.canvas.height),u=r.style,u.zIndex="99999",u.position="absolute",u.top=u.left="0",(i=document.createElement("textarea")).setAttribute("rows","20"),i.setAttribute("cols","30"),i.setAttribute("disabled","true"),t=i.style,t.backgroundColor="transparent",t.borderBottom="1px solid #cccccc",t.borderTopWidth=t.borderLeftWidth=t.borderRightWidth="0px",t.borderTopStyle=t.borderLeftStyle=t.borderRightStyle="none",t.padding="0px",t.margin=0,r.appendChild(i),cc.game.canvas.parentNode.appendChild(r)),i.value=i.value+n+"\r\n",i.scrollTop=i.scrollHeight)};cc.error=function(){t("ERROR :  "+cc.js.formatStr.apply(null,arguments))};cc.assert=function(n,i){!n&&i&&(i=cc.js.formatStr.apply(null,cc.js.shiftArguments.apply(null,arguments)),t("ASSERT: "+i))};n!==r.ERROR_FOR_WEB_PAGE&&(cc.warn=function(){t("WARN :  "+cc.js.formatStr.apply(null,arguments))});n===r.INFO_FOR_WEB_PAGE&&(cc.log=function(){t(cc.js.formatStr.apply(null,arguments))})}else console&&console.log.apply&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),cc.error=console.error.bind?console.error.bind(console):function(){return console.error.apply(console,arguments)},cc.assert=function(n,t){if(!n)throw t&&(t=cc.js.formatStr.apply(null,cc.js.shiftArguments.apply(null,arguments))),new Error(t);});n!==r.ERROR&&(cc.warn=console.warn.bind?console.warn.bind(console):function(){return console.warn.apply(console,arguments)});n===r.INFO&&(cc.log=console.log.bind?console.log.bind(console):function(){return console.log.apply(console,arguments)})}},getError:u("ERROR"),isDisplayStats:function(){return!!cc.profiler&&cc.profiler.isShowingStats()},setDisplayStats:function(n){cc.profiler&&cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS&&(n?cc.profiler.showStats():cc.profiler.hideStats(),cc.game.config.showFPS=!!n)}}},{"../../DebugInfos":void 0,"./platform/utils":219}],27:[function(n,t){"use strict";var f=n("./event/event-target"),o=n("./component-scheduler"),s=n("./node-activator"),e=n("./platform/CCObject"),i=n("./CCGame"),h=n("./renderer"),r=n("./event-manager"),u=n("./CCScheduler");cc.Director=function(){f.call(this);this._paused=!1;this._purgeDirectorInNextLoop=!1;this._winSizeInPoints=null;this._scene=null;this._loadingScene="";this._totalFrames=0;this._lastUpdate=0;this._deltaTime=0;this._startTime=0;this._maxParticleDeltaTime=0;this._scheduler=null;this._compScheduler=null;this._nodeActivator=null;this._actionManager=null;var n=this;i.on(i.EVENT_SHOW,function(){n._lastUpdate=performance.now()});i.once(i.EVENT_ENGINE_INITED,this.init,this)};cc.Director.prototype={constructor:cc.Director,init:function(){return this._totalFrames=0,this._lastUpdate=performance.now(),this._startTime=this._lastUpdate,this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=cc.size(0,0),this._scheduler=new u,cc.ActionManager?(this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdate(this._actionManager,u.PRIORITY_SYSTEM,!1)):this._actionManager=null,this.sharedInit(),!0},sharedInit:function(){this._compScheduler=new o;this._nodeActivator=new s;r&&r.setEnabled(!0);cc.AnimationManager?(this._animationManager=new cc.AnimationManager,this._scheduler.scheduleUpdate(this._animationManager,u.PRIORITY_SYSTEM,!1)):this._animationManager=null;cc.CollisionManager?(this._collisionManager=new cc.CollisionManager,this._scheduler.scheduleUpdate(this._collisionManager,u.PRIORITY_SYSTEM,!1)):this._collisionManager=null;cc.PhysicsManager?(this._physicsManager=new cc.PhysicsManager,this._scheduler.scheduleUpdate(this._physicsManager,u.PRIORITY_SYSTEM,!1)):this._physicsManager=null;cc.Physics3DManager;this._physics3DManager=null;cc._widgetManager&&cc._widgetManager.init(this)},calculateDeltaTime:function(n){n||(n=performance.now());this._deltaTime=n>this._lastUpdate?(n-this._lastUpdate)/1e3:0;this._lastUpdate=n},convertToGL:function(n){var r=i.container,t=cc.view,u=r.getBoundingClientRect(),o=u.left+window.pageXOffset-r.clientLeft,s=u.top+window.pageYOffset-r.clientTop,f=t._devicePixelRatio*(n.x-o),e=t._devicePixelRatio*(s+u.height-n.y);return t._isRotated?cc.v2(t._viewportRect.width-e,f):cc.v2(f,e)},convertToUI:function(n){var f=i.container,t=cc.view,u=f.getBoundingClientRect(),e=u.left+window.pageXOffset-f.clientLeft,o=u.top+window.pageYOffset-f.clientTop,r=cc.v2(0,0);return t._isRotated?(r.x=e+n.y/t._devicePixelRatio,r.y=o+u.height-(t._viewportRect.width-n.x)/t._devicePixelRatio):(r.x=e+n.x*t._devicePixelRatio,r.y=o+u.height-n.y*t._devicePixelRatio),r},end:function(){this._purgeDirectorInNextLoop=!0},getWinSize:function(){return cc.size(cc.winSize)},getWinSizeInPixels:function(){return cc.size(cc.winSize)},pause:function(){this._paused||(this._paused=!0)},purgeCachedData:function(){cc.assetManager.releaseAll()},purgeDirector:function(){this._scheduler.unscheduleAll();this._compScheduler.unscheduleAll();this._nodeActivator.reset();r&&r.setEnabled(!1);cc.isValid(this._scene)&&this._scene.destroy();this._scene=null;cc.renderer.clear();cc.assetManager.builtins.clear();cc.game.pause();cc.assetManager.releaseAll()},reset:function(){this.purgeDirector();r&&r.setEnabled(!0);this._actionManager&&this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1);this._animationManager&&this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1);this._collisionManager&&this._scheduler.scheduleUpdate(this._collisionManager,cc.Scheduler.PRIORITY_SYSTEM,!1);this._physicsManager&&this._scheduler.scheduleUpdate(this._physicsManager,cc.Scheduler.PRIORITY_SYSTEM,!1);cc.game.resume()},runSceneImmediate:function(n,t,r){var u,f,o,s,c,h;for(cc.assertID(n instanceof cc.Scene||n instanceof cc.SceneAsset,1216),n instanceof cc.SceneAsset&&(n=n.scene),n._load(),u=Object.keys(i._persistRootNodes).map(function(n){return i._persistRootNodes[n]}),f=0;f<u.length;f++)o=u[f],s=n.getChildByUuid(o.uuid),s?(c=s.getSiblingIndex(),s._destroyImmediate(),n.insertChild(o,c)):o.parent=n;h=this._scene;cc.assetManager._releaseManager._autoRelease(h,n,u);cc.isValid(h)&&h.destroy();this._scene=null;e._deferredDestroy();t&&t();this.emit(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,n);this._scene=n;n._activate();cc.game.resume();r&&r(null,n);this.emit(cc.Director.EVENT_AFTER_SCENE_LAUNCH,n)},runScene:function(n,t,i){cc.assertID(n,1205);cc.assertID(n instanceof cc.Scene||n instanceof cc.SceneAsset,1216);n instanceof cc.SceneAsset&&(n=n.scene);n._load();this.once(cc.Director.EVENT_AFTER_DRAW,function(){this.runSceneImmediate(n,t,i)},this)},loadScene:function(n,t,i){var r,u;return this._loadingScene?(cc.warnID(1208,n,this._loadingScene),!1):(r=cc.assetManager.bundles.find(function(t){return t.getSceneInfo(n)}),r)?(this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,n),this._loadingScene=n,u=this,console.time("LoadScene "+n),r.loadScene(n,function(r,f){console.timeEnd("LoadScene "+n);u._loadingScene="";r?(r="Failed to load scene: "+r,cc.error(r),t&&t(r)):u.runSceneImmediate(f,i,t)}),!0):(cc.errorID(1209,n),!1)},preloadScene:function(n,t,i){var r=cc.assetManager.bundles.find(function(t){return t.getSceneInfo(n)});if(!r)return cc.errorID(1209,n),null;r.preloadScene(n,null,t,i)},resume:function(){this._paused&&(this._lastUpdate=performance.now(),this._lastUpdate||cc.logID(1200),this._paused=!1,this._deltaTime=0)},setDepthTest:function(n){cc.Camera.main&&(cc.Camera.main.depth=!!n)},setClearColor:function(n){cc.Camera.main&&(cc.Camera.main.backgroundColor=n)},getRunningScene:function(){return this._scene},getScene:function(){return this._scene},getAnimationInterval:function(){return 1e3/i.getFrameRate()},setAnimationInterval:function(n){i.setFrameRate(Math.round(1e3/n))},getDeltaTime:function(){return this._deltaTime},getTotalTime:function(){return performance.now()-this._startTime},getTotalFrames:function(){return this._totalFrames},isPaused:function(){return this._paused},getScheduler:function(){return this._scheduler},setScheduler:function(n){this._scheduler!==n&&(this._scheduler=n)},getActionManager:function(){return this._actionManager},setActionManager:function(n){this._actionManager!==n&&(this._actionManager&&this._scheduler.unscheduleUpdate(this._actionManager),this._actionManager=n,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1))},getAnimationManager:function(){return this._animationManager},getCollisionManager:function(){return this._collisionManager},getPhysicsManager:function(){return this._physicsManager},getPhysics3DManager:function(){return this._physics3DManager},startAnimation:function(){cc.game.resume()},stopAnimation:function(){cc.game.pause()},_resetDeltaTime:function(){this._lastUpdate=performance.now();this._deltaTime=0},mainLoop:function(n){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):(this.calculateDeltaTime(n),this._paused||(this.emit(cc.Director.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(this._deltaTime),this._scheduler.update(this._deltaTime),this._compScheduler.lateUpdatePhase(this._deltaTime),this.emit(cc.Director.EVENT_AFTER_UPDATE),e._deferredDestroy()),this.emit(cc.Director.EVENT_BEFORE_DRAW),h.render(this._scene,this._deltaTime),this.emit(cc.Director.EVENT_AFTER_DRAW),r.frameUpdateListeners(),this._totalFrames++)},__fastOn:function(n,t,i){this.on(n,t,i)},__fastOff:function(n,t,i){this.off(n,t,i)}};cc.js.addon(cc.Director.prototype,f.prototype);cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed";cc.Director.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading";cc.Director.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch";cc.Director.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch";cc.Director.EVENT_BEFORE_UPDATE="director_before_update";cc.Director.EVENT_AFTER_UPDATE="director_after_update";cc.Director.EVENT_BEFORE_VISIT="director_before_draw";cc.Director.EVENT_AFTER_VISIT="director_before_draw";cc.Director.EVENT_BEFORE_DRAW="director_before_draw";cc.Director.EVENT_AFTER_DRAW="director_after_draw";cc.Director.PROJECTION_2D=0;cc.Director.PROJECTION_3D=1;cc.Director.PROJECTION_CUSTOM=3;cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_2D;cc.Director.EVENT_BEFORE_PHYSICS="director_before_physics";cc.Director.EVENT_AFTER_PHYSICS="director_after_physics";cc.director=new cc.Director;t.exports=cc.director},{"./CCGame":28,"./CCScheduler":32,"./component-scheduler":99,"./event-manager":140,"./event/event-target":142,"./node-activator":168,"./platform/CCObject":201,"./renderer":226}],28:[function(n,t){"use strict";var r=n("./event/event-target");n("../audio/CCAudioEngine");var f=n("./CCDebug"),u=n("./renderer/index.js"),e=n("../core/renderer/utils/dynamic-atlas/manager"),i={EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_RESTART:"game_on_restart",EVENT_GAME_INITED:"game_inited",EVENT_ENGINE_INITED:"engine_inited",EVENT_RENDERER_INITED:"engine_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_persistRootNodes:{},_paused:!0,_configLoaded:!1,_isCloning:!1,_prepared:!1,_rendererInitialized:!1,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,frame:null,container:null,canvas:null,renderType:-1,config:null,onStart:null,setFrameRate:function(n){this.config.frameRate=n;this._intervalId&&window.cancelAnimFrame(this._intervalId);this._intervalId=0;this._paused=!0;this._setAnimFrame();this._runMainLoop()},getFrameRate:function(){return this.config.frameRate},step:function(){cc.director.mainLoop()},pause:function(){this._paused||(this._paused=!0,cc.audioEngine&&cc.audioEngine._break(),this._intervalId&&window.cancelAnimFrame(this._intervalId),this._intervalId=0)},resume:function(){this._paused&&(this._paused=!1,cc.audioEngine&&cc.audioEngine._restore(),cc.director._resetDeltaTime(),this._runMainLoop())},isPaused:function(){return this._paused},restart:function(){cc.director.once(cc.Director.EVENT_AFTER_DRAW,function(){for(var n in i._persistRootNodes)i.removePersistRootNode(i._persistRootNodes[n]);cc.director.getScene().destroy();cc.Object._deferredDestroy();cc.audioEngine&&cc.audioEngine.uncacheAll();cc.director.reset();i.pause();cc.assetManager.builtins.init(function(){i.onStart();i.emit(i.EVENT_RESTART)})})},end:function(){close()},_initEngine:function(){this._rendererInitialized||(this._initRenderer(),this._initEvents(),this.emit(this.EVENT_ENGINE_INITED))},_loadPreviewScript:function(n){n()},_prepareFinished:function(n){var t=this;this._initEngine();this._setAnimFrame();cc.assetManager.builtins.init(function(){console.log("Cocos Creator v"+cc.ENGINE_VERSION);t._prepared=!0;t._runMainLoop();t.emit(t.EVENT_GAME_INITED);n&&n()})},eventTargetOn:r.prototype.on,eventTargetOnce:r.prototype.once,on:function(n,t,i,r){this._prepared&&n===this.EVENT_ENGINE_INITED||!this._paused&&n===this.EVENT_GAME_INITED?t.call(i):this.eventTargetOn(n,t,i,r)},once:function(n,t,i){this._prepared&&n===this.EVENT_ENGINE_INITED||!this._paused&&n===this.EVENT_GAME_INITED?t.call(i):this.eventTargetOnce(n,t,i)},prepare:function(n){var t=this;this._prepared?n&&n():this._loadPreviewScript(function(){t._prepareFinished(n)})},run:function(n,t){this._initConfig(n);this.onStart=t;this.prepare(i.onStart&&i.onStart.bind(i))},addPersistRootNode:function(n){var i,t;if(cc.Node.isNode(n)&&n.uuid){if(i=n.uuid,!this._persistRootNodes[i]){if(t=cc.director._scene,cc.isValid(t))if(n.parent){if(!(n.parent instanceof cc.Scene))return void cc.warnID(3801);if(n.parent!==t)return void cc.warnID(3802)}else n.parent=t;this._persistRootNodes[i]=n;n._persistNode=!0;cc.assetManager._releaseManager._addPersistNodeRef(n)}}else cc.warnID(3800)},removePersistRootNode:function(n){var t=n.uuid||"";n===this._persistRootNodes[t]&&(delete this._persistRootNodes[t],n._persistNode=!1,cc.assetManager._releaseManager._removePersistNodeRef(n))},isPersistRootNode:function(n){return n._persistNode},_setAnimFrame:function(){var n,t;this._lastTime=performance.now();n=i.config.frameRate;this._frameTime=1e3/n;cc.director._maxParticleDeltaTime=this._frameTime/500;t=window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;60!==n&&30!==n?(window.requestAnimFrame=t?this._stTimeWithRAF:this._stTime,window.cancelAnimFrame=this._ctTime):(window.requestAnimFrame=t||this._stTime,window.cancelAnimFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime)},_stTimeWithRAF:function(n){var t=performance.now(),r=Math.max(0,i._frameTime-(t-i._lastTime)),u=window.setTimeout(function(){window.requestAnimationFrame(n)},r);return i._lastTime=t+r,u},_stTime:function(n){var t=performance.now(),r=Math.max(0,i._frameTime-(t-i._lastTime)),u=window.setTimeout(function(){n()},r);return i._lastTime=t+r,u},_ctTime:function(n){window.clearTimeout(n)},_runMainLoop:function(){if(this._prepared){var t,n=this,i=n.config,u=cc.director,r=!0,e=i.frameRate;f.setDisplayStats(i.showFPS);t=function(i){if(!n._paused){if(n._intervalId=window.requestAnimFrame(t),30===e&&(r=!r))return;u.mainLoop(i)}};n._intervalId=window.requestAnimFrame(t);n._paused=!1}},_initConfig:function(n){"number"!=typeof n.debugMode&&(n.debugMode=0);n.exposeClassName=!!n.exposeClassName;"number"!=typeof n.frameRate&&(n.frameRate=60);var t=n.renderMode;("number"!=typeof t||t>2||t<0)&&(n.renderMode=0);"boolean"!=typeof n.registerSystemEvent&&(n.registerSystemEvent=!0);n.showFPS=1!==t&&!!n.showFPS;this.collisionMatrix=n.collisionMatrix||[];this.groupList=n.groupList||[];f._resetDebugSetting(n.debugMode);this.config=n;this._configLoaded=!0},_determineRenderType:function(){var i=this.config,t=parseInt(i.renderMode)||0,n;if(this.renderType=this.RENDER_TYPE_CANVAS,n=!1,0===t?cc.sys.capabilities.opengl?(this.renderType=this.RENDER_TYPE_WEBGL,n=!0):cc.sys.capabilities.canvas&&(this.renderType=this.RENDER_TYPE_CANVAS,n=!0):1===t&&cc.sys.capabilities.canvas?(this.renderType=this.RENDER_TYPE_CANVAS,n=!0):2===t&&cc.sys.capabilities.opengl&&(this.renderType=this.RENDER_TYPE_WEBGL,n=!0),!n)throw new Error(f.getError(3820,t));},_initRenderer:function(){var f,o,n,i,r,t,s;this._rendererInitialized||(r=this.config.id,t=r instanceof HTMLElement?r:document.querySelector(r)||document.querySelector("#"+r),("CANVAS"===t.tagName?(f=t.width,o=t.height,this.canvas=n=t,this.container=i=document.createElement("DIV"),n.parentNode&&n.parentNode.insertBefore(i,n)):("DIV"!==t.tagName&&cc.warnID(3819),f=t.clientWidth,o=t.clientHeight,this.canvas=n=document.createElement("CANVAS"),this.container=i=document.createElement("DIV"),t.appendChild(i)),i.setAttribute("id","Cocos2dGameContainer"),i.appendChild(n),this.frame=i.parentNode===document.body?document.documentElement:i.parentNode,function(n){(" "+n.className+" ").indexOf(" gameCanvas ")>-1||(n.className&&(n.className+=" "),n.className+="gameCanvas")}(n),n.setAttribute("width",f||480),n.setAttribute("height",o||320),n.setAttribute("tabindex",99),this._determineRenderType(),this.renderType===this.RENDER_TYPE_WEBGL)&&(s={stencil:!0,antialias:cc.macro.ENABLE_WEBGL_ANTIALIAS,alpha:cc.macro.ENABLE_TRANSPARENT_CANVAS},u.initWebGL(n,s),this._renderContext=u.device._gl,!cc.macro.CLEANUP_IMAGE_CACHE&&e&&(e.enabled=!0)),this._renderContext||(this.renderType=this.RENDER_TYPE_CANVAS,u.initCanvas(n),this._renderContext=u.device._ctx),this.canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable)return!1},this._rendererInitialized=!0)},_initEvents:function(){function f(){r||(r=!0,i.emit(i.EVENT_HIDE))}function u(n,t,u,f,e){r&&(r=!1,i.emit(i.EVENT_SHOW,n,t,u,f,e))}var n,t=window,r,o,e;if(this.config.registerSystemEvent&&cc.internal.inputManager.registerSystemEvent(this.canvas),void 0!==document.hidden?n="hidden":void 0!==document.mozHidden?n="mozHidden":void 0!==document.msHidden?n="msHidden":void 0!==document.webkitHidden&&(n="webkitHidden"),r=!1,n)for(o=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],e=0;e<o.length;e++)document.addEventListener(o[e],function(t){var i=document[n];(i=i||t.hidden)?f():u()});else t.addEventListener("blur",f),t.addEventListener("focus",u);navigator.userAgent.indexOf("MicroMessenger")>-1&&(t.onfocus=u);"onpageshow"in window&&"onpagehide"in window&&(t.addEventListener("pagehide",f),t.addEventListener("pageshow",u),document.addEventListener("pagehide",f),document.addEventListener("pageshow",u));this.on(i.EVENT_HIDE,function(){i.pause()});this.on(i.EVENT_SHOW,function(){i.resume()})}};r.call(i);cc.js.addon(i,r.prototype);cc.game=t.exports=i},{"../audio/CCAudioEngine":21,"../core/renderer/utils/dynamic-atlas/manager":229,"./CCDebug":26,"./event/event-target":142,"./renderer/index.js":226}],29:[function(n,t){"use strict";function et(n,t){var u;if(t){for(var f=0,r=null,i=n;i&&cc.Node.isNode(i);i=i._parent,++f)i.getComponent(t)&&(u={index:f,node:i},r?r.push(u):r=[u]);return r}return null}function ot(n,t){var i,u,r,f;if(!(n._objFlags&si)){if(n._bubblingListeners)for(i=0,u=t.length;i<u;++i)if(n._bubblingListeners.hasEventListener(t[i]))return!0;if(n._capturingListeners)for(r=0,f=t.length;r<f;++r)if(n._capturingListeners.hasEventListener(t[r]))return!0;return!1}return!0}function tr(n,t){var r,i;for(t.target=n,s.length=0,n._getCapturingTargets(t.type,s),t.eventPhase=1,i=s.length-1;i>=0;--i)if((r=s[i])._capturingListeners&&(t.currentTarget=r,r._capturingListeners.emit(t.type,t,s),t._propagationStopped))return void(s.length=0);if(s.length=0,t.eventPhase=2,t.currentTarget=n,n._capturingListeners&&n._capturingListeners.emit(t.type,t),!t._propagationImmediateStopped&&n._bubblingListeners&&n._bubblingListeners.emit(t.type,t),!t._propagationStopped&&t.bubbles)for(n._getBubblingTargets(t.type,s),t.eventPhase=3,i=0;i<s.length;++i)if((r=s[i])._bubblingListeners&&(t.currentTarget=r,r._bubblingListeners.emit(t.type,t),t._propagationStopped))return void(s.length=0);s.length=0}function yt(n){var t=n.groupIndex;return 0===t&&n.parent&&(t=yt(n.parent)),t}function pt(n){var i=yt(n),t;for(n._cullingMask=1<<i,t=0;t<n._children.length;t++)pt(n._children[t])}function ir(){var f,n;if(this._localMatDirty&u.TRSS){if(f=this._matrix,n=f.m,i.Trs.toMat4(f,this._trs),this._skewX||this._skewY){var e=n[0],o=n[1],s=n[4],h=n[5],t=Math.tan(this._skewX*v),r=Math.tan(this._skewY*v);t===1/0&&(t=99999999);r===1/0&&(r=99999999);n[0]=e+s*r;n[1]=o+h*r;n[4]=s+e*t;n[5]=h+o*t}this._localMatDirty&=~u.TRSS;this._worldMatDirty=!0}}function ui(){var c=this._localMatDirty,n,t,h;if(c&u.TRSS){if(n=this._matrix.m,t=this._trs,c&(u.RS|u.SKEW)){var f=-this._eulerAngles.z,l=this._skewX||this._skewY,e=t[7],o=t[8];if(f||l){var a=1,y=0,s=0,p=1;if(f&&(h=f*v,s=Math.sin(h),a=p=Math.cos(h),y=-s),n[0]=a*=e,n[1]=y*=e,n[4]=s*=o,n[5]=p*=o,l){var w=n[0],b=n[1],k=n[4],d=n[5],i=Math.tan(this._skewX*v),r=Math.tan(this._skewY*v);i===1/0&&(i=99999999);r===1/0&&(r=99999999);n[0]=w+k*r;n[1]=b+d*r;n[4]=k+w*i;n[5]=d+b*i}}else n[0]=e,n[1]=0,n[4]=0,n[5]=o}n[12]=t[0];n[13]=t[1];this._localMatDirty&=~u.TRSS;this._worldMatDirty=!0}}function rr(){if(this._localMatDirty&u.TRSS&&this._updateLocalMatrix(),this._parent){var n=this._parent._worldMatrix;i.Mat4.mul(this._worldMatrix,n,this._matrix)}else i.Mat4.copy(this._worldMatrix,this._matrix);this._worldMatDirty=!1}function ur(){this._localMatDirty&u.TRSS&&this._updateLocalMatrix();var n=this._parent;n?this._mulMat(this._worldMatrix,n._worldMatrix,this._matrix):i.Mat4.copy(this._worldMatrix,this._matrix);this._worldMatDirty=!1}function fi(n,t,i){var u=t.m,f=i.m,r=n.m,e=u[0],s=u[1],h=u[4],o=u[5],w=u[12],b=u[13],c=f[0],l=f[1],a=f[4],v=f[5],y=f[12],p=f[13];0!==s||0!==h?(r[0]=c*e+l*h,r[1]=c*s+l*o,r[4]=a*e+v*h,r[5]=a*s+v*o,r[12]=e*y+h*p+w,r[13]=s*y+o*p+b):(r[0]=c*e,r[1]=l*o,r[4]=a*e,r[5]=v*o,r[12]=e*y+w,r[13]=o*p+b)}var i=n("./value-types"),ei=n("./utils/base-node"),oi=n("./utils/prefab-helper"),bt=n("./utils/trans-pool").NodeMemPool,h=n("./utils/affine-transform"),e=n("./event-manager"),d=n("./platform/CCMacro"),ht=n("./platform/js"),b=(n("./event/event"),n("./event/event-target")),o=n("./renderer/render-flow"),si=cc.Object.Flags.Destroying,v=Math.PI/180,c=!!cc.ActionManager,y=function(){},g=new i.Vec3,kt=new i.Quat,nt=new i.Vec3,dt=new i.Vec3,gt=new i.Quat,ni=new i.Quat,ct=new i.Vec3,tt=new i.Vec3,k=new i.Vec3,hi=new i.Vec3,it=new i.Vec3,ci=new i.Quat,lt=new i.Quat,p=new i.Vec3,ti=new i.Quat,at=new i.Vec3,vt=new i.Quat,li=new i.Vec3,ai=new i.Vec3,rt=new i.Quat,a=new i.Quat,f=(new i.Quat,cc.mat4()),w=new i.Vec3,s=new Array(16);s.length=0;var vi=cc.Enum({DEBUG:31}),u=cc.Enum({POSITION:1,SCALE:2,ROTATION:4,SKEW:8,TRS:7,RS:6,TRSS:15,PHYSICS_POSITION:16,PHYSICS_SCALE:32,PHYSICS_ROTATION:64,PHYSICS_TRS:112,PHYSICS_RS:96,ALL_POSITION:17,ALL_SCALE:34,ALL_ROTATION:68,ALL_TRS:119,ALL:65535}),r=cc.Enum({TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_UP:"mouseup",MOUSE_WHEEL:"mousewheel",POSITION_CHANGED:"position-changed",ROTATION_CHANGED:"rotation-changed",SCALE_CHANGED:"scale-changed",SIZE_CHANGED:"size-changed",ANCHOR_CHANGED:"anchor-changed",COLOR_CHANGED:"color-changed",CHILD_ADDED:"child-added",CHILD_REMOVED:"child-removed",CHILD_REORDER:"child-reorder",GROUP_CHANGED:"group-changed",SIBLING_ORDER_CHANGED:"sibling-order-changed"}),ut=[r.TOUCH_START,r.TOUCH_MOVE,r.TOUCH_END,r.TOUCH_CANCEL],ft=[r.MOUSE_DOWN,r.MOUSE_ENTER,r.MOUSE_MOVE,r.MOUSE_LEAVE,r.MOUSE_UP,r.MOUSE_WHEEL],ii=!0,ri=function(n){0!==n&&(ii&&cc.warn("`cc.Node.skewX/Y` is deprecated since v2.2.1, please use 3D node instead.",""),ii=!1)},l=null,yi=function(n,t){var u=n.getLocation(),i=this.owner;return!!i._hitTest(u,this)&&(t.type=r.TOUCH_START,t.touch=n,t.bubbles=!0,i.dispatchEvent(t),!0)},pi=function(n,t){var i=this.owner;t.type=r.TOUCH_MOVE;t.touch=n;t.bubbles=!0;i.dispatchEvent(t)},wi=function(n,t){var u=n.getLocation(),i=this.owner;t.type=i._hitTest(u,this)?r.TOUCH_END:r.TOUCH_CANCEL;t.touch=n;t.bubbles=!0;i.dispatchEvent(t)},bi=function(n,t){n.getLocation();var i=this.owner;t.type=r.TOUCH_CANCEL;t.touch=n;t.bubbles=!0;i.dispatchEvent(t)},ki=function(n){var i=n.getLocation(),t=this.owner;t._hitTest(i,this)&&(n.type=r.MOUSE_DOWN,n.bubbles=!0,t.dispatchEvent(n))},di=function(n){var i=n.getLocation(),t=this.owner;if(t._hitTest(i,this))this._previousIn||(l&&l._mouseListener&&(n.type=r.MOUSE_LEAVE,l.dispatchEvent(n),l._mouseListener._previousIn=!1),l=this.owner,n.type=r.MOUSE_ENTER,t.dispatchEvent(n),this._previousIn=!0),n.type=r.MOUSE_MOVE,n.bubbles=!0,t.dispatchEvent(n);else{if(!this._previousIn)return;n.type=r.MOUSE_LEAVE;t.dispatchEvent(n);this._previousIn=!1;l=null}n.stopPropagation()},gi=function(n){var i=n.getLocation(),t=this.owner;t._hitTest(i,this)&&(n.type=r.MOUSE_UP,n.bubbles=!0,t.dispatchEvent(n),n.stopPropagation())},nr=function(n){var i=n.getLocation(),t=this.owner;t._hitTest(i,this)&&(n.type=r.MOUSE_WHEEL,n.bubbles=!0,t.dispatchEvent(n),n.stopPropagation())};var fr=i.Mat4.mul,er={name:"cc.Node","extends":ei,properties:{_opacity:255,_color:cc.Color.WHITE,_contentSize:cc.Size,_anchorPoint:cc.v2(.5,.5),_position:void 0,_scale:void 0,_trs:null,_eulerAngles:cc.Vec3,_skewX:0,_skewY:0,_zIndex:{"default":void 0,type:cc.Integer},_localZOrder:{"default":0,serializable:!1},_is3DNode:!1,_groupIndex:{"default":0,formerlySerializedAs:"groupIndex"},groupIndex:{get:function(){return this._groupIndex},set:function(n){this._groupIndex=n;pt(this);this.emit(r.GROUP_CHANGED,this)}},group:{get:function(){return cc.game.groupList[this.groupIndex]||""},set:function(n){this.groupIndex=cc.game.groupList.indexOf(n)}},x:{get:function(){return this._trs[0]},set:function(n){var t=this._trs;n!==t[0]&&(t[0]=n,this.setLocalDirty(u.ALL_POSITION),1&this._eventMask&&this.emit(r.POSITION_CHANGED))}},y:{get:function(){return this._trs[1]},set:function(n){var t=this._trs;n!==t[1]&&(t[1]=n,this.setLocalDirty(u.ALL_POSITION),1&this._eventMask&&this.emit(r.POSITION_CHANGED))}},z:{get:function(){return this._trs[2]},set:function(n){var t=this._trs;n!==t[2]&&(t[2]=n,this.setLocalDirty(u.ALL_POSITION),this._renderFlag|=o.FLAG_WORLD_TRANSFORM,1&this._eventMask&&this.emit(r.POSITION_CHANGED))}},rotation:{get:function(){return-this.angle},set:function(n){this.angle=-n}},angle:{get:function(){return this._eulerAngles.z},set:function(n){i.Vec3.set(this._eulerAngles,0,0,n);i.Trs.fromAngleZ(this._trs,n);this.setLocalDirty(u.ALL_ROTATION);4&this._eventMask&&this.emit(r.ROTATION_CHANGED)}},rotationX:{get:function(){return this._eulerAngles.x},set:function(n){this._eulerAngles.x!==n&&(this._eulerAngles.x=n,this._eulerAngles.x===this._eulerAngles.y?i.Trs.fromAngleZ(this._trs,-n):i.Trs.fromEulerNumber(this._trs,n,this._eulerAngles.y,0),this.setLocalDirty(u.ALL_ROTATION),4&this._eventMask&&this.emit(r.ROTATION_CHANGED))}},rotationY:{get:function(){return this._eulerAngles.y},set:function(n){this._eulerAngles.y!==n&&(this._eulerAngles.y=n,this._eulerAngles.x===this._eulerAngles.y?i.Trs.fromAngleZ(this._trs,-n):i.Trs.fromEulerNumber(this._trs,this._eulerAngles.x,n,0),this.setLocalDirty(u.ALL_ROTATION),4&this._eventMask&&this.emit(r.ROTATION_CHANGED))}},eulerAngles:{get:function(){return i.Trs.toEuler(this._eulerAngles,this._trs)},set:function(n){i.Trs.fromEuler(this._trs,n);this.setLocalDirty(u.ALL_ROTATION);this._renderFlag|=o.FLAG_TRANSFORM;4&this._eventMask&&this.emit(r.ROTATION_CHANGED)}},quat:{get:function(){var n=this._trs;return new i.Quat(n[3],n[4],n[5],n[6])},set:function(n){this.setRotation(n)}},scale:{get:function(){return this._trs[7]},set:function(n){this.setScale(n)}},scaleX:{get:function(){return this._trs[7]},set:function(n){this._trs[7]!==n&&(this._trs[7]=n,this.setLocalDirty(u.ALL_SCALE),2&this._eventMask&&this.emit(r.SCALE_CHANGED))}},scaleY:{get:function(){return this._trs[8]},set:function(n){this._trs[8]!==n&&(this._trs[8]=n,this.setLocalDirty(u.ALL_SCALE),2&this._eventMask&&this.emit(r.SCALE_CHANGED))}},scaleZ:{get:function(){return this._trs[9]},set:function(n){this._trs[9]!==n&&(this._trs[9]=n,this.setLocalDirty(u.ALL_SCALE),this._renderFlag|=o.FLAG_TRANSFORM,2&this._eventMask&&this.emit(r.SCALE_CHANGED))}},skewX:{get:function(){return this._skewX},set:function(n){ri(n);this._skewX=n;this.setLocalDirty(u.SKEW)}},skewY:{get:function(){return this._skewY},set:function(n){ri(n);this._skewY=n;this.setLocalDirty(u.SKEW)}},opacity:{get:function(){return this._opacity},set:function(n){n=cc.misc.clampf(n,0,255);this._opacity!==n&&(this._opacity=n,this._renderFlag|=o.FLAG_OPACITY_COLOR)},range:[0,255]},color:{get:function(){return this._color.clone()},set:function(n){this._color.equals(n)||(this._color.set(n),this._renderFlag|=o.FLAG_COLOR,32&this._eventMask&&this.emit(r.COLOR_CHANGED,n))}},anchorX:{get:function(){return this._anchorPoint.x},set:function(n){var t=this._anchorPoint;t.x!==n&&(t.x=n,16&this._eventMask&&this.emit(r.ANCHOR_CHANGED))}},anchorY:{get:function(){return this._anchorPoint.y},set:function(n){var t=this._anchorPoint;t.y!==n&&(t.y=n,16&this._eventMask&&this.emit(r.ANCHOR_CHANGED))}},width:{get:function(){return this._contentSize.width},set:function(n){n!==this._contentSize.width&&(this._contentSize.width=n,8&this._eventMask&&this.emit(r.SIZE_CHANGED))}},height:{get:function(){return this._contentSize.height},set:function(n){n!==this._contentSize.height&&(this._contentSize.height=n,8&this._eventMask&&this.emit(r.SIZE_CHANGED))}},zIndex:{get:function(){return this._localZOrder>>16},set:function(n){n>d.MAX_ZINDEX?(cc.warnID(1636),n=d.MAX_ZINDEX):n<d.MIN_ZINDEX&&(cc.warnID(1637),n=d.MIN_ZINDEX);this.zIndex!==n&&(this._localZOrder=65535&this._localZOrder|n<<16,this.emit(r.SIBLING_ORDER_CHANGED),this._onSiblingIndexChanged())}},is3DNode:{get:function(){return this._is3DNode},set:function(n){this._is3DNode=n;this._update3DFunction()}},up:{get:function(){return i.Vec3.transformQuat(at,i.Vec3.UP,this.getWorldRotation(vt)).clone()}},right:{get:function(){return i.Vec3.transformQuat(at,i.Vec3.RIGHT,this.getWorldRotation(vt)).clone()}},forward:{get:function(){return i.Vec3.transformQuat(at,i.Vec3.FORWARD,this.getWorldRotation(vt)).clone()}}},ctor:function(){this._reorderChildDirty=!1;this._widget=null;this._renderComponent=null;this._capturingListeners=null;this._bubblingListeners=null;this._touchListener=null;this._mouseListener=null;this._initDataFromPool();this._eventMask=0;this._cullingMask=1;this._childArrivalOrder=1;this._renderFlag=o.FLAG_TRANSFORM|o.FLAG_OPACITY_COLOR},statics:{EventType:r,_LocalDirtyFlag:u,isNode:function(n){return n instanceof st&&(n.constructor===st||!(n instanceof cc.Scene))},BuiltinGroupIndex:vi},_onSiblingIndexChanged:function(){this._parent&&this._parent._delaySort()},_onPreDestroy:function(){this._onPreDestroyBase();c&&cc.director.getActionManager().removeAllActionsFromTarget(this);l===this&&(l=null);this._bubblingListeners&&this._bubblingListeners.clear();this._capturingListeners&&this._capturingListeners.clear();(this._touchListener||this._mouseListener)&&(e.removeListeners(this),this._touchListener&&(this._touchListener.owner=null,this._touchListener.mask=null,this._touchListener=null),this._mouseListener&&(this._mouseListener.owner=null,this._mouseListener.mask=null,this._mouseListener=null));this._backDataIntoPool();this._reorderChildDirty&&cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)},_onPostActivated:function(n){var t=c?cc.director.getActionManager():null;n?(this._renderFlag|=o.FLAG_WORLD_TRANSFORM,t&&t.resumeTarget(this),e.resumeTarget(this),this._checkListenerMask()):(t&&t.pauseTarget(this),e.pauseTarget(this))},_onHierarchyChanged:function(n){this._updateOrderOfArrival();pt(this);this._parent&&this._parent._delaySort();this._renderFlag|=o.FLAG_WORLD_TRANSFORM;this._onHierarchyChangedBase(n);cc._widgetManager&&(cc._widgetManager._nodesOrderDirty=!0);n&&this._activeInHierarchy&&this._checkListenerMask()},_update3DFunction:function(){this._is3DNode?(this._updateLocalMatrix=ir,this._calculWorldMatrix=rr,this._mulMat=fr):(this._updateLocalMatrix=ui,this._calculWorldMatrix=ur,this._mulMat=fi);this._renderComponent&&this._renderComponent._on3DNodeChanged&&this._renderComponent._on3DNodeChanged();this._renderFlag|=o.FLAG_TRANSFORM;this._localMatDirty=u.ALL},_initDataFromPool:function(){var t,n;this._spaceInfo||(this._spaceInfo=bt.pop());t=this._spaceInfo;this._matrix=cc.mat4(t.localMat);i.Mat4.identity(this._matrix);this._worldMatrix=cc.mat4(t.worldMat);i.Mat4.identity(this._worldMatrix);this._localMatDirty=u.ALL;this._worldMatDirty=!0;n=this._trs=t.trs;n[0]=0;n[1]=0;n[2]=0;n[3]=0;n[4]=0;n[5]=0;n[6]=1;n[7]=1;n[8]=1;n[9]=1},_backDataIntoPool:function(){bt.push(this._spaceInfo);this._matrix=null;this._worldMatrix=null;this._trs=null;this._spaceInfo=null},_toEuler:function(){if(this.is3DNode)i.Trs.toEuler(this._eulerAngles,this._trs);else{var n=Math.asin(this._trs[5])/v*2;i.Vec3.set(this._eulerAngles,0,0,n)}},_fromEuler:function(){this.is3DNode?i.Trs.fromEuler(this._trs,this._eulerAngles):i.Trs.fromAngleZ(this._trs,this._eulerAngles.z)},_initProperties:function(){var n,t;this._is3DNode&&this._update3DFunction();n=this._trs;n?(t=n,n=this._trs=this._spaceInfo.trs,11===t.length?n.set(t.subarray(1)):n.set(t)):n=this._trs=this._spaceInfo.trs;this._fromEuler()},_onBatchCreated:function(n){var t,i;this._initProperties();this._cullingMask=1<<yt(this);this._activeInHierarchy||(c&&cc.director.getActionManager().pauseTarget(this),e.pauseTarget(this));for(var r=this._children,u=0,f=r.length;u<f;u++)t=r[u],n||(i=t._prefab,i&&i.sync&&i.root===t&&oi.syncWithPrefab(t),t._updateOrderOfArrival()),t._onBatchCreated(n);r.length>0&&(this._renderFlag|=o.FLAG_CHILDREN)},_checkListenerMask:function(){if(this._touchListener){var n=this._touchListener.mask=et(this,cc.Mask);this._mouseListener&&(this._mouseListener.mask=n)}else this._mouseListener&&(this._mouseListener.mask=et(this,cc.Mask))},_checknSetupSysEvent:function(n){var t=!1,i=!1;return-1!==ut.indexOf(n)?(this._touchListener||(this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,owner:this,mask:et(this,cc.Mask),onTouchBegan:yi,onTouchMoved:pi,onTouchEnded:wi,onTouchCancelled:bi}),e.addListener(this._touchListener,this),t=!0),i=!0):-1!==ft.indexOf(n)&&(this._mouseListener||(this._mouseListener=cc.EventListener.create({event:cc.EventListener.MOUSE,_previousIn:!1,owner:this,mask:et(this,cc.Mask),onMouseDown:ki,onMouseMove:di,onMouseUp:gi,onMouseScroll:nr}),e.addListener(this._mouseListener,this),t=!0),i=!0),t&&!this._activeInHierarchy&&cc.director.getScheduler().schedule(function(){this._activeInHierarchy||e.pauseTarget(this)},this,0,0,0,!1),i},on:function(n,t,i,u){if(this._checknSetupSysEvent(n))return this._onDispatch(n,t,i,u);switch(n){case r.POSITION_CHANGED:this._eventMask|=1;break;case r.SCALE_CHANGED:this._eventMask|=2;break;case r.ROTATION_CHANGED:this._eventMask|=4;break;case r.SIZE_CHANGED:this._eventMask|=8;break;case r.ANCHOR_CHANGED:this._eventMask|=16;break;case r.COLOR_CHANGED:this._eventMask|=32}return this._bubblingListeners||(this._bubblingListeners=new b),this._bubblingListeners.on(n,t,i)},once:function(n,t,i,r){var f=this,u=null;(u=this._checknSetupSysEvent(n)&&r?this._capturingListeners=this._capturingListeners||new b:this._bubblingListeners=this._bubblingListeners||new b).once(n,t,i);u.once(n,function(){f.off(n,t,i)},void 0)},_onDispatch:function(n,t,i,r){if("boolean"==typeof i?(r=i,i=void 0):r=!!r,t){var u=null;return(u=r?this._capturingListeners=this._capturingListeners||new b:this._bubblingListeners=this._bubblingListeners||new b).hasEventListener(n,t,i)||(u.on(n,t,i),i&&i.__eventTargets&&i.__eventTargets.push(this)),t}cc.errorID(6800)},off:function(n,t,i,u){var f=-1!==ut.indexOf(n),o=!f&&-1!==ft.indexOf(n);if(f||o)this._offDispatch(n,t,i,u),f?this._touchListener&&!ot(this,ut)&&(e.removeListener(this._touchListener),this._touchListener=null):o&&this._mouseListener&&!ot(this,ft)&&(e.removeListener(this._mouseListener),this._mouseListener=null);else if(this._bubblingListeners&&(this._bubblingListeners.off(n,t,i),!this._bubblingListeners.hasEventListener(n)))switch(n){case r.POSITION_CHANGED:this._eventMask&=-2;break;case r.SCALE_CHANGED:this._eventMask&=-3;break;case r.ROTATION_CHANGED:this._eventMask&=-5;break;case r.SIZE_CHANGED:this._eventMask&=-9;break;case r.ANCHOR_CHANGED:this._eventMask&=-17;break;case r.COLOR_CHANGED:this._eventMask&=-33}},_offDispatch:function(n,t,i,r){if("boolean"==typeof i?(r=i,i=void 0):r=!!r,t){var u=r?this._capturingListeners:this._bubblingListeners;u&&(u.off(n,t,i),i&&i.__eventTargets&&ht.array.fastRemove(i.__eventTargets,this))}else this._capturingListeners&&this._capturingListeners.removeAll(n),this._bubblingListeners&&this._bubblingListeners.removeAll(n)},targetOff:function(n){var t=this._bubblingListeners;t&&(t.targetOff(n),1&this._eventMask&&!t.hasEventListener(r.POSITION_CHANGED)&&(this._eventMask&=-2),2&this._eventMask&&!t.hasEventListener(r.SCALE_CHANGED)&&(this._eventMask&=-3),4&this._eventMask&&!t.hasEventListener(r.ROTATION_CHANGED)&&(this._eventMask&=-5),8&this._eventMask&&!t.hasEventListener(r.SIZE_CHANGED)&&(this._eventMask&=-9),16&this._eventMask&&!t.hasEventListener(r.ANCHOR_CHANGED)&&(this._eventMask&=-17),32&this._eventMask&&!t.hasEventListener(r.COLOR_CHANGED)&&(this._eventMask&=-33));this._capturingListeners&&this._capturingListeners.targetOff(n);n&&n.__eventTargets&&ht.array.fastRemove(n.__eventTargets,this);this._touchListener&&!ot(this,ut)&&(e.removeListener(this._touchListener),this._touchListener=null);this._mouseListener&&!ot(this,ft)&&(e.removeListener(this._mouseListener),this._mouseListener=null)},hasEventListener:function(n){var t=!1;return this._bubblingListeners&&(t=this._bubblingListeners.hasEventListener(n)),!t&&this._capturingListeners&&(t=this._capturingListeners.hasEventListener(n)),t},emit:function(n,t,i,r,u,f){this._bubblingListeners&&this._bubblingListeners.emit(n,t,i,r,u,f)},dispatchEvent:function(n){tr(this,n);s.length=0},pauseSystemEvents:function(n){e.pauseTarget(this,n)},resumeSystemEvents:function(n){e.resumeTarget(this,n)},_hitTest:function(n,t){var v=this._contentSize.width,y=this._contentSize.height,s=li,r=ai,p=cc.Camera.findCamera(this),h,c,l;if(p?p.getScreenToWorldPoint(n,s):s.set(n),this._updateWorldMatrix(),!i.Mat4.invert(f,this._worldMatrix))return!1;if(i.Vec2.transformMat4(r,s,f),r.x+=this._anchorPoint.x*v,r.y+=this._anchorPoint.y*y,h=!1,r.x>=0&&r.y>=0&&r.x<=v&&r.y<=y&&(h=!0,t&&t.mask))for(var u=t.mask,e=this,w=u?u.length:0,a=0,o=0;e&&o<w;++a,e=e.parent)if(c=u[o],a===c.index){if(e!==c.node){u.length=o;break}if(l=e.getComponent(cc.Mask),l&&l._enabled&&!l._hitTest(s)){h=!1;break}o++}else if(a>c.index){u.length=o;break}return h},_getCapturingTargets:function(n,t){for(var i=this.parent;i;)i._capturingListeners&&i._capturingListeners.hasEventListener(n)&&t.push(i),i=i.parent},_getBubblingTargets:function(n,t){for(var i=this.parent;i;)i._bubblingListeners&&i._bubblingListeners.hasEventListener(n)&&t.push(i),i=i.parent},runAction:c?function(n){if(this.active){cc.assertID(n,1618);var t=cc.director.getActionManager();return t._suppressDeprecation||(t._suppressDeprecation=!0,cc.warnID(1639)),t.addAction(n,this,!1),n}}:y,pauseAllActions:c?function(){cc.director.getActionManager().pauseTarget(this)}:y,resumeAllActions:c?function(){cc.director.getActionManager().resumeTarget(this)}:y,stopAllActions:c?function(){cc.director.getActionManager().removeAllActionsFromTarget(this)}:y,stopAction:c?function(n){cc.director.getActionManager().removeAction(n)}:y,stopActionByTag:c?function(n){n!==cc.Action.TAG_INVALID?cc.director.getActionManager().removeActionByTag(n,this):cc.logID(1612)}:y,getActionByTag:c?function(n){return n===cc.Action.TAG_INVALID?(cc.logID(1613),null):cc.director.getActionManager().getActionByTag(n,this)}:function(){return null},getNumberOfRunningActions:c?function(){return cc.director.getActionManager().getNumberOfRunningActionsInTarget(this)}:function(){return 0},getPosition:function(n){return n=n||new i.Vec3,i.Trs.toPosition(n,this._trs)},setPosition:function(n,t,i){var e,f;void 0===t?(e=n.x,t=n.y,i=n.z):e=n;f=this._trs;void 0===i&&(i=f[2]);(f[0]!==e||f[1]!==t||f[2]!==i)&&(f[0]=e,f[1]=t,f[2]=i,this.setLocalDirty(u.ALL_POSITION),this._renderFlag|=o.FLAG_WORLD_TRANSFORM,1&this._eventMask&&this.emit(r.POSITION_CHANGED))},getScale:function(n){return void 0!==n?i.Trs.toScale(n,this._trs):(cc.errorID(1400,"cc.Node.getScale","cc.Node.scale or cc.Node.getScale(cc.Vec3)"),this._trs[7])},setScale:function(n,t,i){var e,f;n&&"number"!=typeof n?(e=n.x,t=n.y,i=n.z):void 0!==n&&void 0===t?(e=n,t=n,i=n):e=n;f=this._trs;void 0===i&&(i=f[9]);f[7]===e&&f[8]===t&&f[9]===i||(f[7]=e,f[8]=t,f[9]=i,this.setLocalDirty(u.ALL_SCALE),this._renderFlag|=o.FLAG_TRANSFORM,2&this._eventMask&&this.emit(r.SCALE_CHANGED))},getRotation:function(n){return n instanceof i.Quat?i.Trs.toRotation(n,this._trs):-this.angle},setRotation:function(n,t,i,f){var o,e;"number"==typeof n&&void 0===t?this.angle=-n:(o=n,void 0===t&&(o=n.x,t=n.y,i=n.z,f=n.w),e=this._trs,e[3]===o&&e[4]===t&&e[5]===i&&e[6]===f||(e[3]=o,e[4]=t,e[5]=i,e[6]=f,this.setLocalDirty(u.ALL_ROTATION),4&this._eventMask&&this.emit(r.ROTATION_CHANGED)))},getContentSize:function(){return cc.size(this._contentSize.width,this._contentSize.height)},setContentSize:function(n,t){var i=this._contentSize;if(void 0===t){if(n.width===i.width&&n.height===i.height)return;i.width=n.width;i.height=n.height}else{if(n===i.width&&t===i.height)return;i.width=n;i.height=t}8&this._eventMask&&this.emit(r.SIZE_CHANGED)},getAnchorPoint:function(){return cc.v2(this._anchorPoint)},setAnchorPoint:function(n,t){var i=this._anchorPoint;if(void 0===t){if(n.x===i.x&&n.y===i.y)return;i.x=n.x;i.y=n.y}else{if(n===i.x&&t===i.y)return;i.x=n;i.y=t}this.setLocalDirty(u.ALL_POSITION);16&this._eventMask&&this.emit(r.ANCHOR_CHANGED)},_invTransformPoint:function(n,t){this._parent?this._parent._invTransformPoint(n,t):i.Vec3.copy(n,t);var r=this._trs;return i.Trs.toPosition(nt,r),i.Vec3.sub(n,n,nt),i.Trs.toRotation(gt,r),i.Quat.conjugate(ni,gt),i.Vec3.transformQuat(n,n,ni),i.Trs.toScale(nt,r),i.Vec3.inverseSafe(dt,nt),i.Vec3.mul(n,n,dt),n},getWorldPosition:function(n){i.Trs.toPosition(n,this._trs);for(var t,r=this._parent;r;)t=r._trs,i.Trs.toScale(g,t),i.Vec3.mul(n,n,g),i.Trs.toRotation(kt,t),i.Vec3.transformQuat(n,n,kt),i.Trs.toPosition(g,t),i.Vec3.add(n,n,g),r=r._parent;return n},setWorldPosition:function(n){var t=this._trs;this._parent?this._parent._invTransformPoint(ct,n):i.Vec3.copy(ct,n);i.Trs.fromPosition(t,ct);this.setLocalDirty(u.ALL_POSITION);1&this._eventMask&&this.emit(r.POSITION_CHANGED)},getWorldRotation:function(n){i.Trs.toRotation(rt,this._trs);i.Quat.copy(n,rt);for(var t=this._parent;t;)i.Trs.toRotation(rt,t._trs),i.Quat.mul(n,rt,n),t=t._parent;return n},setWorldRotation:function(n){this._parent?(this._parent.getWorldRotation(a),i.Quat.conjugate(a,a),i.Quat.mul(a,a,n)):i.Quat.copy(a,n);i.Trs.fromRotation(this._trs,a);this.setLocalDirty(u.ALL_ROTATION)},getWorldScale:function(n){i.Trs.toScale(tt,this._trs);i.Vec3.copy(n,tt);for(var t=this._parent;t;)i.Trs.toScale(tt,t._trs),i.Vec3.mul(n,n,tt),t=t._parent;return n},setWorldScale:function(n){this._parent?(this._parent.getWorldScale(k),i.Vec3.div(k,n,k)):i.Vec3.copy(k,n);i.Trs.fromScale(this._trs,k);this.setLocalDirty(u.ALL_SCALE)},getWorldRT:function(n){var t=hi,f=ci,r=this._trs,u;for(i.Trs.toPosition(t,r),i.Trs.toRotation(f,r),u=this._parent;u;)r=u._trs,i.Trs.toScale(it,r),i.Vec3.mul(t,t,it),i.Trs.toRotation(lt,r),i.Vec3.transformQuat(t,t,lt),i.Trs.toPosition(it,r),i.Vec3.add(t,t,it),i.Quat.mul(f,lt,f),u=u._parent;return i.Mat4.fromRT(n,f,t),n},lookAt:function(n,t){this.getWorldPosition(p);i.Vec3.sub(p,p,n);i.Vec3.normalize(p,p);i.Quat.fromViewUp(ti,p,t);this.setWorldRotation(ti)},_updateLocalMatrix:ui,_calculWorldMatrix:function(){this._localMatDirty&u.TRSS&&this._updateLocalMatrix();var n=this._parent;n?this._mulMat(this._worldMatrix,n._worldMatrix,this._matrix):i.Mat4.copy(this._worldMatrix,this._matrix);this._worldMatDirty=!1},_mulMat:fi,_updateWorldMatrix:function(){if(this._parent&&this._parent._updateWorldMatrix(),this._worldMatDirty){this._calculWorldMatrix();for(var t=this._children,n=0,i=t.length;n<i;n++)t[n]._worldMatDirty=!0}},setLocalDirty:function(n){this._localMatDirty|=n;this._worldMatDirty=!0;this._renderFlag|=n===u.ALL_POSITION||n===u.POSITION?o.FLAG_WORLD_TRANSFORM:o.FLAG_TRANSFORM},setWorldDirty:function(){this._worldMatDirty=!0},getLocalMatrix:function(n){return this._updateLocalMatrix(),i.Mat4.copy(n,this._matrix)},getWorldMatrix:function(n){return this._updateWorldMatrix(),i.Mat4.copy(n,this._worldMatrix)},convertToNodeSpaceAR:function(n,t){return this._updateWorldMatrix(),i.Mat4.invert(f,this._worldMatrix),n instanceof cc.Vec2?(t=t||new cc.Vec2,i.Vec2.transformMat4(t,n,f)):(t=t||new cc.Vec3,i.Vec3.transformMat4(t,n,f))},convertToWorldSpaceAR:function(n,t){return this._updateWorldMatrix(),n instanceof cc.Vec2?(t=t||new cc.Vec2,i.Vec2.transformMat4(t,n,this._worldMatrix)):(t=t||new cc.Vec3,i.Vec3.transformMat4(t,n,this._worldMatrix))},convertToNodeSpace:function(n){this._updateWorldMatrix();i.Mat4.invert(f,this._worldMatrix);var t=new cc.Vec2;return i.Vec2.transformMat4(t,n,f),t.x+=this._anchorPoint.x*this._contentSize.width,t.y+=this._anchorPoint.y*this._contentSize.height,t},convertToWorldSpace:function(n){this._updateWorldMatrix();var t=new cc.Vec2(n.x-this._anchorPoint.x*this._contentSize.width,n.y-this._anchorPoint.y*this._contentSize.height);return i.Vec2.transformMat4(t,t,this._worldMatrix)},getNodeToParentTransform:function(n){n||(n=h.identity());this._updateLocalMatrix();var t=this._contentSize;return w.x=-this._anchorPoint.x*t.width,w.y=-this._anchorPoint.y*t.height,i.Mat4.copy(f,this._matrix),i.Mat4.transform(f,f,w),h.fromMat4(n,f)},getNodeToParentTransformAR:function(n){return n||(n=h.identity()),this._updateLocalMatrix(),h.fromMat4(n,this._matrix)},getNodeToWorldTransform:function(n){n||(n=h.identity());this._updateWorldMatrix();var t=this._contentSize;return w.x=-this._anchorPoint.x*t.width,w.y=-this._anchorPoint.y*t.height,i.Mat4.copy(f,this._worldMatrix),i.Mat4.transform(f,f,w),h.fromMat4(n,f)},getNodeToWorldTransformAR:function(n){return n||(n=h.identity()),this._updateWorldMatrix(),h.fromMat4(n,this._worldMatrix)},getParentToNodeTransform:function(n){return n||(n=h.identity()),this._updateLocalMatrix(),i.Mat4.invert(f,this._matrix),h.fromMat4(n,f)},getWorldToNodeTransform:function(n){return n||(n=h.identity()),this._updateWorldMatrix(),i.Mat4.invert(f,this._worldMatrix),h.fromMat4(n,f)},convertTouchToNodeSpace:function(n){return this.convertToNodeSpace(n.getLocation())},convertTouchToNodeSpaceAR:function(n){return this.convertToNodeSpaceAR(n.getLocation())},getBoundingBox:function(){this._updateLocalMatrix();var n=this._contentSize.width,t=this._contentSize.height,i=cc.rect(-this._anchorPoint.x*n,-this._anchorPoint.y*t,n,t);return i.transformMat4(i,this._matrix)},getBoundingBoxToWorld:function(){return this._parent?(this._parent._updateWorldMatrix(),this._getBoundingBoxTo()):this.getBoundingBox()},_getBoundingBoxTo:function(){var f=this._contentSize.width,e=this._contentSize.height,n=cc.rect(-this._anchorPoint.x*f,-this._anchorPoint.y*e,f,e),r,t,i,u;if(this._calculWorldMatrix(),n.transformMat4(n,this._worldMatrix),!this._children)return n;for(r=this._children,t=0;t<r.length;t++)i=r[t],i&&i.active&&(u=i._getBoundingBoxTo(),u&&n.union(n,u));return n},_updateOrderOfArrival:function(){var n=this._parent?++this._parent._childArrivalOrder:0;this._localZOrder=4294901760&this._localZOrder|n;this.emit(r.SIBLING_ORDER_CHANGED)},addChild:function(n,t,i){cc.assertID(n,1606);cc.assertID(null===n._parent,1605);n.parent=this;void 0!==t&&(n.zIndex=t);void 0!==i&&(n.name=i)},cleanup:function(){c&&cc.director.getActionManager().removeAllActionsFromTarget(this);e.removeListeners(this);for(var t,i=this._children.length,n=0;n<i;++n)(t=this._children[n])&&t.cleanup()},sortAllChildren:function(){var n,u,o,f,s,i,h,t;if(this._reorderChildDirty){for(this._reorderChildDirty=!1,n=this._children,this._childArrivalOrder=1,u=0,o=n.length;u<o;u++)n[u]._updateOrderOfArrival();if(e._setDirtyForNode(this),n.length>1){for(i=1,h=n.length;i<h;i++){for(f=n[i],t=i;t>0&&(s=n[t-1])._localZOrder>f._localZOrder;t--)n[t]=s;n[t]=f}this.emit(r.CHILD_REORDER,this)}cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)}},_delaySort:function(){this._reorderChildDirty||(this._reorderChildDirty=!0,cc.director.__fastOn(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this))},_restoreProperties:!1,onRestore:!1},st=cc.Class(er),wt=st.prototype;ht.getset(wt,"position",wt.getPosition,wt.setPosition,!1,!0);cc.Node=t.exports=st},{"./event-manager":140,"./event/event":143,"./event/event-target":142,"./platform/CCMacro":200,"./platform/js":216,"./renderer/render-flow":227,"./utils/affine-transform":260,"./utils/base-node":261,"./utils/prefab-helper":272,"./utils/trans-pool":278,"./value-types":284}],30:[function(n,t){"use strict";var r=n("./CCNode"),f=n("./renderer/render-flow"),e=(cc.Object.Flags.HideInHierarchy,r._LocalDirtyFlag),u=cc.Class({name:"cc.PrivateNode","extends":r,properties:{x:{get:function(){return this._originPos.x},set:function(n){var t=this._originPos;n!==t.x&&(t.x=n,this._posDirty(!0))},override:!0},y:{get:function(){return this._originPos.y},set:function(n){var t=this._originPos;n!==t.y&&(t.y=n,this._posDirty(!0))},override:!0},zIndex:{get:function(){return cc.macro.MIN_ZINDEX},set:function(){},override:!0},showInEditor:{"default":!1,editorOnly:!0,override:!0}},ctor:function(){this._localZOrder=cc.macro.MIN_ZINDEX<<16;this._originPos=cc.v2()},_posDirty:function(n){this.setLocalDirty(e.POSITION);this._renderFlag|=f.FLAG_TRANSFORM;!0===n&&1&this._eventMask&&this.emit(r.EventType.POSITION_CHANGED)},_updateLocalMatrix:function(){if(this._localMatDirty){var n=this.parent;n&&(this._trs[0]=this._originPos.x-(n._anchorPoint.x-.5)*n._contentSize.width,this._trs[1]=this._originPos.y-(n._anchorPoint.y-.5)*n._contentSize.height);this._super()}},getPosition:function(){return new cc.Vec2(this._originPos)},setPosition:function(n,t){void 0===t&&(t=(n=n.x).y);var i=this._originPos;i.x===n&&i.y===t||(i.x=n,i.y=t,this._posDirty(!0))},setParent:function(n){var t=this._parent;this._super(n);t!==n&&(t&&t.off(r.EventType.ANCHOR_CHANGED,this._posDirty,this),n&&n.on(r.EventType.ANCHOR_CHANGED,this._posDirty,this))},_updateOrderOfArrival:function(){}}),i=u.prototype;cc.js.getset(i,"parent",i.getParent,i.setParent);cc.js.getset(i,"position",i.getPosition,i.setPosition);cc.PrivateNode=t.exports=u},{"./CCNode":29,"./renderer/render-flow":227}],31:[function(n,t){"use strict";cc.Scene=cc.Class({name:"cc.Scene","extends":n("./CCNode"),properties:{_is3DNode:{"default":!0,override:!0},autoReleaseAssets:!1},ctor:function(){this._anchorPoint.x=0;this._anchorPoint.y=0;this._activeInHierarchy=!1;this._inited=!cc.game._isCloning;this.dependAssets=null},destroy:function(){if(cc.Object.prototype.destroy.call(this))for(var t=this._children,n=0;n<t.length;++n)t[n].active=!1;this._active=!1;this._activeInHierarchy=!1},_onHierarchyChanged:function(){},_instantiate:null,_load:function(){this._inited||(this._onBatchCreated(!1),this._inited=!0)},_activate:function(n){n=!1!==n;cc.director._nodeActivator.activateNode(this,n)}});t.exports=cc.Scene},{"./CCNode":29}],32:[function(n,t){"use strict";function r(){this._lock=!1;this._scheduler=null;this._elapsed=-1;this._runForever=!1;this._useDelay=!1;this._timesExecuted=0;this._repeat=0;this._delay=0;this._interval=0;this._target=null;this._callback=null}var l=n("./platform/js"),a=new(n("./platform/id-generater"))("Scheduler"),e=function(n,t,i,r){this.target=n;this.priority=t;this.paused=i;this.markedForDeletion=r},c=[],u,o,f,s,i,h;e.get=function(n,t,i,r){var u=c.pop();return u?(u.target=n,u.priority=t,u.paused=i,u.markedForDeletion=r):u=new e(n,t,i,r),u};e.put=function(n){c.length<20&&(n.target=null,c.push(n))};u=function(n,t,i,r){this.list=n;this.entry=t;this.target=i;this.callback=r};o=[];u.get=function(n,t,i,r){var f=o.pop();return f?(f.list=n,f.entry=t,f.target=i,f.callback=r):f=new u(n,t,i,r),f};u.put=function(n){o.length<20&&(n.list=n.entry=n.target=n.callback=null,o.push(n))};f=function(n,t,i,r,u,f){var e=this;e.timers=n;e.target=t;e.timerIndex=i;e.currentTimer=r;e.currentTimerSalvaged=u;e.paused=f};s=[];f.get=function(n,t,i,r,u,e){var o=s.pop();return o?(o.timers=n,o.target=t,o.timerIndex=i,o.currentTimer=r,o.currentTimerSalvaged=u,o.paused=e):o=new f(n,t,i,r,u,e),o};f.put=function(n){s.length<20&&(n.timers=n.target=n.currentTimer=null,s.push(n))};i=r.prototype;i.initWithCallback=function(n,t,i,r,u,f){return this._lock=!1,this._scheduler=n,this._target=i,this._callback=t,this._elapsed=-1,this._interval=r,this._delay=f,this._useDelay=this._delay>0,this._repeat=u,this._runForever=this._repeat===cc.macro.REPEAT_FOREVER,!0};i.getInterval=function(){return this._interval};i.setInterval=function(n){this._interval=n};i.update=function(n){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=n,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))};i.getCallback=function(){return this._callback};i.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)};i.cancel=function(){this._scheduler.unschedule(this._callback,this._target)};h=[];r.get=function(){return h.pop()||new r};r.put=function(n){h.length<20&&!n._lock&&(n._scheduler=n._target=n._callback=null,h.push(n))};cc.Scheduler=function(){this._timeScale=1;this._updatesNegList=[];this._updates0List=[];this._updatesPosList=[];this._hashForUpdates=l.createMap(!0);this._hashForTimers=l.createMap(!0);this._currentTarget=null;this._currentTargetSalvaged=!1;this._updateHashLocked=!1;this._arrayForTimers=[]};cc.Scheduler.prototype={constructor:cc.Scheduler,_removeHashElement:function(n){delete this._hashForTimers[n.target._id];for(var i=this._arrayForTimers,t=0,r=i.length;t<r;t++)if(i[t]===n){i.splice(t,1);break}f.put(n)},_removeUpdateFromHash:function(n){var f=n.target._id,t=this._hashForUpdates[f];if(t){for(var r=t.list,o=t.entry,i=0,s=r.length;i<s;i++)if(r[i]===o){r.splice(i,1);break}delete this._hashForUpdates[f];e.put(o);u.put(t)}},_priorityIn:function(n,t,i){for(var r=0;r<n.length;r++)if(i<n[r].priority)return void n.splice(r,0,t);n.push(t)},_appendIn:function(n,t){n.push(t)},enableForTarget:function(n){n._id||(n.__instanceId?cc.warnID(1513):n._id=a.getNewId())},setTimeScale:function(n){this._timeScale=n},getTimeScale:function(){return this._timeScale},update:function(n){var t,i,f,r,u,e;for(this._updateHashLocked=!0,1!==this._timeScale&&(n*=this._timeScale),t=0,f=(i=this._updatesNegList).length;t<f;t++)(r=i[t]).paused||r.markedForDeletion||r.target.update(n);for(t=0,f=(i=this._updates0List).length;t<f;t++)(r=i[t]).paused||r.markedForDeletion||r.target.update(n);for(t=0,f=(i=this._updatesPosList).length;t<f;t++)(r=i[t]).paused||r.markedForDeletion||r.target.update(n);for(e=this._arrayForTimers,t=0;t<e.length;t++){if(u=e[t],this._currentTarget=u,this._currentTargetSalvaged=!1,!u.paused)for(u.timerIndex=0;u.timerIndex<u.timers.length;++u.timerIndex)u.currentTimer=u.timers[u.timerIndex],u.currentTimerSalvaged=!1,u.currentTimer.update(n),u.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--t)}for(t=0,i=this._updatesNegList;t<i.length;)(r=i[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;for(t=0,i=this._updates0List;t<i.length;)(r=i[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;for(t=0,i=this._updatesPosList;t<i.length;)(r=i[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;this._updateHashLocked=!1;this._currentTarget=null},schedule:function(n,t,i,u,e,o){var a,c,h,l,s;if("function"!=typeof n&&(a=n,n=t,t=a),4!==arguments.length&&5!==arguments.length||(o=!!u,u=cc.macro.REPEAT_FOREVER,e=0),cc.assertID(t,1502),c=t._id,c||(t.__instanceId?(cc.warnID(1513),c=t._id=t.__instanceId):cc.errorID(1510)),s=this._hashForTimers[c],s?s.paused!==o&&cc.warnID(1511):(s=f.get(null,t,0,null,null,o),this._arrayForTimers.push(s),this._hashForTimers[c]=s),null==s.timers)s.timers=[];else for(l=0;l<s.timers.length;++l)if((h=s.timers[l])&&n===h._callback)return cc.logID(1507,h.getInterval(),i),void(h._interval=i);(h=r.get()).initWithCallback(this,n,t,i,u,e);s.timers.push(h);this._currentTarget===s&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)},scheduleUpdate:function(n,t,i){var o=n._id,r,f,s;if(o||(n.__instanceId?(cc.warnID(1513),o=n._id=n.__instanceId):cc.errorID(1510)),r=this._hashForUpdates[o],r&&r.entry){if(r.entry.priority===t)return r.entry.markedForDeletion=!1,void(r.entry.paused=i);if(this._updateHashLocked)return cc.logID(1506),r.entry.markedForDeletion=!1,void(r.entry.paused=i);this.unscheduleUpdate(n)}s=e.get(n,t,i,!1);0===t?(f=this._updates0List,this._appendIn(f,s)):(f=t<0?this._updatesNegList:this._updatesPosList,this._priorityIn(f,s,t));this._hashForUpdates[o]=u.get(f,s,n,null)},unschedule:function(n,t){var f,i,o;if(t&&n&&(f=t._id,f||(t.__instanceId?(cc.warnID(1513),f=t._id=t.__instanceId):cc.errorID(1510)),i=this._hashForTimers[f],i))for(var e=i.timers,u=0,s=e.length;u<s;u++)if(o=e[u],n===o._callback)return o!==i.currentTimer||i.currentTimerSalvaged||(i.currentTimerSalvaged=!0),e.splice(u,1),r.put(o),i.timerIndex>=u&&i.timerIndex--,void(0===e.length&&(this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)))},unscheduleUpdate:function(n){var t,i;n&&(t=n._id,t||(n.__instanceId?(cc.warnID(1513),t=n._id=n.__instanceId):cc.errorID(1510)),i=this._hashForUpdates[t],i&&(this._updateHashLocked?i.entry.markedForDeletion=!0:this._removeUpdateFromHash(i.entry)))},unscheduleAllForTarget:function(n){var u,t,i,f,e;if(n){if(u=n._id,u||(n.__instanceId?(cc.warnID(1513),u=n._id=n.__instanceId):cc.errorID(1510)),t=this._hashForTimers[u],t){for(i=t.timers,i.indexOf(t.currentTimer)>-1&&!t.currentTimerSalvaged&&(t.currentTimerSalvaged=!0),f=0,e=i.length;f<e;f++)r.put(i[f]);i.length=0;this._currentTarget===t?this._currentTargetSalvaged=!0:this._removeHashElement(t)}this.unscheduleUpdate(n)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(n){for(var u,i,f=this._arrayForTimers,r,t=f.length-1;t>=0;t--)u=f[t],this.unscheduleAllForTarget(u.target);if(r=0,n<0)for(t=0;t<this._updatesNegList.length;)r=this._updatesNegList.length,(i=this._updatesNegList[t])&&i.priority>=n&&this.unscheduleUpdate(i.target),r==this._updatesNegList.length&&t++;if(n<=0)for(t=0;t<this._updates0List.length;)r=this._updates0List.length,(i=this._updates0List[t])&&this.unscheduleUpdate(i.target),r==this._updates0List.length&&t++;for(t=0;t<this._updatesPosList.length;)r=this._updatesPosList.length,(i=this._updatesPosList[t])&&i.priority>=n&&this.unscheduleUpdate(i.target),r==this._updatesPosList.length&&t++},isScheduled:function(n,t){var i,r,f,u;if((cc.assertID(n,1508),cc.assertID(t,1509),i=t._id,i||(t.__instanceId?(cc.warnID(1513),i=t._id=t.__instanceId):cc.errorID(1510)),r=this._hashForTimers[i],!r)||null==r.timers)return!1;for(f=r.timers,u=0;u<f.length;++u)if(n===f[u]._callback)return!0;return!1},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(n){for(var u,i,r=[],e=this._arrayForTimers,t=0,f=e.length;t<f;t++)(u=e[t])&&(u.paused=!0,r.push(u.target));if(n<0)for(t=0;t<this._updatesNegList.length;t++)(i=this._updatesNegList[t])&&i.priority>=n&&(i.paused=!0,r.push(i.target));if(n<=0)for(t=0;t<this._updates0List.length;t++)(i=this._updates0List[t])&&(i.paused=!0,r.push(i.target));for(t=0;t<this._updatesPosList.length;t++)(i=this._updatesPosList[t])&&i.priority>=n&&(i.paused=!0,r.push(i.target));return r},resumeTargets:function(n){if(n)for(var t=0;t<n.length;t++)this.resumeTarget(n[t])},pauseTarget:function(n){var t,i,r;cc.assertID(n,1503);t=n._id;t||(n.__instanceId?(cc.warnID(1513),t=n._id=n.__instanceId):cc.errorID(1510));i=this._hashForTimers[t];i&&(i.paused=!0);r=this._hashForUpdates[t];r&&(r.entry.paused=!0)},resumeTarget:function(n){var t,i,r;cc.assertID(n,1504);t=n._id;t||(n.__instanceId?(cc.warnID(1513),t=n._id=n.__instanceId):cc.errorID(1510));i=this._hashForTimers[t];i&&(i.paused=!1);r=this._hashForUpdates[t];r&&(r.entry.paused=!1)},isTargetPaused:function(n){var t,i,r;return(cc.assertID(n,1505),t=n._id,t||(n.__instanceId?(cc.warnID(1513),t=n._id=n.__instanceId):cc.errorID(1510)),i=this._hashForTimers[t],i)?i.paused:(r=this._hashForUpdates[t],!!r&&r.entry.paused)}};cc.Scheduler.PRIORITY_SYSTEM=-2147483648;cc.Scheduler.PRIORITY_NON_SYSTEM=cc.Scheduler.PRIORITY_SYSTEM+1;t.exports=cc.Scheduler},{"./platform/id-generater":212,"./platform/js":216}],33:[function(n,t){"use strict";function i(){this._preprocessPipe=c;this._fetchPipe=a;this._loadPipe=y;this.pipeline=k.append(c).append(y);this.fetchPipeline=g.append(c).append(a);this.transformPipeline=d.append(ht).append(ct);this.bundles=u;this.assets=l;this._files=lt;this._parsed=at;this.generalImportBase="";this.generalNativeBase="";this.dependUtil=v;this._releaseManager=s;this.cacheAsset=!0;this.force=!1;this.utils=tt;this.downloader=ut;this.parser=ft;this.builtins=st;this.packManager=et;this.factory=p;this.cacheManager=null;this.presets={"default":{priority:0},preload:{maxConcurrency:2,maxRequestsPerFrame:2,priority:-1},scene:{maxConcurrency:8,maxRequestsPerFrame:8,priority:1},bundle:{maxConcurrency:8,maxRequestsPerFrame:8,priority:2},remote:{maxRetryCount:4},script:{maxConcurrency:1024,maxRequestsPerFrame:1024,priority:2}}}var c=n("./preprocess"),a=n("./fetch"),nt=n("./cache"),tt=n("./helper"),s=n("./releaseManager"),v=n("./depend-util"),y=n("./load"),it=n("./pipeline"),h=n("./task"),rt=n("./request-item"),ut=n("./downloader"),ft=n("./parser"),et=n("./pack-manager"),ot=n("./bundle"),st=n("./builtins"),p=n("./factory"),w=n("./urlTransformer"),ht=w.parse,ct=w.combine,b=n("./utilities"),f=b.parseParameters,e=b.asyncify,r=n("./shared"),l=r.assets,lt=r.files,at=r.parsed,k=r.pipeline,d=r.transformPipeline,g=r.fetchPipeline,vt=r.RequestType,u=r.bundles,o=r.BuiltinBundleName;i.Pipeline=it;i.Task=h;i.Cache=nt;i.RequestItem=rt;i.Bundle=ot;i.BuiltinBundleName=o;i.prototype={constructor:i,get main(){return u.get(o.MAIN)},get resources(){return u.get(o.RESOURCES)},get internal(){return u.get(o.INTERNAL)},init:function(n){n=n||Object.create(null);this._files.clear();this._parsed.clear();this._releaseManager.init();this.assets.clear();this.bundles.clear();this.packManager.init();this.downloader.init(n.bundleVers,n.server);this.parser.init();this.dependUtil.init();this.generalImportBase=n.importBase;this.generalNativeBase=n.nativeBase},getBundle:function(n){return u.get(n)},removeBundle:function(n){n._destroy();u.remove(n.name)},loadAny:function(n,t,i,r){var u=f(t,i,r),o;t=u.options;i=u.onProgress;r=u.onComplete;t.preset=t.preset||"default";n=Array.isArray(n)?n.concat():n;o=new h({input:n,onProgress:i,onComplete:e(r),options:t});k.async(o)},preloadAny:function(n,t,i,r){var u=f(t,i,r),o;t=u.options;i=u.onProgress;r=u.onComplete;t.preset=t.preset||"preload";n=Array.isArray(n)?n.concat():n;o=new h({input:n,onProgress:i,onComplete:e(r),options:t});g.async(o)},postLoadNative:function(n,t,i){var o,r,s;if(!(n instanceof cc.Asset))throw new Error("input is not asset");if(o=f(t,void 0,i),t=o.options,i=o.onComplete,!n._native||n._nativeAsset)return e(i)(null);r=v.getNativeDep(n._uuid);r&&(u.has(r.bundle)||(s=u.find(function(t){return t.getAssetInfo(n._uuid)}),s&&(r.bundle=s.name)),this.loadAny(r,t,function(t,r){t?cc.error(t.message,t.stack):n.isValid&&!n._nativeAsset&&(n._nativeAsset=r);i&&i(t)}))},loadRemote:function(n,t,i){var r=f(t,void 0,i);if(t=r.options,i=r.onComplete,this.assets.has(n))return e(i)(null,this.assets.get(n));t.__isNative__=!0;t.preset=t.preset||"remote";this.loadAny({url:n},t,null,function(r,u){r?(cc.error(r.message,r.stack),i&&i(r,null)):p.create(n,u,t.ext||cc.path.extname(n),t,function(n,t){i&&i(n,t)})})},loadScript:function(n,t,i){var r=f(t,void 0,i);t=r.options;i=r.onComplete;t.__requestType__=vt.URL;t.preset=t.preset||"script";this.loadAny(n,t,i)},loadBundle:function(n,t,i){var r=f(t,void 0,i),u=(t=r.options,i=r.onComplete,cc.path.basename(n));if(this.bundles.has(u))return e(i)(null,this.getBundle(u));t.preset=t.preset||"bundle";t.ext="bundle";this.loadRemote(n,t,i)},releaseAsset:function(n){s.tryRelease(n,!0)},releaseUnusedAssets:function(){l.forEach(function(n){s.tryRelease(n)})},releaseAll:function(){l.forEach(function(n){s.tryRelease(n,!0)})},_transform:function(n,t){var r=h.create({input:n,options:t}),u=[],o,c;try{for(var s=d.sync(r),i=0,e=s.length;i<e;i++)o=s[i],c=o.url,o.recycle(),u.push(c)}catch(f){for(f={},i=0,e=r.output.length;i<e;i++)r.output[i].recycle();cc.error(f.message,f.stack)}return r.recycle(),u.length>1?u:u[0]}};cc.AssetManager=i;cc.assetManager=new i;Object.defineProperty(cc,"resources",{get:function(){return u.get(o.RESOURCES)}});t.exports=cc.assetManager},{"./builtins":34,"./bundle":35,"./cache":36,"./depend-util":38,"./downloader":45,"./factory":46,"./fetch":47,"./helper":49,"./load":51,"./pack-manager":52,"./parser":53,"./pipeline":54,"./preprocess":55,"./releaseManager":56,"./request-item":57,"./shared":58,"./task":59,"./urlTransformer":60,"./utilities":61}],34:[function(n,t){"use strict";var i=n("./cache"),r=n("./releaseManager"),u=n("./shared").BuiltinBundleName,f={_assets:new i({material:new i,effect:new i}),_loadBuiltins:function(n,t){var i=n+"s",r=this._assets.get(n);return cc.assetManager.internal.loadDir(i,null,null,function(n,i){var u,f;if(n)cc.error(n.message,n.stack);else for(u=0;u<i.length;u++)f=i[u],r.add(f.name,f.addRef());t()})},init:function(n){var t=this;if(this.clear(),cc.game.renderType===cc.game.RENDER_TYPE_CANVAS||!cc.assetManager.bundles.has(u.INTERNAL))return n&&n();this._loadBuiltins("effect",function(){t._loadBuiltins("material",n)})},getBuiltin:function(n,t){return 0===arguments.length?this._assets:1===arguments.length?this._assets.get(n):this._assets.get(n).get(t)},clear:function(){this._assets.forEach(function(n){n.forEach(function(n){r.tryRelease(n,!0)});n.clear()})}};t.exports=f},{"./cache":36,"./releaseManager":56,"./shared":58}],35:[function(n,t){"use strict";function o(){this._config=new c}var c=n("./config"),u=n("./releaseManager"),s=n("./utilities"),h=s.parseParameters,i=s.parseLoadResArgs,f=n("./shared"),r=f.RequestType,e=f.assets,l=f.bundles;o.prototype={constructor:o,get name(){return this._config.name},get deps(){return this._config.deps},get base(){return this._config.base},getInfoWithPath:function(n,t){return this._config.getInfoWithPath(n,t)},getDirWithPath:function(n,t,i){return this._config.getDirWithPath(n,t,i)},getAssetInfo:function(n){return this._config.getAssetInfo(n)},getSceneInfo:function(n){return this._config.getSceneInfo(n)},init:function(n){this._config.init(n);l.add(n.name,this)},load:function(n,t,u,f){var e=i(t,u,f);t=e.type;u=e.onProgress;f=e.onComplete;cc.assetManager.loadAny(n,{__requestType__:r.PATH,type:t,bundle:this.name,__outputAsArray__:Array.isArray(n)},u,f)},preload:function(n,t,u,f){var e=i(t,u,f);t=e.type;u=e.onProgress;f=e.onComplete;cc.assetManager.preloadAny(n,{__requestType__:r.PATH,type:t,bundle:this.name},u,f)},loadDir:function(n,t,u,f){var e=i(t,u,f);t=e.type;u=e.onProgress;f=e.onComplete;cc.assetManager.loadAny(n,{__requestType__:r.DIR,type:t,bundle:this.name,__outputAsArray__:!0},u,f)},preloadDir:function(n,t,u,f){var e=i(t,u,f);t=e.type;u=e.onProgress;f=e.onComplete;cc.assetManager.preloadAny(n,{__requestType__:r.DIR,type:t,bundle:this.name},u,f)},loadScene:function(n,t,i,r){var u=h(t,i,r);t=u.options;i=u.onProgress;r=u.onComplete;t.preset=t.preset||"scene";t.bundle=this.name;cc.assetManager.loadAny({scene:n},t,i,function(n,t){if(n)cc.error(n.message,n.stack),r&&r(n);else if(t instanceof cc.SceneAsset){var i=t.scene;i._id=t._uuid;i._name=t._name;r&&r(null,t)}else r&&r(new Error("The asset "+t._uuid+" is not a scene"))})},preloadScene:function(n,t,i,r){var u=h(t,i,r);t=u.options;i=u.onProgress;r=u.onComplete;t.bundle=this.name;cc.assetManager.preloadAny({scene:n},t,i,function(t){t&&cc.errorID(1210,n,t.message);r&&r(t)})},get:function(n,t){var i=this.getInfoWithPath(n,t);return e.get(i&&i.uuid)},release:function(n,t){u.tryRelease(this.get(n,t),!0)},releaseUnusedAssets:function(){var n=this;e.forEach(function(t){var i=n.getAssetInfo(t._uuid);i&&!i.redirect&&u.tryRelease(t)})},releaseAll:function(){var n=this;e.forEach(function(t){var i=n.getAssetInfo(t._uuid);i&&!i.redirect&&u.tryRelease(t,!0)})},_destroy:function(){this._config.destroy()}};t.exports=o},{"./config":37,"./releaseManager":56,"./shared":58,"./utilities":61}],36:[function(n,t){"use strict";function i(n){n?(this._map=n,this._count=Object.keys(n).length):(this._map=r.createMap(!0),this._count=0)}var r=n("../platform/js");i.prototype={constructor:i,add:function(n,t){return n in this._map||this._count++,this._map[n]=t},get:function(n){return this._map[n]},has:function(n){return n in this._map},remove:function(n){var t=this._map[n];return n in this._map&&(delete this._map[n],this._count--),t},clear:function(){0!==this._count&&(this._map=r.createMap(!0),this._count=0)},forEach:function(n){for(var t in this._map)n(this._map[t],t)},find:function(n){for(var t in this._map)if(n(this._map[t],t))return this._map[t];return null},get count(){return this._count},destroy:function(){this._map=null}};t.exports=i},{"../platform/js":216}],37:[function(n,t){"use strict";function u(){this.name="";this.base="";this.importBase="";this.nativeBase="";this.deps=null;this.assetInfos=new r;this.scenes=new r;this.paths=new r}var i=n("../platform/js"),r=n("./cache"),f=n("./helper").normalize,e=n("./utilities").processOptions;u.prototype={constructor:u,init:function(n){e(n);this.importBase=n.importBase||"";this.nativeBase=n.nativeBase||"";this.base=n.base||"";this.name=n.name||"";this.deps=n.deps||[];this._initUuid(n.uuids);this._initPath(n.paths);this._initScene(n.scenes);this._initPackage(n.packs);this._initVersion(n.versions);this._initRedirect(n.redirect)},_initUuid:function(n){var t,r,i;if(n)for(this.assetInfos.clear(),t=0,r=n.length;t<r;t++)i=n[t],this.assetInfos.add(i,{uuid:i})},_initPath:function(n){var t,f;if(n){t=this.paths;for(f in t.clear(),n){var e=n[f],r=e[0],o=e[1],s=3===e.length,u=this.assetInfos.get(f);u.path=r;u.ctor=i._getClassById(o);t.has(r)?s?t.get(r).push(u):t.get(r).splice(0,0,u):t.add(r,[u])}}},_initScene:function(n){var i,u,t,f,r;if(n){i=this.scenes;i.clear();u=this.assetInfos;for(t in n)f=n[t],r=u.get(f),r.url=t,i.add(t,r)}},_initPackage:function(n){var f,i,r,t,u,e;if(n){f=this.assetInfos;for(i in n)for(r=n[i],t={uuid:i,packs:r,ext:".json"},f.add(i,t),u=0,e=r.length;u<e;u++){var h=r[u],s=f.get(h),o=s.packs;o?1===e?o.splice(0,0,t):o.push(t):s.packs=[t]}}},_initVersion:function(n){var f,i,t,r,u;if(n){if(f=this.assetInfos,i=n.import,i)for(t=0,r=i.length;t<r;t+=2)u=i[t],f.get(u).ver=i[t+1];if(i=n.native)for(t=0,r=i.length;t<r;t+=2)u=i[t],f.get(u).nativeVer=i[t+1]}},_initRedirect:function(n){var i;if(n)for(var r=this.assetInfos,t=0,u=n.length;t<u;t+=2)i=n[t],r.get(i).redirect=n[t+1]},getInfoWithPath:function(n,t){var r,u,o,e;if(!n)return null;if(n=f(n),r=this.paths.get(n),r){if(!t)return r[0];for(u=0,o=r.length;u<o;u++)if(e=r[u],i.isChildClassOf(e.ctor,t))return e}return null},getDirWithPath:function(n,t,r){function e(n,t){return!(n.length>t.length)||47===n.charCodeAt(t.length)}"/"===(n=f(n))[n.length-1]&&(n=n.slice(0,-1));var u=r||[];return this.paths.forEach(function(r,f){var o,h,s;if(f.startsWith(n)&&e(f,n)||!n)for(o=0,h=r.length;o<h;o++)s=r[o],t&&!i.isChildClassOf(s.ctor,t)||u.push(s)}),u},getAssetInfo:function(n){return this.assetInfos.get(n)},getSceneInfo:function(n){return n.endsWith(".fire")||(n+=".fire"),"/"===n[0]||n.startsWith("db://")||(n="/"+n),this.scenes.find(function(t,i){return i.endsWith(n)})},destroy:function(){this.paths.destroy();this.scenes.destroy();this.assetInfos.destroy()}};t.exports=u},{"../platform/js":216,"./cache":36,"./helper":49,"./utilities":61}],38:[function(n,t){"use strict";function r(){if("function"!=typeof WeakMap)return null;var n=new WeakMap;return r=function(){return n},n}var i=function(n){var t,i,e,u,f;if(n&&n.__esModule)return n;if(null===n||"object"!=typeof n&&"function"!=typeof n)return{"default":n};if(t=r(),t&&t.has(n))return t.get(n);i={};e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(u in n)Object.prototype.hasOwnProperty.call(n,u)&&(f=e?Object.getOwnPropertyDescriptor(n,u):null,f&&(f.get||f.set)?Object.defineProperty(i,u,f):i[u]=n[u]);return i.default=n,t&&t.set(n,i),i}(n("../platform/deserialize-compiled")),f=n("./cache"),e=n("./deserialize"),u=n("./shared"),o=u.files,s=u.parsed,h={_depends:new f,init:function(){this._depends.clear()},getNativeDep:function(n){var t=this._depends.get(n);return t?t.nativeDep&&Object.assign({},t.nativeDep):null},getDeps:function(n){return this._depends.has(n)?this._depends.get(n).deps:[]},getDepsRecursively:function(n){var i=Object.create(null),t=[];return this._descend(n,i,t),t},_descend:function(n,t,i){for(var r,f=this.getDeps(n),u=0;u<f.length;u++)r=f[u],t[r]||(t[r]=!0,i.push(r),this._descend(r,t,i))},remove:function(n){this._depends.remove(n)},parse:function(n,t){var r=null,u;if(Array.isArray(t)||t.__type__){if(r=this._depends.get(n))return r;if(Array.isArray(t)&&!i.hasNativeDep(t))r={deps:this._parseDepsFromJson(t)};else try{u=e(t);(r=this._parseDepsFromAsset(u)).nativeDep&&(r.nativeDep.uuid=n);s.add(n+"@import",u)}catch(f){f={};o.remove(n+"@import");r={deps:[]}}}else{if((r=this._depends.get(n))&&r.parsedFromExistAsset)return r;r=this._parseDepsFromAsset(t)}return this._depends.add(n,r),r},_parseDepsFromAsset:function(n){for(var u,t={deps:[],parsedFromExistAsset:!0,preventPreloadNativeObject:n.constructor.preventPreloadNativeObject,preventDeferredLoadDependents:n.constructor.preventDeferredLoadDependents},r=n.__depends__,i=0,f=r.length;i<f;i++)u=r[i].uuid,t.deps.push(u);return n.__nativeDepend__&&(t.nativeDep=n._nativeDep),t},_parseDepsFromJson:function(n){var t=i.getDependUuidList(n);return t.forEach(function(n,i){return t[i]=cc.assetManager.utils.decodeUuid(n)}),t}};t.exports=h},{"../platform/deserialize-compiled":210,"./cache":36,"./deserialize":40,"./shared":58}],39:[function(n){"use strict";function p(){return!0}var u=n("../platform/js"),o,t,s,h,c;n("../CCDirector");var i=n("./utilities"),f=n("./depend-util"),r=n("./releaseManager"),l=n("./downloader"),e=n("./factory"),a=n("./helper"),v=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm"],y=[".mp3",".ogg",".wav",".m4a"];o={transformURL:function(n){var r=a.getUuidFromURL(n),t,i,u,f,e,o;return r?(t=cc.assetManager.bundles.find(function(n){return!!n.getAssetInfo(r)}),!t)?n:(u=t.getAssetInfo(r),!(i=n.startsWith(t.base+t._config.nativeBase)?u.nativeVer||"":u.ver||"")||-1!==n.indexOf(i))?n:(f=!1,(".ttf"===cc.path.extname(n)&&(f=!0),f)?(e=cc.path.dirname(n),o=cc.path.basename(n),n=e+"."+i+"/"+o):n=n.replace(/.*[\/\\][0-9a-fA-F]{2}[\/\\]([0-9a-fA-F-]{8,})/,function(n){return n+"."+i}),n):n}};t={onProgress:null,_autoReleaseSetting:Object.create(null),get _cache(){return cc.assetManager.assets._map},load:function(n,t,i){var u,r,f,o;for(void 0===i&&void 0!==t&&(i=t,t=null),n=Array.isArray(n)?n:[n],u=0;u<n.length;u++)r=n[u],"string"==typeof r?n[u]={url:r,__isNative__:!0}:(r.type&&(r.ext="."+r.type,r.type=void 0),r.url&&(r.__isNative__=!0));f=[];o=[];cc.assetManager.loadAny(n,null,function(n,i,r){r.content&&(v.includes(r.ext)?f.push(r.content):y.includes(r.ext)&&o.push(r.content));t&&t(n,i,r)},function(t,r){var l=null,u,h,s,c,a;if(!t){for(r=Array.isArray(r)?r:[r],u=0;u<r.length;u++)h=r[u],h instanceof cc.Asset||(s=h,c=n[u].url,f.includes(s)?e.create(c,h,".png",null,function(n,t){s=r[u]=t}):o.includes(s)&&e.create(c,h,".mp3",null,function(n,t){s=r[u]=t}),cc.assetManager.assets.add(c,s));r.length>1?(a=Object.create(null),r.forEach(function(n){a[n._uuid]=n}),l={isCompleted:p,_map:a}):l=r[0]}i&&i(t,l)})},getXMLHttpRequest:function(){return new XMLHttpRequest},_parseLoadResArgs:i.parseLoadResArgs,getItem:function(n){return cc.assetManager.assets.has(n)?{content:cc.assetManager.assets.get(n)}:null},loadRes:function(n,t,i,r){var u=this._parseLoadResArgs(t,i,r),e=(t=u.type,u.onProgress),o=u.onComplete,f=cc.path.extname(n);f&&(n=n.slice(0,-f.length));cc.resources.load(n,t,e,o)},loadResArray:function(n,t,i,r){var u=this._parseLoadResArgs(t,i,r),f=(t=u.type,u.onProgress),e=u.onComplete;n.forEach(function(t,i){var r=cc.path.extname(t);r&&(n[i]=t.slice(0,-r.length))});cc.resources.load(n,t,f,e)},loadResDir:function(n,t,i,r){var u=this._parseLoadResArgs(t,i,r),e=(t=u.type,u.onProgress),f=u.onComplete;cc.resources.loadDir(n,t,e,function(i,r){var u=[];i||(u=cc.resources.getDirWithPath(n,t).map(function(n){return n.path}));f&&f(i,r,u)})},getRes:function(n,t){return cc.assetManager.assets.has(n)?cc.assetManager.assets.get(n):cc.resources.get(n,t)},getResCount:function(){return cc.assetManager.assets.count},getDependsRecursively:function(n){return n?f.getDepsRecursively("string"==typeof n?n:n._uuid).concat([n._uuid]):[]},get assetLoader(){},get md5Pipe(){return o},get downloader(){return cc.assetManager.downloader},get loader(){return cc.assetManager.parser},addDownloadHandlers:function(n){var i=Object.create(null),t,r;for(t in n)r=n[t],i["."+t]=function(n,t,i){r({url:n},i)};cc.assetManager.downloader.register(i)},addLoadHandlers:function(n){var i=Object.create(null),t,r;for(t in n)r=n[t],i["."+t]=function(n,t,i){r({content:n},i)};cc.assetManager.parser.register(i)},flowInDeps:function(){},release:function(n){var i,t;if(Array.isArray(n))for(i=0;i<n.length;i++)t=n[i],"string"==typeof t&&(t=cc.assetManager.assets.get(t)),cc.assetManager.builtins._assets.find(function(n){return n.find(function(n){return n===t})})||cc.assetManager.releaseAsset(t);else if(n){if("string"==typeof n&&(n=cc.assetManager.assets.get(n)),cc.assetManager.builtins._assets.find(function(t){return t.find(function(t){return t===n})}))return;cc.assetManager.releaseAsset(n)}},releaseAsset:function(n){cc.assetManager.releaseAsset(n)},releaseRes:function(n,t){cc.resources.release(n,t)},releaseResDir:function(){},releaseAll:function(){cc.assetManager.releaseAll();cc.assetManager.assets.clear()},removeItem:function(n){cc.assetManager.assets.remove(n)},setAutoRelease:function(n,t){"object"==typeof n&&(n=n._uuid);this._autoReleaseSetting[n]=!!t},setAutoReleaseRecursively:function(n,t){var r,i,u;for("object"==typeof n&&(n=n._uuid),t=!!t,this._autoReleaseSetting[n]=t,r=f.getDepsRecursively(n),i=0;i<r.length;i++)u=r[i],this._autoReleaseSetting[u]=t},isAutoRelease:function(n){return"object"==typeof n&&(n=n._uuid),!!this._autoReleaseSetting[n]}};l.loadSubpackage=function(n,t){cc.assetManager.loadBundle(n,null,t)};s={init:function(n){n.importBase=n.libraryPath;n.nativeBase=n.rawAssetsBase;cc.assetManager.init(n);n.rawAssets&&(new cc.AssetManager.Bundle).init({name:cc.AssetManager.BuiltinBundleName.RESOURCES,importBase:n.importBase,nativeBase:n.nativeBase,paths:n.rawAssets.assets,uuids:Object.keys(n.rawAssets.assets)})},loadAsset:function(n,t){cc.assetManager.loadAny(n,t)},getLibUrlNoExt:function(){},queryAssetInfo:function(){}};cc.url={normalize:function(n){return cc.warnID(1400,"cc.url.normalize","cc.assetManager.utils.normalize"),cc.assetManager.utils.normalize(n)},raw:function(n){return cc.warnID(1400,"cc.url.raw","cc.resources.load"),n.startsWith("resources/")?cc.assetManager._transform({path:cc.path.changeExtname(n.substr(10)),bundle:cc.AssetManager.BuiltinBundleName.RESOURCES,__isNative__:!0,ext:cc.path.extname(n)}):""}};Object.defineProperties(cc,{loader:{get:function(){return t}},AssetLibrary:{get:function(){return s}},LoadingItems:{get:function(){return cc.warnID(1400,"cc.LoadingItems","cc.AssetManager.Task"),cc.AssetManager.Task}},Pipeline:{get:function(){return cc.warnID(1400,"cc.Pipeline","cc.AssetManager.Pipeline"),cc.AssetManager.Pipeline}}});u.obsolete(cc,"cc.RawAsset","cc.Asset");u.obsolete(cc.Asset.prototype,"cc.Asset.url","nativeUrl");Object.defineProperties(cc.macro,{DOWNLOAD_MAX_CONCURRENT:{get:function(){return cc.assetManager.downloader.maxConcurrency},set:function(n){cc.assetManager.downloader.maxConcurrency=n}}});Object.assign(cc.director,{_getSceneUuid:function(n){cc.assetManager.main.getSceneInfo(n)}});Object.defineProperties(cc.game,{_sceneInfos:{get:function(){var n=[];return cc.assetManager.main._config.scenes.forEach(function(t){n.push(t)}),n}}});h=i.parseParameters;i.parseParameters=function(n,i,r){var u=h(n,i,r);return u.onProgress=u.onProgress||t.onProgress,u};c=r._autoRelease;r._autoRelease=function(){var i,u;c.apply(this,arguments);for(var f=t._autoReleaseSetting,e=Object.keys(f),n=0;n<e.length;n++)i=e[n],!0===f[i]&&(u=cc.assetManager.assets.get(i),u&&r.tryRelease(u))}},{"../CCDirector":27,"../platform/js":216,"./depend-util":38,"./downloader":45,"./factory":46,"./helper":49,"./releaseManager":56,"./utilities":61}],40:[function(n,t){"use strict";var i=n("./helper");n("../platform/deserialize");t.exports=function(n,t){var s,f,e,r,l;s=cc._MissingScript.safeFindClass;e=null;r=(e=cc.deserialize.Details.pool).get();try{f=cc.deserialize(n,r,{classFinder:s,customEnv:t})}catch(o){o={};throw e.put(r),o;}for(var h=r.uuidList,a=r.uuidObjList,v=r.uuidPropList,c=[],u=0;u<h.length;u++)l=h[u],c[u]={uuid:i.decodeUuid(l),owner:a[u],prop:v[u]};return f.__depends__=c,f._native&&(f.__nativeDepend__=!0),e.put(r),f}},{"../platform/deserialize":211,"../platform/deserialize-compiled":210,"../platform/deserialize-editor":void 0,"./helper":49}],41:[function(n,t){"use strict";var i=cc.sys.__audioSupport,r=n("./utilities").parseParameters;t.exports=function(n,t,u){var s=r(t,void 0,u),f=(t=s.options,u=s.onComplete,document.createElement("audio"));f.src=n;var h=function(){clearTimeout(c);f.removeEventListener("canplaythrough",e,!1);f.removeEventListener("error",o,!1);i.USE_LOADER_EVENT&&f.removeEventListener(i.USE_LOADER_EVENT,e,!1)},c=setTimeout(function(){0===f.readyState?o():e()},8e3),e=function(){h();u&&u(null,f)},o=function(){h();var t="load audio failure - "+n;cc.log(t);u&&u(new Error(t))};return f.addEventListener("canplaythrough",e,!1),f.addEventListener("error",o,!1),i.USE_LOADER_EVENT&&f.addEventListener(i.USE_LOADER_EVENT,e,!1),f}},{"./utilities":61}],42:[function(n,t){"use strict";var i=n("./utilities").parseParameters;t.exports=function(n,t,r){function f(){u.removeEventListener("load",f);u.removeEventListener("error",e);r&&r(null,u)}function e(){u.removeEventListener("load",f);u.removeEventListener("error",e);r&&r(new Error(cc.debug.getError(4930,n)))}var o=i(t,void 0,r),u=(t=o.options,r=o.onComplete,new Image);return"file:"!==window.location.protocol&&(u.crossOrigin="anonymous"),u.addEventListener("load",f),u.addEventListener("error",e),u.src=n,u}},{"./utilities":61}],43:[function(n,t){"use strict";var i=n("./utilities").parseParameters;t.exports=function(n,t,r,u){var o=i(t,r,u),f=(t=o.options,r=o.onProgress,u=o.onComplete,new XMLHttpRequest),e="download failed: "+n+", status: ",s;if(f.open("GET",n,!0),void 0!==t.responseType&&(f.responseType=t.responseType),void 0!==t.withCredentials&&(f.withCredentials=t.withCredentials),void 0!==t.mimeType&&f.overrideMimeType&&f.overrideMimeType(t.mimeType),void 0!==t.timeout&&(f.timeout=t.timeout),t.header)for(s in t.header)f.setRequestHeader(s,t.header[s]);return f.onload=function(){200===f.status||0===f.status?u&&u(null,f.response):u&&u(new Error(e+f.status+"(no response)"))},r&&(f.onprogress=function(n){n.lengthComputable&&r(n.loaded,n.total)}),f.onerror=function(){u&&u(new Error(e+f.status+"(error)"))},f.ontimeout=function(){u&&u(new Error(e+f.status+"(time out)"))},f.onabort=function(){u&&u(new Error(e+f.status+"(abort)"))},f.send(null),f}},{"./utilities":61}],44:[function(n,t){"use strict";var r=n("./utilities").parseParameters,i={};t.exports=function(n,t,u){function e(){f.parentNode.removeChild(f);f.removeEventListener("load",e,!1);f.removeEventListener("error",o,!1);i[n]=!0;u&&u(null)}function o(){f.parentNode.removeChild(f);f.removeEventListener("load",e,!1);f.removeEventListener("error",o,!1);u&&u(new Error(cc.debug.getError(4928,n)))}var s=r(t,void 0,u),h,f;if(t=s.options,u=s.onComplete,i[n])return u&&u(null);h=document;f=document.createElement("script");"file:"!==window.location.protocol&&(f.crossOrigin="anonymous");f.async=t.async;f.src=n;f.addEventListener("load",e,!1);f.addEventListener("error",o,!1);h.body.appendChild(f)}},{"./utilities":61}],45:[function(n,t){"use strict";var ht=n("../platform/js"),ct=n("../CCDebug"),s=n("./font-loader").loadFont,b=n("../platform/utils").callInNextTick,nt=n("./download-dom-image"),k=n("./download-dom-audio"),l=n("./download-file"),d=n("./download-script.js"),lt=n("./cache"),tt=n("./shared").files,it=n("../platform/CCSys"),rt=it.__audioSupport,at=it.capabilities,ut=n("./utilities"),ft=ut.urlAppendTimestamp,vt=ut.retry,yt=/^(?:\w+:\/\/|\.+\/).+/,h=function(n,t,i){t.audioLoadMode!==cc.AudioClip.LoadMode.DOM_AUDIO?f(n,t,i):k(n,t,i)},r=(h=0===(rt.format||[]).length?function(n,t,i){i(new Error(ct.getError(4927)))}:rt.WEB_AUDIO?h:k,function(){var n=at.imageBitmap&&cc.macro.ALLOW_IMAGE_BITMAP?pt:nt;n.apply(this,arguments)}),pt=function(n,t,i){t.responseType="blob";l(n,t,t.onFileProgress,i)},g=function(n,t,i){t.responseType="json";l(n,t,t.onFileProgress,function(n,t){if(!n&&"string"==typeof t)try{t=JSON.parse(t)}catch(r){r={};n=r}i&&i(n,t)})},f=function(n,t,i){t.responseType="arraybuffer";l(n,t,t.onFileProgress,i)},i=function(n,t,i){t.responseType="text";l(n,t,t.onFileProgress,i)},e=function(n,t,i){i(null,n)},p=new lt,u=[],w=!1,o=0,a=0,et=-1,c=!1,ot=function(){var n=Date.now(),t=cc.director._deltaTime>v._maxInterval?v._maxInterval:cc.director._deltaTime;n-et>1e3*t&&(a=0,et=n)},st=function n(t,i){for(c=!1,ot();u.length>0&&o<t&&a<i;){w&&(u.sort(function(n,t){return n.priority-t.priority}),w=!1);var r=u.pop();if(!r)break;o++;a++;r.invoke()}u.length>0&&o<t&&(b(n,t,i),c=!0)},v={_remoteServerAddress:"",_maxInterval:1/30,get remoteServerAddress(){return this._remoteServerAddress},maxConcurrency:6,maxRequestsPerFrame:6,maxRetryCount:3,appendTimeStamp:!1,limited:!0,retryInterval:2e3,bundleVers:null,downloadDomImage:nt,downloadDomAudio:k,downloadFile:l,downloadScript:d,init:function(n,t){p.clear();u.length=0;this._remoteServerAddress=t||"";this.bundleVers=n||Object.create(null)},register:function(n,t){"object"==typeof n?ht.mixin(y,n):y[n]=t},download:function(n,t,i,r,f){var k,d,g=y[i]||y.default,it=this,e,nt,s,l;if(k=tt.get(n))f(null,k);else if(d=p.get(n)){for(d.push(f),e=0,nt=u.length;e<nt;e++)if(s=u[e],s.id===n)return l=r.priority||0,void(s.priority<l&&(s.priority=l,w=!0))}else{var rt=void 0!==r.maxRetryCount?r.maxRetryCount:this.maxRetryCount,h=void 0!==r.maxConcurrency?r.maxConcurrency:this.maxConcurrency,v=void 0!==r.maxRequestsPerFrame?r.maxRequestsPerFrame:this.maxRequestsPerFrame;vt(function(i,e){function s(){g(ft(t),r,function(){o--;!c&&u.length>0&&(b(st,h,v),c=!0);e.apply(this,arguments)})}if(0===i&&p.add(n,[f]),!it.limited)return g(ft(t),r,e);ot();o<h&&a<v?(s(),o++,a++):(u.push({id:n,priority:r.priority||0,invoke:s}),w=!0,!c&&o<h&&(b(st,h,v),c=!0))},rt,this.retryInterval,function(t,i){t||tt.add(n,i);for(var u=p.remove(n),r=0,f=u.length;r<f;r++)u[r](t,i)})}}},y={".png":r,".jpg":r,".bmp":r,".jpeg":r,".gif":r,".ico":r,".tiff":r,".webp":r,".image":r,".pvr":f,".pkm":f,".mp3":h,".ogg":h,".wav":h,".m4a":h,".txt":i,".xml":i,".vsh":i,".fsh":i,".atlas":i,".tmx":i,".tsx":i,".json":g,".ExportJson":g,".plist":i,".fnt":i,".font":s,".eot":s,".ttf":s,".woff":s,".svg":s,".ttc":s,".mp4":e,".avi":e,".mov":e,".mpg":e,".mpeg":e,".rm":e,".rmvb":e,".binary":f,".bin":f,".dbbin":f,".skel":f,".js":d,bundle:function(n,t,i){var o=cc.path.basename(n),r=n;yt.test(r)||(r="assets/"+o);var u=t.version||v.bundleVers[o],s=0,f=null,e=null;g(r+"/config."+(u?u+".":"")+"json",t,function(n,t){n&&(e=n);(f=t)&&(f.base=r+"/");2==++s&&i(e,f)});d(r+"/index."+(u?u+".":"")+"js",t,function(n){n&&(e=n);2==++s&&i(e,f)})},"default":i};v._downloaders=y;t.exports=v},{"../CCDebug":26,"../platform/CCSys":204,"../platform/js":216,"../platform/utils":219,"./cache":36,"./download-dom-audio":41,"./download-dom-image":42,"./download-file":43,"./download-script.js":44,"./font-loader":48,"./shared":58,"./utilities":61}],46:[function(n,t){"use strict";function i(n,t,i,r){var u=null,e=null;try{(u=new cc.Texture2D)._nativeUrl=n;u._nativeAsset=t}catch(f){f={};e=f}r&&r(e,u)}function f(n,t,i,r){var u=new cc.AudioClip;u._nativeUrl=n;u._nativeAsset=t;u.duration=t.duration;r&&r(null,u)}function l(n,t,i,r){var u=new cc.JsonAsset;u.json=t;r&&r(null,u)}function r(n,t,i,r){var u=new cc.TextAsset;u.text=t;r&&r(null,u)}function u(n,t,i,r){var u=new cc.TTFFont;u._nativeUrl=n;u._nativeAsset=t;r&&r(null,u)}function e(n,t,i,r){var u=new cc.BufferAsset;u._nativeUrl=n;u._nativeAsset=t;r&&r(null,u)}var a=n("./bundle"),v=n("./cache"),h=n("./shared"),c=h.assets,y=h.bundles,s=new v,p={register:function(n,t){"object"==typeof n?cc.js.mixin(o,n):o[n]=t},create:function(n,t,i,r,u){var f,e,h=o[i]||o.default;(f=c.get(n))?u(null,f):(e=s.get(n))?e.push(u):(s.add(n,[u]),h(n,t,r,function(t,i){!t&&i instanceof cc.Asset&&(i._uuid=n,c.add(n,i));for(var u=s.remove(n),r=0,f=u.length;r<f;r++)u[r](t,i)}))}},o={".png":i,".jpg":i,".bmp":i,".jpeg":i,".gif":i,".ico":i,".tiff":i,".webp":i,".image":i,".pvr":i,".pkm":i,".mp3":f,".ogg":f,".wav":f,".m4a":f,".txt":r,".xml":r,".vsh":r,".fsh":r,".atlas":r,".tmx":r,".tsx":r,".fnt":r,".json":l,".ExportJson":l,".font":u,".eot":u,".ttf":u,".woff":u,".svg":u,".ttc":u,".binary":e,".bin":e,".dbbin":e,".skel":e,bundle:function(n,t,i,r){var u=y.get(t.name);u||(u=new a,t.base=t.base||n+"/",u.init(t));r&&r(null,u)},"default":function(n,t,i,r){var u=new cc.Asset;u._nativeUrl=n;u._nativeAsset=t;r&&r(null,u)}};t.exports=p},{"./bundle":35,"./cache":36,"./shared":58}],47:[function(n,t){"use strict";function o(n){for(var i=n.output,t=0,r=i.length;t<r;t++)i[t].content&&i[t].content.decRef(!1)}function r(n,t,i,r,u,f,e){var s=t.options.__exclude__,o=t.progress;n.content=i;n.file=r;t.output.push(n);u&&(s[n.uuid]=!0,h(n.uuid,r||i,s,f,!0,!1,n.config),o.total=e+f.length);o.canInvoke&&t.dispatch("progress",++o.finish,o.total,n)}var s=n("./pack-manager"),u=n("./task"),i=n("./utilities"),h=i.getDepends,c=i.clear,l=i.forEach,f=n("./shared"),e=f.assets,a=f.fetchPipeline;t.exports=function(n,t){var f=!1;n.progress||(n.progress={finish:0,total:n.input.length,canInvoke:!0},f=!0);var h=n.options,i=[],v=n.progress,y=v.total;h.__exclude__=h.__exclude__||Object.create(null);n.output=[];l(n.input,function(u,o){if(!u.isNative&&e.has(u.uuid)){var h=e.get(u.uuid);return h.addRef(),r(u,n,h,null,h.__asyncLoadAssets__,i,y),o()}s.load(u,n.options,function(e,s){e?n.isFinish||(!cc.assetManager.force||f?(cc.error(e.message,e.stack),v.canInvoke=!1,t(e)):r(u,n,null,null,!1,i,y)):n.isFinish||r(u,n,null,s,!u.isNative,i,y);o()})},function(){if(n.isFinish)return c(n,!0),n.dispatch("error");if(i.length>0){var r=u.create({name:n.name+" dependencies",input:i,progress:v,options:h,onProgress:n.onProgress,onError:u.prototype.recycle,onComplete:function(i){i||(n.output.push.apply(n.output,this.output),r.recycle());f&&o(n);t(i)}});a.async(r)}else f&&o(n),t()})}},{"./pack-manager":52,"./shared":58,"./task":59,"./utilities":61}],48:[function(n,t){"use strict";function a(){for(var n,r,l,h,c=!0,a=Date.now(),t=u.length-1;t>=0;t--)n=u[t],r=n.fontFamilyName,a-n.startTime>e?(cc.warnID(4933,r),n.onComplete(null,r),u.splice(t,1)):(l=n.refWidth,h="40px "+r,i.font=h,l!==o.safeMeasureText(i,s,h)?(u.splice(t,1),n.onComplete(null,r)):c=!1);c&&(clearInterval(f),f=-1)}var r,o=n("../utils/text-utils"),i=null,s="BES bswy:->@123",h=Object.create(null),f=-1,u=[],e=3e3,l=(r=void 0,function(){if(void 0===r)if(window.FontFace){var n=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),t=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);r=n?parseInt(n[1],10)>42:!t}else r=!1;return r}),c={loadFont:function(n,t,r){var v=c._getFontFamily(n),k,nt,it,y,d,rt,p,tt,ut,w,ft,g,b,et;if(h[v])return r(null,v);i||(k=document.createElement("canvas"),k.width=100,k.height=100,i=k.getContext("2d"));nt="40px "+v;i.font=nt;it=o.safeMeasureText(i,s,nt);y=document.createElement("style");y.type="text/css";d="";d+=isNaN(+v)?"@font-face { font-family:"+v+"; src:":"@font-face { font-family:'"+v+"'; src:";d+="url('"+n+"');";y.textContent=d+"}";document.body.appendChild(y);g=document.createElement("div");b=g.style;(b.fontFamily=v,g.innerHTML=".",b.position="absolute",b.left="-100px",b.top="-100px",document.body.appendChild(g),l())?(rt=Date.now(),p=v,tt=r,ut=new Promise(function(n,t){(function i(){Date.now()-rt>=e?t():document.fonts.load("40px "+p).then(function(t){t.length>=1?n():setTimeout(i,100)},function(){t()})})()}),w=null,ft=new Promise(function(n,t){w=setTimeout(t,e)}),Promise.race([ft,ut]).then(function(){w&&(clearTimeout(w),w=null);tt(null,p)},function(){cc.warnID(4933,p);tt(null,p)})):(et={fontFamilyName:v,refWidth:it,onComplete:r,startTime:Date.now()},u.push(et),-1===f&&(f=setInterval(a,100)));h[v]=y},_getFontFamily:function(n){var i=n.lastIndexOf(".ttf"),t,r;return-1===i?n:(r=n.lastIndexOf("/"),-1!==(t=-1===r?n.substring(0,i)+"_LABEL":n.substring(r+1,i)+"_LABEL").indexOf(" ")&&(t='"'+t+'"'),t)}};t.exports=c},{"../utils/text-utils":276}],49:[function(n,t){"use strict";var i,r=n("./shared").bundles,u={decodeUuid:n("../utils/decode-uuid"),getUuidFromURL:(i=/.*[\/\\][0-9a-fA-F]{2}[\/\\]([0-9a-fA-F-]{8,})/,function(n){var t=n.match(i);return t?t[1]:""}),getUrlWithUuid:function(n,t){(t=t||Object.create(null)).__isNative__=t.isNative;t.ext=t.nativeExt;var i=r.find(function(t){return t.getAssetInfo(n)});return i&&(t.bundle=i.name),cc.assetManager._transform(n,t)},isScene:function(n){return n&&(n.constructor===cc.SceneAsset||n instanceof cc.Scene)},normalize:function(n){return n&&(46===n.charCodeAt(0)&&47===n.charCodeAt(1)?n=n.slice(2):47===n.charCodeAt(0)&&(n=n.slice(1))),n}};t.exports=u},{"../utils/decode-uuid":264,"./shared":58}],50:[function(n){"use strict";n("./deprecated");n("./CCAssetManager")},{"./CCAssetManager":33,"./deprecated":39}],51:[function(n,t){"use strict";function l(n,t,i,r){var u=n.input,l=n.progress,e=u.uuid,w=u.id,b=u.options,nt=u.config,k=b.__asyncLoadAssets__,g=b.cacheAsset,v=[],a,s;t.addRef&&t.addRef();y(e,t,Object.create(null),v,!1,k,nt);l.canInvoke&&n.dispatch("progress",++l.finish,l.total+=v.length,u);a=n.options.__exclude__[e]={content:t,finish:!1,callbacks:[{done:i,item:u}]};s=f.create({input:v,options:n.options,onProgress:n.onProgress,onError:f.prototype.recycle,progress:l,onComplete:function(n){var u,b;if(t.decRef&&t.decRef(!1),t.__asyncLoadAssets__=k,a.finish=!0,a.err=n,!n){for(var d=Array.isArray(s.output)?s.output:[s.output],f=Object.create(null),l=0,nt=d.length;l<nt;l++)u=d[l],u&&(f[u instanceof cc.Asset?u._uuid+"@import":e+"@native"]=u);if(r){if(!o(e,t,f)&&!t.__onLoadInvoked__)try{t.onLoad&&t.onLoad();t.__onLoadInvoked__=!0}catch(i){i={};cc.error(i.message,i.stack)}h.remove(w);c.remove(w);p(e,t,void 0!==g?g:cc.assetManager.cacheAsset)}else if(t.__nativeDepend__&&!t._nativeAsset&&!o(e,t,f)&&!t.__onLoadInvoked__)try{t.onLoad&&t.onLoad();t.__onLoadInvoked__=!0}catch(i){i={};cc.error(i.message,i.stack)}s.recycle()}for(var v=a.callbacks,y=0,tt=v.length;y<tt;y++)b=v[y],t.addRef&&t.addRef(),b.item.content=t,b.done(n);v.length=0}});d.async(s)}var a=n("./pack-manager"),v=n("./pipeline"),e=n("./parser"),i=n("./utilities"),y=i.getDepends,p=i.cache,w=i.gatherAsset,o=i.setProperties,b=i.forEach,s=i.clear,k=i.checkCircleReference,r=n("./shared"),u=r.assets,h=r.files,c=r.parsed,d=r.pipeline,f=n("./task"),g=new v("loadOneAsset",[function(n,t){var i=n.output=n.input,r=i.options,f=i.isNative,e=i.uuid,o=i.file,s=r.reload;if(o||!s&&!f&&u.has(e))return t();a.load(i,n.options,function(n,r){i.file=r;t(n)})},function(n,t){var i=n.output=n.input,r=n.progress,p=n.options.__exclude__,o=i.id,w=i.file,s=i.options,f,y;if(i.isNative)e.parse(o,w,i.ext,s,function(u,f){if(u)return t(u);i.content=f;r.canInvoke&&n.dispatch("progress",++r.finish,r.total,i);h.remove(o);c.remove(o);t()});else if(f=i.uuid,f in p){var a=p[f],b=a.finish,v=a.content,d=a.err,g=a.callbacks;r.canInvoke&&n.dispatch("progress",++r.finish,r.total,i);b||k(f,f,p)?(v&&v.addRef&&v.addRef(),i.content=v,t(d)):g.push({done:t,item:i})}else!s.reload&&u.has(f)?(y=u.get(f),s.__asyncLoadAssets__||!y.__asyncLoadAssets__?(i.content=y.addRef(),r.canInvoke&&n.dispatch("progress",++r.finish,r.total,i),t()):l(n,y,t,!1)):e.parse(o,w,"import",s,function(i,r){if(i)return t(i);r._uuid=f;l(n,r,t,!0)})}]);t.exports=function(n,t){var u=!1,r,i;n.progress||(n.progress={finish:0,total:n.input.length,canInvoke:!0},u=!0);r=n.options;i=n.progress;r.__exclude__=r.__exclude__||Object.create(null);n.output=[];b(n.input,function(e,o){var s=f.create({input:e,onProgress:n.onProgress,options:r,progress:i,onComplete:function(r,f){r&&!n.isFinish&&(!cc.assetManager.force||u?(cc.error(r.message,r.stack),i.canInvoke=!1,t(r)):i.canInvoke&&n.dispatch("progress",++i.finish,i.total,f));n.output.push(f);s.recycle();o()}});g.async(s)},function(){if(r.__exclude__=null,n.isFinish)return s(n,!0),n.dispatch("error");w(n);s(n,!0);t()})}},{"./pack-manager":52,"./parser":53,"./pipeline":54,"./shared":58,"./task":59,"./utilities":61}],52:[function(n,t){"use strict";function c(n){return i.has(n.uuid)}var o=n("../platform/deserialize-compiled"),s=n("./downloader"),h=n("./cache"),u=n("../platform/js"),r=n("./shared").files,i=new h,f={unpackJson:function(n,t,i,r){var s=u.createMap(!0),l=null,f,h,c,e;if(Array.isArray(t))for((t=o.unpackJSONs(t)).length!==n.length&&cc.errorID(4915),f=0;f<n.length;f++)s[n[f]+"@import"]=t[f];else if(h=u._getClassId(cc.Texture2D),t.type===h){if(t.data)for(c=t.data.split("|"),c.length!==n.length&&cc.errorID(4915),e=0;e<n.length;e++)s[n[e]+"@import"]=o.packCustomObjData(h,c[e],!0)}else l=new Error("unmatched type pack!"),s=null;r&&r(l,s)},init:function(){i.clear()},register:function(n,t){"object"==typeof n?u.mixin(e,n):e[n]=t},unpack:function(n,t,i,r,u){t?e[i](n,t,r,u):u&&u(new Error("package data is wrong!"))},load:function(n,t,u){var o,e,h;if(n.isNative||!n.info||!n.info.packs)return s.download(n.id,n.url,n.ext,n.options,u);if(r.has(n.id))return u(null,r.get(n.id));if(o=n.info.packs,e=o.find(c),e)return i.get(e.uuid).push({onComplete:u,id:n.id});e=o[0];i.add(e.uuid,[{onComplete:u,id:n.id}]);h=cc.assetManager._transform(e.uuid,{ext:e.ext,bundle:n.config.name});s.download(e.uuid,h,e.ext,n.options,function(t,u){r.remove(e.uuid);t&&cc.error(t.message,t.stack);f.unpack(e.packs,u,e.ext,n.options,function(n,t){var f,u,s;if(!n)for(f in t)r.add(f,t[f]);for(var h=i.remove(e.uuid),o=0,c=h.length;o<c;o++)if(u=h[o],n)u.onComplete(n);else s=t[u.id],s?u.onComplete(null,s):u.onComplete(new Error("can not retrieve data from package"))})})}},e={".json":f.unpackJson};t.exports=f},{"../platform/deserialize-compiled":210,"../platform/js":216,"./cache":36,"./downloader":45,"./shared":58}],53:[function(n,t){"use strict";var s=n("../platform/CCSAXParser").plistParser,h=n("../platform/js"),c=n("./deserialize"),l=n("./cache"),a=n("./helper").isScene,f=n("./shared"),e=f.parsed,v=f.files,o=n("../platform/CCSys"),y=o.__audioSupport,p=o.capabilities,r=new l,i={parseImage:function(n,t,i){if(p.imageBitmap&&n instanceof Blob){var r={};r.imageOrientation=t.__flipY__?"flipY":"none";r.premultiplyAlpha=t.__premultiplyAlpha__?"premultiply":"none";createImageBitmap(n,r).then(function(n){n.flipY=!!t.__flipY__;n.premultiplyAlpha=!!t.__premultiplyAlpha__;i&&i(null,n)},function(n){i&&i(n,null)})}else i&&i(null,n)},parseAudio:function(n,t,i){n instanceof ArrayBuffer?y.context.decodeAudioData(n,function(n){i&&i(null,n)},function(n){i&&i(n,null)}):i&&i(null,n)},parsePVRTex:function(n,t,i){var e=null,o=null,u,r;try{if(u=n instanceof ArrayBuffer?n:n.buffer,r=new Int32Array(u,0,13),55727696!=r[0])throw new Error("Invalid magic number in PVR header");var s=r[7],h=r[6],c=r[12]+52;o={_data:new Uint8Array(u,c),_compressed:!0,width:s,height:h}}catch(f){f={};e=f}i&&i(e,o)},parsePKMTex:function(){function n(n,t){return n[t]<<8|n[t+1]}return function(t,i,r){var o=null,s=null,c,l;try{var h=t instanceof ArrayBuffer?t:t.buffer,u=new Uint8Array(h),f=n(u,6);if(0!==f&&1!==f&&3!==f)return new Error("Invalid magic number in ETC header");c=n(u,12);l=n(u,14);n(u,8);n(u,10);s={_data:new Uint8Array(h,16),_compressed:!0,width:c,height:l}}catch(e){e={};o=e}r&&r(o,s)}}(),parsePlist:function(n,t,i){var r=null,u=s.parse(n);u||(r=new Error("parse failed"));i&&i(r,u)},parseImport:function(n,t,i){if(!n)return i&&i(new Error("Json is empty"));var u,f=null;try{u=c(n,t)}catch(r){r={};f=r}i&&i(f,u)},init:function(){r.clear()},register:function(n,t){"object"==typeof n?h.mixin(u,n):u[n]=t},parse:function(n,t,i,f,o){var s,h,c;(s=e.get(n))?o(null,s):(h=r.get(n))?h.push(o):(c=u[i])?(r.add(n,[o]),c(t,f,function(t,i){t?v.remove(n):a(i)||e.add(n,i);for(var f=r.remove(n),u=0,o=f.length;u<o;u++)f[u](t,i)})):o(null,t)}},u={".png":i.parseImage,".jpg":i.parseImage,".bmp":i.parseImage,".jpeg":i.parseImage,".gif":i.parseImage,".ico":i.parseImage,".tiff":i.parseImage,".webp":i.parseImage,".image":i.parseImage,".pvr":i.parsePVRTex,".pkm":i.parsePKMTex,".mp3":i.parseAudio,".ogg":i.parseAudio,".wav":i.parseAudio,".m4a":i.parseAudio,".plist":i.parsePlist,"import":i.parseImport};t.exports=i},{"../platform/CCSAXParser":202,"../platform/CCSys":204,"../platform/js":216,"./cache":36,"./deserialize":40,"./helper":49,"./shared":58}],54:[function(n,t){"use strict";function i(n,t){if(Array.isArray(t)){this.id=u++;this.name=n;this.pipes=[];for(var i=0,r=t.length;i<r;i++)"function"==typeof t[i]&&this.pipes.push(t[i])}else cc.warn("funcs must be an array")}var r=n("./task"),u=0;i.prototype={constructor:i,insert:function(n,t){if(!("function"!=typeof n||t>this.pipes.length))return this.pipes.splice(t,0,n),this;cc.warnID(4921)},append:function(n){if("function"==typeof n)return this.pipes.push(n),this},remove:function(n){if("number"==typeof n)return this.pipes.splice(n,1),this},sync:function(n){var i=this.pipes,t,u,f;if(n instanceof r&&0!==i.length){for(null!=n.output&&(n.input=n.output,n.output=null),n._isFinish=!1,t=0,u=i.length;t<u;){if(f=i[t](n),f)return n._isFinish=!0,f;++t!==u&&(n.input=n.output,n.output=null)}return n._isFinish=!0,n.output}},async:function(n){var t=this.pipes;n instanceof r&&0!==t.length&&(null!=n.output&&(n.input=n.output,n.output=null),n._isFinish=!1,this._flow(0,n))},_flow:function(n,t){var i=this;this.pipes[n](t,function(r){r?(t._isFinish=!0,t.onComplete&&t.onComplete(r)):++n<i.pipes.length?(t.input=t.output,t.output=null,i._flow(n,t)):(t._isFinish=!0,t.onComplete&&t.onComplete(r,t.output))})}};t.exports=i},{"./task":59}],55:[function(n,t){"use strict";var u=n("./task"),r=n("./shared"),f=r.transformPipeline,i=r.RequestType;t.exports=function(n,t){var e=n.options,h=Object.create(null),c=Object.create(null),r,o,l,s,v;for(r in e)switch(r){case i.PATH:case i.UUID:case i.DIR:case i.SCENE:case i.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":h[r]=e[r];break;case"__exclude__":case"__outputAsArray__":c[r]=e[r];break;default:h[r]=e[r];c[r]=e[r]}n.options=c;o=u.create({input:n.input,options:h});l=null;try{n.output=n.source=f.sync(o)}catch(a){for(a={},l=a,s=0,v=o.output.length;s<v;s++)o.output[s].recycle()}o.recycle();t(l)}},{"./shared":58,"./task":59}],56:[function(n,t){"use strict";function s(n,t){n._uuid&&t.push(n._uuid)}function y(n,t){for(var u,i,f,h,c,e,l,o=Object.getOwnPropertyNames(n),r=0;r<o.length;r++)if(u=o[r],"node"!==u&&"__eventTargets"!==u&&(i=n[u],"object"==typeof i&&i))if(Array.isArray(i))for(f=0;f<i.length;f++)h=i[f],h instanceof cc.Asset&&s(h,t);else if(i.constructor&&i.constructor!==Object)i instanceof cc.Asset&&s(i,t);else for(c=Object.getOwnPropertyNames(i),e=0;e<c.length;e++)l=i[c[e]],l instanceof cc.Asset&&s(l,t)}function v(n,t){for(var r,i=0;i<n._components.length;i++)y(n._components[i],t);for(r=0;r<n._children.length;r++)v(n._children[r],t)}function h(n,t,u,f){var e,o;u.push(n._uuid);for(var c=r.getDeps(n._uuid),s=0,l=c.length;s<l;s++)if(e=i.get(c[s]),e){if(o=e._uuid,o in t?t[o]+=f:t[o]=e.refCount+f,u.includes(o))continue;h(e,t,u,f)}}function p(n){var t=Object.create(null),r;if(t[n._uuid]=n.refCount,h(n,t,f,-1),f.length=0,0!==t[n._uuid])return t[n._uuid];for(r in t)0!==t[r]&&h(i.get(r),t,f,1);return f.length=0,t[n._uuid]}function w(){c=!1;e.forEach(function(n){o._free(n)});e.clear()}var r=n("./depend-util"),l=n("./cache"),i,a,f,o;n("../assets/CCAsset");i=n("./shared").assets;a=n("../platform/utils").callInNextTick;f=[];var u=new l,e=new l,c=!1;o={init:function(){u.clear();e.clear()},_addPersistNodeRef:function(n){var t=[],r,e,f;for(v(n,t),r=0,e=t.length;r<e;r++)f=i.get(t[r]),f&&f.addRef();u.add(n.uuid,t)},_removePersistNodeRef:function(n){var r;if(u.has(n.uuid)){for(var f=u.get(n.uuid),t=0,e=f.length;t<e;t++)r=i.get(f[t]),r&&r.decRef();u.remove(n.uuid)}},_autoRelease:function(n,t,f){var c,o,a,e,s,k,p;if(n){for(var w=r.getDeps(n._id),h=0,d=w.length;h<d;h++)c=i.get(w[h]),c&&c.decRef(n.autoReleaseAssets);if(o=r._depends.get(n._id),o&&o.persistDeps)for(var b=o.persistDeps,l=0,g=b.length;l<g;l++)a=i.get(b[l]),a&&a.decRef(n.autoReleaseAssets);n._id!==t._id&&r.remove(n._id)}for(e=r._depends.get(t._id),e&&(e.persistDeps=[]),s=0,k=f.length;s<k;s++){for(var nt=f[s],v=u.get(nt.uuid),y=0,tt=v.length;y<tt;y++)p=i.get(v[y]),p&&p.addRef();e&&e.persistDeps.push.apply(e.persistDeps,v)}},_free:function(n,t){var u;if(e.remove(n._uuid),cc.isValid(n,!0)&&!(!t&&n.refCount>0&&p(n)>0)){i.remove(n._uuid);for(var s=r.getDeps(n._uuid),f=0,h=s.length;f<h;f++)u=i.get(s[f]),u&&(u.decRef(!1),o._free(u,!1));n.destroy();r.remove(n._uuid)}},tryRelease:function(n,t){n instanceof cc.Asset&&(t?o._free(n,t):(e.add(n._uuid,n),c||(c=!0,a(w))))}};t.exports=o},{"../assets/CCAsset":62,"../platform/utils":219,"./cache":36,"./depend-util":38,"./shared":58}],57:[function(n,t){"use strict";function i(){this._id="";this.uuid="";this.url="";this.ext=".json";this.content=null;this.file=null;this.info=null;this.config=null;this.isNative=!1;this.options=Object.create(null)}var r=[];i.prototype={constructor:i,get id(){return this._id||(this._id=this.uuid+"@"+(this.isNative?"native":"import")),this._id},recycle:function(){500!==r.length&&(this._id="",this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),r.push(this))}};i.create=function(){return 0!==r.length?r.pop():new i};t.exports=i},{}],58:[function(n,t){"use strict";var i=n("./cache"),r=n("./pipeline"),u=new i,f=new i,e=new i,o=new i,s=new r("normal load",[]),h=new r("fetch",[]),c=new r("transform url",[]);t.exports={assets:u,files:f,parsed:e,pipeline:s,fetchPipeline:h,transformPipeline:c,RequestType:{UUID:"uuid",PATH:"path",DIR:"dir",URL:"url",SCENE:"scene"},bundles:o,BuiltinBundleName:{RESOURCES:"resources",INTERNAL:"internal",MAIN:"main",START_SCENE:"start-scene"}}},{"./cache":36,"./pipeline":54}],59:[function(n,t){"use strict";function i(n){this.id=u++;this._isFinish=!0;this.onComplete=null;this.onProgress=null;this.onError=null;this.source=null;this.output=null;this.input=null;this.progress=null;this.options=null;this.set(n)}var u=0,r=[];i.prototype={constructor:i,set:function(n){n=n||Object.create(null);this.onComplete=n.onComplete;this.onProgress=n.onProgress;this.onError=n.onError;this.source=this.input=n.input;this.output=null;this.progress=n.progress;this.options=n.options||Object.create(null)},dispatch:function(n,t,i,r,u){switch(n){case"complete":this.onComplete&&this.onComplete(t,i,r,u);break;case"progress":this.onProgress&&this.onProgress(t,i,r,u);break;case"error":this.onError&&this.onError(t,i,r,u);break;default:var f="on"+n[0].toUpperCase()+n.substr(1);"function"==typeof this[f]&&this[f](t,i,r,u)}},recycle:function(){500!==r.length&&(this.onComplete=null,this.onProgress=null,this.onError=null,this.source=this.output=this.input=null,this.progress=null,this.options=null,r.push(this))},get isFinish(){return this._isFinish}};i.create=function(n){var t=null;return 0!==r.length?(t=r.pop()).set(n):t=new i(n),t};t.exports=i},{}],60:[function(n,t){"use strict";var f=n("./helper").decodeUuid,e=n("./request-item"),u=n("./shared"),r=u.RequestType,i=u.bundles;t.exports={parse:function(n){var h=n.input,p=n.options,c,t,o,l,y,a,v,w,u,s;for(h=Array.isArray(h)?h:[h],n.output=[],c=0;c<h.length;c++){if(t=h[c],o=e.create(),"string"==typeof t&&((t=Object.create(null))[p.__requestType__||r.UUID]=h[c]),"object"==typeof t)for(l in cc.js.addon(t,p),t.preset&&cc.js.addon(t,cc.assetManager.presets[t.preset]),t){switch(l){case r.UUID:if(y=o.uuid=f(t.uuid),i.has(t.bundle)){if((u=(s=i.get(t.bundle)._config).getAssetInfo(y))&&u.redirect){if(!i.has(u.redirect))throw new Error("Please load bundle "+u.redirect+" first");u=(s=i.get(u.redirect)._config).getAssetInfo(y)}o.config=s;o.info=u}o.ext=t.ext||".json";break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case r.DIR:if(i.has(t.bundle))for(a=[],i.get(t.bundle)._config.getDirWithPath(t.dir,t.type,a),v=0,w=a.length;v<w;v++)u=a[v],h.push({uuid:u.uuid,__isNative__:!1,ext:".json",bundle:t.bundle});o.recycle();o=null;break;case r.PATH:if(i.has(t.bundle)){if((u=(s=i.get(t.bundle)._config).getInfoWithPath(t.path,t.type))&&u.redirect){if(!i.has(u.redirect))throw new Error("you need to load bundle "+u.redirect+" first");u=(s=i.get(u.redirect)._config).getAssetInfo(u.uuid)}if(!u)throw o.recycle(),new Error("Bundle "+t.bundle+" doesn't contain "+t.path);o.config=s;o.uuid=u.uuid;o.info=u}o.ext=t.ext||".json";break;case r.SCENE:if(i.has(t.bundle)){if((u=(s=i.get(t.bundle)._config).getSceneInfo(t.scene))&&u.redirect){if(!i.has(u.redirect))throw new Error("you need to load bundle "+u.redirect+" first");u=(s=i.get(u.redirect)._config).getAssetInfo(u.uuid)}if(!u)throw o.recycle(),new Error("Bundle "+s.name+" doesn't contain scene "+t.scene);o.config=s;o.uuid=u.uuid;o.info=u}break;case"__isNative__":o.isNative=t.__isNative__;break;case r.URL:o.url=t.url;o.uuid=t.uuid||t.url;o.ext=t.ext||cc.path.extname(t.url);o.isNative=void 0===t.__isNative__||t.__isNative__;break;default:o.options[l]=t[l]}if(!o)break}if(o&&(n.output.push(o),!o.uuid&&!o.url))throw new Error("Can not parse this input:"+JSON.stringify(t));}return null},combine:function(n){for(var t,s,o,i,r,f,e=n.output=n.input,u=0;u<e.length;u++)t=e[u],t.url||(i=t.config,o=t.isNative?i&&i.nativeBase?i.base+i.nativeBase:cc.assetManager.generalNativeBase:i&&i.importBase?i.base+i.importBase:cc.assetManager.generalImportBase,r=t.uuid,f="",t.info&&(f=t.isNative?t.info.nativeVer?"."+t.info.nativeVer:"":t.info.ver?"."+t.info.ver:""),s=".ttf"===t.ext?o+"/"+r.slice(0,2)+"/"+r+f+"/"+t.options.__nativeName__:o+"/"+r.slice(0,2)+"/"+r+f+t.ext,t.url=s);return null}}},{"./helper":49,"./request-item":57,"./shared":58}],61:[function(n,t){"use strict";var r=n("./depend-util"),u=n("./helper"),e=u.isScene,f=u.decodeUuid,o=n("./shared").assets,s=n("../platform/utils").callInNextTick,i;n("../assets/CCAsset");i={processOptions:function(n){var t=n.uuids,s=n.paths,ot=n.types,st=n.deps,ht=n.paths=Object.create(null),u,g,nt,y,tt,p,w,rt,c,b,ut,k,ft,l,e,a,et,v,o,d,i,r;if(!1===n.debug){for(u=0,g=t.length;u<g;u++)t[u]=f(t[u]);for(nt in s)y=s[nt],tt=y[1],y[1]=ot[tt]}else{for(var it=Object.create(null),h=0,ct=t.length;h<ct;h++)p=t[h],t[h]=it[p]=f(p);t=it}for(w in s)rt=s[w],ht[t[w]]=rt;c=n.scenes;for(b in c)ut=c[b],c[b]=t[ut];k=n.packs;for(ft in k)for(l=k[ft],e=0;e<l.length;++e)l[e]=t[l[e]];if(a=n.versions,a)for(et in a)for(v=a[et],o=0;o<v.length;o+=2)d=v[o],v[o]=t[d]||d;if(i=n.redirect,i)for(r=0;r<i.length;r+=2)i[r]=t[i[r]],i[r+1]=st[i[r+1]]},clear:function(n,t){for(var i,r=0,u=n.input.length;r<u;r++)i=n.input[r],t&&!i.isNative&&i.content&&i.content.decRef&&i.content.decRef(!1),i.recycle();n.input=null},urlAppendTimestamp:function(n){return cc.assetManager.downloader.appendTimeStamp&&"string"==typeof n?/\?/.test(n)?n+"&_t="+(new Date-0):n+"?_t="+(new Date-0):n},retry:function(n,t,r,u,f){n(f=f||0,function(e,o){f++;!e||f>t?u&&u(e,o):setTimeout(function(){i.retry(n,t,r,u,f)},r)})},getDepends:function(n,t,i,u,f,e,o){var s,h,c,p,l,a,w,v;try{if(s=r.parse(n,t),h=!0,t instanceof cc.Asset&&(!t.__nativeDepend__||t._nativeAsset)&&(h=!1),f){for(c=0,p=s.deps.length;c<p;c++)l=s.deps[c],l in i||(i[l]=!0,u.push({uuid:l,bundle:o&&o.name}));h&&s.nativeDep&&(o&&(s.nativeDep.bundle=o.name),u.push(Object.assign({},s.nativeDep)))}else{for(e=!!t.asyncLoadAssets||e&&!s.preventDeferredLoadDependents,a=0,w=s.deps.length;a<w;a++)v=s.deps[a],v in i||(i[v]=!0,u.push({uuid:v,__asyncLoadAssets__:e,bundle:o&&o.name}));h&&!e&&!s.preventPreloadNativeObject&&s.nativeDep&&(o&&(s.nativeDep.bundle=o.name),u.push(Object.assign({},s.nativeDep)))}}catch(y){y={};cc.error(y.message,y.stack)}},cache:function(n,t,i){t&&!e(t)&&i&&o.add(n,t)},setProperties:function(n,t,i){var f=!1,e=t.__depends__,u,s,r,o;if(e){for(u=0,s=e.length;u<s;u++)r=e[u],o=i[r.uuid+"@import"],o?r.owner[r.prop]=o.addRef():(cc.error("The asset "+r.uuid+" is missing!"),f=!0);t.__depends__=void 0}return t.__nativeDepend__&&(t._nativeAsset||(i[n+"@native"]?t._nativeAsset=i[n+"@native"]:f=!0),t.__nativeDepend__=void 0),f},gatherAsset:function(n){var t=n.source;if(n.options.__outputAsArray__||1!==t.length)for(var r=n.output=[],i=0,u=t.length;i<u;i++)r.push(t[i].content);else n.output=t[0].content},forEach:function(n,t,i){var e=0,u=[],r,f;for(0===n.length&&i&&i(u),r=0,f=n.length;r<f;r++)t(n[r],function(n){n&&u.push(n);++e===f&&i&&i(u)})},parseParameters:function(n,t,i){if(void 0===i){var r="function"==typeof n;t?(i=t,r||(t=null)):void 0===t&&r&&(i=n,n=null,t=null);void 0!==t&&r&&(t=n,n=null)}return{options:n=n||Object.create(null),onProgress:t,onComplete:i}},parseLoadResArgs:function(n,t,i){if(void 0===i){var r=cc.js.isChildClassOf(n,cc.Asset);t?(i=t,r&&(t=null)):void 0!==t||r||(i=n,t=null,n=null);void 0===t||r||(t=n,n=null)}return{type:n,onProgress:t,onComplete:i}},checkCircleReference:function(n,t,u,f){var s,e,o,c,h;if(f||(f=Object.create(null)),!u[t]||f[t])return!1;if(f[t]=!0,s=!1,e=r.getDeps(t),e)for(o=0,c=e.length;o<c;o++)if(h=e[o],h===n||i.checkCircleReference(n,h,u,f)){s=!0;break}return s},asyncify:function(n){return function(t,i){if(n){var r=[];Array.isArray(i)?i.forEach(function(n){return n instanceof cc.Asset&&r.push(n.addRef())}):i instanceof cc.Asset&&r.push(i.addRef());s(function(){r.forEach(function(n){return n.decRef(!1)});n(t,i)})}}}};t.exports=i},{"../assets/CCAsset":62,"../platform/utils":219,"./depend-util":38,"./helper":49,"./shared":58}],62:[function(n,t){"use strict";var i=n("../platform/CCObject");cc.Asset=cc.Class({name:"cc.Asset","extends":i,ctor:function(){Object.defineProperty(this,"_uuid",{value:"",writable:!0});this.loaded=!0;this._nativeUrl="";this._ref=0},properties:{nativeUrl:{get:function(){if(!this._nativeUrl&&this._native){var n=this._native;if(47===n.charCodeAt(0))return n.slice(1);this._nativeUrl=46===n.charCodeAt(0)?cc.assetManager.utils.getUrlWithUuid(this._uuid,{nativeExt:n,isNative:!0}):cc.assetManager.utils.getUrlWithUuid(this._uuid,{__nativeName__:n,nativeExt:cc.path.extname(n),isNative:!0})}return this._nativeUrl},visible:!1},refCount:{get:function(){return this._ref}},_native:"",_nativeAsset:{get:function(){return this._$nativeAsset},set:function(n){this._$nativeAsset=n}},_nativeDep:{get:function(){if(this._native)return{__isNative__:!0,uuid:this._uuid,ext:this._native}}}},statics:{deserialize:!1,preventDeferredLoadDependents:!1,preventPreloadNativeObject:!1},toString:function(){return this.nativeUrl},serialize:!1,createNode:null,_setRawAsset:function(n,t){this._native=!1!==t?n||void 0:"/"+n},addRef:function(){return this._ref++,this},decRef:function(n){return this._ref>0&&this._ref--,!1!==n&&cc.assetManager._releaseManager.tryRelease(this),this}});t.exports=cc.Asset},{"../platform/CCObject":201}],63:[function(n,t){"use strict";var u=n("./CCAsset"),f=n("../event/event-target"),i=cc.Enum({WEB_AUDIO:0,DOM_AUDIO:1}),r=cc.Class({name:"cc.AudioClip","extends":u,mixins:[f],ctor:function(){this._loading=!1;this.loaded=!1;this._audio=null},properties:{duration:0,loadMode:{"default":i.WEB_AUDIO,type:i},_nativeAsset:{get:function(){return this._audio},set:function(n){this._audio=n instanceof cc.AudioClip?n._nativeAsset:n;this._audio&&(this.loaded=!0,this.emit("load"))},override:!0},_nativeDep:{get:function(){return{uuid:this._uuid,audioLoadMode:this.loadMode,ext:cc.path.extname(this._native),__isNative__:!0}},override:!0}},statics:{LoadMode:i,_loadByUrl:function(n,t){var i=cc.assetManager.assets.get(n);i?t(null,i):cc.assetManager.loadRemote(n,function(n,i){if(n)return t(n);t(null,i)})}},_ensureLoaded:function(n){if(this.loaded)return n&&n();if(n&&this.once("load",n),!this._loading){this._loading=!0;var t=this;cc.assetManager.postLoadNative(this,function(){t._loading=!1})}},destroy:function(){cc.audioEngine.uncache(this);this._super()}});cc.AudioClip=r;t.exports=r},{"../event/event-target":142,"./CCAsset":62}],64:[function(n,t){"use strict";var r=function(){this.u=0;this.v=0;this.w=0;this.h=0;this.offsetX=0;this.offsetY=0;this.textureID=0;this.valid=!1;this.xAdvance=0},i=function(n){this._letterDefinitions={};this._texture=n},u;i.prototype={constructor:i,addLetterDefinitions:function(n,t){this._letterDefinitions[n]=t},cloneLetterDefinition:function(){var i={},n,t;for(n in this._letterDefinitions)t=new r,cc.js.mixin(t,this._letterDefinitions[n]),i[n]=t;return i},getTexture:function(){return this._texture},getLetter:function(n){return this._letterDefinitions[n]},getLetterDefinitionForChar:function(n){var t=n.charCodeAt(0);return this._letterDefinitions.hasOwnProperty(t)?this._letterDefinitions[t]:null},clear:function(){this._letterDefinitions={}}};u=cc.Class({name:"cc.BitmapFont","extends":cc.Font,properties:{fntDataStr:{"default":""},spriteFrame:{"default":null,type:cc.SpriteFrame},fontSize:{"default":-1},_fntConfig:null,_fontDefDictionary:null},onLoad:function(){var o=this.spriteFrame,e,t,u,n,f;if(this._fontDefDictionary||(this._fontDefDictionary=new i,o&&(this._fontDefDictionary._texture=o._texture)),e=this._fntConfig,e){t=e.fontDefDictionary;for(u in t)n=new r,f=t[u].rect,n.offsetX=t[u].xOffset,n.offsetY=t[u].yOffset,n.w=f.width,n.h=f.height,n.u=f.x,n.v=f.y,n.textureID=0,n.valid=!0,n.xAdvance=t[u].xAdvance,this._fontDefDictionary.addLetterDefinitions(u,n)}}});cc.BitmapFont=u;cc.BitmapFont.FontLetterDefinition=r;cc.BitmapFont.FontAtlas=i;t.exports=u},{}],65:[function(n,t){"use strict";var i=cc.Class({name:"cc.BufferAsset","extends":cc.Asset,ctor:function(){this._buffer=null},properties:{_nativeAsset:{get:function(){return this._buffer},set:function(n){this._buffer=n.buffer||n},override:!0},buffer:function(){return this._buffer}}});cc.BufferAsset=t.exports=i},{}],66:[function(n,t){"use strict";var i=cc.Class({name:"cc.Font","extends":cc.Asset});cc.Font=t.exports=i},{}],67:[function(n,t){"use strict";var i=cc.Class({name:"cc.JsonAsset","extends":cc.Asset,properties:{json:null}});t.exports=cc.JsonAsset=i},{}],68:[function(n,t){"use strict";var i=cc.Class({name:"cc.LabelAtlas","extends":cc.BitmapFont,onLoad:function(){this.spriteFrame?this._fntConfig?this._super():cc.warnID(9101,this.name):cc.warnID(9100,this.name)}});cc.LabelAtlas=i;t.exports=i},{}],69:[function(n,t){"use strict";var i=cc.Enum({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2}),r=cc.Class({name:"cc.Prefab","extends":cc.Asset,ctor:function(){this._createFunction=null;this._instantiatedTimes=0},properties:{data:null,optimizationPolicy:i.AUTO,asyncLoadAssets:!1,readonly:{"default":!1,editorOnly:!0}},statics:{OptimizationPolicy:i,OptimizationPolicyThreshold:3},createNode:!1,compileCreateFunction:function(){var t=n("../platform/instantiate-jit");this._createFunction=t.compile(this.data)},_doInstantiate:function(n){return this.data._prefab||cc.warnID(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(n)},_instantiate:function(){var n;return n=this.data._instantiate(),++this._instantiatedTimes,n},destroy:function(){this.data&&this.data.destroy();this._super()}});cc.Prefab=t.exports=r;cc.js.obsolete(cc,"cc._Prefab","Prefab")},{"../platform/instantiate-jit":214}],70:[function(n,t){"use strict";var r,i=(r=n("../../renderer/gfx"))&&r.__esModule?r:{"default":r},u=n("../renderer"),f=n("./CCTexture2D"),e=cc.Enum({RB_FMT_D24S8:i.default.RB_FMT_D24S8,RB_FMT_S8:i.default.RB_FMT_S8,RB_FMT_D16:i.default.RB_FMT_D16}),o=cc.Class({name:"cc.RenderTexture","extends":f,statics:{DepthStencilFormat:e},ctor:function(){this._framebuffer=null},initWithSize:function(n,t,r){this.width=Math.floor(n||cc.visibleRect.width);this.height=Math.floor(t||cc.visibleRect.height);this._resetUnderlyingMipmaps();var f,e={colors:[this._texture]};this._depthStencilBuffer&&this._depthStencilBuffer.destroy();r&&(f=new i.default.RenderBuffer(u.device,r,n,t),r===i.default.RB_FMT_D24S8?e.depthStencil=f:r===i.default.RB_FMT_S8?e.stencil=f:r===i.default.RB_FMT_D16&&(e.depth=f));this._depthStencilBuffer=f;this._framebuffer&&this._framebuffer.destroy();this._framebuffer=new i.default.FrameBuffer(u.device,n,t,e);this._packable=!1;this.loaded=!0;this.emit("load")},updateSize:function(n,t){this.width=Math.floor(n||cc.visibleRect.width);this.height=Math.floor(t||cc.visibleRect.height);this._resetUnderlyingMipmaps();var i=this._depthStencilBuffer;i&&i.update(this.width,this.height);this._framebuffer._width=n;this._framebuffer._height=t},drawTextureAt:function(n,t,i){n._image&&0!==n._image.width&&this._texture.updateSubImage({x:t,y:i,image:n._image,width:n.width,height:n.height,level:0,flipY:!1,premultiplyAlpha:n._premultiplyAlpha})},readPixels:function(n,t,i,r,u){var e,o,f,s;return!this._framebuffer||!this._texture?n:(t=t||0,i=i||0,e=r||this.width,o=u||this.height,n=n||new Uint8Array(e*o*4),f=cc.game._renderContext,s=f.getParameter(f.FRAMEBUFFER_BINDING),f.bindFramebuffer(f.FRAMEBUFFER,this._framebuffer.getHandle()),f.readPixels(t,i,e,o,f.RGBA,f.UNSIGNED_BYTE,n),f.bindFramebuffer(f.FRAMEBUFFER,s),n)},destroy:function(){this._super();this._framebuffer&&(this._framebuffer.destroy(),this._framebuffer=null)}});cc.RenderTexture=t.exports=o},{"../../renderer/gfx":317,"../renderer":226,"./CCTexture2D":77}],71:[function(n,t){"use strict";var i=cc.Class({name:"cc.SceneAsset","extends":cc.Asset,properties:{scene:null,asyncLoadAssets:void 0}});cc.SceneAsset=i;t.exports=i},{}],72:[function(){"use strict";var n=cc.Class({name:"cc.Script","extends":cc.Asset}),t,i;cc._Script=n;t=cc.Class({name:"cc.JavaScript","extends":n});cc._JavaScript=t;i=cc.Class({name:"cc.TypeScript","extends":n});cc._TypeScript=i},{}],73:[function(n,t){"use strict";var i=cc.Class({name:"cc.SpriteAtlas","extends":cc.Asset,properties:{_spriteFrames:{"default":{}}},getTexture:function(){var t=Object.keys(this._spriteFrames),n;return t.length>0?(n=this._spriteFrames[t[0]],n?n.getTexture():null):null},getSpriteFrame:function(n){var t=this._spriteFrames[n];return t?(t.name||(t.name=n),t):null},getSpriteFrames:function(){var n=[],t=this._spriteFrames;for(var i in t)n.push(this.getSpriteFrame(i));return n}});cc.SpriteAtlas=i;t.exports=i},{}],74:[function(n,t){"use strict";var f=n("../event/event-target"),i=[{u:0,v:0},{u:0,v:0},{u:0,v:0},{u:0,v:0}],u=cc.Class({name:"cc.SpriteFrame","extends":n("../assets/CCAsset"),mixins:[f],properties:{_textureSetter:{set:function(n){n&&this._texture!==n&&this._refreshTexture(n)}},insetTop:{get:function(){return this._capInsets[1]},set:function(n){this._capInsets[1]=n;this._texture&&this._calculateSlicedUV()}},insetBottom:{get:function(){return this._capInsets[3]},set:function(n){this._capInsets[3]=n;this._texture&&this._calculateSlicedUV()}},insetLeft:{get:function(){return this._capInsets[0]},set:function(n){this._capInsets[0]=n;this._texture&&this._calculateSlicedUV()}},insetRight:{get:function(){return this._capInsets[2]},set:function(n){this._capInsets[2]=n;this._texture&&this._calculateSlicedUV()}}},ctor:function(){f.call(this);var n=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3],u=arguments[4];this._rect=null;this.uv=[];this._texture=null;this._original=null;this._offset=null;this._originalSize=null;this._rotated=!1;this._flipX=!1;this._flipY=!1;this.vertices=null;this._capInsets=[0,0,0,0];this.uvSliced=[];void 0!==n&&this.setTexture(n,t,i,r,u)},textureLoaded:function(){return this._texture&&this._texture.loaded},onTextureLoaded:function(n,t){return this.textureLoaded()?(n.call(t),!0):(this.once("load",n,t),this.ensureLoadTexture(),!1)},isRotated:function(){return this._rotated},setRotated:function(n){this._rotated=n;this._texture&&this._calculateUV()},isFlipX:function(){return this._flipX},isFlipY:function(){return this._flipY},setFlipX:function(n){this._flipX=n;this._texture&&this._calculateUV()},setFlipY:function(n){this._flipY=n;this._texture&&this._calculateUV()},getRect:function(){return cc.rect(this._rect)},setRect:function(n){this._rect=n;this._texture&&this._calculateUV()},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(n){this._originalSize?(this._originalSize.width=n.width,this._originalSize.height=n.height):this._originalSize=cc.size(n)},getTexture:function(){return this._texture},_textureLoadedCallback:function(){var n=this._texture,t,i;n&&(t=n.width,i=n.height,this._rect?this._checkRect(this._texture):this._rect=cc.rect(0,0,t,i),this._originalSize||this.setOriginalSize(cc.size(t,i)),this._offset||this.setOffset(cc.v2(0,0)),this._calculateUV(),this.emit("load"))},_refreshTexture:function(n){this._texture=n;n.loaded?this._textureLoadedCallback():n.once("load",this._textureLoadedCallback,this)},getOffset:function(){return cc.v2(this._offset)},setOffset:function(n){this._offset=cc.v2(n)},clone:function(){return new u(this._texture,this.getRect(),this._rotated,this.getOffset(),this.getOriginalSize())},setTexture:function(n,t,i,r,u){if(1!==arguments.length||n!==this._texture){if(this._rect=t||null,r?this.setOffset(r):this._offset=null,u?this.setOriginalSize(u):this._originalSize=null,this._rotated=i||!1,"string"!=typeof n)return n instanceof cc.Texture2D&&this._refreshTexture(n),!0;cc.errorID(3401)}},ensureLoadTexture:function(){this._texture&&(this._texture.loaded||(this._refreshTexture(this._texture),cc.assetManager.postLoadNative(this._texture)))},_checkRect:function(n){var t=this._rect,i=t.x,r=t.y;this._rotated?(i+=t.height,r+=t.width):(i+=t.width,r+=t.height);i>n.width&&cc.errorID(3300,n.nativeUrl+"/"+this.name,i,n.width);r>n.height&&cc.errorID(3400,n.nativeUrl+"/"+this.name,r,n.height)},_flipXY:function(n){var t,i;this._flipX&&(t=n[0],n[0]=n[1],n[1]=t,t=n[2],n[2]=n[3],n[3]=t);this._flipY&&(i=n[0],n[0]=n[2],n[2]=i,i=n[1],n[1]=n[3],n[3]=i)},_calculateSlicedUV:function(){var n=this._rect,t=this._texture.width,r=this._texture.height,u=this._capInsets[0],k=this._capInsets[2],a=n.width-u-k,h=this._capInsets[1],c=this._capInsets[3],v=n.height-h-c,l=this.uvSliced,f,y,e,p,o,w,s,b;if(l.length=0,this._rotated)for(i[0].u=n.x/t,i[1].u=(n.x+c)/t,i[2].u=(n.x+c+v)/t,i[3].u=(n.x+n.height)/t,i[3].v=n.y/r,i[2].v=(n.y+u)/r,i[1].v=(n.y+u+a)/r,i[0].v=(n.y+n.width)/r,this._flipXY(i),f=0;f<4;++f)for(y=i[f],e=0;e<4;++e)p=i[3-e],l.push({u:y.u,v:p.v});else for(i[0].u=n.x/t,i[1].u=(n.x+u)/t,i[2].u=(n.x+u+a)/t,i[3].u=(n.x+n.width)/t,i[3].v=n.y/r,i[2].v=(n.y+h)/r,i[1].v=(n.y+h+v)/r,i[0].v=(n.y+n.height)/r,this._flipXY(i),o=0;o<4;++o)for(w=i[o],s=0;s<4;++s)b=i[s],l.push({u:b.u,v:w.v})},_setDynamicAtlasFrame:function(n){n&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=n.texture,this._rect.x=n.x,this._rect.y=n.y,this._calculateUV())},_resetDynamicAtlasFrame:function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())},_calculateUV:function(){var t=this._rect,s=this._texture,n=this.uv,i=s.width,r=s.height,f,e,u,o;if(this._rotated){var h=0===i?0:t.x/i,c=0===i?0:(t.x+t.height)/i,l=0===r?0:(t.y+t.width)/r,a=0===r?0:t.y/r;n[0]=h;n[1]=a;n[2]=h;n[3]=l;n[4]=c;n[5]=a;n[6]=c;n[7]=l}else{var v=0===i?0:t.x/i,y=0===i?0:(t.x+t.width)/i,p=0===r?0:(t.y+t.height)/r,w=0===r?0:t.y/r;n[0]=v;n[1]=p;n[2]=y;n[3]=p;n[4]=v;n[5]=w;n[6]=y;n[7]=w}if(this._flipX&&(f=n[0],n[0]=n[2],n[2]=f,f=n[1],n[1]=n[3],n[3]=f,f=n[4],n[4]=n[6],n[6]=f,f=n[5],n[5]=n[7],n[7]=f),this._flipY&&(e=n[0],n[0]=n[4],n[4]=e,e=n[1],n[1]=n[5],n[5]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[3],n[3]=n[7],n[7]=e),u=this.vertices,u)for(u.nu.length=0,u.nv.length=0,o=0;o<u.u.length;o++)u.nu[o]=u.u[o]/i,u.nv[o]=u.v[o]/r;this._calculateSlicedUV()},_serialize:!1,_deserialize:function(n){var i=n.rect,t;i&&(this._rect=new cc.Rect(i[0],i[1],i[2],i[3]));n.offset&&this.setOffset(new cc.Vec2(n.offset[0],n.offset[1]));n.originalSize&&this.setOriginalSize(new cc.Size(n.originalSize[0],n.originalSize[1]));this._rotated=1===n.rotated;this._name=n.name;t=n.capInsets;t&&(this._capInsets[0]=t[0],this._capInsets[1]=t[1],this._capInsets[2]=t[2],this._capInsets[3]=t[3]);this.vertices=n.vertices;this.vertices&&(this.vertices.nu=[],this.vertices.nv=[])}}),r=u.prototype;r.copyWithZone=r.clone;r.copy=r.clone;r.initWithTexture=r.setTexture;cc.SpriteFrame=u;t.exports=u},{"../assets/CCAsset":62,"../event/event-target":142}],75:[function(n,t){"use strict";var i=n("./CCFont"),r=cc.Class({name:"cc.TTFFont","extends":i,properties:{_fontFamily:null,_nativeAsset:{type:cc.String,get:function(){return this._fontFamily},set:function(n){this._fontFamily=n||"Arial"},override:!0},_nativeDep:{get:function(){return{uuid:this._uuid,__nativeName__:this._native,ext:cc.path.extname(this._native),__isNative__:!0}},override:!0}}});cc.TTFFont=t.exports=r},{"./CCFont":66}],76:[function(n,t){"use strict";var i=cc.Class({name:"cc.TextAsset","extends":cc.Asset,properties:{text:""},toString:function(){return this.text}});t.exports=cc.TextAsset=i},{}],77:[function(n,t){"use strict";function e(){for(var n in l)l[n]=void 0;return c.length=0,l.images=c,l}var h,r=(h=n("../../renderer/gfx"))&&h.__esModule?h:{"default":h},y=n("../event/event-target"),f=n("../renderer"),a;n("../platform/CCClass");var p=new(n("../platform/id-generater"))("Tex"),v=1024,i=cc.Enum({RGB565:r.default.TEXTURE_FMT_R5_G6_B5,RGB5A1:r.default.TEXTURE_FMT_R5_G5_B5_A1,RGBA4444:r.default.TEXTURE_FMT_R4_G4_B4_A4,RGB888:r.default.TEXTURE_FMT_RGB8,RGBA8888:r.default.TEXTURE_FMT_RGBA8,RGBA32F:r.default.TEXTURE_FMT_RGBA32F,A8:r.default.TEXTURE_FMT_A8,I8:r.default.TEXTURE_FMT_L8,AI8:r.default.TEXTURE_FMT_L8_A8,RGB_PVRTC_2BPPV1:r.default.TEXTURE_FMT_RGB_PVRTC_2BPPV1,RGBA_PVRTC_2BPPV1:r.default.TEXTURE_FMT_RGBA_PVRTC_2BPPV1,RGB_A_PVRTC_2BPPV1:v++,RGB_PVRTC_4BPPV1:r.default.TEXTURE_FMT_RGB_PVRTC_4BPPV1,RGBA_PVRTC_4BPPV1:r.default.TEXTURE_FMT_RGBA_PVRTC_4BPPV1,RGB_A_PVRTC_4BPPV1:v++,RGB_ETC1:r.default.TEXTURE_FMT_RGB_ETC1,RGBA_ETC1:v++,RGB_ETC2:r.default.TEXTURE_FMT_RGB_ETC2,RGBA_ETC2:r.default.TEXTURE_FMT_RGBA_ETC2}),o=cc.Enum({REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648}),s=cc.Enum({LINEAR:9729,NEAREST:9728}),u={9728:0,9729:1},c=[],l={width:void 0,height:void 0,minFilter:void 0,magFilter:void 0,wrapS:void 0,wrapT:void 0,format:void 0,genMipmaps:void 0,images:void 0,image:void 0,flipY:void 0,premultiplyAlpha:void 0};a=cc.Class({name:"cc.Texture2D","extends":n("../assets/CCAsset"),mixins:[y],properties:{_nativeAsset:{get:function(){return this._image},set:function(n){n._compressed&&n._data?this.initWithData(n._data,this._format,n.width,n.height):this.initWithElement(n)},override:!0},_format:i.RGBA8888,_premultiplyAlpha:!1,_flipY:!1,_minFilter:s.LINEAR,_magFilter:s.LINEAR,_mipFilter:s.LINEAR,_wrapS:o.CLAMP_TO_EDGE,_wrapT:o.CLAMP_TO_EDGE,_isAlphaAtlas:!1,_genMipmaps:!1,genMipmaps:{get:function(){return this._genMipmaps},set:function(n){if(this._genMipmaps!==n){var t=e();t.genMipmaps=n;this.update(t)}}},_packable:!0,packable:{get:function(){return this._packable},set:function(n){this._packable=n}},_nativeDep:{get:function(){return{__isNative__:!0,uuid:this._uuid,ext:this._native,__flipY__:this._flipY,__premultiplyAlpha__:this._premultiplyAlpha}},override:!0}},statics:{PixelFormat:i,WrapMode:o,Filter:s,_FilterIndex:u,extnames:[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm"],_parseExt:function(n,t){for(var f,r,e,u,o=cc.renderer.device,c=n.split("_"),s="",l="",v=999,y=t,p=cc.macro.SUPPORT_TEXTURE_FORMATS,h=0;h<c.length;h++)if(f=c[h].split("@"),r=f[0],r=a.extnames[r.charCodeAt(0)-48]||r,e=p.indexOf(r),-1!==e&&e<v){if(u=f[1]?parseInt(f[1]):t,".pvr"===r&&!o.ext("WEBGL_compressed_texture_pvrtc"))continue;if(!(u!==i.RGB_ETC1&&u!==i.RGBA_ETC1||o.ext("WEBGL_compressed_texture_etc1")))continue;if(!(u!==i.RGB_ETC2&&u!==i.RGBA_ETC2||o.ext("WEBGL_compressed_texture_etc")))continue;if(".webp"===r&&!cc.sys.capabilities.webp)continue;v=e;l=r;y=u}else s||(s=r);return{bestExt:l,bestFormat:y,defaultExt:s}}},ctor:function(){this._id=p.getNewId();this.loaded=!1;this.width=0;this.height=0;this._hashDirty=!0;this._hash=0;this._texture=null},getImpl:function(){return this._texture||(this._texture=new f.Texture2D(f.device,{})),this._texture},getId:function(){return this._id},toString:function(){return this.nativeUrl||""},update:function(n){if(n){var t=!1;void 0!==n.width&&(this.width=n.width);void 0!==n.height&&(this.height=n.height);void 0!==n.minFilter&&(this._minFilter=n.minFilter,n.minFilter=u[n.minFilter]);void 0!==n.magFilter&&(this._magFilter=n.magFilter,n.magFilter=u[n.magFilter]);void 0!==n.mipFilter&&(this._mipFilter=n.mipFilter,n.mipFilter=u[n.mipFilter]);void 0!==n.wrapS&&(this._wrapS=n.wrapS);void 0!==n.wrapT&&(this._wrapT=n.wrapT);void 0!==n.format&&(this._format=n.format);void 0!==n.flipY&&(this._flipY=n.flipY,t=!0);void 0!==n.premultiplyAlpha&&(this._premultiplyAlpha=n.premultiplyAlpha,t=!0);void 0!==n.genMipmaps&&(this._genMipmaps=n.genMipmaps);cc.sys.capabilities.imageBitmap&&this._image instanceof ImageBitmap?this._checkImageBitmap(this._upload.bind(this,n,t)):this._upload(n,t)}},_upload:function(n,t){t&&this._image&&(n.image=this._image);n.images&&n.images.length>0?this._image=n.images[0]:void 0!==n.image&&(this._image=n.image,n.images||(c.length=0,n.images=c),n.images.push(n.image));this._texture&&this._texture.update(n);this._hashDirty=!0},initWithElement:function(n){if(n)if(this._image=n,n.complete||n instanceof HTMLCanvasElement)this.handleLoadedTexture();else if(cc.sys.capabilities.imageBitmap&&n instanceof ImageBitmap)this._checkImageBitmap(this.handleLoadedTexture.bind(this));else{var t=this;n.addEventListener("load",function(){t.handleLoadedTexture()});n.addEventListener("error",function(n){cc.warnID(3119,n.message)})}},initWithData:function(n,t,i,r){var o=e();return o.image=n,o.images=[o.image],o.genMipmaps=this._genMipmaps,o.premultiplyAlpha=this._premultiplyAlpha,o.flipY=this._flipY,o.minFilter=u[this._minFilter],o.magFilter=u[this._magFilter],o.wrapS=this._wrapS,o.wrapT=this._wrapT,o.format=this._getGFXPixelFormat(t),o.width=i,o.height=r,this._texture?this._texture.update(o):this._texture=new f.Texture2D(f.device,o),this.width=i,this.height=r,this._updateFormat(),this._checkPackable(),this.loaded=!0,this.emit("load"),!0},getHtmlElementObj:function(){return this._image},destroy:function(){cc.sys.capabilities.imageBitmap&&this._image instanceof ImageBitmap&&this._image.close&&this._image.close();this._packable&&cc.dynamicAtlasManager&&cc.dynamicAtlasManager.deleteAtlasTexture(this);this._image=null;this._texture&&this._texture.destroy();this._super()},getPixelFormat:function(){return this._format},hasPremultipliedAlpha:function(){return this._premultiplyAlpha||!1},isAlphaAtlas:function(){return this._isAlphaAtlas},handleLoadedTexture:function(){if(this._image&&this._image.width&&this._image.height){this.width=this._image.width;this.height=this._image.height;var n=e();n.image=this._image;n.images=[n.image];n.width=this.width;n.height=this.height;n.genMipmaps=this._genMipmaps;n.format=this._getGFXPixelFormat(this._format);n.premultiplyAlpha=this._premultiplyAlpha;n.flipY=this._flipY;n.minFilter=u[this._minFilter];n.magFilter=u[this._magFilter];n.wrapS=this._wrapS;n.wrapT=this._wrapT;this._texture?this._texture.update(n):this._texture=new f.Texture2D(f.device,n);this._updateFormat();this._checkPackable();this.loaded=!0;this.emit("load");cc.macro.CLEANUP_IMAGE_CACHE&&(this._image instanceof HTMLImageElement?this._clearImage():cc.sys.capabilities.imageBitmap&&this._image instanceof ImageBitmap&&this._image.close&&this._image.close())}},description:function(){return"<cc.Texture2D | Name = "+this.nativeUrl+" | Dimensions = "+this.width+" x "+this.height+">"},releaseTexture:function(){this._image=null;this._texture&&this._texture.destroy()},setWrapMode:function(n,t){if(this._wrapS!==n||this._wrapT!==t){var i=e();i.wrapS=n;i.wrapT=t;this.update(i)}},setFilters:function(n,t){if(this._minFilter!==n||this._magFilter!==t){var i=e();i.minFilter=n;i.magFilter=t;this.update(i)}},setFlipY:function(n){if(this._flipY!==n){var t=e();t.flipY=n;t.premultiplyAlpha=this._premultiplyAlpha;this.update(t)}},setPremultiplyAlpha:function(n){if(this._premultiplyAlpha!==n){var t=e();t.flipY=this._flipY;t.premultiplyAlpha=n;this.update(t)}},_updateFormat:function(){this._isAlphaAtlas=this._format===i.RGBA_ETC1||this._format===i.RGB_A_PVRTC_4BPPV1||this._format===i.RGB_A_PVRTC_2BPPV1},_checkPackable:function(){var n=cc.dynamicAtlasManager,t,i;n&&(this._isCompressed()?this._packable=!1:(t=this.width,i=this.height,!this._image||t>n.maxFrameSize||i>n.maxFrameSize||this._getHash()!==n.Atlas.DEFAULT_HASH?this._packable=!1:this._image&&this._image instanceof HTMLCanvasElement&&(this._packable=!0)))},_getOpts:function(){var n=e();return n.width=this.width,n.height=this.height,n.genMipmaps=this._genMipmaps,n.format=this._format,n.premultiplyAlpha=this._premultiplyAlpha,n.anisotropy=this._anisotropy,n.flipY=this._flipY,n.minFilter=u[this._minFilter],n.magFilter=u[this._magFilter],n.mipFilter=u[this._mipFilter],n.wrapS=this._wrapS,n.wrapT=this._wrapT,n},_getGFXPixelFormat:function(n){return n===i.RGBA_ETC1?n=i.RGB_ETC1:n===i.RGB_A_PVRTC_4BPPV1?n=i.RGB_PVRTC_4BPPV1:n===i.RGB_A_PVRTC_2BPPV1&&(n=i.RGB_PVRTC_2BPPV1),n},_resetUnderlyingMipmaps:function(n){var t=this._getOpts();t.images=n||[null];this._texture?this._texture.update(t):this._texture=new f.Texture2D(f.device,t)},_serialize:!1,_deserialize:function(n){var t=n.split(","),r=t[0],i;if(r)if(i=a._parseExt(r,this._format),i.bestExt)this._setRawAsset(i.bestExt),this._format=i.bestFormat;else{if(!i.defaultExt)throw new Error(cc.debug.getError(3121));this._setRawAsset(i.defaultExt);cc.warnID(3120,i.defaultExt,i.defaultExt)}8===t.length&&(this._minFilter=parseInt(t[1]),this._magFilter=parseInt(t[2]),this._wrapS=parseInt(t[3]),this._wrapT=parseInt(t[4]),this._premultiplyAlpha=49===t[5].charCodeAt(0),this._genMipmaps=49===t[6].charCodeAt(0),this._packable=49===t[7].charCodeAt(0))},_getHash:function(){if(!this._hashDirty)return this._hash;var n=this._genMipmaps?1:0,t=this._premultiplyAlpha?1:0,i=this._flipY?1:0,r=this._minFilter===s.LINEAR?1:2,u=this._magFilter===s.LINEAR?1:2,f=this._wrapS===o.REPEAT?1:this._wrapS===o.CLAMP_TO_EDGE?2:3,e=this._wrapT===o.REPEAT?1:this._wrapT===o.CLAMP_TO_EDGE?2:3,h=this._format;return this._image,this._hash=Number(""+r+u+h+f+e+n+t+i),this._hashDirty=!1,this._hash},_isCompressed:function(){return this._format<i.A8||this._format>i.RGBA32F},_clearImage:function(){this._image.src=""},_checkImageBitmap:function(n){var u=this,t=this._image,i=this._flipY,r=this._premultiplyAlpha;this._flipY!==t.flipY||this._premultiplyAlpha!==t.premultiplyAlpha?createImageBitmap(t,{imageOrientation:i!==t.flipY?"flipY":"none",premultiplyAlpha:r?"premultiply":"none"}).then(function(f){t.close&&t.close();f.flipY=i;f.premultiplyAlpha=r;u._image=f;n()},function(n){cc.error(n.message)}):n()}});cc.Texture2D=t.exports=a},{"../../renderer/gfx":317,"../assets/CCAsset":62,"../event/event-target":142,"../platform/CCClass":195,"../platform/id-generater":212,"../renderer":226}],78:[function(n){"use strict";n("./CCAsset");n("./CCFont");n("./CCPrefab");n("./CCAudioClip");n("./CCScripts");n("./CCSceneAsset");n("./CCSpriteFrame");n("./CCTexture2D");n("./CCRenderTexture");n("./CCTTFFont");n("./CCSpriteAtlas");n("./CCBitmapFont");n("./CCLabelAtlas");n("./CCTextAsset");n("./CCJsonAsset");n("./CCBufferAsset");n("./material")},{"./CCAsset":62,"./CCAudioClip":63,"./CCBitmapFont":64,"./CCBufferAsset":65,"./CCFont":66,"./CCJsonAsset":67,"./CCLabelAtlas":68,"./CCPrefab":69,"./CCRenderTexture":70,"./CCSceneAsset":71,"./CCScripts":72,"./CCSpriteAtlas":73,"./CCSpriteFrame":74,"./CCTTFFont":75,"./CCTextAsset":76,"./CCTexture2D":77,"./material":85}],79:[function(n,t){"use strict";var i,r=(i=n("../CCAsset"))&&i.__esModule?i:{"default":i},u=n("./effect-parser"),f=cc.Class({name:"cc.EffectAsset","extends":r.default,ctor:function(){this._effect=null},properties:{properties:Object,techniques:[],shaders:[]},onLoad:function(){if(cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS){for(var t=cc.renderer._forward._programLib,n=0;n<this.shaders.length;n++)t.define(this.shaders[n]);this._initEffect()}},_initEffect:function(){this._effect||(this._effect=u.parseEffect(this),Object.freeze(this._effect))},getInstantiatedEffect:function(){return this._initEffect(),this._effect.clone()},getEffect:function(){return this._initEffect(),this._effect}});t.exports=cc.EffectAsset=f},{"../CCAsset":62,"./effect-parser":82}],80:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var e=n("../CCAsset"),f=n("../CCTexture2D"),o=(f.PixelFormat,n("./CCEffectAsset")),r=(n("../../utils/texture-util"),cc.gfx),s=cc.Enum({SPRITE:"2d-sprite",GRAY_SPRITE:"2d-gray-sprite",UNLIT:"unlit"}),u=cc.Class({name:"cc.Material","extends":e,ctor:function(){this.loaded=!1;this._manualHash=!1;this._dirty=!0;this._effect=null},properties:{_defines:{"default":void 0,type:Object},_props:{"default":void 0,type:Object},_effectAsset:{type:o,"default":null},_techniqueIndex:0,_techniqueData:Object,effectName:void 0,effectAsset:{get:function(){return this._effectAsset},set:function(n){cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS&&(this._effectAsset=n,n?this._effect=this._effectAsset.getInstantiatedEffect():cc.error("Can not set an empty effect asset."))}},effect:{get:function(){return this._effect}},techniqueIndex:{get:function(){return this._techniqueIndex},set:function(n){this._techniqueIndex=n;this._effect.switchTechnique(n)}}},statics:{getBuiltinMaterial:function(n){return cc.game.renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Material:cc.assetManager.builtins.getBuiltin("material","builtin-"+n)},BUILTIN_NAME:s,createWithBuiltin:function(n,t){void 0===t&&(t=0);var i=cc.assetManager.builtins.getBuiltin("effect","builtin-"+n);return u.create(i,t)},create:function(n,t){if(void 0===t&&(t=0),!n)return null;var i=new u;return i.effectAsset=n,i.techniqueIndex=t,i}},setProperty:function(n,t,i,r){if(cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS){if("string"==typeof i&&(i=parseInt(i)),t instanceof f){var u=t.isAlphaAtlas(),e="CC_USE_ALPHA_ATLAS_"+n,o=this.getDefine(e,i);(u||o)&&this.define(e,u);t.loaded||cc.assetManager.postLoadNative(t)}this._effect.setProperty(n,t,i,r)}},getProperty:function(n,t){return"string"==typeof t&&(t=parseInt(t)),this._effect.getProperty(n,t)},define:function(n,t,i,r){cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS&&("string"==typeof i&&(i=parseInt(i)),this._effect.define(n,t,i,r))},getDefine:function(n,t){return"string"==typeof t&&(t=parseInt(t)),this._effect.getDefine(n,t)},setCullMode:function(n,t){void 0===n&&(n=r.CULL_BACK);this._effect.setCullMode(n,t)},setDepth:function(n,t,i,u){void 0===n&&(n=!1);void 0===t&&(t=!1);void 0===i&&(i=r.DS_FUNC_LESS);this._effect.setDepth(n,t,i,u)},setBlend:function(n,t,i,u,f,e,o,s,h){void 0===n&&(n=!1);void 0===t&&(t=r.BLEND_FUNC_ADD);void 0===i&&(i=r.BLEND_SRC_ALPHA);void 0===u&&(u=r.BLEND_ONE_MINUS_SRC_ALPHA);void 0===f&&(f=r.BLEND_FUNC_ADD);void 0===e&&(e=r.BLEND_SRC_ALPHA);void 0===o&&(o=r.BLEND_ONE_MINUS_SRC_ALPHA);void 0===s&&(s=4294967295);this._effect.setBlend(n,t,i,u,f,e,o,s,h)},setStencilEnabled:function(n,t){void 0===n&&(n=r.STENCIL_INHERIT);this._effect.setStencilEnabled(n,t)},setStencil:function(n,t,i,u,f,e,o,s,h){void 0===n&&(n=r.STENCIL_INHERIT);void 0===t&&(t=r.DS_FUNC_ALWAYS);void 0===i&&(i=0);void 0===u&&(u=255);void 0===f&&(f=r.STENCIL_OP_KEEP);void 0===e&&(e=r.STENCIL_OP_KEEP);void 0===o&&(o=r.STENCIL_OP_KEEP);void 0===s&&(s=255);this._effect.setStencil(n,t,i,u,f,e,o,s,h)},updateHash:function(n){this._manualHash=n;this._effect&&this._effect.updateHash(n)},getHash:function(){return this._manualHash||this._effect&&this._effect.getHash()},onLoad:function(){var i,t,n,r,u;if(this.effectAsset=this._effectAsset,this._effect){this._techniqueIndex&&this._effect.switchTechnique(this._techniqueIndex);this._techniqueData=this._techniqueData||{};i=this._techniqueData;for(t in i)if(n=i[t=parseInt(t)],n){for(r in n.defines)this.define(r,n.defines[r],t);for(u in n.props)this.setProperty(u,n.props[u],t)}}}}),h=u;i.default=h;cc.Material=u;t.exports=i.default},{"../../utils/texture-util":277,"../CCAsset":62,"../CCTexture2D":77,"./CCEffectAsset":79}],81:[function(n,t,i){"use strict";function o(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}var r,e,u,f;i.__esModule=!0;i.default=void 0;e=(r=n("../../../renderer/core/pass"))&&r.__esModule?r:{"default":r};u=cc.gfx;f=function(){function t(){this._dirty=!0;this._name="";this._technique=null}var i,r,n=t.prototype;return n._createPassProp=function(n,t){var i=t._properties[n],r;if(i)return r=Object.create(null),r.name=n,r.type=i.type,r.value=i.value instanceof Float32Array?new Float32Array(i.value):i.value instanceof Float64Array?new Float64Array(i.value):i.value,t._properties[n]=r,r},n._setPassProperty=function(n,t,i,r){var u=i._properties;return u.hasOwnProperty(n)||this._createPassProp(n,i),u[n].value===t||(this._dirty=!0,e.default.prototype.setProperty.call(i,n,t,r))},n.setProperty=function(n,t,i,r){var f=!1,e=this.passes,o=0,s=e.length,u;for(void 0!==i&&(o=i,s=i+1),u=o;u<s;u++)this._setPassProperty(n,t,e[u],r)&&(f=!0);f||cc.warnID(9103,this.name,n)},n.getProperty=function(n,t){var r=this.passes,u,f,i,e;if(!(t>=r.length))for(u=0,f=r.length,void 0!==t&&(u=t,f=t+1),i=u;i<f;i++)if(e=r[i].getProperty(n),void 0!==e)return e},n.define=function(n,t,i,r){var f=!1,e=this.passes,o=0,s=e.length,u;for(void 0!==i&&(o=i,s=i+1),u=o;u<s;u++)e[u].define(n,t,r)&&(f=!0);f||cc.warnID(9104,this.name,n)},n.getDefine=function(n,t){var r=this.passes,u,f,i,e;if(!(t>=r.length))for(u=0,f=r.length,void 0!==t&&(u=t,f=t+1),i=u;i<f;i++)if(e=r[i].getDefine(n),void 0!==e)return e},n.setCullMode=function(n,t){var i;void 0===n&&(n=u.CULL_BACK);var r=this.passes,f=0,e=r.length;for(void 0!==t&&(f=t,e=t+1),i=f;i<e;i++)r[i].setCullMode(n);this._dirty=!0},n.setDepth=function(n,t,i,r){var f=this.passes,e=0,o=f.length,u;for(void 0!==r&&(e=r,o=r+1),u=e;u<o;u++)f[u].setDepth(n,t,i);this._dirty=!0},n.setBlend=function(n,t,i,r,u,f,e,o,s){var c=this.passes,l=0,a=c.length,h;for(void 0!==s&&(l=s,a=s+1),h=l;h<a;h++)c[h].setBlend(n,t,i,r,u,f,e,o);this._dirty=!0},n.setStencilEnabled=function(n,t){var i;void 0===n&&(n=u.STENCIL_INHERIT);var r=this.passes,f=0,e=r.length;for(void 0!==t&&(f=t,e=t+1),i=f;i<e;i++)r[i].setStencilEnabled(n);this._dirty=!0},n.setStencil=function(n,t,i,r,u,f,e,o,s){var l=this.passes,a=0,v=l.length,h,c;for(void 0!==s&&(a=s,v=s+1),h=a;h<v;h++)c=l[h],c.setStencilFront(n,t,i,r,u,f,e,o),c.setStencilBack(n,t,i,r,u,f,e,o);this._dirty=!0},i=t,(r=[{key:"name",get:function(){return this._name}},{key:"technique",get:function(){return this._technique}},{key:"passes",get:function(){return[]}}])&&o(i.prototype,r),t}();i.default=f;cc.EffectBase=f;t.exports=i.default},{"../../../renderer/core/pass":308}],82:[function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function e(n){return cc.renderer._forward._programLib.getTemplate(n)}function c(n,t){var r=t.properties||{},o=e(t.program),h=function(t){if(!o.uniforms.find(function(n){return n.name===t}))return cc.warnID(9107,n.name,t),"continue"},s,i;for(s in r)h(s);return i={},o.uniforms.forEach(function(n){var e,o=n.name,s=i[o]=Object.assign({},n),t=r[o];void 0===(e=t?t.type===u.default.PARAM_TEXTURE_2D?null:t.type===u.default.PARAM_INT||t.type===u.default.PARAM_FLOAT?Array.isArray(t.value)?t.value[0]:t.value:new Float32Array(t.value):f.enums2default[n.type])&&(e=null);s.value=e}),i}function l(n){var t={};return e(n.program).defines.forEach(function(n){t[n.name]=f.enums2default[n.type]}),t}function a(n){for(var r,t,a=n.techniques.length,v=new Array(a),u=0;u<a;++u){for(var s=n.techniques[u],y=s.name||u,p=s.passes.length,w=new Array(p),f=0;f<p;++f){var i=s.passes[f],b=i.name||f,k=n.name+"-"+y+"-"+b,d=i.stage||"opaque",g=c(n,i),nt=l(i),e=w[f]=new o.default(b,k,i.program,d,g,nt);i.rasterizerState&&e.setCullMode(i.rasterizerState.cullMode);r=i.blendState&&i.blendState.targets[0];r&&e.setBlend(r.blend,r.blendEq,r.blendSrc,r.blendDst,r.blendAlphaEq,r.blendSrcAlpha,r.blendDstAlpha,r.blendColor);t=i.depthStencilState;t&&(e.setDepth(t.depthTest,t.depthWrite,t.depthFunc),e.setStencilFront(t.stencilTest,t.stencilFuncFront,t.stencilRefFront,t.stencilMaskFront,t.stencilFailOpFront,t.stencilZFailOpFront,t.stencilZPassOpFront,t.stencilWriteMaskFront),e.setStencilBack(t.stencilTest,t.stencilFuncBack,t.stencilRefBack,t.stencilMaskBack,t.stencilFailOpBack,t.stencilZFailOpBack,t.stencilZPassOpBack,t.stencilWriteMaskBack))}v[u]=new h.default(y,w)}return v}i.__esModule=!0;i.parseEffect=function(n){var t=a(n);return new s.default(n.name,t,0,n)};var o=r(n("../../../renderer/core/pass")),f=n("../../../renderer/types"),u=r(n("../../../renderer/enums")),s=r(n("./effect")),h=r(n("../../../renderer/core/technique"))},{"../../../renderer/core/pass":308,"../../../renderer/core/technique":310,"../../../renderer/enums":312,"../../../renderer/types":340,"./effect":84}],83:[function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function s(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}var u;i.__esModule=!0;i.default=void 0;var e=r(n("../../../renderer/murmurhash2_gc")),f=r(n("./utils")),o=r(n("./effect-base"));cc.gfx;u=function(n){function t(t){var i;return(i=n.call(this)||this)._effect=void 0,i._passes=[],i._stagePasses={},i._hash=0,i.init(t),i}var r,u,o,h,i;return u=n,(r=t).prototype=Object.create(u.prototype),r.prototype.constructor=r,r.__proto__=u,o=t,(h=[{key:"effect",get:function(){return this._effect}},{key:"name",get:function(){return this._effect&&this._effect.name+" (variant)"}},{key:"passes",get:function(){return this._passes}},{key:"stagePasses",get:function(){return this._stagePasses}}])&&s(o.prototype,h),i=t.prototype,i._onEffectChanged=function(){},i.init=function(n){var u,e,f,i,r;if(n instanceof t&&(n=n.effect),this._effect=n,this._dirty=!0,n)for(u=n.passes,e=this._passes,e.length=0,f=this._stagePasses={},i=0;i<u.length;i++)r=e[i]=Object.setPrototypeOf({},u[i]),r._properties=Object.setPrototypeOf({},u[i]._properties),r._defines=Object.setPrototypeOf({},u[i]._defines),f[r._stage]||(f[r._stage]=[]),f[r._stage].push(r)},i.updateHash=function(){},i.getHash=function(){var n,t;return this._dirty?(this._dirty=!1,n="",n+=f.default.serializePasses(this._passes),t=this._effect,t&&(n+=f.default.serializePasses(t.passes)),this._hash=e.default(n,666),this.updateHash(this._hash),this._hash):this._hash},t}(o.default);i.default=u;cc.EffectVariant=u;t.exports=i.default},{"../../../renderer/murmurhash2_gc":335,"./effect-base":81,"./utils":88}],84:[function(n,t,i){"use strict";function f(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}var r,u;i.__esModule=!0;i.default=void 0;u=function(n){function t(t,i,r,u){var f;return(f=n.call(this)||this)._techniques=[],f._asset=null,f.init(t,i,r,u,!0),f}var r,u,e,o,i;return u=n,(r=t).prototype=Object.create(u.prototype),r.prototype.constructor=r,r.__proto__=u,e=t,(o=[{key:"technique",get:function(){return this._technique}},{key:"passes",get:function(){return this._technique.passes}}])&&f(e.prototype,o),i=t.prototype,i.init=function(n,t,i,r){this._name=n;this._techniques=t;this._technique=t[i];this._asset=r},i.switchTechnique=function(n){n>=this._techniques.length?cc.warn("Can not switch to technique with index ["+n+"]"):this._technique=this._techniques[n]},i.clear=function(){this._techniques=[]},i.clone=function(){for(var r,i=[],n=0;n<this._techniques.length;n++)i.push(this._techniques[n].clone());return r=this._techniques.indexOf(this._technique),new t(this._name,i,r,this._asset)},t}(((r=n("./effect-base"))&&r.__esModule?r:{"default":r}).default);i.default=u;cc.Effect=u;t.exports=i.default},{"./effect-base":81}],85:[function(n){"use strict";n("./CCEffectAsset");n("./CCMaterial");n("./material-variant")},{"./CCEffectAsset":79,"./CCMaterial":80,"./material-variant":87}],86:[function(n,t,i){"use strict";function e(n){return n&&n.__esModule?n:{"default":n}}var r,u,f,o;i.__esModule=!0;i.default=void 0;r=e(n("./utils"));u=e(n("../../utils/pool"));f=new(function(n){function f(){for(var i,r=arguments.length,u=new Array(r),t=0;t<r;t++)u[t]=arguments[t];return(i=n.call.apply(n,[this].concat(u))||this).enabled=!1,i._pool={},i}var i,u,t;return u=n,(i=f).prototype=Object.create(u.prototype),i.prototype.constructor=i,i.__proto__=u,t=f.prototype,t.get=function(n,t){var i,f=this._pool,u,e;if(n instanceof cc.MaterialVariant){if(!n._owner)return n._owner=t,n;if(n._owner===t)return n;n=n.material}return this.enabled&&(u=n.effectAsset._uuid,f[u]&&(e=r.default.serializeDefines(n._effect._defines)+r.default.serializeTechniques(n._effect._techniques),i=f[u][e]&&f[u][e].pop())),i?this.count--:((i=new cc.MaterialVariant(n))._name=n._name+" (Instance)",i._uuid=n._uuid),i._owner=t,i},t.put=function(n){var t,i,u;this.enabled&&n._owner&&(t=this._pool,i=n.effectAsset._uuid,t[i]||(t[i]={}),u=r.default.serializeDefines(n._effect._defines)+r.default.serializeTechniques(n._effect._techniques),t[i][u]||(t[i][u]=[]),this.count>this.maxSize||(this._clean(n),t[i][u].push(n),this.count++))},t.clear=function(){this._pool={};this.count=0},t._clean=function(n){n._owner=null},f}(u.default));u.default.register("material",f);o=f;i.default=o;t.exports=i.default},{"../../utils/pool":271,"./utils":88}],87:[function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function h(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}var u;i.__esModule=!0;i.default=void 0;var f,e=r(n("./CCMaterial")),o=r(n("./effect-variant")),s=r(n("./material-pool"));u=cc._decorator.ccclass("cc.MaterialVariant")(f=function(n){function t(t){var i;return(i=n.call(this)||this)._owner=null,i._material=null,i.init(t),i}var i,r,u,f;return r=n,(i=t).prototype=Object.create(r.prototype),i.prototype.constructor=i,i.__proto__=r,t.createWithBuiltin=function(n,i){return t.create(e.default.getBuiltinMaterial(n),i)},t.create=function(n,t){return n?s.default.get(n,t):null},u=t,(f=[{key:"uuid",get:function(){return this._material._uuid}},{key:"owner",get:function(){return this._owner}},{key:"material",get:function(){return this._material}}])&&h(u.prototype,f),t.prototype.init=function(n){this._effect=new o.default(n.effect);this._effectAsset=n._effectAsset;this._material=n},t}(e.default))||f;i.default=u;cc.MaterialVariant=u;t.exports=i.default},{"./CCMaterial":80,"./effect-variant":83,"./material-pool":86}],88:[function(n,t,i){"use strict";function f(n){var t="";for(var i in n)t+=i+n[i];return t}function e(n){var r="",f,t,i;for(f in n)t=n[f],i=t.value,i&&(r+=t.type===u.default.PARAM_TEXTURE_2D||t.type===u.default.PARAM_TEXTURE_CUBE?i._id+";":i.toString()+";");return r}var r,u,o;i.__esModule=!0;i.default=void 0;u=(r=n("../../../renderer/enums"))&&r.__esModule?r:{"default":r};o={serializeDefines:f,serializePasses:function(n){for(var t,i,u="",r=0;r<n.length;r++)u+=(void 0,i=void 0,i=(t=n[r])._programName+t._cullMode,t._blend&&(i+=t._blendEq+t._blendAlphaEq+t._blendSrc+t._blendDst+t._blendSrcAlpha+t._blendDstAlpha+t._blendColor),t._depthTest&&(i+=t._depthWrite+t._depthFunc),t._stencilTest&&(i+=t._stencilFuncFront+t._stencilRefFront+t._stencilMaskFront+t._stencilFailOpFront+t._stencilZFailOpFront+t._stencilZPassOpFront+t._stencilWriteMaskFront+t._stencilFuncBack+t._stencilRefBack+t._stencilMaskBack+t._stencilFailOpBack+t._stencilZFailOpBack+t._stencilZPassOpBack+t._stencilWriteMaskBack),i+=e(t._properties),i+=f(t._defines));return u},serializeUniforms:e};i.default=o;t.exports=i.default},{"../../../renderer/enums":312}],89:[function(n,t){"use strict";function l(n,t,i,r){for(var h,c,f=n._parent.scaleX,e=n._parent.scaleY,o=0,s=0,u=n._parent;;){if(o+=u.x,s+=u.y,!(u=u._parent))return i.x=i.y=0,void(r.x=r.y=1);if(u===t)break;h=u.scaleX;c=u.scaleY;o*=h;s*=c;f*=h;e*=c}r.x=0!==f?1/f:1;r.y=0!==e?1/e:1;i.x=-o;i.y=-s}function f(n,t){var tt,f,i,d=t._target,r,s,g,a,v,y,st,et,p,u,nt,w,b,k,ht,ot;d?l(n,tt=d,f=e,i=o):tt=n._parent;var ct,it=(ct=tt)instanceof cc.Scene?cc.visibleRect:ct._contentSize,rt=tt._anchorPoint,lt=tt instanceof cc.Scene,ut=n.x,ft=n.y,at=n._anchorPoint;t._alignFlags&h&&(g=it.width,lt?(r=cc.visibleRect.left.x,s=cc.visibleRect.right.x):s=(r=-rt.x*g)+g,r+=t._isAbsLeft?t._left:t._left*g,s-=t._isAbsRight?t._right:t._right*g,d&&(r+=f.x,r*=i.x,s+=f.x,s*=i.x),v=at.x,y=n.scaleX,(y<0&&(v=1-v,y=-y),t.isStretchWidth)?(a=s-r,0!==y&&(n.width=a/y),ut=r+v*a):(a=n.width*y,t.isAlignHorizontalCenter)?(st=t._isAbsHorizontalCenter?t._horizontalCenter:t._horizontalCenter*g,et=(.5-rt.x)*it.width,d&&(st*=i.x,et+=f.x,et*=i.x),ut=et+(v-.5)*a+st):ut=t.isAlignLeft?r+v*a:s+(v-1)*a);t._alignFlags&c&&(nt=it.height,lt?(u=cc.visibleRect.bottom.y,p=cc.visibleRect.top.y):p=(u=-rt.y*nt)+nt,u+=t._isAbsBottom?t._bottom:t._bottom*nt,p-=t._isAbsTop?t._top:t._top*nt,d&&(u+=f.y,u*=i.y,p+=f.y,p*=i.y),b=at.y,k=n.scaleY,(k<0&&(b=1-b,k=-k),t.isStretchHeight)?(w=p-u,0!==k&&(n.height=w/k),ft=u+b*w):(w=n.height*k,t.isAlignVerticalCenter)?(ht=t._isAbsVerticalCenter?t._verticalCenter:t._verticalCenter*nt,ot=(.5-rt.y)*it.height,d&&(ht*=i.y,ot+=f.y,ot*=i.y),ft=ot+(b-.5)*w+ht):ft=t.isAlignBottom?u+b*w:p+(b-1)*w);n.setPosition(ut,ft)}function s(n){var t=n._widget,o,e,h;for(t&&(f(n,t),t.alignMode!==u.ALWAYS?i.remove(t):r.push(t)),o=n._children,e=0;e<o.length;e++)h=o[e],h._active&&s(h)}function a(){var t=cc.director.getScene(),u,n;if(t){if(i.isAligning=!0,i._nodesOrderDirty)r.length=0,s(t),i._nodesOrderDirty=!1;else for(n=i._activeWidgetsIterator,n.i=0;n.i<r.length;++n.i)f((u=r[n.i]).node,u);i.isAligning=!1}}var e,o,r,i;n("../CCNode").EventType;var h=56,c=7,u=cc.Enum({ONCE:0,ON_WINDOW_RESIZE:1,ALWAYS:2});e=cc.Vec2.ZERO;o=cc.Vec2.ONE;r=[];i=cc._widgetManager=t.exports={_AlignFlags:{TOP:1,MID:2,BOT:4,LEFT:8,CENTER:16,RIGHT:32},isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new cc.js.array.MutableForwardIterator(r),init:function(n){n.on(cc.Director.EVENT_AFTER_UPDATE,a);var t=this.onResized.bind(this);cc.view.on("canvas-resize",t);window.addEventListener("orientationchange",t)},add:function(n){n.node._widget=n;this._nodesOrderDirty=!0},remove:function(n){n.node._widget=null;this._activeWidgetsIterator.remove(n)},onResized:function(){var n=cc.director.getScene();n&&this.refreshWidgetOnResized(n)},refreshWidgetOnResized:function(n){var t=cc.Node.isNode(n)&&n.getComponent(cc.Widget),r,i,f;for(t&&t.enabled&&t.alignMode===u.ON_WINDOW_RESIZE&&this.add(t),r=n._children,i=0;i<r.length;i++)f=r[i],this.refreshWidgetOnResized(f)},updateAlignment:function n(t){var i=t._parent,r;cc.Node.isNode(i)&&n(i);r=t._widget||t.getComponent(cc.Widget);r&&i&&f(t,r)},AlignMode:u}},{"../CCNode":29}],90:[function(n,t){"use strict";function b(){for(var t,n=0,r=Number.MAX_VALUE;n<f.length;n++)t=f[n],t._depth<r&&(i.main=t,r=t._depth)}function k(){if(o){var n=o.getNode(),t=cc.game.canvas;n.z=t.height/1.1566;n.x=t.width/2;n.y=t.height/2}}var e=n("../value-types"),y=n("../geom-utils"),p=n("../utils/affine-transform"),s=n("../renderer/index"),g=n("../renderer/render-flow"),u=n("../CCGame"),l=null,o;l=n("../../renderer/scene/camera");var r=cc.mat4(),h=cc.mat4(),a=cc.v3(),w=cc.v3(),c=cc.v3(),f=[];o=null;var v=cc.Enum({COLOR:1,DEPTH:2,STENCIL:4}),d=cc.Enum({OPAQUE:1,TRANSPARENT:2}),i=cc.Class({name:"cc.Camera","extends":cc.Component,ctor:function(){if(u.renderType!==u.RENDER_TYPE_CANVAS){var n=new l;n.setStages(["opaque"]);n.dirty=!0;this._inited=!1;this._camera=n}else this._inited=!0},editor:!1,properties:{_cullingMask:4294967295,_clearFlags:v.DEPTH|v.STENCIL,_backgroundColor:cc.color(0,0,0,255),_depth:0,_zoomRatio:1,_targetTexture:null,_fov:60,_orthoSize:10,_nearClip:1,_farClip:4096,_ortho:!0,_rect:cc.rect(0,0,1,1),_renderStages:1,_alignWithScreen:!0,zoomRatio:{get:function(){return this._zoomRatio},set:function(n){this._zoomRatio=n},tooltip:!1},fov:{get:function(){return this._fov},set:function(n){this._fov=n},tooltip:!1},orthoSize:{get:function(){return this._orthoSize},set:function(n){this._orthoSize=n},tooltip:!1},nearClip:{get:function(){return this._nearClip},set:function(n){this._nearClip=n;this._updateClippingpPlanes()},tooltip:!1},farClip:{get:function(){return this._farClip},set:function(n){this._farClip=n;this._updateClippingpPlanes()},tooltip:!1},ortho:{get:function(){return this._ortho},set:function(n){this._ortho=n;this._updateProjection()},tooltip:!1},rect:{get:function(){return this._rect},set:function(n){this._rect=n;this._updateRect()},tooltip:!1},cullingMask:{get:function(){return this._cullingMask},set:function(n){this._cullingMask=n;this._updateCameraMask()},tooltip:!1},clearFlags:{get:function(){return this._clearFlags},set:function(n){this._clearFlags=n;this._camera&&this._camera.setClearFlags(n)},tooltip:!1},backgroundColor:{get:function(){return this._backgroundColor},set:function(n){this._backgroundColor.equals(n)||(this._backgroundColor.set(n),this._updateBackgroundColor())},tooltip:!1},depth:{get:function(){return this._depth},set:function(n){i.main===this?this._depth<n&&b():i.main&&n<i.main._depth&&f.includes(this)&&(i.main=this);this._depth=n;this._camera&&this._camera.setPriority(n)},tooltip:!1},targetTexture:{get:function(){return this._targetTexture},set:function(n){this._targetTexture=n;this._updateTargetTexture()},tooltip:!1},renderStages:{get:function(){return this._renderStages},set:function(n){this._renderStages=n;this._updateStages()},tooltip:!1},alignWithScreen:{get:function(){return this._alignWithScreen},set:function(n){this._alignWithScreen=n}},_is3D:{get:function(){return this.node&&this.node._is3DNode}}},statics:{main:null,cameras:f,ClearFlags:v,findCamera:function(n){for(var i,t=0,r=f.length;t<r;t++)if(i=f[t],i.containsNode(n))return i;return null},_findRendererCamera:function(n){for(var i=s.scene._cameras,t=0;t<i._count;t++)if(i._data[t]._cullingMask&n._cullingMask)return i._data[t];return null},_setupDebugCamera:function(){var n,t;o||u.renderType===u.RENDER_TYPE_CANVAS||(n=new l,o=n,n.setStages(["opaque"]),n.setFov(Math.PI/3),n.setNear(.1),n.setFar(4096),n.dirty=!0,n.cullingMask=1<<cc.Node.BuiltinGroupIndex.DEBUG,n.setPriority(cc.macro.MAX_ZINDEX),n.setClearFlags(0),n.setColor(0,0,0,0),t=new cc.Node,n.setNode(t),k(),cc.view.on("design-resolution-changed",k),s.scene.addCamera(n))}},_updateCameraMask:function(){if(this._camera){var n=this._cullingMask&~(1<<cc.Node.BuiltinGroupIndex.DEBUG);this._camera.cullingMask=n}},_updateBackgroundColor:function(){if(this._camera){var n=this._backgroundColor;this._camera.setColor(n.r/255,n.g/255,n.b/255,n.a/255)}},_updateTargetTexture:function(){if(this._camera){var n=this._targetTexture;this._camera.setFrameBuffer(n?n._framebuffer:null)}},_updateClippingpPlanes:function(){this._camera&&(this._camera.setNear(this._nearClip),this._camera.setFar(this._farClip))},_updateProjection:function(){if(this._camera){var n=this._ortho?1:0;this._camera.setType(n)}},_updateRect:function(){if(this._camera){var n=this._rect;this._camera.setRect(n.x,n.y,n.width,n.height)}},_updateStages:function(){var t=this._renderStages,n=[];t&d.OPAQUE&&n.push("opaque");t&d.TRANSPARENT&&n.push("transparent");this._camera.setStages(n)},_init:function(){if(!this._inited){this._inited=!0;var n=this._camera;n&&(n.setNode(this.node),n.setClearFlags(this._clearFlags),n.setPriority(this._depth),this._updateBackgroundColor(),this._updateCameraMask(),this._updateTargetTexture(),this._updateClippingpPlanes(),this._updateProjection(),this._updateStages(),this._updateRect(),this.beforeDraw())}},__preload:function(){this._init()},onEnable:function(){u.renderType!==u.RENDER_TYPE_CANVAS&&(cc.director.on(cc.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),s.scene.addCamera(this._camera));f.push(this);(!i.main||this._depth<i.main._depth)&&(i.main=this)},onDisable:function(){u.renderType!==u.RENDER_TYPE_CANVAS&&(cc.director.off(cc.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),s.scene.removeCamera(this._camera));cc.js.array.fastRemove(f,this);i.main===this&&(i.main=null,b())},getScreenToWorldMatrix2D:function(n){return this.getWorldToScreenMatrix2D(n),e.Mat4.invert(n,n),n},getWorldToScreenMatrix2D:function(n){var i,t;this.node.getWorldRT(r);i=this.zoomRatio;t=r.m;t[0]*=i;t[1]*=i;t[4]*=i;t[5]*=i;var u=t[12],f=t[13],o=cc.visibleRect.center;return t[12]=o.x-(t[0]*u+t[4]*f),t[13]=o.y-(t[1]*u+t[5]*f),n!==r&&e.Mat4.copy(n,r),n},getScreenToWorldPoint:function(n,t){return this.node.is3DNode?(t=t||new cc.Vec3,this._camera.screenToWorld(t,n,cc.visibleRect.width,cc.visibleRect.height)):(t=t||new cc.Vec2,this.getScreenToWorldMatrix2D(r),e.Vec2.transformMat4(t,n,r)),t},getWorldToScreenPoint:function(n,t){return this.node.is3DNode?(t=t||new cc.Vec3,this._camera.worldToScreen(t,n,cc.visibleRect.width,cc.visibleRect.height)):(t=t||new cc.Vec2,this.getWorldToScreenMatrix2D(r),e.Vec2.transformMat4(t,n,r)),t},getRay:function(n){return cc.geomUtils?(e.Vec3.set(c,n.x,n.y,1),this._camera.screenToWorld(w,c,cc.visibleRect.width,cc.visibleRect.height),this.ortho?(e.Vec3.set(c,n.x,n.y,-1),this._camera.screenToWorld(a,c,cc.visibleRect.width,cc.visibleRect.height)):this.node.getWorldPosition(a),y.Ray.fromPoints(new y.Ray,a,w)):n},containsNode:function(n){return(n._cullingMask&this.cullingMask)>0},render:function(n){if(!(n=n||cc.director.getScene()))return null;this.node.getWorldMatrix(r);this.beforeDraw();g.renderCamera(this._camera,n)},_onAlignWithScreen:function(){var t=cc.game.canvas.height/cc.view._scaleY,n;this._targetTexture&&(t=cc.visibleRect.height);n=this._fov*cc.macro.RAD;this.node.z=t/(2*Math.tan(n/2));n=2*Math.atan(Math.tan(n/2)/this.zoomRatio);this._camera.setFov(n);this._camera.setOrthoHeight(t/2/this.zoomRatio);this.node.setRotation(0,0,0,1)},beforeDraw:function(){if(this._camera){if(this._alignWithScreen)this._onAlignWithScreen();else{var n=this._fov*cc.macro.RAD;n=2*Math.atan(Math.tan(n/2)/this.zoomRatio);this._camera.setFov(n);this._camera.setOrthoHeight(this._orthoSize/this.zoomRatio)}this._camera.dirty=!0}}});cc.js.mixin(i.prototype,{getNodeToCameraTransform:function(n){var t=p.identity();return n.getWorldMatrix(h),this.containsNode(n)&&(this.getWorldToCameraMatrix(r),e.Mat4.mul(h,h,r)),p.fromMat4(t,h),t},getCameraToWorldPoint:function(n,t){return this.getScreenToWorldPoint(n,t)},getWorldToCameraPoint:function(n,t){return this.getWorldToScreenPoint(n,t)},getCameraToWorldMatrix:function(n){return this.getScreenToWorldMatrix2D(n)},getWorldToCameraMatrix:function(n){return this.getWorldToScreenMatrix2D(n)}});t.exports=cc.Camera=i},{"../../renderer/scene/camera":337,"../CCGame":28,"../geom-utils":150,"../renderer/index":226,"../renderer/render-flow":227,"../utils/affine-transform":260,"../value-types":284}],91:[function(n,t){"use strict";cc.Collider.Box=cc.Class({properties:{_offset:cc.v2(0,0),_size:cc.size(100,100),offset:{tooltip:!1,get:function(){return this._offset},set:function(n){this._offset=n},type:cc.Vec2},size:{tooltip:!1,get:function(){return this._size},set:function(n){this._size.width=n.width<0?0:n.width;this._size.height=n.height<0?0:n.height},type:cc.Size}},resetInEditor:!1});var i=cc.Class({name:"cc.BoxCollider","extends":cc.Collider,mixins:[cc.Collider.Box],editor:!1});cc.BoxCollider=t.exports=i},{}],92:[function(n,t){"use strict";cc.Collider.Circle=cc.Class({properties:{_offset:cc.v2(0,0),_radius:50,offset:{tooltip:!1,get:function(){return this._offset},set:function(n){this._offset=n},type:cc.Vec2},radius:{tooltip:!1,get:function(){return this._radius},set:function(n){this._radius=n<0?0:n}}},resetInEditor:!1});var i=cc.Class({name:"cc.CircleCollider","extends":cc.Collider,mixins:[cc.Collider.Circle],editor:!1});cc.CircleCollider=t.exports=i},{}],93:[function(n,t){"use strict";var i=cc.Class({name:"cc.Collider","extends":cc.Component,properties:{editing:{"default":!1,serializable:!1,tooltip:!1},tag:{tooltip:!1,"default":0,range:[0,1e7],type:cc.Integer}},onDisable:function(){cc.director.getCollisionManager().removeCollider(this)},onEnable:function(){cc.director.getCollisionManager().addCollider(this)}});cc.Collider=t.exports=i},{}],94:[function(n,t){"use strict";function h(n,t,i,r,u,f){var h=n.x,c=n.y,l=n.width,a=n.height,e=t.m,v=e[0],y=e[1],p=e[4],w=e[5],o=v*h+p*c+e[12],s=y*h+w*c+e[13],b=v*l,k=y*l,d=p*a,g=w*a;r.x=o;r.y=s;u.x=b+o;u.y=k+s;i.x=d+o;i.y=g+s;f.x=b+d+o;f.y=k+g+s}var u,f=(u=n("../value-types/vec2"))&&u.__esModule?u:{"default":u},e=n("./CCContact"),r=e.CollisionType,o=n("../CCNode").EventType,i=new f.default,s=cc.Class({mixins:[cc.EventTarget],properties:{enabled:!1,enabledDrawBoundingBox:!1},ctor:function(){this._contacts=[];this._colliders=[];this._debugDrawer=null;this._enabledDebugDraw=!1;cc.director._scheduler&&cc.director._scheduler.enableForTarget(this)},update:function(){var n,t,f,i,u,e,o;if(this.enabled){for(f=this._colliders,n=0,t=f.length;n<t;n++)this.updateCollider(f[n]);for(i=this._contacts,u=[],n=0,t=i.length;n<t;n++)e=i[n].updateState(),e!==r.None&&u.push([e,i[n]]);for(n=0,t=u.length;n<t;n++)o=u[n],this._doCollide(o[0],o[1]);this.drawColliders()}},_doCollide:function(n,t){var u;switch(n){case r.CollisionEnter:u="onCollisionEnter";break;case r.CollisionStay:u="onCollisionStay";break;case r.CollisionExit:u="onCollisionExit"}for(var e,o=t.collider1,s=t.collider2,h=o.node._components,c=s.node._components,i=0,f=h.length;i<f;i++)(e=h[i])[u]&&e[u](s,o);for(i=0,f=c.length;i<f;i++)(e=c[i])[u]&&e[u](o,s)},shouldCollide:function(n,t){var i=n.node,r=t.node,u=cc.game.collisionMatrix;return i!==r&&u[i.groupIndex][r.groupIndex]},initCollider:function(n){if(!n.world){var t=n.world={};t.aabb=cc.rect();t.preAabb=cc.rect();t.matrix=cc.mat4();t.radius=0;n instanceof cc.BoxCollider?(t.position=null,t.points=[cc.v2(),cc.v2(),cc.v2(),cc.v2()]):n instanceof cc.PolygonCollider?(t.position=null,t.points=n.points.map(function(n){return cc.v2(n.x,n.y)})):n instanceof cc.CircleCollider&&(t.position=cc.v2(),t.points=null)}},updateCollider:function(n){var g=n.offset,r=n.world,t=r.aabb,e=r.matrix,v,y,s,d,c,l,a;if(n.node.getWorldMatrix(e),v=r.preAabb,v.x=t.x,v.y=t.y,v.width=t.width,v.height=t.height,n instanceof cc.BoxCollider){y=n.size;t.x=g.x-y.width/2;t.y=g.y-y.height/2;t.width=y.width;t.height=y.height;var nt=r.points,p=nt[0],w=nt[1],b=nt[2],k=nt[3];h(t,e,p,w,b,k);var ft=Math.min(p.x,w.x,b.x,k.x),et=Math.min(p.y,w.y,b.y,k.y),ot=Math.max(p.x,w.x,b.x,k.x),st=Math.max(p.y,w.y,b.y,k.y);t.x=ft;t.y=et;t.width=ot-ft;t.height=st-et}else if(n instanceof cc.CircleCollider){f.default.transformMat4(i,n.offset,e);r.position.x=i.x;r.position.y=i.y;var o=e.m,ht=o[12],ct=o[13];o[12]=o[13]=0;i.x=n.radius;i.y=0;f.default.transformMat4(i,i,e);s=Math.sqrt(i.x*i.x+i.y*i.y);r.radius=s;t.x=r.position.x-s;t.y=r.position.y-s;t.width=2*s;t.height=2*s;o[12]=ht;o[13]=ct}else if(n instanceof cc.PolygonCollider){d=n.points;c=r.points;c.length=d.length;for(var tt=1e6,it=1e6,rt=-1e6,ut=-1e6,u=0,lt=d.length;u<lt;u++)c[u]||(c[u]=cc.v2()),i.x=d[u].x+g.x,i.y=d[u].y+g.y,f.default.transformMat4(i,i,e),l=i.x,a=i.y,c[u].x=l,c[u].y=a,l>rt&&(rt=l),l<tt&&(tt=l),a>ut&&(ut=a),a<it&&(it=a);t.x=tt;t.y=it;t.width=rt-tt;t.height=ut-it}},addCollider:function(n){var t=this._colliders,i,u,r,f;if(-1===t.indexOf(n)){for(i=0,u=t.length;i<u;i++)r=t[i],this.shouldCollide(n,r)&&(f=new e(n,r),this._contacts.push(f));t.push(n);this.initCollider(n)}n.node.on(o.GROUP_CHANGED,this.onNodeGroupChanged,this)},removeCollider:function(n){var f=this._colliders,e=f.indexOf(n),u,t,i;if(e>=0){for(f.splice(e,1),u=this._contacts,t=u.length-1;t>=0;t--)i=u[t],i.collider1!==n&&i.collider2!==n||(i.touching&&this._doCollide(r.CollisionExit,i),u.splice(t,1));n.node.off(o.GROUP_CHANGED,this.onNodeGroupChanged,this)}else cc.errorID(6600)},onNodeGroupChanged:function(n){for(var t,r=n.getComponents(cc.Collider),i=0,u=r.length;i<u;i++)t=r[i],cc.PhysicsCollider&&t instanceof cc.PhysicsCollider||(this.removeCollider(t),this.addCollider(t))},drawColliders:function(){var n,t,r,u,i;if(this._enabledDebugDraw){this._checkDebugDrawValid();n=this._debugDrawer;n.clear();for(var e=this._colliders,f=0,o=e.length;f<o;f++){if(t=e[f],n.strokeColor=cc.Color.WHITE,t instanceof cc.BoxCollider||t instanceof cc.PolygonCollider){if(r=t.world.points,r.length>0){for(n.moveTo(r[0].x,r[0].y),u=1;u<r.length;u++)n.lineTo(r[u].x,r[u].y);n.close();n.stroke()}}else t instanceof cc.CircleCollider&&(n.circle(t.world.position.x,t.world.position.y,t.world.radius),n.stroke());this.enabledDrawBoundingBox&&(i=t.world.aabb,n.strokeColor=cc.Color.BLUE,n.moveTo(i.xMin,i.yMin),n.lineTo(i.xMin,i.yMax),n.lineTo(i.xMax,i.yMax),n.lineTo(i.xMax,i.yMin),n.close(),n.stroke())}}},_checkDebugDrawValid:function(){if(!this._debugDrawer||!this._debugDrawer.isValid){var n=new cc.Node("COLLISION_MANAGER_DEBUG_DRAW");n.zIndex=cc.macro.MAX_ZINDEX;cc.game.addPersistRootNode(n);this._debugDrawer=n.addComponent(cc.Graphics)}}});cc.js.getset(s.prototype,"enabledDebugDraw",function(){return this._enabledDebugDraw},function(n){n&&!this._enabledDebugDraw?(this._checkDebugDrawValid(),this._debugDrawer.node.active=!0):!n&&this._enabledDebugDraw&&(this._debugDrawer.clear(!0),this._debugDrawer.node.active=!1);this._enabledDebugDraw=n});cc.CollisionManager=t.exports=s},{"../CCNode":29,"../value-types/vec2":293,"./CCContact":95}],95:[function(n,t){"use strict";function u(n,t){this.collider1=n;this.collider2=t;this.touching=!1;var r=n instanceof cc.BoxCollider||n instanceof cc.PolygonCollider,u=t instanceof cc.BoxCollider||t instanceof cc.PolygonCollider,f=n instanceof cc.CircleCollider,e=t instanceof cc.CircleCollider;r&&u?this.testFunc=i.polygonPolygon:f&&e?this.testFunc=i.circleCircle:r&&e?this.testFunc=i.polygonCircle:f&&u?(this.testFunc=i.polygonCircle,this.collider1=t,this.collider2=n):cc.errorID(6601,cc.js.getClassName(n),cc.js.getClassName(t))}var i=n("./CCIntersection"),r=cc.Enum({None:0,CollisionEnter:1,CollisionStay:2,CollisionExit:3});u.prototype.test=function(){var n=this.collider1.world,t=this.collider2.world;return!!n.aabb.intersects(t.aabb)&&(this.testFunc===i.polygonPolygon?this.testFunc(n.points,t.points):this.testFunc===i.circleCircle?this.testFunc(n,t):this.testFunc===i.polygonCircle&&this.testFunc(n.points,t))};u.prototype.updateState=function(){var t=this.test(),n=r.None;return t&&!this.touching?(this.touching=!0,n=r.CollisionEnter):t&&this.touching?n=r.CollisionStay:!t&&this.touching&&(this.touching=!1,n=r.CollisionExit),n};u.CollisionType=r;t.exports=u},{"./CCIntersection":96}],96:[function(n,t){"use strict";function u(n,t,i,r){var o=(r.x-i.x)*(n.y-i.y)-(r.y-i.y)*(n.x-i.x),s=(t.x-n.x)*(n.y-i.y)-(t.y-n.y)*(n.x-i.x),u=(r.y-i.y)*(t.x-n.x)-(r.x-i.x)*(t.y-n.y),f,e;return 0!==u&&(f=o/u,e=s/u,0<=f&&f<=1&&0<=e&&e<=1)?!0:!1}function f(n,t,i){for(var f=i.length,r=0;r<f;++r)if(u(n,t,i[r],i[(r+1)%f]))return!0;return!1}function r(n,t){for(var r=!1,c=n.x,u=n.y,o=t.length,i=0,f=o-1;i<o;f=i++){var s=t[i].x,e=t[i].y,l=t[f].x,h=t[f].y;e>u!=h>u&&c<(l-s)*(u-e)/(h-e)+s&&(r=!r)}return r}function e(n,t,i,r){var o,u=i.x-t.x,f=i.y-t.y,s=u*u+f*f,e=((n.x-t.x)*u+(n.y-t.y)*f)/s;return o=r?s?e<0?t:e>1?i:cc.v2(t.x+e*u,t.y+e*f):t:cc.v2(t.x+e*u,t.y+e*f),u=n.x-o.x,f=n.y-o.y,Math.sqrt(u*u+f*f)}var i={};i.lineLine=u;i.lineRect=function(n,t,i){var r=new cc.Vec2(i.x,i.y),f=new cc.Vec2(i.x,i.yMax),e=new cc.Vec2(i.xMax,i.yMax),o=new cc.Vec2(i.xMax,i.y);return!!(u(n,t,r,f)||u(n,t,f,e)||u(n,t,e,o)||u(n,t,o,r))};i.linePolygon=f;i.rectRect=function(n,t){var i=n.x,r=n.y,u=n.x+n.width,f=n.y+n.height,e=t.x,o=t.y,s=t.x+t.width,h=t.y+t.height;return i<=s&&u>=e&&r<=h&&f>=o};i.rectPolygon=function(n,t){var i,h,u=new cc.Vec2(n.x,n.y),e=new cc.Vec2(n.x,n.yMax),o=new cc.Vec2(n.xMax,n.yMax),s=new cc.Vec2(n.xMax,n.y);if(f(u,e,t)||f(e,o,t)||f(o,s,t)||f(s,u,t))return!0;for(i=0,h=t.length;i<h;++i)if(r(t[i],n))return!0;return!!(r(u,t)||r(e,t)||r(o,t)||r(s,t))};i.polygonPolygon=function(n,t){for(var i=0,u=n.length;i<u;++i)if(f(n[i],n[(i+1)%u],t))return!0;for(i=0,u=t.length;i<u;++i)if(r(t[i],n))return!0;for(i=0,u=n.length;i<u;++i)if(r(n[i],t))return!0;return!1};i.circleCircle=function(n,t){return n.position.sub(t.position).mag()<n.radius+t.radius};i.polygonCircle=function(n,t){var u=t.position,i,f;if(r(u,n))return!0;for(i=0,f=n.length;i<f;i++)if(e(u,0===i?n[n.length-1]:n[i-1],n[i],!0)<t.radius)return!0;return!1};i.pointInPolygon=r;i.pointLineDistance=e;cc.Intersection=t.exports=i},{}],97:[function(n,t){"use strict";cc.Collider.Polygon=cc.Class({properties:{threshold:{"default":1,serializable:!1,visible:!1},_offset:cc.v2(0,0),offset:{get:function(){return this._offset},set:function(n){this._offset=n},type:cc.Vec2},points:{tooltip:!1,"default":function(){return[cc.v2(-50,-50),cc.v2(50,-50),cc.v2(50,50),cc.v2(-50,50)]},type:[cc.Vec2]}},resetPointsByContour:!1});var i=cc.Class({name:"cc.PolygonCollider","extends":cc.Collider,mixins:[cc.Collider.Polygon],editor:!1});cc.PolygonCollider=t.exports=i},{}],98:[function(n){"use strict";n("./CCCollisionManager");n("./CCCollider");n("./CCBoxCollider");n("./CCCircleCollider");n("./CCPolygonCollider")},{"./CCBoxCollider":91,"./CCCircleCollider":92,"./CCCollider":93,"./CCCollisionManager":94,"./CCPolygonCollider":97}],99:[function(n,t){"use strict";function l(n,t){for(var f,e,o,s=t.constructor._executionOrder,h=t._id,r=0,u=n.length-1,i=u>>>1;r<=u;i=r+u>>>1)if(f=n[i],e=f.constructor._executionOrder,e>s)u=i-1;else if(e<s)r=i+1;else if(o=f._id,o>h)u=i-1;else{if(!(o<h))return i;r=i+1}return~r}function u(n,t){for(var r,u=n.array,i=n.i+1;i<u.length;)r=u[i],r._enabled&&r.node._activeInHierarchy?++i:(n.removeAt(i),t&&(r._objFlags&=~t))}function a(n,t){return n.constructor._executionOrder-t.constructor._executionOrder}function e(n,t,i,r){return function(t,u){try{r(t,u)}catch(f){f={};cc._throw(f);var e=t.array;for(i&&(e[t.i]._objFlags|=i),++t.i;t.i<e.length;++t.i)try{n(e[t.i],u)}catch(f){f={};cc._throw(f);i&&(e[t.i]._objFlags|=i)}}}}function v(){this.startInvoker=new s(p);this.updateInvoker=new h(w);this.lateUpdateInvoker=new h(b);this._deferredComps=[];this._updating=!1}var f,s,h,y;n("./platform/CCClass");var o=n("./platform/CCObject").Flags,c=n("./platform/js").array,i=o.IsStartCalled,r=o.IsOnEnableCalled;o.IsEditorOnEnableCalled;f=cc.Class({__ctor__:function(n){var t=c.MutableForwardIterator;this._zero=new t([]);this._neg=new t([]);this._pos=new t([]);this._invoke=n},statics:{stableRemoveInactive:u},add:null,remove:null,invoke:null});s=cc.Class({"extends":f,add:function(n){var t=n.constructor._executionOrder;(0===t?this._zero:t<0?this._neg:this._pos).array.push(n)},remove:function(n){var t=n.constructor._executionOrder;(0===t?this._zero:t<0?this._neg:this._pos).fastRemove(n)},cancelInactive:function(n){u(this._zero,n);u(this._neg,n);u(this._pos,n)},invoke:function(){var t=this._neg,n;t.array.length>0&&(t.array.sort(a),this._invoke(t),t.array.length=0);this._invoke(this._zero);this._zero.array.length=0;n=this._pos;n.array.length>0&&(n.array.sort(a),this._invoke(n),n.array.length=0)}});h=cc.Class({"extends":f,add:function(n){var r=n.constructor._executionOrder,t,i;0===r?this._zero.array.push(n):(t=r<0?this._neg.array:this._pos.array,i=l(t,n),i<0&&t.splice(~i,0,n))},remove:function(n){var r=n.constructor._executionOrder,t,i;0===r?this._zero.fastRemove(n):(t=r<0?this._neg:this._pos,i=l(t.array,n),i>=0&&t.removeAt(i))},invoke:function(n){this._neg.array.length>0&&this._invoke(this._neg,n);this._invoke(this._zero,n);this._pos.array.length>0&&this._invoke(this._pos,n)}});var p=e(function(n){n.start();n._objFlags|=i},0,i,function(n){var r=n.array,t;for(n.i=0;n.i<r.length;++n.i)t=r[n.i],t.start(),t._objFlags|=i}),w=e(function(n,t){n.update(t)},0,void 0,function(n,t){var i=n.array;for(n.i=0;n.i<i.length;++n.i)i[n.i].update(t)}),b=e(function(n,t){n.lateUpdate(t)},0,void 0,function(n,t){var i=n.array;for(n.i=0;n.i<i.length;++n.i)i[n.i].lateUpdate(t)});y=cc.Class({ctor:v,unscheduleAll:v,statics:{LifeCycleInvoker:f,OneOffInvoker:s,createInvokeImpl:e,invokeOnEnable:function(n){var r=cc.director._compScheduler,i=n.array,t;for(n.i=0;n.i<i.length;++n.i)t=i[n.i],t._enabled&&(t.onEnable(),!t.node._activeInHierarchy||r._onEnabled(t))}},_onEnabled:function(n){cc.director.getScheduler().resumeTarget(n);n._objFlags|=r;this._updating?this._deferredComps.push(n):this._scheduleImmediate(n)},_onDisabled:function(n){cc.director.getScheduler().pauseTarget(n);n._objFlags&=~r;var t=this._deferredComps.indexOf(n);t>=0?c.fastRemoveAt(this._deferredComps,t):(!n.start||n._objFlags&i||this.startInvoker.remove(n),n.update&&this.updateInvoker.remove(n),n.lateUpdate&&this.lateUpdateInvoker.remove(n))},enableComp:function(n,t){if(!(n._objFlags&r)){if(n.onEnable){if(t)return void t.add(n);if(n.onEnable(),!n.node._activeInHierarchy)return}this._onEnabled(n)}},disableComp:function(n){n._objFlags&r&&(n.onDisable&&n.onDisable(),this._onDisabled(n))},_scheduleImmediate:function(n){"function"!=typeof n.start||n._objFlags&i||this.startInvoker.add(n);"function"==typeof n.update&&this.updateInvoker.add(n);"function"==typeof n.lateUpdate&&this.lateUpdateInvoker.add(n)},_deferredSchedule:function(){for(var n=this._deferredComps,t=0,i=n.length;t<i;t++)this._scheduleImmediate(n[t]);n.length=0},_startForNewComps:function(){this._deferredComps.length>0&&(this._deferredSchedule(),this.startInvoker.invoke())},startPhase:function(){this._updating=!0;this.startInvoker.invoke();this._startForNewComps()},updatePhase:function(n){this.updateInvoker.invoke(n)},lateUpdatePhase:function(n){this.lateUpdateInvoker.invoke(n);this._updating=!1;this._startForNewComps()}});t.exports=y},{"./platform/CCClass":195,"./platform/CCObject":201,"./platform/js":216,"./utils/misc":269}],100:[function(n,t){"use strict";var o=n("../../animation/animation-animator"),i=n("../../animation/animation-clip"),r=n("../event/event-target"),e=n("../platform/js"),u=function(n,t){return n===t},s=cc.Enum({PLAY:"play",STOP:"stop",PAUSE:"pause",RESUME:"resume",LASTFRAME:"lastframe",FINISHED:"finished"}),f=cc.Class({name:"cc.Animation","extends":n("./CCComponent"),mixins:[r],editor:!1,statics:{EventType:s},ctor:function(){cc.EventTarget.call(this);this._animator=null;this._nameToState=e.createMap(!0);this._didInit=!1;this._currentClip=null},properties:{_defaultClip:{"default":null,type:i},defaultClip:{type:i,get:function(){return this._defaultClip},set:function(){},tooltip:!1},currentClip:{get:function(){return this._currentClip},set:function(n){this._currentClip=n},type:i,visible:!1},_writableClips:{get:function(){return this._clips},set:function(n){this._didInit=!1;this._clips=n;this._init()},type:[i]},_clips:{"default":[],type:[i],tooltip:!1,visible:!0},playOnLoad:{"default":!1,tooltip:!1}},start:function(){if(this.playOnLoad&&this._defaultClip&&(!this._animator||!this._animator.isPlaying)){var n=this.getAnimationState(this._defaultClip.name);this._animator.playState(n)}},onEnable:function(){this._animator&&this._animator.resume()},onDisable:function(){this._animator&&this._animator.pause()},onDestroy:function(){this.stop()},getClips:function(){return this._clips},play:function(n,t){var i=this.playAdditive(n,t);return this._animator.stopStatesExcept(i),i},playAdditive:function(n,t){var i,r;return this._init(),i=this.getAnimationState(n||this._defaultClip&&this._defaultClip.name),i&&(this.enabled=!0,r=this._animator,r.isPlaying&&i.isPlaying?i.isPaused?r.resumeState(i):(r.stopState(i),r.playState(i,t)):r.playState(i,t),this.enabledInHierarchy||r.pause(),this.currentClip=i.clip),i},stop:function(n){if(this._didInit)if(n){var t=this._nameToState[n];t&&this._animator.stopState(t)}else this._animator.stop()},pause:function(n){if(this._didInit)if(n){var t=this._nameToState[n];t&&this._animator.pauseState(t)}else this.enabled=!1},resume:function(n){if(this._didInit)if(n){var t=this.getAnimationState(n);t&&this._animator.resumeState(t)}else this.enabled=!0},setCurrentTime:function(n,t){if(this._init(),t){var i=this.getAnimationState(t);i&&this._animator.setStateTime(i,n)}else this._animator.setStateTime(n)},getAnimationState:function(n){this._init();var t=this._nameToState[n];return t&&!t.curveLoaded&&this._animator._reloadClip(t),t||null},addClip:function(n,t){var i,r,u;if(n){if(this._init(),cc.js.array.contains(this._clips,n)||this._clips.push(n),t=t||n.name,i=this._nameToState[t],i){if(i.clip===n)return i;r=this._clips.indexOf(i.clip);-1!==r&&this._clips.splice(r,1)}return u=new cc.AnimationState(n,t),this._nameToState[t]=u,u}cc.warnID(3900)},removeClip:function(n,t){var i,r;if(n){for(r in this._init(),this._nameToState)if(i=this._nameToState[r],u(i.clip,n))break;if(n===this._defaultClip){if(!t)return void cc.warnID(3902);this._defaultClip=null}if(i&&i.isPlaying){if(!t)return void cc.warnID(3903);this.stop(i.name)}this._clips=this._clips.filter(function(t){return!u(t,n)});i&&delete this._nameToState[i.name]}else cc.warnID(3901)},sample:function(n){if(this._init(),n){var t=this.getAnimationState(n);t&&t.sample()}else this._animator.sample()},on:function(n,t,i,r){var f,u,e;if(this._init(),f=this._EventTargetOn(n,t,i,r),"lastframe"===n){u=this._nameToState;for(e in u)u[e]._lastframeEventOn=!0}return f},off:function(n,t,i,r){var u,f;if(this._init(),"lastframe"===n){u=this._nameToState;for(f in u)u[f]._lastframeEventOn=!1}this._EventTargetOff(n,t,i,r)},_init:function(){this._didInit||(this._didInit=!0,this._animator=new o(this.node,this),this._createStates())},_createStates:function(){var t;this._nameToState=e.createMap(!0);for(var n=null,r=!1,i=0;i<this._clips.length;++i)t=this._clips[i],t&&(n=new cc.AnimationState(t),this._nameToState[n.name]=n,u(this._defaultClip,t)&&(r=n));this._defaultClip&&!r&&(n=new cc.AnimationState(this._defaultClip),this._nameToState[n.name]=n)}});f.prototype._EventTargetOn=r.prototype.on;f.prototype._EventTargetOff=r.prototype.off;cc.Animation=t.exports=f},{"../../animation/animation-animator":9,"../../animation/animation-clip":10,"../event/event-target":142,"../platform/js":216,"./CCComponent":105}],101:[function(n,t){"use strict";var r=n("../utils/misc"),u=n("./CCComponent"),i=n("../assets/CCAudioClip"),f=cc.Class({name:"cc.AudioSource","extends":u,editor:!1,ctor:function(){this.audio=new cc._Audio},properties:{_clip:{"default":null,type:i},_volume:1,_mute:!1,_loop:!1,_pausedFlag:{"default":!1,serializable:!1},_firstlyEnabled:!0,isPlaying:{get:function(){return this.audio.getState()===cc._Audio.State.PLAYING},visible:!1},clip:{get:function(){return this._clip},set:function(n){if(n!==this._clip){if(!(n instanceof i))return cc.error("Wrong type of AudioClip.");this._clip=n;this.audio.stop();this.audio.src=this._clip;this.preload&&this._clip._ensureLoaded()}},type:i,tooltip:!1,animatable:!1},volume:{get:function(){return this._volume},set:function(n){return n=r.clamp01(n),this._volume=n,this._mute||this.audio.setVolume(n),n},tooltip:!1},mute:{get:function(){return this._mute},set:function(n){return this._mute=n,this.audio.setVolume(n?0:this._volume),n},animatable:!1,tooltip:!1},loop:{get:function(){return this._loop},set:function(n){return this._loop=n,this.audio.setLoop(n),n},animatable:!1,tooltip:!1},playOnLoad:{"default":!1,tooltip:!1,animatable:!1},preload:{"default":!1,animatable:!1}},_pausedCallback:function(){this.audio.getState()===cc._Audio.State.PLAYING&&(this.audio.pause(),this._pausedFlag=!0)},_restoreCallback:function(){this._pausedFlag&&this.audio.resume();this._pausedFlag=!1},onLoad:function(){this.audio.src||(this.audio.src=this._clip);this.preload&&this._clip._ensureLoaded()},onEnable:function(){this.playOnLoad&&this._firstlyEnabled&&(this._firstlyEnabled=!1,this.play());cc.game.on(cc.game.EVENT_HIDE,this._pausedCallback,this);cc.game.on(cc.game.EVENT_SHOW,this._restoreCallback,this)},onDisable:function(){this.stop();cc.game.off(cc.game.EVENT_HIDE,this._pausedCallback,this);cc.game.off(cc.game.EVENT_SHOW,this._restoreCallback,this)},onDestroy:function(){this.audio.destroy()},play:function(){if(this._clip){var n=this.audio;n.setVolume(this._mute?0:this._volume);n.setLoop(this._loop);n.setCurrentTime(0);n.play()}},stop:function(){this.audio.stop()},pause:function(){this.audio.pause()},resume:function(){this.audio.resume()},rewind:function(){this.audio.setCurrentTime(0)},getCurrentTime:function(){return this.audio.getCurrentTime()},setCurrentTime:function(n){return this.audio.setCurrentTime(n),n},getDuration:function(){return this.audio.getDuration()}});cc.AudioSource=t.exports=f},{"../assets/CCAudioClip":63,"../utils/misc":269,"./CCComponent":105}],102:[function(n,t){"use strict";function r(n){n.stopPropagation()}var i=["touchstart","touchmove","touchend","mousedown","mousemove","mouseup","mouseenter","mouseleave","mousewheel"],u=cc.Class({name:"cc.BlockInputEvents","extends":n("./CCComponent"),editor:{menu:"i18n:MAIN_MENU.component.ui/Block Input Events",inspector:"packages://inspector/inspectors/comps/block-input-events.js",help:"i18n:COMPONENT.help_url.block_input_events"},onEnable:function(){for(var n=0;n<i.length;n++)this.node.on(i[n],r,this)},onDisable:function(){for(var n=0;n<i.length;n++)this.node.off(i[n],r,this)}});cc.BlockInputEvents=t.exports=u},{"./CCComponent":105}],103:[function(n,t){"use strict";var u=n("./CCComponent"),f=n("../utils/gray-sprite-state"),r=cc.Enum({NONE:0,COLOR:1,SPRITE:2,SCALE:3}),i=cc.Enum({NORMAL:0,HOVER:1,PRESSED:2,DISABLED:3}),e=cc.Class({name:"cc.Button","extends":u,mixins:[f],ctor:function(){this._pressed=!1;this._hovered=!1;this._fromColor=null;this._toColor=null;this._time=0;this._transitionFinished=!0;this._fromScale=cc.Vec2.ZERO;this._toScale=cc.Vec2.ZERO;this._originalScale=null;this._graySpriteMaterial=null;this._spriteMaterial=null;this._sprite=null},editor:!1,properties:{interactable:{"default":!0,tooltip:!1,notify:function(){this._updateState();this.interactable||this._resetState()},animatable:!1},_resizeToTarget:{animatable:!1,set:function(n){n&&this._resizeNodeToTargetNode()}},enableAutoGrayEffect:{"default":!1,tooltip:!1,notify:function(){this._updateDisabledState(!0)}},transition:{"default":r.NONE,tooltip:!1,type:r,animatable:!1,notify:function(n){this._updateTransition(n)},formerlySerializedAs:"transition"},normalColor:{"default":cc.Color.WHITE,displayName:"Normal",tooltip:!1,notify:function(){this.transition===r.Color&&this._getButtonState()===i.NORMAL&&(this._getTarget().opacity=this.normalColor.a);this._updateState()}},pressedColor:{"default":cc.color(211,211,211),displayName:"Pressed",tooltip:!1,notify:function(){this.transition===r.Color&&this._getButtonState()===i.PRESSED&&(this._getTarget().opacity=this.pressedColor.a);this._updateState()},formerlySerializedAs:"pressedColor"},hoverColor:{"default":cc.Color.WHITE,displayName:"Hover",tooltip:!1,notify:function(){this.transition===r.Color&&this._getButtonState()===i.HOVER&&(this._getTarget().opacity=this.hoverColor.a);this._updateState()},formerlySerializedAs:"hoverColor"},disabledColor:{"default":cc.color(124,124,124),displayName:"Disabled",tooltip:!1,notify:function(){this.transition===r.Color&&this._getButtonState()===i.DISABLED&&(this._getTarget().opacity=this.disabledColor.a);this._updateState()}},duration:{"default":.1,range:[0,10],tooltip:!1},zoomScale:{"default":1.2,tooltip:!1},normalSprite:{"default":null,type:cc.SpriteFrame,displayName:"Normal",tooltip:!1,notify:function(){this._updateState()}},pressedSprite:{"default":null,type:cc.SpriteFrame,displayName:"Pressed",tooltip:!1,formerlySerializedAs:"pressedSprite",notify:function(){this._updateState()}},hoverSprite:{"default":null,type:cc.SpriteFrame,displayName:"Hover",tooltip:!1,formerlySerializedAs:"hoverSprite",notify:function(){this._updateState()}},disabledSprite:{"default":null,type:cc.SpriteFrame,displayName:"Disabled",tooltip:!1,notify:function(){this._updateState()}},target:{"default":null,type:cc.Node,tooltip:!1,notify:function(n){this._applyTarget();n&&this.target!==n&&this._unregisterTargetEvent(n)}},clickEvents:{"default":[],type:cc.Component.EventHandler,tooltip:!1}},statics:{Transition:r},__preload:function(){this._applyTarget();this._resetState()},_resetState:function(){this._pressed=!1;this._hovered=!1;var i=this._getTarget(),t=this.transition,n=this._originalScale;t===r.COLOR&&this.interactable?this._setTargetColor(this.normalColor):t===r.SCALE&&n&&i.setScale(n.x,n.y);this._transitionFinished=!0},onEnable:function(){this.normalSprite&&this.normalSprite.ensureLoadTexture();this.hoverSprite&&this.hoverSprite.ensureLoadTexture();this.pressedSprite&&this.pressedSprite.ensureLoadTexture();this.disabledSprite&&this.disabledSprite.ensureLoadTexture();this._registerNodeEvent();this._updateState()},onDisable:function(){this._resetState();this._unregisterNodeEvent()},_getTarget:function(){return this.target?this.target:this.node},_onTargetSpriteFrameChanged:function(n){this.transition===r.SPRITE&&this._setCurrentStateSprite(n.spriteFrame)},_onTargetColorChanged:function(n){this.transition===r.COLOR&&this._setCurrentStateColor(n)},_onTargetScaleChanged:function(){var n=this._getTarget();this._originalScale&&(this.transition!==r.SCALE||this._transitionFinished)&&(this._originalScale.x=n.scaleX,this._originalScale.y=n.scaleY)},_setTargetColor:function(n){var i=this._getTarget(),t=n.clone();i.opacity=t.a;t.a=255;i.color=t},_getStateColor:function(n){switch(n){case i.NORMAL:return this.normalColor;case i.HOVER:return this.hoverColor;case i.PRESSED:return this.pressedColor;case i.DISABLED:return this.disabledColor}},_getStateSprite:function(n){switch(n){case i.NORMAL:return this.normalSprite;case i.HOVER:return this.hoverSprite;case i.PRESSED:return this.pressedSprite;case i.DISABLED:return this.disabledSprite}},_setCurrentStateColor:function(n){switch(this._getButtonState()){case i.NORMAL:this.normalColor=n;break;case i.HOVER:this.hoverColor=n;break;case i.PRESSED:this.pressedColor=n;break;case i.DISABLED:this.disabledColor=n}},_setCurrentStateSprite:function(n){switch(this._getButtonState()){case i.NORMAL:this.normalSprite=n;break;case i.HOVER:this.hoverSprite=n;break;case i.PRESSED:this.pressedSprite=n;break;case i.DISABLED:this.disabledSprite=n}},update:function(n){var u=this._getTarget(),t,i;this._transitionFinished||this.transition!==r.COLOR&&this.transition!==r.SCALE||(this.time+=n,t=1,(this.duration>0&&(t=this.time/this.duration),t>=1&&(t=1),this.transition===r.COLOR)?(i=this._fromColor.lerp(this._toColor,t),this._setTargetColor(i)):this.transition===r.SCALE&&this._originalScale&&(u.scale=this._fromScale.lerp(this._toScale,t)),1===t&&(this._transitionFinished=!0))},_registerNodeEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this);this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this);this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this);this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this);this.node.on(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this);this.node.on(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this)},_unregisterNodeEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this);this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this);this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this);this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this);this.node.off(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this);this.node.off(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this)},_registerTargetEvent:function(n){n.on(cc.Node.EventType.SCALE_CHANGED,this._onTargetScaleChanged,this)},_unregisterTargetEvent:function(n){n.off(cc.Node.EventType.SCALE_CHANGED,this._onTargetScaleChanged,this)},_getTargetSprite:function(n){var t=null;return n&&(t=n.getComponent(cc.Sprite)),t},_applyTarget:function(){var n=this._getTarget();this._sprite=this._getTargetSprite(n);this._originalScale||(this._originalScale=cc.Vec2.ZERO);this._originalScale.x=n.scaleX;this._originalScale.y=n.scaleY;this._registerTargetEvent(n)},_onTouchBegan:function(n){this.interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),n.stopPropagation())},_onTouchMove:function(n){if(this.interactable&&this.enabledInHierarchy&&this._pressed){var u,e=n.touch,f=this.node._hitTest(e.getLocation()),o=this._getTarget(),t=this._originalScale;this.transition===r.SCALE&&t?f?(this._fromScale.x=t.x,this._fromScale.y=t.y,this._toScale.x=t.x*this.zoomScale,this._toScale.y=t.y*this.zoomScale,this._transitionFinished=!1):(this.time=0,this._transitionFinished=!0,o.setScale(t.x,t.y)):(u=f?i.PRESSED:i.NORMAL,this._applyTransition(u));n.stopPropagation()}},_onTouchEnded:function(n){this.interactable&&this.enabledInHierarchy&&(this._pressed&&(cc.Component.EventHandler.emitEvents(this.clickEvents,n),this.node.emit("click",this)),this._pressed=!1,this._updateState(),n.stopPropagation())},_onTouchCancel:function(){this.interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())},_onMouseMoveIn:function(){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(this.transition!==r.SPRITE||this.hoverSprite)&&(this._hovered||(this._hovered=!0,this._updateState()))},_onMouseMoveOut:function(){this._hovered&&(this._hovered=!1,this._updateState())},_updateState:function(){var n=this._getButtonState();this._applyTransition(n);this._updateDisabledState()},_getButtonState:function(){return this.interactable?this._pressed?i.PRESSED:this._hovered?i.HOVER:i.NORMAL:i.DISABLED},_updateColorTransitionImmediately:function(n){var t=this._getStateColor(n);this._setTargetColor(t);this._fromColor=t.clone();this._toColor=t},_updateColorTransition:function(n){if(n===i.DISABLED)this._updateColorTransitionImmediately(n);else{var t=this._getTarget(),r=this._getStateColor(n);this._fromColor=t.color.clone();this._toColor=r;this.time=0;this._transitionFinished=!1}},_updateSpriteTransition:function(n){var t=this._getStateSprite(n);this._sprite&&t&&(this._sprite.spriteFrame=t)},_updateScaleTransition:function(n){n===i.PRESSED?this._zoomUp():this._zoomBack()},_zoomUp:function(){this._originalScale&&(this._fromScale.x=this._originalScale.x,this._fromScale.y=this._originalScale.y,this._toScale.x=this._originalScale.x*this.zoomScale,this._toScale.y=this._originalScale.y*this.zoomScale,this.time=0,this._transitionFinished=!1)},_zoomBack:function(){if(this._originalScale){var n=this._getTarget();this._fromScale.x=n.scaleX;this._fromScale.y=n.scaleY;this._toScale.x=this._originalScale.x;this._toScale.y=this._originalScale.y;this.time=0;this._transitionFinished=!1}},_updateTransition:function(n){n===r.COLOR?this._updateColorTransitionImmediately(i.NORMAL):n===r.SPRITE&&this._updateSpriteTransition(i.NORMAL);this._updateState()},_applyTransition:function(n){var t=this.transition;t===r.COLOR?this._updateColorTransition(n):t===r.SPRITE?this._updateSpriteTransition(n):t===r.SCALE&&this._updateScaleTransition(n)},_resizeNodeToTargetNode:!1,_updateDisabledState:function(n){if(this._sprite&&(this.enableAutoGrayEffect||n)){var t=!1;this.transition===r.SPRITE&&this.disabledSprite||(t=this.enableAutoGrayEffect&&!this.interactable);this._switchGrayMaterial(t,this._sprite)}}});cc.Button=t.exports=e},{"../utils/gray-sprite-state":266,"./CCComponent":105}],104:[function(n,t){"use strict";var r=n("../camera/CCCamera"),u=n("./CCComponent"),i=cc.Class({name:"cc.Canvas","extends":u,editor:!1,resetInEditor:!1,statics:{instance:null},properties:{_designResolution:cc.size(960,640),designResolution:{get:function(){return cc.size(this._designResolution)},set:function(n){this._designResolution.width=n.width;this._designResolution.height=n.height;this.applySettings()},tooltip:!1},_fitWidth:!1,_fitHeight:!0,fitHeight:{get:function(){return this._fitHeight},set:function(n){this._fitHeight!==n&&(this._fitHeight=n,this.applySettings())},tooltip:!1},fitWidth:{get:function(){return this._fitWidth},set:function(n){this._fitWidth!==n&&(this._fitWidth=n,this.applySettings())},tooltip:!1}},_fitDesignResolution:!1,__preload:function(){if(i.instance)return cc.warnID(6700,this.node.name,i.instance.node.name);i.instance=this;this.applySettings();var n=this.getComponent(cc.Widget);n&&n.updateAlignment()},start:function(){var n,i,t;r.main||cc.game.renderType===cc.game.RENDER_TYPE_CANVAS||(n=new cc.Node("Main Camera"),n.parent=this.node,n.setSiblingIndex(0),i=n.addComponent(r),t=r.ClearFlags,i.clearFlags=t.COLOR|t.DEPTH|t.STENCIL,i.depth=-1)},onDestroy:function(){i.instance===this&&(i.instance=null)},applySettings:function(){var i,n=cc.ResolutionPolicy,t;i=this.fitHeight&&this.fitWidth?n.SHOW_ALL:this.fitHeight||this.fitWidth?this.fitWidth?n.FIXED_WIDTH:n.FIXED_HEIGHT:n.NO_BORDER;t=this._designResolution;cc.view.setDesignResolutionSize(t.width,t.height,i)}});cc.Canvas=t.exports=i},{"../camera/CCCamera":90,"./CCComponent":105}],105:[function(n,t){"use strict";var r=n("../platform/CCObject"),u=n("../platform/js"),f=new(n("../platform/id-generater"))("Comp"),e=(r.Flags.IsOnEnableCalled,r.Flags.IsOnLoadCalled),o=!!cc.ActionManager,i=cc.Class({name:"cc.Component","extends":r,ctor:function(){this._id=f.getNewId();this.__eventTargets=[]},properties:{node:{"default":null,visible:!1},name:{get:function(){if(this._name)return this._name;var n=cc.js.getClassName(this),t=n.lastIndexOf(".");return t>=0&&(n=n.slice(t+1)),this.node.name+"<"+n+">"},set:function(n){this._name=n},visible:!1},uuid:{get:function(){return this._id},visible:!1},__scriptAsset:!1,_enabled:!0,enabled:{get:function(){return this._enabled},set:function(n){if(this._enabled!==n&&(this._enabled=n,this.node._activeInHierarchy)){var t=cc.director._compScheduler;n?t.enableComp(this):t.disableComp(this)}},visible:!1,animatable:!0},enabledInHierarchy:{get:function(){return this._enabled&&this.node._activeInHierarchy},visible:!1},_isOnLoadCalled:{get:function(){return this._objFlags&e}}},update:null,lateUpdate:null,__preload:null,onLoad:null,start:null,onEnable:null,onDisable:null,onDestroy:null,onFocusInEditor:null,onLostFocusInEditor:null,resetInEditor:null,addComponent:function(n){return this.node.addComponent(n)},getComponent:function(n){return this.node.getComponent(n)},getComponents:function(n){return this.node.getComponents(n)},getComponentInChildren:function(n){return this.node.getComponentInChildren(n)},getComponentsInChildren:function(n){return this.node.getComponentsInChildren(n)},_getLocalBounds:null,onRestore:null,destroy:function(){this._super()&&this._enabled&&this.node._activeInHierarchy&&cc.director._compScheduler.disableComp(this)},_onPreDestroy:function(){var n,t,i;for(o&&cc.director.getActionManager().removeAllActionsFromTarget(this),this.unscheduleAllCallbacks(),n=this.__eventTargets,t=n.length-1;t>=0;--t)i=n[t],i&&i.targetOff(this);n.length=0;cc.director._nodeActivator.destroyComp(this);this.node._removeComponent(this)},_instantiate:function(n){return n||(n=cc.instantiate._clone(this,this)),n.node=null,n},schedule:function(n,t,i,r){cc.assertID(n,1619);t=t||0;cc.assertID(t>=0,1620);i=isNaN(i)?cc.macro.REPEAT_FOREVER:i;r=r||0;var u=cc.director.getScheduler(),f=u.isTargetPaused(this);u.schedule(n,this,t,i,r,f)},scheduleOnce:function(n,t){this.schedule(n,0,0,t)},unschedule:function(n){n&&cc.director.getScheduler().unschedule(n,this)},unscheduleAllCallbacks:function(){cc.director.getScheduler().unscheduleAllForTarget(this)}});i._requireComponent=null;i._executionOrder=0;u.value(i,"_registerEditorProps",function(n,t){var r=t.requireComponent,i;r&&(n._requireComponent=r);i=t.executionOrder;i&&"number"==typeof i&&(n._executionOrder=i)});i.prototype.__scriptUuid="";cc.Component=t.exports=i},{"../platform/CCObject":201,"../platform/id-generater":212,"../platform/js":216}],106:[function(){"use strict";cc.Component.EventHandler=cc.Class({name:"cc.ClickEvent",properties:{target:{"default":null,type:cc.Node},component:"",_componentId:"",_componentName:{get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(n){this._componentId=this._compName2Id(n)}},handler:{"default":""},customEventData:{"default":""}},statics:{emitEvents:function(n){var r,t,f,i,e,u;if(arguments.length>0)for(t=0,f=(r=new Array(arguments.length-1)).length;t<f;t++)r[t]=arguments[t+1];for(i=0,e=n.length;i<e;i++)u=n[i],u instanceof cc.Component.EventHandler&&u.emit(r)}},emit:function(n){var r=this.target,u,t,i;cc.isValid(r)&&(this._genCompIdIfNeeded(),u=cc.js._getClassById(this._componentId),t=r.getComponent(u),cc.isValid(t)&&(i=t[this.handler],"function"==typeof i&&(null!=this.customEventData&&""!==this.customEventData&&(n=n.slice()).push(this.customEventData),i.apply(t,n))))},_compName2Id:function(n){var t=cc.js.getClassByName(n);return cc.js._getClassId(t)},_compId2Name:function(n){var t=cc.js._getClassById(n);return cc.js.getClassName(t)},_genCompIdIfNeeded:function(){this._componentId||(this._componentName=this.component,this.component="")}})},{}],107:[function(n,t){"use strict";var s=n("../platform/CCMacro"),u=n("./CCRenderComponent"),c=(n("../assets/material/CCMaterial"),n("../renderer/utils/label/label-frame")),h=n("../utils/blend-func"),l=n("../renderer/utils/utils").deleteFromDynamicAtlas,f=s.TextAlignment,e=s.VerticalTextAlignment,r=cc.Enum({NONE:0,CLAMP:1,SHRINK:2,RESIZE_HEIGHT:3}),i=cc.Enum({NONE:0,BITMAP:1,CHAR:2}),o=cc.Class({name:"cc.Label","extends":u,mixins:[h],ctor:function(){this._actualFontSize=0;this._assemblerData=null;this._frame=null;this._ttfTexture=null;this._letterTexture=null;this._updateMaterial=cc.game.renderType===cc.game.RENDER_TYPE_CANVAS?this._updateMaterialCanvas:this._updateMaterialWebgl},editor:!1,properties:{_string:{"default":"",formerlySerializedAs:"_N$string"},string:{get:function(){return this._string},set:function(n){var t=this._string;this._string=""+n;this.string!==t&&this.setVertsDirty();this._checkStringEmpty()},multiline:!0,tooltip:!1},horizontalAlign:{"default":f.LEFT,type:f,tooltip:!1,notify:function(n){this.horizontalAlign!==n&&this.setVertsDirty()},animatable:!1},verticalAlign:{"default":e.TOP,type:e,tooltip:!1,notify:function(n){this.verticalAlign!==n&&this.setVertsDirty()},animatable:!1},actualFontSize:{displayName:"Actual Font Size",animatable:!1,readonly:!0,get:function(){return this._actualFontSize},tooltip:!1},_fontSize:40,fontSize:{get:function(){return this._fontSize},set:function(n){this._fontSize!==n&&(this._fontSize=n,this.setVertsDirty())},range:[0,512],tooltip:!1},fontFamily:{"default":"Arial",tooltip:!1,notify:function(n){this.fontFamily!==n&&this.setVertsDirty()},animatable:!1},_lineHeight:40,lineHeight:{get:function(){return this._lineHeight},set:function(n){this._lineHeight!==n&&(this._lineHeight=n,this.setVertsDirty())},tooltip:!1},overflow:{"default":r.NONE,type:r,tooltip:!1,notify:function(n){this.overflow!==n&&this.setVertsDirty()},animatable:!1},_enableWrapText:!0,enableWrapText:{get:function(){return this._enableWrapText},set:function(n){this._enableWrapText!==n&&(this._enableWrapText=n,this.setVertsDirty())},animatable:!1,tooltip:!1},_N$file:null,font:{get:function(){return this._N$file},set:function(n){this.font!==n&&(n||(this._isSystemFontUsed=!0),this._N$file=n,n&&this._isSystemFontUsed&&(this._isSystemFontUsed=!1),this.enabledInHierarchy&&this._forceUpdateRenderData())},type:cc.Font,tooltip:!1,animatable:!1},_isSystemFontUsed:!0,useSystemFont:{get:function(){return this._isSystemFontUsed},set:function(n){if(this._isSystemFontUsed!==n){if(this._isSystemFontUsed=!!n,n){if(this.font=null,!this.enabledInHierarchy)return;this._forceUpdateRenderData()}this.markForValidate()}},animatable:!1,tooltip:!1},_bmFontOriginalSize:{displayName:"BMFont Original Size",get:function(){return this._N$file instanceof cc.BitmapFont?this._N$file.fontSize:-1},visible:!0,animatable:!1},_spacingX:0,spacingX:{get:function(){return this._spacingX},set:function(n){this._spacingX=n;this.setVertsDirty()},tooltip:!1},_batchAsBitmap:!1,cacheMode:{"default":i.NONE,type:i,tooltip:!1,notify:function(n){this.cacheMode!==n&&(n!==i.BITMAP||this.font instanceof cc.BitmapFont||this._frame&&this._frame._resetDynamicAtlasFrame(),n===i.CHAR&&(this._ttfTexture=null),this.enabledInHierarchy&&this._forceUpdateRenderData())},animatable:!1},_styleFlags:0,enableBold:{get:function(){return!!(1&this._styleFlags)},set:function(n){n?this._styleFlags|=1:this._styleFlags&=-2;this.setVertsDirty()},animatable:!1,tooltip:!1},enableItalic:{get:function(){return!!(2&this._styleFlags)},set:function(n){n?this._styleFlags|=2:this._styleFlags&=-3;this.setVertsDirty()},animatable:!1,tooltip:!1},enableUnderline:{get:function(){return!!(4&this._styleFlags)},set:function(n){n?this._styleFlags|=4:this._styleFlags&=-5;this.setVertsDirty()},animatable:!1,tooltip:!1},_underlineHeight:0,underlineHeight:{get:function(){return this._underlineHeight},set:function(n){this._underlineHeight!==n&&(this._underlineHeight=n,this.setVertsDirty())},tooltip:!1}},statics:{HorizontalAlign:f,VerticalAlign:e,Overflow:r,CacheMode:i,_shareAtlas:null,clearCharCache:function(){o._shareAtlas&&o._shareAtlas.clearAllCache()}},onLoad:function(){this._batchAsBitmap&&this.cacheMode===i.NONE&&(this.cacheMode=i.BITMAP,this._batchAsBitmap=!1);cc.game.renderType===cc.game.RENDER_TYPE_CANVAS&&(this.cacheMode=i.NONE)},onEnable:function(){this._super();this.node.on(cc.Node.EventType.SIZE_CHANGED,this._nodeSizeChanged,this);this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this);this.node.on(cc.Node.EventType.COLOR_CHANGED,this._nodeColorChanged,this);this._forceUpdateRenderData()},onDisable:function(){this._super();this.node.off(cc.Node.EventType.SIZE_CHANGED,this._nodeSizeChanged,this);this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this);this.node.off(cc.Node.EventType.COLOR_CHANGED,this._nodeColorChanged,this)},onDestroy:function(){this._assembler&&this._assembler._resetAssemblerData&&this._assembler._resetAssemblerData(this._assemblerData);this._assemblerData=null;this._letterTexture=null;this._ttfTexture&&(this._ttfTexture.destroy(),this._ttfTexture=null);this._super()},_nodeSizeChanged:function(){this.overflow!==r.NONE&&this.setVertsDirty()},_nodeColorChanged:function(){this.font instanceof cc.BitmapFont||this.setVertsDirty()},setVertsDirty:function(){this._super()},_updateColor:function(){this.font instanceof cc.BitmapFont||this._srcBlendFactor===cc.macro.BlendFactor.SRC_ALPHA&&this.node._renderFlag&cc.RenderFlow.FLAG_OPACITY||this.setVertsDirty();u.prototype._updateColor.call(this)},_validateRender:function(){var n,t;if(this.string){if(this._materials[0]){if(n=this.font,!(n instanceof cc.BitmapFont))return;if(t=n.spriteFrame,t&&t.textureLoaded()&&n._fntConfig)return}this.disableRender()}else this.disableRender()},_resetAssembler:function(){this._resetFrame();u.prototype._resetAssembler.call(this)},_resetFrame:function(){!this._frame||this.font instanceof cc.BitmapFont||(l(this,this._frame),this._frame=null)},_checkStringEmpty:function(){this.markForRender(!!this.string)},_on3DNodeChanged:function(){this._resetAssembler();this._applyFontTexture()},_onBMFontTextureLoaded:function(){this._frame._texture=this.font.spriteFrame._texture;this.markForRender(!0);this._updateMaterial();this._assembler&&this._assembler.updateRenderData(this)},_onBlendChanged:function(){this.useSystemFont&&this.enabledInHierarchy&&this._forceUpdateRenderData()},_applyFontTexture:function(){var t=this.font,n;t instanceof cc.BitmapFont?(n=t.spriteFrame,this._frame=n,n&&n.onTextureLoaded(this._onBMFontTextureLoaded,this)):(this._nativeTTF()||(this._frame||(this._frame=new c),this.cacheMode===i.CHAR?(this._letterTexture=this._assembler._getAssemblerData(),this._frame._refreshTexture(this._letterTexture)):this._ttfTexture||(this._ttfTexture=new cc.Texture2D,this._assemblerData=this._assembler._getAssemblerData(),this._ttfTexture.initWithElement(this._assemblerData.canvas)),this.cacheMode!==i.CHAR&&(this._frame._resetDynamicAtlasFrame(),this._frame._refreshTexture(this._ttfTexture),this._srcBlendFactor===cc.macro.BlendFactor.ONE&&this._ttfTexture.setPremultiplyAlpha(!0)),this._updateMaterial()),this._assembler&&this._assembler.updateRenderData(this));this.markForValidate()},_updateMaterialCanvas:function(){this._frame&&(this._frame._texture._nativeUrl=this.uuid+"_texture")},_updateMaterialWebgl:function(){var n=this.getMaterial(0);this._nativeTTF()?n&&this._assembler._updateTTFMaterial(this):this._frame&&(n&&n.setProperty("texture",this._frame._texture),h.prototype._updateMaterial.call(this))},_forceUseCanvas:!1,_useNativeTTF:function(){return cc.macro.ENABLE_NATIVE_TTF_RENDERER&&!this._forceUseCanvas},_nativeTTF:function(){return this._useNativeTTF()&&!!this._assembler&&!!this._assembler._updateTTFMaterial},_forceUpdateRenderData:function(){this.setVertsDirty();this._resetAssembler();this._applyFontTexture()},_enableBold:function(n){this.enableBold=!!n},_enableItalics:function(n){this.enableItalic=!!n},_enableUnderline:function(n){this.enableUnderline=!!n}});cc.Label=t.exports=o},{"../assets/material/CCMaterial":80,"../platform/CCMacro":200,"../renderer/utils/label/label-frame":231,"../renderer/utils/utils":234,"../utils/blend-func":263,"./CCRenderComponent":115}],108:[function(n,t){"use strict";var i=cc.Class({name:"cc.LabelOutline","extends":n("./CCComponent"),editor:!1,properties:{_color:cc.Color.WHITE,_width:1,color:{tooltip:!1,get:function(){return this._color.clone()},set:function(n){this._color.equals(n)||this._color.set(n);this._updateRenderData()}},width:{tooltip:!1,get:function(){return this._width},set:function(n){this._width!==n&&(this._width=n,this._updateRenderData())},range:[0,512]}},onEnable:function(){this._updateRenderData()},onDisable:function(){this._updateRenderData()},_updateRenderData:function(){var n=this.node.getComponent(cc.Label);n&&n.setVertsDirty()}});cc.LabelOutline=t.exports=i},{"./CCComponent":105}],109:[function(n,t){"use strict";var i=cc.Class({name:"cc.LabelShadow","extends":n("./CCComponent"),editor:!1,properties:{_color:cc.Color.WHITE,_offset:cc.v2(2,2),_blur:2,color:{tooltip:!1,get:function(){return this._color.clone()},set:function(n){this._color.equals(n)||this._color.set(n);this._updateRenderData()}},offset:{tooltip:!1,get:function(){return this._offset},set:function(n){this._offset=n;this._updateRenderData()}},blur:{tooltip:!1,get:function(){return this._blur},set:function(n){this._blur=n;this._updateRenderData()},range:[0,1024]}},onEnable:function(){this._updateRenderData()},onDisable:function(){this._updateRenderData()},_updateRenderData:function(){var n=this.node.getComponent(cc.Label);n&&n.markForRender(!0)}});cc.LabelShadow=t.exports=i},{"./CCComponent":105}],110:[function(n,t){"use strict";var i=n("../CCNode").EventType,u=cc.Enum({NONE:0,HORIZONTAL:1,VERTICAL:2,GRID:3}),r=cc.Enum({NONE:0,CONTAINER:1,CHILDREN:2}),o=cc.Enum({HORIZONTAL:0,VERTICAL:1}),f=cc.Enum({BOTTOM_TO_TOP:0,TOP_TO_BOTTOM:1}),e=cc.Enum({LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1}),s=cc.Class({name:"cc.Layout","extends":n("./CCComponent"),editor:!1,properties:{_layoutSize:cc.size(300,200),_layoutDirty:{"default":!0,serializable:!1},_resize:r.NONE,_N$layoutType:u.NONE,type:{type:u,get:function(){return this._N$layoutType},set:function(n){this._N$layoutType=n;this._doLayoutDirty()},tooltip:!1,animatable:!1},resizeMode:{type:r,tooltip:!1,animatable:!1,get:function(){return this._resize},set:function(n){this.type===u.NONE&&n===r.CHILDREN||(this._resize=n,this._doLayoutDirty())}},cellSize:{"default":cc.size(40,40),tooltip:!1,type:cc.Size,notify:function(){this._doLayoutDirty()}},startAxis:{"default":o.HORIZONTAL,tooltip:!1,type:o,notify:function(){this._doLayoutDirty()},animatable:!1},paddingLeft:{"default":0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingRight:{"default":0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingTop:{"default":0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingBottom:{"default":0,tooltip:!1,notify:function(){this._doLayoutDirty()}},spacingX:{"default":0,notify:function(){this._doLayoutDirty()},tooltip:!1},spacingY:{"default":0,notify:function(){this._doLayoutDirty()},tooltip:!1},verticalDirection:{"default":f.TOP_TO_BOTTOM,type:f,notify:function(){this._doLayoutDirty()},tooltip:!1,animatable:!1},horizontalDirection:{"default":e.LEFT_TO_RIGHT,type:e,notify:function(){this._doLayoutDirty()},tooltip:!1,animatable:!1},affectedByScale:{"default":!1,notify:function(){this._doLayoutDirty()},animatable:!1,tooltip:!1}},statics:{Type:u,VerticalDirection:f,HorizontalDirection:e,ResizeMode:r,AxisDirection:o},onEnable:function(){this._addEventListeners();this.node.getContentSize().equals(cc.size(0,0))&&this.node.setContentSize(this._layoutSize);this._doLayoutDirty()},onDisable:function(){this._removeEventListeners()},_doLayoutDirty:function(){this._layoutDirty=!0},_doScaleDirty:function(){this._layoutDirty=this._layoutDirty||this.affectedByScale},_addEventListeners:function(){cc.director.on(cc.Director.EVENT_AFTER_UPDATE,this.updateLayout,this);this.node.on(i.SIZE_CHANGED,this._resized,this);this.node.on(i.ANCHOR_CHANGED,this._doLayoutDirty,this);this.node.on(i.CHILD_ADDED,this._childAdded,this);this.node.on(i.CHILD_REMOVED,this._childRemoved,this);this.node.on(i.CHILD_REORDER,this._doLayoutDirty,this);this._addChildrenEventListeners()},_removeEventListeners:function(){cc.director.off(cc.Director.EVENT_AFTER_UPDATE,this.updateLayout,this);this.node.off(i.SIZE_CHANGED,this._resized,this);this.node.off(i.ANCHOR_CHANGED,this._doLayoutDirty,this);this.node.off(i.CHILD_ADDED,this._childAdded,this);this.node.off(i.CHILD_REMOVED,this._childRemoved,this);this.node.off(i.CHILD_REORDER,this._doLayoutDirty,this);this._removeChildrenEventListeners()},_addChildrenEventListeners:function(){for(var n,r=this.node.children,t=0;t<r.length;++t)n=r[t],n.on(i.SCALE_CHANGED,this._doScaleDirty,this),n.on(i.SIZE_CHANGED,this._doLayoutDirty,this),n.on(i.POSITION_CHANGED,this._doLayoutDirty,this),n.on(i.ANCHOR_CHANGED,this._doLayoutDirty,this),n.on("active-in-hierarchy-changed",this._doLayoutDirty,this)},_removeChildrenEventListeners:function(){for(var n,r=this.node.children,t=0;t<r.length;++t)n=r[t],n.off(i.SCALE_CHANGED,this._doScaleDirty,this),n.off(i.SIZE_CHANGED,this._doLayoutDirty,this),n.off(i.POSITION_CHANGED,this._doLayoutDirty,this),n.off(i.ANCHOR_CHANGED,this._doLayoutDirty,this),n.off("active-in-hierarchy-changed",this._doLayoutDirty,this)},_childAdded:function(n){n.on(i.SCALE_CHANGED,this._doScaleDirty,this);n.on(i.SIZE_CHANGED,this._doLayoutDirty,this);n.on(i.POSITION_CHANGED,this._doLayoutDirty,this);n.on(i.ANCHOR_CHANGED,this._doLayoutDirty,this);n.on("active-in-hierarchy-changed",this._doLayoutDirty,this);this._doLayoutDirty()},_childRemoved:function(n){n.off(i.SCALE_CHANGED,this._doScaleDirty,this);n.off(i.SIZE_CHANGED,this._doLayoutDirty,this);n.off(i.POSITION_CHANGED,this._doLayoutDirty,this);n.off(i.ANCHOR_CHANGED,this._doLayoutDirty,this);n.off("active-in-hierarchy-changed",this._doLayoutDirty,this);this._doLayoutDirty()},_resized:function(){this._layoutSize=this.node.getContentSize();this._doLayoutDirty()},_doLayoutHorizontally:function(n,t,i,o){var w=this.node.getAnchorPoint(),b=this.node.children,c=1,tt=this.paddingLeft,it=-w.x*n,et,ot,g,nt,st,ht;this.horizontalDirection===e.RIGHT_TO_LEFT&&(c=-1,it=(1-w.x)*n,tt=this.paddingRight);for(var y=it+c*tt-c*this.spacingX,rt=0,h=0,a=0,ct=0,l=0,ut=0,ft=0,v=0;v<b.length;++v)(s=b[v]).activeInHierarchy&&ft++;for(et=this.cellSize.width,this.type!==u.GRID&&this.resizeMode===r.CHILDREN&&(et=(n-(this.paddingLeft+this.paddingRight)-(ft-1)*this.spacingX)/ft),v=0;v<b.length;++v){var s=b[v],lt=this._getUsedScaleValue(s.scaleX),at=this._getUsedScaleValue(s.scaleY);if(s.activeInHierarchy){this._resize===r.CHILDREN&&(s.width=et/lt,this.type===u.GRID&&(s.height=this.cellSize.height/at));var k=s.anchorX,d=s.width*lt,p=s.height*at;if(a>h&&(h=a),p>=h&&(a=h,h=p,ut=s.getAnchorPoint().y),this.horizontalDirection===e.RIGHT_TO_LEFT&&(k=1-s.anchorX),y=y+c*k*d+c*this.spacingX,ot=c*(1-k)*d,t){var vt=y+ot+c*(c>0?this.paddingRight:this.paddingLeft),yt=this.horizontalDirection===e.LEFT_TO_RIGHT&&vt>(1-w.x)*n,pt=this.horizontalDirection===e.RIGHT_TO_LEFT&&vt<-w.x*n;(yt||pt)&&(p>=h?(0===a&&(a=h),rt+=a,a=h):(rt+=h,a=p,h=0),y=it+c*(tt+k*d),ct++)}g=i(s,rt,ct);n>=d+this.paddingLeft+this.paddingRight&&o&&s.setPosition(cc.v2(y,g));st=1;ht=0===h?p:h;this.verticalDirection===f.TOP_TO_BOTTOM?(l=l||this.node._contentSize.height,(nt=g+(st=-1)*(ht*ut+this.paddingBottom))<l&&(l=nt)):(l=l||-this.node._contentSize.height,(nt=g+st*(ht*ut+this.paddingTop))>l&&(l=nt));y+=ot}}return l},_getVerticalBaseHeight:function(n){var t=0,f=0,i,u;if(this.resizeMode===r.CONTAINER){for(i=0;i<n.length;++i)u=n[i],u.activeInHierarchy&&(f++,t+=u.height*this._getUsedScaleValue(u.scaleY));t+=(f-1)*this.spacingY+this.paddingBottom+this.paddingTop}else t=this.node.getContentSize().height;return t},_doLayoutVertically:function(n,t,i,o){var w=this.node.getAnchorPoint(),b=this.node.children,c=1,it=this.paddingBottom,rt=-w.y*n,ot,st,g,nt,tt,ht;this.verticalDirection===f.TOP_TO_BOTTOM&&(c=-1,rt=(1-w.y)*n,it=this.paddingTop);for(var y=rt+c*it-c*this.spacingY,ut=0,h=0,a=0,ct=0,l=0,ft=0,et=0,v=0;v<b.length;++v)(s=b[v]).activeInHierarchy&&et++;for(ot=this.cellSize.height,this.type!==u.GRID&&this.resizeMode===r.CHILDREN&&(ot=(n-(this.paddingTop+this.paddingBottom)-(et-1)*this.spacingY)/et),v=0;v<b.length;++v){var s=b[v],lt=this._getUsedScaleValue(s.scaleX),at=this._getUsedScaleValue(s.scaleY);if(s.activeInHierarchy){this.resizeMode===r.CHILDREN&&(s.height=ot/at,this.type===u.GRID&&(s.width=this.cellSize.width/lt));var k=s.anchorY,p=s.width*lt,d=s.height*at;if(a>h&&(h=a),p>=h&&(a=h,h=p,ft=s.getAnchorPoint().x),this.verticalDirection===f.TOP_TO_BOTTOM&&(k=1-s.anchorY),y=y+c*k*d+c*this.spacingY,st=c*(1-k)*d,t){var vt=y+st+c*(c>0?this.paddingTop:this.paddingBottom),yt=this.verticalDirection===f.BOTTOM_TO_TOP&&vt>(1-w.y)*n,pt=this.verticalDirection===f.TOP_TO_BOTTOM&&vt<-w.y*n;(yt||pt)&&(p>=h?(0===a&&(a=h),ut+=a,a=h):(ut+=h,a=p,h=0),y=rt+c*(it+k*d),ct++)}g=i(s,ut,ct);n>=d+(this.paddingTop+this.paddingBottom)&&o&&s.setPosition(cc.v2(g,y));tt=1;ht=0===h?p:h;this.horizontalDirection===e.RIGHT_TO_LEFT?(tt=-1,l=l||this.node._contentSize.width,(nt=g+tt*(ht*ft+this.paddingLeft))<l&&(l=nt)):(l=l||-this.node._contentSize.width,(nt=g+tt*(ht*ft+this.paddingRight))>l&&(l=nt));y+=st}}return l},_doLayoutBasic:function(){for(var r,i,u,t,o,s,e=this.node.children,n=null,f=0;f<e.length;++f)r=e[f],r.activeInHierarchy&&(n?n.union(n,r.getBoundingBoxToWorld()):n=r.getBoundingBoxToWorld());n&&(i=this.node.convertToNodeSpaceAR(cc.v2(n.x,n.y)),i=cc.v2(i.x-this.paddingLeft,i.y-this.paddingBottom),u=this.node.convertToNodeSpaceAR(cc.v2(n.xMax,n.yMax)),t=(u=cc.v2(u.x+this.paddingRight,u.y+this.paddingTop)).sub(i),0!==(t=cc.size(parseFloat(t.x.toFixed(2)),parseFloat(t.y.toFixed(2)))).width&&(o=-i.x/t.width,this.node.anchorX=parseFloat(o.toFixed(2))),0!==t.height&&(s=-i.y/t.height,this.node.anchorY=parseFloat(s.toFixed(2))),this.node.setContentSize(t))},_doLayoutGridAxisHorizontal:function(n,t){var e=t.width,o=1,u=-n.y*t.height,h=this.paddingBottom,s,i,c;this.verticalDirection===f.TOP_TO_BOTTOM&&(o=-1,u=(1-n.y)*t.height,h=this.paddingTop);s=function(n,t,i){return u+o*(t+n.anchorY*n.height*this._getUsedScaleValue(n.scaleY)+h+i*this.spacingY)}.bind(this);i=0;this.resizeMode===r.CONTAINER&&(c=this._doLayoutHorizontally(e,!0,s,!1),(i=u-c)<0&&(i*=-1),u=-n.y*i,this.verticalDirection===f.TOP_TO_BOTTOM&&(o=-1,u=(1-n.y)*i));this._doLayoutHorizontally(e,!0,s,!0);this.resizeMode===r.CONTAINER&&this.node.setContentSize(e,i)},_doLayoutGridAxisVertical:function(n,t){var f=t.height,o=1,u=-n.x*t.width,h=this.paddingLeft,s,i,c;this.horizontalDirection===e.RIGHT_TO_LEFT&&(o=-1,u=(1-n.x)*t.width,h=this.paddingRight);s=function(n,t,i){return u+o*(t+n.anchorX*n.width*this._getUsedScaleValue(n.scaleX)+h+i*this.spacingX)}.bind(this);i=0;this.resizeMode===r.CONTAINER&&(c=this._doLayoutVertically(f,!0,s,!1),(i=u-c)<0&&(i*=-1),u=-n.x*i,this.horizontalDirection===e.RIGHT_TO_LEFT&&(o=-1,u=(1-n.x)*i));this._doLayoutVertically(f,!0,s,!0);this.resizeMode===r.CONTAINER&&this.node.setContentSize(i,f)},_doLayoutGrid:function(){var n=this.node.getAnchorPoint(),t=this.node.getContentSize();this.startAxis===o.HORIZONTAL?this._doLayoutGridAxisHorizontal(n,t):this.startAxis===o.VERTICAL&&this._doLayoutGridAxisVertical(n,t)},_getHorizontalBaseWidth:function(n){var t=0,f=0,i,u;if(this.resizeMode===r.CONTAINER){for(i=0;i<n.length;++i)u=n[i],u.activeInHierarchy&&(f++,t+=u.width*this._getUsedScaleValue(u.scaleX));t+=(f-1)*this.spacingX+this.paddingLeft+this.paddingRight}else t=this.node.getContentSize().width;return t},_doLayout:function(){var n,t;this.type===u.HORIZONTAL?(n=this._getHorizontalBaseWidth(this.node.children),this._doLayoutHorizontally(n,!1,function(n){return n.y},!0),this.node.width=n):this.type===u.VERTICAL?(t=this._getVerticalBaseHeight(this.node.children),this._doLayoutVertically(t,!1,function(n){return n.x},!0),this.node.height=t):this.type===u.NONE?this.resizeMode===r.CONTAINER&&this._doLayoutBasic():this.type===u.GRID&&this._doLayoutGrid()},_getUsedScaleValue:function(n){return this.affectedByScale?Math.abs(n):1},updateLayout:function(){this._layoutDirty&&this.node.children.length>0&&(this._doLayout(),this._layoutDirty=!1)}});cc.Layout=t.exports=s},{"../CCNode":29,"./CCComponent":105}],111:[function(n,t){"use strict";function f(n){return n&&n.__esModule?n:{"default":n}}function p(n,t,i){e.length=0;for(var u=2*Math.PI/i,r=0;r<i;++r)e.push(cc.v2(t.x*Math.cos(u*r)+n.x,t.y*Math.sin(u*r)+n.y));return e}var c=f(n("../../renderer/gfx")),o=f(n("../value-types/mat4")),s=f(n("../value-types/vec2")),u=f(n("../assets/material/material-variant")),l=n("../utils/misc"),a=n("./CCRenderComponent"),r=n("../renderer/render-flow"),v=n("../graphics/graphics"),y=new s.default,h=new o.default,e=[],i=cc.Enum({RECT:0,ELLIPSE:1,IMAGE_STENCIL:2}),w=cc.Class({name:"cc.Mask","extends":a,editor:!1,ctor:function(){this._graphics=null;this._enableMaterial=null;this._exitMaterial=null;this._clearMaterial=null},properties:{_spriteFrame:{"default":null,type:cc.SpriteFrame},_type:i.RECT,type:{get:function(){return this._type},set:function(n){this._type!==n&&this._resetAssembler();this._type=n;this._type!==i.IMAGE_STENCIL&&(this.spriteFrame=null,this.alphaThreshold=0,this._updateGraphics());this._activateMaterial()},type:i,tooltip:!1},spriteFrame:{type:cc.SpriteFrame,tooltip:!1,get:function(){return this._spriteFrame},set:function(n){this._spriteFrame!==n&&(this._spriteFrame=n,this.setVertsDirty(),this._updateMaterial())}},alphaThreshold:{"default":.1,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS?this._updateMaterial():cc.warnID(4201)}},inverted:{"default":!1,type:cc.Boolean,tooltip:!1,notify:function(){cc.game.renderType===cc.game.RENDER_TYPE_CANVAS&&cc.warnID(4202)}},_segments:64,segements:{get:function(){return this._segments},set:function(n){this._segments=l.clampf(n,3,1e4);this._updateGraphics()},type:cc.Integer,tooltip:!1},_resizeToTarget:{animatable:!1,set:function(n){n&&this._resizeNodeToTargetNode()}}},statics:{Type:i},onRestore:function(){this._activateMaterial()},onEnable:function(){this._super();this._type!==i.IMAGE_STENCIL&&this._updateGraphics();this.node.on(cc.Node.EventType.POSITION_CHANGED,this._updateGraphics,this);this.node.on(cc.Node.EventType.ROTATION_CHANGED,this._updateGraphics,this);this.node.on(cc.Node.EventType.SCALE_CHANGED,this._updateGraphics,this);this.node.on(cc.Node.EventType.SIZE_CHANGED,this._updateGraphics,this);this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this._updateGraphics,this)},onDisable:function(){this._super();this.node.off(cc.Node.EventType.POSITION_CHANGED,this._updateGraphics,this);this.node.off(cc.Node.EventType.ROTATION_CHANGED,this._updateGraphics,this);this.node.off(cc.Node.EventType.SCALE_CHANGED,this._updateGraphics,this);this.node.off(cc.Node.EventType.SIZE_CHANGED,this._updateGraphics,this);this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this._updateGraphics,this);this.node._renderFlag&=~r.FLAG_POST_RENDER},onDestroy:function(){this._super();this._removeGraphics()},_resizeNodeToTargetNode:!1,_validateRender:function(){if(this._type===i.IMAGE_STENCIL){var n=this._spriteFrame;n&&n.textureLoaded()||this.disableRender()}},_activateMaterial:function(){this._createGraphics();var n=this._materials[0];(n=n?u.default.create(n,this):u.default.createWithBuiltin("2d-sprite",this)).define("USE_ALPHA_TEST",!0);this._type===i.IMAGE_STENCIL?(n.define("CC_USE_MODEL",!1),n.define("USE_TEXTURE",!0)):(n.define("CC_USE_MODEL",!0),n.define("USE_TEXTURE",!1));this._enableMaterial||(this._enableMaterial=u.default.createWithBuiltin("2d-sprite",this));this._exitMaterial||(this._exitMaterial=u.default.createWithBuiltin("2d-sprite",this),this._exitMaterial.setStencilEnabled(c.default.STENCIL_DISABLE));this._clearMaterial||(this._clearMaterial=u.default.createWithBuiltin("clear-stencil",this));this.setMaterial(0,n);this._graphics._materials[0]=n;this._updateMaterial()},_updateMaterial:function(){var n=this._materials[0],t;n&&(this._type===i.IMAGE_STENCIL&&this.spriteFrame&&(t=this.spriteFrame.getTexture(),n.setProperty("texture",t)),n.setProperty("alphaThreshold",this.alphaThreshold))},_createGraphics:function(){this._graphics||(this._graphics=new v,cc.Assembler.init(this._graphics),this._graphics.node=this.node,this._graphics.lineWidth=0,this._graphics.strokeColor=cc.color(0,0,0,0))},_updateGraphics:function(){var t,n,o,r,u;if(this.enabledInHierarchy){t=this.node;n=this._graphics;n.clear(!1);var f=t._contentSize.width,e=t._contentSize.height,s=-f*t._anchorPoint.x,h=-e*t._anchorPoint.y;if(this._type===i.RECT)n.rect(s,h,f,e);else if(this._type===i.ELLIPSE){for(o=p(cc.v2(s+f/2,h+e/2),{x:f/2,y:e/2},this._segments),r=0;r<o.length;++r)u=o[r],0===r?n.moveTo(u.x,u.y):n.lineTo(u.x,u.y);n.close()}cc.game.renderType===cc.game.RENDER_TYPE_CANVAS?n.stroke():n.fill()}},_removeGraphics:function(){this._graphics&&(this._graphics.destroy(),this._graphics._destroyImmediate(),this._graphics=null)},_hitTest:function(n){var u=this.node,c=u.getContentSize(),f=c.width,e=c.height,t=y,r;if(u._updateWorldMatrix(),!o.default.invert(h,u._worldMatrix))return!1;if(s.default.transformMat4(t,n,h),t.x+=u._anchorPoint.x*f,t.y+=u._anchorPoint.y*e,r=!1,this.type===i.RECT||this.type===i.IMAGE_STENCIL)r=t.x>=0&&t.y>=0&&t.x<=f&&t.y<=e;else if(this.type===i.ELLIPSE){var l=f/2,a=e/2,v=t.x-.5*f,p=t.y-.5*e;r=v*v/(l*l)+p*p/(a*a)<1}return this.inverted&&(r=!r),r},markForRender:function(n){var t=r.FLAG_RENDER|r.FLAG_UPDATE_RENDER_DATA|r.FLAG_POST_RENDER;n?(this.node._renderFlag|=t,this.markForValidate()):n||(this.node._renderFlag&=~t)},disableRender:function(){this.node._renderFlag&=~(r.FLAG_RENDER|r.FLAG_UPDATE_RENDER_DATA|r.FLAG_POST_RENDER)}});cc.Mask=t.exports=w},{"../../renderer/gfx":317,"../assets/material/material-variant":87,"../graphics/graphics":158,"../renderer/render-flow":227,"../utils/misc":269,"../value-types/mat4":286,"../value-types/vec2":293,"./CCRenderComponent":115}],112:[function(n,t){"use strict";var r=cc.Enum({Unified:0,Free:1}),i=cc.Enum({Horizontal:0,Vertical:1}),u=cc.Enum({PAGE_TURNING:0}),f=cc.Class({name:"cc.PageView","extends":cc.ScrollView,editor:!1,ctor:function(){this._curPageIdx=0;this._lastPageIdx=0;this._pages=[];this._initContentPos=cc.v2();this._scrollCenterOffsetX=[];this._scrollCenterOffsetY=[]},properties:{sizeMode:{"default":r.Unified,type:r,tooltip:!1,notify:function(){this._syncSizeMode()}},direction:{"default":i.Horizontal,type:i,tooltip:!1,notify:function(){this._syncScrollDirection()}},scrollThreshold:{"default":.5,type:cc.Float,slide:!0,range:[0,1,.01],tooltip:!1},autoPageTurningThreshold:{"default":100,type:cc.Float,tooltip:!1},pageTurningEventTiming:{"default":.1,type:cc.Float,range:[0,1,.01],tooltip:!1},indicator:{"default":null,type:cc.PageViewIndicator,tooltip:!1,notify:function(){this.indicator&&this.indicator.setPageView(this)}},pageTurningSpeed:{"default":.3,type:cc.Float,tooltip:!1},pageEvents:{"default":[],type:cc.Component.EventHandler,tooltip:!1}},statics:{SizeMode:r,Direction:i,EventType:u},onEnable:function(){this._super();this.node.on(cc.Node.EventType.SIZE_CHANGED,this._updateAllPagesSize,this);this.node.on("scroll-ended-with-threshold",this._dispatchPageTurningEvent,this)},onDisable:function(){this._super();this.node.off(cc.Node.EventType.SIZE_CHANGED,this._updateAllPagesSize,this);this.node.off("scroll-ended-with-threshold",this._dispatchPageTurningEvent,this)},onLoad:function(){this._initPages();this.indicator&&this.indicator.setPageView(this)},getCurrentPageIndex:function(){return this._curPageIdx},setCurrentPageIndex:function(n){this.scrollToPage(n,!0)},getPages:function(){return this._pages},addPage:function(n){n&&-1===this._pages.indexOf(n)&&this.content&&(this.content.addChild(n),this._pages.push(n),this._updatePageView())},insertPage:function(n,t){t<0||!n||-1!==this._pages.indexOf(n)||!this.content||(t>=this._pages.length?this.addPage(n):(this._pages.splice(t,0,n),this.content.addChild(n),this._updatePageView()))},removePage:function(n){if(n&&this.content){var t=this._pages.indexOf(n);-1!==t?this.removePageAtIndex(t):cc.warnID(4300,n.name)}},removePageAtIndex:function(n){var t=this._pages,i;n<0||n>=t.length||(i=t[n],i&&(this.content.removeChild(i),t.splice(n,1),this._updatePageView()))},removeAllPages:function(){if(this.content){for(var t=this._pages,n=0,i=t.length;n<i;n++)this.content.removeChild(t[n]);this._pages.length=0;this._updatePageView()}},scrollToPage:function(n,t){n<0||n>=this._pages.length||(t=void 0!==t?t:.3,this._curPageIdx=n,this.scrollToOffset(this._moveOffsetValue(n),t,!0),this.indicator&&this.indicator._changedState())},getScrollEndedEventTiming:function(){return this.pageTurningEventTiming},_syncScrollDirection:function(){this.horizontal=this.direction===i.Horizontal;this.vertical=this.direction===i.Vertical},_syncSizeMode:function(){var n,t;this.content&&(n=this.content.getComponent(cc.Layout),n&&(this.sizeMode===r.Free&&this._pages.length>0&&(t=this._pages[this._pages.length-1],this.direction===i.Horizontal?(n.paddingLeft=(this._view.width-this._pages[0].width)/2,n.paddingRight=(this._view.width-t.width)/2):this.direction===i.Vertical&&(n.paddingTop=(this._view.height-this._pages[0].height)/2,n.paddingBottom=(this._view.height-t.height)/2)),n.updateLayout()))},_updatePageView:function(){var u=this.content.getComponent(cc.Layout),t,f,n,r;for(u&&u.enabled&&u.updateLayout(),t=this._pages.length,this._curPageIdx>=t&&(this._curPageIdx=0===t?0:t-1,this._lastPageIdx=this._curPageIdx),f=this._initContentPos,n=0;n<t;++n)r=this._pages[n],r.setSiblingIndex(n),this.direction===i.Horizontal?this._scrollCenterOffsetX[n]=Math.abs(f.x+r.x):this._scrollCenterOffsetY[n]=Math.abs(f.y+r.y);this.indicator&&this.indicator._refresh()},_updateAllPagesSize:function(){if(this.sizeMode===r.Unified&&this._view)for(var t=this._pages,i=this._view.getContentSize(),n=0,u=t.length;n<u;n++)t[n].setContentSize(i)},_initPages:function(){var t,n,i;if(this.content){for(this._initContentPos=this.content.position,t=this.content.children,n=0;n<t.length;++n)i=t[n],this._pages.indexOf(i)>=0||this._pages.push(i);this._syncScrollDirection();this._syncSizeMode();this._updatePageView()}},_dispatchPageTurningEvent:function(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,cc.Component.EventHandler.emitEvents(this.pageEvents,this,u.PAGE_TURNING),this.node.emit("page-turning",this))},_isScrollable:function(n,t,u){if(this.sizeMode===r.Free){var f,e;if(this.direction===i.Horizontal)return f=this._scrollCenterOffsetX[t],e=this._scrollCenterOffsetX[u],Math.abs(n.x)>=Math.abs(f-e)*this.scrollThreshold;if(this.direction===i.Vertical)return f=this._scrollCenterOffsetY[t],e=this._scrollCenterOffsetY[u],Math.abs(n.y)>=Math.abs(f-e)*this.scrollThreshold}else{if(this.direction===i.Horizontal)return Math.abs(n.x)>=this._view.width*this.scrollThreshold;if(this.direction===i.Vertical)return Math.abs(n.y)>=this._view.height*this.scrollThreshold}},_isQuicklyScrollable:function(n){if(this.direction===i.Horizontal){if(Math.abs(n.x)>this.autoPageTurningThreshold)return!0}else if(this.direction===i.Vertical&&Math.abs(n.y)>this.autoPageTurningThreshold)return!0;return!1},_moveOffsetValue:function(n){var t=cc.v2(0,0);return this.sizeMode===r.Free?this.direction===i.Horizontal?t.x=this._scrollCenterOffsetX[n]:this.direction===i.Vertical&&(t.y=this._scrollCenterOffsetY[n]):this.direction===i.Horizontal?t.x=n*this._view.width:this.direction===i.Vertical&&(t.y=n*this._view.height),t},_getDragDirection:function(n){return this.direction===i.Horizontal?0===n.x?0:n.x>0?1:-1:this.direction===i.Vertical?0===n.y?0:n.y<0?1:-1:void 0},_handleReleaseLogic:function(){this._autoScrollToPage();this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent("scroll-ended"))},_autoScrollToPage:function(){var n,f;if(this._startBounceBackIfNeeded())n=this._getHowMuchOutOfBoundary(),((n=this._clampDelta(n)).x>0||n.y<0)&&(this._curPageIdx=0===this._pages.length?0:this._pages.length-1),(n.x<0||n.y>0)&&(this._curPageIdx=0),this.indicator&&this.indicator._changedState();else{var r=this._touchBeganPosition.sub(this._touchEndPosition),t=this._curPageIdx,i=t+this._getDragDirection(r),u=this.pageTurningSpeed*Math.abs(t-i);if(i<this._pages.length&&(this._isScrollable(r,t,i)||(f=this._calculateTouchMoveVelocity(),this._isQuicklyScrollable(f))))return void this.scrollToPage(i,u);this.scrollToPage(t,u)}},_onTouchBegan:function(n,t){this._touchBeganPosition=n.touch.getLocation();this._super(n,t)},_onTouchMoved:function(n,t){this._super(n,t)},_onTouchEnded:function(n,t){this._touchEndPosition=n.touch.getLocation();this._super(n,t)},_onTouchCancelled:function(n,t){this._touchEndPosition=n.touch.getLocation();this._super(n,t)},_onMouseWheel:function(){}});cc.PageView=t.exports=f},{}],113:[function(n,t){"use strict";var i=cc.Enum({HORIZONTAL:0,VERTICAL:1}),r=cc.Class({name:"cc.PageViewIndicator","extends":n("./CCComponent"),editor:!1,properties:{_layout:null,_pageView:null,_indicators:[],spriteFrame:{"default":null,type:cc.SpriteFrame,tooltip:!1},direction:{"default":i.HORIZONTAL,type:i,tooltip:!1},cellSize:{"default":cc.size(20,20),tooltip:!1},spacing:{"default":0,tooltip:!1}},statics:{Direction:i},onLoad:function(){this._updateLayout()},setPageView:function(n){this._pageView=n;this._refresh()},_updateLayout:function(){this._layout=this.getComponent(cc.Layout);this._layout||(this._layout=this.addComponent(cc.Layout));this.direction===i.HORIZONTAL?(this._layout.type=cc.Layout.Type.HORIZONTAL,this._layout.spacingX=this.spacing):this.direction===i.VERTICAL&&(this._layout.type=cc.Layout.Type.VERTICAL,this._layout.spacingY=this.spacing);this._layout.resizeMode=cc.Layout.ResizeMode.CONTAINER},_createIndicator:function(){var n=new cc.Node,t=n.addComponent(cc.Sprite);return t.spriteFrame=this.spriteFrame,t.sizeMode=cc.Sprite.SizeMode.CUSTOM,n.parent=this.node,n.width=this.cellSize.width,n.height=this.cellSize.height,n},_changedState:function(){var n=this._indicators,i,t;if(0!==n.length&&(i=this._pageView._curPageIdx,!(i>=n.length))){for(t=0;t<n.length;++t)n[t].opacity=127.5;n[i].opacity=255}},_refresh:function(){var t,i,n,r;if(this._pageView&&(t=this._indicators,i=this._pageView.getPages(),i.length!==t.length)){if(n=0,i.length>t.length)for(n=0;n<i.length;++n)t[n]||(t[n]=this._createIndicator());else for(n=t.length-i.length;n>0;--n)r=t[n-1],this.node.removeChild(r),t.splice(n-1,1);this._layout&&this._layout.enabledInHierarchy&&this._layout.updateLayout();this._changedState()}}});cc.PageViewIndicator=t.exports=r},{"./CCComponent":105}],114:[function(n,t){"use strict";var r=n("../utils/misc"),u=n("./CCComponent"),i=cc.Enum({HORIZONTAL:0,VERTICAL:1,FILLED:2}),f=cc.Class({name:"cc.ProgressBar","extends":u,editor:!1,_initBarSprite:function(){var n,t,r;if(this.barSprite){if(n=this.barSprite.node,!n)return;var u=this.node.getContentSize(),f=this.node.getAnchorPoint(),e=n.getContentSize();n.parent===this.node&&this.node.setContentSize(e);this.barSprite.fillType===cc.Sprite.FillType.RADIAL&&(this.mode=i.FILLED);t=n.getContentSize();(this.totalLength=this.mode===i.HORIZONTAL?t.width:this.mode===i.VERTICAL?t.height:this.barSprite.fillRange,n.parent===this.node)&&(r=-u.width*f.x,n.setPosition(cc.v2(r,0)))}},_updateBarStatus:function(){var n;if(this.barSprite){if(n=this.barSprite.node,!n)return;var e,o,s,h=n.getAnchorPoint(),u=n.getContentSize(),c=n.getPosition(),t=cc.v2(0,.5),a=r.clamp01(this.progress),f=this.totalLength*a;switch(this.mode){case i.HORIZONTAL:this.reverse&&(t=cc.v2(1,.5));e=cc.size(f,u.height);o=this.totalLength;s=u.height;break;case i.VERTICAL:t=this.reverse?cc.v2(.5,1):cc.v2(.5,0);e=cc.size(u.width,f);o=u.width;s=this.totalLength}if(this.mode===i.FILLED)this.barSprite.type!==cc.Sprite.Type.FILLED?cc.warn("ProgressBar FILLED mode only works when barSprite's Type is FILLED!"):(this.reverse&&(f*=-1),this.barSprite.fillRange=f);else if(this.barSprite.type!==cc.Sprite.Type.FILLED){var v=t.x-h.x,y=t.y-h.y,l=cc.v2(o*v,s*y);n.setPosition(c.x+l.x,c.y+l.y);n.setAnchorPoint(t);n.setContentSize(e)}else cc.warn("ProgressBar non-FILLED mode only works when barSprite's Type is non-FILLED!")}},properties:{barSprite:{"default":null,type:cc.Sprite,tooltip:!1,notify:function(){this._initBarSprite()},animatable:!1},mode:{"default":i.HORIZONTAL,type:i,tooltip:!1,notify:function(){var n,t;if(this.barSprite){if(n=this.barSprite.node,!n)return;t=n.getContentSize();this.mode===i.HORIZONTAL?this.totalLength=t.width:this.mode===i.VERTICAL?this.totalLength=t.height:this.mode===i.FILLED&&(this.totalLength=this.barSprite.fillRange)}},animatable:!1},_N$totalLength:1,totalLength:{range:[0,Number.MAX_VALUE],tooltip:!1,get:function(){return this._N$totalLength},set:function(n){this.mode===i.FILLED&&(n=r.clamp01(n));this._N$totalLength=n;this._updateBarStatus()}},progress:{"default":1,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){this._updateBarStatus()}},reverse:{"default":!1,tooltip:!1,notify:function(){this.barSprite&&(this.barSprite.fillStart=1-this.barSprite.fillStart);this._updateBarStatus()},animatable:!1}},statics:{Mode:i}});cc.ProgressBar=t.exports=f},{"../utils/misc":269,"./CCComponent":105}],115:[function(n,t){"use strict";function e(n){return n&&n.__esModule?n:{"default":n}}var s=e(n("../renderer/assembler")),r=e(n("../assets/material/material-variant")),f=n("../value-types"),h=n("./CCComponent"),i=n("../renderer/render-flow"),u=n("../assets/material/CCMaterial"),o=new f.Color,c=cc.Class({name:"RenderComponent","extends":h,editor:!1,properties:{_materials:{"default":[],type:u},materials:{get:function(){return this._materials},set:function(n){this._materials=n;this._activateMaterial()},type:[u],displayName:"Materials",animatable:!1}},ctor:function(){this._vertsDirty=!0;this._assembler=null},_resetAssembler:function(){s.default.init(this);this._updateColor();this.setVertsDirty()},__preload:function(){this._resetAssembler();this._activateMaterial()},onEnable:function(){this.node._renderComponent&&(this.node._renderComponent.enabled=!1);this.node._renderComponent=this;this.node._renderFlag|=i.FLAG_OPACITY_COLOR;this.setVertsDirty()},onDisable:function(){this.node._renderComponent=null;this.disableRender()},onDestroy:function(){for(var n=this._materials,t=0;t<n.length;t++)cc.pool.material.put(n[t]);n.length=0;cc.pool.assembler.put(this._assembler)},setVertsDirty:function(){this._vertsDirty=!0;this.markForRender(!0)},_on3DNodeChanged:function(){this._resetAssembler()},_validateRender:function(){},markForValidate:function(){cc.RenderFlow.registerValidate(this)},markForRender:function(n){var t=i.FLAG_RENDER|i.FLAG_UPDATE_RENDER_DATA;n?(this.node._renderFlag|=t,this.markForValidate()):this.node._renderFlag&=~t},disableRender:function(){this.node._renderFlag&=~(i.FLAG_RENDER|i.FLAG_UPDATE_RENDER_DATA)},getMaterial:function(n){var t,i;return n<0||n>=this._materials.length?null:(t=this._materials[n],!t)?null:(i=r.default.create(t,this),i!==t&&this.setMaterial(n,i),i)},getMaterials:function(){for(var n=this._materials,t=0;t<n.length;t++)n[t]=r.default.create(n[t],this);return n},setMaterial:function(n,t){return t!==this._materials[n]&&(t=r.default.create(t,this),this._materials[n]=t),this._updateMaterial(),this.markForRender(!0),t},_getDefaultMaterial:function(){return u.getBuiltinMaterial("2d-sprite")},_activateMaterial:function(){var n=this._materials,i,t;for(n[0]||(i=this._getDefaultMaterial(),n[0]=i),t=0;t<n.length;t++)n[t]=r.default.create(n[t],this);this._updateMaterial()},_updateMaterial:function(){},_updateColor:function(){var n,t;this._assembler.updateColor&&(n=this.srcBlendFactor===cc.macro.BlendFactor.ONE,n&&f.Color.premultiplyAlpha(o,this.node._color),t=n?o._val:null,this._assembler.updateColor(this,t))},_checkBacth:function(n,t){var i=this._materials[0];(i&&i.getHash()!==n.material.getHash()||n.cullingMask!==t)&&(n._flush(),n.node=i.getDefine("CC_USE_MODEL")?this.node:n._dummyNode,n.material=i,n.cullingMask=t)}});cc.RenderComponent=t.exports=c},{"../assets/material/CCMaterial":80,"../assets/material/material-variant":87,"../renderer/assembler":223,"../renderer/render-flow":227,"../value-types":284,"./CCComponent":105}],116:[function(n,t){"use strict";var h=n("../platform/js"),f=n("../platform/CCMacro"),i=n("../utils/text-utils"),c=new(n("../utils/html-text-parser")),r=f.TextAlignment,e=f.VerticalTextAlignment,o=cc.Label.CacheMode,u=new h.Pool(function(n){if(!cc.isValid(n))return!1;var t=n.getComponent(cc.LabelOutline);return t&&(t.width=0),!0},20),s;u.get=function(){var n=this._get(),t;return n||(n=new cc.PrivateNode("RICHTEXT_CHILD")),n.setPosition(0,0),n.setAnchorPoint(.5,.5),n.skewX=0,t=n.getComponent(cc.Label),t||(t=n.addComponent(cc.Label)),t.string="",t.horizontalAlign=r.LEFT,t.verticalAlign=e.CENTER,t._forceUseCanvas=!0,n};s=cc.Class({name:"cc.RichText","extends":cc.Component,ctor:function(){this._textArray=null;this._labelSegments=[];this._labelSegmentsCache=[];this._linesWidth=[];this._updateRichTextStatus=this._updateRichText},editor:!1,properties:{string:{"default":"<color=#00ff00>Rich<\/c><color=#0fffff>Text<\/color>",multiline:!0,tooltip:!1,notify:function(){this._updateRichTextStatus()}},horizontalAlign:{"default":r.LEFT,type:r,tooltip:!1,animatable:!1,notify:function(n){this.horizontalAlign!==n&&(this._layoutDirty=!0,this._updateRichTextStatus())}},fontSize:{"default":40,tooltip:!1,notify:function(n){this.fontSize!==n&&(this._layoutDirty=!0,this._updateRichTextStatus())}},_fontFamily:"Arial",fontFamily:{tooltip:!1,get:function(){return this._fontFamily},set:function(n){this._fontFamily!==n&&(this._fontFamily=n,this._layoutDirty=!0,this._updateRichTextStatus())},animatable:!1},font:{"default":null,type:cc.TTFFont,tooltip:!1,notify:function(n){this.font!==n&&(this._layoutDirty=!0,this.font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}},_isSystemFontUsed:!0,useSystemFont:{get:function(){return this._isSystemFontUsed},set:function(n){this._isSystemFontUsed!==n&&(this._isSystemFontUsed=n,this._layoutDirty=!0,this._updateRichTextStatus())},animatable:!1,tooltip:!1},cacheMode:{"default":o.NONE,type:o,tooltip:!1,notify:function(n){this.cacheMode!==n&&this._updateRichTextStatus()},animatable:!1},maxWidth:{"default":0,tooltip:!1,notify:function(n){this.maxWidth!==n&&(this._layoutDirty=!0,this._updateRichTextStatus())}},lineHeight:{"default":40,tooltip:!1,notify:function(n){this.lineHeight!==n&&(this._layoutDirty=!0,this._updateRichTextStatus())}},imageAtlas:{"default":null,type:cc.SpriteAtlas,tooltip:!1,notify:function(n){this.imageAtlas!==n&&(this._layoutDirty=!0,this._updateRichTextStatus())}},handleTouchEvent:{"default":!0,tooltip:!1,notify:function(n){this.handleTouchEvent!==n&&this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners())}}},statics:{HorizontalAlign:r,VerticalAlign:e},onEnable:function(){this.handleTouchEvent&&this._addEventListeners();this._updateRichText();this._activateChildren(!0)},onDisable:function(){this.handleTouchEvent&&this._removeEventListeners();this._activateChildren(!1)},start:function(){this._onTTFLoaded()},_onColorChanged:function(n){this.node.children.forEach(function(t){t.color=n})},_addEventListeners:function(){this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this);this.node.on(cc.Node.EventType.COLOR_CHANGED,this._onColorChanged,this)},_removeEventListeners:function(){this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this);this.node.off(cc.Node.EventType.COLOR_CHANGED,this._onColorChanged,this)},_updateLabelSegmentTextAttributes:function(){this._labelSegments.forEach(function(n){this._applyTextAttribute(n,null,!0)}.bind(this))},_createFontLabel:function(n){return u.get(n,this)},_onTTFLoaded:function(){if(this.font instanceof cc.TTFFont)if(this.font._nativeAsset)this._layoutDirty=!0,this._updateRichText();else{var n=this;cc.assetManager.postLoadNative(this.font,function(){n._layoutDirty=!0;n._updateRichText()})}else this._layoutDirty=!0,this._updateRichText()},_measureText:function(n,t){var i=this,r=function(t){var r;return 0===i._labelSegmentsCache.length?(r=i._createFontLabel(t),i._labelSegmentsCache.push(r)):r=i._labelSegmentsCache[0],r._styleIndex=n,i._applyTextAttribute(r,t,!0),r.getContentSize().width};return t?r(t):r},_onTouchEnded:function(n){for(var i=this,r=this.node.getComponents(cc.Component),u=function(t){var u=i._labelSegments[t],f=u._clickHandler,e=u._clickParam;f&&i._containsTouchLocation(u,n.touch.getLocation())&&(r.forEach(function(t){t.enabledInHierarchy&&t[f]&&t[f](n,e)}),n.stopPropagation())},t=0;t<this._labelSegments.length;++t)u(t)},_containsTouchLocation:function(n,t){return n.getBoundingBoxToWorld().contains(t)},_resetState:function(){for(var n,i=this.node.children,t=i.length-1;t>=0;t--)n=i[t],"RICHTEXT_CHILD"!==n.name&&"RICHTEXT_Image_CHILD"!==n.name||(n.parent===this.node?n.parent=null:i.splice(t,1),"RICHTEXT_CHILD"===n.name&&u.put(n));this._labelSegments.length=0;this._labelSegmentsCache.length=0;this._linesWidth.length=0;this._lineOffsetX=0;this._lineCount=1;this._labelWidth=0;this._labelHeight=0;this._layoutDirty=!0},onRestore:!1,_activateChildren:function(n){for(var i,t=this.node.children.length-1;t>=0;t--)i=this.node.children[t],"RICHTEXT_CHILD"!==i.name&&"RICHTEXT_Image_CHILD"!==i.name||(i.active=n)},_addLabelSegment:function(n,t){var i;return(i=0===this._labelSegmentsCache.length?this._createFontLabel(n):this._labelSegmentsCache.pop())._styleIndex=t,i._lineCount=this._lineCount,i.active=this.node.active,i.setAnchorPoint(0,0),this._applyTextAttribute(i,n),this.node.addChild(i),this._labelSegments.push(i),i},_updateRichTextWithMaxWidth:function(n,t,r){var f=t,u,c,e,o,l,a;if(this._lineOffsetX>0&&f+this._lineOffsetX>this.maxWidth)for(u=0;this._lineOffsetX<=this.maxWidth;){var s=this._getFirstWordLen(n,u,n.length),v=n.substr(u,s),h=this._measureText(r,v);if(!(this._lineOffsetX+h<=this.maxWidth)){u>0&&(c=n.substr(0,u),this._addLabelSegment(c,r),n=n.substr(u,n.length),f=this._measureText(r,n));this._updateLineInfo();break}this._lineOffsetX+=h;u+=s}if(f>this.maxWidth)for(e=i.fragmentText(n,f,this.maxWidth,this._measureText(r)),o=0;o<e.length;++o)l=e[o],a=this._addLabelSegment(l,r).getContentSize(),this._lineOffsetX+=a.width,e.length>1&&o<e.length-1&&this._updateLineInfo();else this._lineOffsetX+=f,this._addLabelSegment(n,r)},_isLastComponentCR:function(n){return n.length-1===n.lastIndexOf("\n")},_updateLineInfo:function(){this._linesWidth.push(this._lineOffsetX);this._lineOffsetX=0;this._lineCount++},_needsUpdateTextLayout:function(n){var r,u,f,i,t;if(this._layoutDirty||!this._textArray||!n||this._textArray.length!==n.length)return!0;for(r=0;r<this._textArray.length;++r){if(u=this._textArray[r],f=n[r],u.text!==f.text)return!0;if(i=u.style,t=f.style,i){if(t){if(!i.outline!=!t.outline||i.size!==t.size||!i.italic!=!t.italic||i.isImage!==t.isImage||i.src!==t.src||i.imageAlign!==t.imageAlign||i.imageHeight!==t.imageHeight||i.imageWidth!==t.imageWidth||i.imageOffset!==t.imageOffset)return!0}else if(i.size||i.italic||i.isImage||i.outline)return!0}else if(t&&(t.size||t.italic||t.isImage||t.outline))return!0}return!1},_addRichTextImageElement:function(n){var c=n.style.src,e=this.imageAtlas.getSpriteFrame(c),t,u;if(e){t=new cc.PrivateNode("RICHTEXT_Image_CHILD");u=t.addComponent(cc.Sprite);switch(n.style.imageAlign){case"top":t.setAnchorPoint(0,1);break;case"center":t.setAnchorPoint(0,.5);break;default:t.setAnchorPoint(0,0)}n.style.imageOffset&&(t._imageOffset=n.style.imageOffset);u.type=cc.Sprite.Type.SLICED;u.sizeMode=cc.Sprite.SizeMode.CUSTOM;this.node.addChild(t);this._labelSegments.push(t);var o=e.getRect(),f=1,i=o.width,r=o.height,s=n.style.imageWidth,h=n.style.imageHeight;h>0?(i*=f=h/r,r*=f):(i*=f=this.lineHeight/r,r*=f);s>0&&(i=s);this.maxWidth>0?(this._lineOffsetX+i>this.maxWidth&&this._updateLineInfo(),this._lineOffsetX+=i):(this._lineOffsetX+=i,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX));u.spriteFrame=e;t.setContentSize(i,r);t._lineCount=this._lineCount;n.style.event?(n.style.event.click&&(t._clickHandler=n.style.event.click),t._clickParam=n.style.event.param?n.style.event.param:""):t._clickHandler=null}else cc.warnID(4400)},_updateRichText:function(){var e,h,o,t,r,s,n,u,f,l;if(this.enabledInHierarchy){if(e=c.parse(this.string),!this._needsUpdateTextLayout(e))return this._textArray=e,void this._updateLabelSegmentTextAttributes();for(this._textArray=e,this._resetState(),o=!1,t=0;t<this._textArray.length;++t){if(r=this._textArray[t],s=r.text,""===s){if(r.style&&r.style.newline){this._updateLineInfo();continue}if(r.style&&r.style.isImage&&this.imageAtlas){this._addRichTextImageElement(r);continue}}for(n=s.split("\n"),u=0;u<n.length;++u)if(f=n[u],""!==f)(o=!1,this.maxWidth>0)?(l=this._measureText(t,f),this._updateRichTextWithMaxWidth(f,l,t),n.length>1&&u<n.length-1&&this._updateLineInfo()):(h=this._addLabelSegment(f,t).getContentSize(),this._lineOffsetX+=h.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),n.length>1&&u<n.length-1&&this._updateLineInfo());else{if(this._isLastComponentCR(s)&&u===n.length-1)continue;this._updateLineInfo();o=!0}}o||this._linesWidth.push(this._lineOffsetX);this.maxWidth>0&&(this._labelWidth=this.maxWidth);this._labelHeight=(this._lineCount+i.BASELINE_RATIO)*this.lineHeight;this.node.setContentSize(this._labelWidth,this._labelHeight);this._updateRichTextPosition();this._layoutDirty=!1}},_getFirstWordLen:function(n,t,r){var u=n.charAt(t),e,f;if(i.isUnicodeCJK(u)||i.isUnicodeSpace(u))return 1;for(e=1,f=t+1;f<r&&(u=n.charAt(f),!i.isUnicodeSpace(u)&&!i.isUnicodeCJK(u));++f)e++;return e},_updateRichTextPosition:function(){for(var n,t,f,p,e,o,u,a,v,y,s,h=0,c=1,w=this._lineCount,l=0;l<this._labelSegments.length;++l){n=this._labelSegments[l];t=n._lineCount;t>c&&(h=0,c=t);f=0;switch(this.horizontalAlign){case r.LEFT:f=-this._labelWidth/2;break;case r.CENTER:f=-this._linesWidth[t-1]/2;break;case r.RIGHT:f=this._labelWidth/2-this._linesWidth[t-1]}if(n.x=h+f,p=n.getContentSize(),n.y=this.lineHeight*(w-t)-this._labelHeight/2,t===c&&(h+=p.width),n.getComponent(cc.Sprite)){e=this.lineHeight;o=this.lineHeight*(1+i.BASELINE_RATIO);switch(n.anchorY){case 1:n.y+=e+(o-e)/2;break;case.5:n.y+=o/2;break;default:n.y+=(o-e)/2}n._imageOffset&&(u=n._imageOffset.split(","),1===u.length&&u[0]?(a=parseFloat(u[0]),Number.isInteger(a)&&(n.y+=a)):2===u.length&&(v=parseFloat(u[0]),y=parseFloat(u[1]),Number.isInteger(v)&&(n.x+=v),Number.isInteger(y)&&(n.y+=y)))}s=n.getComponent(cc.LabelOutline);s&&s.width&&(n.y=n.y-s.width)}},_convertLiteralColorValue:function(n){var t=n.toUpperCase();return cc.Color[t]?cc.Color[t]:cc.color().fromHEX(n)},_applyTextAttribute:function(n,t,i){var u=n.getComponent(cc.Label),e,r,f;u&&(e=n._styleIndex,r=null,(this._textArray[e]&&(r=this._textArray[e].style),n.color=r&&r.color?this._convertLiteralColorValue(r.color):this.node.color,u.cacheMode=this.cacheMode,this.font instanceof cc.Font&&!this._isSystemFontUsed?u.font=this.font:u.fontFamily=this.fontFamily,u.useSystemFont=this._isSystemFontUsed,u.lineHeight=this.lineHeight,u.enableBold=r&&r.bold,u.enableItalics=r&&r.italic,r&&r.italic&&(n.skewX=12),u.enableUnderline=r&&r.underline,r&&r.outline)&&(f=n.getComponent(cc.LabelOutline),f||(f=n.addComponent(cc.LabelOutline)),f.color=this._convertLiteralColorValue(r.outline.color),f.width=r.outline.width),u.fontSize=r&&r.size?r.size:this.fontSize,null!==t&&("string"!=typeof t&&(t=""+t),u.string=t),i&&u._forceUpdateRenderData(),r&&r.event?(r.event.click&&(n._clickHandler=r.event.click),n._clickParam=r.event.param?r.event.param:""):n._clickHandler=null)},onDestroy:function(){for(var n=0;n<this._labelSegments.length;++n)this._labelSegments[n].removeFromParent(),u.put(this._labelSegments[n])}});cc.RichText=t.exports=s},{"../platform/CCMacro":200,"../platform/js":216,"../utils/html-text-parser":267,"../utils/text-utils":276}],117:[function(n,t){"use strict";var i=n("./CCWidget"),r=n("../base-ui/CCWidgetManager"),u=cc.Class({name:"cc.SafeArea","extends":n("./CCComponent"),editor:!1,onEnable:function(){this.updateArea();cc.view.on("canvas-resize",this.updateArea,this)},onDisable:function(){cc.view.off("canvas-resize",this.updateArea,this)},updateArea:function(){var n=this.node.getComponent(i),u,f;if(n){n.updateAlignment();u=this.node.position;f=this.node.getAnchorPoint();n.isAlignTop=n.isAlignBottom=n.isAlignLeft=n.isAlignRight=!0;var o=cc.winSize.width,s=cc.winSize.height,t=cc.sys.getSafeAreaRect();n.top=s-t.y-t.height;n.bottom=t.y;n.left=t.x;n.right=o-t.x-t.width;n.updateAlignment();var e=this.node.position,h=f.x-(e.x-u.x)/this.node.width,c=f.y-(e.y-u.y)/this.node.height;this.node.setAnchorPoint(h,c);r.add(n)}}});cc.SafeArea=t.exports=u},{"../base-ui/CCWidgetManager":89,"./CCComponent":105,"./CCWidget":127}],118:[function(n,t){"use strict";var r=n("../utils/misc"),i=(n("./CCComponent"),cc.Enum({HORIZONTAL:0,VERTICAL:1})),u=cc.Class({name:"cc.Scrollbar","extends":n("./CCComponent"),editor:!1,properties:{_scrollView:null,_touching:!1,_autoHideRemainingTime:{"default":0,serializable:!1},_opacity:255,handle:{"default":null,type:cc.Sprite,tooltip:!1,notify:function(){this._onScroll(cc.v2(0,0))},animatable:!1},direction:{"default":i.HORIZONTAL,type:i,tooltip:!1,notify:function(){this._onScroll(cc.v2(0,0))},animatable:!1},enableAutoHide:{"default":!0,animatable:!1,tooltip:!1},autoHideTime:{"default":1,animatable:!1,tooltip:!1}},statics:{Direction:i},setTargetScrollView:function(n){this._scrollView=n},_convertToScrollViewSpace:function(n){var t=this._scrollView.node,r=n.convertToWorldSpaceAR(cc.v2(-n.anchorX*n.width,-n.anchorY*n.height)),i=t.convertToNodeSpaceAR(r);return i.x+=t.anchorX*t.width,i.y+=t.anchorY*t.height,i},_setOpacity:function(n){this.handle&&(this.node.opacity=n,this.handle.node.opacity=n)},_onScroll:function(n){var t,c,a;if(this._scrollView&&(t=this._scrollView.content,t)){var o=t.getContentSize(),s=this._scrollView.node.getContentSize(),l=this.node.getContentSize();if(this._conditionalDisableScrollBar(o,s))return;this.enableAutoHide&&(this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity));var r=0,u=0,f=0,h=0,e=0;this.direction===i.HORIZONTAL?(r=o.width,u=s.width,e=l.width,f=n.x,h=-this._convertToScrollViewSpace(t).x):this.direction===i.VERTICAL&&(r=o.height,u=s.height,e=l.height,f=n.y,h=-this._convertToScrollViewSpace(t).y);c=this._calculateLength(r,u,e,f);a=this._calculatePosition(r,u,e,h,f,c);this._updateLength(c);this._updateHanlderPosition(a)}},_updateHanlderPosition:function(n){if(this.handle){var t=this._fixupHandlerPosition();this.handle.node.setPosition(n.x+t.x,n.y+t.y)}},_fixupHandlerPosition:function(){var t=this.node.getContentSize(),r=this.node.getAnchorPoint(),u=this.handle.node.getContentSize(),f=this.handle.node.parent,e=this.node.convertToWorldSpaceAR(cc.v2(-t.width*r.x,-t.height*r.y)),n=f.convertToNodeSpaceAR(e);return this.direction===i.HORIZONTAL?n=cc.v2(n.x,n.y+(t.height-u.height)/2):this.direction===i.VERTICAL&&(n=cc.v2(n.x+(t.width-u.width)/2,n.y)),this.handle.node.setPosition(n),n},_onTouchBegan:function(){this.enableAutoHide&&(this._touching=!0)},_conditionalDisableScrollBar:function(n,t){return n.width<=t.width&&this.direction===i.HORIZONTAL||n.height<=t.height&&this.direction===i.VERTICAL},_onTouchEnded:function(){var n,t,i;if(this.enableAutoHide&&(this._touching=!1,!(this.autoHideTime<=0))){if(this._scrollView&&(n=this._scrollView.content,n&&(t=n.getContentSize(),i=this._scrollView.node.getContentSize(),this._conditionalDisableScrollBar(t,i))))return;this._autoHideRemainingTime=this.autoHideTime}},_calculateLength:function(n,t,i,r){var u=n;return r&&(u+=20*(r>0?r:-r)),i*(t/u)},_calculatePosition:function(n,t,u,f,e,o){var h=n-t,s,c;return e&&(h+=Math.abs(e)),s=0,h&&(s=f/h,s=r.clamp01(s)),c=(u-o)*s,this.direction===i.VERTICAL?cc.v2(0,c):cc.v2(c,0)},_updateLength:function(n){if(this.handle){var t=this.handle.node,r=t.getContentSize();t.setAnchorPoint(cc.v2(0,0));this.direction===i.HORIZONTAL?t.setContentSize(n,r.height):t.setContentSize(r.width,n)}},_processAutoHide:function(n){if(this.enableAutoHide&&!(this._autoHideRemainingTime<=0)&&!this._touching&&(this._autoHideRemainingTime-=n,this._autoHideRemainingTime<=this.autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var t=this._opacity*(this._autoHideRemainingTime/this.autoHideTime);this._setOpacity(t)}},start:function(){this.enableAutoHide&&this._setOpacity(0)},hide:function(){this._autoHideRemainingTime=0;this._setOpacity(0)},show:function(){this._autoHideRemainingTime=this.autoHideTime;this._setOpacity(this._opacity)},update:function(n){this._processAutoHide(n)}});cc.Scrollbar=t.exports=u},{"../utils/misc":269,"./CCComponent":105}],119:[function(n,t){"use strict";var r=n("../CCNode").EventType,u=cc.v2(),f=cc.v2(),e=function(){return(new Date).getMilliseconds()},i=cc.Enum({SCROLL_TO_TOP:0,SCROLL_TO_BOTTOM:1,SCROLL_TO_LEFT:2,SCROLL_TO_RIGHT:3,SCROLLING:4,BOUNCE_TOP:5,BOUNCE_BOTTOM:6,BOUNCE_LEFT:7,BOUNCE_RIGHT:8,SCROLL_ENDED:9,TOUCH_UP:10,AUTOSCROLL_ENDED_WITH_THRESHOLD:11,SCROLL_BEGAN:12}),o={"scroll-to-top":i.SCROLL_TO_TOP,"scroll-to-bottom":i.SCROLL_TO_BOTTOM,"scroll-to-left":i.SCROLL_TO_LEFT,"scroll-to-right":i.SCROLL_TO_RIGHT,scrolling:i.SCROLLING,"bounce-bottom":i.BOUNCE_BOTTOM,"bounce-left":i.BOUNCE_LEFT,"bounce-right":i.BOUNCE_RIGHT,"bounce-top":i.BOUNCE_TOP,"scroll-ended":i.SCROLL_ENDED,"touch-up":i.TOUCH_UP,"scroll-ended-with-threshold":i.AUTOSCROLL_ENDED_WITH_THRESHOLD,"scroll-began":i.SCROLL_BEGAN},s=cc.Class({name:"cc.ScrollView","extends":n("./CCViewGroup"),editor:!1,ctor:function(){this._topBoundary=0;this._bottomBoundary=0;this._leftBoundary=0;this._rightBoundary=0;this._touchMoveDisplacements=[];this._touchMoveTimeDeltas=[];this._touchMovePreviousTimestamp=0;this._touchMoved=!1;this._autoScrolling=!1;this._autoScrollAttenuate=!1;this._autoScrollStartPosition=cc.v2(0,0);this._autoScrollTargetDelta=cc.v2(0,0);this._autoScrollTotalTime=0;this._autoScrollAccumulatedTime=0;this._autoScrollCurrentlyOutOfBoundary=!1;this._autoScrollBraking=!1;this._autoScrollBrakingStartPosition=cc.v2(0,0);this._outOfBoundaryAmount=cc.v2(0,0);this._outOfBoundaryAmountDirty=!0;this._stopMouseWheel=!1;this._mouseWheelEventElapsedTime=0;this._isScrollEndedWithThresholdEventFired=!1;this._scrollEventEmitMask=0;this._isBouncing=!1;this._scrolling=!1},properties:{content:{"default":void 0,type:cc.Node,tooltip:!1,formerlySerializedAs:"content",notify:function(){this._calculateBoundary()}},horizontal:{"default":!0,animatable:!1,tooltip:!1},vertical:{"default":!0,animatable:!1,tooltip:!1},inertia:{"default":!0,tooltip:!1},brake:{"default":.5,type:cc.Float,range:[0,1,.1],tooltip:!1},elastic:{"default":!0,animatable:!1,tooltip:!1},bounceDuration:{"default":1,range:[0,10],tooltip:!1},horizontalScrollBar:{"default":void 0,type:cc.Scrollbar,tooltip:!1,notify:function(){this.horizontalScrollBar&&(this.horizontalScrollBar.setTargetScrollView(this),this._updateScrollBar(0))},animatable:!1},verticalScrollBar:{"default":void 0,type:cc.Scrollbar,tooltip:!1,notify:function(){this.verticalScrollBar&&(this.verticalScrollBar.setTargetScrollView(this),this._updateScrollBar(0))},animatable:!1},scrollEvents:{"default":[],type:cc.Component.EventHandler,tooltip:!1},cancelInnerEvents:{"default":!0,animatable:!1,tooltip:!1},_view:{get:function(){if(this.content)return this.content.parent}}},statics:{EventType:i},scrollToBottom:function(n,t){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,0),applyToHorizontal:!1,applyToVertical:!0});n?this._startAutoScroll(i,n,!1!==t):this._moveContent(i,!0)},scrollToTop:function(n,t){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,1),applyToHorizontal:!1,applyToVertical:!0});n?this._startAutoScroll(i,n,!1!==t):this._moveContent(i)},scrollToLeft:function(n,t){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,0),applyToHorizontal:!0,applyToVertical:!1});n?this._startAutoScroll(i,n,!1!==t):this._moveContent(i)},scrollToRight:function(n,t){var i=this._calculateMovePercentDelta({anchor:cc.v2(1,0),applyToHorizontal:!0,applyToVertical:!1});n?this._startAutoScroll(i,n,!1!==t):this._moveContent(i)},scrollToTopLeft:function(n,t){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,1),applyToHorizontal:!0,applyToVertical:!0});n?this._startAutoScroll(i,n,!1!==t):this._moveContent(i)},scrollToTopRight:function(n,t){var i=this._calculateMovePercentDelta({anchor:cc.v2(1,1),applyToHorizontal:!0,applyToVertical:!0});n?this._startAutoScroll(i,n,!1!==t):this._moveContent(i)},scrollToBottomLeft:function(n,t){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,0),applyToHorizontal:!0,applyToVertical:!0});n?this._startAutoScroll(i,n,!1!==t):this._moveContent(i)},scrollToBottomRight:function(n,t){var i=this._calculateMovePercentDelta({anchor:cc.v2(1,0),applyToHorizontal:!0,applyToVertical:!0});n?this._startAutoScroll(i,n,!1!==t):this._moveContent(i)},scrollToOffset:function(n,t,i){var r=this.getMaxScrollOffset(),u=cc.v2(0,0);u.x=0===r.x?0:n.x/r.x;u.y=0===r.y?1:(r.y-n.y)/r.y;this.scrollTo(u,t,i)},getScrollOffset:function(){var n=this._getContentTopBoundary()-this._topBoundary,t=this._getContentLeftBoundary()-this._leftBoundary;return cc.v2(t,n)},getMaxScrollOffset:function(){var i=this._view.getContentSize(),r=this.content.getContentSize(),n=r.width-i.width,t=r.height-i.height;return n=n>=0?n:0,t=t>=0?t:0,cc.v2(n,t)},scrollToPercentHorizontal:function(n,t,i){var r=this._calculateMovePercentDelta({anchor:cc.v2(n,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(r,t,!1!==i):this._moveContent(r)},scrollTo:function(n,t,i){var r=this._calculateMovePercentDelta({anchor:cc.v2(n),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(r,t,!1!==i):this._moveContent(r)},scrollToPercentVertical:function(n,t,i){var r=this._calculateMovePercentDelta({anchor:cc.v2(0,n),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(r,t,!1!==i):this._moveContent(r)},stopAutoScroll:function(){this._autoScrolling=!1;this._autoScrollAccumulatedTime=this._autoScrollTotalTime},setContentPosition:function(n){n.fuzzyEquals(this.getContentPosition(),.0001)||(this.content.setPosition(n),this._outOfBoundaryAmountDirty=!0)},getContentPosition:function(){return this.content.getPosition()},isScrolling:function(){return this._scrolling},isAutoScrolling:function(){return this._autoScrolling},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this,!0);this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0);this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this,!0);this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0);this.node.on(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},_unregisterEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this,!0);this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0);this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this,!0);this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0);this.node.off(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},_onMouseWheel:function(n,t){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(n,t)){var i=cc.v2(0,0);this.vertical?i=cc.v2(0,-.1*n.getScrollY()):this.horizontal&&(i=cc.v2(-.1*n.getScrollY(),0));this._mouseWheelEventElapsedTime=0;this._processDeltaMove(i);this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60),this._stopMouseWheel=!0);this._stopPropagationIfTargetIsMe(n)}},_checkMouseWheel:function(n){if(!this._getHowMuchOutOfBoundary().fuzzyEquals(cc.v2(0,0),.0001))return this._processInertiaScroll(),this.unschedule(this._checkMouseWheel),this._dispatchEvent("scroll-ended"),void(this._stopMouseWheel=!1);this._mouseWheelEventElapsedTime+=n;this._mouseWheelEventElapsedTime>.1&&(this._onScrollBarTouchEnded(),this.unschedule(this._checkMouseWheel),this._dispatchEvent("scroll-ended"),this._stopMouseWheel=!1)},_calculateMovePercentDelta:function(n){var i=n.anchor,s=n.applyToHorizontal,h=n.applyToVertical,r,u,t;this._calculateBoundary();i=i.clampf(cc.v2(0,0),cc.v2(1,1));var e=this._view.getContentSize(),o=this.content.getContentSize(),f=this._getContentBottomBoundary()-this._bottomBoundary;return f=-f,r=this._getContentLeftBoundary()-this._leftBoundary,r=-r,u=cc.v2(0,0),t=0,s&&(t=o.width-e.width,u.x=r-t*i.x),h&&(t=o.height-e.height,u.y=f-t*i.y),u},_moveContentToTopLeft:function(n){var t=this.content.getContentSize(),i=this._getContentBottomBoundary()-this._bottomBoundary;i=-i;var r=cc.v2(0,0),u=0,f=this._getContentLeftBoundary()-this._leftBoundary;f=-f;t.height<n.height&&(u=t.height-n.height,r.y=i-u);t.width<n.width&&(u=t.width-n.width,r.x=f);this._updateScrollBarState();this._moveContent(r);this._adjustContentOutOfBoundary()},_calculateBoundary:function(){var t;if(this.content){t=this.content.getComponent(cc.Layout);t&&t.enabledInHierarchy&&t.updateLayout();var n=this._view.getContentSize(),i=n.width*this._view.anchorX,r=n.height*this._view.anchorY;this._leftBoundary=-i;this._bottomBoundary=-r;this._rightBoundary=this._leftBoundary+n.width;this._topBoundary=this._bottomBoundary+n.height;this._moveContentToTopLeft(n)}},_hasNestedViewGroup:function(n,t){var i,r;if(n.eventPhase===cc.Event.CAPTURING_PHASE){if(t)for(i=0;i<t.length;++i){if(r=t[i],this.node===r)return!!n.target.getComponent(cc.ViewGroup);if(r.getComponent(cc.ViewGroup))return!0}return!1}},_stopPropagationIfTargetIsMe:function(n){n.eventPhase===cc.Event.AT_TARGET&&n.target===this.node&&n.stopPropagation()},_onTouchBegan:function(n,t){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(n,t)){var i=n.touch;this.content&&this._handlePressLogic(i);this._touchMoved=!1;this._stopPropagationIfTargetIsMe(n)}},_onTouchMoved:function(n,t){var r,i;this.enabledInHierarchy&&!this._hasNestedViewGroup(n,t)&&(r=n.touch,(this.content&&this._handleMoveLogic(r),this.cancelInnerEvents)&&(r.getLocation().sub(r.getStartLocation()).mag()>7&&!this._touchMoved&&n.target!==this.node&&(i=new cc.Event.EventTouch(n.getTouches(),n.bubbles),i.type=cc.Node.EventType.TOUCH_CANCEL,i.touch=n.touch,i.simulate=!0,n.target.dispatchEvent(i),this._touchMoved=!0),this._stopPropagationIfTargetIsMe(n)))},_onTouchEnded:function(n,t){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(n,t)){this._dispatchEvent("touch-up");var i=n.touch;this.content&&this._handleReleaseLogic(i);this._touchMoved?n.stopPropagation():this._stopPropagationIfTargetIsMe(n)}},_onTouchCancelled:function(n,t){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(n,t)){if(!n.simulate){var i=n.touch;this.content&&this._handleReleaseLogic(i)}this._stopPropagationIfTargetIsMe(n)}},_processDeltaMove:function(n){this._scrollChildren(n);this._gatherTouchMove(n)},_getLocalAxisAlignDelta:function(n){return this.node.convertToNodeSpaceAR(n.getLocation(),u),this.node.convertToNodeSpaceAR(n.getPreviousLocation(),f),u.sub(f)},_handleMoveLogic:function(n){var t=this._getLocalAxisAlignDelta(n);this._processDeltaMove(t)},_scrollChildren:function(n){var r,t=n=this._clampDelta(n),i;this.elastic&&(r=this._getHowMuchOutOfBoundary(),t.x*=0===r.x?1:.5,t.y*=0===r.y?1:.5);this.elastic||(r=this._getHowMuchOutOfBoundary(t),t=t.add(r));i=-1;t.y>0?this.content.y-this.content.anchorY*this.content.height+t.y>=this._bottomBoundary&&(i="scroll-to-bottom"):t.y<0&&this.content.y-this.content.anchorY*this.content.height+this.content.height+t.y<=this._topBoundary&&(i="scroll-to-top");t.x<0?this.content.x-this.content.anchorX*this.content.width+this.content.width+t.x<=this._rightBoundary&&(i="scroll-to-right"):t.x>0&&this.content.x-this.content.anchorX*this.content.width+t.x>=this._leftBoundary&&(i="scroll-to-left");this._moveContent(t,!1);0===t.x&&0===t.y||(this._scrolling||(this._scrolling=!0,this._dispatchEvent("scroll-began")),this._dispatchEvent("scrolling"));-1!==i&&this._dispatchEvent(i)},_handlePressLogic:function(){this._autoScrolling&&this._dispatchEvent("scroll-ended");this._autoScrolling=!1;this._isBouncing=!1;this._touchMovePreviousTimestamp=e();this._touchMoveDisplacements.length=0;this._touchMoveTimeDeltas.length=0;this._onScrollBarTouchBegan()},_clampDelta:function(n){var t=this.content.getContentSize(),i=this._view.getContentSize();return t.width<i.width&&(n.x=0),t.height<i.height&&(n.y=0),n},_gatherTouchMove:function(n){for(n=this._clampDelta(n);this._touchMoveDisplacements.length>=5;)this._touchMoveDisplacements.shift(),this._touchMoveTimeDeltas.shift();this._touchMoveDisplacements.push(n);var t=e();this._touchMoveTimeDeltas.push((t-this._touchMovePreviousTimestamp)/1e3);this._touchMovePreviousTimestamp=t},_startBounceBackIfNeeded:function(){var n,t;return this.elastic?(n=this._getHowMuchOutOfBoundary(),(n=this._clampDelta(n)).fuzzyEquals(cc.v2(0,0),.0001))?!1:(t=Math.max(this.bounceDuration,0),this._startAutoScroll(n,t,!0),this._isBouncing||(n.y>0&&this._dispatchEvent("bounce-top"),n.y<0&&this._dispatchEvent("bounce-bottom"),n.x>0&&this._dispatchEvent("bounce-right"),n.x<0&&this._dispatchEvent("bounce-left"),this._isBouncing=!0),!0):!1},_processInertiaScroll:function(){if(!this._startBounceBackIfNeeded()&&this.inertia){var n=this._calculateTouchMoveVelocity();!n.fuzzyEquals(cc.v2(0,0),.0001)&&this.brake<1&&this._startInertiaScroll(n)}this._onScrollBarTouchEnded()},_handleReleaseLogic:function(n){var t=this._getLocalAxisAlignDelta(n);this._gatherTouchMove(t);this._processInertiaScroll();this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent("scroll-ended"))},_isOutOfBoundary:function(){return!this._getHowMuchOutOfBoundary().fuzzyEquals(cc.v2(0,0),.0001)},_isNecessaryAutoScrollBrake:function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.getContentPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},getScrollEndedEventTiming:function(){return.0001},_processAutoScrolling:function(n){var o=this._isNecessaryAutoScrollBrake(),s=o?.05:1,i,r,t,u,f,h,e,c;this._autoScrollAccumulatedTime+=n*(1/s);r=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(i=r,r=(i-=1)*i*i*i*i+1);t=this._autoScrollStartPosition.add(this._autoScrollTargetDelta.mul(r));u=Math.abs(r-1)<=.0001;(Math.abs(r-1)<=this.getScrollEndedEventTiming()&&!this._isScrollEndedWithThresholdEventFired&&(this._dispatchEvent("scroll-ended-with-threshold"),this._isScrollEndedWithThresholdEventFired=!0),this.elastic)?(f=t.sub(this._autoScrollBrakingStartPosition),o&&(f=f.mul(s)),t=this._autoScrollBrakingStartPosition.add(f)):(h=t.sub(this.getContentPosition()),e=this._getHowMuchOutOfBoundary(h),e.fuzzyEquals(cc.v2(0,0),.0001)||(t=t.add(e),u=!0));u&&(this._autoScrolling=!1);c=t.sub(this.getContentPosition());this._moveContent(this._clampDelta(c),u);this._dispatchEvent("scrolling");this._autoScrolling||(this._isBouncing=!1,this._scrolling=!1,this._dispatchEvent("scroll-ended"))},_startInertiaScroll:function(n){var t=n.mul(.7);this._startAttenuatingAutoScroll(t,n)},_calculateAttenuatedFactor:function(n){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*n+n*n*8e-9))},_startAttenuatingAutoScroll:function(n,t){var u=this._calculateAutoScrollTimeByInitalSpeed(t.mag()),r=n.normalize(),f=this.content.getContentSize(),e=this._view.getContentSize(),o=f.width-e.width,s=f.height-e.height,c=this._calculateAttenuatedFactor(o),l=this._calculateAttenuatedFactor(s),h,i;r=cc.v2(r.x*o*(1-this.brake)*c,r.y*s*l*(1-this.brake));h=n.mag();i=r.mag()/h;r=r.add(n);this.brake>0&&i>7&&(i=Math.sqrt(i),r=n.mul(i).add(n));this.brake>0&&i>3&&(u*=i=3);0===this.brake&&i>1&&(u*=i);this._startAutoScroll(r,u,!0)},_calculateAutoScrollTimeByInitalSpeed:function(n){return Math.sqrt(Math.sqrt(n/5))},_startAutoScroll:function(n,t,i){var r=this._flattenVectorByDirection(n);this._autoScrolling=!0;this._autoScrollTargetDelta=r;this._autoScrollAttenuate=i;this._autoScrollStartPosition=this.getContentPosition();this._autoScrollTotalTime=t;this._autoScrollAccumulatedTime=0;this._autoScrollBraking=!1;this._isScrollEndedWithThresholdEventFired=!1;this._autoScrollBrakingStartPosition=cc.v2(0,0);this._getHowMuchOutOfBoundary().fuzzyEquals(cc.v2(0,0),.0001)||(this._autoScrollCurrentlyOutOfBoundary=!0)},_calculateTouchMoveVelocity:function(){var n=0,t;return(n=this._touchMoveTimeDeltas.reduce(function(n,t){return n+t},n))<=0||n>=.5?cc.v2(0,0):(t=cc.v2(0,0),t=this._touchMoveDisplacements.reduce(function(n,t){return n.add(t)},t),cc.v2(t.x*(1-this.brake)/n,t.y*(1-this.brake)/n))},_flattenVectorByDirection:function(n){var t=n;return t.x=this.horizontal?t.x:0,t.y=this.vertical?t.y:0,t},_moveContent:function(n,t){var r=this._flattenVectorByDirection(n),u=this.getContentPosition().add(r),i;this.setContentPosition(u);i=this._getHowMuchOutOfBoundary();this._updateScrollBar(i);this.elastic&&t&&this._startBounceBackIfNeeded()},_getContentLeftBoundary:function(){return this.getContentPosition().x-this.content.getAnchorPoint().x*this.content.getContentSize().width},_getContentRightBoundary:function(){var n=this.content.getContentSize();return this._getContentLeftBoundary()+n.width},_getContentTopBoundary:function(){var n=this.content.getContentSize();return this._getContentBottomBoundary()+n.height},_getContentBottomBoundary:function(){return this.getContentPosition().y-this.content.getAnchorPoint().y*this.content.getContentSize().height},_getHowMuchOutOfBoundary:function(n){if((n=n||cc.v2(0,0)).fuzzyEquals(cc.v2(0,0),.0001)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var t=cc.v2(0,0);return this._getContentLeftBoundary()+n.x>this._leftBoundary?t.x=this._leftBoundary-(this._getContentLeftBoundary()+n.x):this._getContentRightBoundary()+n.x<this._rightBoundary&&(t.x=this._rightBoundary-(this._getContentRightBoundary()+n.x)),this._getContentTopBoundary()+n.y<this._topBoundary?t.y=this._topBoundary-(this._getContentTopBoundary()+n.y):this._getContentBottomBoundary()+n.y>this._bottomBoundary&&(t.y=this._bottomBoundary-(this._getContentBottomBoundary()+n.y)),n.fuzzyEquals(cc.v2(0,0),.0001)&&(this._outOfBoundaryAmount=t,this._outOfBoundaryAmountDirty=!1),this._clampDelta(t)},_updateScrollBarState:function(){if(this.content){var n=this.content.getContentSize(),t=this._view.getContentSize();this.verticalScrollBar&&(n.height<t.height?this.verticalScrollBar.hide():this.verticalScrollBar.show());this.horizontalScrollBar&&(n.width<t.width?this.horizontalScrollBar.hide():this.horizontalScrollBar.show())}},_updateScrollBar:function(n){this.horizontalScrollBar&&this.horizontalScrollBar._onScroll(n);this.verticalScrollBar&&this.verticalScrollBar._onScroll(n)},_onScrollBarTouchBegan:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchBegan();this.verticalScrollBar&&this.verticalScrollBar._onTouchBegan()},_onScrollBarTouchEnded:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchEnded();this.verticalScrollBar&&this.verticalScrollBar._onTouchEnded()},_dispatchEvent:function(n){if("scroll-ended"===n)this._scrollEventEmitMask=0;else if("scroll-to-top"===n||"scroll-to-bottom"===n||"scroll-to-left"===n||"scroll-to-right"===n){var t=1<<o[n];if(this._scrollEventEmitMask&t)return;this._scrollEventEmitMask|=t}cc.Component.EventHandler.emitEvents(this.scrollEvents,this,o[n]);this.node.emit(n,this)},_adjustContentOutOfBoundary:function(){if(this._outOfBoundaryAmountDirty=!0,this._isOutOfBoundary()){var n=this._getHowMuchOutOfBoundary(cc.v2(0,0)),t=this.getContentPosition().add(n);this.content&&(this.content.setPosition(t),this._updateScrollBar(0))}},start:function(){this._calculateBoundary();this.content&&cc.director.once(cc.Director.EVENT_BEFORE_DRAW,this._adjustContentOutOfBoundary,this)},_hideScrollbar:function(){this.horizontalScrollBar&&this.horizontalScrollBar.hide();this.verticalScrollBar&&this.verticalScrollBar.hide()},onDisable:function(){this._unregisterEvent();this.content&&(this.content.off(r.SIZE_CHANGED,this._calculateBoundary,this),this.content.off(r.SCALE_CHANGED,this._calculateBoundary,this),this._view&&(this._view.off(r.POSITION_CHANGED,this._calculateBoundary,this),this._view.off(r.SCALE_CHANGED,this._calculateBoundary,this),this._view.off(r.SIZE_CHANGED,this._calculateBoundary,this)));this._hideScrollbar();this.stopAutoScroll()},onEnable:function(){this._registerEvent();this.content&&(this.content.on(r.SIZE_CHANGED,this._calculateBoundary,this),this.content.on(r.SCALE_CHANGED,this._calculateBoundary,this),this._view&&(this._view.on(r.POSITION_CHANGED,this._calculateBoundary,this),this._view.on(r.SCALE_CHANGED,this._calculateBoundary,this),this._view.on(r.SIZE_CHANGED,this._calculateBoundary,this)));this._updateScrollBarState()},update:function(n){this._autoScrolling&&this._processAutoScrolling(n)}});cc.ScrollView=t.exports=s},{"../CCNode":29,"./CCViewGroup":126}],120:[function(n,t){"use strict";var r=n("../utils/misc"),u=n("./CCComponent"),i=cc.Enum({Horizontal:0,Vertical:1}),f=cc.Class({name:"cc.Slider","extends":u,editor:!1,ctor:function(){this._offset=cc.v2();this._touchHandle=!1;this._dragging=!1},properties:{handle:{"default":null,type:cc.Button,tooltip:!1,notify:function(){}},direction:{"default":i.Horizontal,type:i,tooltip:!1},progress:{"default":.5,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){this._updateHandlePosition()}},slideEvents:{"default":[],type:cc.Component.EventHandler,tooltip:!1}},statics:{Direction:i},__preload:function(){this._updateHandlePosition()},onEnable:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this);this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this);this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this);this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this);this.handle&&this.handle.isValid&&(this.handle.node.on(cc.Node.EventType.TOUCH_START,this._onHandleDragStart,this),this.handle.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.handle.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this))},onDisable:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this);this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this);this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this);this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this);this.handle&&this.handle.isValid&&(this.handle.node.off(cc.Node.EventType.TOUCH_START,this._onHandleDragStart,this),this.handle.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.handle.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this))},_onHandleDragStart:function(n){this._dragging=!0;this._touchHandle=!0;this._offset=this.handle.node.convertToNodeSpaceAR(n.touch.getLocation());n.stopPropagation()},_onTouchBegan:function(n){this.handle&&(this._dragging=!0,this._touchHandle||this._handleSliderLogic(n.touch),n.stopPropagation())},_onTouchMoved:function(n){this._dragging&&(this._handleSliderLogic(n.touch),n.stopPropagation())},_onTouchEnded:function(n){this._dragging=!1;this._touchHandle=!1;this._offset=cc.v2();n.stopPropagation()},_onTouchCancelled:function(n){this._dragging=!1;n.stopPropagation()},_handleSliderLogic:function(n){this._updateProgress(n);this._emitSlideEvent()},_emitSlideEvent:function(){cc.Component.EventHandler.emitEvents(this.slideEvents,this);this.node.emit("slide",this)},_updateProgress:function(n){if(this.handle){var t=this.node,u=t.convertToNodeSpaceAR(n.getLocation());this.progress=this.direction===i.Horizontal?r.clamp01((u.x-this._offset.x+t.anchorX*t.width)/t.width):r.clamp01((u.y-this._offset.y+t.anchorY*t.height)/t.height)}},_updateHandlePosition:function(){var n,t;this.handle&&(n=this.direction===i.Horizontal?cc.v2(-this.node.width*this.node.anchorX+this.progress*this.node.width,0):cc.v2(0,-this.node.height*this.node.anchorY+this.progress*this.node.height),t=this.node.convertToWorldSpaceAR(n),this.handle.node.position=this.handle.node.parent.convertToNodeSpaceAR(t))}});cc.Slider=t.exports=f},{"../utils/misc":269,"./CCComponent":105}],121:[function(n,t){"use strict";var u=n("../utils/misc"),o=(n("../CCNode").EventType,n("./CCRenderComponent")),f=n("../utils/blend-func"),i=cc.Enum({SIMPLE:0,SLICED:1,TILED:2,FILLED:3,MESH:4}),e=cc.Enum({HORIZONTAL:0,VERTICAL:1,RADIAL:2}),r=cc.Enum({CUSTOM:0,TRIMMED:1,RAW:2}),s=cc.Enum({NORMAL:0,GRAY:1}),h=cc.Class({name:"cc.Sprite","extends":o,mixins:[f],editor:!1,properties:{_spriteFrame:{"default":null,type:cc.SpriteFrame},_type:i.SIMPLE,_sizeMode:r.TRIMMED,_fillType:0,_fillCenter:cc.v2(0,0),_fillStart:0,_fillRange:0,_isTrimmedMode:!0,_atlas:{"default":null,type:cc.SpriteAtlas,tooltip:!1,editorOnly:!0,visible:!0,animatable:!1},spriteFrame:{get:function(){return this._spriteFrame},set:function(n){var t=this._spriteFrame;t!==n&&(this._spriteFrame=n,this._applySpriteFrame(t))},type:cc.SpriteFrame},type:{get:function(){return this._type},set:function(n){this._type!==n&&(this._type=n,this.setVertsDirty(),this._resetAssembler())},type:i,animatable:!1,tooltip:!1},fillType:{get:function(){return this._fillType},set:function(n){n!==this._fillType&&(this._fillType=n,this.setVertsDirty(),this._resetAssembler())},type:e,tooltip:!1},fillCenter:{get:function(){return this._fillCenter},set:function(n){this._fillCenter.x=n.x;this._fillCenter.y=n.y;this._type===i.FILLED&&this.setVertsDirty()},tooltip:!1},fillStart:{get:function(){return this._fillStart},set:function(n){this._fillStart=u.clampf(n,-1,1);this._type===i.FILLED&&this.setVertsDirty()},tooltip:!1},fillRange:{get:function(){return this._fillRange},set:function(n){this._fillRange=u.clampf(n,-1,1);this._type===i.FILLED&&this.setVertsDirty()},tooltip:!1},trim:{get:function(){return this._isTrimmedMode},set:function(n){this._isTrimmedMode!==n&&(this._isTrimmedMode=n,this._type!==i.SIMPLE&&this._type!==i.MESH||this.setVertsDirty())},animatable:!1,tooltip:!1},sizeMode:{get:function(){return this._sizeMode},set:function(n){this._sizeMode=n;n!==r.CUSTOM&&this._applySpriteSize()},animatable:!1,type:r,tooltip:!1}},statics:{FillType:e,Type:i,SizeMode:r,State:s},setVisible:function(n){this.enabled=n},setState:function(){},getState:function(){},__preload:function(){this._super();this._applySpriteFrame()},onEnable:function(){this._super();this._spriteFrame&&this._spriteFrame.ensureLoadTexture();this.node.on(cc.Node.EventType.SIZE_CHANGED,this.setVertsDirty,this);this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this)},onDisable:function(){this._super();this.node.off(cc.Node.EventType.SIZE_CHANGED,this.setVertsDirty,this);this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this)},_updateMaterial:function(){var t=this._spriteFrame&&this._spriteFrame.getTexture(),n=this.getMaterial(0);n&&(void 0!==n.getDefine("USE_TEXTURE")&&n.define("USE_TEXTURE",!0),void 0!==n.getProperty("texture")&&n.setProperty("texture",t));f.prototype._updateMaterial.call(this)},_applyAtlas:!1,_validateRender:function(){var n=this._spriteFrame;this._materials[0]&&n&&n.textureLoaded()||this.disableRender()},_applySpriteSize:function(){var t,n;this._spriteFrame&&this.isValid&&(r.RAW===this._sizeMode?(t=this._spriteFrame._originalSize,this.node.setContentSize(t)):r.TRIMMED===this._sizeMode&&(n=this._spriteFrame._rect,this.node.setContentSize(n.width,n.height)),this.setVertsDirty())},_applySpriteFrame:function(n){var i,t,r;this.isValid&&(i=n&&n.getTexture(),i&&!i.loaded&&n.off("load",this._applySpriteSize,this),this._updateMaterial(),t=this._spriteFrame,t?(r=t.getTexture(),r&&r.loaded?this._applySpriteSize():(this.disableRender(),t.once("load",this._applySpriteSize,this))):this.disableRender())}});cc.Sprite=t.exports=h},{"../CCNode":29,"../utils/blend-func":263,"../utils/misc":269,"./CCRenderComponent":115}],122:[function(n,t){"use strict";var r=cc.Enum({NONE:0,CHECKBOX:1,TEXT_ATLAS:2,SLIDER_BAR:3,LIST_VIEW:4,PAGE_VIEW:5}),u=cc.Enum({VERTICAL:0,HORIZONTAL:1}),f=cc.Enum({TOP:0,CENTER:1,BOTTOM:2}),e=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),o=cc.Class({name:"cc.StudioComponent","extends":cc.Component,editor:!1,properties:!1,statics:{ComponentType:r,ListDirection:u,VerticalAlign:f,HorizontalAlign:e}}),i;cc.StudioComponent=t.exports=o;i=cc.Class({name:"cc.StudioWidget","extends":cc.Widget,editor:!1,_validateTargetInDEV:function(){}});cc.StudioWidget=t.exports=i},{}],123:[function(n,t){"use strict";var r=n("../utils/gray-sprite-state"),i=cc.Class({name:"cc.Toggle","extends":n("./CCButton"),mixins:[r],editor:!1,properties:{_N$isChecked:!0,isChecked:{get:function(){return this._N$isChecked},set:function(n){if(n!==this._N$isChecked){var t=this.toggleGroup||this._toggleContainer;t&&t.enabled&&this._N$isChecked&&!t.allowSwitchOff||(this._N$isChecked=n,this._updateCheckMark(),t&&t.enabled&&t.updateToggles(this),cc.Toggle._triggerEventInScript_isChecked&&this._emitToggleEvents())}},tooltip:!1},toggleGroup:{"default":null,tooltip:!1,type:n("./CCToggleGroup")},checkMark:{"default":null,type:cc.Sprite,tooltip:!1},checkEvents:{"default":[],type:cc.Component.EventHandler},_resizeToTarget:{animatable:!1,set:function(n){n&&this._resizeNodeToTargetNode()}}},statics:{_triggerEventInScript_check:!1,_triggerEventInScript_isChecked:!1},onEnable:function(){this._super();this._registerToggleEvent();this.toggleGroup&&this.toggleGroup.enabledInHierarchy&&this.toggleGroup.addToggle(this)},onDisable:function(){this._super();this._unregisterToggleEvent();this.toggleGroup&&this.toggleGroup.enabledInHierarchy&&this.toggleGroup.removeToggle(this)},_hideCheckMark:function(){this._N$isChecked=!1;this._updateCheckMark()},toggle:function(n){this.isChecked=!this.isChecked;!cc.Toggle._triggerEventInScript_isChecked&&(cc.Toggle._triggerEventInScript_check||n)&&this._emitToggleEvents()},check:function(){this.isChecked=!0;!cc.Toggle._triggerEventInScript_isChecked&&cc.Toggle._triggerEventInScript_check&&this._emitToggleEvents()},uncheck:function(){this.isChecked=!1;!cc.Toggle._triggerEventInScript_isChecked&&cc.Toggle._triggerEventInScript_check&&this._emitToggleEvents()},_updateCheckMark:function(){this.checkMark&&(this.checkMark.node.active=!!this.isChecked)},_updateDisabledState:function(){if(this._super(),this.enableAutoGrayEffect&&this.checkMark){var n=!this.interactable;this._switchGrayMaterial(n,this.checkMark)}},_registerToggleEvent:function(){this.node.on("click",this.toggle,this)},_unregisterToggleEvent:function(){this.node.off("click",this.toggle,this)},_emitToggleEvents:function(){this.node.emit("toggle",this);this.checkEvents&&cc.Component.EventHandler.emitEvents(this.checkEvents,this)}});cc.Toggle=t.exports=i;n("../platform/js").get(i.prototype,"_toggleContainer",function(){var n=this.node.parent;return cc.Node.isNode(n)?n.getComponent(cc.ToggleContainer):null})},{"../platform/js":216,"../utils/gray-sprite-state":266,"./CCButton":103,"./CCToggleGroup":125}],124:[function(n,t){"use strict";var i=cc.Class({name:"cc.ToggleContainer","extends":cc.Component,editor:!1,properties:{allowSwitchOff:{tooltip:!1,"default":!1},checkEvents:{"default":[],type:cc.Component.EventHandler}},updateToggles:function(n){this.enabledInHierarchy&&n.isChecked&&(this.toggleItems.forEach(function(t){t!==n&&t.isChecked&&t.enabled&&t._hideCheckMark()}),this.checkEvents&&cc.Component.EventHandler.emitEvents(this.checkEvents,n))},_allowOnlyOneToggleChecked:function(){var n=!1;return this.toggleItems.forEach(function(t){n?t._hideCheckMark():t.isChecked&&(n=!0)}),n},_makeAtLeastOneToggleChecked:function(){if(!this._allowOnlyOneToggleChecked()&&!this.allowSwitchOff){var n=this.toggleItems;n.length>0&&n[0].check()}},onEnable:function(){this._makeAtLeastOneToggleChecked();this.node.on("child-added",this._allowOnlyOneToggleChecked,this);this.node.on("child-removed",this._makeAtLeastOneToggleChecked,this)},onDisable:function(){this.node.off("child-added",this._allowOnlyOneToggleChecked,this);this.node.off("child-removed",this._makeAtLeastOneToggleChecked,this)}});n("../platform/js").get(i.prototype,"toggleItems",function(){return this.node._children.map(function(n){return n.getComponent(cc.Toggle)}).filter(Boolean)});cc.ToggleContainer=t.exports=i},{"../platform/js":216}],125:[function(n,t){"use strict";var i=cc.Class({name:"cc.ToggleGroup","extends":cc.Component,ctor:function(){this._toggleItems=[]},editor:!1,properties:{allowSwitchOff:{tooltip:!1,"default":!1},toggleItems:{get:function(){return this._toggleItems}}},updateToggles:function(n){this.enabledInHierarchy&&this._toggleItems.forEach(function(t){n.isChecked&&t!==n&&t.isChecked&&t.enabled&&t._hideCheckMark()})},addToggle:function(n){-1===this._toggleItems.indexOf(n)&&this._toggleItems.push(n);this._allowOnlyOneToggleChecked()},removeToggle:function(n){var t=this._toggleItems.indexOf(n);t>-1&&this._toggleItems.splice(t,1);this._makeAtLeastOneToggleChecked()},_allowOnlyOneToggleChecked:function(){var n=!1;return this._toggleItems.forEach(function(t){n&&t.enabled&&t._hideCheckMark();t.isChecked&&t.enabled&&(n=!0)}),n},_makeAtLeastOneToggleChecked:function(){this._allowOnlyOneToggleChecked()||this.allowSwitchOff||this._toggleItems.length>0&&(this._toggleItems[0].isChecked=!0)},start:function(){this._makeAtLeastOneToggleChecked()}}),u=n("../platform/js"),r=!1;u.get(cc,"ToggleGroup",function(){return r||(cc.errorID(1405,"cc.ToggleGroup","cc.ToggleContainer"),r=!0),i});t.exports=i},{"../platform/js":216}],126:[function(n,t){"use strict";var i=cc.Class({name:"cc.ViewGroup","extends":n("./CCComponent")});cc.ViewGroup=t.exports=i},{"./CCComponent":105}],127:[function(n,t){"use strict";var u=n("../base-ui/CCWidgetManager"),i=u.AlignMode,r=u._AlignFlags,f=r.TOP,e=r.MID,o=r.BOT,s=r.LEFT,h=r.CENTER,c=r.RIGHT,a=f|o,l=s|c,v=cc.Class({name:"cc.Widget","extends":n("./CCComponent"),editor:!1,properties:{target:{get:function(){return this._target},set:function(n){this._target=n},type:cc.Node,tooltip:!1},isAlignTop:{get:function(){return(this._alignFlags&f)>0},set:function(n){this._setAlign(f,n)},animatable:!1,tooltip:!1},isAlignVerticalCenter:{get:function(){return(this._alignFlags&e)>0},set:function(n){n?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=e):this._alignFlags&=~e},animatable:!1,tooltip:!1},isAlignBottom:{get:function(){return(this._alignFlags&o)>0},set:function(n){this._setAlign(o,n)},animatable:!1,tooltip:!1},isAlignLeft:{get:function(){return(this._alignFlags&s)>0},set:function(n){this._setAlign(s,n)},animatable:!1,tooltip:!1},isAlignHorizontalCenter:{get:function(){return(this._alignFlags&h)>0},set:function(n){n?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=h):this._alignFlags&=~h},animatable:!1,tooltip:!1},isAlignRight:{get:function(){return(this._alignFlags&c)>0},set:function(n){this._setAlign(c,n)},animatable:!1,tooltip:!1},isStretchWidth:{get:function(){return(this._alignFlags&l)===l},visible:!1},isStretchHeight:{get:function(){return(this._alignFlags&a)===a},visible:!1},top:{get:function(){return this._top},set:function(n){this._top=n},tooltip:!1},bottom:{get:function(){return this._bottom},set:function(n){this._bottom=n},tooltip:!1},left:{get:function(){return this._left},set:function(n){this._left=n},tooltip:!1},right:{get:function(){return this._right},set:function(n){this._right=n},tooltip:!1},horizontalCenter:{get:function(){return this._horizontalCenter},set:function(n){this._horizontalCenter=n},tooltip:!1},verticalCenter:{get:function(){return this._verticalCenter},set:function(n){this._verticalCenter=n},tooltip:!1},isAbsoluteHorizontalCenter:{get:function(){return this._isAbsHorizontalCenter},set:function(n){this._isAbsHorizontalCenter=n},animatable:!1},isAbsoluteVerticalCenter:{get:function(){return this._isAbsVerticalCenter},set:function(n){this._isAbsVerticalCenter=n},animatable:!1},isAbsoluteTop:{get:function(){return this._isAbsTop},set:function(n){this._isAbsTop=n},animatable:!1},isAbsoluteBottom:{get:function(){return this._isAbsBottom},set:function(n){this._isAbsBottom=n},animatable:!1},isAbsoluteLeft:{get:function(){return this._isAbsLeft},set:function(n){this._isAbsLeft=n},animatable:!1},isAbsoluteRight:{get:function(){return this._isAbsRight},set:function(n){this._isAbsRight=n},animatable:!1},alignMode:{"default":i.ON_WINDOW_RESIZE,type:i,tooltip:!1},_wasAlignOnce:{"default":void 0,formerlySerializedAs:"isAlignOnce"},_target:null,_alignFlags:0,_left:0,_right:0,_top:0,_bottom:0,_verticalCenter:0,_horizontalCenter:0,_isAbsLeft:!0,_isAbsRight:!0,_isAbsTop:!0,_isAbsBottom:!0,_isAbsHorizontalCenter:!0,_isAbsVerticalCenter:!0,_originalWidth:0,_originalHeight:0},statics:{AlignMode:i},onLoad:function(){void 0!==this._wasAlignOnce&&(this.alignMode=this._wasAlignOnce?i.ONCE:i.ALWAYS,this._wasAlignOnce=void 0)},onEnable:function(){u.add(this)},onDisable:function(){u.remove(this)},_validateTargetInDEV:!1,_setAlign:function(n,t){if(t!==(this._alignFlags&n)>0){var i=(n&l)>0;t?(this._alignFlags|=n,i?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=this.node.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=this.node.height))):(i?this.isStretchWidth&&(this.node.width=this._originalWidth):this.isStretchHeight&&(this.node.height=this._originalHeight),this._alignFlags&=~n)}},updateAlignment:function(){u.updateAlignment(this.node)}});Object.defineProperty(v.prototype,"isAlignOnce",{get:function(){return this.alignMode===i.ONCE},set:function(n){this.alignMode=n?i.ONCE:i.ALWAYS}});cc.Widget=t.exports=v},{"../base-ui/CCWidgetManager":89,"./CCComponent":105}],128:[function(n,t){"use strict";var r=n("./CCComponent"),i=cc.Class({name:"cc.SubContextView","extends":r,editor:!1,properties:{_firstlyEnabled:!0,_fps:60,fps:{get:function(){return this._fps},set:function(n){this._fps!==n&&(this._fps=n,this._updateInterval=1/n,this._updateSubContextFrameRate())},tooltip:!1}},ctor:function(){this._sprite=null;this._tex=new cc.Texture2D;this._context=null;this._updatedTime=performance.now();this._updateInterval=0},onLoad:function(){if(window.__globalAdapter&&__globalAdapter.getOpenDataContext){this._updateInterval=1e3/this._fps;this._context=__globalAdapter.getOpenDataContext();this.reset();var n=this._context.canvas;this._tex.setPremultiplyAlpha(!0);this._tex.initWithElement(n);this._sprite=this.node.getComponent(cc.Sprite);this._sprite||(this._sprite=this.node.addComponent(cc.Sprite),this._sprite.srcBlendFactor=cc.macro.BlendFactor.ONE);this._sprite.spriteFrame=new cc.SpriteFrame(this._tex)}else this.enabled=!1},reset:function(){if(this._context){this.updateSubContextViewport();var n=this._context.canvas;n&&(n.width=this.node.width,n.height=this.node.height)}},onEnable:function(){this._firstlyEnabled&&this._context?(this._context.postMessage({fromEngine:!0,event:"boot"}),this._firstlyEnabled=!1):this._runSubContextMainLoop();this._registerNodeEvent();this._updateSubContextFrameRate();this.updateSubContextViewport()},onDisable:function(){this._unregisterNodeEvent();this._stopSubContextMainLoop()},update:function(n){if(void 0===n)return this._context&&this._context.postMessage({fromEngine:!0,event:"step"}),void this._updateSubContextTexture();performance.now()-this._updatedTime>=this._updateInterval&&(this._updatedTime+=this._updateInterval,this._updateSubContextTexture())},_updateSubContextTexture:function(){this._tex&&this._context&&(this._tex.initWithElement(this._context.canvas),this._sprite._activateMaterial())},updateSubContextViewport:function(){if(this._context){var n=this.node.getBoundingBoxToWorld(),t=cc.view._scaleX,i=cc.view._scaleY;this._context.postMessage({fromEngine:!0,event:"viewport",x:n.x*t+cc.view._viewportRect.x,y:n.y*i+cc.view._viewportRect.y,width:n.width*t,height:n.height*i})}},_registerNodeEvent:function(){this.node.on("position-changed",this.updateSubContextViewport,this);this.node.on("scale-changed",this.updateSubContextViewport,this);this.node.on("size-changed",this.updateSubContextViewport,this)},_unregisterNodeEvent:function(){this.node.off("position-changed",this.updateSubContextViewport,this);this.node.off("scale-changed",this.updateSubContextViewport,this);this.node.off("size-changed",this.updateSubContextViewport,this)},_runSubContextMainLoop:function(){this._context&&this._context.postMessage({fromEngine:!0,event:"mainLoop",value:!0})},_stopSubContextMainLoop:function(){this._context&&this._context.postMessage({fromEngine:!0,event:"mainLoop",value:!1})},_updateSubContextFrameRate:function(){this._context&&this._context.postMessage({fromEngine:!0,event:"frameRate",value:this._fps})}});cc.SubContextView=t.exports=i;cc.WXSubContextView=i;cc.SwanSubContextView=i},{"./CCComponent":105}],129:[function(n,t){"use strict";function c(n){return n.charAt(0).toUpperCase()+n.slice(1)}var f=n("../../platform/CCMacro"),h=n("../editbox/EditBoxImplBase"),i=n("../CCLabel"),e=n("./types"),u=e.InputMode,r=e.InputFlag,o=e.KeyboardReturnType,s=cc.Class({name:"cc.EditBox","extends":cc.Component,editor:!1,properties:{_string:"",string:{tooltip:!1,get:function(){return this._string},set:function(n){n=""+n;this.maxLength>=0&&n.length>=this.maxLength&&(n=n.slice(0,this.maxLength));this._string=n;this._updateString(n)}},textLabel:{tooltip:!1,"default":null,type:i,notify:function(n){this.textLabel&&this.textLabel!==n&&(this._updateTextLabel(),this._updateLabels())}},placeholderLabel:{tooltip:!1,"default":null,type:i,notify:function(n){this.placeholderLabel&&this.placeholderLabel!==n&&(this._updatePlaceholderLabel(),this._updateLabels())}},background:{tooltip:!1,"default":null,type:cc.Sprite,notify:function(n){this.background&&this.background!==n&&this._updateBackgroundSprite()}},_N$backgroundImage:{"default":void 0,type:cc.SpriteFrame},backgroundImage:{get:function(){return this.background?this.background.spriteFrame:null},set:function(n){this.background&&(this.background.spriteFrame=n)}},returnType:{"default":o.DEFAULT,tooltip:!1,displayName:"KeyboardReturnType",type:o},_N$returnType:{"default":void 0,type:cc.Float},inputFlag:{tooltip:!1,"default":r.DEFAULT,type:r,notify:function(){this._updateString(this._string)}},inputMode:{tooltip:!1,"default":u.ANY,type:u,notify:function(n){this.inputMode!==n&&(this._updateTextLabel(),this._updatePlaceholderLabel())}},fontSize:{get:function(){return this.textLabel?this.textLabel.fontSize:0},set:function(n){this.textLabel&&(this.textLabel.fontSize=n)}},_N$fontSize:{"default":void 0,type:cc.Float},lineHeight:{get:function(){return this.textLabel?this.textLabel.lineHeight:0},set:function(n){this.textLabel&&(this.textLabel.lineHeight=n)}},_N$lineHeight:{"default":void 0,type:cc.Float},fontColor:{get:function(){return this.textLabel?this.textLabel.node.color:cc.Color.BLACK},set:function(n){this.textLabel&&(this.textLabel.node.color=n,this.textLabel.node.opacity=n.a)}},_N$fontColor:void 0,placeholder:{tooltip:!1,get:function(){return this.placeholderLabel?this.placeholderLabel.string:""},set:function(n){this.placeholderLabel&&(this.placeholderLabel.string=n)}},_N$placeholder:{"default":void 0,type:cc.String},placeholderFontSize:{get:function(){return this.placeholderLabel?this.placeholderLabel.fontSize:0},set:function(n){this.placeholderLabel&&(this.placeholderLabel.fontSize=n)}},_N$placeholderFontSize:{"default":void 0,type:cc.Float},placeholderFontColor:{get:function(){return this.placeholderLabel?this.placeholderLabel.node.color:cc.Color.BLACK},set:function(n){this.placeholderLabel&&(this.placeholderLabel.node.color=n,this.placeholderLabel.node.opacity=n.a)}},_N$placeholderFontColor:void 0,maxLength:{tooltip:!1,"default":20},_N$maxLength:{"default":void 0,type:cc.Float},stayOnTop:{"default":!1,notify:function(){cc.warn("editBox.stayOnTop is removed since v2.1.")}},_tabIndex:0,tabIndex:{tooltip:!1,get:function(){return this._tabIndex},set:function(n){this._tabIndex!==n&&(this._tabIndex=n,this._impl&&this._impl.setTabIndex(n))}},editingDidBegan:{"default":[],type:cc.Component.EventHandler},textChanged:{"default":[],type:cc.Component.EventHandler},editingDidEnded:{"default":[],type:cc.Component.EventHandler},editingReturn:{"default":[],type:cc.Component.EventHandler}},statics:{_ImplClass:h,KeyboardReturnType:o,InputFlag:r,InputMode:u},_init:function(){this._upgradeComp();this._isLabelVisible=!0;this.node.on(cc.Node.EventType.SIZE_CHANGED,this._syncSize,this);(this._impl=new s._ImplClass).init(this);this._updateString(this._string);this._syncSize()},_updateBackgroundSprite:function(){var n=this.background,t;n||(t=this.node.getChildByName("BACKGROUND_SPRITE"),t||(t=new cc.Node("BACKGROUND_SPRITE")),(n=t.getComponent(cc.Sprite))||(n=t.addComponent(cc.Sprite)),t.parent=this.node,this.background=n);n.type=cc.Sprite.Type.SLICED;void 0!==this._N$backgroundImage&&(n.spriteFrame=this._N$backgroundImage,this._N$backgroundImage=void 0)},_updateTextLabel:function(){var n=this.textLabel,t;n||(t=this.node.getChildByName("TEXT_LABEL"),t||(t=new cc.Node("TEXT_LABEL")),(n=t.getComponent(i))||(n=t.addComponent(i)),t.parent=this.node,this.textLabel=n);n.node.setAnchorPoint(0,1);n.overflow=i.Overflow.CLAMP;this.inputMode===u.ANY?(n.verticalAlign=f.VerticalTextAlignment.TOP,n.enableWrapText=!0):(n.verticalAlign=f.VerticalTextAlignment.CENTER,n.enableWrapText=!1);n.string=this._updateLabelStringStyle(this._string);void 0!==this._N$fontColor&&(n.node.color=this._N$fontColor,n.node.opacity=this._N$fontColor.a,this._N$fontColor=void 0);void 0!==this._N$fontSize&&(n.fontSize=this._N$fontSize,this._N$fontSize=void 0);void 0!==this._N$lineHeight&&(n.lineHeight=this._N$lineHeight,this._N$lineHeight=void 0)},_updatePlaceholderLabel:function(){var n=this.placeholderLabel,t;n||(t=this.node.getChildByName("PLACEHOLDER_LABEL"),t||(t=new cc.Node("PLACEHOLDER_LABEL")),(n=t.getComponent(i))||(n=t.addComponent(i)),t.parent=this.node,this.placeholderLabel=n);n.node.setAnchorPoint(0,1);n.overflow=i.Overflow.CLAMP;this.inputMode===u.ANY?(n.verticalAlign=f.VerticalTextAlignment.TOP,n.enableWrapText=!0):(n.verticalAlign=f.VerticalTextAlignment.CENTER,n.enableWrapText=!1);n.string=this.placeholder;void 0!==this._N$placeholderFontColor&&(n.node.color=this._N$placeholderFontColor,n.node.opacity=this._N$placeholderFontColor.a,this._N$placeholderFontColor=void 0);void 0!==this._N$placeholderFontSize&&(n.fontSize=this._N$placeholderFontSize,this._N$placeholderFontSize=void 0)},_upgradeComp:function(){void 0!==this._N$returnType&&(this.returnType=this._N$returnType,this._N$returnType=void 0);void 0!==this._N$maxLength&&(this.maxLength=this._N$maxLength,this._N$maxLength=void 0);void 0!==this._N$backgroundImage&&this._updateBackgroundSprite();void 0===this._N$fontColor&&void 0===this._N$fontSize&&void 0===this._N$lineHeight||this._updateTextLabel();void 0===this._N$placeholderFontColor&&void 0===this._N$placeholderFontSize||this._updatePlaceholderLabel();void 0!==this._N$placeholder&&(this.placeholder=this._N$placeholder,this._N$placeholder=void 0)},_syncSize:function(){if(this._impl){var n=this.node.getContentSize();this._impl.setSize(n.width,n.height)}},_showLabels:function(){this._isLabelVisible=!0;this._updateLabels()},_hideLabels:function(){this._isLabelVisible=!1;this.textLabel&&(this.textLabel.node.active=!1);this.placeholderLabel&&(this.placeholderLabel.node.active=!1)},_updateLabels:function(){if(this._isLabelVisible){var n=this._string;this.textLabel&&(this.textLabel.node.active=""!==n);this.placeholderLabel&&(this.placeholderLabel.node.active=""===n)}},_updateString:function(n){var i=this.textLabel,t;i&&(t=n,t&&(t=this._updateLabelStringStyle(t)),i.string=t,this._updateLabels())},_updateLabelStringStyle:function(n,t){var i=this.inputFlag;if(t||i!==r.PASSWORD)i===r.INITIAL_CAPS_ALL_CHARACTERS?n=n.toUpperCase():i===r.INITIAL_CAPS_WORD?n=n.replace(/(?:^|\s)\S/g,function(n){return n.toUpperCase()}):i===r.INITIAL_CAPS_SENTENCE&&(n=c(n));else{for(var u="",e=n.length,f=0;f<e;++f)u+="";n=u}return n},editBoxEditingDidBegan:function(){cc.Component.EventHandler.emitEvents(this.editingDidBegan,this);this.node.emit("editing-did-began",this)},editBoxEditingDidEnded:function(){cc.Component.EventHandler.emitEvents(this.editingDidEnded,this);this.node.emit("editing-did-ended",this)},editBoxTextChanged:function(n){n=this._updateLabelStringStyle(n,!0);this.string=n;cc.Component.EventHandler.emitEvents(this.textChanged,n,this);this.node.emit("text-changed",this)},editBoxEditingReturn:function(){cc.Component.EventHandler.emitEvents(this.editingReturn,this);this.node.emit("editing-return",this)},onEnable:function(){this._registerEvent();this._impl&&this._impl.enable()},onDisable:function(){this._unregisterEvent();this._impl&&this._impl.disable()},onDestroy:function(){this._impl&&this._impl.clear()},__preload:function(){this._init()},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this);this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_unregisterEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this);this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_onTouchBegan:function(n){n.stopPropagation()},_onTouchCancel:function(n){n.stopPropagation()},_onTouchEnded:function(n){this._impl&&this._impl.beginEditing();n.stopPropagation()},setFocus:function(){cc.errorID(1400,"setFocus()","focus()");this._impl&&this._impl.setFocus(!0)},focus:function(){this._impl&&this._impl.setFocus(!0)},blur:function(){this._impl&&this._impl.setFocus(!1)},isFocused:function(){return!!this._impl&&this._impl.isFocused()},update:function(){this._impl&&this._impl.update()}});cc.EditBox=t.exports=s;cc.sys.isBrowser&&n("./WebEditBoxImpl")},{"../../platform/CCMacro":200,"../CCLabel":107,"../editbox/EditBoxImplBase":130,"./WebEditBoxImpl":131,"./types":133}],130:[function(n,t){"use strict";var i=cc.Class({ctor:function(){this._delegate=null;this._editing=!1},init:function(){},enable:function(){},disable:function(){this._editing&&this.endEditing()},clear:function(){},update:function(){},setTabIndex:function(){},setSize:function(){},setFocus:function(n){n?this.beginEditing():this.endEditing()},isFocused:function(){return this._editing},beginEditing:function(){},endEditing:function(){}});t.exports=i},{}],131:[function(n){"use strict";function a(){b.call(this);this._domId="EditBoxId_"+ ++g;this._placeholderStyleSheet=null;this._elem=null;this._isTextArea=!1;this._worldMat=new e.default;this._cameraMat=new e.default;this._m00=0;this._m01=0;this._m04=0;this._m05=0;this._m12=0;this._m13=0;this._w=0;this._h=0;this._cacheViewportRect=cc.rect(0,0,0,0);this._inputMode=null;this._inputFlag=null;this._returnType=null;this._eventListeners={};this._textLabelFont=null;this._textLabelFontSize=null;this._textLabelFontColor=null;this._textLabelAlign=null;this._placeholderLabelFont=null;this._placeholderLabelFontSize=null;this._placeholderLabelFontColor=null;this._placeholderLabelAlign=null;this._placeholderLineHeight=null}var f,e=(f=n("../../value-types/mat4"))&&f.__esModule?f:{"default":f},v=n("../../platform/utils"),y=n("../../platform/CCMacro"),s=n("./types"),i=n("../CCLabel"),o=n("./tabIndexUtil"),p=cc.EditBox,k=cc.js,r=s.InputMode,u=s.InputFlag,d=s.KeyboardReturnType,w={zoomInvalid:!1};cc.sys.OS_ANDROID!==cc.sys.os||cc.sys.browserType!==cc.sys.BROWSER_TYPE_SOUGOU&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_360||(w.zoomInvalid=!0);var g=0,h=cc.v3(),t=null,c=!1,l=!1,b=p._ImplClass;k.extend(a,b);p._ImplClass=a;Object.assign(a.prototype,{init:function(n){n&&(this._delegate=n,n.inputMode===r.ANY?this._createTextArea():this._createInput(),o.add(this),this.setTabIndex(n.tabIndex),this._initStyleSheet(),this._registerEventListeners(),this._addDomToGameContainer(),c=cc.view.isAutoFullScreenEnabled(),l=cc.view._resizeWithBrowserSize)},clear:function(){this._removeEventListeners();this._removeDomFromGameContainer();o.remove(this);t===this&&(t=null)},update:function(){this._updateMatrix()},setTabIndex:function(n){this._elem.tabIndex=n;o.resort()},setSize:function(n,t){var i=this._elem;i.style.width=n+"px";i.style.height=t+"px"},beginEditing:function(){t&&t!==this&&t.setFocus(!1);this._editing=!0;t=this;this._delegate.editBoxEditingDidBegan();this._showDom();this._elem.focus()},endEditing:function(){this._elem&&this._elem.blur()},_createInput:function(){this._isTextArea=!1;this._elem=document.createElement("input")},_createTextArea:function(){this._isTextArea=!0;this._elem=document.createElement("textarea")},_addDomToGameContainer:function(){cc.game.container.appendChild(this._elem);document.head.appendChild(this._placeholderStyleSheet)},_removeDomFromGameContainer:function(){v.contains(cc.game.container,this._elem)&&cc.game.container.removeChild(this._elem);v.contains(document.head,this._placeholderStyleSheet)&&document.head.removeChild(this._placeholderStyleSheet);delete this._elem;delete this._placeholderStyleSheet},_showDom:function(){this._updateMaxLength();this._updateInputType();this._updateStyleSheet();this._elem.style.display="";this._delegate._hideLabels();cc.sys.isMobile&&this._showDomOnMobile()},_hideDom:function(){this._elem.style.display="none";this._delegate._showLabels();cc.sys.isMobile&&this._hideDomOnMobile()},_showDomOnMobile:function(){cc.sys.os===cc.sys.OS_ANDROID&&(c&&(cc.view.enableAutoFullScreen(!1),cc.screen.exitFullScreen()),l&&cc.view.resizeWithBrowserSize(!1),this._adjustWindowScroll())},_hideDomOnMobile:function(){cc.sys.os===cc.sys.OS_ANDROID&&(l&&cc.view.resizeWithBrowserSize(!0),setTimeout(function(){t||c&&cc.view.enableAutoFullScreen(!0)},800));this._scrollBackWindow()},_adjustWindowScroll:function(){var n=this;setTimeout(function(){window.scrollY<100&&n._elem.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})},800)},_scrollBackWindow:function(){setTimeout(function(){var n=cc.sys;n.browserType!==n.BROWSER_TYPE_WECHAT||n.os!==n.OS_IOS?window.scrollTo(0,0):window.top&&window.top.scrollTo(0,0)},800)},_updateCameraMatrix:function(){var n=this._delegate.node,i;n.getWorldMatrix(this._worldMat);var t=this._worldMat,r=n._contentSize,u=n._anchorPoint;return h.x=-u.x*r.width,h.y=-u.y*r.height,e.default.transform(t,t,h),i=cc.Camera.findCamera(n),!!i&&(i.getWorldToScreenMatrix2D(this._cameraMat),e.default.mul(this._cameraMat,this._cameraMat,t),!0)},_updateMatrix:function(){var c,y,p,u,l;if(this._updateCameraMatrix()){var n=this._cameraMat.m,t=this._delegate.node,i=cc.view;if(this._m00!==n[0]||this._m01!==n[1]||this._m04!==n[4]||this._m05!==n[5]||this._m12!==n[12]||this._m13!==n[13]||this._w!==t._contentSize.width||this._h!==t._contentSize.height||!this._cacheViewportRect.equals(i._viewportRect)){this._m00=n[0];this._m01=n[1];this._m04=n[4];this._m05=n[5];this._m12=n[12];this._m13=n[13];this._w=t._contentSize.width;this._h=t._contentSize.height;this._cacheViewportRect.set(i._viewportRect);var e=i._scaleX,o=i._scaleY,a=i._viewportRect,f=i._devicePixelRatio;e/=f;o/=f;var r=cc.game.container,s=n[0]*e,b=n[1],k=n[4],h=n[5]*o,v=r&&r.style.paddingLeft&&parseInt(r.style.paddingLeft);v+=a.x/f;c=r&&r.style.paddingBottom&&parseInt(r.style.paddingBottom);c+=a.y/f;y=n[12]*e+v;p=n[13]*o+c;w.zoomInvalid&&(this.setSize(t.width*s,t.height*h),s=1,h=1);u=this._elem;l="matrix("+s+","+-b+","+-k+","+h+","+y+","+-p+")";u.style.transform=l;u.style["-webkit-transform"]=l;u.style["transform-origin"]="0px 100% 0px";u.style["-webkit-transform-origin"]="0px 100% 0px"}}},_updateInputType:function(){var s=this._delegate,t=s.inputMode,i=s.inputFlag,h=s.returnType,f=this._elem,e,n,o;if(this._inputMode!==t||this._inputFlag!==i||this._returnType!==h){if(this._inputMode=t,this._inputFlag=i,this._returnType=h,this._isTextArea)return e="none",i===u.INITIAL_CAPS_ALL_CHARACTERS?e="uppercase":i===u.INITIAL_CAPS_WORD&&(e="capitalize"),void(f.style.textTransform=e);if(i===u.PASSWORD)return f.type="password",void(f.style.textTransform="none");n=f.type;t===r.EMAIL_ADDR?n="email":t===r.NUMERIC||t===r.DECIMAL?n="number":t===r.PHONE_NUMBER?(n="number",f.pattern="[0-9]*"):t===r.URL?n="url":(n="text",h===d.SEARCH&&(n="search"));f.type=n;o="none";i===u.INITIAL_CAPS_ALL_CHARACTERS?o="uppercase":i===u.INITIAL_CAPS_WORD&&(o="capitalize");f.style.textTransform=o}},_updateMaxLength:function(){var n=this._delegate.maxLength;n<0&&(n=65535);this._elem.maxLength=n},_initStyleSheet:function(){var n=this._elem;n.style.display="none";n.style.border=0;n.style.background="transparent";n.style.width="100%";n.style.height="100%";n.style.active=0;n.style.outline="medium";n.style.padding="0";n.style.textTransform="none";n.style.position="absolute";n.style.bottom="0px";n.style.left="2px";n.className="cocosEditBox";n.id=this._domId;this._isTextArea?(n.style.resize="none",n.style.overflow_y="scroll"):(n.type="text",n.style["-moz-appearance"]="textfield");this._placeholderStyleSheet=document.createElement("style")},_updateStyleSheet:function(){var n=this._delegate,t=this._elem;t.value=n.string;t.placeholder=n.placeholder;this._updateTextLabel(n.textLabel);this._updatePlaceholderLabel(n.placeholderLabel)},_updateTextLabel:function(n){var t,u,r;if(n&&(t=n.font,t=!t||t instanceof cc.BitmapFont?n.fontFamily:t._fontFamily,u=n.fontSize*n.node.scaleY,this._textLabelFont!==t||this._textLabelFontSize!==u||this._textLabelFontColor!==n.fontColor||this._textLabelAlign!==n.horizontalAlign)){this._textLabelFont=t;this._textLabelFontSize=u;this._textLabelFontColor=n.fontColor;this._textLabelAlign=n.horizontalAlign;r=this._elem;switch(r.style.fontSize=u+"px",r.style.color=n.node.color.toCSS(),r.style.fontFamily=t,n.horizontalAlign){case i.HorizontalAlign.LEFT:r.style.textAlign="left";break;case i.HorizontalAlign.CENTER:r.style.textAlign="center";break;case i.HorizontalAlign.RIGHT:r.style.textAlign="right"}}},_updatePlaceholderLabel:function(n){var t,r;if(n&&(t=n.font,t=!t||t instanceof cc.BitmapFont?n.fontFamily:n.font._fontFamily,r=n.fontSize*n.node.scaleY,this._placeholderLabelFont!==t||this._placeholderLabelFontSize!==r||this._placeholderLabelFontColor!==n.fontColor||this._placeholderLabelAlign!==n.horizontalAlign||this._placeholderLineHeight!==n.fontSize)){this._placeholderLabelFont=t;this._placeholderLabelFontSize=r;this._placeholderLabelFontColor=n.fontColor;this._placeholderLabelAlign=n.horizontalAlign;this._placeholderLineHeight=n.fontSize;var u,f=this._placeholderStyleSheet,e=n.node.color.toCSS(),o=n.fontSize;switch(n.horizontalAlign){case i.HorizontalAlign.LEFT:u="left";break;case i.HorizontalAlign.CENTER:u="center";break;case i.HorizontalAlign.RIGHT:u="right"}f.innerHTML="#"+this._domId+"::-webkit-input-placeholder,#"+this._domId+"::-moz-placeholder,#"+this._domId+":-ms-input-placeholder{text-transform: initial; font-family: "+t+"; font-size: "+r+"px; color: "+e+"; line-height: "+o+"px; text-align: "+u+";}";cc.sys.browserType===cc.sys.BROWSER_TYPE_EDGE&&(f.innerHTML+="#"+this._domId+"::-ms-clear{display: none;}")}},_registerEventListeners:function(){var i=this,r=this._elem,u=!1,n=this._eventListeners;n.compositionStart=function(){u=!0};n.compositionEnd=function(){u=!1;i._delegate.editBoxTextChanged(r.value)};n.onInput=function(){if(!u){var n=i._delegate.maxLength;n>=0&&(r.value=r.value.slice(0,n));i._delegate.editBoxTextChanged(r.value)}};n.onClick=function(){i._editing&&cc.sys.isMobile&&i._adjustWindowScroll()};n.onKeydown=function(n){n.keyCode===y.KEY.enter?(n.stopPropagation(),i._delegate.editBoxEditingReturn(),i._isTextArea||r.blur()):n.keyCode===y.KEY.tab&&(n.stopPropagation(),n.preventDefault(),o.next(i))};n.onBlur=function(){cc.sys.isMobile&&u&&n.compositionEnd();i._editing=!1;t=null;i._hideDom();i._delegate.editBoxEditingDidEnded()};r.addEventListener("compositionstart",n.compositionStart);r.addEventListener("compositionend",n.compositionEnd);r.addEventListener("input",n.onInput);r.addEventListener("keydown",n.onKeydown);r.addEventListener("blur",n.onBlur);r.addEventListener("touchstart",n.onClick)},_removeEventListeners:function(){var t=this._elem,n=this._eventListeners;t.removeEventListener("compositionstart",n.compositionStart);t.removeEventListener("compositionend",n.compositionEnd);t.removeEventListener("input",n.onInput);t.removeEventListener("keydown",n.onKeydown);t.removeEventListener("blur",n.onBlur);t.removeEventListener("touchstart",n.onClick);n.compositionStart=null;n.compositionEnd=null;n.onInput=null;n.onKeydown=null;n.onBlur=null;n.onClick=null}})},{"../../platform/CCMacro":200,"../../platform/utils":219,"../../value-types/mat4":286,"../CCLabel":107,"./tabIndexUtil":132,"./types":133}],132:[function(n,t){"use strict";t.exports={_tabIndexList:[],add:function(n){var t=this._tabIndexList;-1===t.indexOf(n)&&t.push(n)},remove:function(n){var t=this._tabIndexList,i=t.indexOf(n);-1!==i&&t.splice(i,1)},resort:function(){this._tabIndexList.sort(function(n,t){return n._delegate._tabIndex-t._delegate._tabIndex})},next:function(n){var i=this._tabIndexList,r=i.indexOf(n),t;(n.setFocus(!1),-1!==r)&&(t=i[r+1],t&&t._delegate._tabIndex>=0&&t.setFocus(!0))}}},{}],133:[function(n,t){"use strict";var i=cc.Enum({DEFAULT:0,DONE:1,SEND:2,SEARCH:3,GO:4,NEXT:5}),r=cc.Enum({ANY:0,EMAIL_ADDR:1,NUMERIC:2,PHONE_NUMBER:3,URL:4,DECIMAL:5,SINGLE_LINE:6}),u=cc.Enum({PASSWORD:0,SENSITIVE:1,INITIAL_CAPS_WORD:2,INITIAL_CAPS_SENTENCE:3,INITIAL_CAPS_ALL_CHARACTERS:4,DEFAULT:5});t.exports={KeyboardReturnType:i,InputMode:r,InputFlag:u}},{}],134:[function(n,t){"use strict";var i,r;n("./CCComponent");n("./CCComponentEventHandler");n("./missing-script");i=n("./SubContextView");i||(i=cc.Class({name:"cc.SubContextView","extends":cc.Component}),cc.SubContextView=cc.WXSubContextView=cc.SwanSubContextView=i);r=[n("./CCSprite"),n("./CCWidget"),n("./CCCanvas"),n("./CCAudioSource"),n("./CCAnimation"),n("./CCButton"),n("./CCLabel"),n("./CCProgressBar"),n("./CCMask"),n("./CCScrollBar"),n("./CCScrollView"),n("./CCPageViewIndicator"),n("./CCPageView"),n("./CCSlider"),n("./CCLayout"),n("./editbox/CCEditBox"),n("./CCLabelOutline"),n("./CCLabelShadow"),n("./CCRichText"),n("./CCToggleContainer"),n("./CCToggleGroup"),n("./CCToggle"),n("./CCBlockInputEvents"),n("./CCMotionStreak"),n("./CCSafeArea"),i];t.exports=r},{"./CCAnimation":100,"./CCAudioSource":101,"./CCBlockInputEvents":102,"./CCButton":103,"./CCCanvas":104,"./CCComponent":105,"./CCComponentEventHandler":106,"./CCLabel":107,"./CCLabelOutline":108,"./CCLabelShadow":109,"./CCLayout":110,"./CCMask":111,"./CCMotionStreak":void 0,"./CCPageView":112,"./CCPageViewIndicator":113,"./CCProgressBar":114,"./CCRichText":116,"./CCSafeArea":117,"./CCScrollBar":118,"./CCScrollView":119,"./CCSlider":120,"./CCSprite":121,"./CCToggle":123,"./CCToggleContainer":124,"./CCToggleGroup":125,"./CCWidget":127,"./SubContextView":128,"./editbox/CCEditBox":129,"./missing-script":135}],135:[function(n,t){"use strict";var r=cc.js,i=cc.Class({name:"cc.MissingScript","extends":cc.Component,editor:{inspector:"packages://inspector/inspectors/comps/missing-script.js"},properties:{compiled:{"default":!1,serializable:!1},_$erialized:{"default":null,visible:!1,editorOnly:!0}},ctor:!1,statics:{safeFindClass:function(n){return r._getClassById(n)||(cc.deserialize.reportMissingClass(n),i)}},onLoad:function(){cc.warnID(4600,this.node.name)}});cc._MissingScript=t.exports=i},{}],136:[function(n,t){"use strict";var f=cc.js,r,i,u,e,o;n("../event/event");r=function(n,t){cc.Event.call(this,cc.Event.MOUSE,t);this._eventType=n;this._button=0;this._x=0;this._y=0;this._prevX=0;this._prevY=0;this._scrollX=0;this._scrollY=0};f.extend(r,cc.Event);i=r.prototype;i.setScrollData=function(n,t){this._scrollX=n;this._scrollY=t};i.getScrollX=function(){return this._scrollX};i.getScrollY=function(){return this._scrollY};i.setLocation=function(n,t){this._x=n;this._y=t};i.getLocation=function(){return cc.v2(this._x,this._y)};i.getLocationInView=function(){return cc.v2(this._x,cc.view._designResolutionSize.height-this._y)};i._setPrevCursor=function(n,t){this._prevX=n;this._prevY=t};i.getPreviousLocation=function(){return cc.v2(this._prevX,this._prevY)};i.getDelta=function(){return cc.v2(this._x-this._prevX,this._y-this._prevY)};i.getDeltaX=function(){return this._x-this._prevX};i.getDeltaY=function(){return this._y-this._prevY};i.setButton=function(n){this._button=n};i.getButton=function(){return this._button};i.getLocationX=function(){return this._x};i.getLocationY=function(){return this._y};r.NONE=0;r.DOWN=1;r.UP=2;r.MOVE=3;r.SCROLL=4;r.BUTTON_LEFT=0;r.BUTTON_RIGHT=2;r.BUTTON_MIDDLE=1;r.BUTTON_4=3;r.BUTTON_5=4;r.BUTTON_6=5;r.BUTTON_7=6;r.BUTTON_8=7;u=function(n,t){cc.Event.call(this,cc.Event.TOUCH,t);this._eventCode=0;this._touches=n||[];this.touch=null;this.currentTouch=null};f.extend(u,cc.Event);(i=u.prototype).getEventCode=function(){return this._eventCode};i.getTouches=function(){return this._touches};i._setEventCode=function(n){this._eventCode=n};i._setTouches=function(n){this._touches=n};i.setLocation=function(n,t){this.touch&&this.touch.setTouchInfo(this.touch.getID(),n,t)};i.getLocation=function(){return this.touch?this.touch.getLocation():cc.v2()};i.getLocationInView=function(){return this.touch?this.touch.getLocationInView():cc.v2()};i.getPreviousLocation=function(){return this.touch?this.touch.getPreviousLocation():cc.v2()};i.getStartLocation=function(){return this.touch?this.touch.getStartLocation():cc.v2()};i.getID=function(){return this.touch?this.touch.getID():null};i.getDelta=function(){return this.touch?this.touch.getDelta():cc.v2()};i.getDeltaX=function(){return this.touch?this.touch.getDelta().x:0};i.getDeltaY=function(){return this.touch?this.touch.getDelta().y:0};i.getLocationX=function(){return this.touch?this.touch.getLocationX():0};i.getLocationY=function(){return this.touch?this.touch.getLocationY():0};u.MAX_TOUCHES=5;u.BEGAN=0;u.MOVED=1;u.ENDED=2;u.CANCELED=3;e=function(n,t){cc.Event.call(this,cc.Event.ACCELERATION,t);this.acc=n};f.extend(e,cc.Event);o=function(n,t,i){cc.Event.call(this,cc.Event.KEYBOARD,i);this.keyCode=n;this.isPressed=t};f.extend(o,cc.Event);cc.Event.EventMouse=r;cc.Event.EventTouch=u;cc.Event.EventAcceleration=e;cc.Event.EventKeyboard=o;t.exports=cc.Event},{"../event/event":143}],137:[function(n,t){"use strict";var i=n("../platform/js"),r,s,h,u,f,e,o;cc.EventListener=function(n,t,i){this._onEvent=i;this._type=n||0;this._listenerID=t||"";this._registered=!1;this._fixedPriority=0;this._node=null;this._target=null;this._paused=!0;this._isEnabled=!0};cc.EventListener.prototype={constructor:cc.EventListener,_setPaused:function(n){this._paused=n},_isPaused:function(){return this._paused},_setRegistered:function(n){this._registered=n},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(n){this._fixedPriority=n},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(n){this._target=n;this._node=n},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!==this._onEvent},clone:function(){return null},setEnabled:function(n){this._isEnabled=n},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}};cc.EventListener.UNKNOWN=0;cc.EventListener.TOUCH_ONE_BY_ONE=1;cc.EventListener.TOUCH_ALL_AT_ONCE=2;cc.EventListener.KEYBOARD=3;cc.EventListener.MOUSE=4;cc.EventListener.ACCELERATION=6;cc.EventListener.CUSTOM=8;r=cc.EventListener.ListenerID={MOUSE:"__cc_mouse",TOUCH_ONE_BY_ONE:"__cc_touch_one_by_one",TOUCH_ALL_AT_ONCE:"__cc_touch_all_at_once",KEYBOARD:"__cc_keyboard",ACCELERATION:"__cc_acceleration"};s=function(n,t){this._onCustomEvent=t;cc.EventListener.call(this,cc.EventListener.CUSTOM,n,this._callback)};i.extend(s,cc.EventListener);i.mixin(s.prototype,{_onCustomEvent:null,_callback:function(n){null!==this._onCustomEvent&&this._onCustomEvent(n)},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent},clone:function(){return new s(this._listenerID,this._onCustomEvent)}});h=function(){cc.EventListener.call(this,cc.EventListener.MOUSE,r.MOUSE,this._callback)};i.extend(h,cc.EventListener);i.mixin(h.prototype,{onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,_callback:function(n){var t=cc.Event.EventMouse;switch(n._eventType){case t.DOWN:this.onMouseDown&&this.onMouseDown(n);break;case t.UP:this.onMouseUp&&this.onMouseUp(n);break;case t.MOVE:this.onMouseMove&&this.onMouseMove(n);break;case t.SCROLL:this.onMouseScroll&&this.onMouseScroll(n)}},clone:function(){var n=new h;return n.onMouseDown=this.onMouseDown,n.onMouseUp=this.onMouseUp,n.onMouseMove=this.onMouseMove,n.onMouseScroll=this.onMouseScroll,n},checkAvailable:function(){return!0}});u=function(){cc.EventListener.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,r.TOUCH_ONE_BY_ONE,null);this._claimedTouches=[]};i.extend(u,cc.EventListener);i.mixin(u.prototype,{constructor:u,_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,setSwallowTouches:function(n){this.swallowTouches=n},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var n=new u;return n.onTouchBegan=this.onTouchBegan,n.onTouchMoved=this.onTouchMoved,n.onTouchEnded=this.onTouchEnded,n.onTouchCancelled=this.onTouchCancelled,n.swallowTouches=this.swallowTouches,n},checkAvailable:function(){return!!this.onTouchBegan||(cc.logID(1801),!1)}});f=function(){cc.EventListener.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,r.TOUCH_ALL_AT_ONCE,null)};i.extend(f,cc.EventListener);i.mixin(f.prototype,{constructor:f,onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,clone:function(){var n=new f;return n.onTouchesBegan=this.onTouchesBegan,n.onTouchesMoved=this.onTouchesMoved,n.onTouchesEnded=this.onTouchesEnded,n.onTouchesCancelled=this.onTouchesCancelled,n},checkAvailable:function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(cc.logID(1802),!1)}});e=function(n){this._onAccelerationEvent=n;cc.EventListener.call(this,cc.EventListener.ACCELERATION,r.ACCELERATION,this._callback)};i.extend(e,cc.EventListener);i.mixin(e.prototype,{constructor:e,_onAccelerationEvent:null,_callback:function(n){this._onAccelerationEvent(n.acc,n)},checkAvailable:function(){return cc.assertID(this._onAccelerationEvent,1803),!0},clone:function(){return new e(this._onAccelerationEvent)}});o=function(){cc.EventListener.call(this,cc.EventListener.KEYBOARD,r.KEYBOARD,this._callback)};i.extend(o,cc.EventListener);i.mixin(o.prototype,{constructor:o,onKeyPressed:null,onKeyReleased:null,_callback:function(n){n.isPressed?this.onKeyPressed&&this.onKeyPressed(n.keyCode,n):this.onKeyReleased&&this.onKeyReleased(n.keyCode,n)},clone:function(){var n=new o;return n.onKeyPressed=this.onKeyPressed,n.onKeyReleased=this.onKeyReleased,n},checkAvailable:function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(cc.logID(1800),!1)}});cc.EventListener.create=function(n){var i,t,r;cc.assertID(n&&n.event,1900);i=n.event;delete n.event;t=null;for(r in i===cc.EventListener.TOUCH_ONE_BY_ONE?t=new u:i===cc.EventListener.TOUCH_ALL_AT_ONCE?t=new f:i===cc.EventListener.MOUSE?t=new h:i===cc.EventListener.CUSTOM?(t=new s(n.eventName,n.callback),delete n.eventName,delete n.callback):i===cc.EventListener.KEYBOARD?t=new o:i===cc.EventListener.ACCELERATION&&(t=new e(n.callback),delete n.callback),n)t[r]=n[r];return t};t.exports=cc.EventListener},{"../platform/js":216}],138:[function(n,t){"use strict";var e=n("../platform/js"),i,u,f,r;n("./CCEventListener");i=cc.EventListener.ListenerID;u=function(){this._fixedListeners=[];this._sceneGraphListeners=[];this.gt0Index=0};u.prototype={constructor:u,size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(n){0===n._getFixedPriority()?this._sceneGraphListeners.push(n):this._fixedListeners.push(n)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0;this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}};f=function(n){var t=cc.Event,r=n.type;return r===t.ACCELERATION?i.ACCELERATION:r===t.KEYBOARD?i.KEYBOARD:r.startsWith(t.MOUSE)?i.MOUSE:(r.startsWith(t.TOUCH)&&cc.logID(2e3),"")};r={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_toAddedListeners:[],_toRemovedListeners:[],_dirtyListeners:{},_inDispatch:0,_isEnabled:!1,_currentTouch:null,_currentTouchListener:null,_internalCustomListenerIDs:[],_setDirtyForNode:function(n){var i=this._nodeListenersMap[n._id],t,f,r;if(void 0!==i)for(t=0,f=i.length;t<f;t++)r=i[t]._getListenerID(),null==this._dirtyListeners[r]&&(this._dirtyListeners[r]=!0);if(n.childrenCount>0)for(var e=n._children,u=0,o=e.length;u<o;u++)this._setDirtyForNode(e[u])},pauseTarget:function(n,t){var i,r,u,f;if(n instanceof cc._BaseNode){if(u=this._nodeListenersMap[n._id],u)for(i=0,r=u.length;i<r;i++)u[i]._setPaused(!0);if(!0===t)for(f=n._children,i=0,r=f?f.length:0;i<r;i++)this.pauseTarget(f[i],!0)}else cc.warnID(3506)},resumeTarget:function(n,t){var i,r,u,f;if(n instanceof cc._BaseNode){if(u=this._nodeListenersMap[n._id],u)for(i=0,r=u.length;i<r;i++)u[i]._setPaused(!1);if(this._setDirtyForNode(n),!0===t)for(f=n._children,i=0,r=f?f.length:0;i<r;i++)this.resumeTarget(f[i],!0)}else cc.warnID(3506)},_addListener:function(n){0===this._inDispatch?this._forceAddEventListener(n):this._toAddedListeners.push(n)},_forceAddEventListener:function(n){var i=n._getListenerID(),r=this._listenersMap[i],t;(r||(r=new u,this._listenersMap[i]=r),r.push(n),0===n._getFixedPriority())?(this._setDirty(i,this.DIRTY_SCENE_GRAPH_PRIORITY),t=n._getSceneGraphPriority(),null===t&&cc.logID(3507),this._associateNodeAndEventListener(t,n),t.activeInHierarchy&&this.resumeTarget(t)):this._setDirty(i,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(n){return this._listenersMap[n]},_updateDirtyFlagForSceneGraph:function(){var n=this._dirtyListeners;for(var t in n)this._setDirty(t,this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyListeners={}},_removeAllListenersInVector:function(n){if(n)for(var t,i=n.length-1;i>=0;i--)(t=n[i])._setRegistered(!1),null!=t._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(t._getSceneGraphPriority(),t),t._setSceneGraphPriority(null)),0===this._inDispatch&&cc.js.array.removeAt(n,i)},_removeListenersForListenerID:function(n){var t,i=this._listenersMap[n],u,f,e,r;for(i&&(u=i.getFixedPriorityListeners(),f=i.getSceneGraphPriorityListeners(),this._removeAllListenersInVector(f),this._removeAllListenersInVector(u),delete this._priorityDirtyFlagMap[n],this._inDispatch||(i.clear(),delete this._listenersMap[n])),r=this._toAddedListeners,t=r.length-1;t>=0;t--)(e=r[t])&&e._getListenerID()===n&&cc.js.array.removeAt(r,t)},_sortEventListeners:function(n){var t=this.DIRTY_NONE,i=this._priorityDirtyFlagMap;i[n]&&(t=i[n]);t!==this.DIRTY_NONE&&(i[n]=this.DIRTY_NONE,t&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(n),t&this.DIRTY_SCENE_GRAPH_PRIORITY&&cc.director.getScene()&&this._sortListenersOfSceneGraphPriority(n))},_sortListenersOfSceneGraphPriority:function(n){var t=this._getListeners(n),i;t&&(i=t.getSceneGraphPriorityListeners(),i&&0!==i.length&&t.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes))},_sortEventListenersOfSceneGraphPriorityDes:function(n,t){var u=n._getSceneGraphPriority(),f=t._getSceneGraphPriority();if(!(t&&f&&f._activeInHierarchy&&null!==f._parent))return-1;if(!n||!u||!u._activeInHierarchy||null===u._parent)return 1;for(var i=u,r=f,e=!1;i._parent._id!==r._parent._id;)i=null===i._parent._parent?(e=!0)&&f:i._parent,r=null===r._parent._parent?(e=!0)&&u:r._parent;if(i._id===r._id){if(i._id===f._id)return-1;if(i._id===u._id)return 1}return e?i._localZOrder-r._localZOrder:r._localZOrder-i._localZOrder},_sortListenersOfFixedPriority:function(n){var r=this._listenersMap[n],t,i,u;if(r&&(t=r.getFixedPriorityListeners(),t&&0!==t.length)){for(t.sort(this._sortListenersOfFixedPriorityAsc),i=0,u=t.length;i<u&&!(t[i]._getFixedPriority()>=0);)++i;r.gt0Index=i}},_sortListenersOfFixedPriorityAsc:function(n,t){return n._getFixedPriority()-t._getFixedPriority()},_onUpdateListeners:function(n){var t,u,f,i=n.getFixedPriorityListeners(),r=n.getSceneGraphPriorityListeners(),e=this._toRemovedListeners;if(r)for(t=r.length-1;t>=0;t--)(u=r[t])._isRegistered()||(cc.js.array.removeAt(r,t),-1!==(f=e.indexOf(u))&&e.splice(f,1));if(i)for(t=i.length-1;t>=0;t--)(u=i[t])._isRegistered()||(cc.js.array.removeAt(i,t),-1!==(f=e.indexOf(u))&&e.splice(f,1));r&&0===r.length&&n.clearSceneGraphListeners();i&&0===i.length&&n.clearFixedListeners()},frameUpdateListeners:function(){var r=this._listenersMap,f=this._priorityDirtyFlagMap,t,n,i,u;for(t in r)r[t].empty()&&(delete f[t],delete r[t]);if(n=this._toAddedListeners,0!==n.length){for(i=0,u=n.length;i<u;i++)this._forceAddEventListener(n[i]);n.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()},_updateTouchListeners:function(){var u=this._inDispatch,n,t,r,f;if(cc.assertID(u>0,3508),!(u>1)){if((n=this._listenersMap[i.TOUCH_ONE_BY_ONE])&&this._onUpdateListeners(n),(n=this._listenersMap[i.TOUCH_ALL_AT_ONCE])&&this._onUpdateListeners(n),cc.assertID(1===u,3509),t=this._toAddedListeners,0!==t.length){for(r=0,f=t.length;r<f;r++)this._forceAddEventListener(t[r]);this._toAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},_cleanToRemovedListeners:function(){for(var i,r,u,f,e,n=this._toRemovedListeners,t=0;t<n.length;t++)i=n[t],r=this._listenersMap[i._getListenerID()],r&&(f=r.getFixedPriorityListeners(),e=r.getSceneGraphPriorityListeners(),e&&-1!==(u=e.indexOf(i))&&e.splice(u,1),f&&-1!==(u=f.indexOf(i))&&f.splice(u,1));n.length=0},_onTouchEventCallback:function(n,t){var i,u,h;if(!n._isRegistered())return!1;i=t.event;u=i.currentTouch;i.currentTarget=n._node;var o,s=!1,f=i.getEventCode(),e=cc.Event.EventTouch;if(f===e.BEGAN){if(!cc.macro.ENABLE_MULTI_TOUCH&&r._currentTouch&&(h=r._currentTouchListener._node,h&&h.activeInHierarchy))return!1;n.onTouchBegan&&(s=n.onTouchBegan(u,i))&&n._registered&&(n._claimedTouches.push(u),r._currentTouchListener=n,r._currentTouch=u)}else if(n._claimedTouches.length>0&&-1!==(o=n._claimedTouches.indexOf(u))){if(s=!0,!cc.macro.ENABLE_MULTI_TOUCH&&r._currentTouch&&r._currentTouch!==u)return!1;f===e.MOVED&&n.onTouchMoved?n.onTouchMoved(u,i):f===e.ENDED?(n.onTouchEnded&&n.onTouchEnded(u,i),n._registered&&n._claimedTouches.splice(o,1),r._clearCurTouch()):f===e.CANCELED&&(n.onTouchCancelled&&n.onTouchCancelled(u,i),n._registered&&n._claimedTouches.splice(o,1),r._clearCurTouch())}return i.isStopped()?(r._updateTouchListeners(i),!0):!(!s||!n.swallowTouches||(t.needsMutableSet&&t.touches.splice(u,1),0))},_dispatchTouchEvent:function(n){var t,r,u;if(this._sortEventListeners(i.TOUCH_ONE_BY_ONE),this._sortEventListeners(i.TOUCH_ALL_AT_ONCE),t=this._getListeners(i.TOUCH_ONE_BY_ONE),r=this._getListeners(i.TOUCH_ALL_AT_ONCE),null!==t||null!==r){var f=n.getTouches(),e=cc.js.array.copy(f),o={event:n,needsMutableSet:t&&r,touches:e,selTouch:null};if(t)for(u=0;u<f.length;u++)n.currentTouch=f[u],n._propagationStopped=n._propagationImmediateStopped=!1,this._dispatchEventToListeners(t,this._onTouchEventCallback,o);r&&e.length>0&&(this._dispatchEventToListeners(r,this._onTouchesEventCallback,{event:n,touches:e}),n.isStopped())||this._updateTouchListeners(n)}},_onTouchesEventCallback:function(n,t){if(!n._registered)return!1;var u=cc.Event.EventTouch,i=t.event,f=t.touches,e=i.getEventCode();return i.currentTarget=n._node,e===u.BEGAN&&n.onTouchesBegan?n.onTouchesBegan(f,i):e===u.MOVED&&n.onTouchesMoved?n.onTouchesMoved(f,i):e===u.ENDED&&n.onTouchesEnded?n.onTouchesEnded(f,i):e===u.CANCELED&&n.onTouchesCancelled&&n.onTouchesCancelled(f,i),!!i.isStopped()&&(r._updateTouchListeners(i),!0)},_associateNodeAndEventListener:function(n,t){var i=this._nodeListenersMap[n._id];i||(i=[],this._nodeListenersMap[n._id]=i);i.push(t)},_dissociateNodeAndEventListener:function(n,t){var i=this._nodeListenersMap[n._id];i&&(cc.js.array.remove(i,t),0===i.length&&delete this._nodeListenersMap[n._id])},_dispatchEventToListeners:function(n,t,i){var o,r,e=!1,u=n.getFixedPriorityListeners(),s=n.getSceneGraphPriorityListeners(),f=0;if(u&&0!==u.length)for(;f<n.gt0Index;++f)if((r=u[f]).isEnabled()&&!r._isPaused()&&r._isRegistered()&&t(r,i)){e=!0;break}if(s&&!e)for(o=0;o<s.length;o++)if((r=s[o]).isEnabled()&&!r._isPaused()&&r._isRegistered()&&t(r,i)){e=!0;break}if(u&&!e)for(;f<u.length;++f)if((r=u[f]).isEnabled()&&!r._isPaused()&&r._isRegistered()&&t(r,i)){e=!0;break}},_setDirty:function(n,t){var i=this._priorityDirtyFlagMap;i[n]=null==i[n]?t:t|i[n]},_sortNumberAsc:function(n,t){return n-t},hasEventListener:function(n){return!!this._getListeners(n)},addListener:function(n,t){if(cc.assertID(n&&t,3503),cc.js.isNumber(t)||t instanceof cc._BaseNode){if(n instanceof cc.EventListener){if(n._isRegistered())return void cc.logID(3505)}else cc.assertID(!cc.js.isNumber(t),3504),n=cc.EventListener.create(n);if(n.checkAvailable()){if(cc.js.isNumber(t)){if(0===t)return void cc.logID(3500);n._setSceneGraphPriority(null);n._setFixedPriority(t);n._setRegistered(!0);n._setPaused(!1);this._addListener(n)}else n._setSceneGraphPriority(t),n._setFixedPriority(0),n._setRegistered(!0),this._addListener(n);return n}}else cc.warnID(3506)},addCustomListener:function(n,t){var i=new cc.EventListener.create({event:cc.EventListener.CUSTOM,eventName:n,callback:t});return this.addListener(i,1),i},removeListener:function(n){var i,r,f,u,t,o;if(null!=n){r=this._listenersMap;for(f in r){var e=r[f],s=e.getFixedPriorityListeners(),h=e.getSceneGraphPriorityListeners();if((i=this._removeListenerInVector(h,n))?this._setDirty(n._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(i=this._removeListenerInVector(s,n))&&this._setDirty(n._getListenerID(),this.DIRTY_FIXED_PRIORITY),e.empty()&&(delete this._priorityDirtyFlagMap[n._getListenerID()],delete r[f]),i)break}if(!i)for(u=this._toAddedListeners,t=u.length-1;t>=0;t--)if(o=u[t],o===n){cc.js.array.removeAt(u,t);o._setRegistered(!1);break}this._currentTouchListener===n&&this._clearCurTouch()}},_clearCurTouch:function(){this._currentTouchListener=null;this._currentTouch=null},_removeListenerInCallback:function(n,t){var r,i;if(null==n)return!1;for(r=n.length-1;r>=0;r--)if(i=n[r],i._onCustomEvent===t||i._onEvent===t)return i._setRegistered(!1),null!=i._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(i._getSceneGraphPriority(),i),i._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.removeAt(n,r):this._toRemovedListeners.push(i),!0;return!1},_removeListenerInVector:function(n,t){var r,i;if(null==n)return!1;for(r=n.length-1;r>=0;r--)if(i=n[r],i===t)return i._setRegistered(!1),null!=i._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(i._getSceneGraphPriority(),i),i._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.removeAt(n,r):this._toRemovedListeners.push(i),!0;return!1},removeListeners:function(n,t){var u=this,r,o,s,f,e,c,h;if(cc.js.isNumber(n)||n instanceof cc._BaseNode)if(void 0!==n._id){if(o=u._nodeListenersMap[n._id],o){for(s=cc.js.array.copy(o),r=0;r<s.length;r++)u.removeListener(s[r]);delete u._nodeListenersMap[n._id]}for(f=u._toAddedListeners,r=0;r<f.length;)e=f[r],e._getSceneGraphPriority()===n?(e._setSceneGraphPriority(null),e._setRegistered(!1),f.splice(r,1)):++r;if(!0===t)for(h=n.children,r=0,c=h.length;r<c;r++)u.removeListeners(h[r],!0)}else n===cc.EventListener.TOUCH_ONE_BY_ONE?u._removeListenersForListenerID(i.TOUCH_ONE_BY_ONE):n===cc.EventListener.TOUCH_ALL_AT_ONCE?u._removeListenersForListenerID(i.TOUCH_ALL_AT_ONCE):n===cc.EventListener.MOUSE?u._removeListenersForListenerID(i.MOUSE):n===cc.EventListener.ACCELERATION?u._removeListenersForListenerID(i.ACCELERATION):n===cc.EventListener.KEYBOARD?u._removeListenersForListenerID(i.KEYBOARD):cc.logID(3501);else cc.warnID(3506)},removeCustomListeners:function(n){this._removeListenersForListenerID(n)},removeAllListeners:function(){var t=this._listenersMap,i=this._internalCustomListenerIDs;for(var n in t)-1===i.indexOf(n)&&this._removeListenersForListenerID(n)},setPriority:function(n,t){var i,u,r;if(null!=n){i=this._listenersMap;for(u in i)if(r=i[u].getFixedPriorityListeners(),r&&-1!==r.indexOf(n))return null!=n._getSceneGraphPriority()&&cc.logID(3502),void(n._getFixedPriority()!==t&&(n._setFixedPriority(t),this._setDirty(n._getListenerID(),this.DIRTY_FIXED_PRIORITY)))}},setEnabled:function(n){this._isEnabled=n},isEnabled:function(){return this._isEnabled},dispatchEvent:function(n){var i,t;if(this._isEnabled)if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,n&&n.getType){if(n.getType().startsWith(cc.Event.TOUCH))return this._dispatchTouchEvent(n),void this._inDispatch--;i=f(n);this._sortEventListeners(i);t=this._listenersMap[i];null!=t&&(this._dispatchEventToListeners(t,this._onListenerCallback,n),this._onUpdateListeners(t));this._inDispatch--}else cc.errorID(3511)},_onListenerCallback:function(n,t){return t.currentTarget=n._target,n._onEvent(t),t.isStopped()},dispatchCustomEvent:function(n,t){var i=new cc.Event.EventCustom(n);i.setUserData(t);this.dispatchEvent(i)}};e.get(cc,"eventManager",function(){return cc.errorID(1405,"cc.eventManager","cc.EventTarget or cc.systemEvent"),r});t.exports=cc.internal.eventManager=r},{"../platform/js":216,"./CCEventListener":137}],139:[function(){"use strict";cc.Touch=function(n,t,i){this._lastModified=0;this.setTouchInfo(i,n,t)};cc.Touch.prototype={constructor:cc.Touch,getLocation:function(){return cc.v2(this._point.x,this._point.y)},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return cc.v2(this._prevPoint.x,this._prevPoint.y)},getStartLocation:function(){return cc.v2(this._startPoint.x,this._startPoint.y)},getDelta:function(){return this._point.sub(this._prevPoint)},getLocationInView:function(){return cc.v2(this._point.x,cc.view._designResolutionSize.height-this._point.y)},getPreviousLocationInView:function(){return cc.v2(this._prevPoint.x,cc.view._designResolutionSize.height-this._prevPoint.y)},getStartLocationInView:function(){return cc.v2(this._startPoint.x,cc.view._designResolutionSize.height-this._startPoint.y)},getID:function(){return this._id},setTouchInfo:function(n,t,i){this._prevPoint=this._point;this._point=cc.v2(t||0,i||0);this._id=n;this._startPointCaptured||(this._startPoint=cc.v2(this._point),cc.view._convertPointWithScale(this._startPoint),this._startPointCaptured=!0)},_setPoint:function(n,t){void 0===t?(this._point.x=n.x,this._point.y=n.y):(this._point.x=n,this._point.y=t)},_setPrevPoint:function(n,t){this._prevPoint=void 0===t?cc.v2(n.x,n.y):cc.v2(n||0,t||0)}}},{}],140:[function(n,t){"use strict";n("./CCEvent");n("./CCTouch");n("./CCEventListener");var i=n("./CCEventManager");t.exports=i},{"./CCEvent":136,"./CCEventListener":137,"./CCEventManager":138,"./CCTouch":139}],141:[function(n,t){"use strict";function i(){r.call(this)}var u=cc.js,r=n("../platform/callbacks-invoker");u.extend(i,r);i.prototype.emit=function(n,t){var o=n.type,i=this._callbackTable[o],f,r;if(i){f=!i.isInvoking;i.isInvoking=!0;for(var e=i.callbackInfos,u=0,s=e.length;u<s;++u)if(r=e[u],r&&r.callback&&(r.callback.call(r.target,n,t),n._propagationImmediateStopped))break;f&&(i.isInvoking=!1,i.containCanceled&&i.purgeCanceled())}};t.exports=i},{"../platform/callbacks-invoker":208}],142:[function(n,t){"use strict";function u(){e.call(this)}var f=n("../platform/js"),e=n("../platform/callbacks-invoker"),r=f.array.fastRemove,i;f.extend(u,e);i=u.prototype;i.__on=i.on;i.on=function(n,t,i,r){if(t)return this.hasEventListener(n,t,i)||(this.__on(n,t,i,r),i&&i.__eventTargets&&i.__eventTargets.push(this)),t;cc.errorID(6800)};i.__off=i.off;i.off=function(n,t,i){var o,f,u,e;if(t)this.__off(n,t,i),i&&i.__eventTargets&&r(i.__eventTargets,this);else{if(o=this._callbackTable[n],!o)return;for(f=o.callbackInfos,u=0;u<f.length;++u)e=f[u]&&f[u].target,e&&e.__eventTargets&&r(e.__eventTargets,this);this.removeAll(n)}};i.targetOff=function(n){this.removeAll(n);n&&n.__eventTargets&&r(n.__eventTargets,this)};i.once=function(n,t,i){this.on(n,t,i,!0)};i.dispatchEvent=function(n){this.emit(n.type,n)};i.clear=function(){var i,r,n,t;for(i in this._callbackTable)for(r=this._callbackTable[i].callbackInfos,n=r.length-1;n>=0;n--)t=r[n],t&&this.off(i,t.callback,t.target)};cc.EventTarget=t.exports=u},{"../platform/callbacks-invoker":208,"../platform/js":216}],143:[function(n,t){"use strict";var u=n("../platform/js"),i,r;cc.Event=function(n,t){this.type=n;this.bubbles=!!t;this.target=null;this.currentTarget=null;this.eventPhase=0;this._propagationStopped=!1;this._propagationImmediateStopped=!1};cc.Event.prototype={constructor:cc.Event,unuse:function(){this.type=cc.Event.NO_TYPE;this.target=null;this.currentTarget=null;this.eventPhase=cc.Event.NONE;this._propagationStopped=!1;this._propagationImmediateStopped=!1},reuse:function(n,t){this.type=n;this.bubbles=t||!1},stopPropagation:function(){this._propagationStopped=!0},stopPropagationImmediate:function(){this._propagationImmediateStopped=!0},isStopped:function(){return this._propagationStopped||this._propagationImmediateStopped},getCurrentTarget:function(){return this.currentTarget},getType:function(){return this.type}};cc.Event.NO_TYPE="no_type";cc.Event.TOUCH="touch";cc.Event.MOUSE="mouse";cc.Event.KEYBOARD="keyboard";cc.Event.ACCELERATION="acceleration";cc.Event.NONE=0;cc.Event.CAPTURING_PHASE=1;cc.Event.AT_TARGET=2;cc.Event.BUBBLING_PHASE=3;i=function(n,t){cc.Event.call(this,n,t);this.detail=null};u.extend(i,cc.Event);i.prototype.reset=i;i.prototype.setUserData=function(n){this.detail=n};i.prototype.getUserData=function(){return this.detail};i.prototype.getEventName=cc.Event.prototype.getType;r=new u.Pool(10);i.put=function(n){r.put(n)};i.get=function(n,t){var u=r._get();return u?u.reset(n,t):u=new i(n,t),u};cc.Event.EventCustom=i;t.exports=cc.Event},{"../platform/js":216}],144:[function(n){"use strict";n("./event");n("./event-listeners");n("./event-target");n("./system-event")},{"./event":143,"./event-listeners":141,"./event-target":142,"./system-event":145}],145:[function(n,t){"use strict";var o=n("../event/event-target"),r=n("../event-manager"),e=n("../platform/CCInputManager"),i=cc.Enum({KEY_DOWN:"keydown",KEY_UP:"keyup",DEVICEMOTION:"devicemotion"}),u=null,f=null,s=cc.Class({name:"SystemEvent","extends":o,statics:{EventType:i},setAccelerometerEnabled:function(n){n&&window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then(function(n){console.log("Device Motion Event request permission: "+n);e.setAccelerometerEnabled("granted"===n)}):e.setAccelerometerEnabled(n)},setAccelerometerInterval:function(n){e.setAccelerometerInterval(n)},on:function(n,t,e,o){this._super(n,t,e,o);n!==i.KEY_DOWN&&n!==i.KEY_UP||(u||(u=cc.EventListener.create({event:cc.EventListener.KEYBOARD,onKeyPressed:function(n,t){t.type=i.KEY_DOWN;cc.systemEvent.dispatchEvent(t)},onKeyReleased:function(n,t){t.type=i.KEY_UP;cc.systemEvent.dispatchEvent(t)}})),r.hasEventListener(cc.EventListener.ListenerID.KEYBOARD)||r.addListener(u,1));n===i.DEVICEMOTION&&(f||(f=cc.EventListener.create({event:cc.EventListener.ACCELERATION,callback:function(n,t){t.type=i.DEVICEMOTION;cc.systemEvent.dispatchEvent(t)}})),r.hasEventListener(cc.EventListener.ListenerID.ACCELERATION)||r.addListener(f,1))},off:function(n,t,e){if(this._super(n,t,e),u&&(n===i.KEY_DOWN||n===i.KEY_UP)){var o=this.hasEventListener(i.KEY_DOWN),s=this.hasEventListener(i.KEY_UP);o||s||r.removeListener(u)}f&&n===i.DEVICEMOTION&&r.removeListener(f)}});cc.SystemEvent=t.exports=s;cc.systemEvent=new cc.SystemEvent},{"../event-manager":140,"../event/event-target":142,"../platform/CCInputManager":199}],146:[function(n,t,i){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}i.__esModule=!0;i.default=void 0;var r=u(n("../value-types/vec3")),e=u(n("../value-types/mat3")),o=u(n("./enums"));var s=new r.default,h=new r.default,f=new e.default,c=function(n,t,i){var u=f.m,e=i.m;u[0]=Math.abs(e[0]);u[1]=Math.abs(e[1]);u[2]=Math.abs(e[2]);u[3]=Math.abs(e[4]);u[4]=Math.abs(e[5]);u[5]=Math.abs(e[6]);u[6]=Math.abs(e[8]);u[7]=Math.abs(e[9]);u[8]=Math.abs(e[10]);r.default.transformMat3(n,t,f)},l=function(){function n(n,t,i,u,f,e){this.center=void 0;this.halfExtents=void 0;this._type=void 0;this._type=o.default.SHAPE_AABB;this.center=new r.default(n,t,i);this.halfExtents=new r.default(u,f,e)}n.create=function(t,i,r,u,f,e){return new n(t,i,r,u,f,e)};n.clone=function(t){return new n(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z)};n.copy=function(n,t){return r.default.copy(n.center,t.center),r.default.copy(n.halfExtents,t.halfExtents),n};n.fromPoints=function(n,t,i){return r.default.scale(n.center,r.default.add(s,t,i),.5),r.default.scale(n.halfExtents,r.default.sub(h,i,t),.5),n};n.set=function(n,t,i,u,f,e,o){return r.default.set(n.center,t,i,u),r.default.set(n.halfExtents,f,e,o),n};var t=n.prototype;return t.getBoundary=function(n,t){r.default.sub(n,this.center,this.halfExtents);r.default.add(t,this.center,this.halfExtents)},t.transform=function(n,t,i,u,f){f||(f=this);r.default.transformMat4(f.center,this.center,n);c(f.halfExtents,this.halfExtents,n)},n}();i.default=l;t.exports=i.default},{"../value-types/mat3":285,"../value-types/vec3":294,"./enums":148}],147:[function(n,t,i){"use strict";function a(n,t){return r.Vec3.dot(t.n,n)-t.d}i.__esModule=!0;i.point_plane=a;i.pt_point_plane=function(n,t,i){var u=a(t,i);return r.Vec3.subtract(n,t,r.Vec3.multiplyScalar(n,i.n,u))};i.pt_point_aabb=function(n,t,i){return r.Vec3.copy(n,t),r.Vec3.subtract(u,i.center,i.halfExtents),r.Vec3.add(f,i.center,i.halfExtents),n.x=n.x<u.x?u.x:n.x,n.y=n.y<u.x?u.y:n.y,n.z=n.z<u.x?u.z:n.z,n.x=n.x>f.x?f.x:n.x,n.y=n.y>f.x?f.y:n.y,n.z=n.z>f.x?f.z:n.z,n};i.pt_point_obb=function(n,t,i){var f=i.orientation.m,u,a;for(r.Vec3.set(s,f[0],f[1],f[2]),r.Vec3.set(h,f[3],f[4],f[5]),r.Vec3.set(c,f[6],f[7],f[8]),e[0]=s,e[1]=h,e[2]=c,o[0]=i.halfExtents.x,o[1]=i.halfExtents.y,o[2]=i.halfExtents.z,r.Vec3.subtract(l,t,i.center),r.Vec3.set(n,i.center.x,i.center.y,i.center.z),u=0;u<3;u++)a=r.Vec3.dot(l,e[u]),a>o[u]&&(a=o[u]),a<-o[u]&&(a=-o[u]),n.x+=a*e[u].x,n.y+=a*e[u].y,n.z+=a*e[u].z;return n};var r=n("../value-types"),s=new r.Vec3,h=new r.Vec3,c=new r.Vec3,l=new r.Vec3,u=new r.Vec3,f=new r.Vec3,e=new Array(3),o=new Array(3)},{"../value-types":284}],148:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;i.default={SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256};t.exports=i.default},{}],149:[function(n,t,i){"use strict";function h(n){return n&&n.__esModule?n:{"default":n}}function c(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}var e,u,s;i.__esModule=!0;i.default=void 0;var r=n("../value-types"),o=h(n("./enums")),f=h(n("./plane"));e=new Array(8);e[0]=new r.Vec3(1,1,1);e[1]=new r.Vec3(-1,1,1);e[2]=new r.Vec3(-1,-1,1);e[3]=new r.Vec3(1,-1,1);e[4]=new r.Vec3(1,1,-1);e[5]=new r.Vec3(-1,1,-1);e[6]=new r.Vec3(-1,-1,-1);e[7]=new r.Vec3(1,-1,-1);s=function(){function n(){var n,t;for(this.planes=void 0,this.vertices=void 0,this._type=void 0,this._type=o.default.SHAPE_FRUSTUM,this.planes=new Array(6),n=0;n<6;++n)this.planes[n]=f.default.create(0,0,0,0);for(this.vertices=new Array(8),t=0;t<8;++t)this.vertices[t]=new r.Vec3}var i,u,t;return n.create=function(){return new n},n.clone=function(t){return n.copy(new n,t)},n.copy=function(n,t){var i,u;for(n._type=t._type,i=0;i<6;++i)f.default.copy(n.planes[i],t.planes[i]);for(u=0;u<8;++u)r.Vec3.copy(n.vertices[u],t.vertices[u]);return n},i=n,(u=[{key:"accurate",set:function(n){this._type=n?o.default.SHAPE_FRUSTUM_ACCURATE:o.default.SHAPE_FRUSTUM}}])&&c(i.prototype,u),t=n.prototype,t.update=function(n,t){var i=n.m,s,u,h,f;if(r.Vec3.set(this.planes[0].n,i[3]+i[0],i[7]+i[4],i[11]+i[8]),this.planes[0].d=-(i[15]+i[12]),r.Vec3.set(this.planes[1].n,i[3]-i[0],i[7]-i[4],i[11]-i[8]),this.planes[1].d=-(i[15]-i[12]),r.Vec3.set(this.planes[2].n,i[3]+i[1],i[7]+i[5],i[11]+i[9]),this.planes[2].d=-(i[15]+i[13]),r.Vec3.set(this.planes[3].n,i[3]-i[1],i[7]-i[5],i[11]-i[9]),this.planes[3].d=-(i[15]-i[13]),r.Vec3.set(this.planes[4].n,i[3]+i[2],i[7]+i[6],i[11]+i[10]),this.planes[4].d=-(i[15]+i[14]),r.Vec3.set(this.planes[5].n,i[3]-i[2],i[7]-i[6],i[11]-i[10]),this.planes[5].d=-(i[15]-i[14]),this._type===o.default.SHAPE_FRUSTUM_ACCURATE){for(s=0;s<6;s++)u=this.planes[s],h=1/u.n.length(),r.Vec3.multiplyScalar(u.n,u.n,h),u.d*=h;for(f=0;f<8;f++)r.Vec3.transformMat4(this.vertices[f],e[f],t)}},t.transform=function(n){if(this._type===o.default.SHAPE_FRUSTUM_ACCURATE){for(var t=0;t<8;t++)r.Vec3.transformMat4(this.vertices[t],this.vertices[t],n);f.default.fromPoints(this.planes[0],this.vertices[1],this.vertices[5],this.vertices[6]);f.default.fromPoints(this.planes[1],this.vertices[3],this.vertices[7],this.vertices[4]);f.default.fromPoints(this.planes[2],this.vertices[6],this.vertices[7],this.vertices[3]);f.default.fromPoints(this.planes[3],this.vertices[0],this.vertices[4],this.vertices[5]);f.default.fromPoints(this.planes[4],this.vertices[2],this.vertices[3],this.vertices[0]);f.default.fromPoints(this.planes[0],this.vertices[7],this.vertices[6],this.vertices[5])}},n}();i.default=s;s.createOrtho=(u=new r.Vec3,function(n,t,i,e,o,s){var h=t/2,c=i/2;r.Vec3.set(u,h,c,e);r.Vec3.transformMat4(n.vertices[0],u,s);r.Vec3.set(u,-h,c,e);r.Vec3.transformMat4(n.vertices[1],u,s);r.Vec3.set(u,-h,-c,e);r.Vec3.transformMat4(n.vertices[2],u,s);r.Vec3.set(u,h,-c,e);r.Vec3.transformMat4(n.vertices[3],u,s);r.Vec3.set(u,h,c,o);r.Vec3.transformMat4(n.vertices[4],u,s);r.Vec3.set(u,-h,c,o);r.Vec3.transformMat4(n.vertices[5],u,s);r.Vec3.set(u,-h,-c,o);r.Vec3.transformMat4(n.vertices[6],u,s);r.Vec3.set(u,h,-c,o);r.Vec3.transformMat4(n.vertices[7],u,s);f.default.fromPoints(n.planes[0],n.vertices[1],n.vertices[6],n.vertices[5]);f.default.fromPoints(n.planes[1],n.vertices[3],n.vertices[4],n.vertices[7]);f.default.fromPoints(n.planes[2],n.vertices[6],n.vertices[3],n.vertices[7]);f.default.fromPoints(n.planes[3],n.vertices[0],n.vertices[5],n.vertices[4]);f.default.fromPoints(n.planes[4],n.vertices[2],n.vertices[0],n.vertices[3]);f.default.fromPoints(n.planes[0],n.vertices[7],n.vertices[5],n.vertices[6])});t.exports=i.default},{"../value-types":284,"./enums":148,"./plane":154}],150:[function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}var f,e,o,s,h,c,l,a,v,y,p,u;i.__esModule=!0;f={enums:!0,Triangle:!0,Aabb:!0,Ray:!0,intersect:!0,Sphere:!0,Obb:!0,Frustum:!0,Line:!0,Plane:!0};i.Plane=i.Line=i.Frustum=i.Obb=i.Sphere=i.intersect=i.Ray=i.Aabb=i.Triangle=i.enums=void 0;e=r(n("./enums"));i.enums=e.default;o=r(n("./triangle"));i.Triangle=o.default;s=r(n("./aabb"));i.Aabb=s.default;h=r(n("./ray"));i.Ray=h.default;c=r(n("./intersect"));i.intersect=c.default;l=r(n("./sphere"));i.Sphere=l.default;a=r(n("./obb"));i.Obb=a.default;v=r(n("./frustum"));i.Frustum=v.default;y=r(n("./line"));i.Line=y.default;p=r(n("./plane"));i.Plane=p.default;u=n("./distance");Object.keys(u).forEach(function(n){"default"!==n&&"__esModule"!==n&&(Object.prototype.hasOwnProperty.call(f,n)||n in i&&i[n]===u[n]||(i[n]=u[n]))});cc.geomUtils=t.exports},{"./aabb":146,"./distance":147,"./enums":148,"./frustum":149,"./intersect":151,"./line":152,"./obb":153,"./plane":154,"./ray":155,"./sphere":156,"./triangle":157}],151:[function(n,t,i){"use strict";function at(){if("function"!=typeof WeakMap)return null;var n=new WeakMap;return at=function(){return n},n}function e(n){return n&&n.__esModule?n:{"default":n}}function ki(n,t,i){r.Vec3.set(i[0],n.x,t.y,t.z);r.Vec3.set(i[1],n.x,t.y,n.z);r.Vec3.set(i[2],n.x,n.y,t.z);r.Vec3.set(i[3],n.x,n.y,n.z);r.Vec3.set(i[4],t.x,t.y,t.z);r.Vec3.set(i[5],t.x,t.y,n.z);r.Vec3.set(i[6],t.x,n.y,t.z);r.Vec3.set(i[7],t.x,n.y,n.z)}function st(n,t,i,u,f,e){r.Vec3.set(e[0],n.x+i.x*t.x+u.x*t.y+f.x*t.z,n.y+i.y*t.x+u.y*t.y+f.y*t.z,n.z+i.z*t.x+u.z*t.y+f.z*t.z);r.Vec3.set(e[1],n.x-i.x*t.x+u.x*t.y+f.x*t.z,n.y-i.y*t.x+u.y*t.y+f.y*t.z,n.z-i.z*t.x+u.z*t.y+f.z*t.z);r.Vec3.set(e[2],n.x+i.x*t.x-u.x*t.y+f.x*t.z,n.y+i.y*t.x-u.y*t.y+f.y*t.z,n.z+i.z*t.x-u.z*t.y+f.z*t.z);r.Vec3.set(e[3],n.x+i.x*t.x+u.x*t.y-f.x*t.z,n.y+i.y*t.x+u.y*t.y-f.y*t.z,n.z+i.z*t.x+u.z*t.y-f.z*t.z);r.Vec3.set(e[4],n.x-i.x*t.x-u.x*t.y-f.x*t.z,n.y-i.y*t.x-u.y*t.y-f.y*t.z,n.z-i.z*t.x-u.z*t.y-f.z*t.z);r.Vec3.set(e[5],n.x+i.x*t.x-u.x*t.y-f.x*t.z,n.y+i.y*t.x-u.y*t.y-f.y*t.z,n.z+i.z*t.x-u.z*t.y-f.z*t.z);r.Vec3.set(e[6],n.x-i.x*t.x+u.x*t.y-f.x*t.z,n.y-i.y*t.x+u.y*t.y-f.y*t.z,n.z-i.z*t.x+u.z*t.y-f.z*t.z);r.Vec3.set(e[7],n.x-i.x*t.x-u.x*t.y+f.x*t.z,n.y-i.y*t.x-u.y*t.y+f.y*t.z,n.z-i.z*t.x-u.z*t.y+f.z*t.z)}function nt(n,t){for(var u,i=r.Vec3.dot(t,n[0]),f=i,e=1;e<8;++e)u=r.Vec3.dot(t,n[e]),i=u<i?u:i,f=u>f?u:f;return[i,f]}var hi;i.__esModule=!0;i.default=void 0;var ut=e(n("../../renderer/gfx")),ci=e(n("../../renderer/memop/recycle-pool")),r=n("../value-types"),ct=e(n("./aabb")),lt=function(n){var t,i,f,r,u;if(n&&n.__esModule)return n;if(null===n||"object"!=typeof n&&"function"!=typeof n)return{"default":n};if(t=at(),t&&t.has(n))return t.get(n);i={};f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(u=f?Object.getOwnPropertyDescriptor(n,r):null,u&&(u.get||u.set)?Object.defineProperty(i,r,u):i[r]=n[r]);return i.default=n,t&&t.set(n,i),i}(n("./distance")),u=e(n("./enums")),li=e(n("./ray")),ai=e(n("./triangle"));var b,ft,o,s,k,et,d,h,ot,c,l,a,v,y,p,vi=function(){function i(n,t,i,u){r.Vec3.set(n,t[i*u],t[i*u+1],t[i*u+2])}var n=ai.default.create(),t=1/0;return function(r,u){var h,f,s;for(t=1/0,h=u._subMeshes,f=0;f<h.length;f++)if(h[f]._primitiveType===ut.default.PT_TRIANGLES)for(var a=u._subDatas[f]||u._subDatas[0],c=u._getAttrMeshData(f,ut.default.ATTR_POSITION),o=a.getIData(Uint16Array),l=a.vfm.element(ut.default.ATTR_POSITION).num,e=0;e<o.length;e+=3)i(n.a,c,o[e],l),i(n.b,c,o[e+1],l),i(n.c,c,o[e+2],l),s=g(r,n),s>0&&s<t&&(t=s);return t}}(),yi=function(){function f(n,t){for(var r=n.children,i=r.length-1;i>=0;i--)f(r[i],t);t(n)}function v(n,t){return n.distance-t.distance}function e(n,t,i){var r=i.m,f=t.x,e=t.y,o=t.z,u=r[3]*f+r[7]*e+r[11]*o;return u=u?1/u:1,n.x=(r[0]*f+r[4]*e+r[8]*o)*u,n.y=(r[1]*f+r[5]*e+r[9]*o)*u,n.z=(r[2]*f+r[6]*e+r[10]*o)*u,n}function a(n){return n>0&&n<1/0}var o=new ci.default(function(){return{distance:0,node:null}},1),t=[],s=ct.default.create(),h=new r.Vec3,c=new r.Vec3,n=new li.default,l=cc.mat4(),u=cc.mat4(),i=new r.Vec3;return function(y,p,b,k){return o.reset(),t.length=0,f(y=y||cc.director.getScene(),function(f){var v,d,y;(!k||k(f))&&(r.Mat4.invert(u,f.getWorldMatrix(l)),r.Vec3.transformMat4(n.o,p.o,u),r.Vec3.normalize(n.d,e(n.d,p.d,u)),v=1/0,d=f._renderComponent,(d instanceof cc.MeshRenderer?v=w(n,d._boundingBox):f.width&&f.height&&(r.Vec3.set(h,-f.width*f.anchorX,-f.height*f.anchorY,f.z),r.Vec3.set(c,f.width*(1-f.anchorX),f.height*(1-f.anchorY),f.z),ct.default.fromPoints(s,h,c),v=w(n,s)),a(v)&&(b&&(v=b(n,f,v)),a(v)))&&(r.Vec3.scale(i,n.d,v),e(i,i,l),y=o.add(),y.node=f,y.distance=r.Vec3.mag(i),t.push(y)))}),t.sort(v),t}}(),vt=(b=new r.Vec3(0,0,0),function(n,t){var u=r.Vec3.dot(n.d,t.n),i;return Math.abs(u)<Number.EPSILON?0:(r.Vec3.multiplyScalar(b,t.n,t.d),i=r.Vec3.dot(r.Vec3.subtract(b,b,n.o),t.n)/u,i<0?0:i)}),yt=(ft=new r.Vec3(0,0,0),function(n,t){r.Vec3.subtract(ft,n.e,n.s);var i=(t.d-r.Vec3.dot(n.s,t.n))/r.Vec3.dot(ft,t.n);return i<0||i>1?0:i}),g=function(){var n=new r.Vec3(0,0,0),t=new r.Vec3(0,0,0),i=new r.Vec3(0,0,0),u=new r.Vec3(0,0,0),f=new r.Vec3(0,0,0);return function(e,o,s){var h,c,l,a,v;return(r.Vec3.subtract(n,o.b,o.a),r.Vec3.subtract(t,o.c,o.a),r.Vec3.cross(i,e.d,t),h=r.Vec3.dot(n,i),h<Number.EPSILON&&(!s||h>-Number.EPSILON))?0:(c=1/h,r.Vec3.subtract(u,e.o,o.a),l=r.Vec3.dot(u,i)*c,l<0||l>1)?0:(r.Vec3.cross(f,u,n),a=r.Vec3.dot(e.d,f)*c,a<0||l+a>1)?0:(v=r.Vec3.dot(t,f)*c,v<0?0:v)}}(),pi=g,pt=function(){var n=new r.Vec3(0,0,0),t=new r.Vec3(0,0,0),i=new r.Vec3(0,0,0),u=new r.Vec3(0,0,0),f=new r.Vec3(0,0,0),e=new r.Vec3(0,0,0);return function(o,s,h){var a,y,c,l,p,v;return(r.Vec3.subtract(n,s.b,s.a),r.Vec3.subtract(t,s.c,s.a),r.Vec3.subtract(i,o.s,o.e),r.Vec3.cross(f,n,t),a=r.Vec3.dot(i,f),a<=0)?0:(r.Vec3.subtract(u,o.s,s.a),y=r.Vec3.dot(u,f),y<0||y>a)?0:(r.Vec3.cross(e,i,u),c=r.Vec3.dot(t,e),c<0||c>a)?0:(l=-r.Vec3.dot(n,e),l<0||c+l>a)?0:(h&&(p=1/a,v=1-(c*=p)-(l*=p),r.Vec3.set(h,s.a.x*v+s.b.x*c+s.c.x*l,s.a.y*v+s.b.y*c+s.c.y*l,s.a.z*v+s.b.z*c+s.c.z*l)),1)}}(),wi=(o=new r.Vec3(0,0,0),s=new r.Vec3(0,0,0),k=new r.Vec3(0,0,0),et=new r.Vec3(0,0,0),d=new r.Vec3(0,0,0),h=new r.Vec3(0,0,0),ot=new r.Vec3(0,0,0),function(n,t,i,u,f,e,c){var l,a,v,w,y,p,b;if(r.Vec3.subtract(o,t,n),r.Vec3.subtract(s,i,n),r.Vec3.subtract(k,u,n),r.Vec3.subtract(et,f,n),r.Vec3.cross(h,et,o),l=r.Vec3.dot(s,h),l>=0){if((a=-r.Vec3.dot(k,h),a<0)||(v=r.Vec3.dot(r.Vec3.cross(ot,o,k),s),v<0))return 0;c&&(w=1/(a+l+v),a*=w,l*=w,v*=w,r.Vec3.set(c,i.x*a+u.x*l+f.x*v,i.y*a+u.y*l+f.y*v,i.z*a+u.z*l+f.z*v))}else{if((r.Vec3.subtract(d,e,n),y=r.Vec3.dot(d,h),y<0)||(p=r.Vec3.dot(r.Vec3.cross(ot,o,s),d),p<0))return 0;c&&(b=1/(y+(l=-l)+p),y*=b,l*=b,p*=b,r.Vec3.set(c,i.x*y+e.x*l+f.x*p,i.y*y+e.y*l+f.y*p,i.z*y+e.z*l+f.z*p))}return 1}),wt=function(){var n=new r.Vec3(0,0,0);return function(t,i){var o=i.radius,l=i.center,a=t.o,v=t.d,s=o*o,f,e;r.Vec3.subtract(n,l,a);var h=n.lengthSqr(),u=r.Vec3.dot(n,v),c=s-(h-u*u);return c<0?0:(f=Math.sqrt(c),e=h<s?u+f:u-f,e<0?0:e)}}(),w=(c=new r.Vec3,l=new r.Vec3,function(n,t){var i=n.o,u=n.d,f=1/u.x,e=1/u.y,o=1/u.z;r.Vec3.subtract(c,t.center,t.halfExtents);r.Vec3.add(l,t.center,t.halfExtents);var s=(c.x-i.x)*f,h=(l.x-i.x)*f,a=(c.y-i.y)*e,v=(l.y-i.y)*e,y=(c.z-i.z)*o,p=(l.z-i.z)*o,w=Math.max(Math.max(Math.min(s,h),Math.min(a,v)),Math.min(y,p)),b=Math.min(Math.min(Math.max(s,h),Math.max(a,v)),Math.max(y,p));return b<0||w>b?0:w}),bi=w,bt=function(){var c=new r.Vec3,l=new r.Vec3,f=new r.Vec3,o=new r.Vec3,s=new r.Vec3,h=new r.Vec3,e=new r.Vec3,t=new Array(3),i=new Array(3),u=new Array(3),n=new Array(6);return function(a,v){var p,y,w,b;for(t[0]=v.halfExtents.x,t[1]=v.halfExtents.y,t[2]=v.halfExtents.z,c=v.center,l=a.o,f=a.d,p=v.orientation.m,r.Vec3.set(o,p[0],p[1],p[2]),r.Vec3.set(s,p[3],p[4],p[5]),r.Vec3.set(h,p[6],p[7],p[8]),r.Vec3.subtract(e,c,l),i[0]=r.Vec3.dot(o,f),i[1]=r.Vec3.dot(s,f),i[2]=r.Vec3.dot(h,f),u[0]=r.Vec3.dot(o,e),u[1]=r.Vec3.dot(s,e),u[2]=r.Vec3.dot(h,e),y=0;y<3;++y){if(0===i[y]){if(-u[y]-t[y]>0||-u[y]+t[y]<0)return 0;i[y]=1e-7}n[2*y+0]=(u[y]+t[y])/i[y];n[2*y+1]=(u[y]-t[y])/i[y]}return w=Math.max(Math.max(Math.min(n[0],n[1]),Math.min(n[2],n[3])),Math.min(n[4],n[5])),b=Math.min(Math.min(Math.max(n[0],n[1]),Math.max(n[2],n[3])),Math.max(n[4],n[5])),b<0||w>b||w<0?0:w}}(),kt=(a=new r.Vec3,v=new r.Vec3,y=new r.Vec3,p=new r.Vec3,function(n,t){return r.Vec3.subtract(a,n.center,n.halfExtents),r.Vec3.add(v,n.center,n.halfExtents),r.Vec3.subtract(y,t.center,t.halfExtents),r.Vec3.add(p,t.center,t.halfExtents),a.x<=p.x&&v.x>=y.x&&a.y<=p.y&&v.y>=y.y&&a.z<=p.z&&v.z>=y.z});var tt,dt=function(){for(var e,o,n=new Array(15),t=0;t<15;t++)n[t]=new r.Vec3(0,0,0);for(var u=new Array(8),f=new Array(8),i=0;i<8;i++)u[i]=new r.Vec3(0,0,0),f[i]=new r.Vec3(0,0,0);return e=new r.Vec3,o=new r.Vec3,function(t,i){var s=i.orientation.m,h,c,l,a;for(r.Vec3.set(n[0],1,0,0),r.Vec3.set(n[1],0,1,0),r.Vec3.set(n[2],0,0,1),r.Vec3.set(n[3],s[0],s[1],s[2]),r.Vec3.set(n[4],s[3],s[4],s[5]),r.Vec3.set(n[5],s[6],s[7],s[8]),h=0;h<3;++h)r.Vec3.cross(n[6+3*h],n[h],n[0]),r.Vec3.cross(n[7+3*h],n[h],n[1]),r.Vec3.cross(n[7+3*h],n[h],n[2]);for(r.Vec3.subtract(e,t.center,t.halfExtents),r.Vec3.add(o,t.center,t.halfExtents),ki(e,o,u),st(i.center,i.halfExtents,n[3],n[4],n[5],f),c=0;c<15;++c)if(l=nt(u,n[c]),a=nt(f,n[c]),a[0]>l[1]||l[0]>a[1])return 0;return 1}}(),it=function(n,t){var i=n.halfExtents.x*Math.abs(t.n.x)+n.halfExtents.y*Math.abs(t.n.y)+n.halfExtents.z*Math.abs(t.n.z),u=r.Vec3.dot(t.n,n.center);return u+i<t.d?-1:u-i>t.d?0:1},gt=function(n,t){for(var i=0;i<t.planes.length;i++)if(-1===it(n,t.planes[i]))return 0;return 1},ni=function(){for(var n=new Array(8),t=0,i=0,u=0;u<n.length;u++)n[u]=new r.Vec3(0,0,0);return function(u,f){for(var e,o,s,h,l=0,a=!1,c=0;c<f.planes.length;c++){if(-1===(l=it(u,f.planes[c])))return 0;1===l&&(a=!0)}if(!a)return 1;for(e=0;e<f.vertices.length;e++)r.Vec3.subtract(n[e],f.vertices[e],u.center);for(t=0,i=0,o=0;o<f.vertices.length;o++)n[o].x>u.halfExtents.x?t++:n[o].x<-u.halfExtents.x&&i++;if(t===f.vertices.length||i===f.vertices.length)return 0;for(t=0,i=0,s=0;s<f.vertices.length;s++)n[s].y>u.halfExtents.y?t++:n[s].y<-u.halfExtents.y&&i++;if(t===f.vertices.length||i===f.vertices.length)return 0;for(t=0,i=0,h=0;h<f.vertices.length;h++)n[h].z>u.halfExtents.z?t++:n[h].z<-u.halfExtents.z&&i++;return t===f.vertices.length||i===f.vertices.length?0:1}}(),di=function(){var n=new r.Vec3(0,0,0),t=new r.Mat3;return function(i,u){return r.Vec3.subtract(n,u,i.center),r.Vec3.transformMat3(n,n,r.Mat3.transpose(t,i.orientation)),f=n,e=i.halfExtents,Math.abs(f.x)<e.x&&Math.abs(f.y)<e.y&&Math.abs(f.z)<e.z;var f,e}}(),rt=(tt=function(n,t,i,r){return Math.abs(n.x*t+n.y*i+n.z*r)},function(n,t){var i=n.orientation.m,u=n.halfExtents.x*tt(t.n,i[0],i[1],i[2])+n.halfExtents.y*tt(t.n,i[3],i[4],i[5])+n.halfExtents.z*tt(t.n,i[6],i[7],i[8]),f=r.Vec3.dot(t.n,n.center);return f+u<t.d?-1:f-u>t.d?0:1}),ti=function(n,t){for(var i=0;i<t.planes.length;i++)if(-1===rt(n,t.planes[i]))return 0;return 1},ii=function(){for(var f,i=new Array(8),u=0,n=0,t=0,e=0;e<i.length;e++)i[e]=new r.Vec3(0,0,0);return f=function(n,t,i,r){return n.x*t+n.y*i+n.z*r},function(e,o){for(var h,s,c,l,a,y=0,p=!1,v=0;v<o.planes.length;v++){if(-1===(y=rt(e,o.planes[v])))return 0;1===y&&(p=!0)}if(!p)return 1;for(h=0;h<o.vertices.length;h++)r.Vec3.subtract(i[h],o.vertices[h],e.center);for(n=0,t=0,s=e.orientation.m,c=0;c<o.vertices.length;c++)(u=f(i[c],s[0],s[1],s[2]))>e.halfExtents.x?n++:u<-e.halfExtents.x&&t++;if(n===o.vertices.length||t===o.vertices.length)return 0;for(n=0,t=0,l=0;l<o.vertices.length;l++)(u=f(i[l],s[3],s[4],s[5]))>e.halfExtents.y?n++:u<-e.halfExtents.y&&t++;if(n===o.vertices.length||t===o.vertices.length)return 0;for(n=0,t=0,a=0;a<o.vertices.length;a++)(u=f(i[a],s[6],s[7],s[8]))>e.halfExtents.z?n++:u<-e.halfExtents.z&&t++;return n===o.vertices.length||t===o.vertices.length?0:1}}(),ri=function(){for(var n=new Array(15),t=0;t<15;t++)n[t]=new r.Vec3(0,0,0);for(var u=new Array(8),f=new Array(8),i=0;i<8;i++)u[i]=new r.Vec3(0,0,0),f[i]=new r.Vec3(0,0,0);return function(t,i){var e=t.orientation.m,o=i.orientation.m,s,h,c,l;for(r.Vec3.set(n[0],e[0],e[1],e[2]),r.Vec3.set(n[1],e[3],e[4],e[5]),r.Vec3.set(n[2],e[6],e[7],e[8]),r.Vec3.set(n[3],o[0],o[1],o[2]),r.Vec3.set(n[4],o[3],o[4],o[5]),r.Vec3.set(n[5],o[6],o[7],o[8]),s=0;s<3;++s)r.Vec3.cross(n[6+3*s],n[s],n[0]),r.Vec3.cross(n[7+3*s],n[s],n[1]),r.Vec3.cross(n[7+3*s],n[s],n[2]);for(st(t.center,t.halfExtents,n[0],n[1],n[2],u),st(i.center,i.halfExtents,n[3],n[4],n[5],f),h=0;h<15;++h)if(c=nt(u,n[h]),l=nt(f,n[h]),l[0]>c[1]||c[0]>l[1])return 0;return 1}}(),ht=function(n,t){var i=r.Vec3.dot(t.n,n.center),u=n.radius*t.n.length();return i+u<t.d?-1:i-u>t.d?0:1},ui=function(n,t){for(var i=0;i<t.planes.length;i++)if(-1===ht(n,t.planes[i]))return 0;return 1},fi=function(){var n=new r.Vec3(0,0,0),t=[1,-1,1,-1,1,-1];return function(i,u){for(var e,s,f=0;f<6;f++){var h=u.planes[f],o=i.radius,c=i.center,l=h.n,a=h.d,v=r.Vec3.dot(l,c);if(v+o<a)return 0;if(!(v-o>a))for(r.Vec3.add(n,c,r.Vec3.multiplyScalar(n,l,o)),e=0;e<6;e++)if(e!==f&&e!==f+t[f]&&(s=u.planes[e],r.Vec3.dot(s.n,n)<s.d))return 0}return 1}}(),ei=function(n,t){var i=n.radius+t.radius;return r.Vec3.squaredDistance(n.center,t.center)<i*i},oi=function(){var n=new r.Vec3;return function(t,i){return lt.pt_point_aabb(n,t.center,i),r.Vec3.squaredDistance(t.center,n)<t.radius*t.radius}}(),si=function(){var n=new r.Vec3;return function(t,i){return lt.pt_point_obb(n,t.center,i),r.Vec3.squaredDistance(t.center,n)<t.radius*t.radius}}(),f={rayAabb:bi,rayMesh:vi,raycast:yi,rayTriangle:pi,ray_sphere:wt,ray_aabb:w,ray_obb:bt,ray_plane:vt,ray_triangle:g,line_plane:yt,line_triangle:pt,line_quad:wi,sphere_sphere:ei,sphere_aabb:oi,sphere_obb:si,sphere_plane:ht,sphere_frustum:ui,sphere_frustum_accurate:fi,aabb_aabb:kt,aabb_obb:dt,aabb_plane:it,aabb_frustum:gt,aabb_frustum_accurate:ni,obb_obb:ri,obb_plane:rt,obb_frustum:ti,obb_frustum_accurate:ii,obb_point:di,resolve:function(n,t,i){void 0===i&&(i=null);var r=n._type,u=t._type,f=this[r|u];return r<u?f(n,t,i):f(t,n,i)}};f[u.default.SHAPE_RAY|u.default.SHAPE_SPHERE]=wt;f[u.default.SHAPE_RAY|u.default.SHAPE_AABB]=w;f[u.default.SHAPE_RAY|u.default.SHAPE_OBB]=bt;f[u.default.SHAPE_RAY|u.default.SHAPE_PLANE]=vt;f[u.default.SHAPE_RAY|u.default.SHAPE_TRIANGLE]=g;f[u.default.SHAPE_LINE|u.default.SHAPE_PLANE]=yt;f[u.default.SHAPE_LINE|u.default.SHAPE_TRIANGLE]=pt;f[u.default.SHAPE_SPHERE]=ei;f[u.default.SHAPE_SPHERE|u.default.SHAPE_AABB]=oi;f[u.default.SHAPE_SPHERE|u.default.SHAPE_OBB]=si;f[u.default.SHAPE_SPHERE|u.default.SHAPE_PLANE]=ht;f[u.default.SHAPE_SPHERE|u.default.SHAPE_FRUSTUM]=ui;f[u.default.SHAPE_SPHERE|u.default.SHAPE_FRUSTUM_ACCURATE]=fi;f[u.default.SHAPE_AABB]=kt;f[u.default.SHAPE_AABB|u.default.SHAPE_OBB]=dt;f[u.default.SHAPE_AABB|u.default.SHAPE_PLANE]=it;f[u.default.SHAPE_AABB|u.default.SHAPE_FRUSTUM]=gt;f[u.default.SHAPE_AABB|u.default.SHAPE_FRUSTUM_ACCURATE]=ni;f[u.default.SHAPE_OBB]=ri;f[u.default.SHAPE_OBB|u.default.SHAPE_PLANE]=rt;f[u.default.SHAPE_OBB|u.default.SHAPE_FRUSTUM]=ti;f[u.default.SHAPE_OBB|u.default.SHAPE_FRUSTUM_ACCURATE]=ii;hi=f;i.default=hi;t.exports=i.default},{"../../renderer/gfx":317,"../../renderer/memop/recycle-pool":332,"../value-types":284,"./aabb":146,"./distance":147,"./enums":148,"./ray":155,"./triangle":157}],152:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var u,r=n("../value-types"),f=(u=n("./enums"))&&u.__esModule?u:{"default":u},e=function(){function n(n,t,i,u,e,o){void 0===n&&(n=0);void 0===t&&(t=0);void 0===i&&(i=0);void 0===u&&(u=0);void 0===e&&(e=0);void 0===o&&(o=-1);this.s=void 0;this.e=void 0;this._type=void 0;this._type=f.default.SHAPE_LINE;this.s=new r.Vec3(n,t,i);this.e=new r.Vec3(u,e,o)}return n.create=function(t,i,r,u,f,e){return new n(t,i,r,u,f,e)},n.clone=function(t){return new n(t.s.x,t.s.y,t.s.z,t.e.x,t.e.y,t.e.z)},n.copy=function(n,t){return r.Vec3.copy(n.s,t.s),r.Vec3.copy(n.e,t.e),n},n.fromPoints=function(n,t,i){return r.Vec3.copy(n.s,t),r.Vec3.copy(n.e,i),n},n.set=function(n,t,i,r,u,f,e){return n.s.x=t,n.s.y=i,n.s.z=r,n.e.x=u,n.e.y=f,n.e.z=e,n},n.len=function(n){return r.Vec3.distance(n.s,n.e)},n.prototype.length=function(){return r.Vec3.distance(this.s,this.e)},n}();i.default=e;t.exports=i.default},{"../value-types":284,"./enums":148}],153:[function(n,t,i){"use strict";function s(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}var u,r,e;i.__esModule=!0;i.default=void 0;r=n("../value-types");e=(u=n("./enums"))&&u.__esModule?u:{"default":u};var f=new r.Vec3,h=new r.Vec3,o=new r.Mat3,c=function(){function n(n,t,i,u,f,o,s,h,c,l,a,v,y,p,w){void 0===n&&(n=0);void 0===t&&(t=0);void 0===i&&(i=0);void 0===u&&(u=1);void 0===f&&(f=1);void 0===o&&(o=1);void 0===s&&(s=1);void 0===h&&(h=0);void 0===c&&(c=0);void 0===l&&(l=0);void 0===a&&(a=1);void 0===v&&(v=0);void 0===y&&(y=0);void 0===p&&(p=0);void 0===w&&(w=1);this.center=void 0;this.halfExtents=void 0;this.orientation=void 0;this._type=void 0;this._type=e.default.SHAPE_OBB;this.center=new r.Vec3(n,t,i);this.halfExtents=new r.Vec3(u,f,o);this.orientation=new r.Mat3(s,h,c,l,a,v,y,p,w)}var i,u,t;return n.create=function(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){return new n(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p)},n.clone=function(t){var i=t.orientation.m;return new n(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z,i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8])},n.copy=function(n,t){return r.Vec3.copy(n.center,t.center),r.Vec3.copy(n.halfExtents,t.halfExtents),r.Mat3.copy(n.orientation,t.orientation),n},n.fromPoints=function(n,t,i){return r.Vec3.multiplyScalar(n.center,r.Vec3.add(f,t,i),.5),r.Vec3.multiplyScalar(n.halfExtents,r.Vec3.subtract(h,i,t),.5),r.Mat3.identity(n.orientation),n},n.set=function(n,t,i,u,f,e,o,s,h,c,l,a,v,y,p,w){return r.Vec3.set(n.center,t,i,u),r.Vec3.set(n.halfExtents,f,e,o),r.Mat3.set(n.orientation,s,h,c,l,a,v,y,p,w),n},i=n,(u=[{key:"type",get:function(){return this._type}}])&&s(i.prototype,u),t=n.prototype,t.getBoundary=function(n,t){var e,s,h,i,u;e=f;s=this.halfExtents;h=this.orientation;i=o.m;u=h.m;i[0]=Math.abs(u[0]);i[1]=Math.abs(u[1]);i[2]=Math.abs(u[2]);i[3]=Math.abs(u[3]);i[4]=Math.abs(u[4]);i[5]=Math.abs(u[5]);i[6]=Math.abs(u[6]);i[7]=Math.abs(u[7]);i[8]=Math.abs(u[8]);r.Vec3.transformMat3(e,s,o);r.Vec3.subtract(n,this.center,f);r.Vec3.add(t,this.center,f)},t.transform=function(n,t,i,u,f){r.Vec3.transformMat4(f.center,this.center,n);r.Mat3.fromQuat(f.orientation,i);r.Vec3.multiply(f.halfExtents,this.halfExtents,u)},t.translateAndRotate=function(n,t,i){r.Vec3.transformMat4(i.center,this.center,n);r.Mat3.fromQuat(i.orientation,t)},t.setScale=function(n,t){r.Vec3.multiply(t.halfExtents,this.halfExtents,n)},n}();i.default=c;t.exports=i.default},{"../value-types":284,"./enums":148}],154:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var f,r=n("../value-types"),h=(f=n("./enums"))&&f.__esModule?f:{"default":f},o=new r.Vec3(0,0,0),s=new r.Vec3(0,0,0),e=cc.mat4(),u=cc.v4(),c=function(){function n(n,t,i,u){void 0===n&&(n=0);void 0===t&&(t=1);void 0===i&&(i=0);void 0===u&&(u=0);this.n=void 0;this.d=void 0;this._type=void 0;this._type=h.default.SHAPE_PLANE;this.n=new r.Vec3(n,t,i);this.d=u}return n.create=function(t,i,r,u){return new n(t,i,r,u)},n.clone=function(t){return new n(t.n.x,t.n.y,t.n.z,t.d)},n.copy=function(n,t){return r.Vec3.copy(n.n,t.n),n.d=t.d,n},n.fromPoints=function(n,t,i,u){return r.Vec3.subtract(o,i,t),r.Vec3.subtract(s,u,t),r.Vec3.normalize(n.n,r.Vec3.cross(n.n,o,s)),n.d=r.Vec3.dot(n.n,t),n},n.set=function(n,t,i,r,u){return n.n.x=t,n.n.y=i,n.n.z=r,n.d=u,n},n.fromNormalAndPoint=function(n,t,i){return r.Vec3.copy(n.n,t),n.d=r.Vec3.dot(t,i),n},n.normalize=function(n,t){var i=t.n.len();return r.Vec3.normalize(n.n,t.n),i>0&&(n.d=t.d/i),n},n.prototype.transform=function(n){r.Mat4.invert(e,n);r.Mat4.transpose(e,e);r.Vec4.set(u,this.n.x,this.n.y,this.n.z,this.d);r.Vec4.transformMat4(u,u,e);r.Vec3.set(this.n,u.x,u.y,u.z);this.d=u.w},n}();i.default=c;t.exports=i.default},{"../value-types":284,"./enums":148}],155:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var u,r=n("../value-types"),f=(u=n("./enums"))&&u.__esModule?u:{"default":u},e=function(){function n(n,t,i,u,e,o){void 0===n&&(n=0);void 0===t&&(t=0);void 0===i&&(i=0);void 0===u&&(u=0);void 0===e&&(e=0);void 0===o&&(o=-1);this.o=void 0;this.d=void 0;this._type=void 0;this._type=f.default.SHAPE_RAY;this.o=new r.Vec3(n,t,i);this.d=new r.Vec3(u,e,o)}return n.create=function(t,i,r,u,f,e){return void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===u&&(u=0),void 0===f&&(f=0),void 0===e&&(e=1),new n(t,i,r,u,f,e)},n.clone=function(t){return new n(t.o.x,t.o.y,t.o.z,t.d.x,t.d.y,t.d.z)},n.copy=function(n,t){return r.Vec3.copy(n.o,t.o),r.Vec3.copy(n.d,t.d),n},n.fromPoints=function(n,t,i){return r.Vec3.copy(n.o,t),r.Vec3.normalize(n.d,r.Vec3.subtract(n.d,i,t)),n},n.set=function(n,t,i,r,u,f,e){return n.o.x=t,n.o.y=i,n.o.z=r,n.d.x=u,n.d.y=f,n.d.z=e,n},n.prototype.computeHit=function(n,t){r.Vec3.normalize(n,this.d);r.Vec3.scaleAndAdd(n,this.o,n,t)},n}();i.default=e;t.exports=i.default},{"../value-types":284,"./enums":148}],156:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var u,r=n("../value-types"),e=(u=n("./enums"))&&u.__esModule?u:{"default":u},f=new r.Vec3,o=function(){function n(n,t,i,u){void 0===n&&(n=0);void 0===t&&(t=0);void 0===i&&(i=0);void 0===u&&(u=1);this.center=void 0;this.radius=void 0;this._type=void 0;this._type=e.default.SHAPE_SPHERE;this.center=new r.Vec3(n,t,i);this.radius=u}n.create=function(t,i,r,u){return new n(t,i,r,u)};n.clone=function(t){return new n(t.center.x,t.center.y,t.center.z,t.radius)};n.copy=function(n,t){return r.Vec3.copy(n.center,t.center),n.radius=t.radius,n};n.fromPoints=function(n,t,i){return r.Vec3.multiplyScalar(n.center,r.Vec3.add(f,t,i),.5),n.radius=.5*r.Vec3.subtract(f,i,t).len(),n};n.set=function(n,t,i,r,u){return n.center.x=t,n.center.y=i,n.center.z=r,n.radius=u,n};var t=n.prototype;return t.clone=function(){return n.clone(this)},t.copy=function(t){return n.copy(this,t)},t.getBoundary=function(n,t){r.Vec3.set(n,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius);r.Vec3.set(t,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius)},t.transform=function(n,t,i,u,f){r.Vec3.transformMat4(f.center,this.center,n);f.radius=this.radius*u.maxAxis()},t.translateAndRotate=function(n,t,i){r.Vec3.transformMat4(i.center,this.center,n)},t.setScale=function(n,t){t.radius=this.radius*n.maxAxis()},n}();i.default=o;t.exports=i.default},{"../value-types":284,"./enums":148}],157:[function(n,t,i){"use strict";function f(n){return n&&n.__esModule?n:{"default":n}}var r,u,e;i.__esModule=!0;i.default=void 0;r=f(n("../value-types/vec3"));u=f(n("./enums"));e=function(){function n(n,t,i,f,e,o,s,h,c){this.a=void 0;this.b=void 0;this.c=void 0;this._type=void 0;this.a=new r.default(n,t,i);this.b=new r.default(f,e,o);this.c=new r.default(s,h,c);this._type=u.default.SHAPE_TRIANGLE}return n.create=function(t,i,r,u,f,e,o,s,h){return new n(t,i,r,u,f,e,o,s,h)},n.clone=function(t){return new n(t.a.x,t.a.y,t.a.z,t.b.x,t.b.y,t.b.z,t.c.x,t.c.y,t.c.z)},n.copy=function(n,t){return r.default.copy(n.a,t.a),r.default.copy(n.b,t.b),r.default.copy(n.c,t.c),n},n.fromPoints=function(n,t,i,u){return r.default.copy(n.a,t),r.default.copy(n.b,i),r.default.copy(n.c,u),n},n.set=function(n,t,i,r,u,f,e,o,s,h){return n.a.x=t,n.a.y=i,n.a.z=r,n.b.x=u,n.b.y=f,n.b.z=e,n.c.x=o,n.c.y=s,n.c.z=h,n},n}();i.default=e;t.exports=i.default},{"../value-types/vec3":294,"./enums":148}],158:[function(n,t){"use strict";var e=n("../components/CCRenderComponent"),o=n("../assets/material/CCMaterial"),i=n("./types"),r=i.LineCap,u=i.LineJoin,f=cc.Class({name:"cc.Graphics","extends":e,editor:!1,ctor:function(){this._impl=new f._Impl(this)},properties:{_lineWidth:2,_strokeColor:cc.Color.BLACK,_lineJoin:u.MITER,_lineCap:r.BUTT,_fillColor:cc.Color.WHITE,_miterLimit:10,lineWidth:{get:function(){return this._lineWidth},set:function(n){this._lineWidth=n;this._impl.lineWidth=n}},lineJoin:{get:function(){return this._lineJoin},set:function(n){this._lineJoin=n;this._impl.lineJoin=n},type:u},lineCap:{get:function(){return this._lineCap},set:function(n){this._lineCap=n;this._impl.lineCap=n},type:r},strokeColor:{get:function(){return this._strokeColor},set:function(n){this._impl.strokeColor=this._strokeColor=cc.color(n)}},fillColor:{get:function(){return this._fillColor},set:function(n){this._impl.fillColor=this._fillColor=cc.color(n)}},miterLimit:{get:function(){return this._miterLimit},set:function(n){this._miterLimit=n;this._impl.miterLimit=n}}},statics:{LineJoin:u,LineCap:r},onRestore:function(){this._impl||(this._impl=new f._Impl(this))},onDestroy:function(){this.clear(!0);this._super();this._impl=null},_getDefaultMaterial:function(){return o.getBuiltinMaterial("2d-graphics")},_updateMaterial:function(){var n=this._materials[0];n&&(void 0!==n.getDefine("CC_USE_MODEL")&&n.define("CC_USE_MODEL",!0),void 0!==n.getDefine("CC_SUPPORT_standard_derivatives")&&cc.sys.glExtension("OES_standard_derivatives")&&n.define("CC_SUPPORT_standard_derivatives",!0))},moveTo:function(n,t){this._impl.moveTo(n,t)},lineTo:function(n,t){this._impl.lineTo(n,t)},bezierCurveTo:function(n,t,i,r,u,f){this._impl.bezierCurveTo(n,t,i,r,u,f)},quadraticCurveTo:function(n,t,i,r){this._impl.quadraticCurveTo(n,t,i,r)},arc:function(n,t,i,r,u,f){this._impl.arc(n,t,i,r,u,f)},ellipse:function(n,t,i,r){this._impl.ellipse(n,t,i,r)},circle:function(n,t,i){this._impl.circle(n,t,i)},rect:function(n,t,i,r){this._impl.rect(n,t,i,r)},roundRect:function(n,t,i,r,u){this._impl.roundRect(n,t,i,r,u)},fillRect:function(n,t,i,r){this.rect(n,t,i,r);this.fill()},clear:function(n){this._impl.clear(n);this._assembler&&this._assembler.clear(n)},close:function(){this._impl.close()},stroke:function(){this._assembler||this._resetAssembler();this._assembler.stroke(this)},fill:function(){this._assembler||this._resetAssembler();this._assembler.fill(this)}});cc.Graphics=t.exports=f;cc.Graphics.Types=i;cc.Graphics.Helper=n("./helper")},{"../assets/material/CCMaterial":80,"../components/CCRenderComponent":115,"./helper":159,"./types":161}],159:[function(n,t){"use strict";var h=n("./types").PointFlags,u=Math.PI,f=Math.min,c=Math.max,e=Math.cos,o=Math.sin,r=Math.abs,s=Math.sign,i=.5522847493;t.exports={arc:function(n,t,i,s,h,l,a){var nt,y,k,tt=0,v=0,p=0,it=0,rt=0,w=0,b=0,d=0,g=0,ut=0,ft=0,et=0,ot=0;if(v=l-h,a=a||!1)if(r(v)>=2*u)v=2*u;else for(;v<0;)v+=2*u;else if(r(v)>=2*u)v=2*-u;else for(;v>0;)v-=2*u;for(k=0|c(1,f(r(v)/(.5*u)+.5,5)),p=r(4/3*(1-e(nt=v/k/2))/o(nt)),a||(p=-p),y=0;y<=k;y++)w=t+(it=e(tt=h+v*(y/k)))*s,b=i+(rt=o(tt))*s,d=-rt*s*p,g=it*s*p,0===y?n.moveTo(w,b):n.bezierCurveTo(ut+et,ft+ot,w-d,b-g,w,b),ut=w,ft=b,et=d,ot=g},ellipse:function(n,t,r,u,f){n.moveTo(t-u,r);n.bezierCurveTo(t-u,r+f*i,t-u*i,r+f,t,r+f);n.bezierCurveTo(t+u*i,r+f,t+u,r+f*i,t+u,r);n.bezierCurveTo(t+u,r-f*i,t+u*i,r-f,t,r-f);n.bezierCurveTo(t-u*i,r-f,t-u,r-f*i,t-u,r);n.close()},roundRect:function(n,t,u,e,o,h){if(h<.1)n.rect(t,u,e,o);else{var l=f(h,.5*r(e))*s(e),c=f(h,.5*r(o))*s(o);n.moveTo(t,u+c);n.lineTo(t,u+o-c);n.bezierCurveTo(t,u+o-c*(1-i),t+l*(1-i),u+o,t+l,u+o);n.lineTo(t+e-l,u+o);n.bezierCurveTo(t+e-l*(1-i),u+o,t+e,u+o-c*(1-i),t+e,u+o-c);n.lineTo(t+e,u+c);n.bezierCurveTo(t+e,u+c*(1-i),t+e-l*(1-i),u,t+e-l,u);n.lineTo(t+l,u);n.bezierCurveTo(t+l*(1-i),u,t,u+c*(1-i),t,u+c);n.close()}},tesselateBezier:function n(t,i,u,f,e,o,s,c,l,a,v){var g,nt,tt,it,w,b,k,d,rt,ut,ft,et,y,p,ot,st;a>10||(w=.5*(o+c),b=.5*(s+l),k=.5*((g=.5*(i+f))+(tt=.5*(f+o))),d=.5*((nt=.5*(u+e))+(it=.5*(e+s))),((ot=r((f-c)*(p=l-u)-(e-l)*(y=c-i)))+(st=r((o-c)*p-(s-l)*y)))*(ot+st)<t._tessTol*(y*y+p*p)?t._addPoint(c,l,0===v?v|h.PT_BEVEL:v):(n(t,i,u,g,nt,k,d,ft=.5*(k+(rt=.5*(tt+w))),et=.5*(d+(ut=.5*(it+b))),a+1,0),n(t,ft,et,rt,ut,w,b,c,l,a+1,v)))}}},{"./types":161}],160:[function(n){"use strict";n("./graphics")},{"./graphics":158}],161:[function(n,t){"use strict";var i=cc.Enum({BUTT:0,ROUND:1,SQUARE:2}),r=cc.Enum({BEVEL:0,ROUND:1,MITER:2}),u=cc.Enum({PT_CORNER:1,PT_LEFT:2,PT_BEVEL:4,PT_INNERBEVEL:8});t.exports={LineCap:i,LineJoin:r,PointFlags:u}},{}],162:[function(n){"use strict";n("./platform");n("./assets");n("./CCNode");n("./CCPrivateNode");n("./CCScene");n("./components");n("./graphics");n("./collider");n("./collider/CCIntersection");n("./physics");n("./camera/CCCamera");n("./geom-utils");n("./mesh");n("./3d");n("./base-ui/CCWidgetManager")},{"./3d":void 0,"./CCNode":29,"./CCPrivateNode":30,"./CCScene":31,"./assets":78,"./base-ui/CCWidgetManager":89,"./camera/CCCamera":90,"./collider":98,"./collider/CCIntersection":96,"./components":134,"./geom-utils":150,"./graphics":160,"./mesh":165,"./physics":180,"./platform":213}],163:[function(n,t){"use strict";function o(n){return n&&n.__esModule?n:{"default":n}}function l(n,t,i){n[t]=i._val}function a(n,t,i){n[t]=i.x;n[t+1]=i.y}function v(n,t,i){n[t]=i.x;n[t+1]=i.y;n[t+2]=i.z}var e=o(n("../../renderer/core/input-assembler")),i=o(n("../../renderer/gfx")),r=n("./mesh-data"),u=n("../renderer"),c=n("../event/event-target"),f,s={5120:"getInt8",5121:"getUint8",5122:"getInt16",5123:"getUint16",5124:"getInt32",5125:"getUint32",5126:"getFloat32"},y={5120:"setInt8",5121:"setUint8",5122:"setInt16",5123:"setUint16",5124:"setInt32",5125:"setUint32",5126:"setFloat32"},h=(f=new ArrayBuffer(2),new DataView(f).setInt16(0,256,!0),256===new Int16Array(f)[0]),p=cc.Class({name:"cc.Mesh","extends":cc.Asset,mixins:[c],properties:{_nativeAsset:{override:!0,get:function(){return this._buffer},set:function(n){this._buffer=ArrayBuffer.isView(n)?n.buffer:n;this.initWithBuffer()}},_vertexBundles:{"default":null,type:r.VertexBundle},_primitives:{"default":null,Primitive:r.Primitive},_minPos:cc.v3(),_maxPos:cc.v3(),subMeshes:{get:function(){return this._subMeshes},set:function(n){this._subMeshes=n}},subDatas:{get:function(){return this._subDatas}}},ctor:function(){this._subMeshes=[];this._subDatas=[];this.loaded=!1},initWithBuffer:function(){var f,t,y,p;for(this._subMeshes.length=0,f=this._primitives,t=0;t<f.length;t++){var o=f[t],c=o.data,l=new Uint8Array(this._buffer,c.offset,c.length),a=this._vertexBundles[o.vertexBundleIndices[0]],s=a.data,h=new i.default.VertexFormat(a.formats),v=new Uint8Array(this._buffer,s.offset,s.length),w=this._canVertexFormatBatch(h),n=new r.MeshData;n.vData=v;n.iData=l;n.vfm=h;n.offset=s.offset;n.canBatch=w;this._subDatas.push(n);y=new i.default.VertexBuffer(u.device,h,i.default.USAGE_STATIC,v);p=new i.default.IndexBuffer(u.device,o.indexUnit,i.default.USAGE_STATIC,l);this._subMeshes.push(new e.default(y,p))}this.loaded=!0;this.emit("load")},_canVertexFormatBatch:function(n){var t=n._attr2el[i.default.ATTR_POSITION];return!t||t.type===i.default.ATTR_TYPE_FLOAT32&&n._bytes%4==0},init:function(n,t,f,o){var c,s,l,h;void 0===f&&(f=!1);void 0===o&&(o=0);c=new Uint8Array(n._bytes*t);s=new r.MeshData;s.vData=c;s.vfm=n;s.vDirty=!0;s.canBatch=this._canVertexFormatBatch(n);l=new i.default.VertexBuffer(u.device,n,f?i.default.USAGE_DYNAMIC:i.default.USAGE_STATIC,c);s.vb=l;this._subMeshes[o]=new e.default(s.vb);h=this._subDatas[o];h&&(h.vb&&h.vb.destroy(),h.ib&&h.ib.destroy());this._subDatas[o]=s;this.loaded=!0;this.emit("load");this.emit("init-format")},setVertices:function(n,t,r){var u,f,c,w,b,s,d,g,h,nt;if(r=r||0,u=this._subDatas[r],f=u.vfm.element(n),!f)return cc.warn("Cannot find "+n+" attribute in vertex defines.");var e,p="number"==typeof t[0],o=f.num,k=p?t.length/o|0:t.length;if(u.vData.byteLength<k*f.stride&&u.setVData(new Uint8Array(k*u.vfm._bytes)),c=4,n===i.default.ATTR_COLOR?p?(e=u.getVData(),c=1):e=u.getVData(Uint32Array):e=u.getVData(Float32Array),w=f.stride/c,b=f.offset/c,p)for(s=0,d=t.length/o;s<d;s++)for(var tt=s*o,it=s*w+b,y=0;y<o;y++)e[it+y]=t[tt+y];else for(g=n===i.default.ATTR_COLOR?l:2===o?a:v,h=0,nt=t.length;h<nt;h++)g(e,h*w+b,t[h]);u.vDirty=!0},setIndices:function(n,t,r){var f,o,e,s;t=t||0;f=n;n instanceof Uint16Array?f=new Uint8Array(n.buffer,n.byteOffset,n.byteLength):Array.isArray(n)&&(f=new Uint16Array(n),f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength));o=r?i.default.USAGE_DYNAMIC:i.default.USAGE_STATIC;e=this._subDatas[t];e.ib?(e.iData=f,e.iDirty=!0):(e.iData=f,s=new i.default.IndexBuffer(u.device,i.default.INDEX_FMT_UINT16,o,f,f.byteLength/i.default.IndexBuffer.BYTES_PER_INDEX[i.default.INDEX_FMT_UINT16]),e.ib=s,this._subMeshes[t]._indexBuffer=e.ib)},setPrimitiveType:function(n,t){t=t||0;this._subMeshes[t]?this._subMeshes[t]._primitiveType=n:cc.warn("Do not have sub mesh at index "+t)},clear:function(){var i,r;this._subMeshes.length=0;for(var n=this._subDatas,t=0,u=n.length;t<u;t++)i=n[t].vb,i&&i.destroy(),r=n[t].ib,r&&r.destroy();n.length=0},setBoundingBox:function(n,t){this._minPos=n;this._maxPos=t},destroy:function(){this.clear()},_uploadData:function(){for(var n,r,u,f,e,i=this._subDatas,t=0,o=i.length;t<o;t++)n=i[t],n.vDirty&&(r=n.vb,u=n.vData,r.update(0,u),n.vDirty=!1),n.iDirty&&(f=n.ib,e=n.iData,f.update(0,e),n.iDirty=!1)},_getAttrMeshData:function(n,t){var r=this._subDatas[n],o,i,c,u,v,e,y;if(!r)return[];if(o=r.vfm,i=o.element(t),!i)return[];if(r.attrDatas||(r.attrDatas={}),c=r.attrDatas,u=c[t],u)return u;u=c[t]=[];for(var f=r.vData,p=new DataView(f.buffer,f.byteOffset,f.byteLength),w=i.stride,b=i.offset,a=i.num,k=i.bytes/a,d=s[i.type],g=f.byteLength/o._bytes,l=0;l<g;l++)for(v=l*w+b,e=0;e<a;e++)y=p[d](v+e*k,h),u.push(y);return u},copyAttribute:function(n,t,i,r,u){var s=!1,c=this._subDatas[n],l,f,a,w,e,b,k;if(!c||(l=c.vfm,f=l.element(t),!f)||(a=y[f.type],!a))return s;var v=this._getAttrMeshData(n,t),d=c.vData.byteLength/l._bytes,g=f.bytes/f.num;if(v.length>0){for(var nt=new DataView(i,u),tt=r,p=f.num,o=0;o<d;++o)for(w=o*p,e=0;e<p;++e)b=w+e,k=tt*o+g*e,nt[a](k,v[b],h);s=!0}return s},copyIndices:function(n,t){var f=this._subDatas[n];if(!f)return!1;for(var r=f.iData,e=r.length/2,o=new DataView(r.buffer,r.byteOffset,r.byteLength),h=s[i.default.INDEX_FMT_UINT8],u=0;u<e;++u)t[u]=o[h](2*u);return!0}});cc.Mesh=t.exports=p},{"../../renderer/core/input-assembler":307,"../../renderer/gfx":317,"../event/event-target":142,"../renderer":226,"./mesh-data":166}],164:[function(n,t){"use strict";function i(n){return n&&n.__esModule?n:{"default":n}}var r=i(n("../../renderer/gfx")),f=(i(n("../../renderer/core/input-assembler")),i(n("../geom-utils/aabb"))),o=(i(n("../value-types/vec3")),i(n("../value-types/mat4")),i(n("../assets/material/material-variant"))),s=n("../components/CCRenderComponent"),e=n("./CCMesh"),h=n("../renderer/render-flow"),c=(n("../renderer"),n("../assets/material/CCMaterial")),u=cc.Enum({OFF:0,ON:1}),l=cc.Class({name:"cc.MeshRenderer","extends":s,editor:!1,properties:{_mesh:{"default":null,type:e},_receiveShadows:!1,_shadowCastingMode:u.OFF,_enableAutoBatch:!1,mesh:{get:function(){return this._mesh},set:function(n){this._mesh!==n&&(this._setMesh(n),n?(this.markForRender(!0),this.node._renderFlag|=h.FLAG_TRANSFORM):this.disableRender())},type:e,animatable:!1},textures:{"default":[],type:cc.Texture2D,visible:!1},receiveShadows:{get:function(){return this._receiveShadows},set:function(n){this._receiveShadows=n;this._updateReceiveShadow()},animatable:!1},shadowCastingMode:{get:function(){return this._shadowCastingMode},set:function(n){this._shadowCastingMode=n;this._updateCastShadow()},type:u,animatable:!1},enableAutoBatch:{get:function(){return this._enableAutoBatch},set:function(n){this._enableAutoBatch=n}}},statics:{ShadowCastingMode:u},ctor:function(){this._boundingBox=cc.geomUtils&&new f.default},onEnable:function(){var n=this;this._super();this._mesh&&!this._mesh.loaded?(this.disableRender(),this._mesh.once("load",function(){n.isValid&&(n._setMesh(n._mesh),n.markForRender(!0))}),cc.assetManager.postLoadNative(this._mesh)):this._setMesh(this._mesh);this._updateRenderNode();this._updateMaterial()},onDestroy:function(){this._setMesh(null);cc.pool.assembler.put(this._assembler)},_updateRenderNode:function(){this._assembler.setRenderNode(this.node)},_setMesh:function(n){cc.geomUtils&&n&&f.default.fromPoints(this._boundingBox,n._minPos,n._maxPos);this._mesh&&this._mesh.off("init-format",this._updateMeshAttribute,this);n&&n.on("init-format",this._updateMeshAttribute,this);this._mesh=n;this._assembler&&(this._assembler._worldDatas={});this._updateMeshAttribute()},_getDefaultMaterial:function(){return c.getBuiltinMaterial("unlit")},_validateRender:function(){var n=this._mesh;n&&n._subDatas.length>0||this.disableRender()},_updateMaterial:function(){var i=this.textures,r,t,n;if(i&&i.length>0)for(r=this._getDefaultMaterial(),t=0;t<i.length;t++)n=this._materials[t],n&&n._uuid!==r._uuid||(n||(n=o.default.create(r,this),this.setMaterial(t,n)),n.setProperty("diffuseTexture",i[t]));this._updateReceiveShadow();this._updateCastShadow();this._updateMeshAttribute()},_updateReceiveShadow:function(){for(var t=this.getMaterials(),n=0;n<t.length;n++)t[n].define("CC_USE_SHADOW_MAP",this._receiveShadows,void 0,!0)},_updateCastShadow:function(){for(var t=this.getMaterials(),n=0;n<t.length;n++)t[n].define("CC_CASTING_SHADOW",this._shadowCastingMode===u.ON,void 0,!0)},_updateMeshAttribute:function(){var u=this._mesh&&this._mesh.subDatas,f,n,t,i;if(u)for(f=this.getMaterials(),n=0;n<f.length&&u[n];n++)t=u[n].vfm,i=f[n],i.define("CC_USE_ATTRIBUTE_COLOR",!!t.element(r.default.ATTR_COLOR),void 0,!0),i.define("CC_USE_ATTRIBUTE_UV0",!!t.element(r.default.ATTR_UV0),void 0,!0),i.define("CC_USE_ATTRIBUTE_NORMAL",!!t.element(r.default.ATTR_NORMAL),void 0,!0),i.define("CC_USE_ATTRIBUTE_TANGENT",!!t.element(r.default.ATTR_TANGENT),void 0,!0)},_checkBacth:function(){}});cc.MeshRenderer=t.exports=l},{"../../renderer/core/input-assembler":307,"../../renderer/gfx":317,"../assets/material/CCMaterial":80,"../assets/material/material-variant":87,"../components/CCRenderComponent":115,"../geom-utils/aabb":146,"../renderer":226,"../renderer/render-flow":227,"../value-types/mat4":286,"../value-types/vec3":294,"./CCMesh":163}],165:[function(n){"use strict";n("./CCMesh");n("./CCMeshRenderer");n("./mesh-renderer")},{"./CCMesh":163,"./CCMeshRenderer":164,"./mesh-renderer":167}],166:[function(n,t,i){"use strict";function f(){this.vData=null;this.float32VData=null;this.uint32VData=null;this.iData=null;this.uint16IData=null;this.vfm=null;this.offset=0;this.vb=null;this.ib=null;this.vDirty=!1;this.iDirty=!1;this.enable=!0}var r,e,u,o,s,h;i.__esModule=!0;i.MeshData=f;i.Primitive=i.VertexBundle=i.VertexFormat=i.BufferRange=void 0;e=(r=n("../../renderer/gfx"))&&r.__esModule?r:{"default":r};u=cc.Class({name:"cc.BufferRange",properties:{offset:0,length:0}});i.BufferRange=u;o=cc.Class({name:"cc.mesh.VertexFormat",properties:{name:"",type:-1,num:-1,normalize:!1}});i.VertexFormat=o;s=cc.Class({name:"cc.mesh.VertexBundle",properties:{data:{"default":null,type:u},formats:{"default":[],type:o},verticesCount:0}});i.VertexBundle=s;h=cc.Class({name:"cc.mesh.Primitive",properties:{vertexBundleIndices:{"default":[],type:cc.Float},data:{"default":null,type:u},indexUnit:e.default.INDEX_FMT_UINT16,topology:e.default.PT_TRIANGLES}});i.Primitive=h;f.prototype.setVData=function(n){this.vData=n;this.float32VData=null;this.uint32VData=null};f.prototype.getVData=function(n){return n===Float32Array?(this.float32VData||(this.float32VData=new Float32Array(this.vData.buffer,this.vData.byteOffset,this.vData.byteLength/4)),this.float32VData):n===Uint32Array?(this.uint32VData||(this.uint32VData=new Uint32Array(this.vData.buffer,this.vData.byteOffset,this.vData.byteLength/4)),this.uint32VData):this.vData};f.prototype.getIData=function(n){return n===Uint16Array?(this.uint16IData||(this.uint16IData=new Uint16Array(this.iData.buffer,this.iData.byteOffset,this.iData.byteLength/2)),this.uint16IData):this.iData}},{"../../renderer/gfx":317}],167:[function(n,t,i){"use strict";function e(n){return n&&n.__esModule?n:{"default":n}}i.__esModule=!0;i.default=void 0;var o=e(n("../renderer/assembler")),u=e(n("../../renderer/gfx")),f=e(n("../value-types/vec3"));var h=n("./CCMeshRenderer"),r=new f.default,s=function(n){function o(){return n.apply(this,arguments)||this}var i,e,t;return e=n,(i=o).prototype=Object.create(e.prototype),i.prototype.constructor=i,i.__proto__=e,t=o.prototype,t.init=function(t){n.prototype.init.call(this,t);this._worldDatas={};this._renderNode=null},t.setRenderNode=function(n){this._renderNode=n},t.fillBuffers=function(n,t){if(n.mesh){n.mesh._uploadData();for(var h=t.cullingMask===n.node._cullingMask,c=n.enableAutoBatch,f=n._materials,e=n.mesh._subMeshes,l=n.mesh.subDatas,i=0;i<e.length;i++){var o=e[i],s=l[i],r=f[i]||f[0];c&&s.canBatch&&o._primitiveType===u.default.PT_TRIANGLES?(h&&r.getHash()===t.material.getHash()||t._flush(),t.material=r,t.cullingMask=n.node._cullingMask,t.node=t._dummyNode,this._fillBuffer(n,s,t,i)):(t._flush(),t.material=r,t.cullingMask=n.node._cullingMask,t.node=this._renderNode,t._flushIA(o))}}},t._fillBuffer=function(n,t,i,r){var s=t.getVData(Float32Array),f=t.vfm,h=s.byteLength/f._bytes|0,c=t.getIData(Uint16Array),l=c.length,e=i.getBuffer("mesh",f),o=e.request(h,l),a=o.indiceOffset,v=o.byteOffset>>2,y=o.vertexOffset,p=e._vData,w=e._iData,u;for(!i.worldMatDirty&&this._worldDatas[r]||this._updateWorldVertices(r,h,s,f,n.node._worldMatrix),p.set(this._worldDatas[r],v),u=0;u<l;u++)w[a+u]=y+c[u]},t._updateWorldVertices=function(n,t,i,e,o){var h=this._worldDatas[n],c,y,p,l,s;h||(h=this._worldDatas[n]=new Float32Array(i.length)).set(i);for(var w=e._bytes/4,v=e._elements,a=0,b=v.length;a<b;a++)if(c=v[a],y=c.offset/4,c.name===u.default.ATTR_POSITION||c.name===u.default.ATTR_NORMAL)for(p=c.name===u.default.ATTR_NORMAL?f.default.transformMat4Normal:f.default.transformMat4,l=0;l<t;l++)s=l*w+y,r.x=i[s],r.y=i[s+1],r.z=i[s+2],p(r,r,o),h[s]=r.x,h[s+1]=r.y,h[s+2]=r.z},t._drawDebugDatas=function(n,t,i){var f=n._debugDatas[i],r,u,e;if(f)for(r=0;r<f.length;r++)u=f[r],u&&(e=u.material,t.material=e,t._flushIA(u.ia))},o}(o.default);i.default=s;o.default.register(h,s);t.exports=i.default},{"../../renderer/gfx":317,"../renderer/assembler":223,"../value-types/vec3":294,"./CCMeshRenderer":164}],168:[function(n,t){"use strict";function p(n,t,i){t?n._removeComponent(t):h.array.removeAt(n._components,i)}function c(){this._activatingStack=[]}var i=n("./component-scheduler"),f=n("./platform/CCObject").Flags,h=n("./platform/js"),e=f.IsPreloadStarted,o=f.IsOnLoadStarted,r=f.IsOnLoadCalled,u=f.Deactivating,a=cc.Class({"extends":i.LifeCycleInvoker,add:function(n){this._zero.array.push(n)},remove:function(n){this._zero.fastRemove(n)},cancelInactive:function(n){i.LifeCycleInvoker.stableRemoveInactive(this._zero,n)},invoke:function(){this._invoke(this._zero);this._zero.array.length=0}}),v=i.createInvokeImpl(function(n){n.__preload()},!1,void 0,function(n){var t=n.array;for(n.i=0;n.i<t.length;++n.i)t[n.i].__preload()}),y=i.createInvokeImpl(function(n){n.onLoad();n._objFlags|=r},!1,r,function(n){var i=n.array,t;for(n.i=0;n.i<i.length;++n.i)t=i[n.i],t.onLoad(),t._objFlags|=r}),s=new h.Pool(4),l;s.get=function(){var t=this._get()||{preload:new a(v),onLoad:new i.OneOffInvoker(y),onEnable:new i.OneOffInvoker(i.invokeOnEnable)},n;return t.preload._zero.i=-1,n=t.onLoad,n._zero.i=-1,n._neg.i=-1,n._pos.i=-1,(n=t.onEnable)._zero.i=-1,n._neg.i=-1,n._pos.i=-1,t};l=cc.Class({ctor:c,reset:c,_activateNodeRecursively:function(n,t,i,r){var h,f,s,e,c,o;if(n._objFlags&u)cc.errorID(3816,n.name);else{for(n._activeInHierarchy=!0,h=n._components.length,f=0;f<h;++f)s=n._components[f],s instanceof cc.Component?this.activateComp(s,t,i,r):(p(n,s,f),--f,--h);for(n._childArrivalOrder=n._children.length,e=0,c=n._children.length;e<c;++e)o=n._children[e],o._localZOrder=4294901760&o._localZOrder|e+1,o._active&&this._activateNodeRecursively(o,t,i,r);n._onPostActivated(!0)}},_deactivateNodeRecursively:function(n){var e,t,r,i,o,f;for(n._objFlags|=u,n._activeInHierarchy=!1,e=n._components.length,t=0;t<e;++t)if(r=n._components[t],r._enabled&&(cc.director._compScheduler.disableComp(r),n._activeInHierarchy))return void(n._objFlags&=~u);for(i=0,o=n._children.length;i<o;++i)if(f=n._children[i],f._activeInHierarchy&&(this._deactivateNodeRecursively(f),n._activeInHierarchy))return void(n._objFlags&=~u);n._onPostActivated(!1);n._objFlags&=~u},activateNode:function(n,t){var i,f,r,u;if(t)i=s.get(),this._activatingStack.push(i),this._activateNodeRecursively(n,i.preload,i.onLoad,i.onEnable),i.preload.invoke(),i.onLoad.invoke(),i.onEnable.invoke(),this._activatingStack.pop(),s.put(i);else for(this._deactivateNodeRecursively(n),f=this._activatingStack,r=0;r<f.length;r++)u=f[r],u.preload.cancelInactive(e),u.onLoad.cancelInactive(o),u.onEnable.cancelInactive();n.emit("active-in-hierarchy-changed",n)},activateComp:function(n,t,i,u){if(cc.isValid(n,!0)&&(n._objFlags&e||(n._objFlags|=e,n.__preload&&(t?t.add(n):n.__preload())),n._objFlags&o||(n._objFlags|=o,n.onLoad?i?i.add(n):(n.onLoad(),n._objFlags|=r):n._objFlags|=r),n._enabled)){if(!n.node._activeInHierarchy)return;cc.director._compScheduler.enableComp(n,u)}},destroyComp:function(n){cc.director._compScheduler.disableComp(n);n.onDestroy&&n._objFlags&r&&n.onDestroy()},resetComp:!1});t.exports=l},{"./component-scheduler":99,"./platform/CCObject":201,"./platform/js":216,"./utils/misc":269}],169:[function(n,t){"use strict";function l(){this.localPoint=cc.v2();this.normalImpulse=0;this.tangentImpulse=0}function r(){}var i=n("./CCPhysicsTypes").PTM_RATIO,f=n("./CCPhysicsTypes").ContactType,h=[],a=[cc.v2(),cc.v2()],e=new b2.WorldManifold,s={points:[],separations:[],normal:cc.v2()},v=[new l,new l],o=(new b2.Manifold,{type:0,localPoint:cc.v2(),localNormal:cc.v2(),points:[]}),c={normalImpulses:[],tangentImpulses:[]},u;r.prototype.init=function(n){this.colliderA=n.GetFixtureA().collider;this.colliderB=n.GetFixtureB().collider;this.disabled=!1;this.disabledOnce=!1;this._impulse=null;this._inverted=!1;this._b2contact=n;n._contact=this};r.prototype.reset=function(){this.setTangentSpeed(0);this.resetFriction();this.resetRestitution();this.colliderA=null;this.colliderB=null;this.disabled=!1;this._impulse=null;this._b2contact._contact=null;this._b2contact=null};r.prototype.getWorldManifold=function(){var u=s.points,f=s.separations,t=s.normal,n,r;this._b2contact.GetWorldManifold(e);var o=e.points,c=e.separations,h=this._b2contact.GetManifold().pointCount;for(u.length=f.length=h,n=0;n<h;n++)r=a[n],r.x=o[n].x*i,r.y=o[n].y*i,u[n]=r,f[n]=c[n]*i;return t.x=e.normal.x,t.y=e.normal.y,this._inverted&&(t.x*=-1,t.y*=-1),s};r.prototype.getManifold=function(){for(var t,u,e=o.points,f=o.localNormal,s=o.localPoint,n=this._b2contact.GetManifold(),h=n.points,c=e.length=n.pointCount,r=0;r<c;r++)t=v[r],u=h[r],t.localPoint.x=u.localPoint.x*i,t.localPoint.Y=u.localPoint.Y*i,t.normalImpulse=u.normalImpulse*i,t.tangentImpulse=u.tangentImpulse,e[r]=t;return s.x=n.localPoint.x*i,s.y=n.localPoint.y*i,f.x=n.localNormal.x,f.y=n.localNormal.y,o.type=n.type,this._inverted&&(f.x*=-1,f.y*=-1),o};r.prototype.getImpulse=function(){var t=this._impulse;if(!t)return null;for(var r=c.normalImpulses,u=c.tangentImpulses,f=t.count,n=0;n<f;n++)r[n]=t.normalImpulses[n]*i,u[n]=t.tangentImpulses[n];return u.length=r.length=f,c};r.prototype.emit=function(n){var t;switch(n){case f.BEGIN_CONTACT:t="onBeginContact";break;case f.END_CONTACT:t="onEndContact";break;case f.PRE_SOLVE:t="onPreSolve";break;case f.POST_SOLVE:t="onPostSolve"}var r,i,u,e,o=this.colliderA,s=this.colliderB,h=o.body,c=s.body;if(h.enabledContactListener)for(r=h.node._components,this._inverted=!1,i=0,u=r.length;i<u;i++)(e=r[i])[t]&&e[t](this,o,s);if(c.enabledContactListener)for(r=c.node._components,this._inverted=!0,i=0,u=r.length;i<u;i++)(e=r[i])[t]&&e[t](this,s,o);(this.disabled||this.disabledOnce)&&(this.setEnabled(!1),this.disabledOnce=!1)};r.get=function(n){var t;return(t=0===h.length?new cc.PhysicsContact:h.pop()).init(n),t};r.put=function(n){var t=n._contact;t&&(h.push(t),t.reset())};u=r.prototype;u.setEnabled=function(n){this._b2contact.SetEnabled(n)};u.isTouching=function(){return this._b2contact.IsTouching()};u.setTangentSpeed=function(n){this._b2contact.SetTangentSpeed(n/i)};u.getTangentSpeed=function(){return this._b2contact.GetTangentSpeed()*i};u.setFriction=function(n){this._b2contact.SetFriction(n)};u.getFriction=function(){return this._b2contact.GetFriction()};u.resetFriction=function(){return this._b2contact.ResetFriction()};u.setRestitution=function(n){this._b2contact.SetRestitution(n)};u.getRestitution=function(){return this._b2contact.GetRestitution()};u.resetRestitution=function(){return this._b2contact.ResetRestitution()};r.ContactType=f;cc.PhysicsContact=t.exports=r},{"./CCPhysicsTypes":171}],170:[function(n,t){"use strict";var f=n("./CCPhysicsTypes"),s=f.ContactType,a=f.BodyType,c=f.RayCastType,l=f.DrawBits,i=f.PTM_RATIO,v=(f.ANGLE_TO_PHYSICS_ANGLE,f.PHYSICS_ANGLE_TO_ANGLE),y=n("./utils").convertToNodeRotation,p=n("./platform/CCPhysicsDebugDraw"),r=new b2.AABB,e=new b2.Vec2,h=new b2.Vec2,o=cc.v2(),u=cc.Class({mixins:[cc.EventTarget],statics:{DrawBits:l,PTM_RATIO:i,VELOCITY_ITERATIONS:10,POSITION_ITERATIONS:10,FIXED_TIME_STEP:1/60,MAX_ACCUMULATOR:.2},ctor:function(){this._debugDrawFlags=0;this._debugDrawer=null;this._world=null;this._bodies=[];this._joints=[];this._contactMap={};this._contactID=0;this._delayEvents=[];this._accumulator=0;cc.director._scheduler&&cc.director._scheduler.enableForTarget(this);this.enabledAccumulator=!1},pushDelayEvent:function(n,t,i){this._steping?this._delayEvents.push({target:n,func:t,args:i}):n[t].apply(n,i)},update:function(n){var i=this._world,f,e,r,o,c,t;if(i&&this.enabled){if(this.emit("before-step"),this._steping=!0,f=u.VELOCITY_ITERATIONS,e=u.POSITION_ITERATIONS,this.enabledAccumulator)for(this._accumulator+=n,r=u.FIXED_TIME_STEP,o=u.MAX_ACCUMULATOR,this._accumulator>o&&(this._accumulator=o);this._accumulator>r;)i.Step(r,f,e),this._accumulator-=r;else c=1/cc.game.config.frameRate,i.Step(c,f,e);this.debugDrawFlags&&(this._checkDebugDrawValid(),this._debugDrawer.clear(),i.DrawDebugData());this._steping=!1;for(var s=this._delayEvents,h=0,l=s.length;h<l;h++)t=s[h],t.target[t.func].apply(t.target,t.args);s.length=0;this._syncNode()}},testPoint:function(n){var o=e.x=n.x/i,s=e.y=n.y/i,t=.2/i,u,f;return r.lowerBound.x=o-t,r.lowerBound.y=s-t,r.upperBound.x=o+t,r.upperBound.y=s+t,u=this._aabbQueryCallback,u.init(e),this._world.QueryAABB(u,r),f=u.getFixture(),f?f.collider:null},testAABB:function(n){r.lowerBound.x=n.xMin/i;r.lowerBound.y=n.yMin/i;r.upperBound.x=n.xMax/i;r.upperBound.y=n.yMax/i;var t=this._aabbQueryCallback;return t.init(),this._world.QueryAABB(t,r),t.getFixtures().map(function(n){return n.collider})},rayCast:function(n,t,r){var o,l,v,s,f;if(n.equals(t))return[];if(r=r||c.Closest,e.x=n.x/i,e.y=n.y/i,h.x=t.x/i,h.y=t.y/i,o=this._raycastQueryCallback,o.init(r),this._world.RayCast(o,e,h),l=o.getFixtures(),l.length>0){for(var a=o.getPoints(),y=o.getNormals(),p=o.getFractions(),w=[],u=0,b=l.length;u<b;u++){if(v=l[u],s=v.collider,r===c.AllClosest&&(f=w.find(function(n){return n.collider===s}),f)){p[u]<f.fraction&&(f.fixtureIndex=s._getFixtureIndex(v),f.point.x=a[u].x*i,f.point.y=a[u].y*i,f.normal.x=y[u].x,f.normal.y=y[u].y,f.fraction=p[u]);continue}w.push({collider:s,fixtureIndex:s._getFixtureIndex(v),point:cc.v2(a[u].x*i,a[u].y*i),normal:cc.v2(y[u]),fraction:p[u]})}return w}return[]},syncPosition:function(){for(var t=this._bodies,n=0;n<t.length;n++)t[n].syncPosition()},syncRotation:function(){for(var t=this._bodies,n=0;n<t.length;n++)t[n].syncRotation()},_registerContactFixture:function(n){this._contactListener.registerContactFixture(n)},_unregisterContactFixture:function(n){this._contactListener.unregisterContactFixture(n)},_addBody:function(n,t){var i=this._world,r=n.node;i&&r&&(n._b2Body=i.CreateBody(t),n._b2Body.body=n,this._bodies.push(n))},_removeBody:function(n){var t=this._world;t&&(n._b2Body.body=null,t.DestroyBody(n._b2Body),n._b2Body=null,cc.js.array.remove(this._bodies,n))},_addJoint:function(n,t){var i=this._world.CreateJoint(t);i&&(i._joint=n,n._joint=i,this._joints.push(n))},_removeJoint:function(n){n._isValid()&&this._world.DestroyJoint(n._joint);n._joint&&(n._joint._joint=null);cc.js.array.remove(this._joints,n)},_initCallback:function(){if(this._world){if(!this._contactListener){var n=new cc.PhysicsContactListener;n.setBeginContact(this._onBeginContact);n.setEndContact(this._onEndContact);n.setPreSolve(this._onPreSolve);n.setPostSolve(this._onPostSolve);this._world.SetContactListener(n);this._contactListener=n;this._aabbQueryCallback=new cc.PhysicsAABBQueryCallback;this._raycastQueryCallback=new cc.PhysicsRayCastCallback}}else cc.warn("Please init PhysicsManager first")},_init:function(){this.enabled=!0;this.debugDrawFlags=l.e_shapeBit},_getWorld:function(){return this._world},_syncNode:function(){for(var r,h,f=this._bodies,u=0,c=f.length;u<c;u++){var t=f[u],n=t.node,e=t._b2Body,s=e.GetPosition();o.x=s.x*i;o.y=s.y*i;r=e.GetAngle()*v;null!==n.parent.parent&&(o=n.parent.convertToNodeSpaceAR(o),r=y(n.parent,r));h=n._eventMask;n._eventMask=0;n.position=o;n.angle=-r;n._eventMask=h;t.type===a.Animated&&t.resetVelocity()}},_onBeginContact:function(n){cc.PhysicsContact.get(n).emit(s.BEGIN_CONTACT)},_onEndContact:function(n){var t=n._contact;t&&(t.emit(s.END_CONTACT),cc.PhysicsContact.put(n))},_onPreSolve:function(n){var t=n._contact;t&&t.emit(s.PRE_SOLVE)},_onPostSolve:function(n,t){var i=n._contact;i&&(i._impulse=t,i.emit(s.POST_SOLVE),i._impulse=null)},_checkDebugDrawValid:function(){var n,t;this._debugDrawer&&this._debugDrawer.isValid||(n=new cc.Node("PHYSICS_MANAGER_DEBUG_DRAW"),n.zIndex=cc.macro.MAX_ZINDEX,cc.game.addPersistRootNode(n),this._debugDrawer=n.addComponent(cc.Graphics),t=new p(this._debugDrawer),t.SetFlags(this.debugDrawFlags),this._world.SetDebugDraw(t))}});cc.js.getset(u.prototype,"enabled",function(){return this._enabled},function(n){if(n&&!this._world){var t=new b2.World(new b2.Vec2(0,-10));t.SetAllowSleeping(!0);this._world=t;this._initCallback()}this._enabled=n});cc.js.getset(u.prototype,"debugDrawFlags",function(){return this._debugDrawFlags},function(n){n&&!this._debugDrawFlags?this._debugDrawer&&this._debugDrawer.node&&(this._debugDrawer.node.active=!0):!n&&this._debugDrawFlags&&this._debugDrawer&&this._debugDrawer.node&&(this._debugDrawer.node.active=!1);n&&(this._checkDebugDrawValid(),this._world.m_debugDraw.SetFlags(n));this._debugDrawFlags=n;n&&(this._checkDebugDrawValid(),this._world.m_debugDraw.SetFlags(n))});cc.js.getset(u.prototype,"gravity",function(){if(this._world){var n=this._world.GetGravity();return cc.v2(n.x*i,n.y*i)}return cc.v2()},function(n){this._world&&this._world.SetGravity(new b2.Vec2(n.x/i,n.y/i))});cc.PhysicsManager=t.exports=u},{"./CCPhysicsTypes":171,"./platform/CCPhysicsDebugDraw":192,"./utils":194}],171:[function(n,t){"use strict";var r=cc.Enum({Static:0,Kinematic:1,Dynamic:2,Animated:3}),i;cc.RigidBodyType=r;i=cc.Enum({Closest:0,Any:1,AllClosest:2,All:3});cc.RayCastType=i;t.exports={BodyType:r,ContactType:{BEGIN_CONTACT:"begin-contact",END_CONTACT:"end-contact",PRE_SOLVE:"pre-solve",POST_SOLVE:"post-solve"},RayCastType:i,DrawBits:b2.DrawFlags,PTM_RATIO:32,ANGLE_TO_PHYSICS_ANGLE:-Math.PI/180,PHYSICS_ANGLE_TO_ANGLE:-180/Math.PI}},{}],172:[function(n,t){"use strict";function i(n,t){var i=t.length;return t[n<0?i- -n%i:n%i]}function f(n,t,r){for(var u=[];t<n;)t+=r.length;for(;n<=t;++n)u.push(i(n,r));return u}function y(n,t,f){var o,s;if(e(n,f)){if(u(i(n,f),i(n-1,f),i(t,f))&&r(i(n,f),i(n+1,f),i(t,f)))return!1}else if(r(i(n,f),i(n+1,f),i(t,f))||u(i(n,f),i(n-1,f),i(t,f)))return!1;if(e(t,f)){if(u(i(t,f),i(t-1,f),i(n,f))&&r(i(t,f),i(t+1,f),i(n,f)))return!1}else if(r(i(t,f),i(t+1,f),i(n,f))||u(i(t,f),i(t-1,f),i(n,f)))return!1;for(o=0;o<f.length;++o)if((o+1)%f.length!=n&&o!=n&&(o+1)%f.length!=t&&o!=t&&(s=cc.v2(),w(i(n,f),i(t,f),i(o,f),i(o+1,f),s)))return!1;return!0}function e(n,t){return c(n,t)}function c(n,t,r){if(void 0===r){var u=n,f=t;n=i(u-1,f);t=i(u,f);r=i(u+1,f)}return o(n,t,r)<0}function s(n,t,i){return o(n,t,i)>0}function u(n,t,i){return o(n,t,i)>=0}function r(n,t,i){return o(n,t,i)<=0}function h(n,t){var i=t.x-n.x,r=t.y-n.y;return i*i+r*r}function l(n){a(n)||n.reverse()}function a(n){return n.length<3||p(n)>0}function p(n){for(var i=0,r,t=0;t<n.length;t++)r=(t+1)%n.length,i+=n[t].x*n[r].y,i-=n[t].y*n[r].x;return i/2}function v(n,t,i,r){var c,u=cc.v2(),f=t.y-n.y,e=n.x-t.x,l=f*n.x+e*n.y,o=r.y-i.y,s=i.x-r.x,a=o*i.x+s*i.y,h=f*s-o*e;return c=h,Math.abs(+c)<=1e-6||(u.x=(s*l-e*a)/h,u.y=(f*a-o*l)/h),u}function w(n,t,i,r,u){if(n==i||n==r||t==i||t==r)return!1;var f=n.x,e=n.y,h=t.x,c=t.y,o=i.x,s=i.y,l=r.x,a=r.y;if(Math.max(f,h)<Math.min(o,l)||Math.max(o,l)<Math.min(f,h)||Math.max(e,c)<Math.min(s,a)||Math.max(s,a)<Math.min(e,c))return!1;var v=(l-o)*(e-s)-(a-s)*(f-o),y=(h-f)*(e-s)-(c-e)*(f-o),p=(a-s)*(h-f)-(l-o)*(c-e);return!(Math.abs(p)<1e-6)&&(y/=p,0<(v/=p)&&v<1&&0<y&&y<1&&(u.x=f+v*(h-f),u.y=e+v*(c-e),!0))}function o(n,t,i){return n.x*(t.y-i.y)+t.x*(i.y-n.y)+i.x*(n.y-t.y)}t.exports={ConvexPartition:function n(t){var a,ft,et,g,nt;l(t);for(var d,tt,it,p,rt,ut,w=[],ot=cc.v2(),st=cc.v2(),b=0,k=0,o=0;o<t.length;++o)if(e(o,t)){for(tt=it=1e8,a=0;a<t.length;++a)s(i(o-1,t),i(o,t),i(a,t))&&r(i(o-1,t),i(o,t),i(a-1,t))&&(p=v(i(o-1,t),i(o,t),i(a,t),i(a-1,t)),c(i(o+1,t),i(o,t),p)&&(d=h(i(o,t),p))<tt&&(tt=d,ot=p,b=a)),s(i(o+1,t),i(o,t),i(a+1,t))&&r(i(o+1,t),i(o,t),i(a,t))&&(p=v(i(o+1,t),i(o,t),i(a,t),i(a+1,t)),s(i(o-1,t),i(o,t),p)&&(d=h(i(o,t),p))<it&&(it=d,k=a,st=p));if(b==(k+1)%t.length)ft=ot.add(st).div(2),(rt=f(o,k,t)).push(ft),(ut=f(b,o,t)).push(ft);else{for(et=0,g=b;k<b;)k+=t.length;for(a=b;a<=k;++a)y(o,a,t)&&(nt=1/(h(i(o,t),i(a,t))+1),nt+=e(a,t)?r(i(a-1,t),i(a,t),i(o,t))&&u(i(a+1,t),i(a,t),i(o,t))?3:2:1,nt>et&&(g=a,et=nt));rt=f(o,g,t);ut=f(g,o,t)}return(w=w.concat(n(rt))).concat(n(ut))}for(w.push(t),o=w.length-1;o>=0;o--)0==w[o].length&&w.splice(o,0);return w},ForceCounterClockWise:l,IsCounterClockWise:a}},{}],173:[function(n,t){"use strict";var f=n("../CCNode").EventType,i=n("./CCPhysicsTypes").PTM_RATIO,o=n("./CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,s=n("./CCPhysicsTypes").PHYSICS_ANGLE_TO_ANGLE,h=n("./utils").getWorldRotation,u=n("./CCPhysicsTypes").BodyType,r=new b2.Vec2,e=new b2.Vec2,c=cc.Vec2.ZERO,l=cc.Class({name:"cc.RigidBody","extends":cc.Component,editor:!1,properties:{_type:u.Dynamic,_allowSleep:!0,_gravityScale:1,_linearDamping:0,_angularDamping:0,_linearVelocity:cc.v2(0,0),_angularVelocity:0,_fixedRotation:!1,enabled:{get:function(){return this._enabled},set:function(){cc.warnID(8200)},visible:!1,override:!0},enabledContactListener:{"default":!1,tooltip:!1},bullet:{"default":!1,tooltip:!1},type:{type:u,tooltip:!1,get:function(){return this._type},set:function(n){this._type=n;this._b2Body&&(n===u.Animated?this._b2Body.SetType(u.Kinematic):this._b2Body.SetType(n))}},allowSleep:{tooltip:!1,get:function(){return this._b2Body?this._b2Body.IsSleepingAllowed():this._allowSleep},set:function(n){this._allowSleep=n;this._b2Body&&this._b2Body.SetSleepingAllowed(n)}},gravityScale:{tooltip:!1,get:function(){return this._gravityScale},set:function(n){this._gravityScale=n;this._b2Body&&this._b2Body.SetGravityScale(n)}},linearDamping:{tooltip:!1,get:function(){return this._linearDamping},set:function(n){this._linearDamping=n;this._b2Body&&this._b2Body.SetLinearDamping(this._linearDamping)}},angularDamping:{tooltip:!1,get:function(){return this._angularDamping},set:function(n){this._angularDamping=n;this._b2Body&&this._b2Body.SetAngularDamping(n)}},linearVelocity:{tooltip:!1,type:cc.Vec2,get:function(){var n=this._linearVelocity,t;return this._b2Body&&(t=this._b2Body.GetLinearVelocity(),n.x=t.x*i,n.y=t.y*i),n},set:function(n){var t,r;this._linearVelocity=n;t=this._b2Body;t&&(r=t.m_linearVelocity,r.Set(n.x/i,n.y/i),t.SetLinearVelocity(r))}},angularVelocity:{tooltip:!1,get:function(){return this._b2Body?this._b2Body.GetAngularVelocity()*s:this._angularVelocity},set:function(n){this._angularVelocity=n;this._b2Body&&this._b2Body.SetAngularVelocity(n*o)}},fixedRotation:{tooltip:!1,get:function(){return this._fixedRotation},set:function(n){this._fixedRotation=n;this._b2Body&&this._b2Body.SetFixedRotation(n)}},awake:{visible:!1,tooltip:!1,get:function(){return!!this._b2Body&&this._b2Body.IsAwake()},set:function(n){this._b2Body&&this._b2Body.SetAwake(n)}},awakeOnLoad:{"default":!0,tooltip:!1,animatable:!1},active:{visible:!1,get:function(){return!!this._b2Body&&this._b2Body.IsActive()},set:function(n){this._b2Body&&this._b2Body.SetActive(n)}}},getLocalPoint:function(n,t){if(t=t||cc.v2(),this._b2Body){r.Set(n.x/i,n.y/i);var u=this._b2Body.GetLocalPoint(r,t);t.x=u.x*i;t.y=u.y*i}return t},getWorldPoint:function(n,t){if(t=t||cc.v2(),this._b2Body){r.Set(n.x/i,n.y/i);var u=this._b2Body.GetWorldPoint(r,t);t.x=u.x*i;t.y=u.y*i}return t},getWorldVector:function(n,t){if(t=t||cc.v2(),this._b2Body){r.Set(n.x/i,n.y/i);var u=this._b2Body.GetWorldVector(r,t);t.x=u.x*i;t.y=u.y*i}return t},getLocalVector:function(n,t){if(t=t||cc.v2(),this._b2Body){r.Set(n.x/i,n.y/i);var u=this._b2Body.GetLocalVector(r,t);t.x=u.x*i;t.y=u.y*i}return t},getWorldPosition:function(n){if(n=n||cc.v2(),this._b2Body){var t=this._b2Body.GetPosition();n.x=t.x*i;n.y=t.y*i}return n},getWorldRotation:function(){return this._b2Body?this._b2Body.GetAngle()*s:0},getLocalCenter:function(n){if(n=n||cc.v2(),this._b2Body){var t=this._b2Body.GetLocalCenter();n.x=t.x*i;n.y=t.y*i}return n},getWorldCenter:function(n){if(n=n||cc.v2(),this._b2Body){var t=this._b2Body.GetWorldCenter();n.x=t.x*i;n.y=t.y*i}return n},getLinearVelocityFromWorldPoint:function(n,t){if(t=t||cc.v2(),this._b2Body){r.Set(n.x/i,n.y/i);var u=this._b2Body.GetLinearVelocityFromWorldPoint(r,t);t.x=u.x*i;t.y=u.y*i}return t},getMass:function(){return this._b2Body?this._b2Body.GetMass():0},getInertia:function(){return this._b2Body?this._b2Body.GetInertia()*i*i:0},getJointList:function(){var n,t,i,r;if(!this._b2Body)return[];if(n=[],t=this._b2Body.GetJointList(),!t)return[];for(n.push(t.joint._joint),i=t.prev;i;)n.push(i.joint._joint),i=i.prev;for(r=t.next;r;)n.push(r.joint._joint),r=r.next;return n},applyForce:function(n,t,u){this._b2Body&&(r.Set(n.x/i,n.y/i),e.Set(t.x/i,t.y/i),this._b2Body.ApplyForce(r,e,u))},applyForceToCenter:function(n,t){this._b2Body&&(r.Set(n.x/i,n.y/i),this._b2Body.ApplyForceToCenter(r,t))},applyTorque:function(n,t){this._b2Body&&this._b2Body.ApplyTorque(n/i,t)},applyLinearImpulse:function(n,t,u){this._b2Body&&(r.Set(n.x/i,n.y/i),e.Set(t.x/i,t.y/i),this._b2Body.ApplyLinearImpulse(r,e,u))},applyAngularImpulse:function(n,t){this._b2Body&&this._b2Body.ApplyAngularImpulse(n/i/i,t)},syncPosition:function(n){var t=this._b2Body,r,f,e,o;t&&(f=this.node.convertToWorldSpaceAR(c),((r=this.type===u.Animated?t.GetLinearVelocity():t.GetPosition()).x=f.x/i,r.y=f.y/i,this.type===u.Animated&&n)?(e=t.GetPosition(),o=cc.game.config.frameRate,r.x=(r.x-e.x)*o,r.y=(r.y-e.y)*o,t.SetAwake(!0),t.SetLinearVelocity(r)):t.SetTransformVec(r,t.GetAngle()))},syncRotation:function(n){var t=this._b2Body,i,r,f;t&&(i=o*h(this.node),this.type===u.Animated&&n?(r=t.GetAngle(),f=cc.game.config.frameRate,t.SetAwake(!0),t.SetAngularVelocity((i-r)*f)):t.SetTransformVec(t.GetPosition(),i))},resetVelocity:function(){var n=this._b2Body,t;n&&(t=n.m_linearVelocity,t.Set(0,0),n.SetLinearVelocity(t),n.SetAngularVelocity(0))},onEnable:function(){this._init()},onDisable:function(){this._destroy()},_registerNodeEvents:function(){var n=this.node;n.on(f.POSITION_CHANGED,this._onNodePositionChanged,this);n.on(f.ROTATION_CHANGED,this._onNodeRotationChanged,this);n.on(f.SCALE_CHANGED,this._onNodeScaleChanged,this)},_unregisterNodeEvents:function(){var n=this.node;n.off(f.POSITION_CHANGED,this._onNodePositionChanged,this);n.off(f.ROTATION_CHANGED,this._onNodeRotationChanged,this);n.off(f.SCALE_CHANGED,this._onNodeScaleChanged,this)},_onNodePositionChanged:function(){this.syncPosition(!0)},_onNodeRotationChanged:function(){this.syncRotation(!0)},_onNodeScaleChanged:function(){if(this._b2Body)for(var t=this.getComponents(cc.PhysicsCollider),n=0;n<t.length;n++)t[n].apply()},_init:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__init",[])},_destroy:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__destroy",[])},__init:function(){var n,t,r,f;this._inited||(this._registerNodeEvents(),n=new b2.BodyDef,n.type=this.type===u.Animated?u.Kinematic:this.type,n.allowSleep=this.allowSleep,n.gravityScale=this.gravityScale,n.linearDamping=this.linearDamping,n.angularDamping=this.angularDamping,t=this.linearVelocity,n.linearVelocity=new b2.Vec2(t.x/i,t.y/i),n.angularVelocity=this.angularVelocity*o,n.fixedRotation=this.fixedRotation,n.bullet=this.bullet,r=this.node,f=r.convertToWorldSpaceAR(c),n.position=new b2.Vec2(f.x/i,f.y/i),n.angle=-Math.PI/180*h(r),n.awake=this.awakeOnLoad,cc.director.getPhysicsManager()._addBody(this,n),this._inited=!0)},__destroy:function(){this._inited&&(cc.director.getPhysicsManager()._removeBody(this),this._unregisterNodeEvents(),this._inited=!1)},_getBody:function(){return this._b2Body}});cc.RigidBody=t.exports=l},{"../CCNode":29,"./CCPhysicsTypes":171,"./utils":194}],174:[function(n){"use strict";var i=n("../../../external/box2d/box2d"),t,r;for(t in window.b2={},i)-1===t.indexOf("b2_")&&(r=t.replace("b2",""),b2[r]=i[t]);b2.maxPolygonVertices=8},{"../../../external/box2d/box2d":368}],175:[function(n,t){"use strict";var i=n("../CCPhysicsTypes").PTM_RATIO,r=cc.Class({name:"cc.PhysicsBoxCollider","extends":cc.PhysicsCollider,mixins:[cc.Collider.Box],editor:{menu:!1,requireComponent:cc.RigidBody},_createShape:function(n){var t=Math.abs(n.x),r=Math.abs(n.y),f=this.size.width/2/i*t,e=this.size.height/2/i*r,o=this.offset.x/i*t,s=this.offset.y/i*r,u=new b2.PolygonShape;return u.SetAsBox(f,e,new b2.Vec2(o,s),0),u}});cc.PhysicsBoxCollider=t.exports=r},{"../CCPhysicsTypes":171}],176:[function(n,t){"use strict";var i=n("../CCPhysicsTypes").PTM_RATIO,r=cc.Class({name:"cc.PhysicsChainCollider","extends":cc.PhysicsCollider,editor:{menu:!1,inspector:!1,requireComponent:cc.RigidBody},properties:{loop:!1,points:{"default":function(){return[cc.v2(-50,0),cc.v2(50,0)]},type:[cc.Vec2]},threshold:{"default":1,serializable:!1,visible:!1}},_createShape:function(n){for(var f,r=new b2.ChainShape,e=this.points,t=[],u=0;u<e.length;u++)f=e[u],t.push(new b2.Vec2(f.x/i*n.x,f.y/i*n.y));return this.loop?r.CreateLoop(t,t.length):r.CreateChain(t,t.length),r},resetInEditor:!1,resetPointsByContour:!1});cc.PhysicsChainCollider=t.exports=r},{"../CCPhysicsTypes":171}],177:[function(n,t){"use strict";var i=n("../CCPhysicsTypes").PTM_RATIO,r=cc.Class({name:"cc.PhysicsCircleCollider","extends":cc.PhysicsCollider,mixins:[cc.Collider.Circle],editor:{menu:!1,requireComponent:cc.RigidBody},_createShape:function(n){var r=Math.abs(n.x),u=Math.abs(n.y),f=this.offset.x/i*r,e=this.offset.y/i*u,t=new b2.CircleShape;return t.m_radius=this.radius/i*r,t.m_p=new b2.Vec2(f,e),t}});cc.PhysicsCircleCollider=t.exports=r},{"../CCPhysicsTypes":171}],178:[function(n,t){"use strict";var r=n("../CCPhysicsTypes").PTM_RATIO,u=n("../utils").getWorldScale,i=new b2.AABB,f=cc.Class({name:"cc.PhysicsCollider","extends":cc.Collider,ctor:function(){this._fixtures=[];this._shapes=[];this._inited=!1;this._rect=cc.rect()},properties:{_density:1,_sensor:!1,_friction:.2,_restitution:0,density:{tooltip:!1,get:function(){return this._density},set:function(n){this._density=n}},sensor:{tooltip:!1,get:function(){return this._sensor},set:function(n){this._sensor=n}},friction:{tooltip:!1,get:function(){return this._friction},set:function(n){this._friction=n}},restitution:{tooltip:!1,get:function(){return this._restitution},set:function(n){this._restitution=n}},body:{"default":null,type:cc.RigidBody,visible:!1}},onDisable:function(){this._destroy()},onEnable:function(){this._init()},start:function(){this._init()},_getFixtureIndex:function(n){return this._fixtures.indexOf(n)},_init:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__init",[])},_destroy:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__destroy",[])},__init:function(){var t,s,f,r,i,c,n,o;if(!this._inited&&(t=this.body||this.getComponent(cc.RigidBody),t&&(s=t._getBody(),s))){f=t.node;r=u(f);this._scale=r;i=0===r.x&&0===r.y?[]:this._createShape(r);i instanceof Array||(i=[i]);for(var v=1<<f.groupIndex,l=0,a=cc.game.collisionMatrix[f.groupIndex],e=0;e<a.length;e++)a[e]&&(l|=1<<e);for(var y={categoryBits:v,maskBits:l,groupIndex:0},p=cc.director.getPhysicsManager(),h=0;h<i.length;h++)c=i[h],n=new b2.FixtureDef,n.density=this.density,n.isSensor=this.sensor,n.friction=this.friction,n.restitution=this.restitution,n.shape=c,n.filter=y,o=s.CreateFixture(n),o.collider=this,t.enabledContactListener&&p._registerContactFixture(o),this._shapes.push(c),this._fixtures.push(o);this.body=t;this._inited=!0}},__destroy:function(){var n;if(this._inited){for(var i=this._fixtures,r=this.body._getBody(),u=cc.director.getPhysicsManager(),t=i.length-1;t>=0;t--)n=i[t],n.collider=null,u._unregisterContactFixture(n),r&&r.DestroyFixture(n);this.body=null;this._fixtures.length=0;this._shapes.length=0;this._inited=!1}},_createShape:function(){},apply:function(){this._destroy();this._init()},getAABB:function(){for(var n,t=1e7,u=1e7,f=-1e7,e=-1e7,l=this.body._getBody().GetTransform(),h=this._fixtures,o=0;o<h.length;o++)for(var c=h[o].GetShape(),a=c.GetChildCount(),s=0;s<a;s++)c.ComputeAABB(i,l,s),i.lowerBound.x<t&&(t=i.lowerBound.x),i.lowerBound.y<u&&(u=i.lowerBound.y),i.upperBound.x>f&&(f=i.upperBound.x),i.upperBound.y>e&&(e=i.upperBound.y);return t*=r,u*=r,f*=r,e*=r,n=this._rect,n.x=t,n.y=u,n.width=f-t,n.height=e-u,n}});cc.PhysicsCollider=t.exports=f},{"../CCPhysicsTypes":171,"../utils":194}],179:[function(n,t){"use strict";var i=n("../CCPhysicsTypes").PTM_RATIO,r=n("../CCPolygonSeparator"),u=cc.Class({name:"cc.PhysicsPolygonCollider","extends":cc.PhysicsCollider,mixins:[cc.Collider.Polygon],editor:{menu:!1,inspector:!1,requireComponent:cc.RigidBody},_createShape:function(n){var o=[],f=this.points;f.length>0&&f[0].equals(f[f.length-1])&&(f.length-=1);for(var c=r.ConvexPartition(f),l=this.offset,s=0;s<c.length;s++){for(var a=c[s],u=null,t=[],h=null,e=0,v=a.length;e<v;e++){u||(u=new b2.PolygonShape);var y=a[e],w=(y.x+l.x)/i*n.x,b=(y.y+l.y)/i*n.y,p=new b2.Vec2(w,b);t.push(p);h||(h=p);t.length===b2.maxPolygonVertices&&(u.Set(t,t.length),o.push(u),u=null,e<v-1&&(t=[h,t[t.length-1]]))}u&&(u.Set(t,t.length),o.push(u))}return o}});cc.PhysicsPolygonCollider=t.exports=u},{"../CCPhysicsTypes":171,"../CCPolygonSeparator":172}],180:[function(n){"use strict";n("./box2d-adapter");n("./CCPhysicsManager");n("./CCRigidBody");n("./CCPhysicsContact");n("./collider/CCPhysicsCollider");n("./collider/CCPhysicsChainCollider");n("./collider/CCPhysicsCircleCollider");n("./collider/CCPhysicsBoxCollider");n("./collider/CCPhysicsPolygonCollider");n("./joint/CCJoint");n("./joint/CCDistanceJoint");n("./joint/CCRevoluteJoint");n("./joint/CCMouseJoint");n("./joint/CCMotorJoint");n("./joint/CCPrismaticJoint");n("./joint/CCWeldJoint");n("./joint/CCWheelJoint");n("./joint/CCRopeJoint");n("./platform/CCPhysicsContactListner");n("./platform/CCPhysicsAABBQueryCallback");n("./platform/CCPhysicsRayCastCallback")},{"./CCPhysicsContact":169,"./CCPhysicsManager":170,"./CCRigidBody":173,"./box2d-adapter":174,"./collider/CCPhysicsBoxCollider":175,"./collider/CCPhysicsChainCollider":176,"./collider/CCPhysicsCircleCollider":177,"./collider/CCPhysicsCollider":178,"./collider/CCPhysicsPolygonCollider":179,"./joint/CCDistanceJoint":181,"./joint/CCJoint":182,"./joint/CCMotorJoint":183,"./joint/CCMouseJoint":184,"./joint/CCPrismaticJoint":185,"./joint/CCRevoluteJoint":186,"./joint/CCRopeJoint":187,"./joint/CCWeldJoint":188,"./joint/CCWheelJoint":189,"./platform/CCPhysicsAABBQueryCallback":190,"./platform/CCPhysicsContactListner":191,"./platform/CCPhysicsRayCastCallback":193}],181:[function(n,t){"use strict";var i=n("../CCPhysicsTypes").PTM_RATIO,r=cc.Class({name:"cc.DistanceJoint","extends":cc.Joint,editor:!1,properties:{_distance:1,_frequency:0,_dampingRatio:0,distance:{tooltip:!1,get:function(){return this._distance},set:function(n){this._distance=n;this._joint&&this._joint.SetLength(n)}},frequency:{tooltip:!1,get:function(){return this._frequency},set:function(n){this._frequency=n;this._joint&&this._joint.SetFrequency(n)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(n){this._dampingRatio=n;this._joint&&this._joint.SetDampingRatio(n)}}},_createJointDef:function(){var n=new b2.DistanceJointDef;return n.localAnchorA=new b2.Vec2(this.anchor.x/i,this.anchor.y/i),n.localAnchorB=new b2.Vec2(this.connectedAnchor.x/i,this.connectedAnchor.y/i),n.length=this.distance/i,n.dampingRatio=this.dampingRatio,n.frequencyHz=this.frequency,n}});cc.DistanceJoint=t.exports=r},{"../CCPhysicsTypes":171}],182:[function(n,t){"use strict";var i=n("../CCPhysicsTypes").PTM_RATIO,r=cc.Class({name:"cc.Joint","extends":cc.Component,editor:{requireComponent:cc.RigidBody},properties:{anchor:{"default":cc.v2(0,0),tooltip:!1},connectedAnchor:{"default":cc.v2(0,0),tooltip:!1},connectedBody:{"default":null,type:cc.RigidBody,tooltip:!1},collideConnected:{"default":!1,tooltip:!1}},onDisable:function(){this._destroy()},onEnable:function(){this._init()},start:function(){this._init()},apply:function(){this._destroy();this._init()},getWorldAnchor:function(){if(this._joint){var n=this._joint.GetAnchorA();return cc.v2(n.x*i,n.y*i)}return cc.Vec2.ZERO},getWorldConnectedAnchor:function(){if(this._joint){var n=this._joint.GetAnchorB();return cc.v2(n.x*i,n.y*i)}return cc.Vec2.ZERO},getReactionForce:function(n){var t=cc.v2();return this._joint?this._joint.GetReactionForce(n,t):t},getReactionTorque:function(n){return this._joint?this._joint.GetReactionTorque(n):0},_init:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__init",[])},_destroy:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__destroy",[])},__init:function(){if(!this._inited&&(this.body=this.getComponent(cc.RigidBody),this._isValid())){var n=this._createJointDef();if(!n)return;n.bodyA=this.body._getBody();n.bodyB=this.connectedBody._getBody();n.collideConnected=this.collideConnected;cc.director.getPhysicsManager()._addJoint(this,n);this._inited=!0}},__destroy:function(){this._inited&&(cc.director.getPhysicsManager()._removeJoint(this),this._joint=null,this._inited=!1)},_createJointDef:function(){return null},_isValid:function(){return this.body&&this.body._getBody()&&this.connectedBody&&this.connectedBody._getBody()}});cc.Joint=t.exports=r},{"../CCPhysicsTypes":171}],183:[function(n,t){"use strict";var i=n("../CCPhysicsTypes").PTM_RATIO,r=n("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,u=cc.Class({name:"cc.MotorJoint","extends":cc.Joint,editor:!1,properties:{_linearOffset:cc.v2(0,0),_angularOffset:0,_maxForce:1,_maxTorque:1,_correctionFactor:.3,anchor:{tooltip:!1,"default":cc.v2(0,0),override:!0,visible:!1},connectedAnchor:{tooltip:!1,"default":cc.v2(0,0),override:!0,visible:!1},linearOffset:{tooltip:!1,get:function(){return this._linearOffset},set:function(n){this._linearOffset=n;this._joint&&this._joint.SetLinearOffset(new b2.Vec2(n.x/i,n.y/i))}},angularOffset:{tooltip:!1,get:function(){return this._angularOffset},set:function(n){this._angularOffset=n;this._joint&&this._joint.SetAngularOffset(n)}},maxForce:{tooltip:!1,get:function(){return this._maxForce},set:function(n){this._maxForce=n;this._joint&&this._joint.SetMaxForce(n)}},maxTorque:{tooltip:!1,get:function(){return this._maxTorque},set:function(n){this._maxTorque=n;this._joint&&this._joint.SetMaxTorque(n)}},correctionFactor:{tooltip:!1,get:function(){return this._correctionFactor},set:function(n){this._correctionFactor=n;this._joint&&this._joint.SetCorrectionFactor(n)}}},_createJointDef:function(){var n=new b2.MotorJointDef;return n.linearOffset=new b2.Vec2(this.linearOffset.x/i,this.linearOffset.y/i),n.angularOffset=this.angularOffset*r,n.maxForce=this.maxForce,n.maxTorque=this.maxTorque,n.correctionFactor=this.correctionFactor,n}});cc.MotorJoint=t.exports=u},{"../CCPhysicsTypes":171}],184:[function(n,t){"use strict";var r=n("../CCPhysicsTypes").PTM_RATIO,i=new b2.Vec2,u=cc.Class({name:"cc.MouseJoint","extends":cc.Joint,editor:!1,properties:{_target:1,_frequency:5,_dampingRatio:.7,_maxForce:0,connectedBody:{"default":null,type:cc.RigidBody,visible:!1,override:!0},collideConnected:{"default":!0,visible:!1,override:!0},anchor:{tooltip:!1,"default":cc.v2(0,0),override:!0,visible:!1},connectedAnchor:{tooltip:!1,"default":cc.v2(0,0),override:!0,visible:!1},mouseRegion:{tooltip:!1,"default":null,type:cc.Node},target:{tooltip:!1,visible:!1,get:function(){return this._target},set:function(n){this._target=n;this._joint&&(i.x=n.x/r,i.y=n.y/r,this._joint.SetTarget(i))}},frequency:{tooltip:!1,get:function(){return this._frequency},set:function(n){this._frequency=n;this._joint&&this._joint.SetFrequency(n)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(n){this._dampingRatio=n;this._joint&&this._joint.SetDampingRatio(n)}},maxForce:{tooltip:!1,visible:!1,get:function(){return this._maxForce},set:function(n){this._maxForce=n;this._joint&&this._joint.SetMaxForce(n)}}},onLoad:function(){var n=this.mouseRegion||this.node;n.on(cc.Node.EventType.TOUCH_START,this.onTouchBegan,this);n.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this);n.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this);n.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},onEnable:function(){},start:function(){},onTouchBegan:function(n){var r=cc.director.getPhysicsManager(),t=this._pressPoint=n.touch.getLocation(),i;cc.Camera&&cc.Camera.main&&(t=cc.Camera.main.getScreenToWorldPoint(t));i=r.testPoint(t);i&&((this.connectedBody=i.body).awake=!0,this.maxForce=1e3*this.connectedBody.getMass(),this.target=t,this._init())},onTouchMove:function(n){this._pressPoint=n.touch.getLocation()},onTouchEnd:function(){this._destroy();this._pressPoint=null},_createJointDef:function(){var n=new b2.MouseJointDef;return i.x=this.target.x/r,i.y=this.target.y/r,n.target=i,n.maxForce=this.maxForce,n.dampingRatio=this.dampingRatio,n.frequencyHz=this.frequency,n},update:function(){if(this._pressPoint&&this._isValid()){var n=cc.Camera.findCamera(this.node);this.target=n?n.getScreenToWorldPoint(this._pressPoint):this._pressPoint}}});cc.MouseJoint=t.exports=u},{"../CCPhysicsTypes":171}],185:[function(n,t){"use strict";var i=n("../CCPhysicsTypes").PTM_RATIO,r=n("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,u=cc.Class({name:"cc.PrismaticJoint","extends":cc.Joint,editor:!1,properties:{localAxisA:{"default":cc.v2(1,0),tooltip:!1},referenceAngle:{"default":0,tooltip:!1},enableLimit:{"default":!1,tooltip:!1},enableMotor:{"default":!1,tooltip:!1},lowerLimit:{"default":0,tooltip:!1},upperLimit:{"default":0,tooltip:!1},_maxMotorForce:0,_motorSpeed:0,maxMotorForce:{tooltip:!1,get:function(){return this._maxMotorForce},set:function(n){this._maxMotorForce=n;this._joint&&this._joint.SetMaxMotorForce(n)}},motorSpeed:{tooltip:!1,get:function(){return this._motorSpeed},set:function(n){this._motorSpeed=n;this._joint&&this._joint.SetMotorSpeed(n)}}},_createJointDef:function(){var n=new b2.PrismaticJointDef;return n.localAnchorA=new b2.Vec2(this.anchor.x/i,this.anchor.y/i),n.localAnchorB=new b2.Vec2(this.connectedAnchor.x/i,this.connectedAnchor.y/i),n.localAxisA=new b2.Vec2(this.localAxisA.x,this.localAxisA.y),n.referenceAngle=this.referenceAngle*r,n.enableLimit=this.enableLimit,n.lowerTranslation=this.lowerLimit/i,n.upperTranslation=this.upperLimit/i,n.enableMotor=this.enableMotor,n.maxMotorForce=this.maxMotorForce,n.motorSpeed=this.motorSpeed,n}});cc.PrismaticJoint=t.exports=u},{"../CCPhysicsTypes":171}],186:[function(n,t){"use strict";var r=n("../CCPhysicsTypes").PTM_RATIO,i=n("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,u=n("../CCPhysicsTypes").PHYSICS_ANGLE_TO_ANGLE,f=cc.Class({name:"cc.RevoluteJoint","extends":cc.Joint,editor:!1,properties:{_maxMotorTorque:0,_motorSpeed:0,_enableLimit:!1,_enableMotor:!1,referenceAngle:{"default":0,tooltip:!1},lowerAngle:{"default":0,tooltip:!1},upperAngle:{"default":0,tooltip:!1},maxMotorTorque:{tooltip:!1,get:function(){return this._maxMotorTorque},set:function(n){this._maxMotorTorque=n;this._joint&&this._joint.SetMaxMotorTorque(n)}},motorSpeed:{tooltip:!1,get:function(){return this._motorSpeed},set:function(n){this._motorSpeed=n;this._joint&&this._joint.SetMotorSpeed(n*i)}},enableLimit:{tooltip:!1,get:function(){return this._enableLimit},set:function(n){this._enableLimit=n;this._joint&&this._joint.EnableLimit(n)}},enableMotor:{tooltip:!1,get:function(){return this._enableMotor},set:function(n){this._enableMotor=n;this._joint&&this._joint.EnableMotor(n)}}},getJointAngle:function(){return this._joint?this._joint.GetJointAngle()*u:0},setLimits:function(n,t){if(this._joint)return this._joint.SetLimits(n*i,t*i)},_createJointDef:function(){var n=new b2.RevoluteJointDef;return n.localAnchorA=new b2.Vec2(this.anchor.x/r,this.anchor.y/r),n.localAnchorB=new b2.Vec2(this.connectedAnchor.x/r,this.connectedAnchor.y/r),n.lowerAngle=this.upperAngle*i,n.upperAngle=this.lowerAngle*i,n.maxMotorTorque=this.maxMotorTorque,n.motorSpeed=this.motorSpeed*i,n.enableLimit=this.enableLimit,n.enableMotor=this.enableMotor,n.referenceAngle=this.referenceAngle*i,n}});cc.RevoluteJoint=t.exports=f},{"../CCPhysicsTypes":171}],187:[function(n,t){"use strict";var i=n("../CCPhysicsTypes").PTM_RATIO,r=cc.Class({name:"cc.RopeJoint","extends":cc.Joint,editor:!1,properties:{_maxLength:1,maxLength:{tooltip:!1,get:function(){return this._maxLength},set:function(n){this._maxLength=n;this._joint&&this._joint.SetMaxLength(n)}}},_createJointDef:function(){var n=new b2.RopeJointDef;return n.localAnchorA=new b2.Vec2(this.anchor.x/i,this.anchor.y/i),n.localAnchorB=new b2.Vec2(this.connectedAnchor.x/i,this.connectedAnchor.y/i),n.maxLength=this.maxLength/i,n}});cc.RopeJoint=t.exports=r},{"../CCPhysicsTypes":171}],188:[function(n,t){"use strict";var i=n("../CCPhysicsTypes").PTM_RATIO,r=n("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,u=cc.Class({name:"cc.WeldJoint","extends":cc.Joint,editor:!1,properties:{referenceAngle:{"default":0,tooltip:!1},_frequency:0,_dampingRatio:0,frequency:{tooltip:!1,get:function(){return this._frequency},set:function(n){this._frequency=n;this._joint&&this._joint.SetFrequency(n)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(n){this._dampingRatio=n;this._joint&&this._joint.SetDampingRatio(n)}}},_createJointDef:function(){var n=new b2.WeldJointDef;return n.localAnchorA=new b2.Vec2(this.anchor.x/i,this.anchor.y/i),n.localAnchorB=new b2.Vec2(this.connectedAnchor.x/i,this.connectedAnchor.y/i),n.referenceAngle=this.referenceAngle*r,n.frequencyHz=this.frequency,n.dampingRatio=this.dampingRatio,n}});cc.WeldJoint=t.exports=u},{"../CCPhysicsTypes":171}],189:[function(n,t){"use strict";var i=n("../CCPhysicsTypes").PTM_RATIO,r=n("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,u=cc.Class({name:"cc.WheelJoint","extends":cc.Joint,editor:!1,properties:{_maxMotorTorque:0,_motorSpeed:0,_enableMotor:!1,_frequency:2,_dampingRatio:.7,localAxisA:{"default":cc.v2(1,0),tooltip:!1},maxMotorTorque:{tooltip:!1,get:function(){return this._maxMotorTorque},set:function(n){this._maxMotorTorque=n;this._joint&&this._joint.SetMaxMotorTorque(n)}},motorSpeed:{tooltip:!1,get:function(){return this._motorSpeed},set:function(n){this._motorSpeed=n;this._joint&&this._joint.SetMotorSpeed(n*r)}},enableMotor:{tooltip:!1,get:function(){return this._enableMotor},set:function(n){this._enableMotor=n;this._joint&&this._joint.EnableMotor(n)}},frequency:{tooltip:!1,get:function(){return this._frequency},set:function(n){this._frequency=n;this._joint&&this._joint.SetSpringFrequencyHz(n)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(n){this._dampingRatio=n;this._joint&&this._joint.SetDampingRatio(n)}}},_createJointDef:function(){var n=new b2.WheelJointDef;return n.localAnchorA=new b2.Vec2(this.anchor.x/i,this.anchor.y/i),n.localAnchorB=new b2.Vec2(this.connectedAnchor.x/i,this.connectedAnchor.y/i),n.localAxisA=new b2.Vec2(this.localAxisA.x,this.localAxisA.y),n.maxMotorTorque=this.maxMotorTorque,n.motorSpeed=this.motorSpeed*r,n.enableMotor=this.enableMotor,n.dampingRatio=this.dampingRatio,n.frequencyHz=this.frequency,n}});cc.WheelJoint=t.exports=u},{"../CCPhysicsTypes":171}],190:[function(n,t){"use strict";function i(){this._point=new b2.Vec2;this._isPoint=!1;this._fixtures=[]}var r=n("../CCPhysicsTypes").BodyType;i.prototype.init=function(n){n?(this._isPoint=!0,this._point.x=n.x,this._point.y=n.y):this._isPoint=!1;this._fixtures.length=0};i.prototype.ReportFixture=function(n){if(n.GetBody().GetType()===r.Dynamic)if(this._isPoint){if(n.TestPoint(this._point))return this._fixtures.push(n),!1}else this._fixtures.push(n);return!0};i.prototype.getFixture=function(){return this._fixtures[0]};i.prototype.getFixtures=function(){return this._fixtures};cc.PhysicsAABBQueryCallback=t.exports=i},{"../CCPhysicsTypes":171}],191:[function(n,t){"use strict";function i(){this._contactFixtures=[]}i.prototype.setBeginContact=function(n){this._BeginContact=n};i.prototype.setEndContact=function(n){this._EndContact=n};i.prototype.setPreSolve=function(n){this._PreSolve=n};i.prototype.setPostSolve=function(n){this._PostSolve=n};i.prototype.BeginContact=function(n){if(this._BeginContact){var i=n.GetFixtureA(),r=n.GetFixtureB(),t=this._contactFixtures;n._shouldReport=!1;-1===t.indexOf(i)&&-1===t.indexOf(r)||(n._shouldReport=!0,this._BeginContact(n))}};i.prototype.EndContact=function(n){this._EndContact&&n._shouldReport&&(n._shouldReport=!1,this._EndContact(n))};i.prototype.PreSolve=function(n,t){this._PreSolve&&n._shouldReport&&this._PreSolve(n,t)};i.prototype.PostSolve=function(n,t){this._PostSolve&&n._shouldReport&&this._PostSolve(n,t)};i.prototype.registerContactFixture=function(n){this._contactFixtures.push(n)};i.prototype.unregisterContactFixture=function(n){cc.js.array.remove(this._contactFixtures,n)};cc.PhysicsContactListener=t.exports=i},{}],192:[function(n,t){"use strict";function u(n){b2.Draw.call(this);this._drawer=n;this._xf=this._dxf=new b2.Transform}var r=n("../CCPhysicsTypes").PTM_RATIO,i=cc.v2(),f=cc.Color.GREEN,e=cc.Color.RED;cc.js.extend(u,b2.Draw);cc.js.mixin(u.prototype,{_DrawPolygon:function(n,t){for(var e,o,f=this._drawer,u=0;u<t;u++)b2.Transform.MulXV(this._xf,n[u],i),e=i.x*r,o=i.y*r,0===u?f.moveTo(e,o):f.lineTo(e,o);f.close()},DrawPolygon:function(n,t,i){this._applyStrokeColor(i);this._DrawPolygon(n,t);this._drawer.stroke()},DrawSolidPolygon:function(n,t,i){this._applyFillColor(i);this._DrawPolygon(n,t);this._drawer.fill();this._drawer.stroke()},_DrawCircle:function(n,t){var i=this._xf.p;this._drawer.circle((n.x+i.x)*r,(n.y+i.y)*r,t*r)},DrawCircle:function(n,t,i){this._applyStrokeColor(i);this._DrawCircle(n,t);this._drawer.stroke()},DrawSolidCircle:function(n,t,i,r){this._applyFillColor(r);this._DrawCircle(n,t);this._drawer.fill()},DrawSegment:function(n,t,u){var f=this._drawer;if(n.x===t.x&&n.y===t.y)return this._applyFillColor(u),this._DrawCircle(n,2/r),void f.fill();this._applyStrokeColor(u);b2.Transform.MulXV(this._xf,n,i);f.moveTo(i.x*r,i.y*r);b2.Transform.MulXV(this._xf,t,i);f.lineTo(i.x*r,i.y*r);f.stroke()},DrawTransform:function(n){var t=this._drawer;t.strokeColor=e;i.x=i.y=0;b2.Transform.MulXV(n,i,i);t.moveTo(i.x*r,i.y*r);i.x=1;i.y=0;b2.Transform.MulXV(n,i,i);t.lineTo(i.x*r,i.y*r);t.stroke();t.strokeColor=f;i.x=i.y=0;b2.Transform.MulXV(n,i,i);t.moveTo(i.x*r,i.y*r);i.x=0;i.y=1;b2.Transform.MulXV(n,i,i);t.lineTo(i.x*r,i.y*r);t.stroke()},DrawPoint:function(){},_applyStrokeColor:function(n){var t=this._drawer.strokeColor;t.r=255*n.r;t.g=255*n.g;t.b=255*n.b;t.a=150;this._drawer.strokeColor=t},_applyFillColor:function(n){var t=this._drawer.fillColor;t.r=255*n.r;t.g=255*n.g;t.b=255*n.b;t.a=150;this._drawer.fillColor=t},PushTransform:function(n){this._xf=n},PopTransform:function(){this._xf=this._dxf}});t.exports=u},{"../CCPhysicsTypes":171}],193:[function(n,t){"use strict";function i(){this._type=0;this._fixtures=[];this._points=[];this._normals=[];this._fractions=[]}i.prototype.init=function(n){this._type=n;this._fixtures.length=0;this._points.length=0;this._normals.length=0;this._fractions.length=0};i.prototype.ReportFixture=function(n,t,i,r){return 0===this._type?(this._fixtures[0]=n,this._points[0]=t,this._normals[0]=i,this._fractions[0]=r,r):(this._fixtures.push(n),this._points.push(cc.v2(t)),this._normals.push(cc.v2(i)),this._fractions.push(r),1===this._type?0:this._type>=2?1:r)};i.prototype.getFixtures=function(){return this._fixtures};i.prototype.getPoints=function(){return this._points};i.prototype.getNormals=function(){return this._normals};i.prototype.getFractions=function(){return this._fractions};cc.PhysicsRayCastCallback=t.exports=i},{}],194:[function(n,t){"use strict";t.exports={getWorldRotation:function(n){for(var i=n.angle,t=n.parent;t.parent;)i+=t.angle,t=t.parent;return-i},getWorldScale:function(n){for(var i=n.scaleX,r=n.scaleY,t=n.parent;t.parent;)i*=t.scaleX,r*=t.scaleY,t=t.parent;return cc.v2(i,r)},convertToNodeRotation:function(n,t){t-=-n.angle;for(var i=n.parent;i.parent;)t-=-i.angle,i=i.parent;return t}}},{}],195:[function(n,t){"use strict";function a(n,t){n.indexOf(t)<0&&n.push(t)}function d(n,t){a(n.__props__,t)}function g(n,t,i,u){var f=u.default;r.setClassAttr(n,i,"default",f);d(n,i);k(n,u,0,i)}function nt(n,t,u,f,e){var h=f.get,c=f.set,s=n.prototype,o=!Object.getOwnPropertyDescriptor(s,u);h&&(k(n,f,0,u),r.setClassAttr(n,u,"serializable",!1),e||i.get(s,u,h,o,o));c&&(e||i.set(s,u,c,o,o))}function v(n){return"function"==typeof n?n():n}function s(n,t,r){for(var u in t)n.hasOwnProperty(u)||r&&!r(u)||Object.defineProperty(n,u,i.getPropertyDescriptor(t,u))}function tt(n,t,f,e){var c,o,p=e.__ctor__,w=e.ctor,v=e.__ES6__,l,a,h;if(v?(c=[w],o=w):(c=p?[p]:ft(t,f,e),o=y(c,t,n,e),i.value(o,"extend",function(n){return n.extends=this,u(n)},!0)),i.value(o,"__ctors__",c.length>0?c:null,!0),l=o.prototype,t&&(v||(i.extend(o,t),l=o.prototype),o.$super=t),f){for(a=f.length-1;a>=0;a--)h=f[a],s(l,h.prototype),s(o,h,function(n){return h.hasOwnProperty(n)&&!0}),u._isCCClass(h)&&s(r.getClassAttrs(o),r.getClassAttrs(h));l.constructor=o}return v||(l.__initProps__=ut),i.setClassName(n,o),o}function it(n,t,r,u){var o=cc.Component,f=cc._RF.peek(),e,s;if(f&&i.isChildClassOf(t,o)){if(i.isChildClassOf(f.cls,o))return cc.errorID(3615),null;n=n||f.script}return e=tt(n,t,r,u),f&&(i.isChildClassOf(t,o)?(s=f.uuid,s&&i._setClassId(s,e),f.cls=e):i.isChildClassOf(f.cls,o)||(f.cls=e)),e}function rt(n,t){var i=null,r=0,u=0;return function(){for(var c,p,e,w,l,a,v,o=null,s=null,h=null,y=0;y<t.length;++y)c=t[y],p=c+f+"default",p in n&&(e=n[p],"object"==typeof e&&e||"function"==typeof e?e instanceof cc.ValueType?(s||(s=[]),s.push(c,e)):(h||(h=[]),h.push(c,e)):(o||(o=[]),o.push(c,e)));for(r=o?o.length:0,w=(u=r+(s?s.length:0))+(h?h.length:0),i=new Array(w),l=0;l<r;++l)i[l]=o[l];for(a=r;a<u;++a)i[a]=s[a-r];for(v=u;v<w;++v)i[v]=h[v-u]}(),function(){for(var f,t,n=0;n<r;n+=2)this[i[n]]=i[n+1];for(;n<u;n+=2)this[i[n]]=i[n+1].clone();for(;n<i.length;n+=2)t=i[n+1],Array.isArray(t)?this[i[n]]=[]:(f="object"==typeof t?{}:t(),this[i[n]]=f)}}function ut(n){var u=r.getClassAttrs(n),t=n.__props__,i;null===t&&(o.init(),t=n.__props__);i=rt(u,t);n.prototype.__initProps__=i;i.call(this)}function ft(n,t,i){for(var s,h,f,c,r,e=[],l=[n].concat(t),o=0;o<l.length;o++)if(s=l[o],s)for(h=(r=s,u._isCCClass(r)?r.__ctors__||[]:[r]),f=0;f<h.length;f++)a(e,h[f]);return c=i.ctor,c&&e.push(c),e}function et(n,t){var s=!1,r,u,f,o;for(r in t)if(!(e.indexOf(r)>=0)&&(u=t[r],"function"==typeof u&&(f=i.getPropertyDescriptor(n.prototype,r),f&&(o=f.value,"function"==typeof o)))){p.test(u)&&(s=!0,t[r]=function(n,t){return function(){var r=this._super,i;return this._super=n,i=t.apply(this,arguments),this._super=r,i}}(o,u));continue}return s}function w(n,t,i,u,e,o){var s,a,h,c,v;if(n.__props__=[],u&&u.__props__&&(n.__props__=u.__props__.slice()),e)for(s=0;s<e.length;++s)a=e[s],a.__props__&&(n.__props__=n.__props__.concat(a.__props__.filter(function(t){return n.__props__.indexOf(t)<0})));if(i)for(h in l.preprocessAttrs(i,t,n,o),i)c=i[h],"default"in c?g(n,0,h,c):nt(n,0,h,c,o);v=r.getClassAttrs(n);n.__values__=n.__props__.filter(function(n){return!1!==v[n+f+"serializable"]})}function u(n){var u=(n=n||{}).name,r=n.extends,s=n.mixins,t=it(u,r,s,n),h,a,c,f,v,y;if(u||(u=cc.js.getClassName(t)),t._sealed=!0,r&&(r._sealed=!1),h=n.properties,"function"==typeof h||r&&null===r.__props__||s&&s.some(function(n){return null===n.__props__})?(o.push({cls:t,props:h,mixins:s}),t.__props__=t.__values__=null):w(t,u,h,r,n.mixins,n.__ES6__),c=n.statics,c)for(a in c)t[a]=c[a];for(f in n)e.indexOf(f)>=0||(v=n[f],l.validateMethodWithProps(v,f,u,t,r)&&i.value(t.prototype,f,v,!0,!0));return y=n.editor,y&&i.isChildClassOf(r,cc.Component)&&cc.Component._registerEditorProps(t,y),t}function k(n,t,i,u){function c(){return o=u+f,e=r.getClassAttrs(n)}function a(n,i){if(n in t){var r=t[n];typeof r===i&&((e||c())[o+n]=r)}}var e=null,o="",s=t.type,l;s&&(b[s]?(e||c())[o+"type"]=s:"Object"===s||(s===r.ScriptUuid?((e||c())[o+"type"]="Script",e[o+"ctor"]=cc.ScriptAsset):"object"==typeof s?h.isEnum(s)&&((e||c())[o+"type"]="Enum",e[o+"enumList"]=h.getList(s)):"function"==typeof s&&((e||c())[o+"type"]="Object",e[o+"ctor"]=s)));t.editorOnly&&((e||c())[o+"editorOnly"]=!0);!1===t.serializable&&((e||c())[o+"serializable"]=!1);a("formerlySerializedAs","string");l=t.range;l&&Array.isArray(l)&&l.length>=2&&((e||c())[o+"min"]=l[0],e[o+"max"]=l[1],l.length>2&&(e[o+"step"]=l[2]));a("min","number");a("max","number");a("step","number")}var i=n("./js"),h=n("./CCEnum"),c=n("./utils"),r=(c.isPlainEmptyObj_DEV,c.cloneable_DEV,n("./attribute")),f=r.DELIMETER,l=n("./preprocess-class"),e,o,y,p,b;n("./requiring-frame");e=["name","extends","mixins","ctor","__ctor__","properties","statics","editor","__ES6__"];o={datas:null,push:function(n){if(this.datas)this.datas.push(n);else{this.datas=[n];var t=this;setTimeout(function(){t.init()},0)}},init:function(){var r=this.datas,t,e;if(r){for(t=0;t<r.length;++t){var u=r[t],f=u.cls,n=u.props;"function"==typeof n&&(n=n());e=i.getClassName(f);n?w(f,e,n,f.$super,u.mixins):cc.errorID(3633,e)}this.datas=null}}};y=function(n,t,i,r){var u,e=t&&et(t,r),f=n.length;return u=f>0?e?2===f?function(){this._super=null;this.__initProps__(u);n[0].apply(this,arguments);n[1].apply(this,arguments)}:function(){this._super=null;this.__initProps__(u);for(var t=0;t<n.length;++t)n[t].apply(this,arguments)}:3===f?function(){this.__initProps__(u);n[0].apply(this,arguments);n[1].apply(this,arguments);n[2].apply(this,arguments)}:function(){this.__initProps__(u);for(var t=u.__ctors__,n=0;n<t.length;++n)t[n].apply(this,arguments)}:function(){e&&(this._super=null);this.__initProps__(u)}};p=/xyz/.test(function(){xyz})?/\b\._super\b/:/.*/;/xyz/.test(function(){xyz});u._isCCClass=function(n){return n&&n.hasOwnProperty("__ctors__")};u._fastDefine=function(n,t,u){var e;i.setClassName(n,t);for(var s=t.__props__=t.__values__=Object.keys(u),h=r.getClassAttrs(t),o=0;o<s.length;o++)e=s[o],h[e+f+"visible"]=!1,h[e+f+"default"]=u[e]};u.Attr=r;u.attr=r.attr;u.getInheritanceChain=function(n){for(var t=[];n=i.getSuper(n);)n!==Object&&t.push(n);return t};b={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"};cc.Class=u;t.exports={isArray:function(n){return n=v(n),Array.isArray(n)},fastDefine:u._fastDefine,getNewValueTypeCode:!1,IDENTIFIER_RE:/^[A-Za-z_$][0-9A-Za-z_$]*$/,escapeForJS:function(n){return JSON.stringify(n).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},getDefault:v}},{"./CCEnum":197,"./attribute":207,"./js":216,"./preprocess-class":217,"./requiring-frame":218,"./utils":219}],196:[function(n,t){"use strict";function w(n){return n}function r(n,t){return n[t]||(n[t]={})}function f(n){return function(t){return"function"==typeof t?n(t):function(i){return n(i,t)}}}function h(n,t){return function(n){return function(i){return t(i,n)}}}function l(){return h.bind(null,!1)}function s(n){return r(n,o)}function b(n){var t;try{t=n()}catch(i){return i={},n}return"object"!=typeof t||null===t?t:n}function k(n){var t;try{t=new n}catch(i){return i={},{}}return t}function d(n,t,i,r,u,f){var c,l=u&&(u.get||u.set),a,o,s,h;r&&(c=p.getFullFormOfProperty(r,l));a=t[i];o=e.mixin(a||{},c||r||{});l?(u.get&&(o.get=u.get),u.set&&(o.set=u.set)):(s=void 0,u?u.initializer&&(s=b(u.initializer)):(h=f.default||(f.default=k(n)),h.hasOwnProperty(i)&&(s=h[i])),o.default=s);t[i]=o}function y(n,t,i){return n(function(n,u){var f=s(n),e,o;f&&(e=void 0!==i?i:u,o=r(f,"proto"),r(o,"editor")[t]=e)},t)}function i(n){return n(w)}var c,u,a,v;n("./CCClass");var p=n("./preprocess-class"),e=n("./js"),o="__ccclassCache__";c=h.bind(null,!1);u=l();a=l();v=f(function(n,t){var i=e.getSuper(n),r,u,f;return i===Object&&(i=null),r={name:t,"extends":i,ctor:n,__ES6__:!0},u=n[o],u&&(f=u.proto,f&&e.mixin(r,f),n[o]=void 0),cc.Class(r)});var g=i(f),nt=y(c,"requireComponent"),tt=i(u),it=y(a,"executionOrder"),rt=i(f),ut=i(f),ft=i(u),et=i(u),ot=i(u);cc._decorator=t.exports={ccclass:v,property:function(n,t,i){function f(n,t,i){var f=s(n.constructor),e,o;f&&(e=r(f,"proto"),o=r(e,"properties"),d(n.constructor,o,t,u,i,f))}var u=null;if(void 0===t)return u=n,f;f(n,t,i)},executeInEditMode:g,requireComponent:nt,menu:tt,executionOrder:it,disallowMultiple:rt,playOnFocus:ut,inspector:ft,icon:et,help:ot,mixins:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(n){var i=s(n);i&&(r(i,"proto").mixins=t)}}}},{"./CCClass":195,"./js":216,"./preprocess-class":217,"./utils":219}],197:[function(n,t){"use strict";function i(n){var i,t,f;if("__enums__"in n)return n;r.value(n,"__enums__",null,!0);for(var e=-1,o=Object.keys(n),u=0;u<o.length;u++){if(i=o[u],t=n[i],-1===t)t=++e,n[i]=t;else if("number"==typeof t)e=t;else if("string"==typeof t&&Number.isInteger(parseFloat(i)))continue;f=""+t;i!==f&&r.value(n,f,i)}return n}var r=n("./js");i.isEnum=function(n){return n&&n.hasOwnProperty("__enums__")};i.getList=function(n){var t,i,r;if(n.__enums__)return n.__enums__;t=n.__enums__=[];for(i in n)r=n[i],Number.isInteger(r)&&t.push({name:i,value:r});return t.sort(function(n,t){return n.value-t.value}),t};t.exports=cc.Enum=i},{"./js":216}],198:[function(n){"use strict";var i,r=n("../event-manager"),t=n("./CCInputManager");cc.Acceleration=function(n,t,i,r){this.x=n||0;this.y=t||0;this.z=i||0;this.timestamp=r||0};t.setAccelerometerEnabled=function(n){var t=this,i;t._accelEnabled!==n&&(t._accelEnabled=n,i=cc.director.getScheduler(),i.enableForTarget(t),t._accelEnabled?(t._registerAccelerometerEvent(),t._accelCurTime=0,i.scheduleUpdate(t)):(t._unregisterAccelerometerEvent(),t._accelCurTime=0,i.unscheduleUpdate(t)))};t.setAccelerometerInterval=function(n){this._accelInterval!==n&&(this._accelInterval=n)};t._registerKeyboardEvent=function(){cc.game.canvas.addEventListener("keydown",function(n){r.dispatchEvent(new cc.Event.EventKeyboard(n.keyCode,!0));n.stopPropagation();n.preventDefault()},!1);cc.game.canvas.addEventListener("keyup",function(n){r.dispatchEvent(new cc.Event.EventKeyboard(n.keyCode,!1));n.stopPropagation();n.preventDefault()},!1)};t._registerAccelerometerEvent=function(){var t=window,n=this,u,r;n._acceleration=new cc.Acceleration;n._accelDeviceEvent=t.DeviceMotionEvent||t.DeviceOrientationEvent;cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ&&(n._accelDeviceEvent=window.DeviceOrientationEvent);u=n._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation";r=navigator.userAgent;(/Android/.test(r)||/Adr/.test(r)&&cc.sys.browserType===cc.BROWSER_TYPE_UC)&&(n._minus=-1);i=n.didAccelerate.bind(n);t.addEventListener(u,i,!1)};t._unregisterAccelerometerEvent=function(){var n=window,t=this._accelDeviceEvent===n.DeviceMotionEvent?"devicemotion":"deviceorientation";i&&n.removeEventListener(t,i,!1)};t.didAccelerate=function(n){var i=this,e=window,r,u,o,t,f,h,s;i._accelEnabled&&(t=i._acceleration,i._accelDeviceEvent===window.DeviceMotionEvent?(f=n.accelerationIncludingGravity,r=i._accelMinus*f.x*.1,u=i._accelMinus*f.y*.1,o=.1*f.z):(r=n.gamma/90*.981,u=-n.beta/90*.981,o=n.alpha/90*.981),cc.view._isRotated&&(h=r,r=-u,u=h),t.x=r,t.y=u,t.z=o,t.timestamp=n.timeStamp||Date.now(),s=t.x,90===e.orientation?(t.x=-t.y,t.y=s):-90===e.orientation?(t.x=t.y,t.y=-s):180===e.orientation&&(t.x=-t.x,t.y=-t.y),cc.sys.os===cc.sys.OS_ANDROID&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_MOBILE_QQ&&(t.x=-t.x,t.y=-t.y))}},{"../event-manager":140,"./CCInputManager":199}],199:[function(n,t){"use strict";var f=n("./CCMacro"),i=n("./CCSys"),r=n("../event-manager"),e=f.TOUCH_TIMEOUT,u=cc.v2(),o={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.v2(0,0),_prevMousePoint:cc.v2(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:8,_accelEnabled:!1,_accelInterval:.2,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_canvasBoundingRect:{left:0,top:0,adjustedLeft:0,adjustedTop:0,width:0,height:0},_getUnUsedIndex:function(){for(var t,i=this._indexBitsUsed,r=cc.sys.now(),n=0;n<this._maxTouches;n++){if(!(1&i))return this._indexBitsUsed|=1<<n,n;if(t=this._touches[n],r-t._lastModified>e)return this._removeUsedIndexBit(n),delete this._touchesIntegerDict[t.getID()],n;i>>=1}return-1},_removeUsedIndexBit:function(n){if(!(n<0||n>=this._maxTouches)){var t=1<<n;t=~t;this._indexBitsUsed&=t}},_glView:null,_updateCanvasBoundingRect:function(){var t=cc.game.canvas,n=this._canvasBoundingRect,f=document.documentElement,r=window.pageXOffset-f.clientLeft,u=window.pageYOffset-f.clientTop,i;t.getBoundingClientRect?(i=t.getBoundingClientRect(),n.left=i.left+r,n.top=i.top+u,n.width=i.width,n.height=i.height):t instanceof HTMLCanvasElement?(n.left=r,n.top=u,n.width=t.width,n.height=t.height):(n.left=r,n.top=u,n.width=parseInt(t.style.width),n.height=parseInt(t.style.height))},handleTouchesBegin:function(n){for(var u,s,t,e,h,f=[],c=this._touchesIntegerDict,l=i.now(),o=0,a=n.length;o<a;o++)if(null==c[h=(t=n[o]).getID()]){if(u=this._getUnUsedIndex(),-1===u){cc.logID(2300,u);continue}(e=this._touches[u]=new cc.Touch(t._point.x,t._point.y,t.getID()))._lastModified=l;e._setPrevPoint(t._prevPoint);c[h]=u;f.push(e)}f.length>0&&(this._glView._convertTouchesWithScale(f),s=new cc.Event.EventTouch(f),s._eventCode=cc.Event.EventTouch.BEGAN,r.dispatchEvent(s))},handleTouchesMove:function(n){for(var s,e,t,h,f=[],u=this._touches,c=i.now(),o=0,l=n.length;o<l;o++)h=(e=n[o]).getID(),null!=(t=this._touchesIntegerDict[h])&&u[t]&&(u[t]._setPoint(e._point),u[t]._setPrevPoint(e._prevPoint),u[t]._lastModified=c,f.push(u[t]));f.length>0&&(this._glView._convertTouchesWithScale(f),s=new cc.Event.EventTouch(f),s._eventCode=cc.Event.EventTouch.MOVED,r.dispatchEvent(s))},handleTouchesEnd:function(n){var t=this.getSetOfTouchesEndOrCancel(n),i;t.length>0&&(this._glView._convertTouchesWithScale(t),i=new cc.Event.EventTouch(t),i._eventCode=cc.Event.EventTouch.ENDED,r.dispatchEvent(i));this._preTouchPool.length=0},handleTouchesCancel:function(n){var t=this.getSetOfTouchesEndOrCancel(n),i;t.length>0&&(this._glView._convertTouchesWithScale(t),i=new cc.Event.EventTouch(t),i._eventCode=cc.Event.EventTouch.CANCELED,r.dispatchEvent(i));this._preTouchPool.length=0},getSetOfTouchesEndOrCancel:function(n){for(var r,t,f,e=[],i=this._touches,o=this._touchesIntegerDict,u=0,s=n.length;u<s;u++)null!=(t=o[f=(r=n[u]).getID()])&&i[t]&&(i[t]._setPoint(r._point),i[t]._setPrevPoint(r._prevPoint),e.push(i[t]),this._removeUsedIndexBit(t),delete o[f]);return e},getPreTouch:function(n){for(var t=null,r=this._preTouchPool,u=n.getID(),i=r.length-1;i>=0;i--)if(r[i].getID()===u){t=r[i];break}return t||(t=n),t},setPreTouch:function(n){for(var r=!1,t=this._preTouchPool,u=n.getID(),i=t.length-1;i>=0;i--)if(t[i].getID()===u){t[i]=n;r=!0;break}r||(t.length<=50?t.push(n):(t[this._preTouchPoolPointer]=n,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(n,t,i){var r=this._preTouchPoint,u=this._glView.convertToLocationInView(n,t,i),f=new cc.Touch(u.x,u.y,0);return f._setPrevPoint(r.x,r.y),r.x=u.x,r.y=u.y,f},getMouseEvent:function(n,t,i){var r=this._prevMousePoint,u=new cc.Event.EventMouse(i);return u._setPrevCursor(r.x,r.y),r.x=n.x,r.y=n.y,this._glView._convertMouseToLocationInView(r,t),u.setLocation(r.x,r.y),u},getPointByEvent:function(n,t){return cc.sys.browserType!==cc.sys.BROWSER_TYPE_QQ&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_UC&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_SAFARI||this._updateCanvasBoundingRect(),null!=n.pageX?{x:n.pageX,y:n.pageY}:(t.left-=document.body.scrollLeft,t.top-=document.body.scrollTop,{x:n.clientX,y:n.clientY})},getTouchesByEvent:function(n,t){for(var f,r,e,s,c=[],l=this._glView,o=this._preTouchPoint,a=n.changedTouches.length,h=0;h<a;h++)(r=n.changedTouches[h])&&(f=i.BROWSER_TYPE_FIREFOX===i.browserType?l.convertToLocationInView(r.pageX,r.pageY,t,u):l.convertToLocationInView(r.clientX,r.clientY,t,u),null!=r.identifier?(e=new cc.Touch(f.x,f.y,r.identifier),s=this.getPreTouch(e).getLocation(),e._setPrevPoint(s.x,s.y),this.setPreTouch(e)):(e=new cc.Touch(f.x,f.y))._setPrevPoint(o.x,o.y),o.x=f.x,o.y=f.y,c.push(e));return c},registerSystemEvent:function(n){var t,u,e,h,a,v,c,y,p;if(!this._isRegisterEvent){this._glView=cc.view;t=this;u=this._canvasBoundingRect;window.addEventListener("resize",this._updateCanvasBoundingRect.bind(this));var o=i.isMobile,w="mouse"in i.capabilities,b="touches"in i.capabilities;if(w){o||(window.addEventListener("mousedown",function(){t._mousePressed=!0},!1),window.addEventListener("mouseup",function(n){var i,f;t._mousePressed&&(t._mousePressed=!1,i=t.getPointByEvent(n,u),cc.rect(u.left,u.top,u.width,u.height).contains(i)||(t.handleTouchesEnd([t.getTouchByXY(i.x,i.y,u)]),f=t.getMouseEvent(i,u,cc.Event.EventMouse.UP),f.setButton(n.button),r.dispatchEvent(f)))},!1));for(var f=cc.Event.EventMouse,l=[!o&&["mousedown",f.DOWN,function(i,r,u,f){t._mousePressed=!0;t.handleTouchesBegin([t.getTouchByXY(u.x,u.y,f)]);n.focus()}],!o&&["mouseup",f.UP,function(n,i,r,u){t._mousePressed=!1;t.handleTouchesEnd([t.getTouchByXY(r.x,r.y,u)])}],!o&&["mousemove",f.MOVE,function(n,i,r,u){t.handleTouchesMove([t.getTouchByXY(r.x,r.y,u)]);t._mousePressed||i.setButton(null)}],["mousewheel",f.SCROLL,function(n,t){t.setScrollData(0,n.wheelDelta)}],["DOMMouseScroll",f.SCROLL,function(n,t){t.setScrollData(0,-120*n.detail)}]],s=0;s<l.length;++s)e=l[s],e&&function(){var i=e[0],f=e[1],o=e[2];n.addEventListener(i,function(n){var e=t.getPointByEvent(n,u),i=t.getMouseEvent(e,u,f);i.setButton(n.button);o(n,i,e,u);r.dispatchEvent(i);n.stopPropagation();n.preventDefault()},!1)}()}if(window.navigator.msPointerEnabled){h={MSPointerDown:t.handleTouchesBegin,MSPointerMove:t.handleTouchesMove,MSPointerUp:t.handleTouchesEnd,MSPointerCancel:t.handleTouchesCancel};a=function(i){var r=h[i];n.addEventListener(i,function(n){var i=document.documentElement;u.adjustedLeft=u.left-i.scrollLeft;u.adjustedTop=u.top-i.scrollTop;r.call(t,[t.getTouchByXY(n.clientX,n.clientY,u)]);n.stopPropagation()},!1)};for(v in h)a(v)}if(b){c={touchstart:function(i){t.handleTouchesBegin(i);n.focus()},touchmove:function(n){t.handleTouchesMove(n)},touchend:function(n){t.handleTouchesEnd(n)},touchcancel:function(n){t.handleTouchesCancel(n)}};y=function(i){var r=c[i];n.addEventListener(i,function(n){if(n.changedTouches){var i=document.body;u.adjustedLeft=u.left-(i.scrollLeft||window.scrollX||0);u.adjustedTop=u.top-(i.scrollTop||window.scrollY||0);r(t.getTouchesByEvent(n,u));n.stopPropagation();n.preventDefault()}},!1)};for(p in c)y(p)}this._registerKeyboardEvent();this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(n){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,r.dispatchEvent(new cc.Event.EventAcceleration(this._acceleration)));this._accelCurTime+=n}};t.exports=cc.internal.inputManager=o},{"../event-manager":140,"./CCMacro":200,"./CCSys":204}],200:[function(n,t){"use strict";cc.macro={RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1192092896e-16,MIN_ZINDEX:-Math.pow(2,15),MAX_ZINDEX:Math.pow(2,15)-1,ONE:1,ZERO:0,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,DENSITYDPI_DEVICE:"device-dpi",DENSITYDPI_HIGH:"high-dpi",DENSITYDPI_MEDIUM:"medium-dpi",DENSITYDPI_LOW:"low-dpi",FIX_ARTIFACTS_BY_STRECHING_TEXEL_TMX:!0,DIRECTOR_STATS_POSITION:cc.v2(0,0),ENABLE_STACKABLE_ACTIONS:!0,TOUCH_TIMEOUT:5e3,BATCH_VERTEX_COUNT:2e4,ENABLE_TILEDMAP_CULLING:!0,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!1,ENABLE_CULLING:!1,CLEANUP_IMAGE_CACHE:!1,SHOW_MESH_WIREFRAME:!1,SHOW_MESH_NORMAL:!1,ENABLE_MULTI_TOUCH:!0,ALLOW_IMAGE_BITMAP:!cc.sys.isMobile,ENABLE_NATIVE_TTF_RENDERER:!0};Object.defineProperty(cc.macro,"ROTATE_ACTION_CCW",{set:function(n){cc.RotateTo&&cc.RotateBy&&(cc.RotateTo._reverse=cc.RotateBy._reverse=n)}});cc.macro.SUPPORT_TEXTURE_FORMATS=[".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"];cc.macro.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005};cc.macro.ImageFormat=cc.Enum({JPG:0,PNG:1,TIFF:2,WEBP:3,PVR:4,ETC:5,S3TC:6,ATITC:7,TGA:8,RAWDATA:9,UNKNOWN:10});cc.macro.BlendFactor=cc.Enum({ONE:1,ZERO:0,SRC_ALPHA:770,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775});cc.macro.TextAlignment=cc.Enum({LEFT:0,CENTER:1,RIGHT:2});cc.macro.VerticalTextAlignment=cc.Enum({TOP:0,CENTER:1,BOTTOM:2});t.exports=cc.macro},{}],201:[function(n,t){"use strict";function e(){this._name="";this._objFlags=0}function s(n,t){var i,e=n instanceof cc._BaseNode||n instanceof cc.Component,h=e?"_id":null,r={},f;for(i in n)if(n.hasOwnProperty(i)){if(i===h)continue;switch(typeof n[i]){case"string":r[i]="";break;case"object":case"function":r[i]=null}}if(cc.Class._isCCClass(t))for(var o=cc.Class.Attr.getClassAttrs(t),s=t.__props__,u=0;u<s.length;u++)if(f=(i=s[u])+cc.Class.Attr.DELIMETER+"default",f in o){if(e&&"_id"===i)continue;switch(typeof o[f]){case"string":r[i]="";break;case"object":case"function":r[i]=null;break;case"undefined":r[i]=void 0}}return function(n){for(var t in r)n[t]=r[t]}}var f=n("./js"),o=n("./CCClass"),i=1,u,r;o.fastDefine("cc.Object",e,{_name:"",_objFlags:0});f.value(e,"Flags",{Destroyed:i,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:2097152,IsRotationLocked:131072,IsScaleLocked:262144,IsAnchorLocked:524288,IsSizeLocked:1048576});u=[];f.value(e,"_deferredDestroy",function(){for(var r,n=u.length,t=0;t<n;++t)r=u[t],r._objFlags&i||r._destroyImmediate();n===u.length?u.length=0:u.splice(0,n)});r=e.prototype;f.getset(r,"name",function(){return this._name},function(n){this._name=n},!0);f.get(r,"isValid",function(){return!(this._objFlags&i)},!0);r.destroy=function(){return this._objFlags&i?(cc.warnID(5e3),!1):!(4&this._objFlags||(this._objFlags|=4,u.push(this),0))};r._destruct=function(){var t=this.constructor,n=t.__destruct__;n||(n=s(this,t),f.value(t,"__destruct__",n,!0));n(this)};r._onPreDestroy=null;r._destroyImmediate=function(){this._objFlags&i?cc.errorID(5e3):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),this._objFlags|=i)};r._deserialize=null;cc.isValid=function(n,t){return"object"==typeof n?!(!n||n._objFlags&(t?4|i:i)):void 0!==n};cc.Object=t.exports=e},{"./CCClass":195,"./js":216}],202:[function(n,t){"use strict";var i=n("../platform/js");cc.SAXParser=function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):(this._isSupportDOMParser=!1,this._parser=null)};cc.SAXParser.prototype={constructor:cc.SAXParser,parse:function(n){return this._parseXML(n)},_parseXML:function(n){var t;return this._isSupportDOMParser?t=this._parser.parseFromString(n,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(n)),t}};cc.PlistParser=function(){cc.SAXParser.call(this)};i.extend(cc.PlistParser,cc.SAXParser);i.mixin(cc.PlistParser.prototype,{parse:function(n){var r=this._parseXML(n),t=r.documentElement;if("plist"!==t.tagName)return cc.warnID(5100),{};for(var u=null,i=0,f=t.childNodes.length;i<f&&1!==(u=t.childNodes[i]).nodeType;i++);return r=null,this._parseNode(u)},_parseNode:function(n){var t=null,i=n.tagName,r;if("dict"===i)t=this._parseDict(n);else if("array"===i)t=this._parseArray(n);else if("string"===i)if(1===n.childNodes.length)t=n.firstChild.nodeValue;else for(t="",r=0;r<n.childNodes.length;r++)t+=n.childNodes[r].nodeValue;else"false"===i?t=!1:"true"===i?t=!0:"real"===i?t=parseFloat(n.firstChild.nodeValue):"integer"===i&&(t=parseInt(n.firstChild.nodeValue,10));return t},_parseArray:function(n){for(var i,r=[],t=0,u=n.childNodes.length;t<u;t++)i=n.childNodes[t],1===i.nodeType&&r.push(this._parseNode(i));return r},_parseDict:function(n){for(var t,r={},u=null,i=0,f=n.childNodes.length;i<f;i++)t=n.childNodes[i],1===t.nodeType&&("key"===t.tagName?u=t.firstChild.nodeValue:r[u]=this._parseNode(t));return r}});cc.saxParser=new cc.SAXParser;cc.plistParser=new cc.PlistParser;t.exports={saxParser:cc.saxParser,plistParser:cc.plistParser}},{"../platform/js":216}],203:[function(){"use strict";cc.screen={_supportsFullScreen:!1,_onfullscreenchange:null,_onfullscreenerror:null,_preOnFullScreenChange:null,_preOnFullScreenError:null,_preOnTouch:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement","fullscreenerror"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement","fullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement","msfullscreenerror"]],init:function(){this._fn={};for(var t,u,i=this._fnMap,n=0,r=i.length;n<r;n++)if((t=i[n])&&void 0!==document[t[1]]){for(n=0,u=t.length;n<u;n++)this._fn[i[0][n]]=t[n];break}this._supportsFullScreen=void 0!==this._fn.requestFullscreen;this._touchEvent="ontouchend"in window?"touchend":"mousedown"},fullScreen:function(){return!!this._supportsFullScreen&&!!(document[this._fn.fullscreenElement]||document[this._fn.webkitFullscreenElement]||document[this._fn.mozFullScreenElement])},requestFullScreen:function(n,t,i){var r,u,f;if(n&&"video"===n.tagName.toLowerCase()){if(cc.sys.os===cc.sys.OS_IOS&&cc.sys.isBrowser&&n.readyState>0)return void(n.webkitEnterFullscreen&&n.webkitEnterFullscreen());n.setAttribute("x5-video-player-fullscreen","true")}this._supportsFullScreen&&((n=n||document.documentElement,t)&&(r=this._fn.fullscreenchange,this._onfullscreenchange&&document.removeEventListener(r,this._onfullscreenchange),this._onfullscreenchange=t,document.addEventListener(r,t,!1)),i&&(u=this._fn.fullscreenerror,this._onfullscreenerror&&document.removeEventListener(u,this._onfullscreenerror),this._onfullscreenerror=i,document.addEventListener(u,i,{once:!0})),f=n[this._fn.requestFullscreen](),void 0===document[this._fn.fullscreenerror]&&window.Promise&&f instanceof Promise&&f.catch(function(){}))},exitFullScreen:function(n){if(n&&"video"===n.tagName.toLowerCase()){if(cc.sys.os===cc.sys.OS_IOS&&cc.sys.isBrowser)return void(n.webkitExitFullscreen&&n.webkitExitFullscreen());n.setAttribute("x5-video-player-fullscreen","false")}return!this._supportsFullScreen||document[this._fn.exitFullscreen]()},autoFullScreen:function(n,t){n=n||document.body;this._ensureFullScreen(n,t);this.requestFullScreen(n,t)},disableAutoFullScreen:function(n){var t=cc.game.canvas||n,i=this._touchEvent;this._preOnTouch&&(t.removeEventListener(i,this._preOnTouch),this._preOnTouch=null)},_ensureFullScreen:function(n,t){function e(){i._preOnFullScreenError=null;i._preOnTouch&&r.removeEventListener(f,i._preOnTouch);i._preOnTouch=function(){i._preOnTouch=null;i.requestFullScreen(n,t)};r.addEventListener(f,i._preOnTouch,{once:!0})}var i=this,r=cc.game.canvas||n,u=this._fn.fullscreenerror,f=this._touchEvent;this._preOnFullScreenError&&n.removeEventListener(u,this._preOnFullScreenError);this._preOnFullScreenError=e;n.addEventListener(u,e,{once:!0})}};cc.screen.init()},{}],204:[function(n,t){"use strict";window._CCSettings&&_CCSettings.platform;var i="undefined"==typeof window?global:window,r=cc&&cc.sys?cc.sys:function(){var s,y,n,f,e,c,b,v,r,l,o;if(cc.sys={},n=cc.sys,n.LANGUAGE_ENGLISH="en",n.LANGUAGE_CHINESE="zh",n.LANGUAGE_FRENCH="fr",n.LANGUAGE_ITALIAN="it",n.LANGUAGE_GERMAN="de",n.LANGUAGE_SPANISH="es",n.LANGUAGE_DUTCH="du",n.LANGUAGE_RUSSIAN="ru",n.LANGUAGE_KOREAN="ko",n.LANGUAGE_JAPANESE="ja",n.LANGUAGE_HUNGARIAN="hu",n.LANGUAGE_PORTUGUESE="pt",n.LANGUAGE_ARABIC="ar",n.LANGUAGE_NORWEGIAN="no",n.LANGUAGE_POLISH="pl",n.LANGUAGE_TURKISH="tr",n.LANGUAGE_UKRAINIAN="uk",n.LANGUAGE_ROMANIAN="ro",n.LANGUAGE_BULGARIAN="bg",n.LANGUAGE_UNKNOWN="unknown",n.OS_IOS="iOS",n.OS_ANDROID="Android",n.OS_WINDOWS="Windows",n.OS_MARMALADE="Marmalade",n.OS_LINUX="Linux",n.OS_BADA="Bada",n.OS_BLACKBERRY="Blackberry",n.OS_OSX="OS X",n.OS_WP8="WP8",n.OS_WINRT="WINRT",n.OS_UNKNOWN="Unknown",n.UNKNOWN=-1,n.WIN32=0,n.LINUX=1,n.MACOS=2,n.ANDROID=3,n.IPHONE=4,n.IPAD=5,n.BLACKBERRY=6,n.NACL=7,n.EMSCRIPTEN=8,n.TIZEN=9,n.WINRT=10,n.WP8=11,n.MOBILE_BROWSER=100,n.DESKTOP_BROWSER=101,n.EDITOR_PAGE=102,n.EDITOR_CORE=103,n.WECHAT_GAME=104,n.QQ_PLAY=105,n.FB_PLAYABLE_ADS=106,n.BAIDU_GAME=107,n.VIVO_GAME=108,n.OPPO_GAME=109,n.HUAWEI_GAME=110,n.XIAOMI_GAME=111,n.JKW_GAME=112,n.ALIPAY_GAME=113,n.WECHAT_GAME_SUB=114,n.BAIDU_GAME_SUB=115,n.QTT_GAME=116,n.BYTEDANCE_GAME=117,n.BYTEDANCE_GAME_SUB=118,n.LINKSURE=119,n.BROWSER_TYPE_WECHAT="wechat",n.BROWSER_TYPE_ANDROID="androidbrowser",n.BROWSER_TYPE_IE="ie",n.BROWSER_TYPE_EDGE="edge",n.BROWSER_TYPE_QQ="qqbrowser",n.BROWSER_TYPE_MOBILE_QQ="mqqbrowser",n.BROWSER_TYPE_UC="ucbrowser",n.BROWSER_TYPE_UCBS="ucbs",n.BROWSER_TYPE_360="360browser",n.BROWSER_TYPE_BAIDU_APP="baiduboxapp",n.BROWSER_TYPE_BAIDU="baidubrowser",n.BROWSER_TYPE_MAXTHON="maxthon",n.BROWSER_TYPE_OPERA="opera",n.BROWSER_TYPE_OUPENG="oupeng",n.BROWSER_TYPE_MIUI="miuibrowser",n.BROWSER_TYPE_FIREFOX="firefox",n.BROWSER_TYPE_SAFARI="safari",n.BROWSER_TYPE_CHROME="chrome",n.BROWSER_TYPE_LIEBAO="liebao",n.BROWSER_TYPE_QZONE="qzone",n.BROWSER_TYPE_SOUGOU="sogou",n.BROWSER_TYPE_HUAWEI="huawei",n.BROWSER_TYPE_UNKNOWN="unknown",n.isNative=!1,n.isBrowser="object"==typeof window&&"object"==typeof document&&!0,n.glExtension=function(n){return!!cc.renderer.device.ext(n)},n.getMaxJointMatrixSize=function(){if(!n._maxJointMatrixSize){var t=cc.game._renderContext,i=Math.floor(t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS)/4)-10;n._maxJointMatrixSize=i<50?0:50}return n._maxJointMatrixSize},n.getSafeAreaRect=function(){var n=cc.view.getVisibleSize();return cc.rect(0,0,n.width,n.height)},i.__globalAdapter&&i.__globalAdapter.adaptSys)i.__globalAdapter.adaptSys(n);else{var a=window,t=a.navigator,nt=document,k=nt.documentElement,u=t.userAgent.toLowerCase();n.isMobile=/mobile|android|iphone|ipad/.test(u);n.platform="undefined"!=typeof FbPlayableAd?n.FB_PLAYABLE_ADS:n.isMobile?n.MOBILE_BROWSER:n.DESKTOP_BROWSER;f=t.language;f=f||t.browserLanguage;n.languageCode=f.toLowerCase();f=f?f.split("-")[0]:n.LANGUAGE_ENGLISH;n.language=f;var d=!1,g=!1,h="",p=0,w=/android\s*(\d+(?:\.\d+)*)/i.exec(u)||/android\s*(\d+(?:\.\d+)*)/i.exec(t.platform);w&&(d=!0,h=w[1]||"",p=parseInt(h)||0);(w=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(u))?(g=!0,h=w[2]||"",p=parseInt(h)||0):(/(iPhone|iPad|iPod)/.exec(t.platform)||"MacIntel"===t.platform&&t.maxTouchPoints&&t.maxTouchPoints>1)&&(g=!0,h="",p=0);e=n.OS_UNKNOWN;-1!==t.appVersion.indexOf("Win")?e=n.OS_WINDOWS:g?e=n.OS_IOS:-1!==t.appVersion.indexOf("Mac")?e=n.OS_OSX:-1!==t.appVersion.indexOf("X11")&&-1===t.appVersion.indexOf("Linux")?e=n.OS_UNIX:d?e=n.OS_ANDROID:-1===t.appVersion.indexOf("Linux")&&-1===u.indexOf("ubuntu")||(e=n.OS_LINUX);n.os=e;n.osVersion=h;n.osMainVersion=p;n.browserType=n.BROWSER_TYPE_UNKNOWN,function(){var i=/mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|ucbs|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(u)||/qq|ucbrowser|ubrowser|edge|HuaweiBrowser/i.exec(u)||/chrome|safari|firefox|trident|opera|opr\/|oupeng/i.exec(u),t=i?i[0].toLowerCase():n.BROWSER_TYPE_UNKNOWN,r;"safari"===t&&d?t=n.BROWSER_TYPE_ANDROID:"qq"===t&&u.match(/android.*applewebkit/i)&&(t=n.BROWSER_TYPE_ANDROID);r={micromessenger:n.BROWSER_TYPE_WECHAT,trident:n.BROWSER_TYPE_IE,edge:n.BROWSER_TYPE_EDGE,"360 aphone":n.BROWSER_TYPE_360,mxbrowser:n.BROWSER_TYPE_MAXTHON,"opr/":n.BROWSER_TYPE_OPERA,ubrowser:n.BROWSER_TYPE_UC,huaweibrowser:n.BROWSER_TYPE_HUAWEI};n.browserType=r[t]||t}();n.browserVersion="";(y=u.match(/(mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|uc|ucbs|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui(?:.hybrid)?)(mobile)?(browser)?\/?([\d.]+)/i))||(y=u.match(/(qq|chrome|safari|firefox|trident|opera|opr\/|oupeng)(mobile)?(browser)?\/?([\d.]+)/i));n.browserVersion=y?y[4]:"";var ft=window.innerWidth||document.documentElement.clientWidth,et=window.innerHeight||document.documentElement.clientHeight,tt=window.devicePixelRatio||1;n.windowPixelResolution={width:tt*ft,height:tt*et};n._checkWebGLRenderMode=function(){if(cc.game.renderType!==cc.game.RENDER_TYPE_WEBGL)throw new Error("This feature supports WebGL render mode only.");};c=document.createElement("canvas");try{b=n.localStorage=a.localStorage;b.setItem("storage","");b.removeItem("storage");b=null}catch(it){it={};v=function(){cc.warnID(5200)};n.localStorage={getItem:v,setItem:v,removeItem:v,clear:v}}var ot=c.toDataURL("image/webp").startsWith("data:image/webp"),st=!!c.getContext("2d"),rt=!1;a.WebGLRenderingContext&&(rt=!0);l=n.capabilities={canvas:st,opengl:rt,webp:ot,imageBitmap:!1};"undefined"!=typeof createImageBitmap&&"undefined"!=typeof Blob&&(c.width=c.height=2,createImageBitmap(c,{}).then(function(n){l.imageBitmap=!0;n.close&&n.close()}).catch(function(){}));(void 0!==k.ontouchstart||void 0!==nt.ontouchstart||t.msPointerEnabled)&&(l.touches=!0);void 0!==k.onmouseup&&(l.mouse=!0);void 0!==k.onkeyup&&(l.keyboard=!0);(a.DeviceMotionEvent||a.DeviceOrientationEvent)&&(l.accelerometer=!0),function(){n.browserVersion;var t=!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext);r={ONLY_ONE:!1,WEB_AUDIO:t,DELAY_CREATE_CTX:!1};n.os===n.OS_IOS&&(r.USE_LOADER_EVENT="loadedmetadata");n.browserType===n.BROWSER_TYPE_FIREFOX&&(r.DELAY_CREATE_CTX=!0,r.USE_LOADER_EVENT="canplay");n.os===n.OS_ANDROID&&n.browserType===n.BROWSER_TYPE_UC&&(r.ONE_SOURCE=!0)}();try{r.WEB_AUDIO&&(r.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),r.DELAY_CREATE_CTX&&setTimeout(function(){r.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)},0))}catch(ut){ut={};r.WEB_AUDIO=!1;cc.logID(5201)}o=[];(s=document.createElement("audio")).canPlayType&&(s.canPlayType('audio/ogg; codecs="vorbis"')&&o.push(".ogg"),s.canPlayType("audio/mpeg")&&o.push(".mp3"),s.canPlayType('audio/wav; codecs="1"')&&o.push(".wav"),s.canPlayType("audio/mp4")&&o.push(".mp4"),s.canPlayType("audio/x-m4a")&&o.push(".m4a"));r.format=o;n.__audioSupport=r}return n.NetworkType={NONE:0,LAN:1,WWAN:2},n.getNetworkType=function(){return n.NetworkType.LAN},n.getBatteryLevel=function(){return 1},n.garbageCollect=function(){},n.restartVM=function(){},n.isObjectValid=function(n){return!!n},n.dump=function(){var n="";n+="isMobile : "+this.isMobile+"\r\n";n+="language : "+this.language+"\r\n";n+="browserType : "+this.browserType+"\r\n";n+="browserVersion : "+this.browserVersion+"\r\n";n+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n";n+="os : "+this.os+"\r\n";n+="osVersion : "+this.osVersion+"\r\n";n+="platform : "+this.platform+"\r\n";n+="Using "+(cc.game.renderType===cc.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n";cc.log(n)},n.openURL=function(n){window.open(n)},n.now=function(){return Date.now?Date.now():+new Date},n}();t.exports=r},{}],205:[function(n,t){"use strict";var f=n("../event/event-target"),e=n("../platform/js"),o=n("../renderer"),r,i,u;n("../platform/CCClass");r={init:function(){this.html=document.getElementsByTagName("html")[0]},availWidth:function(n){return n&&n!==this.html?n.clientWidth:window.innerWidth},availHeight:function(n){return n&&n!==this.html?n.clientHeight:window.innerHeight},meta:{width:"device-width"},adaptationType:cc.sys.browserType};switch(cc.sys.os===cc.sys.OS_IOS&&(r.adaptationType=cc.sys.BROWSER_TYPE_SAFARI),r.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:case cc.sys.BROWSER_TYPE_SOUGOU:case cc.sys.BROWSER_TYPE_UC:r.meta["minimal-ui"]="true";r.availWidth=function(n){return n.clientWidth};r.availHeight=function(n){return n.clientHeight}}i=null;u=function(){f.call(this);var n=this,t=cc.ContainerStrategy,i=cc.ContentStrategy;r.init(this);n._frameSize=cc.size(0,0);n._designResolutionSize=cc.size(0,0);n._originalDesignResolutionSize=cc.size(0,0);n._scaleX=1;n._scaleY=1;n._viewportRect=cc.rect(0,0,0,0);n._visibleRect=cc.rect(0,0,0,0);n._autoFullScreen=!1;n._devicePixelRatio=1;n._maxPixelRatio=2;n._retinaEnabled=!1;n._resizeCallback=null;n._resizing=!1;n._resizeWithBrowserSize=!1;n._orientationChanging=!0;n._isRotated=!1;n._orientation=cc.macro.ORIENTATION_AUTO;n._isAdjustViewport=!0;n._antiAliasEnabled=!1;n._resolutionPolicy=null;n._rpExactFit=new cc.ResolutionPolicy(t.EQUAL_TO_FRAME,i.EXACT_FIT);n._rpShowAll=new cc.ResolutionPolicy(t.EQUAL_TO_FRAME,i.SHOW_ALL);n._rpNoBorder=new cc.ResolutionPolicy(t.EQUAL_TO_FRAME,i.NO_BORDER);n._rpFixedHeight=new cc.ResolutionPolicy(t.EQUAL_TO_FRAME,i.FIXED_HEIGHT);n._rpFixedWidth=new cc.ResolutionPolicy(t.EQUAL_TO_FRAME,i.FIXED_WIDTH);cc.game.once(cc.game.EVENT_ENGINE_INITED,this.init,this)};cc.js.extend(u,f);cc.js.mixin(u.prototype,{init:function(){this._initFrameSize();var n=cc.game.canvas.width,t=cc.game.canvas.height;this._designResolutionSize.width=n;this._designResolutionSize.height=t;this._originalDesignResolutionSize.width=n;this._originalDesignResolutionSize.height=t;this._viewportRect.width=n;this._viewportRect.height=t;this._visibleRect.width=n;this._visibleRect.height=t;cc.winSize.width=this._visibleRect.width;cc.winSize.height=this._visibleRect.height;cc.visibleRect&&cc.visibleRect.init(this._visibleRect)},_resizeEvent:function(n){var t,r,i,f,u,e;if(t=this.setDesignResolutionSize?this:cc.view,r=cc.sys,r.browserType!==r.BROWSER_TYPE_UC||r.os!==r.OS_IOS){var o=t._frameSize.width,s=t._frameSize.height,h=t._isRotated;cc.sys.isMobile?(i=cc.game.container.style,f=i.margin,i.margin="0",i.display="none",t._initFrameSize(),i.margin=f,i.display="block"):t._initFrameSize();(!0===n||t._isRotated!==h||t._frameSize.width!==o||t._frameSize.height!==s)&&(u=t._originalDesignResolutionSize.width,e=t._originalDesignResolutionSize.height,t._resizing=!0,u>0&&t.setDesignResolutionSize(u,e,t._resolutionPolicy),t._resizing=!1,t.emit("canvas-resize"),t._resizeCallback&&t._resizeCallback.call())}else setTimeout(function(){t._resizeEvent(n)},0)},_orientationChange:function(){cc.view._orientationChanging=!0;cc.view._resizeEvent();cc.sys.browserType===cc.sys.BROWSER_TYPE_SAFARI&&cc.sys.isMobile&&setTimeout(function(){window.innerHeight>window.innerWidth&&window.scrollTo(0,1)},500)},_resize:function(){cc.view._resizeEvent(!1)},resizeWithBrowserSize:function(n){n?this._resizeWithBrowserSize||(this._resizeWithBrowserSize=!0,window.addEventListener("resize",this._resize),window.addEventListener("orientationchange",this._orientationChange)):this._resizeWithBrowserSize&&(this._resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resize),window.removeEventListener("orientationchange",this._orientationChange))},setResizeCallback:function(n){"function"!=typeof n&&null!=n||(this._resizeCallback=n)},setOrientation:function(n){if((n&=cc.macro.ORIENTATION_AUTO)&&this._orientation!==n){this._orientation=n;var t=this._originalDesignResolutionSize.width,i=this._originalDesignResolutionSize.height;this.setDesignResolutionSize(t,i,this._resolutionPolicy)}},_initFrameSize:function(){var n=this._frameSize,t=r.availWidth(cc.game.frame),i=r.availHeight(cc.game.frame),u=t>=i;!cc.sys.isMobile||u&&this._orientation&cc.macro.ORIENTATION_LANDSCAPE||!u&&this._orientation&cc.macro.ORIENTATION_PORTRAIT?(n.width=t,n.height=i,cc.game.container.style["-webkit-transform"]="rotate(0deg)",cc.game.container.style.transform="rotate(0deg)",this._isRotated=!1):(n.width=i,n.height=t,cc.game.container.style["-webkit-transform"]="rotate(90deg)",cc.game.container.style.transform="rotate(90deg)",cc.game.container.style["-webkit-transform-origin"]="0px 0px 0px",cc.game.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0);this._orientationChanging&&setTimeout(function(){cc.view._orientationChanging=!1},1e3)},_setViewportMeta:function(n,t){var r=document.getElementById("cocosMetaElement"),i,u,o,e,f;r&&t&&document.head.removeChild(r);e=document.getElementsByName("viewport");f=e?e[0]:null;for(u in i=f?f.content:"",(r=r||document.createElement("meta")).id="cocosMetaElement",r.name="viewport",r.content="",n)-1==i.indexOf(u)?i+=","+u+"="+n[u]:t&&(o=new RegExp(u+"s*=s*[^,]+"),i=i.replace(o,u+"="+n[u]));/^,/.test(i)&&(i=i.substr(1));r.content=i;f&&(f.content=i);document.head.appendChild(r)},_adjustViewportMeta:function(){this._isAdjustViewport&&(this._setViewportMeta(r.meta,!1),this._isAdjustViewport=!1)},adjustViewportMeta:function(n){this._isAdjustViewport=n},enableRetina:function(n){this._retinaEnabled=!!n},isRetinaEnabled:function(){return this._retinaEnabled},enableAntiAlias:function(n){if(cc.warnID(9200),this._antiAliasEnabled!==n)if(this._antiAliasEnabled=n,cc.game.renderType===cc.game.RENDER_TYPE_WEBGL)cc.assetManager.assets.forEach(function(t){if(t instanceof cc.Texture2D){var i=cc.Texture2D.Filter;n?t.setFilters(i.LINEAR,i.LINEAR):t.setFilters(i.NEAREST,i.NEAREST)}});else if(cc.game.renderType===cc.game.RENDER_TYPE_CANVAS){var t=cc.game.canvas.getContext("2d");t.imageSmoothingEnabled=n;t.mozImageSmoothingEnabled=n}},isAntiAliasEnabled:function(){return this._antiAliasEnabled},enableAutoFullScreen:function(n){n&&n!==this._autoFullScreen&&cc.sys.isMobile?(this._autoFullScreen=!0,cc.screen.autoFullScreen(cc.game.frame)):(this._autoFullScreen=!1,cc.screen.disableAutoFullScreen(cc.game.frame))},isAutoFullScreenEnabled:function(){return this._autoFullScreen},setCanvasSize:function(n,t){var i=cc.game.canvas,r=cc.game.container;i.width=n*this._devicePixelRatio;i.height=t*this._devicePixelRatio;i.style.width=n+"px";i.style.height=t+"px";r.style.width=n+"px";r.style.height=t+"px";this._resizeEvent()},getCanvasSize:function(){return cc.size(cc.game.canvas.width,cc.game.canvas.height)},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(n,t){this._frameSize.width=n;this._frameSize.height=t;cc.game.frame.style.width=n+"px";cc.game.frame.style.height=t+"px";this._resizeEvent(!0)},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return cc.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return cc.v2(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return cc.v2(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(n){var t=this,i;n instanceof cc.ResolutionPolicy?t._resolutionPolicy=n:(i=cc.ResolutionPolicy,n===i.EXACT_FIT&&(t._resolutionPolicy=t._rpExactFit),n===i.SHOW_ALL&&(t._resolutionPolicy=t._rpShowAll),n===i.NO_BORDER&&(t._resolutionPolicy=t._rpNoBorder),n===i.FIXED_HEIGHT&&(t._resolutionPolicy=t._rpFixedHeight),n===i.FIXED_WIDTH&&(t._resolutionPolicy=t._rpFixedWidth))},setDesignResolutionSize:function(n,t,i){var u,r;if(n>0&&t>0)if(this.setResolutionPolicy(i),u=this._resolutionPolicy,u&&u.preApply(this),cc.sys.isMobile&&this._adjustViewportMeta(),this._orientationChanging=!0,this._resizing||this._initFrameSize(),u){if(this._originalDesignResolutionSize.width=this._designResolutionSize.width=n,this._originalDesignResolutionSize.height=this._designResolutionSize.height=t,r=u.apply(this,this._designResolutionSize),r.scale&&2===r.scale.length&&(this._scaleX=r.scale[0],this._scaleY=r.scale[1]),r.viewport){var e=this._viewportRect,s=this._visibleRect,f=r.viewport;e.x=f.x;e.y=f.y;e.width=f.width;e.height=f.height;s.x=0;s.y=0;s.width=f.width/this._scaleX;s.height=f.height/this._scaleY}u.postApply(this);cc.winSize.width=this._visibleRect.width;cc.winSize.height=this._visibleRect.height;cc.visibleRect&&cc.visibleRect.init(this._visibleRect);o.updateCameraViewport();cc.internal.inputManager._updateCanvasBoundingRect();this.emit("design-resolution-changed")}else cc.logID(2201);else cc.errorID(2200)},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(n,t,i){this._setViewportMeta({width:n},!0);document.documentElement.style.width=n+"px";document.body.style.width=n+"px";document.body.style.left="0px";document.body.style.top="0px";this.setDesignResolutionSize(n,t,i)},setViewportInPoints:function(n,t,i,r){var u=this._scaleX,f=this._scaleY;cc.game._renderContext.viewport(n*u+this._viewportRect.x,t*f+this._viewportRect.y,i*u,r*f)},setScissorInPoints:function(n,t,r,u){var l=this._scaleX,a=this._scaleY,e=Math.ceil(n*l+this._viewportRect.x),o=Math.ceil(t*a+this._viewportRect.y),s=Math.ceil(r*l),h=Math.ceil(u*a),c=cc.game._renderContext,f;i||(f=c.getParameter(c.SCISSOR_BOX),i=cc.rect(f[0],f[1],f[2],f[3]));i.x===e&&i.y===o&&i.width===s&&i.height===h||(i.x=e,i.y=o,i.width=s,i.height=h,c.scissor(e,o,s,h))},isScissorEnabled:function(){return cc.game._renderContext.isEnabled(gl.SCISSOR_TEST)},getScissorRect:function(){var n,t,r;return i||(n=gl.getParameter(gl.SCISSOR_BOX),i=cc.rect(n[0],n[1],n[2],n[3])),t=1/this._scaleX,r=1/this._scaleY,cc.rect((i.x-this._viewportRect.x)*t,(i.y-this._viewportRect.y)*r,i.width*t,i.height*r)},getViewportRect:function(){return this._viewportRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(n,t,i,r){var u=r||cc.v2(),o=i.adjustedLeft?i.adjustedLeft:i.left,s=i.adjustedTop?i.adjustedTop:i.top,f=this._devicePixelRatio*(n-o),e=this._devicePixelRatio*(s+i.height-t);return this._isRotated?(u.x=cc.game.canvas.width-e,u.y=f):(u.x=f,u.y=e),u},_convertMouseToLocationInView:function(n,t){var i=this._viewportRect;n.x=(this._devicePixelRatio*(n.x-t.left)-i.x)/this._scaleX;n.y=(this._devicePixelRatio*(t.top+t.height-n.y)-i.y)/this._scaleY},_convertPointWithScale:function(n){var t=this._viewportRect;n.x=(n.x-t.x)/this._scaleX;n.y=(n.y-t.y)/this._scaleY},_convertTouchesWithScale:function(n){for(var f,t,i,r=this._viewportRect,e=this._scaleX,o=this._scaleY,u=0;u<n.length;u++)t=(f=n[u])._point,i=f._prevPoint,t.x=(t.x-r.x)/e,t.y=(t.y-r.y)/o,i.x=(i.x-r.x)/e,i.y=(i.y-r.y)/o}});cc.ContainerStrategy=cc.Class({name:"ContainerStrategy",preApply:function(){},apply:function(){},postApply:function(){},_setupContainer:function(n,t,i){var u=cc.game.canvas,r;this._setupStyle(n,t,i);r=n._devicePixelRatio=1;n.isRetinaEnabled()&&(r=n._devicePixelRatio=Math.min(n._maxPixelRatio,window.devicePixelRatio||1));u.width=t*r;u.height=i*r},_setupStyle:function(n,t,i){var r=cc.game.canvas,u=cc.game.container;cc.sys.os===cc.sys.OS_ANDROID&&(document.body.style.width=(n._isRotated?i:t)+"px",document.body.style.height=(n._isRotated?t:i)+"px");u.style.width=r.style.width=t+"px";u.style.height=r.style.height=i+"px"},_fixContainer:function(){var n,t;document.body.insertBefore(cc.game.container,document.body.firstChild);n=document.body.style;n.width=window.innerWidth+"px";n.height=window.innerHeight+"px";n.overflow="hidden";t=cc.game.container.style;t.position="fixed";t.left=t.top="0px";document.body.scrollTop=0}});cc.ContentStrategy=cc.Class({name:"ContentStrategy",ctor:function(){this._result={scale:[1,1],viewport:null}},_buildResult:function(n,t,i,r,u,f){Math.abs(n-i)<2&&(i=n);Math.abs(t-r)<2&&(r=t);var e=cc.rect((n-i)/2,(t-r)/2,i,r);return cc.game.renderType,cc.game.RENDER_TYPE_CANVAS,this._result.scale=[u,f],this._result.viewport=e,this._result},preApply:function(){},apply:function(){return{scale:[1,1]}},postApply:function(){}}),function(){var t=cc.Class({name:"EqualToFrame","extends":cc.ContainerStrategy,apply:function(n){var i=n._frameSize.height,t=cc.game.container.style;this._setupContainer(n,n._frameSize.width,n._frameSize.height);t.margin=n._isRotated?"0 0 0 "+i+"px":"0px";t.padding="0px"}}),i=cc.Class({name:"ProportionalToFrame","extends":cc.ContainerStrategy,apply:function(n,t){var i,r,e=n._frameSize.width,u=n._frameSize.height,f=cc.game.container.style,h=t.width,c=t.height,l=e/h,a=u/c,o,s;l<a?(i=e,r=c*l):(i=h*a,r=u);o=Math.round((e-i)/2);s=Math.round((u-r)/2);i=e-2*o;r=u-2*s;this._setupContainer(n,i,r);f.margin=n._isRotated?"0 0 0 "+u+"px":"0px";f.paddingLeft=o+"px";f.paddingRight=o+"px";f.paddingTop=s+"px";f.paddingBottom=s+"px"}}),r=(cc.Class({name:"EqualToWindow","extends":t,preApply:function(n){this._super(n);cc.game.frame=document.documentElement},apply:function(n){this._super(n);this._fixContainer()}}),cc.Class({name:"ProportionalToWindow","extends":i,preApply:function(n){this._super(n);cc.game.frame=document.documentElement},apply:function(n,t){this._super(n,t);this._fixContainer()}}),cc.Class({name:"OriginalContainer","extends":cc.ContainerStrategy,apply:function(n){this._setupContainer(n,cc.game.canvas.width,cc.game.canvas.height)}})),n=("undefined"==typeof window?global:window).__globalAdapter;n&&(n.adaptContainerStrategy&&n.adaptContainerStrategy(cc.ContainerStrategy.prototype),n.adaptView&&n.adaptView(u.prototype));cc.ContainerStrategy.EQUAL_TO_FRAME=new t;cc.ContainerStrategy.PROPORTION_TO_FRAME=new i;cc.ContainerStrategy.ORIGINAL_CONTAINER=new r;var f=cc.Class({name:"ExactFit","extends":cc.ContentStrategy,apply:function(n,t){var i=cc.game.canvas.width,r=cc.game.canvas.height,u=i/t.width,f=r/t.height;return this._buildResult(i,r,i,r,u,f)}}),e=cc.Class({name:"ShowAll","extends":cc.ContentStrategy,apply:function(n,t){var r,u,f=cc.game.canvas.width,e=cc.game.canvas.height,o=t.width,s=t.height,h=f/o,c=e/s,i=0;return h<c?(r=f,u=s*(i=h)):(r=o*(i=c),u=e),this._buildResult(f,e,r,u,i,i)}}),o=cc.Class({name:"NoBorder","extends":cc.ContentStrategy,apply:function(n,t){var i,r,u,f=cc.game.canvas.width,e=cc.game.canvas.height,o=t.width,s=t.height,h=f/o,c=e/s;return h<c?(r=o*(i=c),u=e):(r=f,u=s*(i=h)),this._buildResult(f,e,r,u,i,i)}}),s=cc.Class({name:"FixedHeight","extends":cc.ContentStrategy,apply:function(n,t){var r=cc.game.canvas.width,i=cc.game.canvas.height,u=i/t.height,f=r,e=i;return this._buildResult(r,i,f,e,u,u)}}),h=cc.Class({name:"FixedWidth","extends":cc.ContentStrategy,apply:function(n,t){var i=cc.game.canvas.width,r=cc.game.canvas.height,u=i/t.width,f=i,e=r;return this._buildResult(i,r,f,e,u,u)}});cc.ContentStrategy.EXACT_FIT=new f;cc.ContentStrategy.SHOW_ALL=new e;cc.ContentStrategy.NO_BORDER=new o;cc.ContentStrategy.FIXED_HEIGHT=new s;cc.ContentStrategy.FIXED_WIDTH=new h}();cc.ResolutionPolicy=cc.Class({name:"cc.ResolutionPolicy",ctor:function(n,t){this._containerStrategy=null;this._contentStrategy=null;this.setContainerStrategy(n);this.setContentStrategy(t)},preApply:function(n){this._containerStrategy.preApply(n);this._contentStrategy.preApply(n)},apply:function(n,t){return this._containerStrategy.apply(n,t),this._contentStrategy.apply(n,t)},postApply:function(n){this._containerStrategy.postApply(n);this._contentStrategy.postApply(n)},setContainerStrategy:function(n){n instanceof cc.ContainerStrategy&&(this._containerStrategy=n)},setContentStrategy:function(n){n instanceof cc.ContentStrategy&&(this._contentStrategy=n)}});e.get(cc.ResolutionPolicy.prototype,"canvasSize",function(){return cc.v2(cc.game.canvas.width,cc.game.canvas.height)});cc.ResolutionPolicy.EXACT_FIT=0;cc.ResolutionPolicy.NO_BORDER=1;cc.ResolutionPolicy.SHOW_ALL=2;cc.ResolutionPolicy.FIXED_HEIGHT=3;cc.ResolutionPolicy.FIXED_WIDTH=4;cc.ResolutionPolicy.UNKNOWN=5;cc.view=new u;cc.winSize=cc.size();t.exports=cc.view},{"../event/event-target":142,"../platform/CCClass":195,"../platform/js":216,"../renderer":226}],206:[function(){"use strict";cc.visibleRect={topLeft:cc.v2(0,0),topRight:cc.v2(0,0),top:cc.v2(0,0),bottomLeft:cc.v2(0,0),bottomRight:cc.v2(0,0),bottom:cc.v2(0,0),center:cc.v2(0,0),left:cc.v2(0,0),right:cc.v2(0,0),width:0,height:0,init:function(n){var r=this.width=n.width,u=this.height=n.height,t=n.x,i=n.y,f=i+u,e=t+r;this.topLeft.x=t;this.topLeft.y=f;this.topRight.x=e;this.topRight.y=f;this.top.x=t+r/2;this.top.y=f;this.bottomLeft.x=t;this.bottomLeft.y=i;this.bottomRight.x=e;this.bottomRight.y=i;this.bottom.x=t+r/2;this.bottom.y=i;this.center.x=t+r/2;this.center.y=i+u/2;this.left.x=t;this.left.y=i+u/2;this.right.x=e;this.right.y=i+u/2}}},{}],207:[function(n,t){"use strict";function f(n,t){var i=t?Object.create(t):{};return e.value(n,"__attrs__",i),i}function o(n){var u,t,i,e;if("function"!=typeof n)return f(n,r(n.constructor));for(t=cc.Class.getInheritanceChain(n),i=t.length-1;i>=0;i--)e=t[i],e.hasOwnProperty("__attrs__")&&e.__attrs__||f(e,(u=t[i+1])&&u.__attrs__);return f(n,(u=t[0])&&u.__attrs__),n.__attrs__}function r(n){return n.hasOwnProperty("__attrs__")&&n.__attrs__||o(n)}function i(n,t){this.name=n;this.default=t}var e=n("./js"),u=(n("./utils").isPlainEmptyObj_DEV,"$_$");i.prototype.toString=function(){return this.name};cc.Integer=new i("Integer",0);cc.Float=new i("Float",0);cc.Boolean=new i("Boolean",!1);cc.String=new i("String","");t.exports={PrimitiveType:i,attr:function(n,t){var f=r(n),e=t+u,o={};for(var i in f)i.startsWith(e)&&(o[i.slice(e.length)]=f[i]);return o},getClassAttrs:r,setClassAttr:function(n,t,i,f){r(n)[t+u+i]=f},DELIMETER:u,getTypeChecker_ET:!1,getObjTypeChecker_ET:!1,ScriptUuid:{}}},{"./CCClass":195,"./js":216,"./utils":219}],208:[function(n,t){"use strict";function o(){}function s(){this.callback=o;this.target=void 0;this.once=!1}function h(){this.callbackInfos=[];this.isInvoking=!1;this.containCanceled=!1}function c(){this._callbackTable=u.createMap(!0)}var u=n("./js"),f=u.array.fastRemoveAt,r,i,e;s.prototype.set=function(n,t,i){this.callback=n;this.target=t;this.once=!!i};r=new u.Pool(function(n){return n.callback=o,n.target=void 0,n.once=!1,!0},32);r.get=function(){return this._get()||new s};i=h.prototype;i.removeByCallback=function(n){for(var i,t=0;t<this.callbackInfos.length;++t)i=this.callbackInfos[t],i&&i.callback===n&&(r.put(i),f(this.callbackInfos,t),--t)};i.removeByTarget=function(n){for(var i,t=0;t<this.callbackInfos.length;++t)i=this.callbackInfos[t],i&&i.target===n&&(r.put(i),f(this.callbackInfos,t),--t)};i.cancel=function(n){var t=this.callbackInfos[n];t&&(r.put(t),this.callbackInfos[n]=null);this.containCanceled=!0};i.cancelAll=function(){for(var t,n=0;n<this.callbackInfos.length;n++)t=this.callbackInfos[n],t&&(r.put(t),this.callbackInfos[n]=null);this.containCanceled=!0};i.purgeCanceled=function(){for(var n=this.callbackInfos.length-1;n>=0;--n)this.callbackInfos[n]||f(this.callbackInfos,n);this.containCanceled=!1};i.clear=function(){this.cancelAll();this.callbackInfos.length=0;this.isInvoking=!1;this.containCanceled=!1};e=new u.Pool(function(n){return n.callbackInfos=[],n.isInvoking=!1,n.containCanceled=!1,!0},16);e.get=function(){return this._get()||new h};(i=c.prototype).on=function(n,t,i,u){var f=this._callbackTable[n],o;f||(f=this._callbackTable[n]=e.get());o=r.get();o.set(t,i,u);f.callbackInfos.push(o)};i.hasEventListener=function(n,t,i){var o=this._callbackTable[n],r,u,f,e;if(!o)return!1;if(r=o.callbackInfos,!t){if(o.isInvoking){for(u=0;u<r.length;++u)if(r[u])return!0;return!1}return r.length>0}for(f=0;f<r.length;++f)if(e=r[f],e&&e.callback===t&&e.target===i)return!0;return!1};i.removeAll=function(n){var t,o,i,u,r,f;if("string"==typeof n)t=this._callbackTable[n],t&&(t.isInvoking?t.cancelAll():(t.clear(),e.put(t),delete this._callbackTable[n]));else if(n)for(o in this._callbackTable)if(i=this._callbackTable[o],i.isInvoking)for(u=i.callbackInfos,r=0;r<u.length;++r)f=u[r],f&&f.target===n&&i.cancel(r);else i.removeByTarget(n)};i.off=function(n,t,i){var o=this._callbackTable[n],s,u,e;if(o)for(s=o.callbackInfos,u=0;u<s.length;++u)if(e=s[u],e&&e.callback===t&&e.target===i){o.isInvoking?o.cancel(u):(f(s,u),r.put(e));break}};i.emit=function(n,t,i,r,u,f){var e=this._callbackTable[n],l,o,s,h;if(e){l=!e.isInvoking;e.isInvoking=!0;for(var a=e.callbackInfos,c=0,v=a.length;c<v;++c)o=a[c],o&&(s=o.target,h=o.callback,o.once&&this.off(n,h,s),s?h.call(s,t,i,r,u,f):h(t,i,r,u,f));l&&(e.isInvoking=!1,e.containCanceled&&e.purgeCanceled())}};t.exports=c},{"./js":216}],209:[function(n,t){"use strict";function i(n,t){for(var u,r=0;r<t.length;r++)u=t[r],Array.isArray(u)?i(n,u):n.push(u)}t.exports={flattenCodeArray:function(n){var t=[];return i(t,n),t.join("")}}},{}],210:[function(n,t,i){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}function a(n,t){n.x=t[1];n.y=t[2];n.z=t[3];n.w=t[4]}function at(n,t,i){for(var e=n.length-1,r=0,l=3*n[e];r<l;r+=3){var o=n[r],s=t[n[r+2]],u=n[r+1];u>=0?o[i[u]]=s:o[~u]=s}for(;r<e;r+=3){var h=t[n[r]],c=t[n[r+2]],f=n[r+1];f>=0?h[i[f]]=c:h[~f]=c}}function y(n,t){for(var s,h,u=n[4][t[0]],f=u[0],e=new f[0],o=f[1],c=f[2],l=u[u.length-1],i=1;i<l;++i)e[o[u[i]]]=t[i];for(;i<t.length;++i)s=o[u[i]],h=f[u[i]+c],r[h](n,e,s,t[i]);return e}function p(n,t,i){var r=new t;return r._deserialize?r._deserialize(i,n[0]):cc.errorID(5303,o.default.getClassName(t)),r}function w(n,t,i,r){r>=0?t[i]=n[5][r]:n[7][3*~r]=t}function s(n){return function(t,i,r,u){i[r]=u;for(var f=0;f<u.length;++f)n(t,u,f,u[f])}}function b(n,t,i,r){t[i]=null;n[8][r]=t}function k(n,t,i,r){t[i]=y(n,r)}function vt(n){var i=n[5],o=n[6],h=0===o?0:o.length,u=i[i.length-1],c=i.length-h,t,l,e,f,s,a;for("number"!=typeof u?u=0:(u<0&&(u=~u),--c),t=0;t<c;++t)i[t]=y(n,i[t]);for(l=n[3],e=0;e<h;++e,++t)f=o[e],s=i[t],f>=0?(a=l[f],i[t]=p(n,a,s)):r[f=~f](n,i,t,s);return u}function d(n,t){return n||h.reportMissingClass(t),Object}function g(n,t,i,r,u,f){var e=n(t);if(!e){if(u)return void(i[r]=function(t,i,r){return function(){var u=n(r)||d(f,r);return t[i]=u,new u}}(i,r,t));e=d(f,t)}i[r]=e}function nt(n,t,i){for(var r,e=i||o.default._getClassById,f=n[3],u=0;u<f.length;++u)r=f[u],"string"!=typeof r?g(e,r[0],r,ct,t,i):g(e,r,f,u,t,i)}function tt(n){var i=n[4],u,t,r;if(i)for(u=n[3],t=0;t<i.length;++t)r=i[t],r[0]=u[r[0]]}function yt(n){for(var u,i,f,s=n[5],h=n[2],c=n[1],r=n[8],e=n[9],o=n[10],t=0;t<r.length;++t)u=r[t],"number"==typeof u&&(r[t]=s[u]),i=e[t],"number"==typeof i&&(i=i>=0?h[i]:~i,e[t]=i),f=o[t],"number"==typeof f&&(o[t]=c[f])}function h(n,t,i){var o,r,u,e,s;if("string"==typeof n&&(n=JSON.parse(n)),o=!t,(t=t||f.pool.get()).init(n),i=i||{},r=n[0],u=!1,"object"==typeof r&&(u=r.preprocessed,r=r.version),r<1)throw new Error(cc.debug.getError(5304,r));return i._version=r,i.result=t,n[0]=i,u||(nt(n,!1,i.classFinder),tt(n)),cc.game._isCloning=!0,e=n[5],s=vt(n),cc.game._isCloning=!1,n[7]&&at(n[7],e,n[2]),yt(n),o&&f.pool.put(t),e[s]}var e,l,r,it;i.__esModule=!0;i.default=h;i.unpackJSONs=function(n,t){if(n[0]<1)throw new Error(cc.debug.getError(5304,n[0]));nt(n,!0,t);tt(n);for(var u=new it(n[0]),f=n[1],e=n[2],o=n[3],s=n[4],i=n[lt],r=0;r<i.length;++r)i[r].unshift(u,f,e,o,s);return i};i.packCustomObjData=function(n,t,i){return[1,e,e,[n],e,i?[t,-1]:[t],[0],e,[],[],[]]};i.hasNativeDep=function(n){var t=n[5],i=t[t.length-1];return"number"==typeof i&&i<0};i.getDependUuidList=function(n){var t=n[1];return n[10].map(function(n){return t[n]})};var o=u(n("./js")),rt=u(n("../value-types/vec2")),ut=u(n("../value-types/vec3")),ft=u(n("../value-types/vec4")),et=u(n("../value-types/color")),ot=u(n("../value-types/size")),st=u(n("../value-types/rect")),ht=u(n("../value-types/quat")),c=u(n("../value-types/mat4"));e=0;l=[rt.default,ut.default,ft.default,ht.default,et.default,ot.default,st.default,c.default];var v=[function(n,t){n.x=t[1];n.y=t[2]},function(n,t){n.x=t[1];n.y=t[2];n.z=t[3]},a,a,function(n,t){n._val=t[1]},function(n,t){n.width=t[1];n.height=t[2]},function(n,t){n.x=t[1];n.y=t[2];n.width=t[3];n.height=t[4]},function(n,t){c.default.fromArray(n,t,1)}],ct=0,lt=5,f=function(){function t(){this.uuidObjList=null;this.uuidPropList=null;this.uuidList=null}var n=t.prototype;return n.init=function(n){this.uuidObjList=n[8];this.uuidPropList=n[9];this.uuidList=n[10]},n.reset=function(){this.uuidList=null;this.uuidObjList=null;this.uuidPropList=null},n.push=function(n,t,i){this.uuidObjList.push(n);this.uuidPropList.push(t);this.uuidList.push(i)},t}();f.pool=new o.default.Pool(function(n){n.reset()},5);f.pool.get=function(){return this._get()||new f};r=new Array(13);r[0]=function(n,t,i,r){t[i]=r};r[1]=w;r[2]=s(w);r[3]=s(b);r[4]=k;r[5]=function(n,t,i,r){v[r[0]](t[i],r)};r[6]=b;r[7]=function(n,t,i,r){t[i].set(r)};r[8]=function(n,t,i,r){var u=new l[r[0]];v[r[0]](u,r);t[i]=u};r[9]=s(k);r[10]=function(n,t,i,r){var u=n[3][r[0]];t[i]=p(n,u,r[1])};r[11]=function(n,t,i,u){var e=u[0],f;for(t[i]=e,f=1;f<u.length;f+=3){var o=u[f],s=u[f+1],h=u[f+2];r[s](n,e,o,h)}};r[12]=function(n,t,i,u){var e=u[0],f,s,o;for(t[i]=e,f=0;f<e.length;++f)s=e[f],o=u[f+1],0!==o&&r[o](n,e,f,s)};h.Details=f;it=function(n){this.preprocessed=!0;this.version=n}},{"../value-types/color":283,"../value-types/mat4":286,"../value-types/quat":287,"../value-types/rect":288,"../value-types/size":289,"../value-types/vec2":293,"../value-types/vec3":294,"../value-types/vec4":295,"./js":216}],211:[function(n){"use strict";var t,i=(t=n("./deserialize-compiled"))&&t.__esModule?t:{"default":t};i.default.reportMissingClass=function(n){cc.warnID(5302,n)};cc.deserialize=i.default},{"./deserialize-compiled":210,"./deserialize-editor":void 0}],212:[function(n,t){"use strict";function i(n){this.id=0|998*Math.random();this.prefix=n?n+r:""}var r=".";i.prototype.getNewId=function(){return this.prefix+ ++this.id};i.global=new i("global");t.exports=i},{}],213:[function(n){"use strict";n("./js");n("./CCClass");n("./CCClassDecorator");n("./CCEnum");n("./CCObject");n("./callbacks-invoker");n("./deserialize");n("./instantiate");n("./instantiate-jit");n("./requiring-frame");n("./CCSys");n("./CCMacro");n("./CCVisibleRect")},{"./CCClass":195,"./CCClassDecorator":196,"./CCEnum":197,"./CCMacro":200,"./CCObject":201,"./CCSys":204,"./CCVisibleRect":206,"./callbacks-invoker":208,"./deserialize":211,"./instantiate":215,"./instantiate-jit":214,"./js":216,"./requiring-frame":218}],214:[function(n,t){"use strict";function rt(n){if(n===Float32Array)return"Float32Array";if(n===Float64Array)return"Float64Array";if(n===Int8Array)return"Int8Array";if(n===Int16Array)return"Int16Array";if(n===Int32Array)return"Int32Array";if(n===Uint8Array)return"Uint8Array";if(n===Uint16Array)return"Uint16Array";if(n===Uint32Array)return"Uint32Array";if(n===Uint8ClampedArray)return"Uint8ClampedArray";throw new Error("Unknown TypedArray to instantiate: "+n);}function f(n,t){this.varName=n;this.expression=t}function a(n,t){return t instanceof f?new f(t.varName,n+t.expression):n+t}function s(n,t,i){Array.isArray(i)?(i[0]=a(t,i[0]),n.push(i)):n.push(a(t,i)+";")}function e(n){this._exps=[];this._targetExp=n}function w(n,t){if("function"==typeof n)try{n=n()}catch(i){return i={},!1}if(n===t)return!0;if(n&&t&&"object"==typeof n&&"object"==typeof t&&n.constructor===t.constructor)if(n instanceof cc.ValueType){if(n.equals(t))return!0}else{if(Array.isArray(n))return 0===n.length&&0===t.length;if(n.constructor===Object)return r.isEmptyObject(n)&&r.isEmptyObject(t)}return!1}function v(n){return tt.test(n)?"."+n:"["+p(n)+"]"}function b(n,t){var f,e,i,o;for(this.parent=t,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=r.createMap(),r.mixin(this.funcModuleCache,it),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push(c+u+","+l+";","if(R){",u+"=R;","}else{",u+"=R=new "+this.getFuncModule(n.constructor,!0)+"();","}"),r.value(n,"_iN$t",{globalVar:"R"},!0),this.objsToClear_iN$t.push(n),this.enumerateObject(this.codeArray,n),this.globalVariables.length>0&&(f=c+this.globalVariables.join(",")+";"),e=g.flattenCodeArray(["return (function(R){",f||[],this.codeArray,"return o;","})"]),this.result=Function("O","F",e)(this.objs,this.funcs),i=0,o=this.objsToClear_iN$t.length;i<o;++i)this.objsToClear_iN$t[i]._iN$t=null;this.objsToClear_iN$t.length=0}var h=n("./CCObject"),k=h.Flags.Destroyed,d=h.Flags.PersistentMask,y=n("./attribute"),r=n("./js"),o=n("./CCClass"),g=n("./compiler"),nt=y.DELIMETER+"default",tt=o.IDENTIFIER_RE,p=o.escapeForJS,c="var ",u="o",l="t",it={"cc.Node":"cc.Node","cc.Sprite":"cc.Sprite","cc.Label":"cc.Label","cc.Button":"cc.Button","cc.Widget":"cc.Widget","cc.Animation":"cc.Animation","cc.ClickEvent":!1,"cc.PrefabInfo":!1},i;try{Float32Array.name||(Float32Array.name="Float32Array");!Float64Array.name&&(Float64Array.name="Float64Array");!Int8Array.name&&(Int8Array.name="Int8Array");!Int16Array.name&&(Int16Array.name="Int16Array");!Int32Array.name&&(Int32Array.name="Int32Array");!Uint8Array.name&&(Uint8Array.name="Uint8Array");!Uint16Array.name&&(Uint16Array.name="Uint16Array");!Uint32Array.name&&(Uint32Array.name="Uint32Array");!Uint8ClampedArray.name&&(Uint8ClampedArray.name="Uint8ClampedArray")}catch(ut){}f.prototype.toString=function(){return c+this.varName+"="+this.expression+";"};e.prototype.append=function(n,t){this._exps.push([n,t])};e.prototype.writeCode=function(n){var i,t,r;if(this._exps.length>1)n.push(l+"="+this._targetExp+";"),i=l;else{if(1!==this._exps.length)return;i=this._targetExp}for(t=0;t<this._exps.length;t++)r=this._exps[t],s(n,i+v(r[0])+"=",r[1])};e.pool=new r.Pool(function(n){n._exps.length=0;n._targetExp=null},1);e.pool.get=function(n){var t=this._get()||new e;return t._targetExp=n,t};i=b.prototype;i.getFuncModule=function(n,t){var i=r.getClassName(n),f,o,e,u;if(i){if(f=this.funcModuleCache[i],f)return f;if(void 0===f&&(o=-1!==i.indexOf("."),o))try{if(o=n===Function("return "+i)())return this.funcModuleCache[i]=i,i}catch(s){}}return e=this.funcs.indexOf(n),e<0&&(e=this.funcs.length,this.funcs.push(n)),u="F["+e+"]",t&&(u="("+u+")"),this.funcModuleCache[i]=u,u};i.getObjRef=function(n){var t=this.objs.indexOf(n);return t<0&&(t=this.objs.length,this.objs.push(n)),"O["+t+"]"};i.setValueType=function(n,t,i,r){var s=e.pool.get(r),f=t.constructor.__props__,o,u,h,c;for(f||(f=Object.keys(t)),o=0;o<f.length;o++)u=f[o],h=i[u],t[u]!==h&&(c=this.enumerateField(i,u,h),s.append(u,c));s.writeCode(n);e.pool.put(s)};i.enumerateCCClass=function(n,t,i){for(var c,h=i.__values__,l=y.getClassAttrs(i),s=0;s<h.length;s++){var e=h[s],r=t[e],f=l[e+nt];w(f,r)||("object"==typeof r&&r instanceof cc.ValueType&&(f=o.getDefault(f))&&f.constructor===r.constructor?(c=u+v(e),this.setValueType(n,f,r,c)):this.setObjProp(n,t,e,r))}};i.instantiateArray=function(n){var u,i,t;if(0===n.length)return"[]";for(u="a"+ ++this.localVariableId,i=[new f(u,"new Array("+n.length+")")],r.value(n,"_iN$t",{globalVar:"",source:i},!0),this.objsToClear_iN$t.push(n),t=0;t<n.length;++t)s(i,u+"["+t+"]=",this.enumerateField(n,t,n[t]));return i};i.instantiateTypedArray=function(n){var u=n.constructor.name||rt(n.constructor),r,i,t;if(0===n.length)return"new "+u;for(r="a"+ ++this.localVariableId,i=[new f(r,"new "+u+"("+n.length+")")],n._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(n),t=0;t<n.length;++t)0!==n[t]&&s(i,r+"["+t+"]=",n[t]);return i};i.enumerateField=function(n,t,i){var r,u,f;return"object"==typeof i&&i?(r=i._iN$t,r)?(u=r.globalVar,u||(u=r.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(u),f=r.source[0],r.source[0]=a(u+"=",f)),u):ArrayBuffer.isView(i)?this.instantiateTypedArray(i):Array.isArray(i)?this.instantiateArray(i):this.instantiateObj(i):"function"==typeof i?this.getFuncModule(i):"string"==typeof i?p(i):("_objFlags"===t&&n instanceof h&&(i&=d),i)};i.setObjProp=function(n,t,i,r){s(n,u+v(i)+"=",this.enumerateField(t,i,r))};i.enumerateObject=function(n,t){var u=t.constructor,i,r;if(cc.Class._isCCClass(u))this.enumerateCCClass(n,t,u);else for(i in t)t.hasOwnProperty(i)&&(95!==i.charCodeAt(0)||95!==i.charCodeAt(1)||"__type__"===i)&&(r=t[i],"object"==typeof r&&r&&r===t._iN$t||this.setObjProp(n,t,i,r))};i.instantiateObj=function(n){var i,t,e;if(n instanceof cc.ValueType)return o.getNewValueTypeCode(n);if(n instanceof cc.Asset)return this.getObjRef(n);if(n._objFlags&k)return null;if(t=n.constructor,cc.Class._isCCClass(t)){if(this.parent)if(this.parent instanceof cc.Component){if(n instanceof cc._BaseNode||n instanceof cc.Component)return this.getObjRef(n)}else if(this.parent instanceof cc._BaseNode)if(n instanceof cc._BaseNode){if(!n.isChildOf(this.parent))return this.getObjRef(n)}else if(n instanceof cc.Component&&!n.node.isChildOf(this.parent))return this.getObjRef(n);i=new f(u,"new "+this.getFuncModule(t,!0)+"()")}else if(t===Object)i=new f(u,"{}");else{if(t)return this.getObjRef(n);i=new f(u,"Object.create(null)")}return e=[i],r.value(n,"_iN$t",{globalVar:"",source:e},!0),this.objsToClear_iN$t.push(n),this.enumerateObject(e,n),["(function(){",e,"return o;})();"]};t.exports={compile:function(n){return new b(n,n instanceof cc._BaseNode&&n).result},equalsToDefault:w}},{"./CCClass":195,"./CCObject":201,"./attribute":207,"./compiler":209,"./js":216}],215:[function(n,t){"use strict";function u(n,t){if(!t&&("object"!=typeof n||Array.isArray(n)||!n||!cc.isValid(n)))return null;var i;if(n instanceof r){if(n._instantiate)return cc.game._isCloning=!0,i=n._instantiate(null,!0),cc.game._isCloning=!1,i;if(n instanceof cc.Asset)return null}return cc.game._isCloning=!0,i=h(n),cc.game._isCloning=!1,i}function h(n,t){var u,r,f;if(Array.isArray(n)||o&&o(n))return null;for(c(n,u=n._iN$t?n._iN$t:n.constructor?new n.constructor:Object.create(null),t),r=0,f=i.length;r<f;++r)i[r]._iN$t=null;return i.length=0,u}function v(n,t,i,r){for(var o,u,h,c=n.__values__,s=0;s<c.length;s++)o=c[s],u=t[o],"object"==typeof u&&u?(h=i[o],h instanceof e&&h.constructor===u.constructor?h.set(u):i[o]=u._iN$t||f(u,r)):i[o]=u}function c(n,t,u){var h,e,o;if(s.value(n,"_iN$t",t,!0),i.push(n),h=n.constructor,cc.Class._isCCClass(h))v(h,n,t,u);else for(e in n)if(n.hasOwnProperty(e)&&(95!==e.charCodeAt(0)||95!==e.charCodeAt(1)||"__type__"===e))if(o=n[e],"object"==typeof o&&o){if(o===t)continue;t[e]=o._iN$t||f(o,u)}else t[e]=o;n instanceof r&&(t._objFlags&=a)}function f(n,t){var r,v,o,y,h,u,a;if(n instanceof e)return n.clone();if(n instanceof cc.Asset)return n;if(ArrayBuffer.isView(n)){for(v=n.length,r=new n.constructor(v),n._iN$t=r,i.push(n),o=0;o<v;++o)r[o]=n[o];return r}if(Array.isArray(n)){for(y=n.length,r=new Array(y),s.value(n,"_iN$t",r,!0),i.push(n),h=0;h<y;++h)u=n[h],r[h]="object"==typeof u&&u?u._iN$t||f(u,t):u;return r}if(n._objFlags&l)return null;if(a=n.constructor,cc.Class._isCCClass(a)){if(t)if(t instanceof cc.Component){if(n instanceof cc._BaseNode||n instanceof cc.Component)return n}else if(t instanceof cc._BaseNode)if(n instanceof cc._BaseNode){if(!n.isChildOf(t))return n}else if(n instanceof cc.Component&&!n.node.isChildOf(t))return n;r=new a}else if(a===Object)r={};else{if(a)return n;r=Object.create(null)}return c(n,r,t),r}var r=n("./CCObject"),e=n("../value-types/value-type"),l=r.Flags.Destroyed,a=r.Flags.PersistentMask,o=n("./utils").isDomNode,s=n("./js"),i=[];u._clone=h;cc.instantiate=u;t.exports=u},{"../value-types/value-type":292,"./CCObject":201,"./js":216,"./utils":219}],216:[function(n,t){"use strict";function h(n,t){for(;n;){var i=Object.getOwnPropertyDescriptor(n,t);if(i)return i;n=Object.getPrototypeOf(n)}return null}function c(n,t,i){var r=h(t,n);Object.defineProperty(i,n,r)}function a(n,t){n.splice(t,1)}function v(n,t){var i=n.indexOf(t);return i>=0&&(a(n,i),!0)}function o(n,t){void 0===t&&(t=n,n=null);this.get=null;this.count=0;this._pool=new Array(t);this._cleanup=n}var y=new(n("./id-generater"))("TmpCId."),i={isNumber:function(n){return"number"==typeof n||n instanceof Number},isString:function(n){return"string"==typeof n||n instanceof String},addon:function(n){var i,u,t,r;for(n=n||{},i=1,u=arguments.length;i<u;i++)if(t=arguments[i],t){if("object"!=typeof t){cc.errorID(5402,t);continue}for(r in t)r in n||c(r,t,n)}return n},mixin:function(n){var i,r,t,u;for(n=n||{},i=1,r=arguments.length;i<r;i++)if(t=arguments[i],t){if("object"!=typeof t){cc.errorID(5403,t);continue}for(u in t)c(u,t,n)}return n},extend:function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n.prototype=Object.create(t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),n},getSuper:function(n){var t=n.prototype,i=t&&Object.getPrototypeOf(t);return i&&i.constructor},isChildClassOf:function(n,t){if(n&&t){if("function"!=typeof n||"function"!=typeof t)return!1;if(n===t)return!0;for(;;){if(!(n=i.getSuper(n)))return!1;if(n===t)return!0}}return!1},clear:function(n){for(var i=Object.keys(n),t=0;t<i.length;t++)delete n[i[t]]},isEmptyObject:function(n){for(var t in n)return!1;return!0},getPropertyDescriptor:h},e={value:void 0,enumerable:!1,writable:!1,configurable:!0},r,u,f,s,l;i.value=function(n,t,i,r,u){e.value=i;e.writable=r;e.enumerable=u;Object.defineProperty(n,t,e);e.value=void 0};r={get:null,set:null,enumerable:!1};i.getset=function(n,t,i,u,f,e){"function"!=typeof u&&(f=u,u=void 0);r.get=i;r.set=u;r.enumerable=f;r.configurable=e;Object.defineProperty(n,t,r);r.get=null;r.set=null};u={get:null,enumerable:!1,configurable:!1};i.get=function(n,t,i,r,f){u.get=i;u.enumerable=r;u.configurable=f;Object.defineProperty(n,t,u);u.get=null};f={set:null,enumerable:!1,configurable:!1};i.set=function(n,t,i,r,u){f.set=i;f.enumerable=r;f.configurable=u;Object.defineProperty(n,t,f);f.set=null};i.getClassName=function(n){var t,r,f,u;return"function"==typeof n?(t=n.prototype,t&&t.hasOwnProperty("__classname__")&&t.__classname__)?t.__classname__:(r="",(n.name&&(r=n.name),n.toString)&&(u=n.toString(),(f="["===u.charAt(0)?u.match(/\[\w+\s*(\w+)\]/):u.match(/function\s*(\w+)/))&&2===f.length&&(r=f[1])),"Object"!==r?r:""):n&&n.constructor?i.getClassName(n.constructor):""},function(){function r(n,t,r){return i.getset(i,t,function(){return Object.assign({},r)},function(n){i.clear(r);Object.assign(r,n)}),function(t,u){var f,e;(u.prototype.hasOwnProperty(n)&&delete r[u.prototype[n]],i.value(u.prototype,n,t),t)&&(f=r[t],f&&f!==u?(e="A Class already exists with the same "+n+' : "'+t+'".',cc.error(e)):r[t]=u)}}var n={},t={},u;i._setClassId=r("__cid__","_registeredClassIds",n);u=r("__classname__","_registeredClassNames",t);i.setClassName=function(n,t){if(u(n,t),!t.prototype.hasOwnProperty("__cid__")){var r=n||y.getNewId();r&&i._setClassId(r,t)}};i.unregisterClass=function(){for(var r,u,f,i=0;i<arguments.length;i++)r=arguments[i].prototype,u=r.__cid__,u&&delete n[u],f=r.__classname__,f&&delete t[f]};i._getClassById=function(t){return n[t]};i.getClassByName=function(n){return t[n]};i._getClassId=function(n,t){if(t=void 0===t||t,"function"==typeof n&&n.prototype.hasOwnProperty("__cid__"))return n.prototype.__cid__;if(n&&n.constructor){var i=n.constructor.prototype;if(i&&i.hasOwnProperty("__cid__"))return n.__cid__}return""}}();i.obsolete=function(n,t,r,u){function s(){return this[o]}var f=/([^.]+)$/,e=f.exec(t)[0],o=f.exec(r)[0];u?i.getset(n,e,s,function(n){this[o]=n}):i.get(n,e,s)};i.obsoletes=function(n,t,r,u){var f,e;for(f in r)e=r[f],i.obsolete(n,t+"."+f,e,u)};s=/(%d)|(%s)/;l=/%s/;i.formatStr=function(){var t=arguments.length,n,e,i,r,f,o,u;if(0===t)return"";if(n=arguments[0],1===t)return""+n;if(e="string"==typeof n&&s.test(n),e)for(i=1;i<t;++i)r=arguments[i],f="number"==typeof r?s:l,f.test(n)?(o=""+r,n=n.replace(f,o)):n+=" "+r;else for(u=1;u<t;++u)n+=" "+arguments[u];return n};i.shiftArguments=function(){for(var t=arguments.length-1,i=new Array(t),n=0;n<t;++n)i[n]=arguments[n+1];return i};i.createMap=function(n){var t=Object.create(null);return n&&(t["."]=!0,t["/"]=!0,delete t["."],delete t["/"]),t};i.array={remove:v,fastRemove:function(n,t){var i=n.indexOf(t);i>=0&&(n[i]=n[n.length-1],--n.length)},removeAt:a,fastRemoveAt:function(n,t){var i=n.length;t<0||t>=i||(n[t]=n[i-1],n.length=i-1)},contains:function(n,t){return n.indexOf(t)>=0},verifyType:function(n,t){if(n&&n.length>0)for(var i=0;i<n.length;i++)if(!(n[i]instanceof t))return cc.logID(1300),!1;return!0},removeArray:function(n,t){for(var i=0,r=t.length;i<r;i++)v(n,t[i])},appendObjectsAt:function(n,t,i){return n.splice.apply(n,[i,0].concat(t)),n},copy:function(n){for(var i=n.length,r=new Array(i),t=0;t<i;t+=1)r[t]=n[t];return r},MutableForwardIterator:n("../utils/mutable-forward-iterator")};o.prototype._get=function(){if(this.count>0){--this.count;var n=this._pool[this.count];return this._pool[this.count]=null,n}return null};o.prototype.put=function(n){var t=this._pool;if(this.count<t.length){if(this._cleanup&&!1===this._cleanup(n))return;t[this.count]=n;++this.count}};o.prototype.resize=function(n){n>=0&&(this._pool.length=n,this.count>n&&(this.count=n))};i.Pool=o;cc.js=i;t.exports=i},{"../utils/mutable-forward-iterator":270,"./id-generater":212}],217:[function(n,t,i){"use strict";function o(n,t,i,r){var e,o,f,s;if(!n.get&&!n.set&&n.hasOwnProperty("default")){e="_N$"+t;n.get=function(){return this[e]};n.set=function(n){var t=this[e];this[e]=n;i.call(this,t)};o={};for(f in r[e]=o,u)s=u[f],n.hasOwnProperty(f)&&(o[f]=n[f],s.canUsedInGet||delete n[f])}}function s(n,t,i,r){if(Array.isArray(t)){if(!(t.length>0))return cc.errorID(5508,i,r);n.type=t=t[0]}"function"==typeof t&&(t===String?n.type=cc.String:t===Boolean?n.type=cc.Boolean:t===Number&&(n.type=cc.Float))}function r(n,t,i){var r=n?{_short:!0}:{_short:!0,"default":t};return i&&(r.type=i),r}var f=n("./js"),e=n("./attribute"),u={"default":{},serializable:{},editorOnly:{},formerlySerializedAs:{}};i.getFullFormOfProperty=function(n,t){return n&&n.constructor===Object?null:Array.isArray(n)&&n.length>0?r(t,[],n):"function"==typeof n?r(t,f.isChildClassOf(n,cc.ValueType)?new n:null,n):n instanceof e.PrimitiveType?r(t,n.default):r(t,n)};i.preprocessAttrs=function(n,t){var u,r,f,e;for(u in n)r=n[u],f=i.getFullFormOfProperty(r,!1),(f&&(r=n[u]=f),r)&&(e=r.notify,e&&o(r,u,e,n),"type"in r&&s(r,r.type,t,u))};i.validateMethodWithProps=function(n){return"function"==typeof n||null===n}},{"./CCClass":195,"./attribute":207,"./js":216}],218:[function(){"use strict";var n=[];cc._RF={push:function(t,i,r){void 0===r&&(r=i,i="");n.push({uuid:i,script:r,module:t,exports:t.exports,beh:null})},pop:function(){var t=n.pop(),r=t.module,i=r.exports,u;if(i===t.exports){for(u in i)return;r.exports=i=t.cls}},peek:function(){return n[n.length-1]}}},{}],219:[function(n,t){"use strict";n("./js");t.exports={contains:function(n,t){if("function"==typeof n.contains)return n.contains(t);if("function"==typeof n.compareDocumentPosition)return!!(16&n.compareDocumentPosition(t));var i=t.parentNode;if(i)do{if(i===n)return!0;i=i.parentNode}while(null!==i);return!1},isDomNode:"object"==typeof window&&("function"==typeof Node?function(n){return n instanceof Node}:function(n){return n&&"object"==typeof n&&"number"==typeof n.nodeType&&"string"==typeof n.nodeName}),callInNextTick:function(n,t,i){n&&setTimeout(function(){n(t,i)},0)}}},{"./js":216}],220:[function(n){"use strict";n("./platform/js");n("./value-types");n("./utils");n("./platform/CCInputManager");n("./platform/CCInputExtension");n("./event");n("./platform/CCSys");n("./platform/CCMacro");n("./asset-manager");n("./CCDirector");n("./renderer");n("./platform/CCView");n("./platform/CCScreen");n("./CCScheduler");n("./event-manager")},{"./CCDirector":27,"./CCScheduler":32,"./asset-manager":50,"./event":144,"./event-manager":140,"./platform/CCInputExtension":198,"./platform/CCInputManager":199,"./platform/CCMacro":200,"./platform/CCScreen":203,"./platform/CCSys":204,"./platform/CCView":205,"./platform/js":216,"./renderer":226,"./utils":268,"./value-types":284}],221:[function(n,t,i){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}function s(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}function h(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}var r;i.__esModule=!0;i.default=void 0;var e=u(n("./assembler")),f=u(n("./utils/dynamic-atlas/manager")),o=u(n("./webgl/render-data"));n("../value-types");r=function(n){function r(){var t;return(t=n.call(this)||this)._renderData=new o.default,t._renderData.init(h(t)),t.initData(),t.initLocal(),t}var i,u,e,c,t;return u=n,(i=r).prototype=Object.create(u.prototype),i.prototype.constructor=i,i.__proto__=u,t=r.prototype,t.initData=function(){this._renderData.createQuadData(0,this.verticesFloats,this.indicesCount)},t.initLocal=function(){this._local=[];this._local.length=4},t.updateColor=function(n,t){var i=this._renderData.uintVDatas[0];if(i){t=null!=t?t:n.node.color._val;for(var u=this.floatsPerVert,r=this.colorOffset,f=i.length;r<f;r+=u)i[r]=t}},t.getBuffer=function(){return cc.renderer._handle._meshBuffer},t.updateWorldVerts=function(n){var o=this._local,t=this._renderData.vDatas[0],f=n.node._worldMatrix.m,a=f[0],v=f[1],y=f[4],p=f[5],r=f[12],u=f[13],s=o[0],h=o[2],c=o[1],l=o[3],e=this.floatsPerVert,i=0;if(1===a&&0===v&&0===y&&1===p)t[i]=s+r,t[i+1]=c+u,t[i+=e]=h+r,t[i+1]=c+u,t[i+=e]=s+r,t[i+1]=l+u,t[i+=e]=h+r,t[i+1]=l+u;else{var w=a*s,b=a*h,k=v*s,d=v*h,g=y*c,nt=y*l,tt=p*c,it=p*l;t[i]=w+g+r;t[i+1]=k+tt+u;t[i+=e]=b+g+r;t[i+1]=d+tt+u;t[i+=e]=w+nt+r;t[i+1]=k+it+u;t[i+=e]=b+nt+r;t[i+1]=d+it+u}},t.fillBuffers=function(n,t){t.worldMatDirty&&this.updateWorldVerts(n);var s=this._renderData,u=s.vDatas[0],h=s.iDatas[0],f=this.getBuffer(t),e=f.request(this.verticesCount,this.indicesCount),i=e.byteOffset>>2,r=f._vData;u.length+i>r.length?r.set(u.subarray(0,r.length-i),i):r.set(u,i);for(var c=f._iData,l=e.indiceOffset,a=e.vertexOffset,o=0,v=h.length;o<v;o++)c[l++]=a+h[o]},t.packToDynamicAtlas=function(n,t){var i,r;!t._original&&f.default&&t._texture.packable&&(i=f.default.insertSpriteFrame(t),i&&t._setDynamicAtlasFrame(i));r=n._materials[0];r&&r.getProperty("texture")!==t._texture&&(n._vertsDirty=!0,n._updateMaterial())},e=r,(c=[{key:"verticesFloats",get:function(){return this.verticesCount*this.floatsPerVert}}])&&s(e.prototype,c),r}(e.default);i.default=r;cc.js.addon(r.prototype,{floatsPerVert:5,verticesCount:4,indicesCount:6,uvOffset:2,colorOffset:4});cc.Assembler2D=r;t.exports=i.default},{"../value-types":284,"./assembler":223,"./utils/dynamic-atlas/manager":229,"./webgl/render-data":256}],222:[function(n,t,i){"use strict";function o(n){return Object.getOwnPropertyDescriptor(n,"__assemblerId__")||(n.__assemblerId__=++e),n.__assemblerId__}var r,u,e,f,s;i.__esModule=!0;i.default=void 0;u=(r=n("../utils/pool"))&&r.__esModule?r:{"default":r};e=0;f=new(function(n){function u(){for(var i,r=arguments.length,u=new Array(r),t=0;t<r;t++)u[t]=arguments[t];return(i=n.call.apply(n,[this].concat(u))||this)._pool={},i}var i,r,t;return r=n,(i=u).prototype=Object.create(r.prototype),i.prototype.constructor=i,i.__proto__=r,t=u.prototype,t.put=function(n){if(n&&this.enabled){var t=o(n.constructor),i=this._pool;i[t]||(i[t]=[]);this.count>this.maxSize||(this._clean(n),i[t].push(n),this.count++)}},t.get=function(n){var t,i,r;return this.enabled&&(i=this._pool,r=o(n),t=i[r]&&i[r].pop()),t?this.count--:t=new n,t},t.clear=function(){this._pool={};this.count=0},t._clean=function(n){n._renderComp=null},u}(u.default));u.default.register("assembler",f);s=f;i.default=s;t.exports=i.default},{"../utils/pool":271}],223:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var r,f=n("./webgl/vertex-format"),e=(r=n("./assembler-pool"))&&r.__esModule?r:{"default":r},u=function(){function t(){this._extendNative&&this._extendNative()}var n=t.prototype;return n.init=function(n){this._renderComp=n},n.updateRenderData=function(){},n.fillBuffers=function(){},n.getVfmt=function(){return f.vfmtPosUvColor},t}();i.default=u;u.register=function(n,t){n.__assembler__=t};u.init=function(n){for(var r,i=n.constructor,t=i.__assembler__;!t;){if(!(i=i.$super))return void cc.warn("Can not find assembler for render component : ["+cc.js.getClassName(n)+"]");t=i.__assembler__}(t.getConstructor&&(t=t.getConstructor(n)),n._assembler&&n._assembler.constructor===t)||(r=e.default.get(t),r.init(n),n._assembler=r)};cc.Assembler=u;t.exports=i.default},{"./assembler-pool":222,"./webgl/vertex-format":258}],224:[function(n,t){"use strict";var i=function(n){var i;try{i=n.getContext("2d")}catch(t){return t={},void console.error(t)}this._canvas=n;this._ctx=i;this._caps={};this._stats={drawcalls:0};this._vx=this._vy=this._vw=this._vh=0;this._sx=this._sy=this._sw=this._sh=0};i.prototype._restoreTexture=function(){};i.prototype.setViewport=function(n,t,i,r){this._vx===n&&this._vy===t&&this._vw===i&&this._vh===r||(this._vx=n,this._vy=t,this._vw=i,this._vh=r)};i.prototype.setScissor=function(n,t,i,r){this._sx===n&&this._sy===t&&this._sw===i&&this._sh===r||(this._sx=n,this._sy=t,this._sw=i,this._sh=r)};i.prototype.clear=function(n){var t=this._ctx;t.clearRect(this._vx,this._vy,this._vw,this._vh);n&&(0!==n[0]||0!==n[1]||0!==n[2])&&(t.fillStyle="rgb("+n[0]+","+n[1]+","+n[2]+")",t.globalAlpha=n[3],t.fillRect(this._vx,this._vy,this._vw,this._vh))};i.prototype.resetDrawCalls=function(){this._stats.drawcalls=0};i.prototype.getDrawCalls=function(){return this._stats.drawcalls};t.exports=i},{}],225:[function(n,t){"use strict";var i=function(n,t){this._device=n;this._width=4;this._height=4;this._image=null;t&&(void 0!==t.width&&(this._width=t.width),void 0!==t.height&&(this._height=t.height),this.updateImage(t))};i.prototype.update=function(n){this.updateImage(n)};i.prototype.updateImage=function(n){if(n.images&&n.images[0]){var t=n.images[0];t&&t!==this._image&&(this._image=t)}};i.prototype.destroy=function(){this._image=null};t.exports=i},{}],226:[function(n,t,i){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}var f;i.__esModule=!0;i.default=void 0;var r=u(n("../../renderer/gfx")),e=u(n("../../renderer/core/input-assembler")),o=u(n("../../renderer/core/pass"));f=cc.renderer={Texture2D:null,InputAssembler:e.default,Pass:o.default,renderEngine:null,canvas:null,device:null,scene:null,drawCalls:0,_handle:null,_cameraNode:null,_camera:null,_forward:null,_flow:null,initWebGL:function(t,i){var u,f,e,o,s;n("./webgl/assemblers");u=n("./webgl/model-batcher");this.Texture2D=r.default.Texture2D;this.canvas=t;this._flow=cc.RenderFlow;f=n("../../renderer/scene/scene");e=n("../../renderer/renderers/forward-renderer");this.device=new r.default.Device(t,i);this.scene=new f;s=(o=this.device,{defaultTexture:new r.default.Texture2D(o,{images:[],width:128,height:128,wrapS:r.default.WRAP_REPEAT,wrapT:r.default.WRAP_REPEAT,format:r.default.TEXTURE_FMT_RGB8,genMipmaps:!1}),programTemplates:[],programChunks:{}});this._forward=new e(this.device,s);this._handle=new u(this.device,this.scene);this._flow.init(this._handle,this._forward)},initCanvas:function(t){var i=n("./canvas"),u=n("./canvas/Texture2D"),r=n("./canvas/Device");this.Device=r;this.Texture2D=u;this.canvas=t;this.device=new r(t);this._camera={a:1,b:0,c:0,d:1,tx:0,ty:0};this._handle=new i.RenderComponentHandle(this.device,this._camera);this._forward=new i.ForwardRenderer;this._flow=cc.RenderFlow;this._flow.init(this._handle,this._forward)},updateCameraViewport:function(){var t,n;cc.director&&(t=cc.director.getScene(),t&&t.setScale(1,1,1));cc.game.renderType===cc.game.RENDER_TYPE_CANVAS&&(n=cc.view.getViewportRect(),this.device.setViewport(n.x,n.y,n.width,n.height),this._camera.a=cc.view.getScaleX(),this._camera.d=cc.view.getScaleY(),this._camera.tx=n.x,this._camera.ty=n.y+n.height)},render:function(n,t){this.device.resetDrawCalls();n&&(this._flow.render(n,t),this.drawCalls=this.device.getDrawCalls())},clear:function(){this._handle.reset();this._forward.clear()}};i.default=f;t.exports=i.default},{"../../renderer/core/input-assembler":307,"../../renderer/core/pass":308,"../../renderer/gfx":317,"../../renderer/renderers/forward-renderer":336,"../../renderer/scene/scene":339,"./canvas":void 0,"./canvas/Device":224,"./canvas/Texture2D":225,"./webgl/assemblers":238,"./webgl/model-batcher":254}],227:[function(n,t){"use strict";function i(){this._func=ft;this._next=null}function it(n,t){var r=new i;switch(r._next=t||s,n){case b:case k:r._func=r._doNothing;break;case l:r._func=r._localTransform;break;case o:r._func=r._worldTransform;break;case a:r._func=r._opacity;break;case v:r._func=r._color;break;case p:r._func=r._updateRenderData;break;case g:r._func=r._render;break;case nt:r._func=r._children;break;case tt:r._func=r._postRender}return r}function ut(n){for(var i=null,t=w;t>0;)t&n&&(i=it(t,i)),t>>=1;return i}function ft(n){var t=n._renderFlag;(e[t]=ut(t))._func(n)}var r,y,u=0,b=1<<u++,k=1<<u++,l=1<<u++,o=1<<u++,rt=l|o,p=1<<u++,a=1<<u++,v=1<<u++,d=a|v,g=1<<u++,nt=1<<u++,tt=1<<u++,w=1<<u++,h=0,f=i.prototype,s,e,c;f._doNothing=function(){};f._localTransform=function(n){n._updateLocalMatrix();n._renderFlag&=~l;this._next._func(n)};f._worldTransform=function(n){r.worldMatDirty++;var u=n._matrix,t=n._trs,i=u.m;i[12]=t[0];i[13]=t[1];i[14]=t[2];n._mulMat(n._worldMatrix,n._parent._worldMatrix,u);n._renderFlag&=~o;this._next._func(n);r.worldMatDirty--};f._opacity=function(n){r.parentOpacityDirty++;this._next._func(n);n._renderFlag&=~a;r.parentOpacityDirty--};f._color=function(n){var t=n._renderComponent;t&&t._updateColor();n._renderFlag&=~v;this._next._func(n)};f._updateRenderData=function(n){var t=n._renderComponent;t._assembler.updateRenderData(t);n._renderFlag&=~p;this._next._func(n)};f._render=function(n){var t=n._renderComponent;t._checkBacth(r,n._cullingMask);t._assembler.fillBuffers(t,r);this._next._func(n)};f._children=function(n){for(var t,s,c=h,i=r,l=i.parentOpacity,a=i.parentOpacity*=n._opacity/255,v=(i.worldMatDirty?o:0)|(i.parentOpacityDirty?d:0),f=n._children,u=0,y=f.length;u<y;u++)t=f[u],(t._renderFlag|=v,t._activeInHierarchy&&0!==t._opacity)&&(h=t._cullingMask=0===t.groupIndex?c:1<<t.groupIndex,s=t._color._val,t._color._fastSetA(t._opacity*a),e[t._renderFlag]._func(t),t._color._val=s);i.parentOpacity=l;this._next._func(n)};f._postRender=function(n){var t=n._renderComponent;t._checkBacth(r,n._cullingMask);t._assembler.postFillBuffers(t,r);this._next._func(n)};s=new i;s._func=s._doNothing;s._next=s;e={};i.flows=e;i.createFlow=it;c=[];i.registerValidate=function(n){n._inValidateList||(c.push(n),n._inValidateList=!0)};i.validateRenderers=function(){for(var n,t=0,i=c.length;t<i;t++)n=c[t],n.isValid&&(n.enabledInHierarchy?n._validateRender():n.disableRender(),n._inValidateList=!1);c.length=0};i.visitRootNode=function(n){i.validateRenderers();var t=h;h=n._cullingMask;n._renderFlag&o?(r.worldMatDirty++,n._calculWorldMatrix(),n._renderFlag&=~o,e[n._renderFlag]._func(n),r.worldMatDirty--):e[n._renderFlag]._func(n);h=t};i.render=function(n,t){r.reset();r.walking=!0;i.visitRootNode(n);r.terminate();r.walking=!1;y.render(r._renderScene,t)};i.renderCamera=function(n,t){r.reset();r.walking=!0;i.visitRootNode(t);r.terminate();r.walking=!1;y.renderCamera(n,r._renderScene)};i.init=function(n,t){r=n;y=t;e[0]=s;for(var u=1;u<w;u++)e[u]=new i};i.getBachther=function(){return r};i.FLAG_DONOTHING=b;i.FLAG_BREAK_FLOW=k;i.FLAG_LOCAL_TRANSFORM=l;i.FLAG_WORLD_TRANSFORM=o;i.FLAG_TRANSFORM=rt;i.FLAG_OPACITY=a;i.FLAG_COLOR=v;i.FLAG_OPACITY_COLOR=d;i.FLAG_UPDATE_RENDER_DATA=p;i.FLAG_RENDER=g;i.FLAG_CHILDREN=nt;i.FLAG_POST_RENDER=tt;i.FLAG_FINAL=w;t.exports=cc.RenderFlow=i},{}],228:[function(n,t){"use strict";function r(n,t){var r=new u;r.initWithSize(n,t);r.update();this._texture=r;this._x=i;this._y=i;this._nexty=i;this._width=n;this._height=t;this._innerTextureInfos={};this._innerSpriteFrames=[];this._count=0}var u=n("../../../assets/CCRenderTexture"),i=2;r.DEFAULT_HASH=(new u)._getHash();cc.js.mixin(r.prototype,{insertSpriteFrame:function(n){var s=n._rect,t=n._texture,f=this._innerTextureInfos[t._id],e=s.x,o=s.y,r,u,h;if(f)e+=f.x,o+=f.y;else{if(r=t.width,u=t.height,this._x+r+i>this._width&&(this._x=i,this._y=this._nexty),this._y+u+i>this._nexty&&(this._nexty=this._y+u+i),this._nexty>this._height)return null;cc.dynamicAtlasManager.textureBleeding&&((r<=8||u<=8)&&(this._texture.drawTextureAt(t,this._x-1,this._y-1),this._texture.drawTextureAt(t,this._x-1,this._y+1),this._texture.drawTextureAt(t,this._x+1,this._y-1),this._texture.drawTextureAt(t,this._x+1,this._y+1)),this._texture.drawTextureAt(t,this._x-1,this._y),this._texture.drawTextureAt(t,this._x+1,this._y),this._texture.drawTextureAt(t,this._x,this._y-1),this._texture.drawTextureAt(t,this._x,this._y+1));this._texture.drawTextureAt(t,this._x,this._y);this._innerTextureInfos[t._id]={x:this._x,y:this._y,texture:t};this._count++;e+=this._x;o+=this._y;this._x+=r+i;this._dirty=!0}return h={x:e,y:o,texture:this._texture},this._innerSpriteFrames.push(n),h},update:function(){this._dirty&&(this._texture.update(),this._dirty=!1)},deleteInnerTexture:function(n){n&&this._innerTextureInfos[n._id]&&(delete this._innerTextureInfos[n._id],this._count--)},isEmpty:function(){return this._count<=0},reset:function(){var t;this._x=i;this._y=i;this._nexty=i;for(var r=this._innerSpriteFrames,n=0,u=r.length;n<u;n++)t=r[n],t.isValid&&t._resetDynamicAtlasFrame();this._innerSpriteFrames.length=0;this._innerTextureInfos={}},destroy:function(){this.reset();this._texture.destroy()}});t.exports=r},{"../../../assets/CCRenderTexture":70}],229:[function(n,t){"use strict";function c(){var n=i[++r];return n||(n=new o(f,f),i.push(n)),n}function l(){a.reset()}var o=n("./atlas"),i=[],r=-1,u=5,f=2048,s=512,h=!0,e=!1,a={Atlas:o,get enabled(){return e},set enabled(n){e!==n&&(n?(this.reset(),cc.director.on(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,l)):cc.director.off(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,l),e=n)},get maxAtlasCount(){return u},set maxAtlasCount(n){u=n},get atlasCount(){return i.length},get textureBleeding(){return h},set textureBleeding(n){h=n},get textureSize(){return f},set textureSize(n){f=n},get maxFrameSize(){return s},set maxFrameSize(n){s=n},insertSpriteFrame:function(n){var t,f;return!e||r===u||!n||n._original?null:n._texture.packable?(t=i[r],t||(t=c()),f=t.insertSpriteFrame(n),f||r===u?f:(t=c()).insertSpriteFrame(n)):null},reset:function(){for(var n=0,t=i.length;n<t;n++)i[n].destroy();i.length=0;r=-1},deleteAtlasSpriteFrame:function(n){if(n._original){var t=n._original._texture;this.deleteAtlasTexture(t)}},deleteAtlasTexture:function(n){if(n)for(var t=i.length-1;t>=0;t--)i[t].deleteInnerTexture(n),i[t].isEmpty()&&(i[t].destroy(),i.splice(t,1),r--)},showDebug:!1,update:function(){if(this.enabled)for(var n=0;n<=r;n++)i[n].update()}};t.exports=cc.dynamicAtlasManager=a},{"./atlas":228}],230:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var ut,pt=(ut=n("../../assembler-2d"))&&ut.__esModule?ut:{"default":ut},b=n("../../../utils/text-utils"),nt=n("../../../platform/CCMacro"),h=n("../../../components/CCLabel").Overflow,r=n("../utils").shareLabelInfo,vt=function(){this.char="";this.valid=!0;this.x=0;this.y=0;this.line=0;this.hash=""},o=cc.rect(),l=null,lt=[],e=[],c=[],k=[],v=null,ft=0,y=0,et=0,ot=0,tt=0,f=1,a=null,u=cc.size(),p="",w=0,st=0,yt=0,at=0,ht=0,d=0,s=0,g=!1,it=0,ct=0,rt=0,wt=function(n){function pt(){return n.apply(this,arguments)||this}var i,ut,t;return ut=n,(i=pt).prototype=Object.create(ut.prototype),i.prototype.constructor=i,i.__proto__=ut,t=pt.prototype,t.updateRenderData=function(n){n._vertsDirty&&l!==n&&(l=n,this._reserveQuads(n,n.string.toString().length),this._updateFontFamily(n),this._updateProperties(n),this._updateLabelInfo(n),this._updateContent(),this.updateWorldVerts(n),l._actualFontSize=w,l.node.setContentSize(u),l._vertsDirty=!1,l=null,this._resetProperties())},t._updateFontScale=function(){f=w/st},t._updateFontFamily=function(n){var t=n.font;a=t.spriteFrame;v=t._fntConfig;r.fontAtlas=t._fontDefDictionary;this.packToDynamicAtlas(n,a)},t._updateLabelInfo=function(){r.hash="";r.margin=0},t._updateProperties=function(n){p=n.string.toString();w=n.fontSize;st=v?v.fontSize:n.fontSize;yt=n.horizontalAlign;at=n.verticalAlign;ht=n.spacingX;s=n.overflow;d=n._lineHeight;u.width=n.node.width;u.height=n.node.height;s===h.NONE?(g=!1,u.width+=2*r.margin,u.height+=2*r.margin):s===h.RESIZE_HEIGHT?(g=!0,u.height+=2*r.margin):g=n.enableWrapText;r.lineHeight=d;r.fontSize=w;this._setupBMFontOverflowMetrics()},t._resetProperties=function(){v=null;a=null;r.hash="";r.margin=0},t._updateContent=function(){this._updateFontScale();this._computeHorizontalKerningForText();this._alignText()},t._computeHorizontalKerningForText=function(){var t,u=p,f=u.length,e=lt,i,n,r,o;if(v&&(t=v.kerningDict),t&&!cc.js.isEmptyObject(t))for(i=-1,n=0;n<f;++n)r=u.charCodeAt(n),o=t[i<<16|65535&r]||0,e[n]=n<f-1?o:0,i=r;else e.length=0},t._multilineTextWrap=function(n){for(var t,l,bt,kt,vt=p.length,ut=0,w=0,yt=0,pt=0,i=0,k=0,nt=0,e=null,o=cc.v2(0,0),a=0;a<vt;)if(t=p.charAt(a),"\n"!==t){for(var dt=n(p,a,vt),et=k,st=nt,gt=i,at=w,ni=!1,wt=0;wt<dt;++wt)if(l=a+wt,"\r"!==(t=p.charAt(l)))if(e=r.fontAtlas.getLetterDefinitionForChar(t,r)){if(bt=at+e.offsetX*f-r.margin,g&&rt>0&&w>0&&bt+e.w*f>rt&&!b.isUnicodeSpace(t)){c.push(i);i=0;ut++;w=0;yt-=d*this._getFontScale()+0;ni=!0;break}o.x=bt;o.y=yt-e.offsetY*f+r.margin;this._recordLetterInfo(o,t,l,ut);l+1<lt.length&&l<vt-1&&(at+=lt[l+1]);at+=e.xAdvance*f+ht-2*r.margin;gt=o.x+e.w*f-r.margin;et<o.y&&(et=o.y);st>o.y-e.h*f&&(st=o.y-e.h*f)}else this._recordPlaceholderInfo(l,t),kt="",v&&(kt=v.atlasName),console.log("Can't find letter definition in texture atlas "+kt+" for letter:"+t);else this._recordPlaceholderInfo(l,t);ni||(w=at,k<et&&(k=et),nt>st&&(nt=st),pt<(i=gt)&&(pt=i),a+=dt)}else c.push(i),i=0,ut++,w=0,yt-=d*this._getFontScale()+0,this._recordPlaceholderInfo(a,t),a++;return c.push(i),y=(ft=ut+1)*d*this._getFontScale(),ft>1&&(y+=0*(ft-1)),u.width=it,u.height=ct,it<=0&&(u.width=parseFloat(pt.toFixed(2))+2*r.margin),ct<=0&&(u.height=parseFloat(y.toFixed(2))+2*r.margin),ot=u.height,tt=0,s!==h.CLAMP&&(k>0&&(ot=u.height+k),nt<-y&&(tt=y+nt)),!0},t._getFirstCharLen=function(){return 1},t._getFontScale=function(){return s===h.SHRINK?f:1},t._getFirstWordLen=function(n,t,i){var u=n.charAt(t),o,e,h,s;if(b.isUnicodeCJK(u)||"\n"===u||b.isUnicodeSpace(u))return 1;if(o=1,e=r.fontAtlas.getLetterDefinitionForChar(u,r),!e)return o;for(h=e.xAdvance*f+ht,s=t+1;s<i&&(u=n.charAt(s),e=r.fontAtlas.getLetterDefinitionForChar(u,r));++s){if(h+e.offsetX*f+e.w*f>rt&&!b.isUnicodeSpace(u)&&rt>0)return o;if(h+=e.xAdvance*f+ht,"\n"===u||b.isUnicodeSpace(u)||b.isUnicodeCJK(u))break;o++}return o},t._multilineTextWrapByWord=function(){return this._multilineTextWrap(this._getFirstWordLen)},t._multilineTextWrapByChar=function(){return this._multilineTextWrap(this._getFirstCharLen)},t._recordPlaceholderInfo=function(n,t){if(n>=e.length){var i=new vt;e.push(i)}e[n].char=t;e[n].hash=t.charCodeAt(0)+r.hash;e[n].valid=!1},t._recordLetterInfo=function(n,t,i,u){var o,f;i>=e.length&&(o=new vt,e.push(o));f=t.charCodeAt(0)+r.hash;e[i].line=u;e[i].char=t;e[i].hash=f;e[i].valid=r.fontAtlas.getLetter(f).valid;e[i].x=n.x;e[i].y=n.y},t._alignText=function(){y=0;c.length=0;this._multilineTextWrapByWord();this._computeAlignmentOffset();s===h.SHRINK&&w>0&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp);this._updateQuads()||s===h.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp)},t._scaleFontSizeDown=function(n){var t=!0;n||(n=.1,t=!1);w=n;t&&this._updateContent()},t._shrinkLabelToContentSize=function(n){for(var u,e,t=0,i=0|w,r=0;t<i;){if(u=r=t+i+1>>1,u<=0)break;f=u/st;this._multilineTextWrapByWord();this._computeAlignmentOffset();n()?i=r-1:t=r}e=t;e>=0&&this._scaleFontSizeDown(e)},t._isVerticalClamp=function(){return y>u.height},t._isHorizontalClamp=function(){for(var n,t=!1,i=0,s=p.length;i<s;++i)if(n=e[i],n.valid){var h=r.fontAtlas.getLetter(n.hash),o=n.x+h.w*f,l=n.line;if(it>0)if(g){if(c[l]>u.width&&(o>u.width||o<0)){t=!0;break}}else if(o>u.width){t=!0;break}}return t},t._isHorizontalClamped=function(n,t){var r=c[t],i=n>u.width||n<0;return g?r>u.width&&i:i},t._updateQuads=function(){var ut=a?a._texture:r.fontAtlas.getTexture(),w=l.node,n,t,i,c,y,g,nt,rt;this.verticesCount=this.indicesCount=0;this._renderData&&(this._renderData.dataLength=0);for(var b=u,ft=w._anchorPoint.x*b.width,st=w._anchorPoint.y*b.height,d=!0,v=0,ht=p.length;v<ht;++v)if(n=e[v],n.valid){if(t=r.fontAtlas.getLetter(n.hash),o.height=t.h,o.width=t.w,o.x=t.u,o.y=t.v,i=n.y+et,ct>0&&(i>ot&&(c=i-ot,o.y+=c,o.height-=c,i-=c),i-t.h*f<tt&&s===h.CLAMP&&(o.height=i<tt?0:(i-tt)/f)),y=n.line,g=n.x+t.w/2*f+k[y],it>0&&this._isHorizontalClamped(g,y))if(s===h.CLAMP)o.width=0;else if(s===h.SHRINK){if(u.width>t.w){d=!1;break}o.width=0}o.height>0&&o.width>0&&(nt=this._determineRect(o),rt=n.x+k[n.line],this.appendQuad(l,ut,o,nt,rt-ft,i-st,f))}return this._quadsUpdated(l),d},t._determineRect=function(n){var r=a.isRotated(),u=a._originalSize,t=a._rect,f=a._offset,e=f.x+(u.width-t.width)/2,i=f.y-(u.height-t.height)/2,o;return r?(o=n.x,n.x=t.x+t.height-n.y-n.height-i,n.y=o+t.y-e,n.y<0&&(n.height=n.height+i)):(n.x+=t.x-e,n.y+=t.y+i),r},t._computeAlignmentOffset=function(){var i,n,e,t,o,r;switch(k.length=0,yt){case nt.TextAlignment.LEFT:for(i=0;i<ft;++i)k.push(0);break;case nt.TextAlignment.CENTER:for(n=0,e=c.length;n<e;n++)k.push((u.width-c[n])/2);break;case nt.TextAlignment.RIGHT:for(t=0,o=c.length;t<o;t++)k.push(u.width-c[t])}(et=u.height,at!==nt.VerticalTextAlignment.TOP)&&(r=u.height-y+d*this._getFontScale()-st*f,et-=at===nt.VerticalTextAlignment.BOTTOM?r:r/2)},t._setupBMFontOverflowMetrics=function(){var n=u.width,t=u.height;s===h.RESIZE_HEIGHT&&(t=0);s===h.NONE&&(n=0,t=0);it=n;ct=t;rt=n},t.updateWorldVerts=function(){},t.appendQuad=function(){},t._quadsUpdated=function(){},t._reserveQuads=function(){},pt}(pt.default);i.default=wt;t.exports=i.default},{"../../../components/CCLabel":107,"../../../platform/CCMacro":200,"../../../utils/text-utils":276,"../../assembler-2d":221,"../utils":234}],231:[function(n,t){"use strict";function i(){this._rect=null;this.uv=[];this._texture=null;this._original=null}i.prototype={constructor:i,getRect:function(){return cc.rect(this._rect)},setRect:function(n){this._rect=n;this._texture&&this._calculateUV()},_setDynamicAtlasFrame:function(n){n&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=n.texture,this._rect.x=n.x,this._rect.y=n.y,this._calculateUV())},_resetDynamicAtlasFrame:function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())},_refreshTexture:function(n){this._texture=n;this._rect=cc.rect(0,0,n.width,n.height);this._calculateUV()},_calculateUV:function(){var t=this._rect,u=this._texture,n=this.uv,i=u.width,r=u.height,f=0===i?0:t.x/i,e=0===i?0:(t.x+t.width)/i,o=0===r?0:(t.y+t.height)/r,s=0===r?0:t.y/r;n[0]=f;n[1]=o;n[2]=e;n[3]=o;n[4]=f;n[5]=s;n[6]=e;n[7]=s}};t.exports=i},{}],232:[function(n,t,i){"use strict";function s(n,t){this._texture=null;this._labelInfo=t;this._char=n;this._hash=null;this._data=null;this._canvas=null;this._context=null;this._width=0;this._height=0;this._offsetY=0;this._hash=n.charCodeAt(0)+t.hash}function a(n,t){var i=new l;i.initWithSize(n,t);i.update();this._fontDefDictionary=new d(i);this._x=u;this._y=u;this._nexty=u;this._width=n;this._height=t;cc.director.on(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)}var f,v;i.__esModule=!0;i.default=void 0;var o,y=(o=n("../../webgl/assemblers/label/2d/bmfont"))&&o.__esModule?o:{"default":o},h=n("../../../components/CCLabel"),c=n("../../../components/CCLabelOutline"),e=n("../../../utils/text-utils"),p=n("../../../components/CCComponent"),l=n("../../../assets/CCRenderTexture"),w=cc.js.isChildClassOf(c,p),b=n("../utils").getFontFamily,r=n("../utils").shareLabelInfo,k=cc.BitmapFont.FontLetterDefinition,d=cc.BitmapFont.FontAtlas,g=cc.Color.WHITE,u=0,nt=(1/255).toFixed(3);s.prototype={constructor:s,updateRenderData:function(){this._updateProperties();this._updateTexture()},_updateProperties:function(){this._texture=new cc.Texture2D;this._data=h._canvasPool.get();this._canvas=this._data.canvas;this._context=this._data.context;this._context.font=this._labelInfo.fontDesc;var t=e.safeMeasureText(this._context,this._char,this._labelInfo.fontDesc),n=2*this._labelInfo.margin+2;this._width=parseFloat(t.toFixed(2))+n;this._height=(1+e.BASELINE_RATIO)*this._labelInfo.fontSize+n;this._offsetY=-this._labelInfo.fontSize*e.BASELINE_RATIO/2;this._canvas.width!==this._width&&(this._canvas.width=this._width);this._canvas.height!==this._height&&(this._canvas.height=this._height);this._texture.initWithElement(this._canvas)},_updateTexture:function(){var n=this._context,t=this._labelInfo,u=this._canvas.width,f=this._canvas.height,o=this._labelInfo.fontSize,s=u/2,h=f/2+o*e.MIDDLE_RATIO+o*e.BASELINE_OFFSET,i=t.color,r;(n.lineJoin="round",n.textAlign="center",n.clearRect(0,0,u,f),n.fillStyle="rgba("+i.r+", "+i.g+", "+i.b+", "+nt+")",n.fillRect(0,0,u,f),n.font=t.fontDesc,n.fillStyle="rgba("+i.r+", "+i.g+", "+i.b+", 1)",t.isOutlined&&t.margin>0)&&(r=t.out||g,n.strokeStyle="rgba("+r.r+", "+r.g+", "+r.b+", "+r.a/255+")",n.lineWidth=2*t.margin,n.strokeText(this._char,s,h));n.fillText(this._char,s,h);this._texture.handleLoadedTexture()},destroy:function(){this._texture.destroy();this._texture=null;h._canvasPool.put(this._data)}};cc.js.mixin(a.prototype,{insertLetterTexture:function(n){var i=n._texture,r=i.width,f=i.height,t;return(this._x+r+u>this._width&&(this._x=u,this._y=this._nexty),this._y+f>this._nexty&&(this._nexty=this._y+f+u),this._nexty>this._height)?null:(this._fontDefDictionary._texture.drawTextureAt(i,this._x,this._y),this._dirty=!0,t=new k,t.u=this._x+1,t.v=this._y+1,t.texture=this._fontDefDictionary._texture,t.valid=!0,t.w=n._width-2,t.h=n._height-2,t.xAdvance=t.w,t.offsetY=n._offsetY,this._x+=r+u,this._fontDefDictionary.addLetterDefinitions(n._hash,t),t)},update:function(){this._dirty&&(this._fontDefDictionary._texture.update(),this._dirty=!1)},reset:function(){var t;this._x=u;this._y=u;this._nexty=u;for(var i=this._fontDefDictionary._letterDefinitions,n=0,r=i.length;n<r;n++)t=i[n],t.isValid&&t.destroy();this._fontDefDictionary.clear()},destroy:function(){this.reset();this._fontDefDictionary._texture.destroy();this._fontDefDictionary._texture=null},beforeSceneLoad:function(){this.clearAllCache()},clearAllCache:function(){this.destroy();var n=new l;n.initWithSize(this._width,this._height);n.update();this._fontDefDictionary._texture=n},getLetter:function(n){return this._fontDefDictionary._letterDefinitions[n]},getTexture:function(){return this._fontDefDictionary.getTexture()},getLetterDefinitionForChar:function(n,t){var u=n.charCodeAt(0)+t.hash,r=this._fontDefDictionary._letterDefinitions[u],i;return r||(i=new s(n,t),i.updateRenderData(),r=this.insertLetterTexture(i),i.destroy()),r}});f=null;v=function(n){function e(){return n.apply(this,arguments)||this}var i,u,t;return u=n,(i=e).prototype=Object.create(u.prototype),i.prototype.constructor=i,i.__proto__=u,t=e.prototype,t._getAssemblerData=function(){return f||(f=new a(2048,2048),cc.Label._shareAtlas=f),f.getTexture()},t._updateFontFamily=function(n){r.fontAtlas=f;r.fontFamily=b(n);var t=w&&n.getComponent(c);t&&t.enabled?(r.isOutlined=!0,r.margin=t.width,r.out=t.color.clone(),r.out.a=t.color.a*n.node.color.a/255):(r.isOutlined=!1,r.margin=0)},t._updateLabelInfo=function(n){var t,u,i;r.fontDesc=this._getFontDesc();r.color=n.node.color;r.hash=(u=(t=r).color.toHEX(),i="",t.isOutlined&&t.margin>0&&(i=i+t.margin+t.out.toHEX()),""+t.fontSize+t.fontFamily+u+i)},t._getFontDesc=function(){return r.fontSize.toString()+"px "+r.fontFamily},t._computeHorizontalKerningForText=function(){},t._determineRect=function(){return!1},e}(y.default);i.default=v;t.exports=i.default},{"../../../assets/CCRenderTexture":70,"../../../components/CCComponent":105,"../../../components/CCLabel":107,"../../../components/CCLabelOutline":108,"../../../utils/text-utils":276,"../../webgl/assemblers/label/2d/bmfont":239,"../utils":234}],233:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var it,et,gt=(it=n("../../assembler-2d"))&&it.__esModule?it:{"default":it},l=n("../../../utils/text-utils"),k=n("../../../platform/CCMacro"),rt=n("../../../components/CCLabel"),vt=n("../../../components/CCLabelOutline"),yt=n("../../../components/CCLabelShadow"),w=rt.Overflow,ni=n("../utils").deleteFromDynamicAtlas,ti=n("../utils").getFontFamily,ii=(1/255).toFixed(3),r=null,a=null,ot=null,e="",pt="",s=0,d=0,o=[],u=cc.Size.ZERO,st=0,g=0,ht=0,v=null,wt="",ut=w.NONE,ct=!1,bt=!1,h=null,nt=cc.Color.WHITE,f=null,b=cc.Color.BLACK,c=cc.rect(),y=cc.Size.ZERO,p=cc.Size.ZERO,kt=!1,lt=!1,at=!1,dt=0,tt=cc.Vec2.ZERO,ft=0,ri=["left","center","right"],ui=function(n){function gt(){return n.apply(this,arguments)||this}var i,it,t;return it=n,(i=gt).prototype=Object.create(it.prototype),i.prototype.constructor=i,i.__proto__=it,t=gt.prototype,t._getAssemblerData=function(){return(et=rt._canvasPool.get()).canvas.width=et.canvas.height=1,et},t._resetAssemblerData=function(n){n&&rt._canvasPool.put(n)},t.updateRenderData=function(t){n.prototype.updateRenderData.call(this,t);t._vertsDirty&&(this._updateProperties(t),this._calculateLabelFont(),this._updateLabelDimensions(),this._updateTexture(t),this._calDynamicAtlas(t),t._actualFontSize=s,t.node.setContentSize(p),this.updateVerts(t),t._vertsDirty=!1,r=null,a=null,ot=null)},t.updateVerts=function(){},t._updatePaddingRect=function(){var n=0,u=0,t=0,i=0,e=0,r,o;(y.width=y.height=0,h&&(n=u=t=i=e=h.width,y.width=y.height=2*e),f)&&(r=f.blur+e,t=Math.max(t,-f._offset.x+r),i=Math.max(i,f._offset.x+r),n=Math.max(n,f._offset.y+r),u=Math.max(u,-f._offset.y+r));lt&&(o=d*Math.tan(.20943951),i+=o,y.width+=o);c.x=t;c.y=n;c.width=t+i;c.height=n+u},t._updateProperties=function(n){var t=n._assemblerData;r=t.context;a=t.canvas;ot=n._frame._original?n._frame._original._texture:n._frame._texture;pt=n.string.toString();s=n._fontSize;d=s;dt=n.underlineHeight||d/8;ut=n.overflow;u.width=n.node.width;u.height=n.node.height;p=n.node.getContentSize();st=n._lineHeight;g=n.horizontalAlign;ht=n.verticalAlign;v=n.node.color;kt=n.enableBold;lt=n.enableItalic;at=n.enableUnderline;wt=ti(n);bt=n.srcBlendFactor===cc.macro.BlendFactor.ONE;ct=ut!==w.NONE&&(ut===w.RESIZE_HEIGHT||n.enableWrapText);(h=(h=vt&&n.getComponent(vt))&&h.enabled&&h.width>0?h:null)&&nt.set(h.color);(f=(f=yt&&n.getComponent(yt))&&f.enabled?f:null)&&(b.set(f.color),b.a=b.a*n.node.color.a/255);this._updatePaddingRect()},t._calculateFillTextStartPosition=function(){var t=0,r,n,i;return g===k.TextAlignment.RIGHT?t=u.width-c.width:g===k.TextAlignment.CENTER&&(t=(u.width-c.width)/2),r=this._getLineHeight()*(o.length-1),n=s*(1-l.BASELINE_RATIO/2),ht!==k.VerticalTextAlignment.TOP&&(i=r+c.height+s-u.height,n-=ht===k.VerticalTextAlignment.BOTTOM?i+=l.BASELINE_RATIO/2*s:i/2),n+=l.BASELINE_OFFSET*s,cc.v2(t+c.x,n+c.y)},t._setupOutline=function(){r.strokeStyle="rgba("+nt.r+", "+nt.g+", "+nt.b+", "+nt.a/255+")";r.lineWidth=2*h.width},t._setupShadow=function(){r.shadowColor="rgba("+b.r+", "+b.g+", "+b.b+", "+b.a/255+")";r.shadowBlur=f.blur;r.shadowOffsetX=f.offset.x;r.shadowOffsetY=-f.offset.y},t._drawTextEffect=function(n,t){var i;if(f||h||at){var c=o.length>1&&f,l=this._measureText(r,e),s=0,u=0;for(f&&this._setupShadow(),h&&this._setupOutline(),i=0;i<o.length;++i)s=n.x,u=n.y+i*t,c&&(h&&r.strokeText(o[i],s,u),r.fillText(o[i],s,u)),at&&(ft=l(o[i]),tt.x=g===k.TextAlignment.RIGHT?n.x-ft:g===k.TextAlignment.CENTER?n.x-ft/2:n.x,tt.y=u+d/8,r.fillRect(tt.x,tt.y,ft,dt));c&&(r.shadowColor="transparent")}},t._updateTexture=function(){var t,n;(r.clearRect(0,0,a.width,a.height),r.lineJoin="round",bt)?r.fillStyle="rgba("+v.r+", "+v.g+", "+v.b+", "+v.a/255+")":(t=h?nt:v,r.fillStyle="rgba("+t.r+", "+t.g+", "+t.b+", "+ii+")",r.fillRect(0,0,a.width,a.height),r.fillStyle="rgba("+v.r+", "+v.g+", "+v.b+", 1)");var i=this._calculateFillTextStartPosition(),e=this._getLineHeight(),s=i.x,u=0;for(this._drawTextEffect(i,e),n=0;n<o.length;++n)u=i.y+n*e,h&&r.strokeText(o[n],s,u),r.fillText(o[n],s,u);f&&(r.shadowColor="transparent");ot.handleLoadedTexture()},t._calDynamicAtlas=function(n){if(n.cacheMode===rt.CacheMode.BITMAP){var t=n._frame;ni(n,t);t._original||t.setRect(cc.rect(0,0,a.width,a.height));this.packToDynamicAtlas(n,t)}},t._updateLabelDimensions=function(){u.width=Math.min(u.width,2048);u.height=Math.min(u.height,2048);var n=!1;a.width!==u.width&&(a.width=u.width,n=!0);a.height!==u.height&&(a.height=u.height,n=!0);n&&(r.font=e);r.textAlign=ri[g]},t._getFontDesc=function(){var n=s.toString()+"px ";return n+=wt,kt&&(n="bold "+n),lt&&(n="italic "+n),n},t._getLineHeight=function(){return 0|(0===st?s:st*s/d)},t._calculateParagraphLength=function(n,t){for(var u,r=[],i=0;i<n.length;++i)u=l.safeMeasureText(t,n[i],e),r.push(u);return r},t._measureText=function(n,t){return function(i){return l.safeMeasureText(n,i,t)}},t._calculateShrinkFont=function(n){var w=this._calculateParagraphLength(n,r),t=0,i=0,a=0,v,o,b,k,g,nt;if(ct){if(v=p.width,o=p.height,v<0||o<0)return;i=o+1;for(var f=0,y=0|s+1,h=0;f<y;){if((h=f+y+1>>1)<=0){cc.logID(4003);break}for(s=h,e=this._getFontDesc(),r.font=e,b=this._getLineHeight(),i=0,t=0;t<n.length;++t)k=l.safeMeasureText(r,n[t],e),i+=l.fragmentText(n[t],k,v,this._measureText(r,e)).length*b;i>o?y=h-1:f=h}0===f?cc.logID(4003):(s=f,e=this._getFontDesc(),r.font=e)}else{for(i=n.length*this._getLineHeight(),t=0;t<n.length;++t)a<w[t]&&(a=w[t]);g=(u.width-c.width)/a;nt=u.height/i;s=d*Math.min(1,g,nt)|0;e=this._getFontDesc();r.font=e}},t._calculateWrapText=function(n){var i,t,u,f;if(ct)for(o=[],i=p.width,t=0;t<n.length;++t)u=l.safeMeasureText(r,n[t],e),f=l.fragmentText(n[t],u,i,this._measureText(r,e)),o=o.concat(f)},t._calculateLabelFont=function(){var n=pt.split("\n"),f,s,h,a;switch(o=n,e=this._getFontDesc(),r.font=e,ut){case w.NONE:for(var t=0,v=0,i=0;i<n.length;++i)f=l.safeMeasureText(r,n[i],e),t=t>f?t:f;v=(o.length+l.BASELINE_RATIO)*this._getLineHeight();s=parseFloat(t.toFixed(2));h=parseFloat(v.toFixed(2));u.width=s+c.width;u.height=h+c.height;p.width=s+y.width;p.height=h+y.height;break;case w.SHRINK:this._calculateShrinkFont(n);this._calculateWrapText(n);break;case w.CLAMP:this._calculateWrapText(n);break;case w.RESIZE_HEIGHT:this._calculateWrapText(n);a=(o.length+l.BASELINE_RATIO)*this._getLineHeight();u.height=a+c.height;p.height=a+y.height}},gt}(gt.default);i.default=ui;t.exports=i.default},{"../../../components/CCLabel":107,"../../../components/CCLabelOutline":108,"../../../components/CCLabelShadow":109,"../../../platform/CCMacro":200,"../../../utils/text-utils":276,"../../assembler-2d":221,"../utils":234}],234:[function(n,t){"use strict";var i=n("./dynamic-atlas/manager"),r=cc.Color.WHITE,u={fontAtlas:null,fontSize:0,lineHeight:0,hAlign:0,vAlign:0,hash:"",fontFamily:"",fontDesc:"Arial",color:r,isOutlined:!1,out:r,margin:0};t.exports={deleteFromDynamicAtlas:function(n,t){t&&t._original&&i&&(i.deleteAtlasSpriteFrame(t),t._resetDynamicAtlasFrame())},getFontFamily:function(n){return n.useSystemFont?n.fontFamily||"Arial":n.font?n.font._nativeAsset?n.font._nativeAsset:(cc.assetManager.postLoadNative(n.font,function(){n.isValid&&n.setVertsDirty()}),"Arial"):"Arial"},shareLabelInfo:u}},{"./dynamic-atlas/manager":229}],235:[function(n,t){"use strict";function h(n,t,i){var e;i=i||2;var r,u,o,s,h,c,y,p=t&&t.length,w=p?t[0]*i:n.length,l=v(n,0,w,i,!0),a=[];if(!l)return a;if(p&&(l=nt(n,t,l,i)),n.length>80*i){for(r=o=n[0],u=s=n[1],e=i;e<w;e+=i)(h=n[e])<r&&(r=h),(c=n[e+1])<u&&(u=c),h>o&&(o=h),c>s&&(s=c);y=Math.max(o-r,s-u)}return f(l,a,i,r,u,y),a}function v(n,t,i,u,f){var e,s;if(f===a(n,t,i,u)>0)for(e=t;e<i;e+=u)s=w(e,n[e],n[e+1],s);else for(e=i-u;e>=t;e-=u)s=w(e,n[e],n[e+1],s);return s&&r(s,s.next)&&(o(s),s=s.next),s}function u(n,t){if(!n)return n;t||(t=n);var f,u=n;do if(f=!1,u.steiner||!r(u,u.next)&&0!==i(u.prev,u,u.next))u=u.next;else{if(o(u),(u=t=u.prev)===u.next)return null;f=!0}while(f||u!==t);return t}function f(n,t,i,r,e,s,h){if(n){!h&&s&&ut(n,r,e,s);for(var l,c,a=n;n.prev!==n.next;)if(l=n.prev,c=n.next,s?k(n,r,e,s):b(n))t.push(l.i/i),t.push(n.i/i),t.push(c.i/i),o(n),n=c.next,a=c.next;else if((n=c)===a){h?1===h?f(n=d(n,t,i),t,i,r,e,s,2):2===h&&g(n,t,i,r,e,s):f(u(n),t,i,r,e,s,1);break}}}function b(n){var r=n.prev,u=n,f=n.next,t;if(i(r,u,f)>=0)return!1;for(t=n.next.next;t!==n.prev;){if(s(r.x,r.y,u.x,u.y,f.x,f.y,t.x,t.y)&&i(t.prev,t,t.next)>=0)return!1;t=t.next}return!0}function k(n,t,r,u){var o=n.prev,h=n,e=n.next;if(i(o,h,e)>=0)return!1;for(var l=o.x<h.x?o.x<e.x?o.x:e.x:h.x<e.x?h.x:e.x,a=o.y<h.y?o.y<e.y?o.y:e.y:h.y<e.y?h.y:e.y,v=o.x>h.x?o.x>e.x?o.x:e.x:h.x>e.x?h.x:e.x,y=o.y>h.y?o.y>e.y?o.y:e.y:h.y>e.y?h.y:e.y,p=c(l,a,t,r,u),w=c(v,y,t,r,u),f=n.nextZ;f&&f.z<=w;){if(f!==n.prev&&f!==n.next&&s(o.x,o.y,h.x,h.y,e.x,e.y,f.x,f.y)&&i(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(f=n.prevZ;f&&f.z>=p;){if(f!==n.prev&&f!==n.next&&s(o.x,o.y,h.x,h.y,e.x,e.y,f.x,f.y)&&i(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0}function d(n,t,i){var u=n,s,f;do s=u.prev,f=u.next.next,!r(s,f)&&y(s,u,u.next,f)&&e(s,f)&&e(f,s)&&(t.push(s.i/i),t.push(u.i/i),t.push(f.i/i),o(u),o(u.next),u=n=f),u=u.next;while(u!==n);return u}function g(n,t,i,r,e,o){var s=n,h,c;do{for(h=s.next.next;h!==s.prev;){if(s.i!==h.i&&ot(s,h))return c=p(s,h),s=u(s,s.next),c=u(c,c.next),f(s,t,i,r,e,o),void f(c,t,i,r,e,o);h=h.next}s=s.next}while(s!==n)}function nt(n,t,i,r){for(var e,o=[],f=0,s=t.length;f<s;f++)(e=v(n,t[f]*r,f<s-1?t[f+1]*r:n.length,r,!1))===e.next&&(e.steiner=!0),o.push(et(e));for(o.sort(tt),f=0;f<o.length;f++)it(o[f],i),i=u(i,i.next);return i}function tt(n,t){return n.x-t.x}function it(n,t){if(t=rt(n,t)){var i=p(t,n);u(i,i.next)}}function rt(n,t){var r,i=t,f=n.x,u=n.y,o=-1/0,h;do{if(u<=i.y&&u>=i.next.y&&(h=i.x+(u-i.y)*(i.next.x-i.x)/(i.next.y-i.y),h<=f&&h>o)){if(o=h,h===f){if(u===i.y)return i;if(u===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}i=i.next}while(i!==t);if(!r)return null;if(f===o)return r.prev;var c,y=r,v=r.x,l=r.y,a=1/0;for(i=r.next;i!==y;)f>=i.x&&i.x>=v&&s(u<l?f:o,u,v,l,u<l?o:f,u,i.x,i.y)&&((c=Math.abs(u-i.y)/(f-i.x))<a||c===a&&i.x>r.x)&&e(i,n)&&(r=i,a=c),i=i.next;return r}function ut(n,t,i,r){var u=n;do null===u.z&&(u.z=c(u.x,u.y,t,i,r)),u.prevZ=u.prev,u.nextZ=u.next,u=u.next;while(u!==n);u.prevZ.nextZ=null;u.prevZ=null;ft(u)}function ft(n){var o,i,t,r,u,s,f,e,h=1;do{for(i=n,n=null,u=null,s=0;i;){for(s++,t=i,f=0,o=0;o<h&&(f++,t=t.nextZ);o++);for(e=h;f>0||e>0&&t;)0===f?(r=t,t=t.nextZ,e--):0!==e&&t?i.z<=t.z?(r=i,i=i.nextZ,f--):(r=t,t=t.nextZ,e--):(r=i,i=i.nextZ,f--),u?u.nextZ=r:n=r,r.prevZ=u,u=r;i=t}u.nextZ=null;h*=2}while(s>1);return n}function c(n,t,i,r,u){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-i)/u)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)/u)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function et(n){var t=n,i=n;do t.x<i.x&&(i=t),t=t.next;while(t!==n);return i}function s(n,t,i,r,u,f,e,o){return(u-e)*(t-o)-(n-e)*(f-o)>=0&&(n-e)*(r-o)-(i-e)*(t-o)>=0&&(i-e)*(f-o)-(u-e)*(r-o)>=0}function ot(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!st(n,t)&&e(n,t)&&e(t,n)&&ht(n,t)}function i(n,t,i){return(t.y-n.y)*(i.x-t.x)-(t.x-n.x)*(i.y-t.y)}function r(n,t){return n.x===t.x&&n.y===t.y}function y(n,t,u,f){return!!(r(n,t)&&r(u,f)||r(n,f)&&r(u,t))||i(n,t,u)>0!=i(n,t,f)>0&&i(u,f,n)>0!=i(u,f,t)>0}function st(n,t){var i=n;do{if(i.i!==n.i&&i.next.i!==n.i&&i.i!==t.i&&i.next.i!==t.i&&y(i,i.next,n,t))return!0;i=i.next}while(i!==n);return!1}function e(n,t){return i(n.prev,n,n.next)<0?i(n,t,n.next)>=0&&i(n,n.prev,t)>=0:i(n,t,n.prev)<0||i(n,n.next,t)<0}function ht(n,t){var i=n,r=!1,f=(n.x+t.x)/2,u=(n.y+t.y)/2;do i.y>u!=i.next.y>u&&f<(i.next.x-i.x)*(u-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==n);return r}function p(n,t){var r=new l(n.i,n.x,n.y),i=new l(t.i,t.x,t.y),u=n.next,f=t.prev;return n.next=t,t.prev=n,r.next=u,u.prev=r,i.next=r,r.prev=i,f.next=i,i.prev=f,i}function w(n,t,i,r){var u=new l(n,t,i);return r?(u.next=r.next,u.prev=r,r.next.prev=u,r.next=u):(u.prev=u,u.next=u),u}function o(n){n.next.prev=n.prev;n.prev.next=n.next;n.prevZ&&(n.prevZ.nextZ=n.nextZ);n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function l(n,t,i){this.i=n;this.x=t;this.y=i;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=!1}function a(n,t,i,r){for(var e=0,u=t,f=i-r;u<i;u+=r)e+=(n[f]-n[u])*(n[u+1]+n[f+1]),f=u;return e}cc.Graphics.earcut=t.exports=h;h.deviation=function(n,t,i,r){var h=t&&t.length,p=h?t[0]*i:n.length,f=Math.abs(a(n,0,p,i)),u,s,c,l,e;if(h)for(u=0,s=t.length;u<s;u++)c=t[u]*i,l=u<s-1?t[u+1]*i:n.length,f-=Math.abs(a(n,c,l,i));for(e=0,u=0;u<r.length;u+=3){var o=r[u]*i,v=r[u+1]*i,y=r[u+2]*i;e+=Math.abs((n[o]-n[y])*(n[v+1]-n[o+1])-(n[o]-n[v])*(n[y+1]-n[o+1]))}return 0===f&&0===e?0:Math.abs((e-f)/f)};h.flatten=function(n){for(var i,r,f=n[0][0].length,u={vertices:[],holes:[],dimensions:f},e=0,t=0;t<n.length;t++){for(i=0;i<n[t].length;i++)for(r=0;r<f;r++)u.vertices.push(n[t][i][r]);t>0&&(e+=n[t-1].length,u.holes.push(e))}return u}},{}],236:[function(n,t){"use strict";function f(){this.reset()}function u(){this._tessTol=.25;this._distTol=.01;this._updatePathOffset=!1;this._paths=null;this._pathLength=0;this._pathOffset=0;this._points=null;this._pointsOffset=0;this._commandx=0;this._commandy=0;this._paths=[];this._points=[]}var i=n("../../../../graphics/helper"),r=n("../../../../graphics/types").PointFlags,e=cc.Graphics.Point=cc.Class({name:"cc.GraphicsPoint","extends":cc.Vec2,ctor:function(){this.reset()},reset:function(){this.dx=0;this.dy=0;this.dmx=0;this.dmy=0;this.flags=0;this.len=0}});cc.js.mixin(f.prototype,{reset:function(){this.closed=!1;this.nbevel=0;this.complex=!0;this.points?this.points.length=0:this.points=[]}});cc.js.mixin(u.prototype,{moveTo:function(n,t){this._updatePathOffset&&(this._pathOffset=this._pathLength,this._updatePathOffset=!1);this._addPath();this._addPoint(n,t,r.PT_CORNER);this._commandx=n;this._commandy=t},lineTo:function(n,t){this._addPoint(n,t,r.PT_CORNER);this._commandx=n;this._commandy=t},bezierCurveTo:function(n,t,u,f,e,o){var h=this._curPath,s=h.points[h.points.length-1];s.x!==n||s.y!==t||u!==e||f!==o?(i.tesselateBezier(this,s.x,s.y,n,t,u,f,e,o,0,r.PT_CORNER),this._commandx=e,this._commandy=o):this.lineTo(e,o)},quadraticCurveTo:function(n,t,i,r){var u=this._commandx,f=this._commandy;this.bezierCurveTo(u+2/3*(n-u),f+2/3*(t-f),i+2/3*(n-i),r+2/3*(t-r),i,r)},arc:function(n,t,r,u,f,e){i.arc(this,n,t,r,u,f,e)},ellipse:function(n,t,r,u){i.ellipse(this,n,t,r,u);this._curPath.complex=!1},circle:function(n,t,r){i.ellipse(this,n,t,r,r);this._curPath.complex=!1},rect:function(n,t,i,r){this.moveTo(n,t);this.lineTo(n,t+r);this.lineTo(n+i,t+r);this.lineTo(n+i,t);this.close();this._curPath.complex=!1},roundRect:function(n,t,r,u,f){i.roundRect(this,n,t,r,u,f);this._curPath.complex=!1},clear:function(n){this._pathLength=0;this._pathOffset=0;this._pointsOffset=0;this._curPath=null;n&&(this._paths.length=0,this._points.length=0)},close:function(){this._curPath.closed=!0},_addPath:function(){var t=this._pathLength,n=this._paths[t];return n?n.reset():(n=new f,this._paths.push(n)),this._pathLength++,this._curPath=n,n},_addPoint:function(n,t,i){var f=this._curPath,r,u,o;f&&(u=this._points,o=f.points,(r=u[this._pointsOffset++])?(r.x=n,r.y=t):(r=new e(n,t),u.push(r)),r.flags=i,o.push(r))}});cc.Graphics._Impl=u;t.exports=u},{"../../../../graphics/helper":159,"../../../../graphics/types":161}],237:[function(n,t,i){"use strict";function w(n){return n&&n.__esModule?n:{"default":n}}function d(n,t,i){return n<t?t:n>i?i:n}var l,p,e,v,y;i.__esModule=!0;i.default=void 0;l=w(n("../../../assembler"));p=w(n("../../../../../renderer/core/input-assembler"));var g=n("../../mesh-buffer"),nt=n("../../../index"),b=n("../../../../graphics/graphics"),r=n("../../../../graphics/types").PointFlags,o=b.LineJoin,u=b.LineCap,tt=n("./earcut");n("./impl");var f=Math.PI,it=Math.min,k=Math.max,a=Math.ceil,rt=Math.acos,s=Math.cos,h=Math.sin,c=Math.atan2;e=cc.gfx;v=new e.VertexFormat([{name:e.ATTR_POSITION,type:e.ATTR_TYPE_FLOAT32,num:2},{name:e.ATTR_COLOR,type:e.ATTR_TYPE_UINT8,num:4,normalize:!0},{name:"a_dist",type:e.ATTR_TYPE_FLOAT32,num:1}]);v.name="vfmtPosColorSdf";y=function(n){function l(t){var i;return(i=n.call(this,t)||this)._buffer=null,i._buffers=[],i._bufferOffset=0,i}var i,e,t;return e=n,(i=l).prototype=Object.create(e.prototype),i.prototype.constructor=i,i.__proto__=e,t=l.prototype,t.getVfmt=function(){return v},t.getVfmtFloatCount=function(){return 4},t.requestBuffer=function(){var n={indiceStart:0,vertexStart:0},t=new g(nt._handle,this.getVfmt()),i;return n.meshbuffer=t,i=new p.default(t._vb,t._ib),n.ia=i,this._buffers.push(n),n},t.getBuffers=function(){return 0===this._buffers.length&&this.requestBuffer(),this._buffers},t.clear=function(n){var t,i,e,f,r,o,u;if(this._bufferOffset=0,t=this._buffers,n){for(i=0,e=t.length;i<e;i++)f=t[i],f.meshbuffer.destroy(),f.meshbuffer=null;t.length=0}else for(r=0,o=t.length;r<o;r++)u=t[r],u.indiceStart=0,u.vertexStart=0,u.meshbuffer.reset()},t.fillBuffers=function(n,t){var i,f;t._flush();t.node=n.node;t.material=n._materials[0];for(var u=this.getBuffers(),r=0,e=u.length;r<e;r++)i=u[r],f=i.meshbuffer,i.ia._count=i.indiceStart,t._flushIA(i.ia),f.uploadData()},t.genBuffer=function(n,t){var r=this.getBuffers(),i=r[this._bufferOffset],f=i.meshbuffer,u=i.vertexStart+t;return(u>65535||3*u>131070)&&(++this._bufferOffset,u=t,this._bufferOffset<r.length?i=r[this._bufferOffset]:(i=this.requestBuffer(n),r[this._bufferOffset]=i),f=i.meshbuffer),u>f.vertexOffset&&f.requestStatic(t,3*t),this._buffer=i,i},t.stroke=function(n){this._curColor=n._strokeColor._val;this._flattenPaths(n._impl);this._expandStroke(n);n._impl._updatePathOffset=!0},t.fill=function(n){this._curColor=n._fillColor._val;this._expandFill(n);n._impl._updatePathOffset=!0},t._expandStroke=function(n){var st,dt,gt,ni,i=.5*n.lineWidth,s=n.lineCap,ht=n.lineJoin,fi=n.miterLimit,h=n._impl,l=(st=i,dt=f,gt=h._tessTol,ni=2*rt(st/(st+gt)),k(2,a(dt/ni))),v,at,d,g,nt,tt,it,p,ut,ft,et;this._calculateJoins(h,i,ht,fi);for(var ti=h._paths,ct=0,lt=h._pathOffset,ei=h._pathLength;lt<ei;lt++)v=ti[lt],at=v.points.length,ct+=ht===o.ROUND?2*(at+v.nbevel*(l+2)+1):2*(at+5*v.nbevel+1),v.closed||(ct+=s===u.ROUND?2*(2*l+2):12);for(var y=this.genBuffer(n,ct),ii=y.meshbuffer,b=ii._vData,vt=ii._iData,yt=h._pathOffset,oi=h._pathLength;yt<oi;yt++){var pt,ri=ti[yt],c=ri.points,wt=c.length,ui=y.vertexStart,e=void 0,t=void 0,bt=void 0,kt=void 0;for(((pt=ri.closed)?(e=c[wt-1],t=c[0],bt=0,kt=wt):(e=c[0],t=c[1],bt=1,kt=wt-1),t=t||e,pt)||(d=t.sub(e),d.normalizeSelf(),g=d.x,nt=d.y,s===u.BUTT?this._buttCapStart(e,g,nt,i,0):s===u.SQUARE?this._buttCapStart(e,g,nt,i,i):s===u.ROUND&&this._roundCapStart(e,g,nt,i,l)),tt=bt;tt<kt;++tt)ht===o.ROUND?this._roundJoin(e,t,i,i,l):0!=(t.flags&(r.PT_BEVEL|r.PT_INNERBEVEL))?this._bevelJoin(e,t,i,i):(this._vset(t.x+t.dmx*i,t.y+t.dmy*i,1),this._vset(t.x-t.dmx*i,t.y-t.dmy*i,-1)),e=t,t=c[tt+1];pt?(it=this.getVfmtFloatCount(),p=ui*it,this._vset(b[p],b[p+1],1),this._vset(b[p+it],b[p+it+1],-1)):(ut=t.sub(e),ut.normalizeSelf(),ft=ut.x,et=ut.y,s===u.BUTT?this._buttCapEnd(t,ft,et,i,0):s===u.SQUARE?this._buttCapEnd(t,ft,et,i,i):s===u.ROUND&&this._roundCapEnd(t,ft,et,i,l));for(var ot=y.indiceStart,w=ui+2,si=y.vertexStart;w<si;w++)vt[ot++]=w-2,vt[ot++]=w-1,vt[ot++]=w;y.indiceStart=ot}},t._expandFill=function(n){for(var u,f,i,p,e,s,it,r=n._impl,w=r._paths,b=0,c=r._pathOffset,rt=r._pathLength;c<rt;c++)b+=w[c].points.length;for(var t=this.genBuffer(n,b),k=t.meshbuffer,d=k._vData,o=k._iData,l=r._pathOffset,ut=r._pathLength;l<ut;l++){var g=w[l],a=g.points,nt=a.length;if(0!==nt){for(u=t.vertexStart,f=0;f<nt;++f)this._vset(a[f].x,a[f].y);if(i=t.indiceStart,g.complex){for(var v=[],ft=this.getVfmtFloatCount(),y=u,et=t.vertexStart;y<et;y++)p=y*ft,v.push(d[p]),v.push(d[p+1]);if(e=tt(v,null,2),!e||0===e.length)continue;for(s=0,it=e.length;s<it;s++)o[i++]=e[s]+u}else for(var ot=u,h=u+2,st=t.vertexStart;h<st;h++)o[i++]=ot,o[i++]=h-1,o[i++]=h;t.indiceStart=i}}},t._calculateJoins=function(n,t,i,u){var y=0,c,s;t>0&&(y=1/t);for(var nt=n._paths,a=n._pathOffset,tt=n._pathLength;a<tt;a++){var v=nt[a],h=v.points,p=h.length,e=h[p-1],f=h[0];for(v.nbevel=0,c=0;c<p;c++){var l,w,rt=e.dy,ut=-e.dx,ft=f.dy,et=-f.dx;(f.dmx=.5*(rt+ft),f.dmy=.5*(ut+et),(l=f.dmx*f.dmx+f.dmy*f.dmy)>1e-6)&&(s=1/l,s>600&&(s=600),f.dmx*=s,f.dmy*=s);f.dx*e.dy-e.dx*f.dy>0&&(f.flags|=r.PT_LEFT);l*(w=k(11,it(e.len,f.len)*y))*w<1&&(f.flags|=r.PT_INNERBEVEL);var b=f.dmx*t,d=f.dmy*t,g=b*b+d*d;(g>f.len*f.len||g>e.len*e.len)&&(f.flags|=r.PT_INNERBEVEL);f.flags&r.PT_CORNER&&(l*u*u<1||i===o.BEVEL||i===o.ROUND)&&(f.flags|=r.PT_BEVEL);0!=(f.flags&(r.PT_BEVEL|r.PT_INNERBEVEL))&&v.nbevel++;e=f;f=h[c+1]}}},t._flattenPaths=function(n){for(var f,s,r,h=n._paths,e=n._pathOffset,c=n._pathLength;e<c;e++){var o=h[e],t=o.points,i=t[t.length-1],u=t[0];for(t.length>2&&i.equals(u)&&(o.closed=!0,t.pop(),i=t[t.length-1]),f=0,s=t.length;f<s;f++)r=u.sub(i),i.len=r.mag(),(r.x||r.y)&&r.normalizeSelf(),i.dx=r.x,i.dy=r.y,i=u,u=t[f+1]}},t._chooseBevel=function(n,t,i,r){var u,f,e,o,s=i.x,h=i.y;return 0!==n?(u=s+t.dy*r,f=h-t.dx*r,e=s+i.dy*r,o=h-i.dx*r):(u=e=s+i.dmx*r,f=o=h+i.dmy*r),[u,f,e,o]},t._buttCapStart=function(n,t,i,r,u){var f=n.x-t*u,e=n.y-i*u,o=i,s=-t;this._vset(f+o*r,e+s*r,1);this._vset(f-o*r,e-s*r,-1)},t._buttCapEnd=function(n,t,i,r,u){var f=n.x+t*u,e=n.y+i*u,o=i,s=-t;this._vset(f+o*r,e+s*r,1);this._vset(f-o*r,e-s*r,-1)},t._roundCapStart=function(n,t,i,r,u){for(var e=n.x,o=n.y,c=i,l=-t,a=0;a<u;a++){var v=a/(u-1)*f,y=s(v)*r,p=h(v)*r;this._vset(e-c*y-t*p,o-l*y-i*p,1);this._vset(e,o,0)}this._vset(e+c*r,o+l*r,1);this._vset(e-c*r,o-l*r,-1)},t._roundCapEnd=function(n,t,i,r,u){var e=n.x,o=n.y,l=i,a=-t,c;for(this._vset(e+l*r,o+a*r,1),this._vset(e-l*r,o-a*r,-1),c=0;c<u;c++){var v=c/(u-1)*f,y=s(v)*r,p=h(v)*r;this._vset(e,o,0);this._vset(e-l*y+t*p,o-a*y+i*p,1)}},t._roundJoin=function(n,t,i,u,e){var v=n.dy,y=-n.dx,p=t.dy,w=-t.dx,o=t.x,l=t.y,ft,nt,et,ut;if(0!=(t.flags&r.PT_LEFT)){var b=this._chooseBevel(t.flags&r.PT_INNERBEVEL,n,t,i),ht=b[0],ct=b[1],lt=b[2],at=b[3],k=c(-y,-v),g=c(-w,-p);for(g>k&&(g-=2*f),this._vset(ht,ct,1),this._vset(o-v*u,t.y-y*u,-1),ft=d(a((k-g)/f)*e,2,e),nt=0;nt<ft;nt++){var ot=k+nt/(ft-1)*(g-k),vt=o+s(ot)*u,yt=l+h(ot)*u;this._vset(o,l,0);this._vset(vt,yt,-1)}this._vset(lt,at,1);this._vset(o-p*u,l-w*u,-1)}else{var tt=this._chooseBevel(t.flags&r.PT_INNERBEVEL,n,t,-u),pt=tt[0],wt=tt[1],bt=tt[2],kt=tt[3],it=c(y,v),rt=c(w,p);for(rt<it&&(rt+=2*f),this._vset(o+v*u,l+y*u,1),this._vset(pt,wt,-1),et=d(a((rt-it)/f)*e,2,e),ut=0;ut<et;ut++){var st=it+ut/(et-1)*(rt-it),dt=o+s(st)*i,gt=l+h(st)*i;this._vset(dt,gt,1);this._vset(o,l,0)}this._vset(o+p*u,l+w*u,1);this._vset(bt,kt,-1)}},t._bevelJoin=function(n,t,i,u){var o,s,h,c,l,a,v,y,p=n.dy,w=-n.dx,b=t.dy,k=-t.dx,f,e;t.flags&r.PT_LEFT?(f=this._chooseBevel(t.flags&r.PT_INNERBEVEL,n,t,i),l=f[0],a=f[1],v=f[2],y=f[3],this._vset(l,a,1),this._vset(t.x-p*u,t.y-w*u,-1),this._vset(v,y,1),this._vset(t.x-b*u,t.y-k*u,-1)):(e=this._chooseBevel(t.flags&r.PT_INNERBEVEL,n,t,-u),o=e[0],s=e[1],h=e[2],c=e[3],this._vset(t.x+p*i,t.y+w*i,1),this._vset(o,s,-1),this._vset(t.x+b*i,t.y+k*i,1),this._vset(h,c,-1))},t._vset=function(n,t,i){void 0===i&&(i=0);var u=this._buffer,f=u.meshbuffer,r=u.vertexStart*this.getVfmtFloatCount(),e=f._vData,o=f._uintVData;e[r]=n;e[r+1]=t;o[r+2]=this._curColor;e[r+3]=i;u.vertexStart++;f._dirty=!0},l}(l.default);i.default=y;l.default.register(cc.Graphics,y);t.exports=i.default},{"../../../../../renderer/core/input-assembler":307,"../../../../graphics/graphics":158,"../../../../graphics/types":161,"../../../assembler":223,"../../../index":226,"../../mesh-buffer":253,"./earcut":235,"./impl":236}],238:[function(n){"use strict";cc.assemblers={};n("./sprite");n("./mask-assembler");n("./graphics");n("./label");n("./motion-streak")},{"./graphics":237,"./label":243,"./mask-assembler":244,"./motion-streak":void 0,"./sprite":251}],239:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var u,f=(u=n("../../../../utils/label/bmfont"))&&u.__esModule?u:{"default":u},r=0,e=function(n){function f(){return n.apply(this,arguments)||this}var i,u,t;return u=n,(i=f).prototype=Object.create(u.prototype),i.prototype.constructor=i,i.__proto__=u,t=f.prototype,t.initData=function(){this._renderData.createFlexData(0,4,6,this.getVfmt())},t._reserveQuads=function(n,t){var o=4*t,e=6*t,s=this._renderData._flexBuffer;s.reserve(o,e);s.used(o,e);for(var f=this._renderData.iDatas[0],i=0,u=0,h=e;i<h;i+=6,u+=4)f[i]=u,f[i+1]=u+1,f[i+2]=u+2,f[i+3]=u+1,f[i+4]=u+3,f[i+5]=u+2;r=0},t._quadsUpdated=function(){r=0;this._renderData._flexBuffer.used(this.verticesCount,this.indicesCount)},t._getColor=function(n){return n.node._color._val},t.appendQuad=function(n,t,i,u,f,e,o){var nt=this._renderData,s=nt.vDatas[0],tt=nt.uintVDatas[0],d,g;this.verticesCount+=4;this.indicesCount=this.verticesCount/2*3;var c,l,a,v,p=t.width,w=t.height,b=i.width,k=i.height,it=this._getColor(n),y=this.floatsPerVert,h=r+this.uvOffset;for(u?(c=i.x/p,a=(i.x+k)/p,l=(i.y+b)/w,v=i.y/w,s[h]=c,s[h+1]=v,s[h+=y]=c,s[h+1]=l,s[h+=y]=a,s[h+1]=v,s[h+=y]=a,s[h+1]=l):(c=i.x/p,a=(i.x+b)/p,l=(i.y+k)/w,v=i.y/w,s[h]=c,s[h+1]=l,s[h+=y]=a,s[h+1]=l,s[h+=y]=c,s[h+1]=v,s[h+=y]=a,s[h+1]=v),c=f,a=f+b*o,l=e-k*o,v=e,this.appendVerts(n,r,c,a,l,v),d=r+this.colorOffset,g=0;g<4;g++)tt[d]=it,d+=y;r+=4*this.floatsPerVert},t.appendVerts=function(n,t,i,r,u,f){var e=this._local,o=this.floatsPerVert;e[t]=i;e[t+1]=u;e[t+=o]=r;e[t+1]=u;e[t+=o]=i;e[t+1]=f;e[t+=o]=r;e[t+1]=f},t.updateWorldVerts=function(n){for(var u,f,t=n.node._worldMatrix.m,o=t[0],s=t[1],h=t[4],c=t[5],l=t[12],a=t[13],r=this._local,e=this._renderData.vDatas[0],v=this.floatsPerVert,i=0;i<r.length;i+=v)u=r[i],f=r[i+1],e[i]=u*o+f*h+l,e[i+1]=u*s+f*c+a},f}(f.default);i.default=e;t.exports=i.default},{"../../../../utils/label/bmfont":230}],240:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;n("../../../../../platform/js");n("./bmfont");var u=n("../../../../utils/label/letter-font"),r=cc.color(255,255,255,255),f=function(n){function f(){return n.apply(this,arguments)||this}var t,u,i;return u=n,(t=f).prototype=Object.create(u.prototype),t.prototype.constructor=t,t.__proto__=u,i=f.prototype,i.createData=function(n){return n.requestRenderData()},i._getColor=function(n){return r._fastSetA(n.node._color.a),r._val},i.updateColor=function(t){var i=this._getColor(t);n.prototype.updateColor.call(this,t,i)},f}(u);i.default=f;t.exports=i.default},{"../../../../../platform/js":216,"../../../../utils/label/letter-font":232,"./bmfont":239}],241:[function(n,t,i){"use strict";var r,u,f;i.__esModule=!0;i.default=void 0;u=(r=n("../../../../../assets/material/material-variant"))&&r.__esModule?r:{"default":r};n("../../../../../components/CCLabel");n("../../../../../components/CCLabelShadow");n("../../../../../components/CCLabelOutline");n("../../../../../assets/material/CCMaterial");f=function(){function t(){}var n=t.prototype;return n.init=function(n){this.labelMaterial=null;this._label=this._renderComp=n;renderer.CustomAssembler.prototype.ctor.call(this);n.node._proxy.setAssembler(this);this._layout=new jsb.LabelRenderer;this._layout.init(n);this._cfg=new DataView(this._layout._cfg);this._layoutInfo=new DataView(this._layout._layout);this._cfgFields=jsb.LabelRenderer._cfgFields;this._layoutFields=jsb.LabelRenderer._layoutFields;this._layout.bindNodeProxy(n.node._proxy);this._bindMaterial(n)},n._setBufferFlag=function(n,t,i,r,u){var f,e;"int8"==r&&1==i?(f=n.getInt8(t),n.setInt8(t,u|f)):"int32"==r&&4==i?(e=n.getInt32(t,jsb.__isLittleEndian__),n.setInt32(t,u|e,jsb.__isLittleEndian__)):cc.warn("flag storage type should be int8/int32 only, type/size -> "+r+"/"+i+".")},n._updateCfgFlag=function(n){var t=this._cfgFields.updateFlags;this._setBufferFlag(this._cfg,t.offset,t.size,t.type,n)},n._setBufferValue=function(n,t,i,r,u){"float"==r&&4==i?n.setFloat32(t,u,jsb.__isLittleEndian__):"int32"==r&&4==i?n.setInt32(t,u,jsb.__isLittleEndian__):"bool"==r&&1==i?n.setInt8(t,u?1:0,jsb.__isLittleEndian__):"Color4B"==r&&4==i?(n.setUint8(t,u.r),n.setUint8(t+1,u.g),n.setUint8(t+2,u.b),n.setUint8(t+3,u.a)):"int8"==r&&1==i?n.setUint8(t,u):cc.warn("dont know how to set value to buffer, type/size -> "+r+"/"+i+".")},n._setFieldValue=function(n,t,i,r){var u=t[i];this._setBufferValue(n,u.offset,u.size,u.type,r)},n._getBufferValue=function(n,t,i,r){return"float"==r&&4==i?n.getFloat32(t,jsb.__isLittleEndian__):"int32"==r&&4==i?n.getInt32(t,jsb.__isLittleEndian__):"bool"==r&&1==i?0!=n.getInt8(t,jsb.__isLittleEndian__):"Color4B"==r&&4==i?{r:n.getUint8(t),g:n.getUint8(t+1),b:n.getUint8(t+2),a:n.getUint8(t+3)}:"int8"==r&&1==i?n.getUint8(t):void cc.warn("dont know how to get value from buffer, type/size -> "+r+"/"+i+".")},n._getFieldValue=function(n,t,i){var r=t[i];return this._getBufferValue(n,r.offset,r.size,r.type)},n._getLayoutValue=function(n){return this._getFieldValue(this._layoutInfo,this._layoutFields,n)},n._setLayoutValue=function(n,t){return this._setFieldValue(this._layoutInfo,this._layoutFields,n,t)},n._updateCfgFlag_Content=function(){this._updateCfgFlag(1)},n._updateCfgFlag_Font=function(){this._updateCfgFlag(2)},n._colorEqual=function(n,t){return n.r==t.r&&n.g==t.g&&n.b==t.b&&n.a==t.a},n._colorToObj=function(n,t,i,r){return{r:n,g:t,b:i,a:r}},n.setString=function(n){n!=this._layout.string&&(this._layout.string=n,this._updateCfgFlag_Content())},n.setFontPath=function(n){n!=this._layout.fontPath&&(this._layout.fontPath=n,this._updateCfgFlag_Font())},n.setFontSize=function(n,t){this._getFieldValue(this._cfg,this._cfgFields,"fontSize")!=n&&(this._setFieldValue(this._cfg,this._cfgFields,"fontSize",n),this._setFieldValue(this._cfg,this._cfgFields,"fontSizeRetina",t),this._updateCfgFlag_Font())},n.setOutline=function(n){var t=this._getLayoutValue("outlineSize");t>0!=n>0&&this._updateCfgFlag_Font();t!=n&&(this._updateCfgFlag_Content(),this._setLayoutValue("outlineSize",n))},n.setOutlineColor=function(n){var t=this._getLayoutValue("outlineColor");this._colorEqual(t,n)||(this._setLayoutValue("outlineColor",n),this._updateCfgFlag_Content())},n.setLineHeight=function(n){this._getLayoutValue("lineHeight")!=n&&(this._setLayoutValue("lineHeight",n),this._updateCfgFlag_Content())},n.setOverFlow=function(n){this._getLayoutValue("overflow")!=n&&(this._setLayoutValue("overflow",n),this._updateCfgFlag_Content())},n.setEnableWrap=function(n){this._getLayoutValue("wrap")!=n&&(this._setLayoutValue("wrap",n),this._updateCfgFlag_Content())},n.setVerticalAlign=function(n){this._getLayoutValue("valign")!=n&&(this._setLayoutValue("valign",n),this._updateCfgFlag_Content())},n.setHorizontalAlign=function(n){this._getLayoutValue("halign")!=n&&(this._setLayoutValue("halign",n),this._updateCfgFlag_Content())},n.setContentSize=function(n,t){var i=this._getLayoutValue("width"),r=this._getLayoutValue("height");i==n&&r==t||(this._setLayoutValue("height",t),this._setLayoutValue("width",n),this._updateCfgFlag_Content())},n.setAnchorPoint=function(n,t){var i=this._getLayoutValue("anchorX"),r=this._getLayoutValue("anchorY");i==n&&r==t||(this._setLayoutValue("anchorX",n),this._setLayoutValue("anchorY",t),this._updateCfgFlag_Content())},n.setColor=function(n){var t=this._getLayoutValue("color");this._colorEqual(t,n)||(this._setLayoutValue("color",n),this._updateCfgFlag_Content())},n.setShadow=function(n,t,i){var u=this._getLayoutValue("shadowBlur"),f=this._getLayoutValue("shadowX"),e=this._getLayoutValue("shadowY"),r;u>0!=i>0&&this._updateCfgFlag_Font();r=!1;u!=i&&(this._setLayoutValue("shadowBlur",i),r=!0);f!=n&&(this._setLayoutValue("shadowX",n),r=!0);e!=t&&(this._setLayoutValue("shadowY",t),r=!0);r&&this._updateCfgFlag_Content()},n.setShadowColor=function(n){var t=this._getLayoutValue("shadowColor");this._colorEqual(t,n)||(this._setLayoutValue("shadowColor",n),this._updateCfgFlag_Content())},n.setItalic=function(n){this._getLayoutValue("italic")!=n&&(this._setLayoutValue("italic",n),this._updateCfgFlag_Content())},n.setBold=function(n){this._getLayoutValue("bold")!=n&&(this._setLayoutValue("bold",n),this._updateCfgFlag_Content(),this._updateCfgFlag_Font())},n.setUnderline=function(n){this._getLayoutValue("underline")!=n&&(this._setLayoutValue("underline",n),this._updateCfgFlag_Content())},n.setSpacingX=function(n){this._getLayoutValue("spaceX")==n||"number"!=typeof n||isNaN(n)||(this._setLayoutValue("spaceX",n),this._updateCfgFlag_Content())},n.updateRenderData=function(n){var i,r;if(n._vertsDirty){n.font&&n.font.nativeUrl&&this.setFontPath(cc.assetManager.cacheManager.getCache(n.font.nativeUrl)||n.font.nativeUrl);var f=this._layout,u=n.node.color,t=n.node,e=n.fontSize;this.setString(n.string);this.setFontSize(n.fontSize,e/72*n.fontSize);this.setLineHeight(n.lineHeight);this.setEnableWrap(n.enableWrapText);this.setItalic(n.enableItalic);this.setUnderline(n.enableUnderline);this.setBold(n.enableBold);this.setOverFlow(n.overflow);this.setVerticalAlign(n.verticalAlign);this.setHorizontalAlign(n.horizontalAlign);this.setSpacingX(n.spacingX);this.setContentSize(t.getContentSize().width,t.getContentSize().height);this.setAnchorPoint(t.anchorX,t.anchorY);this.setColor(this._colorToObj(u.getR(),u.getG(),u.getB(),Math.ceil(u.getA()*t.opacity/255)));i=t.getComponent(cc.LabelShadow);i&&i.enabled?(r=i.color,this.setShadow(i.offset.x,i.offset.y,i.blur),this.setShadowColor(this._colorToObj(r.getR(),r.getG(),r.getB(),Math.ceil(r.getA()*t.opacity/255)))):this.setShadow(0,0,-1);this._updateTTFMaterial(n);f.render()}},n._bindMaterial=function(n){var t=this.labelMaterial;return t||(t=u.default.createWithBuiltin("2d-label",n),this.labelMaterial=t),t},n._updateTTFMaterial=function(n){var t=this._bindMaterial(n),f=this._label.node,e=this._layout,i=f.getComponent(cc.LabelOutline),u=0,r;i&&i.enabled&&i.width>0&&(u=Math.max(Math.min(i.width/10,.4),.1),r=i.color,this.setOutlineColor(this._colorToObj(r.getR(),r.getG(),r.getB(),Math.ceil(r.getA()*f.opacity/255))));this.setOutline(u);t.define("CC_USE_MODEL",!0);t.define("USE_TEXTURE_ALPHAONLY",!0);t.define("USE_SDF",u>0||n.enableBold);t.define("USE_SDF_EXTEND",n.enableBold?1:0);void 0!==t.getDefine("CC_SUPPORT_standard_derivatives")&&cc.sys.glExtension("OES_standard_derivatives")&&t.define("CC_SUPPORT_standard_derivatives",!0);e.setEffect(t.effect._nativeObj)},n.fillBuffers=function(){this._layout.render()},n.getVfmt=function(){},t}();i.default=f;t.exports=i.default},{"../../../../../assets/material/CCMaterial":80,"../../../../../assets/material/material-variant":87,"../../../../../components/CCLabel":107,"../../../../../components/CCLabelOutline":108,"../../../../../components/CCLabelShadow":109}],242:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var r,e=(r=n("../../../../utils/label/ttf"))&&r.__esModule?r:{"default":r},u=n("../../../../../components/CCLabelShadow"),f=cc.color(255,255,255,255),o=function(n){function e(){return n.apply(this,arguments)||this}var t,r,i;return r=n,(t=e).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,i=e.prototype,i.updateUVs=function(n){for(var i,r,u=this._renderData.vDatas[0],f=n._frame.uv,e=this.uvOffset,o=this.floatsPerVert,t=0;t<4;t++)i=2*t,r=o*t+e,u[r]=f[i],u[r+1]=f[i+1]},i.updateColor=function(t){f._fastSetA(t.node._color.a);var i=f._val;n.prototype.updateColor.call(this,t,i)},i.updateVerts=function(n){var t=n.node,o=n._ttfTexture.width,s=n._ttfTexture.height,f=t.anchorX*t.width,e=t.anchorY*t.height,h=u&&n.getComponent(u),r;if(h&&h._enabled){var c=(o-t.width)/2,l=(s-t.height)/2,i=h.offset;-i.x>c?f+=o-t.width:c>i.x&&(f+=c-i.x);-i.y>l?e+=s-t.height:l>i.y&&(e+=l-i.y)}r=this._local;r[0]=-f;r[1]=-e;r[2]=o-f;r[3]=s-e;this.updateUVs(n);this.updateWorldVerts(n)},e}(e.default);i.default=o;t.exports=i.default},{"../../../../../components/CCLabelShadow":109,"../../../../utils/label/ttf":233}],243:[function(n){"use strict";function t(n){return n&&n.__esModule?n:{"default":n}}var h=t(n("../../../assembler")),i=t(n("../../../../components/CCLabel")),r=t(n("./2d/ttf")),u=t(n("./2d/bmfont")),f=t(n("./2d/letter")),e=t(n("./3d/ttf")),o=t(n("./3d/bmfont")),s=t(n("./3d/letter"));i.default._canvasPool={pool:[],get:function(){var n=this.pool.pop(),t,i;return n||(t=document.createElement("canvas"),i=t.getContext("2d"),n={canvas:t,context:i},i.textBaseline="alphabetic"),n},put:function(n){this.pool.length>=32||this.pool.push(n)}};h.default.register(cc.Label,{getConstructor:function(n){var t=n.node.is3DNode,h=t?e.default:r.default;return n.font instanceof cc.BitmapFont?h=t?o.default:u.default:n.cacheMode===i.default.CacheMode.CHAR&&(cc.sys.platform===cc.sys.WECHAT_GAME_SUB?cc.warn("sorry, subdomain does not support CHAR mode currently!"):h=t?s.default:f.default),h},TTF:r.default,Bmfont:u.default,Letter:f.default,TTF3D:e.default,Bmfont3D:o.default,Letter3D:s.default,NativeTTF:void 0})},{"../../../../components/CCLabel":107,"../../../assembler":223,"./2d/bmfont":239,"./2d/letter":240,"./2d/nativeTTF":241,"./2d/ttf":242,"./3d/bmfont":void 0,"./3d/letter":void 0,"./3d/ttf":void 0}],244:[function(n,t,i){"use strict";function s(){return 1<<u.length-1}function b(){for(var t=0,n=0;n<u.length;++n)t+=1<<n;return t}function h(n,t,i,u,f,e){var o=n.effect,s=r.STENCIL_OP_KEEP,h=r.STENCIL_OP_KEEP;o.setStencil(r.STENCIL_ENABLE,t,u,f,i,s,h,e)}function k(n){u.length+1>v&&cc.errorID(9e3,v);u.push(n)}function d(n,t){0===u.length&&cc.errorID(9001);u.pop();0===u.length?t._flushMaterial(n._exitMaterial):y(t)}function g(n,t){var v=r.DS_FUNC_NEVER,c=s(),y=c,p=c,b=n.inverted?r.STENCIL_OP_REPLACE:r.STENCIL_OP_ZERO;h(n._clearMaterial,v,b,c,y,p);var l=t.getBuffer("mesh",w),a=l.request(4,6),f=a.indiceOffset,i=a.byteOffset>>2,e=a.vertexOffset,u=l._vData,o=l._iData;u[i++]=-1;u[i++]=-1;u[i++]=-1;u[i++]=1;u[i++]=1;u[i++]=1;u[i++]=1;u[i++]=-1;o[f++]=e;o[f++]=e+3;o[f++]=e+1;o[f++]=e+1;o[f++]=e+3;o[f++]=e+2;t.node=t._dummyNode;t.material=n._clearMaterial;t._flush()}function nt(n,t){var u=r.DS_FUNC_NEVER,i=s(),e=i,c=i,l=n.inverted?r.STENCIL_OP_ZERO:r.STENCIL_OP_REPLACE;h(n._materials[0],u,l,i,e,c);t.material=n._materials[0];n._type===f.Type.IMAGE_STENCIL?(t.node=t._dummyNode,o.prototype.fillBuffers.call(n._assembler,n,t),t._flush()):(t.node=n.node,a.prototype.fillBuffers.call(n._graphics._assembler,n._graphics,t))}function y(n){var f=r.DS_FUNC_EQUAL,e=r.STENCIL_OP_KEEP,t=b(),o=t,c=s(),i=u[u.length-1];h(i._enableMaterial,f,e,t,o,c);n._flushMaterial(i._enableMaterial)}var c;i.__esModule=!0;i.MaskAssembler=void 0;var e,p=(e=n("../../assembler"))&&e.__esModule?e:{"default":e},f=n("../../../components/CCMask"),l=n("../../render-flow"),o=n("./sprite/2d/simple"),a=n("./graphics"),r=n("../../../../renderer/gfx"),w=n("../vertex-format").vfmtPos,v=8,u=[];c=function(n){function u(){return n.apply(this,arguments)||this}var t,r,i;return r=n,(t=u).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,i=u.prototype,i.updateRenderData=function(n){n._type===f.Type.IMAGE_STENCIL?n.spriteFrame?o.prototype.updateRenderData.call(this,n):n.setMaterial(0,null):(n._graphics.setMaterial(0,n._materials[0]),a.prototype.updateRenderData.call(n._graphics._assembler,n._graphics,n._graphics))},i.fillBuffers=function(n,t){(n._type!==f.Type.IMAGE_STENCIL||n.spriteFrame)&&(k(n),g(n,t),nt(n,t),y(t));n.node._renderFlag|=l.FLAG_UPDATE_RENDER_DATA},i.postFillBuffers=function(n,t){(n._type!==f.Type.IMAGE_STENCIL||n.spriteFrame)&&d(n,t);n.node._renderFlag|=l.FLAG_UPDATE_RENDER_DATA},u}(o);i.MaskAssembler=c;p.default.register(f,c)},{"../../../../renderer/gfx":317,"../../../components/CCMask":111,"../../assembler":223,"../../render-flow":227,"../vertex-format":258,"./graphics":237,"./sprite/2d/simple":248}],245:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var r,f=(r=n("../../../../assembler-2d"))&&r.__esModule?r:{"default":r},u=n("../../../../../components/CCSprite").FillType,e=function(n){function f(){return n.apply(this,arguments)||this}var t,r,i;return r=n,(t=f).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,i=f.prototype,i.updateRenderData=function(n){var u=n._spriteFrame,i,t,r;(this.packToDynamicAtlas(n,u),n._vertsDirty)&&(i=n._fillStart,t=n._fillRange,t<0&&(i+=t,t=-t),t=(t=(t=i+t)>1?1:t)<0?0:t,r=(i=(i=i>1?1:i)<0?0:i)+(t=(t-=i)<0?0:t),r=r>1?1:r,this.updateUVs(n,i,r),this.updateVerts(n,i,r),n._vertsDirty=!1)},i.updateUVs=function(n,t,i){var w,b,s,h,c,l,a,v,y,p,k=n._spriteFrame,d=k._texture.width,g=k._texture.height,e=k._rect;k._rotated?(w=e.x/d,b=(e.y+e.width)/g,s=c=w,a=y=(e.x+e.height)/d,l=p=b,h=v=e.y/g):(w=e.x/d,b=(e.y+e.height)/g,s=a=w,c=y=(e.x+e.width)/d,h=l=b,v=p=e.y/g);var r=this._renderData.vDatas[0],f=this.uvOffset,o=this.floatsPerVert;switch(n._fillType){case u.HORIZONTAL:r[f]=s+(c-s)*t;r[f+1]=h+(l-h)*t;r[f+o]=s+(c-s)*i;r[f+o+1]=h+(l-h)*i;r[f+2*o]=a+(y-a)*t;r[f+2*o+1]=v+(p-v)*t;r[f+3*o]=a+(y-a)*i;r[f+3*o+1]=v+(p-v)*i;break;case u.VERTICAL:r[f]=s+(a-s)*t;r[f+1]=h+(v-h)*t;r[f+o]=c+(y-c)*t;r[f+o+1]=l+(p-l)*t;r[f+2*o]=s+(a-s)*i;r[f+2*o+1]=h+(v-h)*i;r[f+3*o]=c+(y-c)*i;r[f+3*o+1]=l+(p-l)*i;break;default:cc.errorID(2626)}},i.updateVerts=function(n,t,i){var o,s=n.node,l=s.width,a=s.height,v=s.anchorX*l,y=s.anchorY*a,r=-v,f=-y,h=l-v,c=a-y,e;switch(n._fillType){case u.HORIZONTAL:o=r+(h-r)*i;r+=(h-r)*t;h=o;break;case u.VERTICAL:o=f+(c-f)*i;f+=(c-f)*t;c=o;break;default:cc.errorID(2626)}e=this._local;e[0]=r;e[1]=f;e[2]=h;e[3]=c;this.updateWorldVerts(n)},f}(f.default);i.default=e;t.exports=i.default},{"../../../../../components/CCSprite":121,"../../../../assembler-2d":221}],246:[function(n,t,i){"use strict";var r,u;i.__esModule=!0;i.default=void 0;u=function(n){function u(){return n.apply(this,arguments)||this}var i,r,t;return r=n,(i=u).prototype=Object.create(r.prototype),i.prototype.constructor=i,i.__proto__=r,t=u.prototype,t.initData=function(){this._renderData.createFlexData(0,4,6,this.getVfmt())},t.updateRenderData=function(n){var i,t,r;this.packToDynamicAtlas(n,n._spriteFrame);i=n.spriteFrame;i&&(t=i.vertices,t&&(this.verticesCount=t.x.length,this.indicesCount=t.triangles.length,r=this._renderData._flexBuffer,r.reserve(this.verticesCount,this.indicesCount)&&(this.updateColor(n),n._vertsDirty=!0),r.used(this.verticesCount,this.indicesCount),this.updateIndices(t.triangles),n._vertsDirty&&(this.updateUVs(n),this.updateVerts(n),this.updateWorldVerts(n),n._vertsDirty=!1)))},t.updateIndices=function(n){this._renderData.iDatas[0].set(n)},t.updateUVs=function(n){for(var i,r=n.spriteFrame.vertices,u=r.nu,e=r.nv,o=this.uvOffset,s=this.floatsPerVert,f=this._renderData.vDatas[0],t=0;t<u.length;t++)i=s*t+o,f[i]=u[t],f[i+1]=e[t]},t.updateVerts=function(n){var o=n.node,c=Math.abs(o.width),l=Math.abs(o.height),a=o.anchorX*c,v=o.anchorY*l,t=n.spriteFrame,w=t.vertices,s=w.x,b=w.y,k=t._originalSize.width,h=t._originalSize.height,d=t._rect.width,g=t._rect.height,et=t._offset.x+(k-d)/2,ot=t._offset.y+(h-g)/2,nt=c/(n.trim?d:k),tt=l/(n.trim?g:h),i=this._local,r,it,y,u,rt,p,f,ut,e,ft;if(n.trim)for(r=0,it=s.length;r<it;r++)y=2*r,i[y]=(s[r]-et)*nt-a,i[y+1]=(h-b[r]-ot)*tt-v;else for(u=0,rt=s.length;u<rt;u++)p=2*u,i[p]=s[u]*nt-a,i[p+1]=(h-b[u])*tt-v;if(t._flipX)for(f=0,ut=this.verticesCount;f<ut;f++)i[2*f]=c-i[2*f]-2*a;if(t._flipY)for(e=0,ft=this.verticesCount;e<ft;e++)i[2*e+1]=l-i[2*e+1]-2*v},t.updateWorldVerts=function(n){for(var r,u,t=n.node._worldMatrix.m,s=t[0],h=t[1],c=t[4],l=t[5],a=t[12],v=t[13],f=this._local,e=this._renderData.vDatas[0],o=this.floatsPerVert,i=0,y=this.verticesCount;i<y;i++)r=f[2*i],u=f[2*i+1],e[o*i]=r*s+u*c+a,e[o*i+1]=r*h+u*l+v},u}(((r=n("../../../../assembler-2d"))&&r.__esModule?r:{"default":r}).default);i.default=u;t.exports=i.default},{"../../../../assembler-2d":221}],247:[function(n,t,i){"use strict";function a(n,t,i,r,u,f,e){var h,c,o=Math.sin(f),s=Math.cos(f),l,a,v,y;0!==Math.cos(f)&&((h=o/s,(n-u.x)*s>0)&&(l=u.y+h*(n-u.x),e[0].x=n,e[0].y=l),(t-u.x)*s>0&&(a=u.y+h*(t-u.x),e[2].x=t,e[2].y=a));0!==Math.sin(f)&&((c=s/o,(r-u.y)*o>0)&&(v=u.x+c*(r-u.y),e[3].x=v,e[3].y=r),(i-u.y)*o>0&&(y=u.x+c*(i-u.y),e[1].x=y,e[1].y=i))}function w(n){var i=n.node,l=i.width,a=i.height,v=i.anchorX*l,y=i.anchorY*a,u=-v,o=-y,h=l-v,c=a-y,t=e;t[0]=u;t[1]=o;t[2]=h;t[3]=c;var p=n._fillCenter,w=f.x=Math.min(Math.max(0,p.x),1)*(h-u)+u,b=f.y=Math.min(Math.max(0,p.y),1)*(c-o)+o;r[0].x=r[3].x=u;r[1].x=r[2].x=h;r[0].y=r[1].y=o;r[2].y=r[3].y=c;s.length=0;w!==t[0]&&(s[0]=[3,0]);w!==t[2]&&(s[2]=[1,2]);b!==t[1]&&(s[1]=[0,1]);b!==t[3]&&(s[3]=[2,3])}function v(n,t){var i,r,u;if(i=t.x-n.x,r=t.y-n.y,0!==i||0!==r)return 0===i?r>0?.5*Math.PI:1.5*Math.PI:(u=Math.atan(r/i),i<0&&(u+=Math.PI),u)}var y;i.__esModule=!0;i.default=void 0;var h,p=(h=n("../../../../assembler-2d"))&&h.__esModule?h:{"default":h},o=2*Math.PI,r=[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],e=[0,0,0,0],u=[0,0,0,0,0,0,0,0],c=[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],l=[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],f=cc.v2(0,0),s=[];y=function(n){function y(){return n.apply(this,arguments)||this}var i,h,t;return h=n,(i=y).prototype=Object.create(h.prototype),i.prototype.constructor=i,i.__proto__=h,t=y.prototype,t.initData=function(){this._renderData.createFlexData(0,4,6,this.getVfmt());this.updateIndices()},t.updateRenderData=function(t){var p,b,k,d,g,v,y,r,i,nt,s,h;if(n.prototype.updateRenderData.call(this,t),nt=t.spriteFrame,this.packToDynamicAtlas(t,nt),t._vertsDirty){for(s=t._fillStart,h=t._fillRange,h<0&&(s+=h,h=-h);s>=1;)s-=1;for(;s<0;)s+=1;s*=o;h*=o;w(t);v=(p=nt)._texture.width;y=p._texture.height;r=p._rect;i=u;p._rotated?(b=r.x/v,k=(r.x+r.height)/v,d=r.y/y,g=(r.y+r.width)/y,i[0]=i[2]=b,i[4]=i[6]=k,i[3]=i[7]=g,i[1]=i[5]=d):(b=r.x/v,k=(r.x+r.width)/v,d=r.y/y,g=(r.y+r.height)/y,i[0]=i[4]=b,i[2]=i[6]=k,i[1]=i[3]=g,i[5]=i[7]=d);a(e[0],e[2],e[1],e[3],f,s,c);a(e[0],e[2],e[1],e[3],f,s+h,l);this.updateVerts(t,s,h);t._vertsDirty=!1}},t.updateVerts=function(n,t,i){var b=t+i,e=this._local,h,w,y,k;e.length=0;for(var u=0,a=3*this.floatsPerVert,p=0;p<4;++p)if(h=s[p],h)if(i>=o)e.length=u+a,this._generateTriangle(e,u,f,r[h[0]],r[h[1]]),u+=a;else for(w=v(f,r[h[0]]),y=v(f,r[h[1]]),y<w&&(y+=o),w-=o,y-=o,k=0;k<3;++k)w>=b||(w>=t?(e.length=u+a,y>=b?this._generateTriangle(e,u,f,r[h[0]],l[p]):this._generateTriangle(e,u,f,r[h[0]],r[h[1]]),u+=a):y<=t||(y<=b?(e.length=u+a,this._generateTriangle(e,u,f,c[p],r[h[1]]),u+=a):(e.length=u+a,this._generateTriangle(e,u,f,c[p],l[p]),u+=a))),w+=o,y+=o;this.allocWorldVerts(n);this.updateWorldVerts(n)},t.allocWorldVerts=function(n){var h=n.node._color._val,r=this._renderData,o=this.floatsPerVert,i=this._local,u=i.length/o,f,t;this.verticesCount=this.indicesCount=u;f=r._flexBuffer;f.reserve(u,u)&&this.updateIndices();f.used(this.verticesCount,this.indicesCount);for(var s=r.vDatas[0],c=r.uintVDatas[0],l=this.uvOffset,e=0;e<i.length;e+=o)t=e+l,s[t]=i[t],s[t+1]=i[t+1],c[t+2]=h},t.updateIndices=function(){for(var t=this._renderData.iDatas[0],n=0;n<t.length;n++)t[n]=n},t.updateWorldVerts=function(n){for(var u,f,t=n.node._worldMatrix.m,o=t[0],s=t[1],h=t[4],c=t[5],l=t[12],a=t[13],r=this._local,e=this._renderData.vDatas[0],v=this.floatsPerVert,i=0;i<r.length;i+=v)u=r[i],f=r[i+1],e[i]=u*o+f*h+l,e[i+1]=u*s+f*c+a},t._generateTriangle=function(n,t,i,r,u){var l=e,f=l[0],o=l[1],v=l[2],y=l[3],s=this.floatsPerVert,h,c,a;n[t]=i.x;n[t+1]=i.y;n[t+s]=r.x;n[t+s+1]=r.y;n[t+2*s]=u.x;n[t+2*s+1]=u.y;a=this.uvOffset;h=(i.x-f)/(v-f);c=(i.y-o)/(y-o);this._generateUV(h,c,n,t+a);h=(r.x-f)/(v-f);c=(r.y-o)/(y-o);this._generateUV(h,c,n,t+s+a);h=(u.x-f)/(v-f);c=(u.y-o)/(y-o);this._generateUV(h,c,n,t+2*s+a)},t._generateUV=function(n,t,i,r){var f=u[0]+(u[2]-u[0])*n,o=u[4]+(u[6]-u[4])*n,e=u[1]+(u[3]-u[1])*n,s=u[5]+(u[7]-u[5])*n;i[r]=f+(o-f)*t;i[r+1]=e+(s-e)*t},y}(p.default);i.default=y;t.exports=i.default},{"../../../../assembler-2d":221}],248:[function(n,t,i){"use strict";var r,u;i.__esModule=!0;i.default=void 0;u=function(n){function u(){return n.apply(this,arguments)||this}var t,r,i;return r=n,(t=u).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,i=u.prototype,i.updateRenderData=function(n){this.packToDynamicAtlas(n,n._spriteFrame);n._vertsDirty&&(this.updateUVs(n),this.updateVerts(n),n._vertsDirty=!1)},i.updateUVs=function(n){for(var i,r,u=n._spriteFrame.uv,e=this.uvOffset,o=this.floatsPerVert,f=this._renderData.vDatas[0],t=0;t<4;t++)i=2*t,r=o*t+e,f[r]=u[i],f[r+1]=u[i+1]},i.updateVerts=function(n){var h,c,l,a,r=n.node,u=r.width,f=r.height,e=r.anchorX*u,o=r.anchorY*f,i;if(n.trim)h=-e,c=-o,l=u-e,a=f-o;else{var t=n.spriteFrame,v=t._originalSize.width,y=t._originalSize.height,p=t._rect.width,w=t._rect.height,s=t._offset,b=u/v,k=f/y,d=s.x+(v-p)/2,g=s.x-(v-p)/2;h=d*b-e;c=(s.y+(y-w)/2)*k-o;l=u+g*b-e;a=f+(s.y-(y-w)/2)*k-o}i=this._local;i[0]=h;i[1]=c;i[2]=l;i[3]=a;this.updateWorldVerts(n)},u}(((r=n("../../../../assembler-2d"))&&r.__esModule?r:{"default":r}).default);i.default=u;t.exports=i.default},{"../../../../assembler-2d":221}],249:[function(n,t,i){"use strict";var r,u;i.__esModule=!0;i.default=void 0;u=function(n){function u(){return n.apply(this,arguments)||this}var i,r,t;return r=n,(i=u).prototype=Object.create(r.prototype),i.prototype.constructor=i,i.__proto__=r,t=u.prototype,t.initData=function(){var r,n;if(!(this._renderData.meshCount>0)){this._renderData.createData(0,this.verticesFloats,this.indicesCount);for(var t=this._renderData.iDatas[0],i=0,u=0;u<3;++u)for(r=0;r<3;++r)n=4*u+r,t[i++]=n,t[i++]=n+1,t[i++]=n+4,t[i++]=n+1,t[i++]=n+5,t[i++]=n+4}},t.initLocal=function(){this._local=[];this._local.length=8},t.updateRenderData=function(n){var t=n._spriteFrame;this.packToDynamicAtlas(n,t);n._vertsDirty&&(this.updateUVs(n),this.updateVerts(n),n._vertsDirty=!1)},t.updateVerts=function(n){var u=n.node,f=u.width,e=u.height,c=u.anchorX*f,l=u.anchorY*e,o=n.spriteFrame,a=o.insetLeft,y=o.insetRight,p=o.insetTop,v=o.insetBottom,s=f-a-y,h=e-p-v,i=f/(a+y),r=e/(p+v),t;i=isNaN(i)||i>1?1:i;r=isNaN(r)||r>1?1:r;s=s<0?0:s;h=h<0?0:h;t=this._local;t[0]=-c;t[1]=-l;t[2]=a*i-c;t[3]=v*r-l;t[4]=t[2]+s;t[5]=t[3]+h;t[6]=f-c;t[7]=e-l;this.updateWorldVerts(n)},t.updateUVs=function(n){for(var t,r=this._renderData.vDatas[0],s=n.spriteFrame.uvSliced,u=this.uvOffset,h=this.floatsPerVert,i=0;i<4;++i)for(t=0;t<4;++t){var f=4*i+t,e=s[f],o=f*h;r[o+u]=e.u;r[o+u+1]=e.v}},t.updateWorldVerts=function(n){for(var u,i,f,e,t=n.node._worldMatrix.m,h=t[0],c=t[1],l=t[4],a=t[5],v=t[12],y=t[13],o=this._local,s=this._renderData.vDatas[0],p=this.floatsPerVert,r=0;r<4;++r)for(u=o[2*r+1],i=0;i<4;++i)f=o[2*i],e=(4*r+i)*p,s[e]=f*h+u*l+v,s[e+1]=f*c+u*a+y},u}(((r=n("../../../../assembler-2d"))&&r.__esModule?r:{"default":r}).default);i.default=u;Object.assign(u.prototype,{verticesCount:16,indicesCount:54});t.exports=i.default},{"../../../../assembler-2d":221}],250:[function(n,t,i){"use strict";var r,u;i.__esModule=!0;i.default=void 0;u=function(n){function u(){return n.apply(this,arguments)||this}var i,r,t;return r=n,(i=u).prototype=Object.create(r.prototype),i.prototype.constructor=i,i.__proto__=r,t=u.prototype,t.initData=function(){this.verticesCount=0;this.contentWidth=0;this.contentHeight=0;this.rectWidth=0;this.rectHeight=0;this.hRepeat=0;this.vRepeat=0;this.row=0;this.col=0;this._renderData.createFlexData(0,4,6,this.getVfmt());this._updateIndices()},t.initLocal=function(){this._local={x:[],y:[]}},t._updateIndices=function(){for(var t=this._renderData.iDatas[0],n=0,i=0,r=t.length;n<r;n+=6,i+=4)t[n]=i,t[n+1]=i+1,t[n+2]=i+2,t[n+3]=i+1,t[n+4]=i+3,t[n+5]=i+2},t.updateRenderData=function(n){var t=n._spriteFrame,i;this.packToDynamicAtlas(n,t);var r=n.node,a=this.contentWidth=Math.abs(r.width),v=this.contentHeight=Math.abs(r.height),u=t._rect,f=t.insetLeft,e=t.insetRight,o=u.width-f-e,s=t.insetTop,h=t.insetBottom,c=u.height-s-h;this.sizableWidth=a-f-e;this.sizableHeight=v-s-h;this.sizableWidth=this.sizableWidth>0?this.sizableWidth:0;this.sizableHeight=this.sizableHeight>0?this.sizableHeight:0;var y=this.hRepeat=0===o?this.sizableWidth:this.sizableWidth/o,p=this.vRepeat=0===c?this.sizableHeight:this.sizableHeight/c,l=(this.row=Math.ceil(p+2))*(this.col=Math.ceil(y+2));this.verticesCount=4*l;this.indicesCount=6*l;i=this._renderData._flexBuffer;i.reserve(this.verticesCount,this.indicesCount)&&(this._updateIndices(),this.updateColor(n));i.used(this.verticesCount,this.indicesCount);n._vertsDirty&&(this.updateUVs(n),this.updateVerts(n),n._vertsDirty=!1)},t.updateVerts=function(n){var c=n._spriteFrame,b=c._rect,f=n.node,s=f.anchorX*f.width,h=f.anchorY*f.height,l=this.row,a=this.col,nt=this.contentWidth,tt=this.contentHeight,k=this._local,v=k.x,y=k.y,t,i;v.length=y.length=0;var d,g,e=c.insetLeft,p=c.insetRight,r=b.width-e-p,w=c.insetTop,o=c.insetBottom,u=b.height-w-o,it=f.width/(e+p)>1?1:f.width/(e+p),rt=f.height/(w+o)>1?1:f.height/(w+o);for(d=r>0?Math.floor(1e3*this.sizableWidth)/1e3%r==0?r:this.sizableWidth%r:this.sizableWidth,g=u>0?Math.floor(1e3*this.sizableHeight)/1e3%u==0?u:this.sizableHeight%u:this.sizableHeight,t=0;t<=a;t++)0===t?v[t]=-s:t>0&&t<a?v[t]=1===t?e*it+Math.min(r,this.sizableWidth)-s:r>0?t===a-1?e+d+r*(t-2)-s:e+Math.min(r,this.sizableWidth)+r*(t-2)-s:e+this.sizableWidth-s:t===a&&(v[t]=Math.min(e+this.sizableWidth+p,nt)-s);for(i=0;i<=l;i++)0===i?y[i]=-h:i>0&&i<l?y[i]=1===i?o*rt+Math.min(u,this.sizableHeight)-h:u>0?i===l-1?o+g+(i-2)*u-h:o+Math.min(u,this.sizableHeight)+(i-2)*u-h:o+this.sizableHeight-h:i===l&&(y[i]=Math.min(o+this.sizableHeight+w,tt)-h);this.updateWorldVerts(n)},t.updateWorldVerts=function(n){for(var s,g,u,f,e,o,nt=this._renderData,b=this._local,k=b.x,d=b.y,i=nt.vDatas[0],tt=this.row,it=this.col,r=n.node._worldMatrix.m,h=r[0],c=r[1],l=r[4],a=r[5],v=r[12],y=r[13],p=this.floatsPerVert,t=0,w=0,rt=tt;w<rt;++w)for(e=d[w],o=d[w+1],s=0,g=it;s<g;++s)u=k[s],f=k[s+1],i[t]=u*h+e*l+v,i[t+1]=u*c+e*a+y,i[t+=p]=f*h+e*l+v,i[t+1]=f*c+e*a+y,i[t+=p]=u*h+o*l+v,i[t+1]=u*c+o*a+y,i[t+=p]=f*h+o*l+v,i[t+1]=f*c+o*a+y,t+=p},t.updateUVs=function(n){var f=this._renderData.vDatas[0],u,d;if(f)for(var s=n._spriteFrame,y=s._rect,g=s.insetLeft,nt=s.insetRight,p=y.width-g-nt,tt=s.insetTop,it=s.insetBottom,w=y.height-tt-it,h=this.row,c=this.col,b=this.hRepeat,k=this.vRepeat,l=0,a=0,rt=n.spriteFrame.uv,t=n.spriteFrame.uvSliced,ut=n.spriteFrame._rotated,v=this.floatsPerVert,e=this.uvOffset,i=[],r=[],o=0,ft=h;o<ft;++o)for(a=this.sizableHeight>w?this.sizableHeight>=o*w?1:k%1:k,u=0,d=c;u<d;++u)l=this.sizableWidth>p?this.sizableWidth>=u*p?1:b%1:b,ut?(0===o?(i[0]=t[0].u,i[1]=t[0].u,i[2]=t[4].u+(t[8].u-t[4].u)*a):o<h-1?(i[0]=t[4].u,i[1]=t[4].u,i[2]=t[4].u+(t[8].u-t[4].u)*a):o===h-1&&(i[0]=t[8].u,i[1]=t[8].u,i[2]=t[12].u),0===u?(r[0]=t[0].v,r[1]=t[1].v+(t[2].v-t[1].v)*l,r[2]=t[0].v):u<c-1?(r[0]=t[1].v,r[1]=t[1].v+(t[2].v-t[1].v)*l,r[2]=t[1].v):u===c-1&&(r[0]=t[2].v,r[1]=t[3].v,r[2]=t[2].v),i[3]=i[2],r[3]=r[1]):(0===u?(i[0]=t[0].u,i[1]=t[1].u+(t[2].u-t[1].u)*l,i[2]=rt[0]):u<c-1?(i[0]=t[1].u,i[1]=t[1].u+(t[2].u-t[1].u)*l,i[2]=t[1].u):u===c-1&&(i[0]=t[2].u,i[1]=t[3].u,i[2]=t[2].u),0===o?(r[0]=t[0].v,r[1]=t[0].v,r[2]=t[4].v+(t[8].v-t[4].v)*a):o<h-1?(r[0]=t[4].v,r[1]=t[4].v,r[2]=t[4].v+(t[8].v-t[4].v)*a):o===h-1&&(r[0]=t[8].v,r[1]=t[8].v,r[2]=t[12].v),i[3]=i[1],r[3]=r[2]),f[e]=i[0],f[e+1]=r[0],f[e+=v]=i[1],f[e+1]=r[1],f[e+=v]=i[2],f[e+1]=r[2],f[e+=v]=i[3],f[e+1]=r[3],e+=v},u}(((r=n("../../../../assembler-2d"))&&r.__esModule?r:{"default":r}).default);i.default=u;t.exports=i.default},{"../../../../assembler-2d":221}],251:[function(n){"use strict";function t(n){return n&&n.__esModule?n:{"default":n}}var p=t(n("../../../assembler")),i=n("../../../../components/CCSprite"),r=t(n("./2d/simple")),u=t(n("./2d/sliced")),f=t(n("./2d/tiled")),e=t(n("./2d/radial-filled")),o=t(n("./2d/bar-filled")),s=t(n("./2d/mesh")),h=t(n("./3d/simple")),c=t(n("./3d/sliced")),l=t(n("./3d/tiled")),a=t(n("./3d/radial-filled")),v=t(n("./3d/bar-filled")),y=t(n("./3d/mesh")),w={getConstructor:function(n){var t=n.node.is3DNode,p=t?h.default:r.default;switch(n.type){case i.Type.SLICED:p=t?c.default:u.default;break;case i.Type.TILED:p=t?l.default:f.default;break;case i.Type.FILLED:p=n._fillType===i.FillType.RADIAL?t?a.default:e.default:t?v.default:o.default;break;case i.Type.MESH:p=t?y.default:s.default}return p},Simple:r.default,Sliced:u.default,Tiled:f.default,RadialFilled:e.default,BarFilled:o.default,Mesh:s.default,Simple3D:h.default,Sliced3D:c.default,Tiled3D:l.default,RadialFilled3D:a.default,BarFilled3D:v.default,Mesh3D:y.default};p.default.register(cc.Sprite,w)},{"../../../../components/CCSprite":121,"../../../assembler":223,"./2d/bar-filled":245,"./2d/mesh":246,"./2d/radial-filled":247,"./2d/simple":248,"./2d/sliced":249,"./2d/tiled":250,"./3d/bar-filled":void 0,"./3d/mesh":void 0,"./3d/radial-filled":void 0,"./3d/simple":void 0,"./3d/sliced":void 0,"./3d/tiled":void 0}],252:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var r=function(){function t(n,t,i,r,u){this._handler=n;this._index=t;this._vfmt=u;this._verticesBytes=u._bytes;this._initVerticesCount=i;this._initIndicesCount=r;this.reset()}var n=t.prototype;return n._reallocVData=function(n,t){this.vData=new Float32Array(n);this.uintVData=new Uint32Array(this.vData.buffer);t&&this.vData.set(t);this._handler.updateMesh(this._index,this.vData,this.iData)},n._reallocIData=function(n,t){this.iData=new Uint16Array(n);t&&this.iData.set(t);this._handler.updateMesh(this._index,this.vData,this.iData)},n.reserve=function(n,t){var f=n*this._verticesBytes>>2,i=this.vData.length,u=!1,r;if(f>i){for(;i<f;)i*=2;this._reallocVData(i,this.vData);u=!0}if(r=this.iData.length,t>r){for(;r<t;)r*=2;this._reallocIData(t,this.iData);u=!0}return u},n.used=function(n,t){this.usedVertices=n;this.usedIndices=t;this.usedVerticesFloats=n*this._verticesBytes>>2;this._handler.updateMeshRange(n,t)},n.reset=function(){var n=this._initVerticesCount*this._verticesBytes>>2;this._reallocVData(n);this._reallocIData(this._initIndicesCount);this.usedVertices=0;this.usedVerticesFloats=0;this.usedIndices=0},t}();i.default=r;cc.FlexBuffer=r;t.exports=i.default},{}],253:[function(n,t){"use strict";var r,i=(r=n("../../../renderer/gfx"))&&r.__esModule?r:{"default":r},f=(cc.sys.os===cc.sys.OS_IOS||cc.sys.os===cc.sys.MACOS)&&cc.sys.isBrowser&&/(OS 1[4-9])|(Version\/1[4-9])/.test(window.navigator.userAgent),u=cc.Class({name:"cc.MeshBuffer",ctor:function(n,t){this.init(n,t)},init:function(n,t){this.byteOffset=0;this.indiceOffset=0;this.vertexOffset=0;this.indiceStart=0;this._dirty=!1;this._vertexFormat=t;this._vertexBytes=this._vertexFormat._bytes;this._arrOffset=0;this._vbArr=[];this._vb=new i.default.VertexBuffer(n._device,t,i.default.USAGE_DYNAMIC,new ArrayBuffer,0);this._vbArr[0]=this._vb;this._ibArr=[];this._ib=new i.default.IndexBuffer(n._device,i.default.INDEX_FMT_UINT16,i.default.USAGE_STATIC,new ArrayBuffer,0);this._ibArr[0]=this._ib;this._vData=null;this._uintVData=null;this._iData=null;this._batcher=n;this._initVDataCount=256*t._bytes;this._initIDataCount=1536;this._offsetInfo={byteOffset:0,vertexOffset:0,indiceOffset:0};this._reallocBuffer()},uploadData:function(){if(0!==this.byteOffset&&this._dirty){var n=new Float32Array(this._vData.buffer,0,this.byteOffset>>2),t=new Uint16Array(this._iData.buffer,0,this.indiceOffset);this._vb.update(0,n);this._ib.update(0,t);this._dirty=!1}},switchBuffer:function(){var n=++this._arrOffset;this.byteOffset=0;this.vertexOffset=0;this.indiceOffset=0;this.indiceStart=0;n<this._vbArr.length?(this._vb=this._vbArr[n],this._ib=this._ibArr[n]):(this._vb=new i.default.VertexBuffer(this._batcher._device,this._vertexFormat,i.default.USAGE_DYNAMIC,new ArrayBuffer,0),this._vbArr[n]=this._vb,this._ib=new i.default.IndexBuffer(this._batcher._device,i.default.INDEX_FMT_UINT16,i.default.USAGE_STATIC,new ArrayBuffer,0),this._ibArr[n]=this._ib)},checkAndSwitchBuffer:function(n){this.vertexOffset+n>65535&&(this.uploadData(),this._batcher._flush(),this.switchBuffer())},requestStatic:function(n,t){this.checkAndSwitchBuffer(n);var i=this.byteOffset+n*this._vertexBytes,f=this.indiceOffset+t,r=this._vData.byteLength,u=this._iData.length;if(i>r||f>u){for(;r<i||u<f;)this._initVDataCount*=2,this._initIDataCount*=2,r=4*this._initVDataCount,u=this._initIDataCount;this._reallocBuffer()}this._updateOffset(n,t,i)},_updateOffset:function(n,t,i){var r=this._offsetInfo;r.vertexOffset=this.vertexOffset;this.vertexOffset+=n;r.indiceOffset=this.indiceOffset;this.indiceOffset+=t;r.byteOffset=this.byteOffset;this.byteOffset=i;this._dirty=!0},request:function(n,t){return this._batcher._buffer!==this&&(this._batcher._flush(),this._batcher._buffer=this),this.requestStatic(n,t),this._offsetInfo},_reallocBuffer:function(){this._reallocVData(!0);this._reallocIData(!0)},_reallocVData:function(n){var i,r,t,u;if(this._vData&&(i=new Uint8Array(this._vData.buffer)),this._vData=new Float32Array(this._initVDataCount),this._uintVData=new Uint32Array(this._vData.buffer),r=new Uint8Array(this._uintVData.buffer),i&&n)for(t=0,u=i.length;t<u;t++)r[t]=i[t]},_reallocIData:function(n){var i=this._iData;if(this._iData=new Uint16Array(this._initIDataCount),i&&n)for(var r=this._iData,t=0,u=i.length;t<u;t++)r[t]=i[t]},reset:function(){this._arrOffset=0;this._vb=this._vbArr[0];this._ib=this._ibArr[0];this.byteOffset=0;this.indiceOffset=0;this.vertexOffset=0;this.indiceStart=0;this._dirty=!1},destroy:function(){var n,t;for(this.reset(),n=0;n<this._vbArr.length;n++)this._vbArr[n].destroy();for(this._vbArr=null,t=0;t<this._ibArr.length;t++)this._ibArr[t].destroy();this._ibArr=null;this._ib=null;this._vb=null},forwardIndiceStartToOffset:function(){this.indiceStart=this.indiceOffset}});f&&(u.prototype.checkAndSwitchBuffer=function(n){this.vertexOffset+n>65535&&(this.uploadData(),this._batcher._flush())},u.prototype.forwardIndiceStartToOffset=function(){this.uploadData();this.switchBuffer()});cc.MeshBuffer=t.exports=u},{"../../../renderer/gfx":317}],254:[function(n,t){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}var f=u(n("../../../renderer/core/input-assembler")),e=u(n("../../../renderer/memop/recycle-pool")),a=u(n("../../../renderer/scene/model")),o=n("./vertex-format"),s=o.vfmtPosUvColor,h=o.vfmt3D,v=n("./quad-buffer"),y=n("./mesh-buffer"),p=n("./spine-buffer"),w=n("../../assets/material/CCMaterial"),i=(new(n("../../platform/id-generater"))("VertextFormat"),{}),c=new w,l=new f.default,r;l._count=0;r=function(n,t){this._renderScene=t;this._device=n;this.walking=!1;this.material=c;this.cullingMask=1;this._iaPool=new e.default(function(){return new f.default},16);this._modelPool=new e.default(function(){return new a.default},16);this._quadBuffer=this.getBuffer("quad",s);this._meshBuffer=this.getBuffer("mesh",s);this._quadBuffer3D=this.getBuffer("quad",h);this._meshBuffer3D=this.getBuffer("mesh",h);this._buffer=this._meshBuffer;this._batchedModels=[];this._dummyNode=new cc.Node;this._sortKey=0;this.node=this._dummyNode;this.parentOpacity=1;this.parentOpacityDirty=0;this.worldMatDirty=0};r.prototype={constructor:r,reset:function(){var r;this._iaPool.reset();for(var u=this._renderScene,n=this._batchedModels,t=0;t<n.length;++t)n[t].setInputAssembler(null),n[t].setEffect(null),u.removeModel(n[t]);for(r in this._modelPool.reset(),n.length=0,this._sortKey=0,i)i[r].reset();this._buffer=this._meshBuffer;this.node=this._dummyNode;this.material=c;this.cullingMask=1;this.parentOpacity=1;this.parentOpacityDirty=0;this.worldMatDirty=0},_flushMaterial:function(n){var i,t;n&&(this.material=n,i=n.effect,i&&(t=this._modelPool.add(),this._batchedModels.push(t),t.sortKey=this._sortKey++,t._cullingMask=this.cullingMask,t.setNode(this.node),t.setEffect(i,null),t.setInputAssembler(l),this._renderScene.addModel(t)))},_flush:function(){var u=this.material,t=this._buffer,f=t.indiceOffset-t.indiceStart,r,i,n;!this.walking||!u||f<=0||(r=u.effect,r&&(i=this._iaPool.add(),i._vertexBuffer=t._vb,i._indexBuffer=t._ib,i._start=t.indiceStart,i._count=f,n=this._modelPool.add(),this._batchedModels.push(n),n.sortKey=this._sortKey++,n._cullingMask=this.cullingMask,n.setNode(this.node),n.setEffect(r),n.setInputAssembler(i),this._renderScene.addModel(n),t.forwardIndiceStartToOffset()))},_flushIA:function(n){var i,t;n&&(i=this.material.effect,i&&(t=this._modelPool.add(),this._batchedModels.push(t),t.sortKey=this._sortKey++,t._cullingMask=this.cullingMask,t.setNode(this.node),t.setEffect(i),t.setInputAssembler(n),this._renderScene.addModel(t)))},terminate:function(){for(var n in cc.dynamicAtlasManager&&cc.dynamicAtlasManager.enabled&&cc.dynamicAtlasManager.update(),this._flush(),i)i[n].uploadData();this.walking=!1},getBuffer:function(n,t){var u=n+t.getHash(),r=i[u];if(!r){if("mesh"===n)r=new y(this,t);else if("quad"===n)r=new v(this,t);else{if("spine"!==n)return cc.error("Not support buffer type ["+n+"]"),null;r=new p(this,t)}i[u]=r}return r}};t.exports=r},{"../../../renderer/core/input-assembler":307,"../../../renderer/memop/recycle-pool":332,"../../../renderer/scene/model":338,"../../assets/material/CCMaterial":80,"../../platform/id-generater":212,"./mesh-buffer":253,"./quad-buffer":255,"./spine-buffer":257,"./vertex-format":258}],255:[function(n,t){"use strict";var i=n("./mesh-buffer"),r=cc.Class({name:"cc.QuadBuffer","extends":i,_fillQuadBuffer:function(){for(var n,f,u=this._initIDataCount/6,t=this._iData,r=0,i=0;r<u;r++)n=4*r,t[i++]=n,t[i++]=n+1,t[i++]=n+2,t[i++]=n+1,t[i++]=n+3,t[i++]=n+2;f=new Uint16Array(this._iData.buffer,0,6*u);this._ib.update(0,f)},uploadData:function(){if(0!==this.byteOffset&&this._dirty){var n=new Float32Array(this._vData.buffer,0,this.byteOffset>>2);this._vb.update(0,n);this._dirty=!1}},switchBuffer:function(){this._super();var n=new Uint16Array(this._iData.buffer,0,this._initIDataCount);this._ib.update(0,n)},_reallocBuffer:function(){this._reallocVData(!0);this._reallocIData();this._fillQuadBuffer()}});cc.QuadBuffer=t.exports=r},{"./mesh-buffer":253}],256:[function(n,t,i){"use strict";function u(){this.vDatas=[];this.uintVDatas=[];this.iDatas=[];this.meshCount=0;this._infos=null;this._flexBuffer=null}i.__esModule=!0;i.default=u;var r,f=(r=n("./flex-buffer"))&&r.__esModule?r:{"default":r},e=n("./vertex-format");cc.js.mixin(u.prototype,{init:function(){},clear:function(){this.vDatas.length=0;this.iDatas.length=0;this.uintVDatas.length=0;this.meshCount=0;this._infos=null;this._flexBuffer&&this._flexBuffer.reset()},updateMesh:function(n,t,i){this.vDatas[n]=t;this.uintVDatas[n]=new Uint32Array(t.buffer,0,t.length);this.iDatas[n]=i;this.meshCount=this.vDatas.length},updateMeshRange:function(){},createData:function(n,t,i){var r=new Float32Array(t),u=new Uint16Array(i);this.updateMesh(n,r,u)},createQuadData:function(n,t,i){this.createData(n,t,i);this.initQuadIndices(this.iDatas[n])},createFlexData:function(n,t,i,r){r=r||e.vfmtPosUvColor;this._flexBuffer=new f.default(this,n,t,i,r)},initQuadIndices:function(n){for(var t,u=n.length/6,r=0,i=0;r<u;r++)t=4*r,n[i++]=t,n[i++]=t+1,n[i++]=t+2,n[i++]=t+1,n[i++]=t+3,n[i++]=t+2}});cc.RenderData=u;t.exports=i.default},{"./flex-buffer":252,"./vertex-format":258}],257:[function(n,t){"use strict";var i=cc.Class({name:"cc.SpineBuffer","extends":n("./mesh-buffer"),requestStatic:function(n,t){var i;this.checkAndSwitchBuffer(n);var f=this.byteOffset+n*this._vertexBytes,e=this.indiceOffset+t,r=this._vData.byteLength,u=this._iData.length;if(f>r||e>u){for(;r<f||u<e;)this._initVDataCount*=2,this._initIDataCount*=2,r=4*this._initVDataCount,u=this._initIDataCount;this._reallocBuffer()}i=this._offsetInfo;i.vertexOffset=this.vertexOffset;i.indiceOffset=this.indiceOffset;i.byteOffset=this.byteOffset},adjust:function(n,t){this.vertexOffset+=n;this.indiceOffset+=t;this.byteOffset=this.byteOffset+n*this._vertexBytes;this._dirty=!0}});cc.SpineBuffer=t.exports=i},{"./mesh-buffer":253}],258:[function(n,t){"use strict";var r,i=(r=n("../../../renderer/gfx"))&&r.__esModule?r:{"default":r},h=new i.default.VertexFormat([{name:i.default.ATTR_POSITION,type:i.default.ATTR_TYPE_FLOAT32,num:3},{name:i.default.ATTR_UV0,type:i.default.ATTR_TYPE_FLOAT32,num:2},{name:i.default.ATTR_COLOR,type:i.default.ATTR_TYPE_UINT8,num:4,normalize:!0}]),u,f,e,o,s;h.name="vfmt3D";i.default.VertexFormat.XYZ_UV_Color=h;u=new i.default.VertexFormat([{name:i.default.ATTR_POSITION,type:i.default.ATTR_TYPE_FLOAT32,num:2},{name:i.default.ATTR_UV0,type:i.default.ATTR_TYPE_FLOAT32,num:2},{name:i.default.ATTR_COLOR,type:i.default.ATTR_TYPE_UINT8,num:4,normalize:!0}]);u.name="vfmtPosUvColor";i.default.VertexFormat.XY_UV_Color=u;f=new i.default.VertexFormat([{name:i.default.ATTR_POSITION,type:i.default.ATTR_TYPE_FLOAT32,num:2},{name:i.default.ATTR_UV0,type:i.default.ATTR_TYPE_FLOAT32,num:2},{name:i.default.ATTR_COLOR,type:i.default.ATTR_TYPE_UINT8,num:4,normalize:!0},{name:i.default.ATTR_COLOR0,type:i.default.ATTR_TYPE_UINT8,num:4,normalize:!0}]);f.name="vfmtPosUvTwoColor";i.default.VertexFormat.XY_UV_Two_Color=f;e=new i.default.VertexFormat([{name:i.default.ATTR_POSITION,type:i.default.ATTR_TYPE_FLOAT32,num:2},{name:i.default.ATTR_UV0,type:i.default.ATTR_TYPE_FLOAT32,num:2}]);e.name="vfmtPosUv";i.default.VertexFormat.XY_UV=e;o=new i.default.VertexFormat([{name:i.default.ATTR_POSITION,type:i.default.ATTR_TYPE_FLOAT32,num:2},{name:i.default.ATTR_COLOR,type:i.default.ATTR_TYPE_UINT8,num:4,normalize:!0}]);o.name="vfmtPosColor";i.default.VertexFormat.XY_Color=o;s=new i.default.VertexFormat([{name:i.default.ATTR_POSITION,type:i.default.ATTR_TYPE_FLOAT32,num:2}]);s.name="vfmtPos";i.default.VertexFormat.XY=s;t.exports={vfmt3D:h,vfmtPosUvColor:u,vfmtPosUvTwoColor:f,vfmtPosUv:e,vfmtPosColor:o,vfmtPos:s}},{"../../../renderer/gfx":317}],259:[function(n,t){"use strict";n("../platform/CCSys");var i=/(\.[^\.\/\?\\]*)(\?.*)?$/,r=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,u=/[^\.\/]+\/\.\.\//;cc.path={join:function(){for(var i=arguments.length,n="",t=0;t<i;t++)n=(n+(""===n?"":"/")+arguments[t]).replace(/(\/|\\\\)$/,"");return n},extname:function(n){var t=i.exec(n);return t?t[1]:""},mainFileName:function(n){if(n){var t=n.lastIndexOf(".");if(-1!==t)return n.substring(0,t)}return n},basename:function(n,t){var u=n.indexOf("?"),r,i;return(u>0&&(n=n.substring(0,u)),r=/(\/|\\)([^\/\\]+)$/g.exec(n.replace(/(\/|\\)$/,"")),!r)?n:(i=r[2],t&&n.substring(n.length-t.length).toLowerCase()===t.toLowerCase()?i.substring(0,i.length-t.length):i)},dirname:function(n){var t=r.exec(n);return t?t[2]:""},changeExtname:function(n,t){t=t||"";var i=n.indexOf("?"),r="";return i>0&&(r=n.substring(i),n=n.substring(0,i)),(i=n.lastIndexOf("."))<0?n+t+r:n.substring(0,i)+t+r},changeBasename:function(n,t,i){if(0===t.indexOf("."))return this.changeExtname(n,t);var r=n.indexOf("?"),u="",f=i?this.extname(n):"";return r>0&&(u=n.substring(r),n=n.substring(0,r)),r=(r=n.lastIndexOf("/"))<=0?0:r+1,n.substring(0,r)+t+f+u},_normalize:function(n){var t=n=String(n);do t=n,n=n.replace(u,"");while(t.length!==n.length);return n},sep:cc.sys.os===cc.sys.OS_WINDOWS?"\\":"/",stripSep:function(n){return n.replace(/[\/\\]$/,"")}};t.exports=cc.path},{"../platform/CCSys":204}],260:[function(n,t){"use strict";var i=function(n,t,i,r,u,f){this.a=n;this.b=t;this.c=i;this.d=r;this.tx=u;this.ty=f};i.create=function(n,t,i,r,u,f){return{a:n,b:t,c:i,d:r,tx:u,ty:f}};i.identity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}};i.clone=function(n){return{a:n.a,b:n.b,c:n.c,d:n.d,tx:n.tx,ty:n.ty}};i.concat=function(n,t,i){var r=t.a,u=t.b,f=t.c,e=t.d,o=t.tx,s=t.ty;return n.a=r*i.a+u*i.c,n.b=r*i.b+u*i.d,n.c=f*i.a+e*i.c,n.d=f*i.b+e*i.d,n.tx=o*i.a+s*i.c+i.tx,n.ty=o*i.b+s*i.d+i.ty,n};i.invert=function(n,t){var r=t.a,u=t.b,f=t.c,e=t.d,i=1/(r*e-u*f),o=t.tx,s=t.ty;return n.a=i*e,n.b=-i*u,n.c=-i*f,n.d=i*r,n.tx=i*(f*s-e*o),n.ty=i*(u*o-r*s),n};i.fromMat4=function(n,t){var i=t.m;return n.a=i[0],n.b=i[1],n.c=i[4],n.d=i[5],n.tx=i[12],n.ty=i[13],n};i.transformVec2=function(n,t,i,r){var u,f;return void 0===r?(r=i,u=t.x,f=t.y):(u=t,f=i),n.x=r.a*u+r.c*f+r.tx,n.y=r.b*u+r.d*f+r.ty,n};i.transformSize=function(n,t,i){return n.width=i.a*t.width+i.c*t.height,n.height=i.b*t.width+i.d*t.height,n};i.transformRect=function(n,t,i){var r=t.x,u=t.y,f=r+t.width,e=u+t.height,o=i.a*r+i.c*u+i.tx,s=i.b*r+i.d*u+i.ty,h=i.a*f+i.c*u+i.tx,c=i.b*f+i.d*u+i.ty,l=i.a*r+i.c*e+i.tx,a=i.b*r+i.d*e+i.ty,v=i.a*f+i.c*e+i.tx,y=i.b*f+i.d*e+i.ty,p=Math.min(o,h,l,v),b=Math.max(o,h,l,v),w=Math.min(s,c,a,y),k=Math.max(s,c,a,y);return n.x=p,n.y=w,n.width=b-p,n.height=k-w,n};i.transformObb=function(n,t,i,r,u,f){var s=u.x,h=u.y,c=u.width,l=u.height,e=f.a*s+f.c*h+f.tx,o=f.b*s+f.d*h+f.ty,a=f.a*c,v=f.b*c,y=f.c*l,p=f.d*l;t.x=e;t.y=o;i.x=a+e;i.y=v+o;n.x=y+e;n.y=p+o;r.x=a+y+e;r.y=v+p+o};cc.AffineTransform=t.exports=i},{}],261:[function(n,t){"use strict";function f(n){return n?"string"==typeof n?r.getClassByName(n):n:(cc.errorID(3804),null)}function l(n,t){var i,u,r,f;if(t._sealed){for(i=0;i<n._components.length;++i)if(u=n._components[i],u.constructor===t)return u}else for(r=0;r<n._components.length;++r)if(f=n._components[r],f instanceof t)return f;return null}function s(n,t,i){var r,f,u,e;if(t._sealed)for(r=0;r<n._components.length;++r)f=n._components[r],f.constructor===t&&i.push(f);else for(u=0;u<n._components.length;++u)e=n._components[u],e instanceof t&&i.push(e)}function a(n,t){for(var r,u,i=0;i<n.length;++i)if((r=n[i],u=l(r,t),u)||r._children.length>0&&(u=a(r._children,t)))return u;return null}function v(n,t,i){for(var u,r=0;r<n.length;++r)u=n[r],s(u,t,i),u._children.length>0&&v(u._children,t,i)}var e=n("../platform/CCObject").Flags,y=n("./misc"),r=n("../platform/js"),p=n("../platform/id-generater"),w=n("../event-manager"),h=n("../renderer/render-flow"),u=e.Destroying,o=e.DontDestroy,b=e.Deactivating,c=new p("Node"),i=cc.Class({name:"cc._BaseNode","extends":cc.Object,properties:{_parent:null,_children:[],_active:!0,_components:[],_prefab:null,_persistNode:{get:function(){return(this._objFlags&o)>0},set:function(n){n?this._objFlags|=o:this._objFlags&=~o}},name:{get:function(){return this._name},set:function(n){this._name=n}},uuid:{get:function(){return this._id}},children:{get:function(){return this._children}},childrenCount:{get:function(){return this._children.length}},active:{get:function(){return this._active},set:function(n){if(n=!!n,this._active!==n){this._active=n;var t=this._parent;t&&t._activeInHierarchy&&cc.director._nodeActivator.activateNode(this,n)}}},activeInHierarchy:{get:function(){return this._activeInHierarchy}}},ctor:function(n){this._name=void 0!==n?n:"New Node";this._activeInHierarchy=!1;this._id=c.getNewId();cc.director._scheduler&&cc.director._scheduler.enableForTarget(this);this.__eventTargets=[]},getParent:function(){return this._parent},setParent:function(n){var t,i;this._parent!==n&&(t=this._parent,(this._parent=n||null,this._onSetParent(n),n&&(w._setDirtyForNode(this),n._children.push(this),n.emit&&n.emit("child-added",this),n._renderFlag|=h.FLAG_CHILDREN),t)?t._objFlags&u||(i=t._children.indexOf(this),t._children.splice(i,1),t.emit&&t.emit("child-removed",this),this._onHierarchyChanged(t),0===t._children.length&&(t._renderFlag&=~h.FLAG_CHILDREN)):n&&this._onHierarchyChanged(null))},attr:function(n){r.mixin(this,n)},getChildByUuid:function(n){if(!n)return cc.log("Invalid uuid"),null;for(var i=this._children,t=0,r=i.length;t<r;t++)if(i[t]._id===n)return i[t];return null},getChildByName:function(n){if(!n)return cc.log("Invalid name"),null;for(var i=this._children,t=0,r=i.length;t<r;t++)if(i[t]._name===n)return i[t];return null},addChild:function(n){cc.assertID(n,1606);cc.assertID(null===n._parent,1605);n.setParent(this)},insertChild:function(n,t){n.parent=this;n.setSiblingIndex(t)},getSiblingIndex:function(){return this._parent?this._parent._children.indexOf(this):0},setSiblingIndex:function(n){var t,i;this._parent&&(this._parent._objFlags&b?cc.errorID(3821):(t=this._parent._children,n=-1!==n?n:t.length-1,i=t.indexOf(this),n!==i&&(t.splice(i,1),n<t.length?t.splice(n,0,this):t.push(this),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(n))))},walk:function(n,t){var f,e,s,o,h=cc._BaseNode,r=1,i=h._stacks[h._stackId],u;for(i||(i=[],h._stacks.push(i)),h._stackId++,i.length=0,i[0]=this,u=null,o=!1;r;)if(e=i[--r])if(!o&&n?n(e):o&&t&&t(e),i[r]=null,o){if(u===this._parent)break;if(o=!1,f)if(f[++s])i[r]=f[s],r++;else if(u&&(i[r]=u,r++,o=!0,u._parent?(s=(f=u._parent._children).indexOf(u),u=u._parent):(u=null,f=null),s<0))break}else e._children.length>0?(u=e,f=e._children,s=0,i[r]=f[s],r++):(i[r]=e,r++,o=!0);i.length=0;h._stackId--},cleanup:function(){},removeFromParent:function(n){this._parent&&(void 0===n&&(n=!0),this._parent.removeChild(this,n))},removeChild:function(n,t){this._children.indexOf(n)>-1&&((t||void 0===t)&&n.cleanup(),n.parent=null)},removeAllChildren:function(n){var r=this._children,t,i;for(void 0===n&&(n=!0),t=r.length-1;t>=0;t--)i=r[t],i&&(n&&i.cleanup(),i.parent=null);this._children.length=0},isChildOf:function(n){var t=this;do{if(t===n)return!0;t=t._parent}while(t);return!1},getComponent:function(n){var t=f(n);return t?l(this,t):null},getComponents:function(n){var t=f(n),i=[];return t&&s(this,t,i),i},getComponentInChildren:function(n){var t=f(n);return t?a(this._children,t):null},getComponentsInChildren:function(n){var t=f(n),i=[];return t&&(s(this,t,i),v(this._children,t,i)),i},_checkMultipleComp:!1,addComponent:function(n){var t,u,i;if("string"==typeof n){if(!(t=r.getClassByName(n)))return cc.errorID(3807,n),cc._RFpeek()&&cc.errorID(3808,n),null}else{if(!n)return cc.errorID(3804),null;t=n}return"function"!=typeof t?(cc.errorID(3809),null):r.isChildClassOf(t,cc.Component)?(u=t._requireComponent,u&&!this.getComponent(u)&&!this.addComponent(u))?null:(i=new t,i.node=this,this._components.push(i),this._activeInHierarchy&&cc.director._nodeActivator.activateComp(i),i):(cc.errorID(3810),null)},_addComponentAt:!1,removeComponent:function(n){n?(n instanceof cc.Component||(n=this.getComponent(n)),n&&n.destroy()):cc.errorID(3813)},_getDependComponent:!1,_removeComponent:function(n){if(n){if(!(this._objFlags&u)){var t=this._components.indexOf(n);-1!==t?this._components.splice(t,1):n.node!==this&&cc.errorID(3815)}}else cc.errorID(3814)},destroy:function(){cc.Object.prototype.destroy.call(this)&&(this.active=!1)},destroyAllChildren:function(){for(var t=this._children,n=0;n<t.length;++n)t[n].destroy()},_onSetParent:function(){},_onPostActivated:function(){},_onBatchCreated:function(){},_onHierarchyChanged:function(){var n=this._parent,t;!this._persistNode||n instanceof cc.Scene||cc.game.removePersistRootNode(this);t=this._active&&!(!n||!n._activeInHierarchy);this._activeInHierarchy!==t&&cc.director._nodeActivator.activateNode(this,t)},_instantiate:function(n,t){return n||(n=cc.instantiate._clone(this,this)),n._prefab,n._parent=null,n._onBatchCreated(t),n},_registerIfAttached:!1,_onPreDestroy:function(){var n,i,r,f,s;this._objFlags|=u;var t=this._parent,e=t&&t._objFlags&u,o=this._children;for(n=0,i=o.length;n<i;++n)o[n]._destroyImmediate();for(n=0,i=this._components.length;n<i;++n)this._components[n]._destroyImmediate();for(r=this.__eventTargets,n=0,i=r.length;n<i;++n)f=r[n],f&&f.targetOff(this);return(r.length=0,this._persistNode&&cc.game.removePersistRootNode(this),!e&&t)&&(s=t._children.indexOf(this),t._children.splice(s,1),t.emit&&t.emit("child-removed",this)),e},onRestore:!1});i.idGenerater=c;i._stacks=[[]];i._stackId=0;i.prototype._onPreDestroyBase=i.prototype._onPreDestroy;i.prototype._onHierarchyChangedBase=i.prototype._onHierarchyChanged;y.propertyDefine(i,["parent","name","children","childrenCount"],{});cc._BaseNode=t.exports=i},{"../event-manager":140,"../platform/CCObject":201,"../platform/id-generater":212,"../platform/js":216,"../renderer/render-flow":227,"./misc":269}],262:[function(n,t){"use strict";t.exports={binarySearchEpsilon:function(n,t){for(var f,r=0,u=n.length-1,i=u>>>1;r<=u;i=r+u>>>1)if(f=n[i],f>t+1e-6)u=i-1;else{if(!(f<t-1e-6))return i;r=i+1}return~r}}},{}],263:[function(n,t){"use strict";var u=n("../components/CCRenderComponent"),i=n("../platform/CCMacro").BlendFactor,r=n("../../renderer/gfx"),f=cc.Class({properties:{_srcBlendFactor:i.SRC_ALPHA,_dstBlendFactor:i.ONE_MINUS_SRC_ALPHA,srcBlendFactor:{get:function(){return this._srcBlendFactor},set:function(n){this._srcBlendFactor!==n&&(this._srcBlendFactor=n,this._updateBlendFunc(!0),this._onBlendChanged&&this._onBlendChanged())},animatable:!1,type:i,tooltip:!1,visible:!0},dstBlendFactor:{get:function(){return this._dstBlendFactor},set:function(n){this._dstBlendFactor!==n&&(this._dstBlendFactor=n,this._updateBlendFunc(!0))},animatable:!1,type:i,tooltip:!1,visible:!0}},setMaterial:function(n,t){var r=u.prototype.setMaterial.call(this,n,t);return this._srcBlendFactor===i.SRC_ALPHA&&this._dstBlendFactor===i.ONE_MINUS_SRC_ALPHA||this._updateMaterialBlendFunc(r),r},_updateMaterial:function(){this._updateBlendFunc()},_updateBlendFunc:function(n){var r,t,u;if(n||this._srcBlendFactor!==i.SRC_ALPHA||this._dstBlendFactor!==i.ONE_MINUS_SRC_ALPHA)for(r=this.getMaterials(),t=0;t<r.length;t++)u=r[t],this._updateMaterialBlendFunc(u)},_updateMaterialBlendFunc:function(n){n.setBlend(!0,r.BLEND_FUNC_ADD,this._srcBlendFactor,this._dstBlendFactor,r.BLEND_FUNC_ADD,this._srcBlendFactor,this._dstBlendFactor)}});t.exports=cc.BlendFunc=f},{"../../renderer/gfx":317,"../components/CCRenderComponent":115,"../platform/CCMacro":200}],264:[function(n,t){"use strict";var e=n("./misc").BASE64_VALUES,u="0123456789abcdef".split(""),i=["","","",""],r=i.concat(i,"-",i,"-",i,"-",i,"-",i,i,i),f=r.map(function(n,t){return"-"===n?NaN:t}).filter(isFinite);t.exports=function(n){var t,i,o,s;if(22!==n.length)return n;for(r[0]=n[0],r[1]=n[1],t=2,i=2;t<22;t+=2)o=e[n.charCodeAt(t)],s=e[n.charCodeAt(t+1)],r[f[i++]]=u[o>>2],r[f[i++]]=u[(3&o)<<2|s>>4],r[f[i++]]=u[15&s];return r.join("")}},{"./misc":269}],265:[function(n,t){"use strict";cc.find=t.exports=function(n,t){var u,h,e,r,c,o;if(null==n)return cc.errorID(3814),null;if(!t){if(u=cc.director.getScene(),!u)return null;t=u}for(var i=t,l="/"!==n[0]?0:1,s=n.split("/"),f=l;f<s.length;f++){for(h=s[f],e=i._children,i=null,r=0,c=e.length;r<c;++r)if(o=e[r],o.name===h){i=o;break}if(!i)return null}return i}},{}],266:[function(n,t){"use strict";var i,u=(i=n("../assets/material/material-variant"))&&i.__esModule?i:{"default":i},r=n("../assets/material/CCMaterial"),f=cc.Class({properties:{_normalMaterial:null,normalMaterial:{get:function(){return this._normalMaterial},set:function(n){this._normalMaterial=n;this._updateDisabledState&&this._updateDisabledState()},type:r,tooltip:!1,animatable:!1},_grayMaterial:null,grayMaterial:{get:function(){return this._grayMaterial},set:function(n){this._grayMaterial=n;this._updateDisabledState&&this._updateDisabledState()},type:r,tooltip:!1,animatable:!1}},_switchGrayMaterial:function(n,t){var i;n?((i=this._grayMaterial)||(i=r.getBuiltinMaterial("2d-gray-sprite")),i=this._grayMaterial=u.default.create(i,t)):((i=this._normalMaterial)||(i=r.getBuiltinMaterial("2d-sprite",t)),i=this._normalMaterial=u.default.create(i,t));t.setMaterial(0,i)}});t.exports=f},{"../assets/material/CCMaterial":80,"../assets/material/material-variant":87}],267:[function(n,t){"use strict";var r=/^(click)(\s)*=|(param)(\s)*=/,u=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,i=function(){this._parsedObject={};this._specialSymbolArray=[];this._specialSymbolArray.push([/&lt;/g,"<"]);this._specialSymbolArray.push([/&gt;/g,">"]);this._specialSymbolArray.push([/&amp;/g,"&"]);this._specialSymbolArray.push([/&quot;/g,'"']);this._specialSymbolArray.push([/&apos;/g,"'"]);this._specialSymbolArray.push([/&nbsp;/g," "])};i.prototype={constructor:i,parse:function(n){var i,u,t,r,f,e;for(this._resultObjectArray=[],this._stack=[],i=0,u=n.length;i<u;)t=n.indexOf(">",i),r=-1,(t>=0&&(r=n.lastIndexOf("<",t))<i-1&&(r=n.indexOf("<",t+1),t=n.indexOf(">",r+1)),r<0)?(this._stack.pop(),this._processResult(n.substring(i)),i=u):(f=n.substring(i,r),e=n.substring(r+1,t),""===e&&(f=n.substring(i,t+1)),this._processResult(f),-1===t?t=r:"/"===n.charAt(r+1)?this._stack.pop():this._addToStack(e),i=t+1);return this._resultObjectArray},_attributeToObject:function(n){var t,e,s,a,i={},r=(n=n.trim()).match(/^(color|size)(\s)*=/),o,c,h,f,l;if(r){if(t=r[0],""===(n=n.substring(t.length).trim()))return i;switch(e=n.indexOf(" "),t[0]){case"c":i.color=e>-1?n.substring(0,e).trim():n;break;case"s":i.size=parseInt(n)}return e>-1&&(a=n.substring(e+1).trim(),s=this._processEventHandler(a),i.event=s),i}if((r=n.match(/^(br(\s)*\/)/))&&r[0].length>0&&(t=r[0].trim()).startsWith("br")&&"/"===t[t.length-1])return i.isNewLine=!0,this._resultObjectArray.push({text:"",style:{newline:!0}}),i;if((r=n.match(/^(img(\s)*src(\s)*=[^>]+\/)/))&&r[0].length>0&&(t=r[0].trim()).startsWith("img")&&"/"===t[t.length-1]){for(r=n.match(u),c=!1;r;){if(t=(n=n.substring(n.indexOf(r[0]))).substr(0,r[0].length),f=(e=(o=n.substring(t.length).trim()).indexOf(" "))>-1?o.substr(0,e):o,t=(t=t.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),n=o.substring(e).trim(),f.endsWith("/")&&(f=f.slice(0,-1)),"src"===t){switch(f.charCodeAt(0)){case 34:case 39:c=!0;f=f.slice(1,-1)}i.isImage=!0;i.src=f}else if("height"===t)i.imageHeight=parseInt(f);else if("width"===t)i.imageWidth=parseInt(f);else if("align"===t){switch(f.charCodeAt(0)){case 34:case 39:f=f.slice(1,-1)}i.imageAlign=f.toLocaleLowerCase()}else"offset"===t?i.imageOffset=f:"click"===t&&(i.event=this._processEventHandler(t+"="+f));i.event&&"param"===t&&(i.event.param=f.replace(/^\"|\"$/g,""));r=n.match(u)}return c&&i.isImage&&this._resultObjectArray.push({text:"",style:i}),{}}if(r=n.match(/^(outline(\s)*[^>]*)/)){if(h={color:"#ffffff",width:1},n=r[0].substring(7).trim())for(l=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,r=n.match(l);r;)t=(n=n.substring(n.indexOf(r[0]))).substr(0,r[0].length),f=(e=(o=n.substring(t.length).trim()).indexOf(" "))>-1?o.substr(0,e):o,t=(t=t.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),n=o.substring(e).trim(),"click"===t?i.event=this._processEventHandler(t+"="+f):"color"===t?h.color=f:"width"===t&&(h.width=parseInt(f)),i.event&&"param"===t&&(i.event.param=f.replace(/^\"|\"$/g,"")),r=n.match(l);i.outline=h}if((r=n.match(/^(on|u|b|i)(\s)*/))&&r[0].length>0){switch(t=r[0],n=n.substring(t.length).trim(),t[0]){case"u":i.underline=!0;break;case"i":i.italic=!0;break;case"b":i.bold=!0}if(""===n)return i;s=this._processEventHandler(n);i.event=s}return i},_processEventHandler:function(n){for(var i,u,o,t=0,s={},e=n.match(r),f=!1;e;)i=e[0],u="",(f=!1,'"'===(n=n.substring(i.length).trim()).charAt(0))?((t=n.indexOf('"',1))>-1&&(u=n.substring(1,t).trim(),f=!0),t++):"'"===n.charAt(0)?((t=n.indexOf("'",1))>-1&&(u=n.substring(1,t).trim(),f=!0),t++):(o=n.match(/(\S)+/),t=(u=o?o[0]:"").length),f&&(s[i=i.substring(0,i.length-1).trim()]=u),e=(n=n.substring(t).trim()).match(r);return s},_addToStack:function(n){var t=this._attributeToObject(n),r,i;if(0===this._stack.length)this._stack.push(t);else{if(t.isNewLine||t.isImage)return;r=this._stack[this._stack.length-1];for(i in r)t[i]||(t[i]=r[i]);this._stack.push(t)}},_processResult:function(n){""!==n&&(n=this._escapeSpecialSymbol(n),this._stack.length>0?this._resultObjectArray.push({text:n,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:n}))},_escapeSpecialSymbol:function(n){for(var i,r,t=0;t<this._specialSymbolArray.length;++t)i=this._specialSymbolArray[t][0],r=this._specialSymbolArray[t][1],n=n.replace(i,r);return n}};t.exports=i},{}],268:[function(n){"use strict";n("./CCPath");n("./profiler/CCProfiler");n("./find");n("./mutable-forward-iterator")},{"./CCPath":259,"./find":265,"./mutable-forward-iterator":270,"./profiler/CCProfiler":273}],269:[function(n,t){"use strict";for(var r,e=n("../platform/js"),i={propertyDefine:function(n,t,i){function h(n,t,i,r){var u=Object.getOwnPropertyDescriptor(n,t),f;u?(u.get&&(n[i]=u.get),u.set&&r&&(n[r]=u.set)):(f=n[i],e.getset(n,t,f,n[r]))}for(var r,o,s,f=n.prototype,u=0;u<t.length;u++)o=(r=t[u])[0].toUpperCase()+r.slice(1),h(f,r,"get"+o,"set"+o);for(r in i)s=i[r],h(f,r,s[0],s[1])},NextPOT:function(n){return n-=1,n|=n>>1,n|=n>>2,n|=n>>4,n|=n>>8,1+(n|=n>>16)},BUILTIN_CLASSID_RE:/^(?:cc|dragonBones|sp|ccsg)\..+/},u=new Array(123),f=0;f<123;++f)u[f]=64;for(r=0;r<64;++r)u["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(r)]=r;i.BASE64_VALUES=u;i.pushToMap=function(n,t,i,r){var u=n[t];u?Array.isArray(u)?r?(u.push(u[0]),u[0]=i):u.push(i):n[t]=r?[i,u]:[u,i]:n[t]=i};i.clampf=function(n,t,i){if(t>i){var r=t;t=i;i=r}return n<t?t:n<i?n:i};i.clamp01=function(n){return n<0?0:n<1?n:1};i.lerp=function(n,t,i){return n+(t-n)*i};i.degreesToRadians=function(n){return n*cc.macro.RAD};i.radiansToDegrees=function(n){return n*cc.macro.DEG};cc.misc=t.exports=i},{"../platform/js":216}],270:[function(n,t){"use strict";function r(n){this.i=0;this.array=n}var i=r.prototype;i.remove=function(n){var t=this.array.indexOf(n);t>=0&&this.removeAt(t)};i.removeAt=function(n){this.array.splice(n,1);n<=this.i&&--this.i};i.fastRemove=function(n){var t=this.array.indexOf(n);t>=0&&this.fastRemoveAt(t)};i.fastRemoveAt=function(n){var t=this.array;t[n]=t[t.length-1];--t.length;n<=this.i&&--this.i};i.push=function(n){this.array.push(n)};t.exports=r},{}],271:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var r=function(){function t(){this.enabled=!1;this.count=0;this.maxSize=1024}var n=t.prototype;return n.get=function(){},n.put=function(){},n.clear=function(){},t}();i.default=r;cc.pool={};r.register=function(n,t){cc.pool[n]=t};t.exports=i.default},{}],272:[function(n,t){"use strict";cc._PrefabInfo=cc.Class({name:"cc.PrefabInfo",properties:{root:null,asset:null,fileId:"",sync:!1}});t.exports={syncWithPrefab:function(n){var r=n._prefab,i;if(!r.asset)return cc.errorID(3701,n.name),void(n._prefab=null);var u=n._objFlags,f=n._parent,e=n._id,o=n._name,s=n._active,h=n._eulerAngles.x,c=n._eulerAngles.y,l=n._eulerAngles.z,a=n._localZOrder,t=n._trs,v=t[0],y=t[1],p=t[2];cc.game._isCloning=!0;i=r.asset.data;i._iN$t=n;cc.instantiate._clone(i,i);cc.game._isCloning=!1;n._objFlags=u;n._parent=f;n._id=e;n._prefab=r;n._name=o;n._active=s;n._localZOrder=a;(t=n._trs)[0]=v;t[1]=y;t[2]=p;n._eulerAngles.x=h;n._eulerAngles.y=c;n._eulerAngles.z=l}}},{}],273:[function(n,t){"use strict";function a(){var t,n;if(!i){i={fps:{desc:"Framerate (FPS)",below:30,average:500},draws:{desc:"Draw Call"},frame:{desc:"Frame time (ms)",min:0,max:50,average:500},logic:{desc:"Game Logic (ms)",min:0,max:50,average:500,color:"#080"},render:{desc:"Renderer (ms)",min:0,max:50,average:500,color:"#f90"},mode:{desc:cc.game.renderType===cc.game.RENDER_TYPE_WEBGL?"WebGL":"Canvas",min:1}};t=performance.now();for(n in i)i[n]._counter=new l(n,i[n],t)}}function v(){var i,u,n,t;r&&r.isValid||((r=new cc.Node("PROFILER-NODE")).x=r.y=10,r.groupIndex=cc.Node.BuiltinGroupIndex.DEBUG,cc.Camera._setupDebugCamera(),r.zIndex=c.MAX_ZINDEX,cc.game.addPersistRootNode(r),i=new cc.Node("LEFT-PANEL"),i.anchorX=i.anchorY=0,u=i.addComponent(cc.Label),u.fontSize=f,u.lineHeight=f,i.parent=r,n=new cc.Node("RIGHT-PANEL"),n.anchorX=1,n.anchorY=0,n.x=200,t=n.addComponent(cc.Label),t.horizontalAlign=cc.Label.HorizontalAlign.RIGHT,t.fontSize=f,t.lineHeight=f,n.parent=r,cc.sys.platform!==cc.sys.BAIDU_GAME_SUB&&cc.sys.platform!==cc.sys.WECHAT_GAME_SUB&&(u.cacheMode=cc.Label.CacheMode.CHAR,t.cacheMode=cc.Label.CacheMode.CHAR),e={left:u,right:t})}function o(){v();var n=cc.director._lastUpdate;i.frame._counter.start(n);i.logic._counter.start(n)}function s(){var n=performance.now();cc.director.isPaused()?i.frame._counter.start(n):i.logic._counter.end(n);i.render._counter.start(n)}function h(){var n=performance.now(),r,u,f,t;i.render._counter.end(n);i.draws._counter.value=cc.renderer.drawCalls;i.frame._counter.end(n);i.fps._counter.frame(n);r="";u="";for(f in i)t=i[f],t._counter.sample(n),r+=t.desc+"\n",u+=t._counter.human()+"\n";e&&(e.left.string=r,e.right.string=u)}var c=n("../../platform/CCMacro"),l=n("./perf-counter"),u=!1,f=15,i=null,r=null,e=null;cc.profiler=t.exports={isShowingStats:function(){return u},hideStats:function(){u&&(r&&(r.active=!1),cc.director.off(cc.Director.EVENT_BEFORE_UPDATE,o),cc.director.off(cc.Director.EVENT_AFTER_UPDATE,s),cc.director.off(cc.Director.EVENT_AFTER_DRAW,h),u=!1)},showStats:function(){u||(a(),r&&(r.active=!0),cc.director.on(cc.Director.EVENT_BEFORE_UPDATE,o),cc.director.on(cc.Director.EVENT_AFTER_UPDATE,s),cc.director.on(cc.Director.EVENT_AFTER_DRAW,h),u=!0)}}},{"../../platform/CCMacro":200,"./perf-counter":275}],274:[function(n,t){"use strict";var i=cc.Class({name:"cc.Counter",ctor:function(n,t,i){this._id=n;this._opts=t||{};this._value=0;this._total=0;this._averageValue=0;this._accumValue=0;this._accumSamples=0;this._accumStart=i},properties:{value:{get:function(){return this._value},set:function(n){this._value=n}}},_average:function(n,t){if(this._opts.average){this._accumValue+=n;++this._accumSamples;var i=t;i-this._accumStart>=this._opts.average&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=i,this._accumSamples=0)}},sample:function(n){this._average(this._value,n)},human:function(){var n=this._opts.average?this._averageValue:this._value;return Math.round(100*n)/100},alarm:function(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over}});t.exports=i},{}],275:[function(n,t){"use strict";var i=n("./counter"),r=cc.Class({name:"cc.PerfCounter","extends":i,ctor:function(n,t,i){this._time=i},start:function(n){this._time=n},end:function(n){this._value=n-this._time;this._average(this._value)},tick:function(){this.end();this.start()},frame:function(n){var t=n,i=t-this._time;this._total++;i>(this._opts.average||1e3)&&(this._value=1e3*this._total/i,this._total=0,this._time=t,this._average(this._value))}});t.exports=r},{"./counter":274}],276:[function(n,t){"use strict";function i(n){this.count=0;this.limit=n;this.datas={};this.head=null;this.tail=null}var r,u=new((r=n("../platform/js"))&&r.__esModule?r:{"default":r}).default.Pool(2),f,e;u.get=function(){return this._get()||{key:null,value:null,prev:null,next:null}};i.prototype.moveToHead=function(n){n.next=this.head;n.prev=null;null!==this.head&&(this.head.prev=n);this.head=n;null===this.tail&&(this.tail=n);this.count++;this.datas[n.key]=n};i.prototype.put=function(n,t){var r=u.get(),i;(r.key=n,r.value=t,this.count>=this.limit)&&(i=this.tail,delete this.datas[i.key],this.count--,this.tail=i.prev,this.tail.next=null,i.prev=null,i.next=null,u.put(i));this.moveToHead(r)};i.prototype.remove=function(n){null!==n.prev?n.prev.next=n.next:this.head=n.next;null!==n.next?n.next.prev=n.prev:this.tail=n.prev;delete this.datas[n.key];this.count--};i.prototype.get=function(n){var t=this.datas[n];return t?(this.remove(t),this.moveToHead(t),t.value):null};i.prototype.clear=function(){this.count=0;this.datas={};this.head=null;this.tail=null};i.prototype.has=function(n){return!!this.datas[n]};i.prototype.delete=function(n){var t=this.datas[n];this.remove(t)};f=new i(100);e={BASELINE_RATIO:.26,MIDDLE_RATIO:.37,BASELINE_OFFSET:0,label_wordRex:/([a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430-\u044f\u0410-\u042f\u0401\u0451]+|\S)/,label_symbolRex:/^[!,.:;'}\]%\?>\u3001\u2018\u201c\u300b\uff1f\u3002\uff0c\uff01]/,label_lastWordRex:/([a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430\xed\xec\xcd\xcc\xef\xc1\xc0\xe1\xe0\xc9\xc8\xd2\xd3\xf2\xf3\u0150\u0151\xd9\xda\u0170\xfa\u0171\xf1\xd1\xe6\xc6\u0153\u0152\xc3\xc2\xe3\xd4\xf5\u011b\u0161\u010d\u0159\u017e\xfd\xe1\xed\xe9\xf3\xfa\u016f\u0165\u010f\u0148\u011a\u0160\u010c\u0158\u017d\xc1\xcd\xc9\xd3\xda\u0164\u017c\u017a\u015b\xf3\u0144\u0142\u0119\u0107\u0105\u017b\u0179\u015a\xd3\u0143\u0141\u0118\u0106\u0104-\u044f\u0410-\u042f\u0401\u0451]+|\S)$/,label_lastEnglish:/[a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430\xed\xec\xcd\xcc\xef\xc1\xc0\xe1\xe0\xc9\xc8\xd2\xd3\xf2\xf3\u0150\u0151\xd9\xda\u0170\xfa\u0171\xf1\xd1\xe6\xc6\u0153\u0152\xc3\xc2\xe3\xd4\xf5\u011b\u0161\u010d\u0159\u017e\xfd\xe1\xed\xe9\xf3\xfa\u016f\u0165\u010f\u0148\u011a\u0160\u010c\u0158\u017d\xc1\xcd\xc9\xd3\xda\u0164\u017c\u017a\u015b\xf3\u0144\u0142\u0119\u0107\u0105\u017b\u0179\u015a\xd3\u0143\u0141\u0118\u0106\u0104-\u044f\u0410-\u042f\u0401\u0451]+$/,label_firstEnglish:/^[a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430\xed\xec\xcd\xcc\xef\xc1\xc0\xe1\xe0\xc9\xc8\xd2\xd3\xf2\xf3\u0150\u0151\xd9\xda\u0170\xfa\u0171\xf1\xd1\xe6\xc6\u0153\u0152\xc3\xc2\xe3\xd4\xf5\u011b\u0161\u010d\u0159\u017e\xfd\xe1\xed\xe9\xf3\xfa\u016f\u0165\u010f\u0148\u011a\u0160\u010c\u0158\u017d\xc1\xcd\xc9\xd3\xda\u0164\u017c\u017a\u015b\xf3\u0144\u0142\u0119\u0107\u0105\u017b\u0179\u015a\xd3\u0143\u0141\u0118\u0106\u0104-\u044f\u0410-\u042f\u0401\u0451]/,highSurrogateRex:/[\uD800-\uDBFF]/,lowSurrogateRex:/[\uDC00-\uDFFF]/,label_wrapinspection:!0,__CHINESE_REG:/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/,__JAPANESE_REG:/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g,__KOREAN_REG:/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/,isUnicodeCJK:function(n){return this.__CHINESE_REG.test(n)||this.__JAPANESE_REG.test(n)||this.__KOREAN_REG.test(n)},isUnicodeSpace:function(n){return(n=n.charCodeAt(0))>=9&&n<=13||32===n||133===n||160===n||5760===n||n>=8192&&n<=8202||8232===n||8233===n||8239===n||8287===n||12288===n},safeMeasureText:function(n,t,i){var e=(i||n.font)+""+t,o=f.get(e),r,u;return null!==o?o:(r=n.measureText(t),u=r&&r.width||0,f.put(e,u),u)},_safeSubstring:function(n,t,i){var u=t,r=i,f=n[t],e;return(this.lowSurrogateRex.test(f)&&u--,void 0!==i)&&(i-1!==t?(e=n[i-1],this.highSurrogateRex.test(e)&&r--):this.highSurrogateRex.test(f)&&r++),n.substring(u,r)},fragmentText:function(n,t,i,r){var o=[],u,y,l,e;if(0===n.length||i<0)return o.push(""),o;for(u=n;t>i&&u.length>1;){for(var f=u.length*(i/t)|0,s=this._safeSubstring(u,f),c=t-r(s),h=s,a=0,v=0;c>i&&v++<10;)f*=i/c,f|=0,c=t-r(s=this._safeSubstring(u,f));for(v=0;c<=i&&v++<10;)s&&(y=this.label_wordRex.exec(s),a=y?y[0].length:1,h=s),f+=a,c=t-r(s=this._safeSubstring(u,f));0==(f-=a)?(f=1,h=this._safeSubstring(u,1)):1===f&&this.highSurrogateRex.test(u[0])&&(f=2,h=this._safeSubstring(u,2));e=this._safeSubstring(u,0,f);this.label_wrapinspection&&this.label_symbolRex.test(h||s)&&(0==(f-=(l=this.label_lastWordRex.exec(e))?l[0].length:0)&&(f=1),h=this._safeSubstring(u,f),e=this._safeSubstring(u,0,f));this.label_firstEnglish.test(h)&&(l=this.label_lastEnglish.exec(e))&&e!==l[0]&&(f-=l[0].length,h=this._safeSubstring(u,f),e=this._safeSubstring(u,0,f));0===o.length?o.push(e):(e=e.trimLeft()).length>0&&o.push(e);t=r(u=h||s)}return 0===o.length?o.push(u):(u=u.trimLeft()).length>0&&o.push(u),o}};cc.textUtils=t.exports=e},{"../platform/js":216}],277:[function(n,t){"use strict";var i=n("../assets/CCTexture2D"),r={loadImage:function(n,t,i){cc.assertID(n,3103);var r=cc.assetManager.assets.get(n);if(r)return r.loaded?(t&&t.call(i,null,r),r):(r.once("load",function(){t&&t.call(i,null,r)},i),r);cc.assetManager.loadRemote(n,function(n,r){t&&t.call(i,n,r)})},cacheImage:function(n,t){if(n&&t){var r=new i;return r.initWithElement(t),cc.assetManager.assets.add(n,r),r}},postLoadTexture:function(n,t){n.loaded?t&&t():n.nativeUrl?cc.assetManager.postLoadNative(n,t):t&&t()}};t.exports=r},{"../assets/CCTexture2D":77}],278:[function(n,t){"use strict";var i=n("./node-unit"),r=n("./node-mem-pool");t.exports={NodeMemPool:new r(i)}},{"./node-mem-pool":280,"./node-unit":281}],279:[function(n,t){"use strict";var r=function(n){this._unitClass=n;this._pool=[];this._findOrder=[]},i=r.prototype;i._initNative=function(){this._nativeMemPool=new renderer.MemPool};i._buildUnit=function(n){return new this._unitClass(n,this)};i._destroyUnit=function(n){var t,r,i;for(this._pool[n]=null,t=0,r=this._findOrder.length;t<r;t++)if(i=this._findOrder[t],i&&i.unitID==n){this._findOrder.splice(t,1);break}};i._findUnitID=function(){for(var n=0,t=this._pool;t[n];)n++;return n};i.pop=function(){for(var r,u,f,n=null,i=0,t=this._findOrder,e=this._pool,o=t.length;i<o;i++)if(r=t[i],r&&r.hasSpace()){n=r;break}return n||(u=this._findUnitID(),n=this._buildUnit(u),e[u]=n,t.push(n),i=t.length-1),f=t[0],f!==n&&(t[0]=n,t[i]=f),n.pop()};i.push=function(n){var t=this._pool[n.unitID];return t.push(n.index),this._findOrder.length>1&&t.isAllFree()&&this._destroyUnit(n.unitID),t};t.exports=r},{}],280:[function(n,t){"use strict";var u,i=n("./mem-pool"),f=function(n){i.call(this,n)},r;(u=function(){}).prototype=i.prototype;r=f.prototype=new u;r._initNative=function(){this._nativeMemPool=new renderer.NodeMemPool};r._destroyUnit=function(n){i.prototype._destroyUnit.call(this,n)};t.exports=f},{"./mem-pool":279}],281:[function(n,t){"use strict";var r,i=n("../../value-types/utils"),e=(Uint32Array,10*i.FLOAT_BYTES),o=16*i.FLOAT_BYTES,s=16*i.FLOAT_BYTES,u=(Uint32Array,Uint32Array,Int32Array,Uint8Array,Uint8Array,Uint32Array,i.FLOAT_BYTES,n("./unit-base")),f=function(n,t){var f,r,h;for(u.call(this,n,t),f=this._contentNum,this.trsList=new i.FLOAT_ARRAY_TYPE(10*f),this.localMatList=new i.FLOAT_ARRAY_TYPE(16*f),this.worldMatList=new i.FLOAT_ARRAY_TYPE(16*f),r=0;r<f;r++)h=this._spacesData[r],h.trs=new i.FLOAT_ARRAY_TYPE(this.trsList.buffer,r*e,10),h.localMat=new i.FLOAT_ARRAY_TYPE(this.localMatList.buffer,r*o,16),h.worldMat=new i.FLOAT_ARRAY_TYPE(this.worldMatList.buffer,r*s,16)};(r=function(){}).prototype=u.prototype;f.prototype=new r;t.exports=f},{"../../value-types/utils":291,"./unit-base":282}],282:[function(n,t){"use strict";var r=function(n,t,i){var r,u;for(i=i||128,this.unitID=n,this._memPool=t,this._data=new Uint16Array(2),this._data[0]=0,this._data[1]=0,this._contentNum=i,this._signData=new Uint16Array(2*this._contentNum),this._spacesData=[],r=0;r<i;r++)u=2*r,this._signData[u+0]=r+1,this._signData[u+1]=0,this._spacesData[r]={index:r,unitID:n};this._signData[2*(i-1)]=65535},i=r.prototype;i.hasSpace=function(){return 65535!==this._data[0]};i.isAllFree=function(){return 0==this._data[1]};i.pop=function(){var n=this._data[0];if(65535===n)return null;var t=n,i=2*t,r=this._spacesData[t];return this._signData[i+1]=1,this._data[0]=this._signData[i+0],this._data[1]++,r};i.push=function(n){var t=2*n;this._signData[t+1]=0;this._signData[t+0]=this._data[0];this._data[0]=n;this._data[1]--};i.dump=function(){for(var u,t=0,i=this._data[0],f="";65535!=i;)t++,f+=i+"->",i=this._signData[2*i+0];for(var n=0,e="",o=this._contentNum,r=0;r<o;r++)1==this._signData[2*r+1]&&(n++,e+=r+"->");u=t+n;console.log("unitID:",this.unitID,"spaceNum:",t,"calc using num:",n,"store using num:",this._data[1],"calc total num:",u,"actually total num:",this._contentNum);console.log("free info:",f);console.log("using info:",e);n!=this._data[1]&&cc.error("using num error","calc using num:",n,"store using num:",this._data[1]);t+n!=this._contentNum&&cc.error("total num error","calc total num:",u,"actually total num:",this._contentNum)};t.exports=r},{}],283:[function(n,t,i){"use strict";function f(n){return n&&n.__esModule?n:{"default":n}}function e(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}function o(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}var r;i.__esModule=!0;i.default=void 0;var s=f(n("./value-type")),h=f(n("../platform/CCClass")),u=f(n("../utils/misc"));r=function(n){function t(t,i,r,u){var f;return void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===u&&(u=255),(f=n.call(this)||this)._val=0,"object"==typeof t&&(i=t.g,r=t.b,u=t.a,t=t.r),f._val=(u<<24>>>0)+(r<<16)+(i<<8)+(0|t),f}var r,f,i;return f=n,(r=t).prototype=Object.create(f.prototype),r.prototype.constructor=r,r.__proto__=f,t.copy=function(n,t){return n.r=t.r,n.g=t.g,n.b=t.b,n.a=t.a,n},t.clone=function(n){return new t(n.r,n.g,n.b,n.a)},t.set=function(n,t,i,r,u){return void 0===t&&(t=255),void 0===i&&(i=255),void 0===r&&(r=255),void 0===u&&(u=255),n.r=t,n.g=i,n.b=r,n.a=u,n},t.fromHex=function(n,t){var i=(t>>24)/255,r=(t>>16&255)/255,u=(t>>8&255)/255,f=(255&t)/255;return n.r=i,n.g=r,n.b=u,n.a=f,n},t.fromHEX=function(n,t){return t=0===t.indexOf("#")?t.substring(1):t,n.r=parseInt(t.substr(0,2),16)||0,n.g=parseInt(t.substr(2,2),16)||0,n.b=parseInt(t.substr(4,2),16)||0,n.a=parseInt(t.substr(6,2),16)||255,n._val=(n.a<<24>>>0)+(n.b<<16)+(n.g<<8)+n.r,n},t.add=function(n,t,i){return n.r=t.r+i.r,n.g=t.g+i.g,n.b=t.b+i.b,n.a=t.a+i.a,n},t.subtract=function(n,t,i){return n.r=t.r-i.r,n.g=t.g-i.g,n.b=t.b-i.b,n.a=t.a-i.a,n},t.multiply=function(n,t,i){return n.r=t.r*i.r,n.g=t.g*i.g,n.b=t.b*i.b,n.a=t.a*i.a,n},t.divide=function(n,t,i){return n.r=t.r/i.r,n.g=t.g/i.g,n.b=t.b/i.b,n.a=t.a/i.a,n},t.scale=function(n,t,i){return n.r=t.r*i,n.g=t.g*i,n.b=t.b*i,n.a=t.a*i,n},t.lerp=function(n,t,i,r){var u=t.r,f=t.g,e=t.b,o=t.a;return n.r=u+r*(i.r-u),n.g=f+r*(i.g-f),n.b=e+r*(i.b-e),n.a=o+r*(i.a-o),n},t.toArray=function(n,i,r){void 0===r&&(r=0);var u=i instanceof t||i.a>1?1/255:1;return n[r+0]=i.r*u,n[r+1]=i.g*u,n[r+2]=i.b*u,n[r+3]=i.a*u,n},t.fromArray=function(n,t,i){return void 0===i&&(i=0),t.r=255*n[i+0],t.g=255*n[i+1],t.b=255*n[i+2],t.a=255*n[i+3],t},t.premultiplyAlpha=function(n,t){var i=t.a/255;return n.r=t.r*i,n.g=t.g*i,n.b=t.b*i,n._fastSetA(t.a),n},o(t,null,[{key:"WHITE",get:function(){return new t(255,255,255,255)}},{key:"BLACK",get:function(){return new t(0,0,0,255)}},{key:"TRANSPARENT",get:function(){return new t(0,0,0,0)}},{key:"GRAY",get:function(){return new t(127.5,127.5,127.5)}},{key:"RED",get:function(){return new t(255,0,0)}},{key:"GREEN",get:function(){return new t(0,255,0)}},{key:"BLUE",get:function(){return new t(0,0,255)}},{key:"YELLOW",get:function(){return new t(255,235,4)}},{key:"ORANGE",get:function(){return new t(255,127,0)}},{key:"CYAN",get:function(){return new t(0,255,255)}},{key:"MAGENTA",get:function(){return new t(255,0,255)}}]),i=t.prototype,i.clone=function(){var n=new t;return n._val=this._val,n},i.equals=function(n){return n&&this._val===n._val},i.lerp=function(n,i,r){r=r||new t;var u=this.r,f=this.g,e=this.b,o=this.a;return r.r=u+(n.r-u)*i,r.g=f+(n.g-f)*i,r.b=e+(n.b-e)*i,r.a=o+(n.a-o)*i,r},i.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},i.getR=function(){return 255&this._val},i.setR=function(n){return n=~~u.default.clampf(n,0,255),this._val=(4294967040&this._val|n)>>>0,this},i.getG=function(){return(65280&this._val)>>8},i.setG=function(n){return n=~~u.default.clampf(n,0,255),this._val=(4294902015&this._val|n<<8)>>>0,this},i.getB=function(){return(16711680&this._val)>>16},i.setB=function(n){return n=~~u.default.clampf(n,0,255),this._val=(4278255615&this._val|n<<16)>>>0,this},i.getA=function(){return(4278190080&this._val)>>>24},i.setA=function(n){return n=~~u.default.clampf(n,0,255),this._val=(16777215&this._val|n<<24)>>>0,this},i.toCSS=function(n){return n&&"rgba"!==n?"rgb"===n?"rgb("+this.r+","+this.g+","+this.b+")":"#"+this.toHEX(n):"rgba("+this.r+","+this.g+","+this.b+","+(this.a/255).toFixed(2)+")"},i.fromHEX=function(n){n=0===n.indexOf("#")?n.substring(1):n;var t=parseInt(n.substr(0,2),16)||0,i=parseInt(n.substr(2,2),16)||0,r=parseInt(n.substr(4,2),16)||0,u=parseInt(n.substr(6,2),16)||255;return this._val=(u<<24>>>0)+(r<<16)+(i<<8)+t,this},i.toHEX=function(n){var t=[(this.r<16?"0":"")+this.r.toString(16),(this.g<16?"0":"")+this.g.toString(16),(this.b<16?"0":"")+this.b.toString(16)];return"#rgb"===n?(t[0]=t[0][0],t[1]=t[1][0],t[2]=t[2][0]):"#rrggbbaa"===n&&t.push((this.a<16?"0":"")+this.a.toString(16)),t.join("")},i.toRGBValue=function(){return 16777215&this._val},i.fromHSV=function(n,t,i){var r,u,f;if(0===t)r=u=f=i;else if(0===i)r=u=f=0;else{1===n&&(n=0);n*=6;var h=Math.floor(n),c=n-h,e=i*(1-t),o=i*(1-t*c),s=i*(1-t*(1-c));switch(h){case 0:r=i;u=s;f=e;break;case 1:r=o;u=i;f=e;break;case 2:r=e;u=i;f=s;break;case 3:r=e;u=o;f=i;break;case 4:r=s;u=e;f=i;break;case 5:r=i;u=e;f=o}}return r*=255,u*=255,f*=255,this._val=(this.a<<24>>>0)+(f<<16)+(u<<8)+(0|r),this},i.toHSV=function(){var i=this.r/255,r=this.g/255,u=this.b/255,n={h:0,s:0,v:0},t=Math.max(i,r,u),e=Math.min(i,r,u),f=0;return n.v=t,n.s=t?(t-e)/t:0,n.s?(f=t-e,n.h=i===t?(r-u)/f:r===t?2+(u-i)/f:4+(i-r)/f,n.h/=6,n.h<0&&(n.h+=1)):n.h=0,n},i.set=function(n){return n._val?this._val=n._val:(this.r=n.r,this.g=n.g,this.b=n.b,this.a=n.a),this},i._fastSetA=function(n){this._val=(16777215&this._val|n<<24)>>>0},i.multiply=function(n){var t=(255&this._val)*n.r>>8,i=(65280&this._val)*n.g>>8,r=(16711680&this._val)*n.b>>8,u=((4278190080&this._val)>>>8)*n.a;return this._val=4278190080&u|16711680&r|65280&i|255&t,this},o(t,[{key:"r",get:function(){return this.getR()},set:function(n){this.setR(n)}},{key:"g",get:function(){return this.getG()},set:function(n){this.setG(n)}},{key:"b",get:function(){return this.getB()},set:function(n){this.setB(n)}},{key:"a",get:function(){return this.getA()},set:function(n){this.setA(n)}}]),t}(s.default);i.default=r;r.div=r.divide;r.sub=r.subtract;r.mul=r.multiply;r.WHITE_R=r.WHITE;r.BLACK_R=r.BLACK;r.TRANSPARENT_R=r.TRANSPARENT;r.GRAY_R=r.GRAY;r.RED_R=r.RED;r.GREEN_R=r.GREEN;r.BLUE_R=r.BLUE;r.YELLOW_R=r.YELLOW;r.ORANGE_R=r.ORANGE;r.CYAN_R=r.CYAN;r.MAGENTA_R=r.MAGENTA;h.default.fastDefine("cc.Color",r,{r:0,g:0,b:0,a:255});cc.Color=r;cc.color=function(n,t,i,u){return"string"==typeof n?(new r).fromHEX(n):"object"==typeof n?new r(n.r,n.g,n.b,n.a):new r(n,t,i,u)};t.exports=i.default},{"../platform/CCClass":195,"../utils/misc":269,"./value-type":292}],284:[function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}var f,e,o,s,h,c,l,a,v,y,p,u;i.__esModule=!0;f={Vec2:!0,Vec3:!0,Vec4:!0,Mat4:!0,Mat3:!0,Rect:!0,Size:!0,Color:!0,Quat:!0,Trs:!0};i.Trs=i.Quat=i.Color=i.Size=i.Rect=i.Mat3=i.Mat4=i.Vec4=i.Vec3=i.Vec2=void 0;e=r(n("./vec2"));i.Vec2=e.default;o=r(n("./vec3"));i.Vec3=o.default;s=r(n("./vec4"));i.Vec4=s.default;h=r(n("./mat4"));i.Mat4=h.default;c=r(n("./mat3"));i.Mat3=c.default;l=r(n("./rect"));i.Rect=l.default;a=r(n("./size"));i.Size=a.default;v=r(n("./color"));i.Color=v.default;y=r(n("./quat"));i.Quat=y.default;p=r(n("./trs"));i.Trs=p.default;u=n("./utils");Object.keys(u).forEach(function(n){"default"!==n&&"__esModule"!==n&&(Object.prototype.hasOwnProperty.call(f,n)||n in i&&i[n]===u[n]||(i[n]=u[n]))});cc.math=t.exports},{"./color":283,"./mat3":285,"./mat4":286,"./quat":287,"./rect":288,"./size":289,"./trs":290,"./utils":291,"./vec2":293,"./vec3":294,"./vec4":295}],285:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var e,r=n("../value-types/utils"),u=(e=n("./vec3"))&&e.__esModule?e:{"default":e},f=function(){function n(n,t,i,u,f,e,o,s,h){if(void 0===n&&(n=1),void 0===t&&(t=0),void 0===i&&(i=0),void 0===u&&(u=0),void 0===f&&(f=1),void 0===e&&(e=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===h&&(h=1),this.m=void 0,n instanceof r.FLOAT_ARRAY_TYPE)this.m=n;else{this.m=new r.FLOAT_ARRAY_TYPE(9);var c=this.m;c[0]=n;c[1]=t;c[2]=i;c[3]=u;c[4]=f;c[5]=e;c[6]=o;c[7]=s;c[8]=h}}return n.create=function(t,i,r,u,f,e,o,s,h){return void 0===t&&(t=1),void 0===i&&(i=0),void 0===r&&(r=0),void 0===u&&(u=0),void 0===f&&(f=1),void 0===e&&(e=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===h&&(h=1),new n(t,i,r,u,f,e,o,s,h)},n.clone=function(t){var i=t.m;return new n(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8])},n.copy=function(n,t){return n.m.set(t.m),n},n.set=function(n,t,i,r,u,f,e,o,s,h){var c=n.m;return c[0]=t,c[1]=i,c[2]=r,c[3]=u,c[4]=f,c[5]=e,c[6]=o,c[7]=s,c[8]=h,n},n.identity=function(n){var t=n.m;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,n},n.transpose=function(n,t){var i=t.m,r=n.m;if(n===t){var u=i[1],f=i[2],e=i[5];r[1]=i[3];r[2]=i[6];r[3]=u;r[5]=i[7];r[6]=f;r[7]=e}else r[0]=i[0],r[1]=i[3],r[2]=i[6],r[3]=i[1],r[4]=i[4],r[5]=i[7],r[6]=i[2],r[7]=i[5],r[8]=i[8];return n},n.invert=function(n,t){var r=t.m,u=n.m,f=r[0],e=r[1],o=r[2],s=r[3],h=r[4],c=r[5],l=r[6],a=r[7],v=r[8],y=v*h-c*a,p=-v*s+c*l,w=a*s-h*l,i=f*y+e*p+o*w;return i?(i=1/i,u[0]=y*i,u[1]=(-v*e+o*a)*i,u[2]=(c*e-o*h)*i,u[3]=p*i,u[4]=(v*f-o*l)*i,u[5]=(-c*f+o*s)*i,u[6]=w*i,u[7]=(-a*f+e*l)*i,u[8]=(h*f-e*s)*i,n):n},n.adjoint=function(n,t){var i=t.m,r=n.m,u=i[0],f=i[1],e=i[2],o=i[3],s=i[4],h=i[5],c=i[6],l=i[7],a=i[8];return r[0]=s*a-h*l,r[1]=e*l-f*a,r[2]=f*h-e*s,r[3]=h*c-o*a,r[4]=u*a-e*c,r[5]=e*o-u*h,r[6]=o*l-s*c,r[7]=f*c-u*l,r[8]=u*s-f*o,n},n.determinant=function(n){var t=n.m,s=t[0],h=t[1],c=t[2],i=t[3],r=t[4],u=t[5],f=t[6],e=t[7],o=t[8];return s*(o*r-u*e)+h*(-o*i+u*f)+c*(e*i-r*f)},n.multiply=function(n,t,i){var r=t.m,u=i.m,f=n.m,e=r[0],o=r[1],s=r[2],h=r[3],c=r[4],l=r[5],a=r[6],v=r[7],y=r[8],p=u[0],w=u[1],b=u[2],k=u[3],d=u[4],g=u[5],nt=u[6],tt=u[7],it=u[8];return f[0]=p*e+w*h+b*a,f[1]=p*o+w*c+b*v,f[2]=p*s+w*l+b*y,f[3]=k*e+d*h+g*a,f[4]=k*o+d*c+g*v,f[5]=k*s+d*l+g*y,f[6]=nt*e+tt*h+it*a,f[7]=nt*o+tt*c+it*v,f[8]=nt*s+tt*l+it*y,n},n.multiplyMat4=function(n,t,i){var r=t.m,u=i.m,f=n.m,e=r[0],o=r[1],s=r[2],h=r[3],c=r[4],l=r[5],a=r[6],v=r[7],y=r[8],p=u[0],w=u[1],b=u[2],k=u[4],d=u[5],g=u[6],nt=u[8],tt=u[9],it=u[10];return f[0]=p*e+w*h+b*a,f[1]=p*o+w*c+b*v,f[2]=p*s+w*l+b*y,f[3]=k*e+d*h+g*a,f[4]=k*o+d*c+g*v,f[5]=k*s+d*l+g*y,f[6]=nt*e+tt*h+it*a,f[7]=nt*o+tt*c+it*v,f[8]=nt*s+tt*l+it*y,n},n.translate=function(n,t,i){var r=t.m,u=n.m,o=r[0],s=r[1],h=r[2],c=r[3],l=r[4],a=r[5],v=r[6],y=r[7],p=r[8],f=i.x,e=i.y;return u[0]=o,u[1]=s,u[2]=h,u[3]=c,u[4]=l,u[5]=a,u[6]=f*o+e*c+v,u[7]=f*s+e*l+y,u[8]=f*h+e*a+p,n},n.rotate=function(n,t,i){var r=t.m,u=n.m,o=r[0],s=r[1],h=r[2],c=r[3],l=r[4],a=r[5],v=r[6],y=r[7],p=r[8],f=Math.sin(i),e=Math.cos(i);return u[0]=e*o+f*c,u[1]=e*s+f*l,u[2]=e*h+f*a,u[3]=e*c-f*o,u[4]=e*l-f*s,u[5]=e*a-f*h,u[6]=v,u[7]=y,u[8]=p,n},n.scale=function(n,t,i){var f=i.x,e=i.y,r=t.m,u=n.m;return u[0]=f*r[0],u[1]=f*r[1],u[2]=f*r[2],u[3]=e*r[3],u[4]=e*r[4],u[5]=e*r[5],u[6]=r[6],u[7]=r[7],u[8]=r[8],n},n.fromMat4=function(n,t){var i=t.m,r=n.m;return r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[4],r[4]=i[5],r[5]=i[6],r[6]=i[8],r[7]=i[9],r[8]=i[10],n},n.fromTranslation=function(n,t){var i=n.m;return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=t.x,i[7]=t.y,i[8]=1,n},n.fromRotation=function(n,t){var r=Math.sin(t),u=Math.cos(t),i=n.m;return i[0]=u,i[1]=r,i[2]=0,i[3]=-r,i[4]=u,i[5]=0,i[6]=0,i[7]=0,i[8]=1,n},n.fromScaling=function(n,t){var i=n.m;return i[0]=t.x,i[1]=0,i[2]=0,i[3]=0,i[4]=t.y,i[5]=0,i[6]=0,i[7]=0,i[8]=1,n},n.fromQuat=function(n,t){var i=n.m,e=t.x,u=t.y,r=t.z,o=t.w,f=e+e,s=u+u,h=r+r,c=e*f,l=u*f,a=u*s,v=r*f,y=r*s,p=r*h,w=o*f,b=o*s,k=o*h;return i[0]=1-a-p,i[3]=l-k,i[6]=v+b,i[1]=l+k,i[4]=1-c-p,i[7]=y-w,i[2]=v-b,i[5]=y+w,i[8]=1-c-a,n},n.fromViewUp=function(t,i,f){var s,e,o;return(s=new u.default(0,1,0),e=new u.default,o=new u.default,function(t,i,f){return u.default.lengthSqr(i)<r.EPSILON*r.EPSILON?(n.identity(t),t):(f=f||s,u.default.normalize(e,u.default.cross(e,f,i)),u.default.lengthSqr(e)<r.EPSILON*r.EPSILON?(n.identity(t),t):(u.default.cross(o,i,e),n.set(t,e.x,e.y,e.z,o.x,o.y,o.z,i.x,i.y,i.z),t))})(t,i,f)},n.normalFromMat4=function(n,t){var i=t.m,u=n.m,s=i[0],h=i[1],c=i[2],f=i[3],l=i[4],a=i[5],v=i[6],e=i[7],g=i[8],nt=i[9],tt=i[10],it=i[11],y=i[12],p=i[13],w=i[14],o=i[15],ht=s*a-h*l,ct=s*v-c*l,rt=s*e-f*l,lt=h*v-c*a,ut=h*e-f*a,ft=c*e-f*v,et=g*p-nt*y,ot=g*w-tt*y,b=g*o-it*y,st=nt*w-tt*p,k=nt*o-it*p,d=tt*o-it*w,r=ht*d-ct*k+rt*st+lt*b-ut*ot+ft*et;return r?(r=1/r,u[0]=(a*d-v*k+e*st)*r,u[1]=(v*b-l*d-e*ot)*r,u[2]=(l*k-a*b+e*et)*r,u[3]=(c*k-h*d-f*st)*r,u[4]=(s*d-c*b+f*ot)*r,u[5]=(h*b-s*k-f*et)*r,u[6]=(p*ft-w*ut+o*lt)*r,u[7]=(w*rt-y*ft-o*ct)*r,u[8]=(y*ut-p*rt+o*ht)*r,n):n},n.frob=function(n){var t=n.m;return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},n.add=function(n,t,i){var r=t.m,u=i.m,f=n.m;return f[0]=r[0]+u[0],f[1]=r[1]+u[1],f[2]=r[2]+u[2],f[3]=r[3]+u[3],f[4]=r[4]+u[4],f[5]=r[5]+u[5],f[6]=r[6]+u[6],f[7]=r[7]+u[7],f[8]=r[8]+u[8],n},n.subtract=function(n,t,i){var r=t.m,u=i.m,f=n.m;return f[0]=r[0]-u[0],f[1]=r[1]-u[1],f[2]=r[2]-u[2],f[3]=r[3]-u[3],f[4]=r[4]-u[4],f[5]=r[5]-u[5],f[6]=r[6]-u[6],f[7]=r[7]-u[7],f[8]=r[8]-u[8],n},n.multiplyScalar=function(n,t,i){var r=t.m,u=n.m;return u[0]=r[0]*i,u[1]=r[1]*i,u[2]=r[2]*i,u[3]=r[3]*i,u[4]=r[4]*i,u[5]=r[5]*i,u[6]=r[6]*i,u[7]=r[7]*i,u[8]=r[8]*i,n},n.multiplyScalarAndAdd=function(n,t,i,r){var u=t.m,f=i.m,e=n.m;return e[0]=u[0]+f[0]*r,e[1]=u[1]+f[1]*r,e[2]=u[2]+f[2]*r,e[3]=u[3]+f[3]*r,e[4]=u[4]+f[4]*r,e[5]=u[5]+f[5]*r,e[6]=u[6]+f[6]*r,e[7]=u[7]+f[7]*r,e[8]=u[8]+f[8]*r,n},n.exactEquals=function(n,t){var i=n.m,r=t.m;return i[0]===r[0]&&i[1]===r[1]&&i[2]===r[2]&&i[3]===r[3]&&i[4]===r[4]&&i[5]===r[5]&&i[6]===r[6]&&i[7]===r[7]&&i[8]===r[8]},n.equals=function(n,t){var i=n.m,u=t.m,f=i[0],e=i[1],o=i[2],s=i[3],h=i[4],c=i[5],l=i[6],a=i[7],v=i[8],y=u[0],p=u[1],w=u[2],b=u[3],k=u[4],d=u[5],g=u[6],nt=u[7],tt=u[8];return Math.abs(f-y)<=r.EPSILON*Math.max(1,Math.abs(f),Math.abs(y))&&Math.abs(e-p)<=r.EPSILON*Math.max(1,Math.abs(e),Math.abs(p))&&Math.abs(o-w)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(s-b)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(h-k)<=r.EPSILON*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(c-d)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(d))&&Math.abs(l-g)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(a-nt)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(nt))&&Math.abs(v-tt)<=r.EPSILON*Math.max(1,Math.abs(v),Math.abs(tt))},n.toArray=function(n,t,i){void 0===i&&(i=0);for(var u=t.m,r=0;r<9;r++)n[i+r]=u[r];return n},n.fromArray=function(n,t,i){void 0===i&&(i=0);for(var u=n.m,r=0;r<9;r++)u[r]=t[i+r];return n},n.prototype.toString=function(){var n=this.m;return"mat3("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+")"},n}();i.default=f;f.sub=f.subtract;f.mul=f.multiply;f.IDENTITY=Object.freeze(new f);cc.Mat3=f;t.exports=i.default},{"../value-types/utils":291,"./vec3":294}],286:[function(n,t,i){"use strict";function it(n){return n&&n.__esModule?n:{"default":n}}var rt,nt,ot,ut;i.__esModule=!0;i.default=void 0;var st=it(n("./value-type")),ht=it(n("../platform/CCClass")),g=it(n("./vec3")),et=it(n("./quat")),tt=n("./utils"),ft=it(n("./mat3"));var f=0,e=0,o=0,r=0,s=0,h=0,c=0,u=0,l=0,a=0,v=0,y=0,w=0,b=0,k=0,p=0,d=function(n){function t(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){var k,b;return(void 0===t&&(t=1),void 0===i&&(i=0),void 0===r&&(r=0),void 0===u&&(u=0),void 0===f&&(f=0),void 0===e&&(e=1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===h&&(h=0),void 0===c&&(c=0),void 0===l&&(l=1),void 0===a&&(a=0),void 0===v&&(v=0),void 0===y&&(y=0),void 0===p&&(p=0),void 0===w&&(w=1),(k=n.call(this)||this).m=void 0,t instanceof tt.FLOAT_ARRAY_TYPE)?k.m=t:(k.m=new tt.FLOAT_ARRAY_TYPE(16),b=k.m,b[0]=t,b[1]=i,b[2]=r,b[3]=u,b[4]=f,b[5]=e,b[6]=o,b[7]=s,b[8]=h,b[9]=c,b[10]=l,b[11]=a,b[12]=v,b[13]=y,b[14]=p,b[15]=w),k}var d,it,i;return it=n,(d=t).prototype=Object.create(it.prototype),d.prototype.constructor=d,d.__proto__=it,i=t.prototype,i.mul=function(n,i){return t.multiply(i||new t,this,n)},i.mulScalar=function(n,i){t.multiplyScalar(i||new t,this,n)},i.sub=function(n,i){t.subtract(i||new t,this,n)},t.clone=function(n){var i=n.m;return new t(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])},t.copy=function(n,t){var i=n.m,r=t.m;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],n},t.set=function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){var b=n.m;return b[0]=t,b[1]=i,b[2]=r,b[3]=u,b[4]=f,b[5]=e,b[6]=o,b[7]=s,b[8]=h,b[9]=c,b[10]=l,b[11]=a,b[12]=v,b[13]=y,b[14]=p,b[15]=w,n},t.identity=function(n){var t=n.m;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,n},t.transpose=function(n,t){var i=n.m,r=t.m;if(n===t){var u=r[1],f=r[2],e=r[3],o=r[6],s=r[7],h=r[11];i[1]=r[4];i[2]=r[8];i[3]=r[12];i[4]=u;i[6]=r[9];i[7]=r[13];i[8]=f;i[9]=o;i[11]=r[14];i[12]=e;i[13]=s;i[14]=h}else i[0]=r[0],i[1]=r[4],i[2]=r[8],i[3]=r[12],i[4]=r[1],i[5]=r[5],i[6]=r[9],i[7]=r[13],i[8]=r[2],i[9]=r[6],i[10]=r[10],i[11]=r[14],i[12]=r[3],i[13]=r[7],i[14]=r[11],i[15]=r[15];return n},t.invert=function(n,t){var g=t.m,d;f=g[0];e=g[1];o=g[2];r=g[3];s=g[4];h=g[5];c=g[6];u=g[7];l=g[8];a=g[9];v=g[10];y=g[11];w=g[12];b=g[13];k=g[14];p=g[15];var nt=f*h-e*s,tt=f*c-o*s,it=f*u-r*s,rt=e*c-o*h,ut=e*u-r*h,ft=o*u-r*c,et=l*b-a*w,ot=l*k-v*w,st=l*p-y*w,ht=a*k-v*b,ct=a*p-y*b,lt=v*p-y*k,i=nt*lt-tt*ct+it*ht+rt*st-ut*ot+ft*et;return 0===i?null:(i=1/i,d=n.m,d[0]=(h*lt-c*ct+u*ht)*i,d[1]=(o*ct-e*lt-r*ht)*i,d[2]=(b*ft-k*ut+p*rt)*i,d[3]=(v*ut-a*ft-y*rt)*i,d[4]=(c*st-s*lt-u*ot)*i,d[5]=(f*lt-o*st+r*ot)*i,d[6]=(k*it-w*ft-p*tt)*i,d[7]=(l*ft-v*it+y*tt)*i,d[8]=(s*ct-h*st+u*et)*i,d[9]=(e*st-f*ct-r*et)*i,d[10]=(w*ut-b*it+p*nt)*i,d[11]=(a*it-l*ut-y*nt)*i,d[12]=(h*ot-s*ht-c*et)*i,d[13]=(f*ht-e*ot+o*et)*i,d[14]=(b*tt-w*rt-k*nt)*i,d[15]=(l*rt-a*tt+v*nt)*i,n)},t.determinant=function(n){var t=n.m;return f=t[0],e=t[1],o=t[2],r=t[3],s=t[4],h=t[5],c=t[6],u=t[7],l=t[8],a=t[9],v=t[10],y=t[11],w=t[12],b=t[13],k=t[14],p=t[15],(f*h-e*s)*(v*p-y*k)-(f*c-o*s)*(a*p-y*b)+(f*u-r*s)*(a*k-v*b)+(e*c-o*h)*(l*p-y*w)-(e*u-r*h)*(l*k-v*w)+(o*u-r*c)*(l*b-a*w)},t.multiply=function(n,t,i){var it=n.m,rt=t.m,ut=i.m;f=rt[0];e=rt[1];o=rt[2];r=rt[3];s=rt[4];h=rt[5];c=rt[6];u=rt[7];l=rt[8];a=rt[9];v=rt[10];y=rt[11];w=rt[12];b=rt[13];k=rt[14];p=rt[15];var d=ut[0],g=ut[1],nt=ut[2],tt=ut[3];return it[0]=d*f+g*s+nt*l+tt*w,it[1]=d*e+g*h+nt*a+tt*b,it[2]=d*o+g*c+nt*v+tt*k,it[3]=d*r+g*u+nt*y+tt*p,d=ut[4],g=ut[5],nt=ut[6],tt=ut[7],it[4]=d*f+g*s+nt*l+tt*w,it[5]=d*e+g*h+nt*a+tt*b,it[6]=d*o+g*c+nt*v+tt*k,it[7]=d*r+g*u+nt*y+tt*p,d=ut[8],g=ut[9],nt=ut[10],tt=ut[11],it[8]=d*f+g*s+nt*l+tt*w,it[9]=d*e+g*h+nt*a+tt*b,it[10]=d*o+g*c+nt*v+tt*k,it[11]=d*r+g*u+nt*y+tt*p,d=ut[12],g=ut[13],nt=ut[14],tt=ut[15],it[12]=d*f+g*s+nt*l+tt*w,it[13]=d*e+g*h+nt*a+tt*b,it[14]=d*o+g*c+nt*v+tt*k,it[15]=d*r+g*u+nt*y+tt*p,n},t.transform=function(n,t,i){var nt=i.x,tt=i.y,it=i.z,g=n.m,d=t.m;return t===n?(g[12]=d[0]*nt+d[4]*tt+d[8]*it+d[12],g[13]=d[1]*nt+d[5]*tt+d[9]*it+d[13],g[14]=d[2]*nt+d[6]*tt+d[10]*it+d[14],g[15]=d[3]*nt+d[7]*tt+d[11]*it+d[15]):(f=d[0],e=d[1],o=d[2],r=d[3],s=d[4],h=d[5],c=d[6],u=d[7],l=d[8],a=d[9],v=d[10],y=d[11],w=d[12],b=d[13],k=d[14],p=d[15],g[0]=f,g[1]=e,g[2]=o,g[3]=r,g[4]=s,g[5]=h,g[6]=c,g[7]=u,g[8]=l,g[9]=a,g[10]=v,g[11]=y,g[12]=f*nt+s*tt+l*it+d[12],g[13]=e*nt+h*tt+a*it+d[13],g[14]=o*nt+c*tt+v*it+d[14],g[15]=r*nt+u*tt+y*it+d[15]),n},t.translate=function(n,t,i){var r=n.m,u=t.m;return t===n?(r[12]+=i.x,r[13]+=i.y,r[14]+=i.z):(r[0]=u[0],r[1]=u[1],r[2]=u[2],r[3]=u[3],r[4]=u[4],r[5]=u[5],r[6]=u[6],r[7]=u[7],r[8]=u[8],r[9]=u[9],r[10]=u[10],r[11]=u[11],r[12]+=i.x,r[13]+=i.y,r[14]+=i.z,r[15]=u[15]),n},t.scale=function(n,t,i){var f=i.x,e=i.y,o=i.z,r=n.m,u=t.m;return r[0]=u[0]*f,r[1]=u[1]*f,r[2]=u[2]*f,r[3]=u[3]*f,r[4]=u[4]*e,r[5]=u[5]*e,r[6]=u[6]*e,r[7]=u[7]*e,r[8]=u[8]*o,r[9]=u[9]*o,r[10]=u[10]*o,r[11]=u[11]*o,r[12]=u[12],r[13]=u[13],r[14]=u[14],r[15]=u[15],n},t.rotate=function(n,t,i,p){var k=p.x,d=p.y,g=p.z,rt=Math.sqrt(k*k+d*d+g*g);if(Math.abs(rt)<tt.EPSILON)return null;k*=rt=1/rt;d*=rt;g*=rt;var it=Math.sin(i),ut=Math.cos(i),nt=1-ut,w=t.m;f=w[0];e=w[1];o=w[2];r=w[3];s=w[4];h=w[5];c=w[6];u=w[7];l=w[8];a=w[9];v=w[10];y=w[11];var ft=k*k*nt+ut,et=d*k*nt+g*it,ot=g*k*nt-d*it,st=k*d*nt-g*it,ht=d*d*nt+ut,ct=g*d*nt+k*it,lt=k*g*nt+d*it,at=d*g*nt-k*it,vt=g*g*nt+ut,b=n.m;return b[0]=f*ft+s*et+l*ot,b[1]=e*ft+h*et+a*ot,b[2]=o*ft+c*et+v*ot,b[3]=r*ft+u*et+y*ot,b[4]=f*st+s*ht+l*ct,b[5]=e*st+h*ht+a*ct,b[6]=o*st+c*ht+v*ct,b[7]=r*st+u*ht+y*ct,b[8]=f*lt+s*at+l*vt,b[9]=e*lt+h*at+a*vt,b[10]=o*lt+c*at+v*vt,b[11]=r*lt+u*at+y*vt,t!==n&&(b[12]=w[12],b[13]=w[13],b[14]=w[14],b[15]=w[15]),n},t.rotateX=function(n,t,i){var r=n.m,u=t.m,f=Math.sin(i),e=Math.cos(i),o=u[4],s=u[5],h=u[6],c=u[7],l=u[8],a=u[9],v=u[10],y=u[11];return t!==n&&(r[0]=u[0],r[1]=u[1],r[2]=u[2],r[3]=u[3],r[12]=u[12],r[13]=u[13],r[14]=u[14],r[15]=u[15]),r[4]=o*e+l*f,r[5]=s*e+a*f,r[6]=h*e+v*f,r[7]=c*e+y*f,r[8]=l*e-o*f,r[9]=a*e-s*f,r[10]=v*e-h*f,r[11]=y*e-c*f,n},t.rotateY=function(n,t,i){var r=n.m,u=t.m,f=Math.sin(i),e=Math.cos(i),o=u[0],s=u[1],h=u[2],c=u[3],l=u[8],a=u[9],v=u[10],y=u[11];return t!==n&&(r[4]=u[4],r[5]=u[5],r[6]=u[6],r[7]=u[7],r[12]=u[12],r[13]=u[13],r[14]=u[14],r[15]=u[15]),r[0]=o*e-l*f,r[1]=s*e-a*f,r[2]=h*e-v*f,r[3]=c*e-y*f,r[8]=o*f+l*e,r[9]=s*f+a*e,r[10]=h*f+v*e,r[11]=c*f+y*e,n},t.rotateZ=function(n,t,i){var u=t.m,r=n.m,f=Math.sin(i),e=Math.cos(i),o=t.m[0],s=t.m[1],h=t.m[2],c=t.m[3],l=t.m[4],a=t.m[5],v=t.m[6],y=t.m[7];return t!==n&&(r[8]=u[8],r[9]=u[9],r[10]=u[10],r[11]=u[11],r[12]=u[12],r[13]=u[13],r[14]=u[14],r[15]=u[15]),r[0]=o*e+l*f,r[1]=s*e+a*f,r[2]=h*e+v*f,r[3]=c*e+y*f,r[4]=l*e-o*f,r[5]=a*e-s*f,r[6]=v*e-h*f,r[7]=y*e-c*f,n},t.fromTranslation=function(n,t){var i=n.m;return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,n},t.fromScaling=function(n,t){var i=n.m;return i[0]=t.x,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t.y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t.z,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,n},t.fromRotation=function(n,t,i){var u=i.x,f=i.y,e=i.z,h=Math.sqrt(u*u+f*f+e*e);if(Math.abs(h)<tt.EPSILON)return null;u*=h=1/h;f*=h;e*=h;var s=Math.sin(t),c=Math.cos(t),o=1-c,r=n.m;return r[0]=u*u*o+c,r[1]=f*u*o+e*s,r[2]=e*u*o-f*s,r[3]=0,r[4]=u*f*o-e*s,r[5]=f*f*o+c,r[6]=e*f*o+u*s,r[7]=0,r[8]=u*e*o+f*s,r[9]=f*e*o-u*s,r[10]=e*e*o+c,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,n},t.fromXRotation=function(n,t){var r=Math.sin(t),u=Math.cos(t),i=n.m;return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=u,i[6]=r,i[7]=0,i[8]=0,i[9]=-r,i[10]=u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,n},t.fromYRotation=function(n,t){var r=Math.sin(t),u=Math.cos(t),i=n.m;return i[0]=u,i[1]=0,i[2]=-r,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=r,i[9]=0,i[10]=u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,n},t.fromZRotation=function(n,t){var r=Math.sin(t),u=Math.cos(t),i=n.m;return i[0]=u,i[1]=r,i[2]=0,i[3]=0,i[4]=-r,i[5]=u,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,n},t.fromRT=function(n,t,i){var u=t.x,f=t.y,o=t.z,s=t.w,c=u+u,h=f+f,e=o+o,l=u*c,a=u*h,v=u*e,y=f*h,p=f*e,w=o*e,b=s*c,k=s*h,d=s*e,r=n.m;return r[0]=1-(y+w),r[1]=a+d,r[2]=v-k,r[3]=0,r[4]=a-d,r[5]=1-(l+w),r[6]=p+b,r[7]=0,r[8]=v+k,r[9]=p-b,r[10]=1-(l+y),r[11]=0,r[12]=i.x,r[13]=i.y,r[14]=i.z,r[15]=1,n},t.getTranslation=function(n,t){var i=t.m;return n.x=i[12],n.y=i[13],n.z=i[14],n},t.getScaling=function(n,t){var i=t.m,r=nt.m,u=r[0]=i[0],f=r[1]=i[1],e=r[2]=i[2],o=r[3]=i[4],s=r[4]=i[5],h=r[5]=i[6],c=r[6]=i[8],l=r[7]=i[9],a=r[8]=i[10];return n.x=Math.sqrt(u*u+f*f+e*e),n.y=Math.sqrt(o*o+s*s+h*h),n.z=Math.sqrt(c*c+l*l+a*a),ft.default.determinant(nt)<0&&(n.x*=-1),n},t.getRotation=function(n,t){var i=t.m,u=i[0]+i[5]+i[10],r=0;return u>0?(r=2*Math.sqrt(u+1),n.w=.25*r,n.x=(i[6]-i[9])/r,n.y=(i[8]-i[2])/r,n.z=(i[1]-i[4])/r):i[0]>i[5]&&i[0]>i[10]?(r=2*Math.sqrt(1+i[0]-i[5]-i[10]),n.w=(i[6]-i[9])/r,n.x=.25*r,n.y=(i[1]+i[4])/r,n.z=(i[8]+i[2])/r):i[5]>i[10]?(r=2*Math.sqrt(1+i[5]-i[0]-i[10]),n.w=(i[8]-i[2])/r,n.x=(i[1]+i[4])/r,n.y=.25*r,n.z=(i[6]+i[9])/r):(r=2*Math.sqrt(1+i[10]-i[0]-i[5]),n.w=(i[1]-i[4])/r,n.x=(i[8]+i[2])/r,n.y=(i[6]+i[9])/r,n.z=.25*r),n},t.toRTS=function(n,t,i,r){var u=n.m,f=nt.m;r.x=g.default.set(rt,u[0],u[1],u[2]).mag();f[0]=u[0]/r.x;f[1]=u[1]/r.x;f[2]=u[2]/r.x;r.y=g.default.set(rt,u[4],u[5],u[6]).mag();f[3]=u[4]/r.y;f[4]=u[5]/r.y;f[5]=u[6]/r.y;r.z=g.default.set(rt,u[8],u[9],u[10]).mag();f[6]=u[8]/r.z;f[7]=u[9]/r.z;f[8]=u[10]/r.z;ft.default.determinant(nt)<0&&(r.x*=-1,f[0]*=-1,f[1]*=-1,f[2]*=-1);et.default.fromMat3(t,nt);g.default.set(i,u[12],u[13],u[14])},t.fromRTS=function(n,t,i,r){var f=t.x,e=t.y,s=t.z,h=t.w,y=f+f,c=e+e,o=s+s,p=f*y,w=f*c,b=f*o,k=e*c,d=e*o,g=s*o,nt=h*y,tt=h*c,it=h*o,l=r.x,a=r.y,v=r.z,u=n.m;return u[0]=(1-(k+g))*l,u[1]=(w+it)*l,u[2]=(b-tt)*l,u[3]=0,u[4]=(w-it)*a,u[5]=(1-(p+g))*a,u[6]=(d+nt)*a,u[7]=0,u[8]=(b+tt)*v,u[9]=(d-nt)*v,u[10]=(1-(p+k))*v,u[11]=0,u[12]=i.x,u[13]=i.y,u[14]=i.z,u[15]=1,n},t.fromRTSOrigin=function(n,t,i,r,u){var e=t.x,o=t.y,a=t.z,v=t.w,k=e+e,y=o+o,s=a+a,d=e*k,g=e*y,nt=e*s,tt=o*y,it=o*s,rt=a*s,ut=v*k,ft=v*y,et=v*s,p=r.x,w=r.y,b=r.z,h=u.x,c=u.y,l=u.z,f=n.m;return f[0]=(1-(tt+rt))*p,f[1]=(g+et)*p,f[2]=(nt-ft)*p,f[3]=0,f[4]=(g-et)*w,f[5]=(1-(d+rt))*w,f[6]=(it+ut)*w,f[7]=0,f[8]=(nt+ft)*b,f[9]=(it-ut)*b,f[10]=(1-(d+tt))*b,f[11]=0,f[12]=i.x+h-(f[0]*h+f[4]*c+f[8]*l),f[13]=i.y+c-(f[1]*h+f[5]*c+f[9]*l),f[14]=i.z+l-(f[2]*h+f[6]*c+f[10]*l),f[15]=1,n},t.fromQuat=function(n,t){var e=t.x,u=t.y,r=t.z,o=t.w,f=e+e,s=u+u,h=r+r,c=e*f,l=u*f,a=u*s,v=r*f,y=r*s,p=r*h,w=o*f,b=o*s,k=o*h,i=n.m;return i[0]=1-a-p,i[1]=l+k,i[2]=v-b,i[3]=0,i[4]=l-k,i[5]=1-c-p,i[6]=y+w,i[7]=0,i[8]=v+b,i[9]=y-w,i[10]=1-c-a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,n},t.frustum=function(n,t,i,r,u,f,e){var s=1/(i-t),h=1/(u-r),c=1/(f-e),o=n.m;return o[0]=2*f*s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*f*h,o[6]=0,o[7]=0,o[8]=(i+t)*s,o[9]=(u+r)*h,o[10]=(e+f)*c,o[11]=-1,o[12]=0,o[13]=0,o[14]=e*f*2*c,o[15]=0,n},t.perspective=function(n,t,i,r,u){var e=1/Math.tan(t/2),o=1/(r-u),f=n.m;return f[0]=e/i,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=e,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=(u+r)*o,f[11]=-1,f[12]=0,f[13]=0,f[14]=2*u*r*o,f[15]=0,n},t.ortho=function(n,t,i,r,u,f,e){var s=1/(t-i),h=1/(r-u),c=1/(f-e),o=n.m;return o[0]=-2*s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*h,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*c,o[11]=0,o[12]=(t+i)*s,o[13]=(u+r)*h,o[14]=(e+f)*c,o[15]=1,n},t.lookAt=function(n,t,i,r){var a=t.x,v=t.y,y=t.z,p=r.x,w=r.y,b=r.z,f=a-i.x,e=v-i.y,o=y-i.z,s=1/Math.sqrt(f*f+e*e+o*o),h=w*(o*=s)-b*(e*=s),c=b*(f*=s)-p*o,l=p*e-w*f,k=e*(l*=s=1/Math.sqrt(h*h+c*c+l*l))-o*(c*=s),d=o*(h*=s)-f*l,g=f*c-e*h,u=n.m;return u[0]=h,u[1]=k,u[2]=f,u[3]=0,u[4]=c,u[5]=d,u[6]=e,u[7]=0,u[8]=l,u[9]=g,u[10]=o,u[11]=0,u[12]=-(h*a+c*v+l*y),u[13]=-(k*a+d*v+g*y),u[14]=-(f*a+e*v+o*y),u[15]=1,n},t.inverseTranspose=function(n,t){var i=t.m;f=i[0];e=i[1];o=i[2];r=i[3];s=i[4];h=i[5];c=i[6];u=i[7];l=i[8];a=i[9];v=i[10];y=i[11];w=i[12];b=i[13];k=i[14];p=i[15];var st=f*h-e*s,ht=f*c-o*s,it=f*u-r*s,ct=e*c-o*h,rt=e*u-r*h,ut=o*u-r*c,ft=l*b-a*w,et=l*k-v*w,g=l*p-y*w,ot=a*k-v*b,nt=a*p-y*b,tt=v*p-y*k,d=st*tt-ht*nt+it*ot+ct*g-rt*et+ut*ft;return d?(d=1/d,(i=n.m)[0]=(h*tt-c*nt+u*ot)*d,i[1]=(c*g-s*tt-u*et)*d,i[2]=(s*nt-h*g+u*ft)*d,i[3]=0,i[4]=(o*nt-e*tt-r*ot)*d,i[5]=(f*tt-o*g+r*et)*d,i[6]=(e*g-f*nt-r*ft)*d,i[7]=0,i[8]=(b*ut-k*rt+p*ct)*d,i[9]=(k*it-w*ut-p*ht)*d,i[10]=(w*rt-b*it+p*st)*d,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,n):null},t.add=function(n,t,i){var r=n.m,u=t.m,f=i.m;return r[0]=u[0]+f[0],r[1]=u[1]+f[1],r[2]=u[2]+f[2],r[3]=u[3]+f[3],r[4]=u[4]+f[4],r[5]=u[5]+f[5],r[6]=u[6]+f[6],r[7]=u[7]+f[7],r[8]=u[8]+f[8],r[9]=u[9]+f[9],r[10]=u[10]+f[10],r[11]=u[11]+f[11],r[12]=u[12]+f[12],r[13]=u[13]+f[13],r[14]=u[14]+f[14],r[15]=u[15]+f[15],n},t.subtract=function(n,t,i){var r=n.m,u=t.m,f=i.m;return r[0]=u[0]-f[0],r[1]=u[1]-f[1],r[2]=u[2]-f[2],r[3]=u[3]-f[3],r[4]=u[4]-f[4],r[5]=u[5]-f[5],r[6]=u[6]-f[6],r[7]=u[7]-f[7],r[8]=u[8]-f[8],r[9]=u[9]-f[9],r[10]=u[10]-f[10],r[11]=u[11]-f[11],r[12]=u[12]-f[12],r[13]=u[13]-f[13],r[14]=u[14]-f[14],r[15]=u[15]-f[15],n},t.multiplyScalar=function(n,t,i){var r=n.m,u=t.m;return r[0]=u[0]*i,r[1]=u[1]*i,r[2]=u[2]*i,r[3]=u[3]*i,r[4]=u[4]*i,r[5]=u[5]*i,r[6]=u[6]*i,r[7]=u[7]*i,r[8]=u[8]*i,r[9]=u[9]*i,r[10]=u[10]*i,r[11]=u[11]*i,r[12]=u[12]*i,r[13]=u[13]*i,r[14]=u[14]*i,r[15]=u[15]*i,n},t.multiplyScalarAndAdd=function(n,t,i,r){var u=n.m,f=t.m,e=i.m;return u[0]=f[0]+e[0]*r,u[1]=f[1]+e[1]*r,u[2]=f[2]+e[2]*r,u[3]=f[3]+e[3]*r,u[4]=f[4]+e[4]*r,u[5]=f[5]+e[5]*r,u[6]=f[6]+e[6]*r,u[7]=f[7]+e[7]*r,u[8]=f[8]+e[8]*r,u[9]=f[9]+e[9]*r,u[10]=f[10]+e[10]*r,u[11]=f[11]+e[11]*r,u[12]=f[12]+e[12]*r,u[13]=f[13]+e[13]*r,u[14]=f[14]+e[14]*r,u[15]=f[15]+e[15]*r,n},t.strictEquals=function(n,t){var i=n.m,r=t.m;return i[0]===r[0]&&i[1]===r[1]&&i[2]===r[2]&&i[3]===r[3]&&i[4]===r[4]&&i[5]===r[5]&&i[6]===r[6]&&i[7]===r[7]&&i[8]===r[8]&&i[9]===r[9]&&i[10]===r[10]&&i[11]===r[11]&&i[12]===r[12]&&i[13]===r[13]&&i[14]===r[14]&&i[15]===r[15]},t.equals=function(n,t,i){void 0===i&&(i=tt.EPSILON);var r=n.m,u=t.m;return Math.abs(r[0]-u[0])<=i*Math.max(1,Math.abs(r[0]),Math.abs(u[0]))&&Math.abs(r[1]-u[1])<=i*Math.max(1,Math.abs(r[1]),Math.abs(u[1]))&&Math.abs(r[2]-u[2])<=i*Math.max(1,Math.abs(r[2]),Math.abs(u[2]))&&Math.abs(r[3]-u[3])<=i*Math.max(1,Math.abs(r[3]),Math.abs(u[3]))&&Math.abs(r[4]-u[4])<=i*Math.max(1,Math.abs(r[4]),Math.abs(u[4]))&&Math.abs(r[5]-u[5])<=i*Math.max(1,Math.abs(r[5]),Math.abs(u[5]))&&Math.abs(r[6]-u[6])<=i*Math.max(1,Math.abs(r[6]),Math.abs(u[6]))&&Math.abs(r[7]-u[7])<=i*Math.max(1,Math.abs(r[7]),Math.abs(u[7]))&&Math.abs(r[8]-u[8])<=i*Math.max(1,Math.abs(r[8]),Math.abs(u[8]))&&Math.abs(r[9]-u[9])<=i*Math.max(1,Math.abs(r[9]),Math.abs(u[9]))&&Math.abs(r[10]-u[10])<=i*Math.max(1,Math.abs(r[10]),Math.abs(u[10]))&&Math.abs(r[11]-u[11])<=i*Math.max(1,Math.abs(r[11]),Math.abs(u[11]))&&Math.abs(r[12]-u[12])<=i*Math.max(1,Math.abs(r[12]),Math.abs(u[12]))&&Math.abs(r[13]-u[13])<=i*Math.max(1,Math.abs(r[13]),Math.abs(u[13]))&&Math.abs(r[14]-u[14])<=i*Math.max(1,Math.abs(r[14]),Math.abs(u[14]))&&Math.abs(r[15]-u[15])<=i*Math.max(1,Math.abs(r[15]),Math.abs(u[15]))},t.adjoint=function(n,t){var c=t.m,l=n.m,w=c[0],a=c[1],i=c[2],r=c[3],b=c[4],v=c[5],u=c[6],f=c[7],k=c[8],y=c[9],e=c[10],o=c[11],d=c[12],p=c[13],s=c[14],h=c[15];return l[0]=v*(e*h-o*s)-y*(u*h-f*s)+p*(u*o-f*e),l[1]=-(a*(e*h-o*s)-y*(i*h-r*s)+p*(i*o-r*e)),l[2]=a*(u*h-f*s)-v*(i*h-r*s)+p*(i*f-r*u),l[3]=-(a*(u*o-f*e)-v*(i*o-r*e)+y*(i*f-r*u)),l[4]=-(b*(e*h-o*s)-k*(u*h-f*s)+d*(u*o-f*e)),l[5]=w*(e*h-o*s)-k*(i*h-r*s)+d*(i*o-r*e),l[6]=-(w*(u*h-f*s)-b*(i*h-r*s)+d*(i*f-r*u)),l[7]=w*(u*o-f*e)-b*(i*o-r*e)+k*(i*f-r*u),l[8]=b*(y*h-o*p)-k*(v*h-f*p)+d*(v*o-f*y),l[9]=-(w*(y*h-o*p)-k*(a*h-r*p)+d*(a*o-r*y)),l[10]=w*(v*h-f*p)-b*(a*h-r*p)+d*(a*f-r*v),l[11]=-(w*(v*o-f*y)-b*(a*o-r*y)+k*(a*f-r*v)),l[12]=-(b*(y*s-e*p)-k*(v*s-u*p)+d*(v*e-u*y)),l[13]=w*(y*s-e*p)-k*(a*s-i*p)+d*(a*e-i*y),l[14]=-(w*(v*s-u*p)-b*(a*s-i*p)+d*(a*u-i*v)),l[15]=w*(v*e-u*y)-b*(a*e-i*y)+k*(a*u-i*v),n},t.toArray=function(n,t,i){void 0===i&&(i=0);for(var u=t.m,r=0;r<16;r++)n[i+r]=u[r];return n},t.fromArray=function(n,t,i){void 0===i&&(i=0);for(var u=n.m,r=0;r<16;r++)u[r]=t[i+r];return n},i.clone=function(){var n=this.m;return new t(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15])},i.set=function(n){var t=this.m,i=n.m;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this},i.equals=function(n){return t.strictEquals(this,n)},i.fuzzyEquals=function(n){return t.equals(this,n)},i.toString=function(){var n=this.m;return n?"[\n"+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+",\n"+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+",\n"+n[8]+", "+n[9]+", "+n[10]+", "+n[11]+",\n"+n[12]+", "+n[13]+", "+n[14]+", "+n[15]+"\n]":"[\n1, 0, 0, 0\n0, 1, 0, 0\n0, 0, 1, 0\n0, 0, 0, 1\n]"},i.identity=function(){return t.identity(this)},i.transpose=function(n){return n=n||new t,t.transpose(n,this)},i.invert=function(n){return n=n||new t,t.invert(n,this)},i.adjoint=function(n){return n=n||new t,t.adjoint(n,this)},i.determinant=function(){return t.determinant(this)},i.add=function(n,i){return i=i||new t,t.add(i,this,n)},i.subtract=function(n){return t.subtract(this,this,n)},i.multiply=function(n){return t.multiply(this,this,n)},i.multiplyScalar=function(n){return t.multiplyScalar(this,this,n)},i.translate=function(n,i){return i=i||new t,t.translate(i,this,n)},i.scale=function(n,i){return i=i||new t,t.scale(i,this,n)},i.rotate=function(n,i,r){return r=r||new t,t.rotate(r,this,n,i)},i.getTranslation=function(n){return n=n||new g.default,t.getTranslation(n,this)},i.getScale=function(n){return n=n||new g.default,t.getScaling(n,this)},i.getRotation=function(n){return n=n||new et.default,t.getRotation(n,this)},i.fromRTS=function(n,i,r){return t.fromRTS(this,n,i,r)},i.fromQuat=function(n){return t.fromQuat(this,n)},t}(st.default);for(i.default=d,d.mul=d.multiply,d.sub=d.subtract,d.IDENTITY=Object.freeze(new d),rt=new g.default,nt=new ft.default,ht.default.fastDefine("cc.Mat4",d,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1}),ot=function(n){Object.defineProperty(d.prototype,"m"+n,{get:function(){return this.m[n]},set:function(t){this.m[n]=t}})},ut=0;ut<16;ut++)ot(ut);cc.mat4=function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){var w=new d(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p);return void 0===n&&d.identity(w),w};cc.Mat4=d;t.exports=i.default},{"../platform/CCClass":195,"./mat3":285,"./quat":287,"./utils":291,"./value-type":292,"./vec3":294}],287:[function(n,t,i){"use strict";function a(n){return n&&n.__esModule?n:{"default":n}}i.__esModule=!0;i.default=void 0;var b=a(n("./value-type")),k=a(n("../platform/CCClass")),f=a(n("./vec3")),p=a(n("./mat3")),l=n("./utils");var e=0,o=0,s=0,h=0,r=function(n){function t(t,i,r,u){var f;return void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===u&&(u=1),(f=n.call(this)||this).x=void 0,f.y=void 0,f.z=void 0,f.w=void 0,t&&"object"==typeof t?(f.x=t.x,f.y=t.y,f.z=t.z,f.w=t.w):(f.x=t,f.y=i,f.z=r,f.w=u),f}var r,a,i;return a=n,(r=t).prototype=Object.create(a.prototype),r.prototype.constructor=r,r.__proto__=a,i=t.prototype,i.mul=function(n,i){return t.multiply(i||new t,this,n)},t.clone=function(n){return new t(n.x,n.y,n.z,n.w)},t.copy=function(n,t){return n.x=t.x,n.y=t.y,n.z=t.z,n.w=t.w,n},t.set=function(n,t,i,r,u){return n.x=t,n.y=i,n.z=r,n.w=u,n},t.identity=function(n){return n.x=0,n.y=0,n.z=0,n.w=1,n},t.rotationTo=function(n,i,r){var e=f.default.dot(i,r);return e<-.999999?(f.default.cross(u,f.default.RIGHT,i),u.mag()<1e-6&&f.default.cross(u,f.default.UP,i),f.default.normalize(u,u),t.fromAxisAngle(n,u,Math.PI),n):e>.999999?(n.x=0,n.y=0,n.z=0,n.w=1,n):(f.default.cross(u,i,r),n.x=u.x,n.y=u.y,n.z=u.z,n.w=1+e,t.normalize(n,n))},t.getAxisAngle=function(n,t){var r=2*Math.acos(t.w),i=Math.sin(r/2);return 0!==i?(n.x=t.x/i,n.y=t.y/i,n.z=t.z/i):(n.x=1,n.y=0,n.z=0),r},t.multiply=function(n,t,i){return e=t.x*i.w+t.w*i.x+t.y*i.z-t.z*i.y,o=t.y*i.w+t.w*i.y+t.z*i.x-t.x*i.z,s=t.z*i.w+t.w*i.z+t.x*i.y-t.y*i.x,h=t.w*i.w-t.x*i.x-t.y*i.y-t.z*i.z,n.x=e,n.y=o,n.z=s,n.w=h,n},t.multiplyScalar=function(n,t,i){return n.x=t.x*i,n.y=t.y*i,n.z=t.z*i,n.w=t.w*i,n},t.scaleAndAdd=function(n,t,i,r){return n.x=t.x+i.x*r,n.y=t.y+i.y*r,n.z=t.z+i.z*r,n.w=t.w+i.w*r,n},t.rotateX=function(n,t,i){i*=.5;var r=Math.sin(i),u=Math.cos(i);return e=t.x*u+t.w*r,o=t.y*u+t.z*r,s=t.z*u-t.y*r,h=t.w*u-t.x*r,n.x=e,n.y=o,n.z=s,n.w=h,n},t.rotateY=function(n,t,i){i*=.5;var r=Math.sin(i),u=Math.cos(i);return e=t.x*u-t.z*r,o=t.y*u+t.w*r,s=t.z*u+t.x*r,h=t.w*u-t.y*r,n.x=e,n.y=o,n.z=s,n.w=h,n},t.rotateZ=function(n,t,i){i*=.5;var r=Math.sin(i),u=Math.cos(i);return e=t.x*u+t.y*r,o=t.y*u-t.x*r,s=t.z*u+t.w*r,h=t.w*u-t.z*r,n.x=e,n.y=o,n.z=s,n.w=h,n},t.rotateAround=function(n,i,r,e){return t.invert(c,i),f.default.transformQuat(u,r,c),t.fromAxisAngle(c,u,e),t.multiply(n,i,c),n},t.rotateAroundLocal=function(n,i,r,u){return t.fromAxisAngle(c,r,u),t.multiply(n,i,c),n},t.calculateW=function(n,t){return n.x=t.x,n.y=t.y,n.z=t.z,n.w=Math.sqrt(Math.abs(1-t.x*t.x-t.y*t.y-t.z*t.z)),n},t.dot=function(n,t){return n.x*t.x+n.y*t.y+n.z*t.z+n.w*t.w},t.lerp=function(n,t,i,r){return n.x=t.x+r*(i.x-t.x),n.y=t.y+r*(i.y-t.y),n.z=t.z+r*(i.z-t.z),n.w=t.w+r*(i.w-t.w),n},t.slerp=function(n,t,i,r){var u=0,f=0,e=t.x*i.x+t.y*i.y+t.z*i.z+t.w*i.w,o,s;return(e<0&&(e=-e,i.x=-i.x,i.y=-i.y,i.z=-i.z,i.w=-i.w),1-e>1e-6)?(o=Math.acos(e),s=Math.sin(o),u=Math.sin((1-r)*o)/s,f=Math.sin(r*o)/s):(u=1-r,f=r),n.x=u*t.x+f*i.x,n.y=u*t.y+f*i.y,n.z=u*t.z+f*i.z,n.w=u*t.w+f*i.w,n},t.sqlerp=function(n,i,r,u,f,e){return t.slerp(c,i,f,e),t.slerp(w,r,u,e),t.slerp(n,c,w,2*e*(1-e)),n},t.invert=function(n,t){var r=t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w,i=r?1/r:0;return n.x=-t.x*i,n.y=-t.y*i,n.z=-t.z*i,n.w=t.w*i,n},t.conjugate=function(n,t){return n.x=-t.x,n.y=-t.y,n.z=-t.z,n.w=t.w,n},t.len=function(n){return Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z+n.w*n.w)},t.lengthSqr=function(n){return n.x*n.x+n.y*n.y+n.z*n.z+n.w*n.w},t.normalize=function(n,t){var i=t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w;return i>0&&(i=1/Math.sqrt(i),n.x=t.x*i,n.y=t.y*i,n.z=t.z*i,n.w=t.w*i),n},t.fromAxes=function(n,i,r,u){return p.default.set(v,i.x,i.y,i.z,r.x,r.y,r.z,u.x,u.y,u.z),t.normalize(n,t.fromMat3(n,v))},t.fromViewUp=function(n,i,r){return p.default.fromViewUp(v,i,r),t.normalize(n,t.fromMat3(n,v))},t.fromAxisAngle=function(n,t,i){i*=.5;var r=Math.sin(i);return n.x=r*t.x,n.y=r*t.y,n.z=r*t.z,n.w=Math.cos(i),n},t.fromAngleZ=function(n,t){return t*=y,n.x=n.y=0,n.z=Math.sin(t),n.w=Math.cos(t),n},t.fromMat3=function(n,t){var i=t.m,r=i[0],c=i[1],l=i[2],a=i[3],u=i[4],v=i[5],y=i[6],p=i[7],f=i[8],w=r+u+f,e,o,s,h;return w>0?(e=.5/Math.sqrt(w+1),n.w=.25/e,n.x=(v-p)*e,n.y=(y-l)*e,n.z=(c-a)*e):r>u&&r>f?(o=2*Math.sqrt(1+r-u-f),n.w=(v-p)/o,n.x=.25*o,n.y=(a+c)/o,n.z=(y+l)/o):u>f?(s=2*Math.sqrt(1+u-r-f),n.w=(y-l)/s,n.x=(a+c)/s,n.y=.25*s,n.z=(p+v)/s):(h=2*Math.sqrt(1+f-r-u),n.w=(c-a)/h,n.x=(y+l)/h,n.y=(p+v)/h,n.z=.25*h),n},t.fromEuler=function(n,t,i,r){t*=y;i*=y;r*=y;var u=Math.sin(t),f=Math.cos(t),e=Math.sin(i),o=Math.cos(i),s=Math.sin(r),h=Math.cos(r);return n.x=u*o*h+f*e*s,n.y=f*e*h+u*o*s,n.z=f*o*s-u*e*h,n.w=f*o*h-u*e*s,n},t.toAxisX=function(n,t){var i=2*t.y,r=2*t.z;return n.x=1-i*t.y-r*t.z,n.y=i*t.x+r*t.w,n.z=r*t.x+i*t.w,n},t.toAxisY=function(n,t){var r=2*t.x,u=2*t.y,i=2*t.z;return n.x=u*t.x-i*t.w,n.y=1-r*t.x-i*t.z,n.z=i*t.y+r*t.w,n},t.toAxisZ=function(n,t){var i=2*t.x,r=2*t.y,u=2*t.z;return n.x=u*t.x-r*t.w,n.y=u*t.y-i*t.w,n.z=1-i*t.x-r*t.y,n},t.toEuler=function(n,t,i){var r=t.x,o=t.y,s=t.z,h=t.w,u=0,f=0,e=0,c=r*o+s*h;if(c>.499999)u=0,f=l.toDegree(2*Math.atan2(r,h)),e=90;else if(c<-.499999)u=0,f=-l.toDegree(2*Math.atan2(r,h)),e=-90;else{var v=r*r,y=o*o,a=s*s;u=l.toDegree(Math.atan2(2*r*h-2*o*s,1-2*v-2*a));f=l.toDegree(Math.atan2(2*o*h-2*r*s,1-2*y-2*a));e=l.toDegree(Math.asin(2*c));i&&(u=-180*Math.sign(u+1e-6)+u,f=-180*Math.sign(f+1e-6)+f,e=180*Math.sign(e+1e-6)-e)}return n.x=u,n.y=f,n.z=e,n},t.strictEquals=function(n,t){return n.x===t.x&&n.y===t.y&&n.z===t.z&&n.w===t.w},t.equals=function(n,t,i){return void 0===i&&(i=l.EPSILON),Math.abs(n.x-t.x)<=i*Math.max(1,Math.abs(n.x),Math.abs(t.x))&&Math.abs(n.y-t.y)<=i*Math.max(1,Math.abs(n.y),Math.abs(t.y))&&Math.abs(n.z-t.z)<=i*Math.max(1,Math.abs(n.z),Math.abs(t.z))&&Math.abs(n.w-t.w)<=i*Math.max(1,Math.abs(n.w),Math.abs(t.w))},t.toArray=function(n,t,i){return void 0===i&&(i=0),n[i+0]=t.x,n[i+1]=t.y,n[i+2]=t.z,n[i+3]=t.w,n},t.fromArray=function(n,t,i){return void 0===i&&(i=0),n.x=t[i+0],n.y=t[i+1],n.z=t[i+2],n.w=t[i+3],n},i.clone=function(){return new t(this.x,this.y,this.z,this.w)},i.set=function(n){return this.x=n.x,this.y=n.y,this.z=n.z,this.w=n.w,this},i.equals=function(n){return n&&this.x===n.x&&this.y===n.y&&this.z===n.z&&this.w===n.w},i.toEuler=function(n){return t.toEuler(n,this)},i.fromEuler=function(n){return t.fromEuler(this,n.x,n.y,n.z)},i.lerp=function(n,i,r){return r=r||new t,t.slerp(r,this,n,i),r},i.multiply=function(n){return t.multiply(this,this,n)},i.rotateAround=function(n,i,r,u){return u=u||new t,t.rotateAround(u,n,i,r)},t}(b.default);i.default=r;r.mul=r.multiply;r.scale=r.multiplyScalar;r.mag=r.len;r.IDENTITY=Object.freeze(new r);var c=new r,w=new r,u=new f.default,v=new p.default,y=.5*Math.PI/180;k.default.fastDefine("cc.Quat",r,{x:0,y:0,z:0,w:1});cc.quat=function(n,t,i,u){return new r(n,t,i,u)};cc.Quat=r;t.exports=i.default},{"../platform/CCClass":195,"./mat3":285,"./utils":291,"./value-type":292,"./vec3":294}],288:[function(n,t,i){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}function h(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}var r;i.__esModule=!0;i.default=void 0;var e=u(n("./value-type")),o=u(n("../platform/CCClass")),f=u(n("./vec2")),s=u(n("./size"));r=function(n){function i(t,i,r,u){var f;return void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===u&&(u=0),(f=n.call(this)||this).x=void 0,f.y=void 0,f.width=void 0,f.height=void 0,t&&"object"==typeof t&&(i=t.y,r=t.width,u=t.height,t=t.x),f.x=t||0,f.y=i||0,f.width=r||0,f.height=u||0,f}var r,u,e,o,t;return u=n,(r=i).prototype=Object.create(u.prototype),r.prototype.constructor=r,r.__proto__=u,i.fromMinMax=function(n,t){var r=Math.min(n.x,t.x),u=Math.min(n.y,t.y);return new i(r,u,Math.max(n.x,t.x)-r,Math.max(n.y,t.y)-u)},t=i.prototype,t.clone=function(){return new i(this.x,this.y,this.width,this.height)},t.equals=function(n){return n&&this.x===n.x&&this.y===n.y&&this.width===n.width&&this.height===n.height},t.lerp=function(n,t,r){r=r||new i;var u=this.x,f=this.y,e=this.width,o=this.height;return r.x=u+(n.x-u)*t,r.y=f+(n.y-f)*t,r.width=e+(n.width-e)*t,r.height=o+(n.height-o)*t,r},t.set=function(n){return this.x=n.x,this.y=n.y,this.width=n.width,this.height=n.height,this},t.intersects=function(n){var t=this.x+this.width,i=this.y+this.height,r=n.x+n.width,u=n.y+n.height;return!(t<n.x||r<this.x||i<n.y||u<this.y)},t.intersection=function(n,t){var i=this.x,r=this.y,u=this.x+this.width,f=this.y+this.height,e=t.x,o=t.y,s=t.x+t.width,h=t.y+t.height;return n.x=Math.max(i,e),n.y=Math.max(r,o),n.width=Math.min(u,s)-n.x,n.height=Math.min(f,h)-n.y,n},t.contains=function(n){return this.x<=n.x&&this.x+this.width>=n.x&&this.y<=n.y&&this.y+this.height>=n.y},t.containsRect=function(n){return this.x<=n.x&&this.x+this.width>=n.x+n.width&&this.y<=n.y&&this.y+this.height>=n.y+n.height},t.union=function(n,t){var i=this.x,r=this.y,e=this.width,o=this.height,u=t.x,f=t.y,s=t.width,h=t.height;return n.x=Math.min(i,u),n.y=Math.min(r,f),n.width=Math.max(i+e,u+s)-n.x,n.height=Math.max(r+o,f+h)-n.y,n},t.transformMat4=function(n,t){var r=this.x,u=this.y,f=r+this.width,e=u+this.height,i=t.m,o=i[0]*r+i[4]*u+i[12],s=i[1]*r+i[5]*u+i[13],h=i[0]*f+i[4]*u+i[12],c=i[1]*f+i[5]*u+i[13],l=i[0]*r+i[4]*e+i[12],a=i[1]*r+i[5]*e+i[13],v=i[0]*f+i[4]*e+i[12],y=i[1]*f+i[5]*e+i[13],p=Math.min(o,h,l,v),b=Math.max(o,h,l,v),w=Math.min(s,c,a,y),k=Math.max(s,c,a,y);return n.x=p,n.y=w,n.width=b-p,n.height=k-w,n},t.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},e=i,(o=[{key:"xMin",get:function(){return this.x},set:function(n){this.width+=this.x-n;this.x=n}},{key:"yMin",get:function(){return this.y},set:function(n){this.height+=this.y-n;this.y=n}},{key:"xMax",get:function(){return this.x+this.width},set:function(n){this.width=n-this.x}},{key:"yMax",get:function(){return this.y+this.height},set:function(n){this.height=n-this.y}},{key:"center",get:function(){return new f.default(this.x+.5*this.width,this.y+.5*this.height)},set:function(n){this.x=n.x-.5*this.width;this.y=n.y-.5*this.height}},{key:"origin",get:function(){return new f.default(this.x,this.y)},set:function(n){this.x=n.x;this.y=n.y}},{key:"size",get:function(){return new s.default(this.width,this.height)},set:function(n){this.width=n.width;this.height=n.height}}])&&h(e.prototype,o),i}(e.default);i.default=r;o.default.fastDefine("cc.Rect",r,{x:0,y:0,width:0,height:0});cc.Rect=r;cc.rect=function(n,t,i,u){return new r(n,t,i,u)};t.exports=i.default},{"../platform/CCClass":195,"./size":289,"./value-type":292,"./vec2":293}],289:[function(n,t,i){"use strict";function e(n){return n&&n.__esModule?n:{"default":n}}function o(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}var u,f,r;i.__esModule=!0;i.default=void 0;u=e(n("./value-type"));f=e(n("../platform/CCClass"));r=function(n){function t(t,i){var r;return void 0===t&&(t=0),void 0===i&&(i=0),(r=n.call(this)||this).width=void 0,r.height=void 0,t&&"object"==typeof t?(r.width=t.width,r.height=t.height):(r.width=t||0,r.height=i||0),r}var r,u,f,e,i;return u=n,(r=t).prototype=Object.create(u.prototype),r.prototype.constructor=r,r.__proto__=u,f=t,e=[{key:"ZERO",get:function(){return new t}}],null&&o(f.prototype,null),e&&o(f,e),i=t.prototype,i.clone=function(){return new t(this.width,this.height)},i.equals=function(n){return n&&this.width===n.width&&this.height===n.height},i.lerp=function(n,i,r){r=r||new t;var u=this.width,f=this.height;return r.width=u+(n.width-u)*i,r.height=f+(n.height-f)*i,r},i.set=function(n){return this.width=n.width,this.height=n.height,this},i.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},t}(u.default);i.default=r;r.ZERO_R=r.ZERO;f.default.fastDefine("cc.Size",r,{width:0,height:0});cc.size=function(n,t){return new r(n,t)};cc.Size=r;t.exports=i.default},{"../platform/CCClass":195,"./value-type":292}],290:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var f,u=(f=n("./quat"))&&f.__esModule?f:{"default":f},r=new u.default,e=function(){function n(){}return n.toRotation=function(n,t){return n.x=t[3],n.y=t[4],n.z=t[5],n.w=t[6],n},n.fromRotation=function(n,t){return n[3]=t.x,n[4]=t.y,n[5]=t.z,n[6]=t.w,n},n.toEuler=function(t,i){return n.toRotation(r,i),u.default.toEuler(t,r),t},n.fromEuler=function(t,i){return u.default.fromEuler(r,i.x,i.y,i.z),n.fromRotation(t,r),t},n.fromEulerNumber=function(t,i,f,e){return u.default.fromEuler(r,i,f,e),n.fromRotation(t,r),t},n.toScale=function(n,t){return n.x=t[7],n.y=t[8],n.z=t[9],n},n.fromScale=function(n,t){return n[7]=t.x,n[8]=t.y,n[9]=t.z,n},n.toPosition=function(n,t){return n.x=t[0],n.y=t[1],n.z=t[2],n},n.fromPosition=function(n,t){return n[0]=t.x,n[1]=t.y,n[2]=t.z,n},n.fromAngleZ=function(t,i){return u.default.fromAngleZ(r,i),n.fromRotation(t,r),t},n.toMat4=function(n,t){var r=t[3],u=t[4],e=t[5],o=t[6],a=r+r,s=u+u,f=e+e,v=r*a,y=r*s,p=r*f,w=u*s,b=u*f,k=e*f,d=o*a,g=o*s,nt=o*f,h=t[7],c=t[8],l=t[9],i=n.m;return i[0]=(1-(w+k))*h,i[1]=(y+nt)*h,i[2]=(p-g)*h,i[3]=0,i[4]=(y-nt)*c,i[5]=(1-(v+k))*c,i[6]=(b+d)*c,i[7]=0,i[8]=(p+g)*l,i[9]=(b-d)*l,i[10]=(1-(v+w))*l,i[11]=0,i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=1,n},n}();i.default=e;cc.Trs=e;t.exports=i.default},{"./quat":287}],291:[function(n,t,i){"use strict";function e(n,t){return Math.random()*(t-n)+n}function o(n){return(n=(9301*n+49297)%233280)/233280}function s(n,t,i){return o(n)*(i-t)+t}function h(n,t){return n-Math.floor(n/t)*t}var u,f;i.__esModule=!0;i.equals=function(n,t){return Math.abs(n-t)<=r*Math.max(1,Math.abs(n),Math.abs(t))};i.approx=function(n,t,i){return i=i||r,Math.abs(n-t)<=i};i.clamp=function(n,t,i){return n<t?t:n>i?i:n};i.clamp01=function(n){return n<0?0:n>1?1:n};i.lerp=function(n,t,i){return n+(t-n)*i};i.toRadian=function(n){return n*c};i.toDegree=function(n){return n*l};i.randomRange=e;i.randomRangeInt=function(n,t){return Math.floor(e(n,t))};i.pseudoRandom=o;i.pseudoRandomRange=s;i.pseudoRandomRangeInt=function(n,t,i){return Math.floor(s(n,t,i))};i.nextPow2=function(n){return--n,n|=n>>1,n|=n>>2,n|=n>>4,n|=n>>8,n|=n>>16,++n};i.repeat=h;i.pingPong=function(n,t){return n=h(n,2*t),t-Math.abs(n-t)};i.inverseLerp=function(n,t,i){return(i-n)/(t-n)};i.sign=function(n){return(n>0)-(n<0)};i.random=i.FLOAT_BYTES=i.FLOAT_ARRAY_TYPE=i.INT_MIN=i.INT_MAX=i.INT_BITS=i.EPSILON=void 0;var c=Math.PI/180,l=180/Math.PI,r=1e-6;i.EPSILON=r;i.INT_BITS=32;i.INT_MAX=2147483647;i.INT_MIN=-2147483648;u=Float64Array;i.FLOAT_ARRAY_TYPE=u;i.FLOAT_BYTES=8;f=Math.random;i.random=f},{}],292:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var u,r=(u=n("../platform/js"))&&u.__esModule?u:{"default":u},f=function(){function t(){}var n=t.prototype;return n.clone=function(){return cc.errorID("0100",r.default.getClassName(this)+".clone"),null},n.equals=function(){return cc.errorID("0100",r.default.getClassName(this)+".equals"),!1},n.lerp=function(){return cc.errorID("0100",r.default.getClassName(this)+".lerp"),this.clone()},n.set=function(){cc.errorID("0100",r.default.getClassName(this)+".set")},n.toString=function(){return""+{}},t}();i.default=f;r.default.setClassName("cc.ValueType",f);cc.ValueType=f;t.exports=i.default},{"../platform/js":216}],293:[function(n,t,i){"use strict";function s(n){return n&&n.__esModule?n:{"default":n}}function l(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}var h,c;i.__esModule=!0;i.default=void 0;var a=s(n("./value-type")),v=s(n("../platform/CCClass")),o=s(n("../utils/misc")),e=n("./utils");var r=0,u=0,f=function(n){function t(i,r){var u;return void 0===i&&(i=0),void 0===r&&(r=0),(u=n.call(this)||this).mag=t.prototype.len,u.magSqr=t.prototype.lengthSqr,u.subSelf=t.prototype.subtract,u.mulSelf=t.prototype.multiplyScalar,u.divSelf=t.prototype.divide,u.scaleSelf=t.prototype.multiply,u.negSelf=t.prototype.negate,u.x=void 0,u.y=void 0,u.z=0,i&&"object"==typeof i?(u.x=i.x||0,u.y=i.y||0):(u.x=i||0,u.y=r||0),u}var f,s,a,v,i;return s=n,(f=t).prototype=Object.create(s.prototype),f.prototype.constructor=f,f.__proto__=s,i=t.prototype,i.sub=function(n,i){return t.subtract(i||new t,this,n)},i.mul=function(n,i){return t.multiplyScalar(i||new t,this,n)},i.div=function(n,i){return t.multiplyScalar(i||new t,this,1/n)},i.scale=function(n,i){return t.multiply(i||new t,this,n)},i.neg=function(n){return t.negate(n||new t,this)},t.clone=function(n){return new t(n.x,n.y)},t.copy=function(n,t){return n.x=t.x,n.y=t.y,n},t.set=function(n,t,i){return n.x=t,n.y=i,n},t.add=function(n,t,i){return n.x=t.x+i.x,n.y=t.y+i.y,n},t.subtract=function(n,t,i){return n.x=t.x-i.x,n.y=t.y-i.y,n},t.multiply=function(n,t,i){return n.x=t.x*i.x,n.y=t.y*i.y,n},t.divide=function(n,t,i){return n.x=t.x/i.x,n.y=t.y/i.y,n},t.ceil=function(n,t){return n.x=Math.ceil(t.x),n.y=Math.ceil(t.y),n},t.floor=function(n,t){return n.x=Math.floor(t.x),n.y=Math.floor(t.y),n},t.min=function(n,t,i){return n.x=Math.min(t.x,i.x),n.y=Math.min(t.y,i.y),n},t.max=function(n,t,i){return n.x=Math.max(t.x,i.x),n.y=Math.max(t.y,i.y),n},t.round=function(n,t){return n.x=Math.round(t.x),n.y=Math.round(t.y),n},t.multiplyScalar=function(n,t,i){return n.x=t.x*i,n.y=t.y*i,n},t.scaleAndAdd=function(n,t,i,r){return n.x=t.x+i.x*r,n.y=t.y+i.y*r,n},t.distance=function(n,t){return r=t.x-n.x,u=t.y-n.y,Math.sqrt(r*r+u*u)},t.squaredDistance=function(n,t){return r=t.x-n.x,u=t.y-n.y,r*r+u*u},t.len=function(n){return r=n.x,u=n.y,Math.sqrt(r*r+u*u)},t.lengthSqr=function(n){return r=n.x,u=n.y,r*r+u*u},t.negate=function(n,t){return n.x=-t.x,n.y=-t.y,n},t.inverse=function(n,t){return n.x=1/t.x,n.y=1/t.y,n},t.inverseSafe=function(n,t){return r=t.x,u=t.y,n.x=Math.abs(r)<e.EPSILON?0:1/r,n.y=Math.abs(u)<e.EPSILON?0:1/u,n},t.normalize=function(n,t){r=t.x;u=t.y;var i=r*r+u*u;return i>0&&(i=1/Math.sqrt(i),n.x=r*i,n.y=u*i),n},t.dot=function(n,t){return n.x*t.x+n.y*t.y},t.cross=function(n,t,i){return n.x=n.y=0,n.z=t.x*i.y-t.y*i.x,n},t.lerp=function(n,t,i,f){return r=t.x,u=t.y,n.x=r+f*(i.x-r),n.y=u+f*(i.y-u),n},t.random=function(n,t){t=t||1;var i=2*e.random()*Math.PI;return n.x=Math.cos(i)*t,n.y=Math.sin(i)*t,n},t.transformMat3=function(n,t,i){r=t.x;u=t.y;var f=i.m;return n.x=f[0]*r+f[3]*u+f[6],n.y=f[1]*r+f[4]*u+f[7],n},t.transformMat4=function(n,t,i){r=t.x;u=t.y;var f=i.m;return n.x=f[0]*r+f[4]*u+f[12],n.y=f[1]*r+f[5]*u+f[13],n},t.strictEquals=function(n,t){return n.x===t.x&&n.y===t.y},t.equals=function(n,t,i){return void 0===i&&(i=e.EPSILON),Math.abs(n.x-t.x)<=i*Math.max(1,Math.abs(n.x),Math.abs(t.x))&&Math.abs(n.y-t.y)<=i*Math.max(1,Math.abs(n.y),Math.abs(t.y))},t.angle=function(n,i){t.normalize(h,n);t.normalize(c,i);var r=t.dot(h,c);return r>1?0:r<-1?Math.PI:Math.acos(r)},t.toArray=function(n,t,i){return void 0===i&&(i=0),n[i+0]=t.x,n[i+1]=t.y,n},t.fromArray=function(n,t,i){return void 0===i&&(i=0),n.x=t[i+0],n.y=t[i+1],n},a=t,v=[{key:"ONE",get:function(){return new t(1,1)}},{key:"ZERO",get:function(){return new t(0,0)}},{key:"UP",get:function(){return new t(0,1)}},{key:"RIGHT",get:function(){return new t(1,0)}}],null&&l(a.prototype,null),v&&l(a,v),i.clone=function(){return new t(this.x,this.y)},i.set=function(n){return this.x=n.x,this.y=n.y,this},i.equals=function(n){return n&&this.x===n.x&&this.y===n.y},i.fuzzyEquals=function(n,t){return this.x-t<=n.x&&n.x<=this.x+t&&this.y-t<=n.y&&n.y<=this.y+t},i.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},i.lerp=function(n,i,r){r=r||new t;var u=this.x,f=this.y;return r.x=u+(n.x-u)*i,r.y=f+(n.y-f)*i,r},i.clampf=function(n,t){return this.x=o.default.clampf(this.x,n.x,t.x),this.y=o.default.clampf(this.y,n.y,t.y),this},i.add=function(n,i){return(i=i||new t).x=this.x+n.x,i.y=this.y+n.y,i},i.addSelf=function(n){return this.x+=n.x,this.y+=n.y,this},i.subtract=function(n){return this.x-=n.x,this.y-=n.y,this},i.multiplyScalar=function(n){return this.x*=n,this.y*=n,this},i.multiply=function(n){return this.x*=n.x,this.y*=n.y,this},i.divide=function(n){return this.x/=n,this.y/=n,this},i.negate=function(){return this.x=-this.x,this.y=-this.y,this},i.dot=function(n){return this.x*n.x+this.y*n.y},i.cross=function(n){return this.x*n.y-this.y*n.x},i.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.lengthSqr=function(){return this.x*this.x+this.y*this.y},i.normalizeSelf=function(){var n=this.x*this.x+this.y*this.y,t;return 1===n?this:0===n?this:(t=1/Math.sqrt(n),this.x*=t,this.y*=t,this)},i.normalize=function(n){return(n=n||new t).x=this.x,n.y=this.y,n.normalizeSelf(),n},i.angle=function(n){var i=this.magSqr(),r=n.magSqr(),t;return 0===i||0===r?(console.warn("Can't get angle between zero vector"),0):(t=this.dot(n)/Math.sqrt(i*r),t=o.default.clampf(t,-1,1),Math.acos(t))},i.signAngle=function(n){var t=this.angle(n);return this.cross(n)<0?-t:t},i.rotate=function(n,i){return(i=i||new t).x=this.x,i.y=this.y,i.rotateSelf(n)},i.rotateSelf=function(n){var t=Math.sin(n),i=Math.cos(n),r=this.x;return this.x=i*r-t*this.y,this.y=t*r+i*this.y,this},i.project=function(n){return n.multiplyScalar(this.dot(n)/n.dot(n))},i.transformMat4=function(n,i){return i=i||new t,t.transformMat4(i,this,n),i},i.maxAxis=function(){return Math.max(this.x,this.y)},t}(a.default);i.default=f;f.sub=f.subtract;f.mul=f.multiply;f.scale=f.multiplyScalar;f.mag=f.len;f.squaredMagnitude=f.lengthSqr;f.div=f.divide;f.ONE_R=f.ONE;f.ZERO_R=f.ZERO;f.UP_R=f.UP;f.RIGHT_R=f.RIGHT;h=new f;c=new f;v.default.fastDefine("cc.Vec2",f,{x:0,y:0});cc.v2=function(n,t){return new f(n,t)};cc.Vec2=f;t.exports=i.default},{"../platform/CCClass":195,"../utils/misc":269,"./utils":291,"./value-type":292}],294:[function(n,t,i){"use strict";function h(n){return n&&n.__esModule?n:{"default":n}}function v(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}var l,a;i.__esModule=!0;i.default=void 0;var y=h(n("./value-type")),p=h(n("../platform/CCClass")),c=h(n("../utils/misc")),o=h(n("./vec2")),s=n("./utils");var r=0,u=0,f=0,e=function(n){function t(i,r,u){var f;return void 0===i&&(i=0),void 0===r&&(r=0),void 0===u&&(u=0),(f=n.call(this)||this).mag=t.prototype.len,f.magSqr=t.prototype.lengthSqr,f.subSelf=t.prototype.subtract,f.mulSelf=t.prototype.multiplyScalar,f.divSelf=t.prototype.divide,f.scaleSelf=t.prototype.multiply,f.negSelf=t.prototype.negate,f.x=void 0,f.y=void 0,f.z=void 0,f.angle=o.default.prototype.angle,f.project=o.default.prototype.project,i&&"object"==typeof i?(f.x=i.x,f.y=i.y,f.z=i.z):(f.x=i,f.y=r,f.z=u),f}var e,h,y,p,i;return h=n,(e=t).prototype=Object.create(h.prototype),e.prototype.constructor=e,e.__proto__=h,i=t.prototype,i.sub=function(n,i){return t.subtract(i||new t,this,n)},i.mul=function(n,i){return t.multiplyScalar(i||new t,this,n)},i.div=function(n,i){return t.multiplyScalar(i||new t,this,1/n)},i.scale=function(n,i){return t.multiply(i||new t,this,n)},i.neg=function(n){return t.negate(n||new t,this)},t.zero=function(n){return n.x=0,n.y=0,n.z=0,n},t.clone=function(n){return new t(n.x,n.y,n.z)},t.copy=function(n,t){return n.x=t.x,n.y=t.y,n.z=t.z,n},t.set=function(n,t,i,r){return n.x=t,n.y=i,n.z=r,n},t.add=function(n,t,i){return n.x=t.x+i.x,n.y=t.y+i.y,n.z=t.z+i.z,n},t.subtract=function(n,t,i){return n.x=t.x-i.x,n.y=t.y-i.y,n.z=t.z-i.z,n},t.multiply=function(n,t,i){return n.x=t.x*i.x,n.y=t.y*i.y,n.z=t.z*i.z,n},t.divide=function(n,t,i){return n.x=t.x/i.x,n.y=t.y/i.y,n.z=t.z/i.z,n},t.ceil=function(n,t){return n.x=Math.ceil(t.x),n.y=Math.ceil(t.y),n.z=Math.ceil(t.z),n},t.floor=function(n,t){return n.x=Math.floor(t.x),n.y=Math.floor(t.y),n.z=Math.floor(t.z),n},t.min=function(n,t,i){return n.x=Math.min(t.x,i.x),n.y=Math.min(t.y,i.y),n.z=Math.min(t.z,i.z),n},t.max=function(n,t,i){return n.x=Math.max(t.x,i.x),n.y=Math.max(t.y,i.y),n.z=Math.max(t.z,i.z),n},t.round=function(n,t){return n.x=Math.round(t.x),n.y=Math.round(t.y),n.z=Math.round(t.z),n},t.multiplyScalar=function(n,t,i){return n.x=t.x*i,n.y=t.y*i,n.z=t.z*i,n},t.scaleAndAdd=function(n,t,i,r){return n.x=t.x+i.x*r,n.y=t.y+i.y*r,n.z=t.z+i.z*r,n},t.distance=function(n,t){return r=t.x-n.x,u=t.y-n.y,f=t.z-n.z,Math.sqrt(r*r+u*u+f*f)},t.squaredDistance=function(n,t){return r=t.x-n.x,u=t.y-n.y,f=t.z-n.z,r*r+u*u+f*f},t.len=function(n){return r=n.x,u=n.y,f=n.z,Math.sqrt(r*r+u*u+f*f)},t.lengthSqr=function(n){return r=n.x,u=n.y,f=n.z,r*r+u*u+f*f},t.negate=function(n,t){return n.x=-t.x,n.y=-t.y,n.z=-t.z,n},t.inverse=function(n,t){return n.x=1/t.x,n.y=1/t.y,n.z=1/t.z,n},t.inverseSafe=function(n,t){return r=t.x,u=t.y,f=t.z,n.x=Math.abs(r)<s.EPSILON?0:1/r,n.y=Math.abs(u)<s.EPSILON?0:1/u,n.z=Math.abs(f)<s.EPSILON?0:1/f,n},t.normalize=function(n,t){r=t.x;u=t.y;f=t.z;var i=r*r+u*u+f*f;return i>0&&(i=1/Math.sqrt(i),n.x=r*i,n.y=u*i,n.z=f*i),n},t.dot=function(n,t){return n.x*t.x+n.y*t.y+n.z*t.z},t.cross=function(n,t,i){var r=t.x,u=t.y,f=t.z,e=i.x,o=i.y,s=i.z;return n.x=u*s-f*o,n.y=f*e-r*s,n.z=r*o-u*e,n},t.lerp=function(n,t,i,r){return n.x=t.x+r*(i.x-t.x),n.y=t.y+r*(i.y-t.y),n.z=t.z+r*(i.z-t.z),n},t.random=function(n,t){t=t||1;var r=2*s.random()*Math.PI,i=2*s.random()-1,u=Math.sqrt(1-i*i);return n.x=u*Math.cos(r)*t,n.y=u*Math.sin(r)*t,n.z=i*t,n},t.transformMat4=function(n,t,i){r=t.x;u=t.y;f=t.z;var e=i.m,o=e[3]*r+e[7]*u+e[11]*f+e[15];return o=o?1/o:1,n.x=(e[0]*r+e[4]*u+e[8]*f+e[12])*o,n.y=(e[1]*r+e[5]*u+e[9]*f+e[13])*o,n.z=(e[2]*r+e[6]*u+e[10]*f+e[14])*o,n},t.transformMat4Normal=function(n,t,i){r=t.x;u=t.y;f=t.z;var e=i.m,o=e[3]*r+e[7]*u+e[11]*f;return o=o?1/o:1,n.x=(e[0]*r+e[4]*u+e[8]*f)*o,n.y=(e[1]*r+e[5]*u+e[9]*f)*o,n.z=(e[2]*r+e[6]*u+e[10]*f)*o,n},t.transformMat3=function(n,t,i){r=t.x;u=t.y;f=t.z;var e=i.m;return n.x=r*e[0]+u*e[3]+f*e[6],n.y=r*e[1]+u*e[4]+f*e[7],n.z=r*e[2]+u*e[5]+f*e[8],n},t.transformAffine=function(n,t,i){r=t.x;u=t.y;f=t.z;var e=i.m;return n.x=e[0]*r+e[1]*u+e[2]*f+e[3],n.y=e[4]*r+e[5]*u+e[6]*f+e[7],n.x=e[8]*r+e[9]*u+e[10]*f+e[11],n},t.transformQuat=function(n,t,i){var r=i.w*t.x+i.y*t.z-i.z*t.y,u=i.w*t.y+i.z*t.x-i.x*t.z,f=i.w*t.z+i.x*t.y-i.y*t.x,e=-i.x*t.x-i.y*t.y-i.z*t.z;return n.x=r*i.w+e*-i.x+u*-i.z-f*-i.y,n.y=u*i.w+e*-i.y+f*-i.x-r*-i.z,n.z=f*i.w+e*-i.z+r*-i.y-u*-i.x,n},t.transformRTS=function(n,t,i,r,u){var f=t.x*u.x,e=t.y*u.y,o=t.z*u.z,s=i.w*f+i.y*o-i.z*e,h=i.w*e+i.z*f-i.x*o,c=i.w*o+i.x*e-i.y*f,l=-i.x*f-i.y*e-i.z*o;return n.x=s*i.w+l*-i.x+h*-i.z-c*-i.y+r.x,n.y=h*i.w+l*-i.y+c*-i.x-s*-i.z+r.y,n.z=c*i.w+l*-i.z+s*-i.y-h*-i.x+r.z,n},t.transformInverseRTS=function(n,t,i,r,u){var f=t.x-r.x,e=t.y-r.y,o=t.z-r.z,s=i.w*f-i.y*o+i.z*e,h=i.w*e-i.z*f+i.x*o,c=i.w*o-i.x*e+i.y*f,l=i.x*f+i.y*e+i.z*o;return n.x=(s*i.w+l*i.x+h*i.z-c*i.y)/u.x,n.y=(h*i.w+l*i.y+c*i.x-s*i.z)/u.y,n.z=(c*i.w+l*i.z+s*i.y-h*i.x)/u.z,n},t.rotateX=function(n,t,i,e){r=t.x-i.x;u=t.y-i.y;f=t.z-i.z;var o=Math.cos(e),s=Math.sin(e),h=r,c=u*o-f*s,l=u*s+f*o;return n.x=h+i.x,n.y=c+i.y,n.z=l+i.z,n},t.rotateY=function(n,t,i,e){r=t.x-i.x;u=t.y-i.y;f=t.z-i.z;var o=Math.cos(e),s=Math.sin(e),h=f*s+r*o,c=u,l=f*o-r*s;return n.x=h+i.x,n.y=c+i.y,n.z=l+i.z,n},t.rotateZ=function(n,t,i,e){r=t.x-i.x;u=t.y-i.y;f=t.z-i.z;var o=Math.cos(e),s=Math.sin(e),h=r*o-u*s,c=r*s+u*o,l=f;return n.x=h+i.x,n.y=c+i.y,n.z=l+i.z,n},t.strictEquals=function(n,t){return n.x===t.x&&n.y===t.y&&n.z===t.z},t.equals=function(n,t,i){void 0===i&&(i=s.EPSILON);var r=n.x,u=n.y,f=n.z,e=t.x,o=t.y,h=t.z;return Math.abs(r-e)<=i*Math.max(1,Math.abs(r),Math.abs(e))&&Math.abs(u-o)<=i*Math.max(1,Math.abs(u),Math.abs(o))&&Math.abs(f-h)<=i*Math.max(1,Math.abs(f),Math.abs(h))},t.angle=function(n,i){t.normalize(l,n);t.normalize(a,i);var r=t.dot(l,a);return r>1?0:r<-1?Math.PI:Math.acos(r)},t.projectOnPlane=function(n,i,r){return t.subtract(n,i,t.project(n,i,r))},t.project=function(n,i,r){var u=t.lengthSqr(r);return u<1e-6?t.set(n,0,0,0):t.multiplyScalar(n,r,t.dot(i,r)/u)},t.toArray=function(n,t,i){return void 0===i&&(i=0),n[i+0]=t.x,n[i+1]=t.y,n[i+2]=t.z,n},t.fromArray=function(n,t,i){return void 0===i&&(i=0),n.x=t[i+0],n.y=t[i+1],n.z=t[i+2],n},y=t,p=[{key:"ONE",get:function(){return new t(1,1,1)}},{key:"ZERO",get:function(){return new t}},{key:"UP",get:function(){return new t(0,1,0)}},{key:"RIGHT",get:function(){return new t(1,0,0)}},{key:"FORWARD",get:function(){return new t(0,0,1)}}],null&&v(y.prototype,null),p&&v(y,p),i.clone=function(){return new t(this.x,this.y,this.z)},i.set=function(n){return this.x=n.x,this.y=n.y,this.z=n.z,this},i.equals=function(n){return n&&this.x===n.x&&this.y===n.y&&this.z===n.z},i.fuzzyEquals=function(n,t){return this.x-t<=n.x&&n.x<=this.x+t&&this.y-t<=n.y&&n.y<=this.y+t&&this.z-t<=n.z&&n.z<=this.z+t},i.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+")"},i.lerp=function(n,i,r){return r=r||new t,t.lerp(r,this,n,i),r},i.clampf=function(n,t){return this.x=c.default.clampf(this.x,n.x,t.x),this.y=c.default.clampf(this.y,n.y,t.y),this.z=c.default.clampf(this.z,n.z,t.z),this},i.addSelf=function(n){return this.x+=n.x,this.y+=n.y,this.z+=n.z,this},i.add=function(n,i){return(i=i||new t).x=this.x+n.x,i.y=this.y+n.y,i.z=this.z+n.z,i},i.subtract=function(n){return this.x-=n.x,this.y-=n.y,this.z-=n.z,this},i.multiplyScalar=function(n){return this.x*=n,this.y*=n,this.z*=n,this},i.multiply=function(n){return this.x*=n.x,this.y*=n.y,this.z*=n.z,this},i.divide=function(n){return this.x/=n,this.y/=n,this.z/=n,this},i.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},i.dot=function(n){return this.x*n.x+this.y*n.y+this.z*n.z},i.cross=function(n,i){return i=i||new t,t.cross(i,this,n),i},i.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z},i.normalizeSelf=function(){return t.normalize(this,this),this},i.normalize=function(n){return n=n||new t,t.normalize(n,this),n},i.transformMat4=function(n,i){return i=i||new t,t.transformMat4(i,this,n),i},i.maxAxis=function(){return Math.max(this.x,this.y,this.z)},i.signAngle=function(n){cc.warnID(1408,"vec3.signAngle","v2.1","cc.v2(selfVector).signAngle(vector)");var t=new o.default(this.x,this.y),i=new o.default(n.x,n.y);return t.signAngle(i)},i.rotate=function(n,t){return cc.warnID(1408,"vec3.rotate","v2.1","cc.v2(selfVector).rotate(radians, out)"),o.default.prototype.rotate.call(this,n,t)},i.rotateSelf=function(n){return cc.warnID(1408,"vec3.rotateSelf","v2.1","cc.v2(selfVector).rotateSelf(radians)"),o.default.prototype.rotateSelf.call(this,n)},t}(y.default);i.default=e;e.sub=e.subtract;e.mul=e.multiply;e.scale=e.multiplyScalar;e.mag=e.len;e.squaredMagnitude=e.lengthSqr;e.div=e.divide;e.ONE_R=e.ONE;e.ZERO_R=e.ZERO;e.UP_R=e.UP;e.RIGHT_R=e.RIGHT;e.FRONT_R=e.FORWARD;l=new e;a=new e;p.default.fastDefine("cc.Vec3",e,{x:0,y:0,z:0});cc.v3=function(n,t,i){return new e(n,t,i)};cc.Vec3=e;t.exports=i.default},{"../platform/CCClass":195,"../utils/misc":269,"./utils":291,"./value-type":292,"./vec2":293}],295:[function(n,t,i){"use strict";function h(n){return n&&n.__esModule?n:{"default":n}}function c(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}function l(n,t,i,r){return new o(n,t,i,r)}i.__esModule=!0;i.v4=l;i.default=void 0;var a=h(n("../platform/CCClass")),v=h(n("./value-type")),s=n("./utils");var r=0,u=0,f=0,e=0,o=function(n){function t(i,r,u,f){var e;return void 0===i&&(i=0),void 0===r&&(r=0),void 0===u&&(u=0),void 0===f&&(f=0),(e=n.call(this)||this).mag=t.prototype.len,e.magSqr=t.prototype.lengthSqr,e.subSelf=t.prototype.subtract,e.mulSelf=t.prototype.multiplyScalar,e.divSelf=t.prototype.divide,e.scaleSelf=t.prototype.multiply,e.negSelf=t.prototype.negate,e.x=void 0,e.y=void 0,e.z=void 0,e.w=void 0,i&&"object"==typeof i?(e.x=i.x,e.y=i.y,e.z=i.z,e.w=i.w):(e.x=i,e.y=r,e.z=u,e.w=f),e}var o,h,l,a,i;return h=n,(o=t).prototype=Object.create(h.prototype),o.prototype.constructor=o,o.__proto__=h,i=t.prototype,i.sub=function(n,i){return t.subtract(i||new t,this,n)},i.mul=function(n,i){return t.multiplyScalar(i||new t,this,n)},i.div=function(n,i){return t.multiplyScalar(i||new t,this,1/n)},i.scale=function(n,i){return t.multiply(i||new t,this,n)},i.neg=function(n){return t.negate(n||new t,this)},t.clone=function(n){return new t(n.x,n.y,n.z,n.w)},t.copy=function(n,t){return n.x=t.x,n.y=t.y,n.z=t.z,n.w=t.w,n},t.set=function(n,t,i,r,u){return n.x=t,n.y=i,n.z=r,n.w=u,n},t.add=function(n,t,i){return n.x=t.x+i.x,n.y=t.y+i.y,n.z=t.z+i.z,n.w=t.w+i.w,n},t.subtract=function(n,t,i){return n.x=t.x-i.x,n.y=t.y-i.y,n.z=t.z-i.z,n.w=t.w-i.w,n},t.multiply=function(n,t,i){return n.x=t.x*i.x,n.y=t.y*i.y,n.z=t.z*i.z,n.w=t.w*i.w,n},t.divide=function(n,t,i){return n.x=t.x/i.x,n.y=t.y/i.y,n.z=t.z/i.z,n.w=t.w/i.w,n},t.ceil=function(n,t){return n.x=Math.ceil(t.x),n.y=Math.ceil(t.y),n.z=Math.ceil(t.z),n.w=Math.ceil(t.w),n},t.floor=function(n,t){return n.x=Math.floor(t.x),n.y=Math.floor(t.y),n.z=Math.floor(t.z),n.w=Math.floor(t.w),n},t.min=function(n,t,i){return n.x=Math.min(t.x,i.x),n.y=Math.min(t.y,i.y),n.z=Math.min(t.z,i.z),n.w=Math.min(t.w,i.w),n},t.max=function(n,t,i){return n.x=Math.max(t.x,i.x),n.y=Math.max(t.y,i.y),n.z=Math.max(t.z,i.z),n.w=Math.max(t.w,i.w),n},t.round=function(n,t){return n.x=Math.round(t.x),n.y=Math.round(t.y),n.z=Math.round(t.z),n.w=Math.round(t.w),n},t.multiplyScalar=function(n,t,i){return n.x=t.x*i,n.y=t.y*i,n.z=t.z*i,n.w=t.w*i,n},t.scaleAndAdd=function(n,t,i,r){return n.x=t.x+i.x*r,n.y=t.y+i.y*r,n.z=t.z+i.z*r,n.w=t.w+i.w*r,n},t.distance=function(n,t){var i=t.x-n.x,r=t.y-n.y,u=t.z-n.z,f=t.w-n.w;return Math.sqrt(i*i+r*r+u*u+f*f)},t.squaredDistance=function(n,t){var i=t.x-n.x,r=t.y-n.y,u=t.z-n.z,f=t.w-n.w;return i*i+r*r+u*u+f*f},t.len=function(n){return r=n.x,u=n.y,f=n.z,e=n.w,Math.sqrt(r*r+u*u+f*f+e*e)},t.lengthSqr=function(n){return r=n.x,u=n.y,f=n.z,e=n.w,r*r+u*u+f*f+e*e},t.negate=function(n,t){return n.x=-t.x,n.y=-t.y,n.z=-t.z,n.w=-t.w,n},t.inverse=function(n,t){return n.x=1/t.x,n.y=1/t.y,n.z=1/t.z,n.w=1/t.w,n},t.inverseSafe=function(n,t){return r=t.x,u=t.y,f=t.z,e=t.w,n.x=Math.abs(r)<s.EPSILON?0:1/r,n.y=Math.abs(u)<s.EPSILON?0:1/u,n.z=Math.abs(f)<s.EPSILON?0:1/f,n.w=Math.abs(e)<s.EPSILON?0:1/e,n},t.normalize=function(n,t){r=t.x;u=t.y;f=t.z;e=t.w;var i=r*r+u*u+f*f+e*e;return i>0&&(i=1/Math.sqrt(i),n.x=r*i,n.y=u*i,n.z=f*i,n.w=e*i),n},t.dot=function(n,t){return n.x*t.x+n.y*t.y+n.z*t.z+n.w*t.w},t.lerp=function(n,t,i,r){return n.x=t.x+r*(i.x-t.x),n.y=t.y+r*(i.y-t.y),n.z=t.z+r*(i.z-t.z),n.w=t.w+r*(i.w-t.w),n},t.random=function(n,t){t=t||1;var r=2*s.random()*Math.PI,i=2*s.random()-1,u=Math.sqrt(1-i*i);return n.x=u*Math.cos(r)*t,n.y=u*Math.sin(r)*t,n.z=i*t,n.w=0,n},t.transformMat4=function(n,t,i){r=t.x;u=t.y;f=t.z;e=t.w;var o=i.m;return n.x=o[0]*r+o[4]*u+o[8]*f+o[12]*e,n.y=o[1]*r+o[5]*u+o[9]*f+o[13]*e,n.z=o[2]*r+o[6]*u+o[10]*f+o[14]*e,n.w=o[3]*r+o[7]*u+o[11]*f+o[15]*e,n},t.transformAffine=function(n,t,i){r=t.x;u=t.y;f=t.z;e=t.w;var o=i.m;return n.x=o[0]*r+o[1]*u+o[2]*f+o[3]*e,n.y=o[4]*r+o[5]*u+o[6]*f+o[7]*e,n.x=o[8]*r+o[9]*u+o[10]*f+o[11]*e,n.w=t.w,n},t.transformQuat=function(n,t,i){var o=t.x,s=t.y,h=t.z;r=i.x;u=i.y;f=i.z;var c=(e=i.w)*o+u*h-f*s,l=e*s+f*o-r*h,a=e*h+r*s-u*o,v=-r*o-u*s-f*h;return n.x=c*e+v*-r+l*-f-a*-u,n.y=l*e+v*-u+a*-r-c*-f,n.z=a*e+v*-f+c*-u-l*-r,n.w=t.w,n},t.strictEquals=function(n,t){return n.x===t.x&&n.y===t.y&&n.z===t.z&&n.w===t.w},t.equals=function(n,t,i){return void 0===i&&(i=s.EPSILON),Math.abs(n.x-t.x)<=i*Math.max(1,Math.abs(n.x),Math.abs(t.x))&&Math.abs(n.y-t.y)<=i*Math.max(1,Math.abs(n.y),Math.abs(t.y))&&Math.abs(n.z-t.z)<=i*Math.max(1,Math.abs(n.z),Math.abs(t.z))&&Math.abs(n.w-t.w)<=i*Math.max(1,Math.abs(n.w),Math.abs(t.w))},t.toArray=function(n,t,i){return void 0===i&&(i=0),n[i+0]=t.x,n[i+1]=t.y,n[i+2]=t.z,n[i+3]=t.w,n},t.fromArray=function(n,t,i){return void 0===i&&(i=0),n.x=t[i+0],n.y=t[i+1],n.z=t[i+2],n.w=t[i+3],n},l=t,a=[{key:"ZERO",get:function(){return new t(0,0,0,0)}},{key:"ONE",get:function(){return new t(1,1,1,1)}},{key:"NEG_ONE",get:function(){return new t(-1,-1,-1,-1)}}],null&&c(l.prototype,null),a&&c(l,a),i.clone=function(){return new t(this.x,this.y,this.z,this.w)},i.set=function(n,t,i,r){return n&&"object"==typeof n?(this.x=n.x,this.y=n.y,this.z=n.z,this.w=n.w):(this.x=n||0,this.y=t||0,this.z=i||0,this.w=r||0),this},i.equals=function(n,t){return void 0===t&&(t=s.EPSILON),Math.abs(this.x-n.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(n.x))&&Math.abs(this.y-n.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(n.y))&&Math.abs(this.z-n.z)<=t*Math.max(1,Math.abs(this.z),Math.abs(n.z))&&Math.abs(this.w-n.w)<=t*Math.max(1,Math.abs(this.w),Math.abs(n.w))},i.equals4f=function(n,t,i,r,u){return void 0===u&&(u=s.EPSILON),Math.abs(this.x-n)<=u*Math.max(1,Math.abs(this.x),Math.abs(n))&&Math.abs(this.y-t)<=u*Math.max(1,Math.abs(this.y),Math.abs(t))&&Math.abs(this.z-i)<=u*Math.max(1,Math.abs(this.z),Math.abs(i))&&Math.abs(this.w-r)<=u*Math.max(1,Math.abs(this.w),Math.abs(r))},i.strictEquals=function(n){return this.x===n.x&&this.y===n.y&&this.z===n.z&&this.w===n.w},i.strictEquals4f=function(n,t,i,r){return this.x===n&&this.y===t&&this.z===i&&this.w===r},i.lerp=function(n,t){return r=this.x,u=this.y,f=this.z,e=this.w,this.x=r+t*(n.x-r),this.y=u+t*(n.y-u),this.z=f+t*(n.z-f),this.w=e+t*(n.w-e),this},i.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+", "+this.w.toFixed(2)+")"},i.clampf=function(n,t){return this.x=s.clamp(this.x,n.x,t.x),this.y=s.clamp(this.y,n.y,t.y),this.z=s.clamp(this.z,n.z,t.z),this.w=s.clamp(this.w,n.w,t.w),this},i.addSelf=function(n){return this.x+=n.x,this.y+=n.y,this.z+=n.z,this.w+=n.w,this},i.add=function(n,i){return(i=i||new t).x=this.x+n.x,i.y=this.y+n.y,i.z=this.z+n.z,i.w=this.w+n.w,i},i.subtract=function(n,i){return(i=i||new t).x=this.x-n.x,i.y=this.y-n.y,i.z=this.z-n.z,i.w=this.w-n.w,i},i.multiplyScalar=function(n){return this.x*=n,this.y*=n,this.z*=n,this.w*=n,this},i.multiply=function(n){return this.x*=n.x,this.y*=n.y,this.z*=n.z,this.w*=n.w,this},i.divide=function(n){return this.x/=n,this.y/=n,this.z/=n,this.w/=n,this},i.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},i.dot=function(n){return this.x*n.x+this.y*n.y+this.z*n.z+this.w*n.w},i.cross=function(n,i){i=i||new t;var r=this.x,u=this.y,f=this.z,e=n.x,o=n.y,s=n.z;return i.x=u*s-f*o,i.y=f*e-r*s,i.z=r*o-u*e,i},i.len=function(){var n=this.x,t=this.y,i=this.z,r=this.w;return Math.sqrt(n*n+t*t+i*i+r*r)},i.lengthSqr=function(){var n=this.x,t=this.y,i=this.z,r=this.w;return n*n+t*t+i*i+r*r},i.normalizeSelf=function(){return this.normalize(this),this},i.normalize=function(n){n=n||new t;r=this.x;u=this.y;f=this.z;e=this.w;var i=r*r+u*u+f*f+e*e;return i>0&&(i=1/Math.sqrt(i),n.x=r*i,n.y=u*i,n.z=f*i,n.w=e*i),n},i.transformMat4=function(n,i){i=i||new t;r=this.x;u=this.y;f=this.z;e=this.w;var o=n.m;return i.x=o[0]*r+o[4]*u+o[8]*f+o[12]*e,i.y=o[1]*r+o[5]*u+o[9]*f+o[13]*e,i.z=o[2]*r+o[6]*u+o[10]*f+o[14]*e,i.w=o[3]*r+o[7]*u+o[11]*f+o[15]*e,i},i.maxAxis=function(){return Math.max(this.x,this.y,this.z,this.w)},t}(v.default);i.default=o;o.sub=o.subtract;o.mul=o.multiply;o.div=o.divide;o.scale=o.multiplyScalar;o.mag=o.len;o.squaredMagnitude=o.lengthSqr;o.ZERO_R=o.ZERO;o.ONE_R=o.ONE;o.NEG_ONE_R=o.NEG_ONE;a.default.fastDefine("cc.Vec4",o,{x:0,y:0,z:0,w:0});cc.v4=l;cc.Vec4=o},{"../platform/CCClass":195,"./utils":291,"./value-type":292}],296:[function(){"use strict";cc.js},{}],297:[function(n){"use strict";n("./core/CCGame");n("./actions")},{"./actions":7,"./core/CCGame":28}],298:[function(n,t){"use strict";var u=n("../compression/zlib.min"),r=n("../core/CCDebug"),i=function(n){var t,h,c,l,i,o,a,v,u,s,f,e,y;for(this.data=n,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},i=null;;){switch(t=this.readUInt32(),v=function(){for(var t=[],n=0;n<4;++n)t.push(String.fromCharCode(this.data[this.pos++]));return t}.call(this).join("")){case"IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(t);break;case"fcTL":i&&this.animation.frames.push(i);this.pos+=4;i={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};l=this.readUInt16();c=this.readUInt16()||100;i.delay=1e3*l/c;i.disposeOp=this.data[this.pos++];i.blendOp=this.data[this.pos++];i.data=[];break;case"IDAT":case"fdAT":for("fdAT"===v&&(this.pos+=4,t-=4),n=(null!=i?i.data:void 0)||this.imgData,f=0;0<=t?f<t:f>t;0<=t?++f:--f)n.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(t),(u=255-this.transparency.indexed.length)>0)for(e=0;0<=u?e<u:e>u;0<=u?++e:--e)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(t)[0];break;case 2:this.transparency.rgb=this.read(t)}break;case"tEXt":o=(s=this.read(t)).indexOf(0);a=String.fromCharCode.apply(String,s.slice(0,o));this.text[a]=String.fromCharCode.apply(String,s.slice(o+1));break;case"IEND":return i&&this.animation.frames.push(i),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=4===(y=this.colorType)||6===y,h=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*h,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(Uint8Array!=Array&&(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=t}if(this.pos+=4,this.pos>this.data.length)throw new Error(r.getError(6017));}};i.prototype={constructor:i,read:function(n){for(var i=[],t=0;0<=n?t<n:t>n;0<=n?++t:--t)i.push(this.data[this.pos++]);return i},readUInt32:function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},readUInt16:function(){return this.data[this.pos++]<<8|this.data[this.pos++]},decodePixels:function(n){var l,o,a,t,v,rt,p,w,ut,b,k,i,f,s,h,e,c,y,d,g,nt,tt,it;if(null==n&&(n=this.imgData),0===n.length)return new Uint8Array(0);for(n=new u.Inflate(n,{index:0,verify:!1}).decompress(),e=(i=this.pixelBitlength/8)*this.width,f=new Uint8Array(e*this.height),rt=n.length,h=0,s=0,o=0;s<rt;){switch(n[s++]){case 0:for(t=d=0;d<e;t=d+=1)f[o++]=n[s++];break;case 1:for(t=g=0;g<e;t=g+=1)l=n[s++],v=t<i?0:f[o-i],f[o++]=(l+v)%256;break;case 2:for(t=nt=0;nt<e;t=nt+=1)l=n[s++],a=(t-t%i)/i,c=h&&f[(h-1)*e+a*i+t%i],f[o++]=(c+l)%256;break;case 3:for(t=tt=0;tt<e;t=tt+=1)l=n[s++],a=(t-t%i)/i,v=t<i?0:f[o-i],c=h&&f[(h-1)*e+a*i+t%i],f[o++]=(l+Math.floor((v+c)/2))%256;break;case 4:for(t=it=0;it<e;t=it+=1)l=n[s++],a=(t-t%i)/i,v=t<i?0:f[o-i],0===h?c=y=0:(c=f[(h-1)*e+a*i+t%i],y=a&&f[(h-1)*e+(a-1)*i+t%i]),p=v+c-y,w=Math.abs(p-v),b=Math.abs(p-c),k=Math.abs(p-y),ut=w<=b&&w<=k?v:b<=k?c:y,f[o++]=(l+ut)%256;break;default:throw new Error(r.getError(6018,n[s-1]));}h++}return f},copyToImageData:function(n,t){var s,c,u,i,f,e,r,l,o,h,a;if(c=this.colors,o=null,s=this.hasAlphaChannel,this.palette.length&&(o=null!=(a=this._decodedPalette)?a:this._decodedPalette=this.decodePalette(),c=4,s=!0),l=(u=n.data||n).length,f=o||t,i=e=0,1===c)for(;i<l;)r=o?4*t[i/4]:e,h=f[r++],u[i++]=h,u[i++]=h,u[i++]=h,u[i++]=s?f[r++]:255,e=r;else for(;i<l;)r=o?4*t[i/4]:e,u[i++]=f[r++],u[i++]=f[r++],u[i++]=f[r++],u[i++]=s?f[r++]:255,e=r},decodePalette:function(){var e,i,n,r,t,u,f,o,s;for(n=this.palette,u=this.transparency.indexed||[],t=new Uint8Array((u.length||0)+n.length),r=0,e=0,i=f=0,o=n.length;f<o;i=f+=3)t[r++]=n[i],t[r++]=n[i+1],t[r++]=n[i+2],t[r++]=null!=(s=u[e++])?s:255;return t},render:function(n){var i,t;return n.width=this.width,n.height=this.height,t=(i=n.getContext("2d")).createImageData(this.width,this.height),this.copyToImageData(t,this.decodePixels()),i.putImageData(t,0,0)}};t.exports=i},{"../compression/zlib.min":25,"../core/CCDebug":26}],299:[function(n,t){"use strict";var i=n("../core/assets/CCAsset"),r=n("../core/assets/CCSpriteFrame"),u=cc.Class({name:"cc.ParticleAsset","extends":i,properties:{spriteFrame:{"default":null,type:r}}});cc.ParticleAsset=t.exports=u},{"../core/assets/CCAsset":62,"../core/assets/CCSpriteFrame":74}],300:[function(n,t){"use strict";var i=n("../core/platform/CCMacro"),f=n("./CCParticleAsset"),c=n("../core/components/CCRenderComponent"),l=n("../compression/ZipUtils"),e=n("./CCPNGReader"),o=n("./CCTIFFReader"),s=n("../core/utils/texture-util"),a=(n("../core/renderer/render-flow"),n("./particle-simulator")),h=(n("../core/assets/material/CCMaterial"),n("../core/utils/blend-func")),r=cc.Enum({GRAVITY:0,RADIUS:1}),u=cc.Enum({FREE:0,RELATIVE:1,GROUPED:2}),v={preview:{"default":!0,editorOnly:!0,notify:!1,animatable:!1,tooltip:!1},_custom:!1,custom:{get:function(){return this._custom},set:function(n){this._custom!==n&&(this._custom=n,this._applyFile())},animatable:!1,tooltip:!1},_file:{"default":null,type:f},file:{get:function(){return this._file},set:function(n){this._file!==n&&(this._file=n,n?this._applyFile():this.custom=!0)},animatable:!1,type:f,tooltip:!1},_spriteFrame:{"default":null,type:cc.SpriteFrame},spriteFrame:{get:function(){return this._spriteFrame},set:function(n){var t=this._renderSpriteFrame;t!==n&&(this._renderSpriteFrame=n,n&&!n._uuid||(this._spriteFrame=n),this._applySpriteFrame(t))},type:cc.SpriteFrame,tooltip:!1},_texture:{"default":null,type:cc.Texture2D,editorOnly:!0},texture:{get:function(){return this._getTexture()},set:function(n){n&&cc.warnID(6017)},type:cc.Texture2D,tooltip:!1,readonly:!0,visible:!1,animatable:!1},particleCount:{visible:!1,get:function(){return this._simulator.particles.length},readonly:!0},_stopped:!0,stopped:{get:function(){return this._stopped},animatable:!1,visible:!1},playOnLoad:!0,autoRemoveOnFinish:{"default":!1,animatable:!1,tooltip:!1},active:{get:function(){return this._simulator.active},visible:!1},totalParticles:150,duration:-1,emissionRate:10,life:1,lifeVar:0,_startColor:null,startColor:{type:cc.Color,get:function(){return this._startColor},set:function(n){this._startColor.r=n.r;this._startColor.g=n.g;this._startColor.b=n.b;this._startColor.a=n.a}},_startColorVar:null,startColorVar:{type:cc.Color,get:function(){return this._startColorVar},set:function(n){this._startColorVar.r=n.r;this._startColorVar.g=n.g;this._startColorVar.b=n.b;this._startColorVar.a=n.a}},_endColor:null,endColor:{type:cc.Color,get:function(){return this._endColor},set:function(n){this._endColor.r=n.r;this._endColor.g=n.g;this._endColor.b=n.b;this._endColor.a=n.a}},_endColorVar:null,endColorVar:{type:cc.Color,get:function(){return this._endColorVar},set:function(n){this._endColorVar.r=n.r;this._endColorVar.g=n.g;this._endColorVar.b=n.b;this._endColorVar.a=n.a}},angle:90,angleVar:20,startSize:50,startSizeVar:0,endSize:0,endSizeVar:0,startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,sourcePos:cc.Vec2.ZERO,posVar:cc.Vec2.ZERO,_positionType:{"default":u.FREE,formerlySerializedAs:"positionType"},positionType:{type:u,get:function(){return this._positionType},set:function(n){this._positionType=n;this._updateMaterial()}},emitterMode:{"default":r.GRAVITY,type:r},gravity:cc.Vec2.ZERO,speed:180,speedVar:50,tangentialAccel:80,tangentialAccelVar:0,radialAccel:0,radialAccelVar:0,rotationIsDir:!1,startRadius:0,startRadiusVar:0,endRadius:0,endRadiusVar:0,rotatePerS:0,rotatePerSVar:0},y=cc.Class({name:"cc.ParticleSystem","extends":c,mixins:[h],editor:!1,ctor:function(){this.initProperties()},initProperties:function(){this._previewTimer=null;this._focused=!1;this._aspectRatio=1;this._simulator=new a(this);this._startColor=cc.color(255,255,255,255);this._startColorVar=cc.color(0,0,0,0);this._endColor=cc.color(255,255,255,0);this._endColorVar=cc.color(0,0,0,0);this._renderSpriteFrame=null},properties:v,statics:{DURATION_INFINITY:-1,START_SIZE_EQUAL_TO_END_SIZE:-1,START_RADIUS_EQUAL_TO_END_RADIUS:-1,EmitterMode:r,PositionType:u,_PNGReader:e,_TIFFReader:o},onFocusInEditor:!1,onLostFocusInEditor:!1,_startPreview:!1,_stopPreview:!1,_convertTextureToSpriteFrame:!1,__preload:function(){this._super();this._custom&&this.spriteFrame&&!this._renderSpriteFrame?this._applySpriteFrame(this.spriteFrame):this._file&&(this._custom?!this._getTexture()&&this._applyFile():this._applyFile());this.playOnLoad&&this.resetSystem()},onDestroy:function(){this.autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1);this._buffer&&(this._buffer.destroy(),this._buffer=null);this._simulator._uvFilled=0;this._super()},lateUpdate:function(n){this._simulator.finished||this._simulator.step(n)},addParticle:function(){},stopSystem:function(){this._stopped=!0;this._simulator.stop()},resetSystem:function(){this._stopped=!1;this._simulator.reset();this.markForRender(!0)},isFull:function(){return this.particleCount>=this.totalParticles},setTextureWithRect:function(n,t){n instanceof cc.Texture2D&&(this.spriteFrame=new cc.SpriteFrame(n,t))},_applyFile:function(){var t=this._file,n;t&&(n=this,cc.assetManager.postLoadNative(t,function(i){!i&&t._nativeAsset?n.isValid&&(n._plistFile=t.nativeUrl,n._custom||(n._spriteFrame!==t.spriteFrame&&(n.spriteFrame=t.spriteFrame),n._initWithDictionary(t._nativeAsset)),n._spriteFrame?!n._renderSpriteFrame&&n._spriteFrame&&n._applySpriteFrame(n.spriteFrame):t.spriteFrame?n.spriteFrame=t.spriteFrame:n._custom&&n._initTextureWithDictionary(t._nativeAsset)):cc.errorID(6029)}))},_initTextureWithDictionary:function(n){var t,f=cc.path.changeBasename(this._plistFile,n.textureFileName||""),h,r,u,c,a;if(n.textureFileName)s.loadImage(f,function(t,i){t?(n.textureFileName=void 0,this._initTextureWithDictionary(n)):(cc.assetManager.assets.add(f,i),this.spriteFrame=new cc.SpriteFrame(i))},this);else if(n.textureImageData){if(h=n.textureImageData,!(h&&h.length>0))return!1;if(r=cc.assetManager.assets.get(f),!r){if(u=l.unzipBase64AsArray(h,1),!u)return cc.warnID(6030,this._file.name),!1;if(c=(t=u).length>8&&137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7]?i.ImageFormat.PNG:t.length>2&&(73===t[0]&&73===t[1]||77===t[0]&&77===t[1]||255===t[0]&&216===t[1])?i.ImageFormat.TIFF:i.ImageFormat.UNKNOWN,c!==i.ImageFormat.TIFF&&c!==i.ImageFormat.PNG)return cc.warnID(6031,this._file.name),!1;a=document.createElement("canvas");c===i.ImageFormat.PNG?new e(u).render(a):o.parseTIFF(u,a);r=s.cacheImage(f,a)}r||cc.warnID(6032,this._file.name);this.spriteFrame=new cc.SpriteFrame(r)}return!0},_initWithDictionary:function(n){var h,f,e,o,s,t;if(this.totalParticles=parseInt(n.maxParticles||0),this.life=parseFloat(n.particleLifespan||0),this.lifeVar=parseFloat(n.particleLifespanVariance||0),h=n.emissionRate,this.emissionRate=h||Math.min(this.totalParticles/this.life,Number.MAX_VALUE),this.duration=parseFloat(n.duration||0),this.srcBlendFactor=parseInt(n.blendFuncSource||i.SRC_ALPHA),this.dstBlendFactor=parseInt(n.blendFuncDestination||i.ONE_MINUS_SRC_ALPHA),f=this._startColor,f.r=255*parseFloat(n.startColorRed||0),f.g=255*parseFloat(n.startColorGreen||0),f.b=255*parseFloat(n.startColorBlue||0),f.a=255*parseFloat(n.startColorAlpha||0),e=this._startColorVar,e.r=255*parseFloat(n.startColorVarianceRed||0),e.g=255*parseFloat(n.startColorVarianceGreen||0),e.b=255*parseFloat(n.startColorVarianceBlue||0),e.a=255*parseFloat(n.startColorVarianceAlpha||0),o=this._endColor,o.r=255*parseFloat(n.finishColorRed||0),o.g=255*parseFloat(n.finishColorGreen||0),o.b=255*parseFloat(n.finishColorBlue||0),o.a=255*parseFloat(n.finishColorAlpha||0),s=this._endColorVar,s.r=255*parseFloat(n.finishColorVarianceRed||0),s.g=255*parseFloat(n.finishColorVarianceGreen||0),s.b=255*parseFloat(n.finishColorVarianceBlue||0),s.a=255*parseFloat(n.finishColorVarianceAlpha||0),this.startSize=parseFloat(n.startParticleSize||0),this.startSizeVar=parseFloat(n.startParticleSizeVariance||0),this.endSize=parseFloat(n.finishParticleSize||0),this.endSizeVar=parseFloat(n.finishParticleSizeVariance||0),this.positionType=parseFloat(void 0!==n.positionType?n.positionType:u.RELATIVE),this.sourcePos.x=0,this.sourcePos.y=0,this.posVar.x=parseFloat(n.sourcePositionVariancex||0),this.posVar.y=parseFloat(n.sourcePositionVariancey||0),this.angle=parseFloat(n.angle||0),this.angleVar=parseFloat(n.angleVariance||0),this.startSpin=parseFloat(n.rotationStart||0),this.startSpinVar=parseFloat(n.rotationStartVariance||0),this.endSpin=parseFloat(n.rotationEnd||0),this.endSpinVar=parseFloat(n.rotationEndVariance||0),this.emitterMode=parseInt(n.emitterType||r.GRAVITY),this.emitterMode===r.GRAVITY)this.gravity.x=parseFloat(n.gravityx||0),this.gravity.y=parseFloat(n.gravityy||0),this.speed=parseFloat(n.speed||0),this.speedVar=parseFloat(n.speedVariance||0),this.radialAccel=parseFloat(n.radialAcceleration||0),this.radialAccelVar=parseFloat(n.radialAccelVariance||0),this.tangentialAccel=parseFloat(n.tangentialAcceleration||0),this.tangentialAccelVar=parseFloat(n.tangentialAccelVariance||0),t=n.rotationIsDir||"",null!==t?(t=t.toString().toLowerCase(),this.rotationIsDir="true"===t||"1"===t):this.rotationIsDir=!1;else{if(this.emitterMode!==r.RADIUS)return cc.warnID(6009),!1;this.startRadius=parseFloat(n.maxRadius||0);this.startRadiusVar=parseFloat(n.maxRadiusVariance||0);this.endRadius=parseFloat(n.minRadius||0);this.endRadiusVar=parseFloat(n.minRadiusVariance||0);this.rotatePerS=parseFloat(n.rotatePerSecond||0);this.rotatePerSVar=parseFloat(n.rotatePerSecondVariance||0)}return this._initTextureWithDictionary(n),!0},_validateRender:function(){var n=this._getTexture();n&&n.loaded?this._super():this.disableRender()},_onTextureLoaded:function(){this._simulator.updateUVs(!0);this._syncAspect();this._updateMaterial();this.markForRender(!0)},_syncAspect:function(){var n=this._renderSpriteFrame._rect;this._aspectRatio=n.width/n.height},_applySpriteFrame:function(){this._renderSpriteFrame=this._renderSpriteFrame||this._spriteFrame;this._renderSpriteFrame&&(this._renderSpriteFrame.textureLoaded()?this._onTextureLoaded():this._renderSpriteFrame.onTextureLoaded(this._onTextureLoaded,this))},_getTexture:function(){return this._renderSpriteFrame&&this._renderSpriteFrame.getTexture()||this._texture},_updateMaterial:function(){var n=this.getMaterial(0);n&&(n.define("CC_USE_MODEL",this._positionType!==u.FREE),n.setProperty("texture",this._getTexture()),h.prototype._updateMaterial.call(this))},_finishedSimulation:function(){this.resetSystem();this.stopSystem();this.disableRender();this.autoRemoveOnFinish&&this._stopped&&this.node.destroy()}});cc.ParticleSystem=t.exports=y},{"../compression/ZipUtils":22,"../core/assets/material/CCMaterial":80,"../core/components/CCRenderComponent":115,"../core/platform/CCMacro":200,"../core/renderer/render-flow":227,"../core/utils/blend-func":263,"../core/utils/texture-util":277,"./CCPNGReader":298,"./CCParticleAsset":299,"./CCTIFFReader":301,"./particle-simulator":303,"fire-url":void 0}],301:[function(n,t){"use strict";var i=n("../core/CCDebug"),r={_littleEndian:!1,_tiffData:null,_fileDirectories:[],getUint8:function(n){return this._tiffData[n]},getUint16:function(n){return this._littleEndian?this._tiffData[n+1]<<8|this._tiffData[n]:this._tiffData[n]<<8|this._tiffData[n+1]},getUint32:function(n){var t=this._tiffData;return this._littleEndian?t[n+3]<<24|t[n+2]<<16|t[n+1]<<8|t[n]:t[n]<<24|t[n+1]<<16|t[n+2]<<8|t[n+3]},checkLittleEndian:function(){var n=this.getUint16(0);if(18761===n)this.littleEndian=!0;else{if(19789!==n)throw console.log(n),TypeError(i.getError(6019));this.littleEndian=!1}return this.littleEndian},hasTowel:function(){if(42!==this.getUint16(2))throw RangeError(i.getError(6020));return!0},getFieldTypeName:function(n){var t=this.fieldTypeNames;return n in t?t[n]:null},getFieldTagName:function(n){var t=this.fieldTagNames;return n in t?t[n]:(cc.logID(6021,n),"Tag"+n)},getFieldTypeLength:function(n){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(n)?1:-1!==["SHORT","SSHORT"].indexOf(n)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(n)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(n)?8:null},getFieldValues:function(n,t,i,r){var u=[],f=this.getFieldTypeLength(t),e,o;if(f*i<=4)!1===this.littleEndian?u.push(r>>>8*(4-f)):u.push(r);else for(e=0;e<i;e++)o=f*e,f>=8?-1!==["RATIONAL","SRATIONAL"].indexOf(t)?(u.push(this.getUint32(r+o)),u.push(this.getUint32(r+o+4))):cc.logID(8e3):u.push(this.getBytes(f,r+o));return"ASCII"===t&&u.forEach(function(n,t,i){i[t]=String.fromCharCode(n)}),u},getBytes:function(n,t){if(n<=0)cc.logID(8001);else{if(n<=1)return this.getUint8(t);if(n<=2)return this.getUint16(t);if(n<=3)return this.getUint32(t)>>>8;if(n<=4)return this.getUint32(t);cc.logID(8002)}},getBits:function(n,t,i){i=i||0;var u,f,e=t+Math.floor(i/8),r=i+n,o=32-n;return r<=0?cc.logID(6023):r<=8?(u=24+i,f=this.getUint8(e)):r<=16?(u=16+i,f=this.getUint16(e)):r<=32?(u=i,f=this.getUint32(e)):cc.logID(6022),{bits:f<<u>>>o,byteOffset:e+Math.floor(r/8),bitOffset:r%8}},parseFileDirectory:function(n){for(var i,o=this.getUint16(n),r=[],t=n+2,u=0;u<o;t+=12,u++){var s=this.getUint16(t),h=this.getUint16(t+2),c=this.getUint32(t+4),l=this.getUint32(t+8),f=this.getFieldTagName(s),e=this.getFieldTypeName(h),a=this.getFieldValues(f,e,c,l);r[f]={type:e,values:a}}this._fileDirectories.push(r);i=this.getUint32(t);0!==i&&this.parseFileDirectory(i)},clampColorSample:function(n,t){var i=Math.pow(2,8-t);return Math.floor(n*i+(i-1))},parseTIFF:function(n,t){var bt,gt,st,ht,ct,f,l,e,nt,ti,ui,tt,p,pt,it,v,ai,et;if(t=t||document.createElement("canvas"),this._tiffData=n,this.canvas=t,this.checkLittleEndian(),this.hasTowel()){bt=this.getUint32(4);this._fileDirectories.length=0;this.parseFileDirectory(bt);var r=this._fileDirectories[0],ot=r.ImageWidth.values[0],w=r.ImageLength.values[0];this.canvas.width=ot;this.canvas.height=w;var c=[],vi=r.Compression?r.Compression.values[0]:1,kt=r.SamplesPerPixel.values[0],u=[],b=0,dt=!1;if((r.BitsPerSample.values.forEach(function(n,t){u[t]={bitsPerSample:n,hasBytesPerSample:!1,bytesPerSample:void 0};n%8==0&&(u[t].hasBytesPerSample=!0,u[t].bytesPerSample=n/8);b+=n},this),b%8==0)&&(dt=!0,gt=b/8),st=r.StripOffsets.values,ht=st.length,r.StripByteCounts)ct=r.StripByteCounts.values;else{if(cc.logID(8003),1!==ht)throw Error(i.getError(6024));ct=[Math.ceil(ot*w*b/8)]}for(f=0;f<ht;f++){l=st[f];c[f]=[];for(var yi=ct[f],o=0,ni=0,k=1,d=!0,s=[],lt=0,y=0,g=0;o<yi;o+=k)switch(vi){case 1:for(e=0,s=[];e<kt;e++){if(!u[e].hasBytesPerSample){nt=this.getBits(u[e].bitsPerSample,l+o,ni);throw s.push(nt.bits),o=nt.byteOffset-l,ni=nt.bitOffset,RangeError(i.getError(6025));}ti=u[e].bytesPerSample*e;s.push(this.getBytes(u[e].bytesPerSample,l+o+ti))}if(c[f].push(s),!dt)throw k=0,RangeError(i.getError(6026));k=gt;break;case 32773:if(d){d=!1;var ii=1,ri=1,a=this.getInt8(l+o);a>=0&&a<=127?ii=a+1:a>=-127&&a<=-1?ri=1-a:d=!0}else{for(ui=this.getUint8(l+o),e=0;e<ri;e++){if(!u[y].hasBytesPerSample)throw RangeError(i.getError(6025));g=g<<8*lt|ui;++lt===u[y].bytesPerSample&&(s.push(g),g=lt=0,y++);y===kt&&(c[f].push(s),s=[],y=0)}0==--ii&&(d=!0)}k=1}}if(t.getContext){tt=this.canvas.getContext("2d");tt.fillStyle="rgba(255, 255, 255, 0)";var at=r.RowsPerStrip?r.RowsPerStrip.values[0]:w,fi=c.length,ei=w%at,pi=0===ei?at:ei,oi=at,si=0,hi=r.PhotometricInterpretation.values[0],vt=[],yt=0;for((r.ExtraSamples&&(yt=(vt=r.ExtraSamples.values).length),r.ColorMap)&&(p=r.ColorMap.values,pt=Math.pow(2,u[0].bitsPerSample)),f=0;f<fi;f++){f+1===fi&&(oi=pi);for(var wi=c[f].length,bi=si*f,ci=0,wt=0;wt<wi;ci++)for(it=0;it<ot;it++,wt++){var h=c[f][wt],rt=0,ut=0,ft=0,li=1;if(yt>0)for(v=0;v<yt;v++)if(1===vt[v]||2===vt[v]){li=h[3+v]/256;break}switch(hi){case 0:u[0].hasBytesPerSample&&(ai=Math.pow(16,2*u[0].bytesPerSample));h.forEach(function(n,t,i){i[t]=ai-n});case 1:rt=ut=ft=this.clampColorSample(h[0],u[0].bitsPerSample);break;case 2:rt=this.clampColorSample(h[0],u[0].bitsPerSample);ut=this.clampColorSample(h[1],u[1].bitsPerSample);ft=this.clampColorSample(h[2],u[2].bitsPerSample);break;case 3:if(void 0===p)throw Error(i.getError(6027));et=h[0];rt=this.clampColorSample(p[et],16);ut=this.clampColorSample(p[pt+et],16);ft=this.clampColorSample(p[2*pt+et],16);break;default:throw RangeError(i.getError(6028,hi));}tt.fillStyle="rgba("+rt+", "+ut+", "+ft+", "+li+")";tt.fillRect(it,bi+ci,1,1)}si=oi}}return this.canvas}},fieldTagNames:{315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},fieldTypeNames:{1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"}};t.exports=r},{"../core/CCDebug":26}],302:[function(n){"use strict";n("./CCParticleAsset");n("./CCParticleSystem");n("./particle-simulator");n("./particle-system-assembler")},{"./CCParticleAsset":299,"./CCParticleSystem":300,"./particle-simulator":303,"./particle-system-assembler":304}],303:[function(n,t){"use strict";function a(n){for(var i=0,t=n;t;)i+=t.angle,t=t.parent;return i}var c=n("../core/platform/js"),r=n("../core/utils/misc"),f=cc.v2(0,0),u=cc.v2(),e=cc.v2(),s=cc.v2(),h=cc.v2(),l=function(){this.pos=cc.v2(0,0);this.startPos=cc.v2(0,0);this.color=cc.color(0,0,0,255);this.deltaColor={r:0,g:0,b:0,a:255};this.preciseColor={r:0,g:0,b:0,a:255};this.size=0;this.deltaSize=0;this.rotation=0;this.deltaRotation=0;this.timeToLive=0;this.drawPos=cc.v2(0,0);this.aspectRatio=1;this.dir=cc.v2(0,0);this.radialAccel=0;this.tangentialAccel=0;this.angle=0;this.degreesPerSecond=0;this.radius=0;this.deltaRadius=0},o=new c.Pool(function(n){n.pos.set(f);n.startPos.set(f);n.color._val=4278190080;n.deltaColor.r=n.deltaColor.g=n.deltaColor.b=0;n.deltaColor.a=255;n.size=0;n.deltaSize=0;n.rotation=0;n.deltaRotation=0;n.timeToLive=0;n.drawPos.set(f);n.aspectRatio=1;n.dir.set(f);n.radialAccel=0;n.tangentialAccel=0;n.angle=0;n.degreesPerSecond=0;n.radius=0;n.deltaRadius=0},1024),i;o.get=function(){return this._get()||new l};i=function(n){this.sys=n;this.particles=[];this.active=!1;this.readyToPlay=!0;this.finished=!1;this.elapsed=0;this.emitCounter=0;this._uvFilled=0;this._worldRotation=0};i.prototype.stop=function(){this.active=!1;this.readyToPlay=!1;this.elapsed=this.sys.duration;this.emitCounter=0};i.prototype.reset=function(){this.active=!0;this.readyToPlay=!0;this.elapsed=0;this.emitCounter=0;this.finished=!1;for(var n=this.particles,t=0;t<n.length;++t)o.put(n[t]);n.length=0};i.prototype.emitParticle=function(n){var t=this.sys,u=r.clampf,i=o.get(),k,d,g,nt,f,e,s,h,y,w,tt,p,it,b,rt;this.particles.push(i);i.timeToLive=t.life+t.lifeVar*(Math.random()-.5)*2;f=i.timeToLive=Math.max(0,i.timeToLive);i.pos.x=t.sourcePos.x+t.posVar.x*(Math.random()-.5)*2;i.pos.y=t.sourcePos.y+t.posVar.y*(Math.random()-.5)*2;var c=t._startColor,l=t._startColorVar,a=t._endColor,v=t._endColorVar;i.color.r=k=u(c.r+l.r*(Math.random()-.5)*2,0,255);i.color.g=d=u(c.g+l.g*(Math.random()-.5)*2,0,255);i.color.b=g=u(c.b+l.b*(Math.random()-.5)*2,0,255);i.color.a=nt=u(c.a+l.a*(Math.random()-.5)*2,0,255);e=i.color;s=i.preciseColor;s.r=e.r;s.g=e.g;s.b=e.b;s.a=e.a;i.deltaColor.r=(u(a.r+v.r*(Math.random()-.5)*2,0,255)-k)/f;i.deltaColor.g=(u(a.g+v.g*(Math.random()-.5)*2,0,255)-d)/f;i.deltaColor.b=(u(a.b+v.b*(Math.random()-.5)*2,0,255)-g)/f;i.deltaColor.a=(u(a.a+v.a*(Math.random()-.5)*2,0,255)-nt)/f;h=t.startSize+t.startSizeVar*(Math.random()-.5)*2;(h=Math.max(0,h),i.size=h,t.endSize===cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE)?i.deltaSize=0:(y=t.endSize+t.endSizeVar*(Math.random()-.5)*2,y=Math.max(0,y),i.deltaSize=(y-h)/f);w=t.startSpin+t.startSpinVar*(Math.random()-.5)*2;tt=t.endSpin+t.endSpinVar*(Math.random()-.5)*2;i.rotation=w;i.deltaRotation=(tt-w)/f;i.startPos.x=n.x;i.startPos.y=n.y;i.aspectRatio=t._aspectRatio||1;p=r.degreesToRadians(t.angle+this._worldRotation+t.angleVar*(Math.random()-.5)*2);t.emitterMode===cc.ParticleSystem.EmitterMode.GRAVITY?(it=t.speed+t.speedVar*(Math.random()-.5)*2,i.dir.x=Math.cos(p),i.dir.y=Math.sin(p),i.dir.mulSelf(it),i.radialAccel=t.radialAccel+t.radialAccelVar*(Math.random()-.5)*2,i.tangentialAccel=t.tangentialAccel+t.tangentialAccelVar*(Math.random()-.5)*2,t.rotationIsDir&&(i.rotation=-r.radiansToDegrees(Math.atan2(i.dir.y,i.dir.x)))):(b=t.startRadius+t.startRadiusVar*(Math.random()-.5)*2,rt=t.endRadius+t.endRadiusVar*(Math.random()-.5)*2,i.radius=b,i.deltaRadius=t.endRadius===cc.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS?0:(rt-b)/f,i.angle=p,i.degreesPerSecond=r.degreesToRadians(t.rotatePerS+t.rotatePerSVar*(Math.random()-.5)*2))};i.prototype.updateUVs=function(n){var u=this.sys._assembler,f,t;if(u&&(f=u.getBuffer(),f&&this.sys._renderSpriteFrame)){for(var s=u._vfmt._bytes/1,i=f._vData,r=this.sys._renderSpriteFrame.uv,h=n?0:this._uvFilled,o=this.particles.length,e=h;e<o;e++)t=e*s,i[t+2]=r[0],i[t+3]=r[1],i[t+7]=r[2],i[t+8]=r[3],i[t+12]=r[4],i[t+13]=r[5],i[t+17]=r[6],i[t+18]=r[7];this._uvFilled=o}};i.prototype.updateParticleBuffer=function(n,t,i,u){var f=i._vData,a=i._uintVData,e=t.x,o=t.y,v=n.size,k=v,d=n.aspectRatio,c,l;if(d>1?k=v/d:v=k*d,c=v/2,l=k/2,n.rotation){var y=-c,p=-l,w=c,b=l,g=-r.degreesToRadians(n.rotation),s=Math.cos(g),h=Math.sin(g);f[u]=y*s-p*h+e;f[u+1]=y*h+p*s+o;f[u+5]=w*s-p*h+e;f[u+6]=w*h+p*s+o;f[u+10]=y*s-b*h+e;f[u+11]=y*h+b*s+o;f[u+15]=w*s-b*h+e;f[u+16]=w*h+b*s+o}else f[u]=e-c,f[u+1]=o-l,f[u+5]=e+c,f[u+6]=o-l,f[u+10]=e-c,f[u+11]=o+l,f[u+15]=e+c,f[u+16]=o+l;a[u+4]=n.color._val;a[u+9]=n.color._val;a[u+14]=n.color._val;a[u+19]=n.color._val};i.prototype.step=function(n){var tt,it,p,d,c,t,rt,f,b,k,g,ut,ft;n=n>cc.director._maxParticleDeltaTime?cc.director._maxParticleDeltaTime:n;var i=this.sys,y=i.node,r=this.particles,et=this.sys._assembler._vfmt._bytes/1,nt=cc.ParticleSystem.PositionType;if((y._updateWorldMatrix(),i.positionType===nt.FREE)?(this._worldRotation=a(y),tt=y._worldMatrix.m,u.x=tt[12],u.y=tt[13]):i.positionType===nt.RELATIVE?(this._worldRotation=y.angle,u.x=y.x,u.y=y.y):this._worldRotation=0,this.active&&i.emissionRate){for(it=1/i.emissionRate,r.length<i.totalParticles&&(this.emitCounter+=n);r.length<i.totalParticles&&this.emitCounter>it;)this.emitParticle(u),this.emitCounter-=it;this.elapsed+=n;-1!==i.duration&&i.duration<this.elapsed&&i.stopSystem()}for(p=i._assembler.getBuffer(),d=r.length,p.reset(),p.request(4*d,6*d),d>this._uvFilled&&this.updateUVs(),c=0;c<r.length;)if(e.x=e.y=s.x=s.y=h.x=h.y=0,t=r[c],t.timeToLive-=n,t.timeToLive>0){if(i.emitterMode===cc.ParticleSystem.EmitterMode.GRAVITY){var l=h,w=e,v=s;(t.pos.x||t.pos.y)&&(w.set(t.pos),w.normalizeSelf());v.set(w);w.mulSelf(t.radialAccel);rt=v.x;v.x=-v.y;v.y=rt;v.mulSelf(t.tangentialAccel);l.set(w);l.addSelf(v);l.addSelf(i.gravity);l.mulSelf(n);t.dir.addSelf(l);l.set(t.dir);l.mulSelf(n);t.pos.addSelf(l)}else t.angle+=t.degreesPerSecond*n,t.radius+=t.deltaRadius*n,t.pos.x=-Math.cos(t.angle)*t.radius,t.pos.y=-Math.sin(t.angle)*t.radius;f=t.preciseColor;b=t.deltaColor;f.r+=b.r*n;f.g+=b.g*n;f.b+=b.b*n;f.a+=b.a*n;k=t.color;k.r=f.r;k.g=f.g;k.b=f.b;k.a=f.a;t.size+=t.deltaSize*n;t.size<0&&(t.size=0);t.rotation+=t.deltaRotation*n;g=e;g.set(t.pos);i.positionType!==nt.GROUPED&&g.addSelf(t.startPos);ut=et*c;this.updateParticleBuffer(t,g,p,ut);++c}else ft=r[c],c!==r.length-1&&(r[c]=r[r.length-1]),o.put(ft),r.length--;i._assembler._ia._count=6*r.length;r.length>0?p.uploadData():this.active||this.readyToPlay||(this.finished=!0,i._finishedSimulation())};t.exports=i},{"../core/platform/js":216,"../core/utils/misc":269}],304:[function(n,t){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}var i=r(n("../core/renderer/assembler")),e=r(n("../renderer/core/input-assembler")),o=n("./CCParticleSystem"),s=n("../core/renderer/"),h=n("../core/renderer/webgl/quad-buffer"),u=n("../core/renderer/webgl/vertex-format").vfmtPosUvColor,f=function(n){function r(t){var i;return(i=n.call(this,t)||this)._buffer=null,i._ia=null,i._vfmt=u,i}var t,i,f;return i=n,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,f=r.prototype,f.getBuffer=function(){return this._buffer||(this._buffer=new h(s._handle,u),this._ia=new e.default,this._ia._vertexBuffer=this._buffer._vb,this._ia._indexBuffer=this._buffer._ib,this._ia._start=0,this._ia._count=0),this._buffer},f.fillBuffers=function(n,t){if(this._ia){var i=cc.ParticleSystem.PositionType;t.node=n.positionType===i.RELATIVE?n.node.parent:n.node;t.material=n._materials[0];t._flushIA(this._ia)}},r}(i.default);i.default.register(o,f);t.exports=f},{"../core/renderer/":226,"../core/renderer/assembler":223,"../core/renderer/webgl/quad-buffer":255,"../core/renderer/webgl/vertex-format":258,"../renderer/core/input-assembler":307,"./CCParticleSystem":300}],305:[function(n,t){"use strict";var v,o,s,y,i,f,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt,ni,ti,ii,h,c,l,u,e,a,r,ui;(function(n){n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT";n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT";n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT";n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT";n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT";n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT";n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT";n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT";n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG";n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG";n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG";n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG";n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL"})(v||(v={})),function(n){n[n.UNKNOWN=0]="UNKNOWN";n[n.BUFFER=1]="BUFFER";n[n.TEXTURE=2]="TEXTURE";n[n.TEXTURE_VIEW=3]="TEXTURE_VIEW";n[n.RENDER_PASS=4]="RENDER_PASS";n[n.FRAMEBUFFER=5]="FRAMEBUFFER";n[n.SAMPLER=6]="SAMPLER";n[n.SHADER=7]="SHADER";n[n.PIPELINE_LAYOUT=8]="PIPELINE_LAYOUT";n[n.PIPELINE_STATE=9]="PIPELINE_STATE";n[n.BINDING_LAYOUT=10]="BINDING_LAYOUT";n[n.INPUT_ASSEMBLER=11]="INPUT_ASSEMBLER";n[n.COMMAND_ALLOCATOR=12]="COMMAND_ALLOCATOR";n[n.COMMAND_BUFFER=13]="COMMAND_BUFFER";n[n.QUEUE=14]="QUEUE";n[n.WINDOW=15]="WINDOW"}(o||(o={})),function(n){n[n.UNREADY=0]="UNREADY";n[n.FAILED=1]="FAILED";n[n.SUCCESS=2]="SUCCESS"}(s||(s={})),function(){function n(n){this._gfxType=o.UNKNOWN;this._status=s.UNREADY;this._gfxType=n}Object.defineProperty(n.prototype,"gfxType",{get:function(){return this._gfxType},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0})}(),function(n){n.ATTR_POSITION="a_position";n.ATTR_NORMAL="a_normal";n.ATTR_TANGENT="a_tangent";n.ATTR_BITANGENT="a_bitangent";n.ATTR_WEIGHTS="a_weights";n.ATTR_JOINTS="a_joints";n.ATTR_COLOR="a_color";n.ATTR_COLOR1="a_color1";n.ATTR_COLOR2="a_color2";n.ATTR_TEX_COORD="a_texCoord";n.ATTR_TEX_COORD1="a_texCoord1";n.ATTR_TEX_COORD2="a_texCoord2";n.ATTR_TEX_COORD3="a_texCoord3";n.ATTR_TEX_COORD4="a_texCoord4";n.ATTR_TEX_COORD5="a_texCoord5";n.ATTR_TEX_COORD6="a_texCoord6";n.ATTR_TEX_COORD7="a_texCoord7";n.ATTR_TEX_COORD8="a_texCoord8"}(y||(y={})),function(n){n[n.UNKNOWN=0]="UNKNOWN";n[n.BOOL=1]="BOOL";n[n.BOOL2=2]="BOOL2";n[n.BOOL3=3]="BOOL3";n[n.BOOL4=4]="BOOL4";n[n.INT=5]="INT";n[n.INT2=6]="INT2";n[n.INT3=7]="INT3";n[n.INT4=8]="INT4";n[n.UINT=9]="UINT";n[n.UINT2=10]="UINT2";n[n.UINT3=11]="UINT3";n[n.UINT4=12]="UINT4";n[n.FLOAT=13]="FLOAT";n[n.FLOAT2=14]="FLOAT2";n[n.FLOAT3=15]="FLOAT3";n[n.FLOAT4=16]="FLOAT4";n[n.COLOR4=17]="COLOR4";n[n.MAT2=18]="MAT2";n[n.MAT2X3=19]="MAT2X3";n[n.MAT2X4=20]="MAT2X4";n[n.MAT3X2=21]="MAT3X2";n[n.MAT3=22]="MAT3";n[n.MAT3X4=23]="MAT3X4";n[n.MAT4X2=24]="MAT4X2";n[n.MAT4X3=25]="MAT4X3";n[n.MAT4=26]="MAT4";n[n.SAMPLER1D=27]="SAMPLER1D";n[n.SAMPLER1D_ARRAY=28]="SAMPLER1D_ARRAY";n[n.SAMPLER2D=29]="SAMPLER2D";n[n.SAMPLER2D_ARRAY=30]="SAMPLER2D_ARRAY";n[n.SAMPLER3D=31]="SAMPLER3D";n[n.SAMPLER_CUBE=32]="SAMPLER_CUBE";n[n.COUNT=33]="COUNT"}(i||(i={})),function(n){n[n.UNKNOWN=0]="UNKNOWN";n[n.A8=1]="A8";n[n.L8=2]="L8";n[n.LA8=3]="LA8";n[n.R8=4]="R8";n[n.R8SN=5]="R8SN";n[n.R8UI=6]="R8UI";n[n.R8I=7]="R8I";n[n.R16F=8]="R16F";n[n.R16UI=9]="R16UI";n[n.R16I=10]="R16I";n[n.R32F=11]="R32F";n[n.R32UI=12]="R32UI";n[n.R32I=13]="R32I";n[n.RG8=14]="RG8";n[n.RG8SN=15]="RG8SN";n[n.RG8UI=16]="RG8UI";n[n.RG8I=17]="RG8I";n[n.RG16F=18]="RG16F";n[n.RG16UI=19]="RG16UI";n[n.RG16I=20]="RG16I";n[n.RG32F=21]="RG32F";n[n.RG32UI=22]="RG32UI";n[n.RG32I=23]="RG32I";n[n.RGB8=24]="RGB8";n[n.SRGB8=25]="SRGB8";n[n.RGB8SN=26]="RGB8SN";n[n.RGB8UI=27]="RGB8UI";n[n.RGB8I=28]="RGB8I";n[n.RGB16F=29]="RGB16F";n[n.RGB16UI=30]="RGB16UI";n[n.RGB16I=31]="RGB16I";n[n.RGB32F=32]="RGB32F";n[n.RGB32UI=33]="RGB32UI";n[n.RGB32I=34]="RGB32I";n[n.RGBA8=35]="RGBA8";n[n.SRGB8_A8=36]="SRGB8_A8";n[n.RGBA8SN=37]="RGBA8SN";n[n.RGBA8UI=38]="RGBA8UI";n[n.RGBA8I=39]="RGBA8I";n[n.RGBA16F=40]="RGBA16F";n[n.RGBA16UI=41]="RGBA16UI";n[n.RGBA16I=42]="RGBA16I";n[n.RGBA32F=43]="RGBA32F";n[n.RGBA32UI=44]="RGBA32UI";n[n.RGBA32I=45]="RGBA32I";n[n.R5G6B5=46]="R5G6B5";n[n.R11G11B10F=47]="R11G11B10F";n[n.RGB5A1=48]="RGB5A1";n[n.RGBA4=49]="RGBA4";n[n.RGB10A2=50]="RGB10A2";n[n.RGB10A2UI=51]="RGB10A2UI";n[n.RGB9E5=52]="RGB9E5";n[n.D16=53]="D16";n[n.D16S8=54]="D16S8";n[n.D24=55]="D24";n[n.D24S8=56]="D24S8";n[n.D32F=57]="D32F";n[n.D32F_S8=58]="D32F_S8";n[n.BC1=59]="BC1";n[n.BC1_ALPHA=60]="BC1_ALPHA";n[n.BC1_SRGB=61]="BC1_SRGB";n[n.BC1_SRGB_ALPHA=62]="BC1_SRGB_ALPHA";n[n.BC2=63]="BC2";n[n.BC2_SRGB=64]="BC2_SRGB";n[n.BC3=65]="BC3";n[n.BC3_SRGB=66]="BC3_SRGB";n[n.BC4=67]="BC4";n[n.BC4_SNORM=68]="BC4_SNORM";n[n.BC5=69]="BC5";n[n.BC5_SNORM=70]="BC5_SNORM";n[n.BC6H_UF16=71]="BC6H_UF16";n[n.BC6H_SF16=72]="BC6H_SF16";n[n.BC7=73]="BC7";n[n.BC7_SRGB=74]="BC7_SRGB";n[n.ETC_RGB8=75]="ETC_RGB8";n[n.ETC2_RGB8=76]="ETC2_RGB8";n[n.ETC2_SRGB8=77]="ETC2_SRGB8";n[n.ETC2_RGB8_A1=78]="ETC2_RGB8_A1";n[n.ETC2_SRGB8_A1=79]="ETC2_SRGB8_A1";n[n.ETC2_RGBA8=80]="ETC2_RGBA8";n[n.ETC2_SRGB8_A8=81]="ETC2_SRGB8_A8";n[n.EAC_R11=82]="EAC_R11";n[n.EAC_R11SN=83]="EAC_R11SN";n[n.EAC_RG11=84]="EAC_RG11";n[n.EAC_RG11SN=85]="EAC_RG11SN";n[n.PVRTC_RGB2=86]="PVRTC_RGB2";n[n.PVRTC_RGBA2=87]="PVRTC_RGBA2";n[n.PVRTC_RGB4=88]="PVRTC_RGB4";n[n.PVRTC_RGBA4=89]="PVRTC_RGBA4";n[n.PVRTC2_2BPP=90]="PVRTC2_2BPP";n[n.PVRTC2_4BPP=91]="PVRTC2_4BPP"}(f||(f={})),function(n){n[n.NONE=0]="NONE";n[n.TRANSFER_SRC=1]="TRANSFER_SRC";n[n.TRANSFER_DST=2]="TRANSFER_DST";n[n.INDEX=4]="INDEX";n[n.VERTEX=8]="VERTEX";n[n.UNIFORM=16]="UNIFORM";n[n.STORAGE=32]="STORAGE";n[n.INDIRECT=64]="INDIRECT"}(p||(p={})),function(n){n[n.NONE=0]="NONE";n[n.DEVICE=1]="DEVICE";n[n.HOST=2]="HOST"}(w||(w={})),function(n){n[n.NONE=0]="NONE";n[n.READ=1]="READ";n[n.WRITE=2]="WRITE"}(b||(b={})),function(n){n[n.POINT_LIST=0]="POINT_LIST";n[n.LINE_LIST=1]="LINE_LIST";n[n.LINE_STRIP=2]="LINE_STRIP";n[n.LINE_LOOP=3]="LINE_LOOP";n[n.LINE_LIST_ADJACENCY=4]="LINE_LIST_ADJACENCY";n[n.LINE_STRIP_ADJACENCY=5]="LINE_STRIP_ADJACENCY";n[n.ISO_LINE_LIST=6]="ISO_LINE_LIST";n[n.TRIANGLE_LIST=7]="TRIANGLE_LIST";n[n.TRIANGLE_STRIP=8]="TRIANGLE_STRIP";n[n.TRIANGLE_FAN=9]="TRIANGLE_FAN";n[n.TRIANGLE_LIST_ADJACENCY=10]="TRIANGLE_LIST_ADJACENCY";n[n.TRIANGLE_STRIP_ADJACENCY=11]="TRIANGLE_STRIP_ADJACENCY";n[n.TRIANGLE_PATCH_ADJACENCY=12]="TRIANGLE_PATCH_ADJACENCY";n[n.QUAD_PATCH_LIST=13]="QUAD_PATCH_LIST"}(k||(k={})),function(n){n[n.FILL=0]="FILL";n[n.POINT=1]="POINT";n[n.LINE=2]="LINE"}(d||(d={})),function(n){n[n.GOURAND=0]="GOURAND";n[n.FLAT=1]="FLAT"}(g||(g={})),function(n){n[n.NONE=0]="NONE";n[n.FRONT=1]="FRONT";n[n.BACK=2]="BACK"}(nt||(nt={})),function(n){n[n.NEVER=0]="NEVER";n[n.LESS=1]="LESS";n[n.EQUAL=2]="EQUAL";n[n.LESS_EQUAL=3]="LESS_EQUAL";n[n.GREATER=4]="GREATER";n[n.NOT_EQUAL=5]="NOT_EQUAL";n[n.GREATER_EQUAL=6]="GREATER_EQUAL";n[n.ALWAYS=7]="ALWAYS"}(tt||(tt={})),function(n){n[n.ZERO=0]="ZERO";n[n.KEEP=1]="KEEP";n[n.REPLACE=2]="REPLACE";n[n.INCR=3]="INCR";n[n.DECR=4]="DECR";n[n.INVERT=5]="INVERT";n[n.INCR_WRAP=6]="INCR_WRAP";n[n.DECR_WRAP=7]="DECR_WRAP"}(it||(it={})),function(n){n[n.ADD=0]="ADD";n[n.SUB=1]="SUB";n[n.REV_SUB=2]="REV_SUB";n[n.MIN=3]="MIN";n[n.MAX=4]="MAX"}(rt||(rt={})),function(n){n[n.ZERO=0]="ZERO";n[n.ONE=1]="ONE";n[n.SRC_ALPHA=2]="SRC_ALPHA";n[n.DST_ALPHA=3]="DST_ALPHA";n[n.ONE_MINUS_SRC_ALPHA=4]="ONE_MINUS_SRC_ALPHA";n[n.ONE_MINUS_DST_ALPHA=5]="ONE_MINUS_DST_ALPHA";n[n.SRC_COLOR=6]="SRC_COLOR";n[n.DST_COLOR=7]="DST_COLOR";n[n.ONE_MINUS_SRC_COLOR=8]="ONE_MINUS_SRC_COLOR";n[n.ONE_MINUS_DST_COLOR=9]="ONE_MINUS_DST_COLOR";n[n.SRC_ALPHA_SATURATE=10]="SRC_ALPHA_SATURATE";n[n.CONSTANT_COLOR=11]="CONSTANT_COLOR";n[n.ONE_MINUS_CONSTANT_COLOR=12]="ONE_MINUS_CONSTANT_COLOR";n[n.CONSTANT_ALPHA=13]="CONSTANT_ALPHA";n[n.ONE_MINUS_CONSTANT_ALPHA=14]="ONE_MINUS_CONSTANT_ALPHA"}(ut||(ut={})),function(n){n[n.NONE=0]="NONE";n[n.R=1]="R";n[n.G=2]="G";n[n.B=4]="B";n[n.A=8]="A";n[n.ALL=15]="ALL"}(ft||(ft={})),function(n){n[n.NONE=0]="NONE";n[n.POINT=1]="POINT";n[n.LINEAR=2]="LINEAR";n[n.ANISOTROPIC=3]="ANISOTROPIC"}(et||(et={})),function(n){n[n.WRAP=0]="WRAP";n[n.MIRROR=1]="MIRROR";n[n.CLAMP=2]="CLAMP";n[n.BORDER=3]="BORDER"}(ot||(ot={})),function(n){n[n.TEX1D=0]="TEX1D";n[n.TEX2D=1]="TEX2D";n[n.TEX3D=2]="TEX3D"}(st||(st={})),function(n){n[n.NONE=0]="NONE";n[n.TRANSFER_SRC=1]="TRANSFER_SRC";n[n.TRANSFER_DST=2]="TRANSFER_DST";n[n.SAMPLED=4]="SAMPLED";n[n.STORAGE=8]="STORAGE";n[n.COLOR_ATTACHMENT=16]="COLOR_ATTACHMENT";n[n.DEPTH_STENCIL_ATTACHMENT=32]="DEPTH_STENCIL_ATTACHMENT";n[n.TRANSIENT_ATTACHMENT=64]="TRANSIENT_ATTACHMENT";n[n.INPUT_ATTACHMENT=128]="INPUT_ATTACHMENT"}(ht||(ht={})),function(n){n[n.X1=0]="X1";n[n.X2=1]="X2";n[n.X4=2]="X4";n[n.X8=3]="X8";n[n.X16=4]="X16";n[n.X32=5]="X32";n[n.X64=6]="X64"}(ct||(ct={})),function(n){n[n.NONE=0]="NONE";n[n.GEN_MIPMAP=1]="GEN_MIPMAP";n[n.CUBEMAP=2]="CUBEMAP";n[n.BAKUP_BUFFER=4]="BAKUP_BUFFER"}(lt||(lt={})),function(n){n[n.TV1D=0]="TV1D";n[n.TV2D=1]="TV2D";n[n.TV3D=2]="TV3D";n[n.CUBE=3]="CUBE";n[n.TV1D_ARRAY=4]="TV1D_ARRAY";n[n.TV2D_ARRAY=5]="TV2D_ARRAY"}(at||(at={})),function(n){n[n.VERTEX=0]="VERTEX";n[n.HULL=1]="HULL";n[n.DOMAIN=2]="DOMAIN";n[n.GEOMETRY=3]="GEOMETRY";n[n.FRAGMENT=4]="FRAGMENT";n[n.COMPUTE=5]="COMPUTE";n[n.COUNT=6]="COUNT"}(vt||(vt={})),function(n){n[n.UNKNOWN=0]="UNKNOWN";n[n.UNIFORM_BUFFER=1]="UNIFORM_BUFFER";n[n.SAMPLER=2]="SAMPLER";n[n.STORAGE_BUFFER=3]="STORAGE_BUFFER"}(yt||(yt={})),function(n){n[n.PRIMARY=0]="PRIMARY";n[n.SECONDARY=1]="SECONDARY"}(pt||(pt={})),function(n){n[n.LOAD=0]="LOAD";n[n.CLEAR=1]="CLEAR";n[n.DISCARD=2]="DISCARD"}(wt||(wt={})),function(n){n[n.STORE=0]="STORE";n[n.DISCARD=1]="DISCARD"}(bt||(bt={})),function(n){n[n.UNDEFINED=0]="UNDEFINED";n[n.GENERAL=1]="GENERAL";n[n.COLOR_ATTACHMENT_OPTIMAL=2]="COLOR_ATTACHMENT_OPTIMAL";n[n.DEPTH_STENCIL_ATTACHMENT_OPTIMAL=3]="DEPTH_STENCIL_ATTACHMENT_OPTIMAL";n[n.DEPTH_STENCIL_READONLY_OPTIMAL=4]="DEPTH_STENCIL_READONLY_OPTIMAL";n[n.SHADER_READONLY_OPTIMAL=5]="SHADER_READONLY_OPTIMAL";n[n.TRANSFER_SRC_OPTIMAL=6]="TRANSFER_SRC_OPTIMAL";n[n.TRANSFER_DST_OPTIMAL=7]="TRANSFER_DST_OPTIMAL";n[n.PREINITIALIZED=8]="PREINITIALIZED";n[n.PRESENT_SRC=9]="PRESENT_SRC"}(kt||(kt={})),function(n){n[n.GRAPHICS=0]="GRAPHICS";n[n.COMPUTE=1]="COMPUTE";n[n.RAY_TRACING=2]="RAY_TRACING"}(dt||(dt={})),function(n){n[n.VIEWPORT=0]="VIEWPORT";n[n.SCISSOR=1]="SCISSOR";n[n.LINE_WIDTH=2]="LINE_WIDTH";n[n.DEPTH_BIAS=3]="DEPTH_BIAS";n[n.BLEND_CONSTANTS=4]="BLEND_CONSTANTS";n[n.DEPTH_BOUNDS=5]="DEPTH_BOUNDS";n[n.STENCIL_WRITE_MASK=6]="STENCIL_WRITE_MASK";n[n.STENCIL_COMPARE_MASK=7]="STENCIL_COMPARE_MASK"}(gt||(gt={})),function(n){n[n.FRONT=0]="FRONT";n[n.BACK=1]="BACK";n[n.ALL=2]="ALL"}(ni||(ni={})),function(n){n[n.GRAPHICS=0]="GRAPHICS";n[n.COMPUTE=1]="COMPUTE";n[n.TRANSFER=2]="TRANSFER"}(ti||(ti={})),function(n){n[n.NONE=0]="NONE";n[n.COLOR=1]="COLOR";n[n.DEPTH=2]="DEPTH";n[n.STENCIL=4]="STENCIL";n[n.DEPTH_STENCIL=6]="DEPTH_STENCIL";n[n.ALL=7]="ALL"}(ii||(ii={})),function(n){n[n.DEFAULT=100]="DEFAULT"}(h||(h={})),function(n){n[n.MIN=0]="MIN";n[n.MAX=255]="MAX";n[n.DEFAULT=128]="DEFAULT"}(c||(c={})),function(n){n[n.UBO_GLOBAL=23]="UBO_GLOBAL";n[n.UBO_SHADOW=22]="UBO_SHADOW";n[n.UBO_LOCAL=21]="UBO_LOCAL";n[n.UBO_FORWARD_LIGHTS=20]="UBO_FORWARD_LIGHTS";n[n.UBO_SKINNING=19]="UBO_SKINNING";n[n.UBO_SKINNING_TEXTURE=18]="UBO_SKINNING_TEXTURE";n[n.UBO_UI=17]="UBO_UI";n[n.SAMPLER_JOINTS=25]="SAMPLER_JOINTS";n[n.SAMPLER_ENVIRONMENT=26]="SAMPLER_ENVIRONMENT";n[n.CUSTUM_UBO_BINDING_END_POINT=17]="CUSTUM_UBO_BINDING_END_POINT";n[n.CUSTOM_SAMPLER_BINDING_START_POINT=30]="CUSTOM_SAMPLER_BINDING_START_POINT"}(l||(l={})),function(n){n[n.minFilter=0]="minFilter";n[n.magFilter=1]="magFilter";n[n.mipFilter=2]="mipFilter";n[n.addressU=3]="addressU";n[n.addressV=4]="addressV";n[n.addressW=5]="addressW";n[n.maxAnisotropy=6]="maxAnisotropy";n[n.cmpFunc=7]="cmpFunc";n[n.minLOD=8]="minLOD";n[n.maxLOD=9]="maxLOD";n[n.mipLODBias=10]="mipLODBias";n[n.borderColor=11]="borderColor";n[n.total=15]="total"}(a||(a={}));r={};r[r.bool=i.BOOL]="bool";r[r.int=i.INT]="int";r[r.ivec2=i.INT2]="ivec2invTypeParams";r[r.ivec3=i.INT3]="ivec3";r[r.ivec4=i.INT4]="ivec4";r[r.float=i.FLOAT]="float";r[r.vec2=i.FLOAT2]="vec2";r[r.vec3=i.FLOAT3]="vec3";r[r.vec4=i.FLOAT4]="vec4";r[r.mat2=i.MAT2]="mat2";r[r.mat3=i.MAT3]="mat3";r[r.mat4=i.MAT4]="mat4";r[r.sampler2D=i.SAMPLER2D]="sampler2D";r[r.samplerCube=i.SAMPLER_CUBE]="samplerCube";var fi=((u={})[i.BOOL]=4,u[i.INT]=4,u[i.INT2]=8,u[i.INT3]=12,u[i.INT4]=16,u[i.FLOAT]=4,u[i.FLOAT2]=8,u[i.FLOAT3]=12,u[i.FLOAT4]=16,u[i.MAT2]=16,u[i.MAT3]=36,u[i.MAT4]=64,u[i.SAMPLER2D]=4,u[i.SAMPLER_CUBE]=4,u),ei=((e={})[i.BOOL]=f.R32I,e[i.INT]=f.R32I,e[i.INT2]=f.RG32I,e[i.INT3]=f.RGB32I,e[i.INT4]=f.RGBA32I,e[i.FLOAT]=f.R32F,e[i.FLOAT2]=f.RG32F,e[i.FLOAT3]=f.RGB32F,e[i.FLOAT4]=f.RGBA32F,e),ri={BACK:1029,FRONT:1028,NONE:0,ADD:32774,SUB:32778,REV_SUB:32779,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,SRC_ALPHA_SATURATE:776,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,INCR_WRAP:34055,DECR:7683,DECR_WRAP:34056,INVERT:5386};Object.assign(ri,h);ui={murmurhash2_32_gc:function(n,t){for(var u,f=n.length,i=t^f,r=0;f>=4;)u=1540483477*(65535&(u=255&n.charCodeAt(r)|(255&n.charCodeAt(++r))<<8|(255&n.charCodeAt(++r))<<16|(255&n.charCodeAt(++r))<<24))+((1540483477*(u>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++r;switch(f){case 3:i^=(255&n.charCodeAt(r+2))<<16;case 2:i^=(255&n.charCodeAt(r+1))<<8;case 1:i=1540483477*(65535&(i^=255&n.charCodeAt(r)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0},SamplerInfoIndex:a,effectStructure:{$techniques:[{$passes:[{depthStencilState:{},rasterizerState:{},blendState:{targets:[{}]},properties:{any:{sampler:{},inspector:{}}}}]}]},typeMap:r,sizeMap:fi,formatMap:ei,passParams:ri,RenderQueue:{OPAQUE:0,TRANSPARENT:1,OVERLAY:2},RenderPriority:c,GFXGetTypeSize:function(n){switch(n){case i.BOOL:case i.INT:case i.UINT:case i.FLOAT:return 4;case i.BOOL2:case i.INT2:case i.UINT2:case i.FLOAT2:return 8;case i.BOOL3:case i.INT3:case i.UINT3:case i.FLOAT3:return 12;case i.BOOL4:case i.INT4:case i.UINT4:case i.FLOAT4:case i.MAT2:return 16;case i.MAT2X3:return 24;case i.MAT2X4:return 32;case i.MAT3X2:return 24;case i.MAT3:return 36;case i.MAT3X4:return 48;case i.MAT4X2:case i.MAT4X2:return 32;case i.MAT4:return 64;case i.SAMPLER1D:case i.SAMPLER1D_ARRAY:case i.SAMPLER2D:case i.SAMPLER2D_ARRAY:case i.SAMPLER3D:case i.SAMPLER_CUBE:return 4;default:return 0}},UniformBinding:l};t.exports=ui},{}],306:[function(n,t,i){"use strict";function o(n){return n&&n.__esModule?n:{"default":n}}i.__esModule=!0;i.default=void 0;var u=n("../memop"),r=o(n("../enums")),f=n("../../core/value-types"),l=o(n("./program-lib")),a=o(n("./view")),v=o(n("../gfx"));var e=new f.Mat4,s=new u.RecyclePool(function(){return{stage:null,items:null}},8),y=new u.RecyclePool(function(){return new Float32Array(2)},8),p=new u.RecyclePool(function(){return new Float32Array(3)},8),w=new u.RecyclePool(function(){return new Float32Array(4)},8),b=new u.RecyclePool(function(){return new Float32Array(9)},8),h=new u.RecyclePool(function(){return new Float32Array(16)},8),k=new u.RecyclePool(function(){return new Float32Array(64)},8),d=new u.RecyclePool(function(){return new Int32Array(2)},8),g=new u.RecyclePool(function(){return new Int32Array(3)},8),nt=new u.RecyclePool(function(){return new Int32Array(4)},8),c=new u.RecyclePool(function(){return new Int32Array(64)},8),tt=function(){function t(n,t){var i;this._device=n;this._programLib=new l.default(n);this._opts=t;this._type2defaultValue=((i={})[r.default.PARAM_INT]=0,i[r.default.PARAM_INT2]=new f.Vec2(0,0),i[r.default.PARAM_INT3]=new f.Vec3(0,0,0),i[r.default.PARAM_INT4]=new f.Vec4(0,0,0,0),i[r.default.PARAM_FLOAT]=0,i[r.default.PARAM_FLOAT2]=new f.Vec2(0,0),i[r.default.PARAM_FLOAT3]=new f.Vec3(0,0,0),i[r.default.PARAM_FLOAT4]=new f.Vec4(0,0,0,0),i[r.default.PARAM_COLOR4]=new f.Color(0,0,0,1),i[r.default.PARAM_MAT3]=new f.Mat3,i[r.default.PARAM_MAT4]=new f.Mat4,i[r.default.PARAM_TEXTURE_2D]=t.defaultTexture,i[r.default.PARAM_TEXTURE_CUBE]=t.defaultTextureCube,i);this._stage2fn={};this._usedTextureUnits=0;this._viewPools=new u.RecyclePool(function(){return new a.default},8);this._drawItemsPools=new u.RecyclePool(function(){return{model:null,node:null,ia:null,effect:null,defines:null,uniforms:null}},100);this._stageItemsPools=new u.RecyclePool(function(){return new u.RecyclePool(function(){return{model:null,node:null,ia:null,effect:null,defines:null,passes:[],sortKey:-1,uniforms:null}},100)},16);this._definesChanged=!1}var n=t.prototype;return n._resetTextuerUnit=function(){this._usedTextureUnits=0},n._allocTextureUnit=function(){var t=this._device,n=this._usedTextureUnits;return n>=t._caps.maxTextureUnits&&console.warn("Trying to use "+n+" texture units while this GPU supports only "+t._caps.maxTextureUnits),this._usedTextureUnits+=1,n},n._registerStage=function(n,t){this._stage2fn[n]=t},n.clear=function(){this._programLib.clear();this.reset()},n.reset=function(){this._viewPools.reset();this._stageItemsPools.reset();this._definesChanged=!1},n._requestView=function(){return this._viewPools.add()},n._render=function(n,t){var y=this._device,e,o,p,d,h,w,c,l,u,a,i,b,v,k;for(y.setFrameBuffer(n._framebuffer),y.setViewport(n._rect.x,n._rect.y,n._rect.w,n._rect.h),e={},n._clearFlags&r.default.CLEAR_COLOR&&(e.color=f.Vec4.toArray([],n._color)),n._clearFlags&r.default.CLEAR_DEPTH&&(e.depth=n._depth),n._clearFlags&r.default.CLEAR_STENCIL&&(e.stencil=n._stencil),y.clear(e),this._drawItemsPools.reset(),o=0;o<t._models.length;++o)p=t._models.data[o],0!=(p._cullingMask&n._cullingMask)&&(d=this._drawItemsPools.add(),p.extractDrawItem(d));for(s.reset(),h=0;h<n._stages.length;++h){for(w=n._stages[h],c=this._stageItemsPools.add(),c.reset(),l=0;l<this._drawItemsPools.length;++l)u=this._drawItemsPools.data[l],a=u.effect.stagePasses[w],a&&0!==a.length&&(i=c.add(),i.passes=a,i.model=u.model,i.node=u.node,i.ia=u.ia,i.effect=u.effect,i.defines=u.defines,i.sortKey=-1,i.uniforms=u.uniforms);b=s.add();b.stage=w;b.items=c}for(v=0;v<s.length;++v)k=s.data[v],this._stage2fn[k.stage](n,k.items)},n._setProperty=function(n){var i=this._device,t=n.value,f,u;if(void 0===t&&(t=n.val),void 0===t&&(t=this._type2defaultValue[n.type]),void 0!==t)if(n.type===r.default.PARAM_TEXTURE_2D||n.type===r.default.PARAM_TEXTURE_CUBE)if(Array.isArray(t)){if(t.length>n.count)return void console.error("Failed to set property ["+n.name+"] : The length of texture array ["+t.length+"] is bigger than ["+n.count+"].");for(f=c.add(),u=0;u<t.length;++u)f[u]=this._allocTextureUnit();i.setTextureArray(n.name,t,f)}else i.setTexture(n.name,t,this._allocTextureUnit());else n.directly?i.setUniformDirectly(n.name,t):i.setUniform(n.name,t);else console.warn("Failed to set technique property "+n.name+", value not found.")},n._draw=function(n){var i=this._device,ut=this._programLib,ft=n.node,r=n.ia,tt=n.passes,et=n.effect,o,u,t,it,s,a;for(y.reset(),p.reset(),w.reset(),b.reset(),h.reset(),k.reset(),d.reset(),g.reset(),nt.reset(),c.reset(),ft.getWorldMatrix(e),i.setUniform("cc_matWorld",f.Mat4.toArray(h.add(),e)),f.Mat4.invert(e,e),f.Mat4.transpose(e,e),i.setUniform("cc_matWorldIT",f.Mat4.toArray(h.add(),e)),o=this._defines,u=0;u<tt.length;++u){t=tt[u];this._definesChanged&&(t._programKey=null);it=r.count;r._vertexBuffer&&i.setVertexBuffer(0,r._vertexBuffer);r._indexBuffer&&i.setIndexBuffer(r._indexBuffer);i.setPrimitiveType(r._primitiveType);Object.setPrototypeOf(o,t._defines);s=ut.getProgram(t,o,et.name);i.setProgram(s);for(var rt=s._uniforms,ot=t._properties,l=0;l<rt.length;l++)a=ot[rt[l].name],void 0!==a&&this._setProperty(a);i.setCullMode(t._cullMode);t._blend&&(i.enableBlend(),i.setBlendFuncSep(t._blendSrc,t._blendDst,t._blendSrcAlpha,t._blendDstAlpha),i.setBlendEqSep(t._blendEq,t._blendAlphaEq),i.setBlendColor32(t._blendColor));t._depthTest&&(i.enableDepthTest(),i.setDepthFunc(t._depthFunc));t._depthWrite&&i.enableDepthWrite();i.setStencilTest(t._stencilTest);t._stencilTest===v.default.STENCIL_ENABLE&&(i.setStencilFuncFront(t._stencilFuncFront,t._stencilRefFront,t._stencilMaskFront),i.setStencilOpFront(t._stencilFailOpFront,t._stencilZFailOpFront,t._stencilZPassOpFront,t._stencilWriteMaskFront),i.setStencilFuncBack(t._stencilFuncBack,t._stencilRefBack,t._stencilMaskBack),i.setStencilOpBack(t._stencilFailOpBack,t._stencilZFailOpBack,t._stencilZPassOpBack,t._stencilWriteMaskBack));i.draw(r._start,it);this._resetTextuerUnit()}},t}();i.default=tt;t.exports=i.default},{"../../core/value-types":284,"../enums":312,"../gfx":317,"../memop":329,"./program-lib":309,"./view":311}],307:[function(n,t,i){"use strict";function e(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}var r,u,f;i.__esModule=!0;i.default=void 0;u=(r=n("../gfx"))&&r.__esModule?r:{"default":r};f=function(){function n(n,t,i){void 0===i&&(i=u.default.PT_TRIANGLES);this._vertexBuffer=n;this._indexBuffer=t;this._primitiveType=i;this._start=0;this._count=-1}var t,i;return t=n,(i=[{key:"count",get:function(){return-1!==this._count?this._count:this._indexBuffer?this._indexBuffer.count:this._vertexBuffer?this._vertexBuffer.count:0}}])&&e(t.prototype,i),n}();i.default=f;t.exports=i.default},{"../gfx":317}],308:[function(n,t,i){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}var f;i.__esModule=!0;i.default=void 0;var r=u(n("../gfx")),e=u(n("../enums")),o=u(n("../../core/value-types/value-type"));f=function(){function t(n,t,i,u,f,e){void 0===f&&(f={});void 0===e&&(e={});this._name=n;this._detailName=t;this._programName=i;this._programKey=null;this._stage=u;this._properties=f;this._defines=e;this._cullMode=r.default.CULL_BACK;this._blend=!1;this._blendEq=r.default.BLEND_FUNC_ADD;this._blendAlphaEq=r.default.BLEND_FUNC_ADD;this._blendSrc=r.default.BLEND_SRC_ALPHA;this._blendDst=r.default.BLEND_ONE_MINUS_SRC_ALPHA;this._blendSrcAlpha=r.default.BLEND_SRC_ALPHA;this._blendDstAlpha=r.default.BLEND_ONE_MINUS_SRC_ALPHA;this._blendColor=4294967295;this._depthTest=!1;this._depthWrite=!1;this._depthFunc=r.default.DS_FUNC_LESS;this._stencilTest=r.default.STENCIL_INHERIT;this._stencilFuncFront=r.default.DS_FUNC_ALWAYS;this._stencilRefFront=0;this._stencilMaskFront=255;this._stencilFailOpFront=r.default.STENCIL_OP_KEEP;this._stencilZFailOpFront=r.default.STENCIL_OP_KEEP;this._stencilZPassOpFront=r.default.STENCIL_OP_KEEP;this._stencilWriteMaskFront=255;this._stencilFuncBack=r.default.DS_FUNC_ALWAYS;this._stencilRefBack=0;this._stencilMaskBack=255;this._stencilFailOpBack=r.default.STENCIL_OP_KEEP;this._stencilZFailOpBack=r.default.STENCIL_OP_KEEP;this._stencilZPassOpBack=r.default.STENCIL_OP_KEEP;this._stencilWriteMaskBack=255}var n=t.prototype;return n.setCullMode=function(n){void 0===n&&(n=r.default.CULL_BACK);this._cullMode=n},n.setBlend=function(n,t,i,u,f,e,o,s){void 0===n&&(n=!1);void 0===t&&(t=r.default.BLEND_FUNC_ADD);void 0===i&&(i=r.default.BLEND_SRC_ALPHA);void 0===u&&(u=r.default.BLEND_ONE_MINUS_SRC_ALPHA);void 0===f&&(f=r.default.BLEND_FUNC_ADD);void 0===e&&(e=r.default.BLEND_SRC_ALPHA);void 0===o&&(o=r.default.BLEND_ONE_MINUS_SRC_ALPHA);void 0===s&&(s=4294967295);this._blend=n;this._blendEq=t;this._blendSrc=i;this._blendDst=u;this._blendAlphaEq=f;this._blendSrcAlpha=e;this._blendDstAlpha=o;this._blendColor=s},n.setDepth=function(n,t,i){void 0===n&&(n=!1);void 0===t&&(t=!1);void 0===i&&(i=r.default.DS_FUNC_LESS);this._depthTest=n;this._depthWrite=t;this._depthFunc=i},n.setStencilFront=function(n,t,i,u,f,e,o,s){void 0===n&&(n=r.default.STENCIL_INHERIT);void 0===t&&(t=r.default.DS_FUNC_ALWAYS);void 0===i&&(i=0);void 0===u&&(u=255);void 0===f&&(f=r.default.STENCIL_OP_KEEP);void 0===e&&(e=r.default.STENCIL_OP_KEEP);void 0===o&&(o=r.default.STENCIL_OP_KEEP);void 0===s&&(s=255);this._stencilTest=n;this._stencilFuncFront=t;this._stencilRefFront=i;this._stencilMaskFront=u;this._stencilFailOpFront=f;this._stencilZFailOpFront=e;this._stencilZPassOpFront=o;this._stencilWriteMaskFront=s},n.setStencilEnabled=function(n){void 0===n&&(n=r.default.STENCIL_INHERIT);this._stencilTest=n},n.setStencilBack=function(n,t,i,u,f,e,o,s){void 0===n&&(n=r.default.STENCIL_INHERIT);void 0===t&&(t=r.default.DS_FUNC_ALWAYS);void 0===i&&(i=0);void 0===u&&(u=255);void 0===f&&(f=r.default.STENCIL_OP_KEEP);void 0===e&&(e=r.default.STENCIL_OP_KEEP);void 0===o&&(o=r.default.STENCIL_OP_KEEP);void 0===s&&(s=255);this._stencilTest=n;this._stencilFuncBack=t;this._stencilRefBack=i;this._stencilMaskBack=u;this._stencilFailOpBack=f;this._stencilZFailOpBack=e;this._stencilZPassOpBack=o;this._stencilWriteMaskBack=s},n.setStage=function(n){this._stage=n},n.setProperties=function(n){this._properties=n},n.getProperty=function(n){if(this._properties[n])return this._properties[n].value},n.setProperty=function(n,t,i){var r=this._properties[n],f,u;if(!r)return!1;if(r.directly=i,Array.isArray(t)){if(f=r.value,f.length!==t.length)return void cc.warnID(9105,this._name,n);for(u=0;u<t.length;u++)f[u]=t[u]}else t&&!ArrayBuffer.isView(t)?r.type===e.default.PARAM_TEXTURE_2D?r.value=t.getImpl():t instanceof o.default?t.constructor.toArray(r.value,t):("object"==typeof t&&cc.warnID(9106,this._name,n),r.value=t):r.value=t;return!0},n.getDefine=function(n){return this._defines[n]},n.define=function(n,t,i){var r=this._defines[n];return!(!i&&void 0===r||(r!==t&&(this._defines[n]=t,this._programKey=null),0))},n.clone=function(){var i=new t(this._programName),u,f,e,r;Object.assign(i,this);u={};f=this._properties;for(e in f){var o=f[e],s=u[e]={},n=o.value;for(r in s.value=Array.isArray(n)?n.concat():ArrayBuffer.isView(n)?new n.__proto__.constructor(n):n,o)"value"!==r&&(s[r]=o[r])}return i._properties=u,i._defines=Object.assign({},this._defines),i},t}();i.default=f;t.exports=i.default},{"../../core/value-types/value-type":292,"../enums":312,"../gfx":317}],309:[function(n,t,i){"use strict";function c(n,t){for(var f,i,u=[],r=0;r<n.length;r++)f=n[r].name,i=t[f],"number"!=typeof i&&(i=i?1:0),u.push("#define "+f+" "+i);return u.join("\n")+"\n"}function e(n,t,i){for(var f,e,o,r=n,u=0;u<t.length;u++)f=t[u].name,e=i[f],Number.isInteger(e)&&(o=new RegExp(f,"g"),r=r.replace(o,e));return r}function o(n){return n.replace(/#pragma for (\w+) in range\(\s*(\d+)\s*,\s*(\d+)\s*\)([\s\S]+?)#pragma endFor/g,function(n,t,i,r,u){var e="",o=parseInt(i),s=parseInt(r),f;for((o.isNaN||s.isNaN)&&console.error("Unroll For Loops Error: begin and end of range must be an int num."),f=o;f<s;++f)e+=u.replace(new RegExp("{"+t+"}","g"),f);return e})}function s(n){return n.replace(/\bhighp\b/g,"mediump")}var r,u,f,h;i.__esModule=!0;i.default=void 0;u=(r=n("../gfx"))&&r.__esModule?r:{"default":r};f=0;h=function(){function t(n){this._device=n;this._templates={};this._cache={};this._checkPrecision()}var n=t.prototype;return n.clear=function(){this._templates={};this._cache={}},n.define=function(n){var o=n.name,s=n.defines,v=n.glsl1||n,p=v.vert,w=v.frag,t,c,l,r,u,i;if(!this._templates[o]){for(var b=++f,y=0,h=0;h<s.length;++h)t=s[h],c=1,"number"===t.type?(l=t.range||[],t.min=l[0]||0,t.max=l[1]||4,c=Math.ceil(Math.log2(t.max-t.min)),t._map=function(n){return n-this.min<<this._offset}.bind(t)):t._map=function(n){return n?1<<this._offset:0}.bind(t),t._offset=y,y+=c;if(r=n.uniforms||[],n.samplers)for(u=0;u<n.samplers.length;u++)r.push(n.samplers[u]);if(n.blocks)for(i=0;i<n.blocks.length;i++)for(var k=n.blocks[i].defines,a=n.blocks[i].members,e=0;e<a.length;e++)r.push({defines:k,name:a[e].name,type:a[e].type});this._templates[o]={id:b,name:o,vert:p,frag:w,defines:s,attributes:n.attributes,uniforms:r,extensions:n.extensions}}},n.getTemplate=function(n){return this._templates[n]},n.hasProgram=function(n){return void 0!==this._templates[n]},n.getKey=function(n,t){for(var u,f,i=this._templates[n],e=0,r=0;r<i.defines.length;++r)u=i.defines[r],f=t[u.name],void 0!==f&&(e|=u._map(f));return i.id+":"+e},n.getProgram=function(n,t,i){var v=n._programKey=n._programKey||this.getKey(n._programName,t),l=this._cache[v],r,a;if(l)return l;var f=this._templates[n._programName],y=c(f.defines,t),h=e(f.vert,f.defines,t);if(h=y+o(h),this._highpSupported||(h=s(h)),r=e(f.frag,f.defines,t),r=y+o(r),this._highpSupported||(r=s(r)),a=(l=new u.default.Program(this._device,{vert:h,frag:r})).link(),a){var p=h.split("\n"),w=r.split("\n"),b=f.defines.length;a.forEach(function(n){var t=n.line-1,r=n.line-b,u=("vs"===n.type?p:w)[t],f=n.info||"Failed to compile "+n.type+" "+n.fileID+" (ln "+r+"): \n "+n.message+": \n  "+u;cc.error(i+" : "+f)})}return this._cache[v]=l,l},n._checkPrecision=function(){var n=this._device._gl,t=!1,i,r;n.getShaderPrecisionFormat&&(i=n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT),r=n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT),t=i&&i.precision>0&&r&&r.precision>0);t||cc.warnID(9102);this._highpSupported=t},t}();i.default=h;t.exports=i.default},{"../gfx":317}],310:[function(n,t,i){"use strict";function r(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}i.__esModule=!0;i.default=void 0;var u=function(){function n(n,t){this._name=n;this._passes=t}var t,i;return n.prototype.clone=function(){for(var i=[],t=0;t<this._passes.length;t++)i.push(this._passes[t].clone());return new n(this._name,i)},t=n,(i=[{key:"name",get:function(){return this._name}},{key:"passes",get:function(){return this._passes}}])&&r(t.prototype,i),n}();i.default=u;t.exports=i.default},{}],311:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var u,r=n("../../core/value-types"),f=(u=n("../enums"))&&u.__esModule?u:{"default":u},e=new r.Mat4,o=0,s=function(){function n(){this._id=o++;this._priority=0;this._rect={x:0,y:0,w:1,h:1};this._color=new r.Vec4(.3,.3,.3,1);this._depth=1;this._stencil=0;this._clearFlags=f.default.CLEAR_COLOR|f.default.CLEAR_DEPTH;this._clearModel=null;this._matView=cc.mat4();this._matViewInv=cc.mat4();this._matProj=cc.mat4();this._matViewProj=cc.mat4();this._matInvViewProj=cc.mat4();this._stages=[];this._cullingByID=!1;this._framebuffer=null;this._shadowLight=null;this._cullingMask=4294967295}var t=n.prototype;return t.getForward=function(n){var t=this._matView.m;return r.Vec3.set(n,-t[2],-t[6],-t[10])},t.getPosition=function(n){return r.Mat4.invert(e,this._matView),r.Mat4.getTranslation(n,e)},n}();i.default=s;t.exports=i.default},{"../../core/value-types":284,"../enums":312}],312:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var r=n("./build/mappings"),u={PROJ_PERSPECTIVE:0,PROJ_ORTHO:1,LIGHT_DIRECTIONAL:0,LIGHT_POINT:1,LIGHT_SPOT:2,LIGHT_AMBIENT:3,SHADOW_NONE:0,SHADOW_HARD:1,SHADOW_SOFT:2,PARAM_INT:r.typeMap.int,PARAM_INT2:r.typeMap.ivec2,PARAM_INT3:r.typeMap.ivec3,PARAM_INT4:r.typeMap.ivec4,PARAM_FLOAT:r.typeMap.float,PARAM_FLOAT2:r.typeMap.vec2,PARAM_FLOAT3:r.typeMap.vec3,PARAM_FLOAT4:r.typeMap.vec4,PARAM_MAT2:r.typeMap.mat2,PARAM_MAT3:r.typeMap.mat3,PARAM_MAT4:r.typeMap.mat4,PARAM_TEXTURE_2D:r.typeMap.sampler2D,PARAM_TEXTURE_CUBE:r.typeMap.samplerCube,CLEAR_COLOR:1,CLEAR_DEPTH:2,CLEAR_STENCIL:4,CLEAR_SKYBOX:8,BUFFER_VIEW_INT8:0,BUFFER_VIEW_UINT8:1,BUFFER_VIEW_INT16:2,BUFFER_VIEW_UINT16:3,BUFFER_VIEW_INT32:4,BUFFER_VIEW_UINT32:5,BUFFER_VIEW_FLOAT32:6};i.default=u;t.exports=i.default},{"./build/mappings":305}],313:[function(n,t,i){"use strict";function s(n){return n&&n.__esModule?n:{"default":n}}function y(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}function p(n,t,i){if(t.blend!==i.blend)return i.blend?(n.enable(n.BLEND),i.blendSrc!==f.enums.BLEND_CONSTANT_COLOR&&i.blendSrc!==f.enums.BLEND_ONE_MINUS_CONSTANT_COLOR&&i.blendDst!==f.enums.BLEND_CONSTANT_COLOR&&i.blendDst!==f.enums.BLEND_ONE_MINUS_CONSTANT_COLOR||n.blendColor((i.blendColor>>24)/255,(i.blendColor>>16&255)/255,(i.blendColor>>8&255)/255,(255&i.blendColor)/255),void(i.blendSep?(n.blendFuncSeparate(i.blendSrc,i.blendDst,i.blendSrcAlpha,i.blendDstAlpha),n.blendEquationSeparate(i.blendEq,i.blendAlphaEq)):(n.blendFunc(i.blendSrc,i.blendDst),n.blendEquation(i.blendEq)))):void n.disable(n.BLEND);!1!==i.blend&&(t.blendColor!==i.blendColor&&n.blendColor((i.blendColor>>24)/255,(i.blendColor>>16&255)/255,(i.blendColor>>8&255)/255,(255&i.blendColor)/255),t.blendSep===i.blendSep?i.blendSep?(t.blendSrc===i.blendSrc&&t.blendDst===i.blendDst&&t.blendSrcAlpha===i.blendSrcAlpha&&t.blendDstAlpha===i.blendDstAlpha||n.blendFuncSeparate(i.blendSrc,i.blendDst,i.blendSrcAlpha,i.blendDstAlpha),t.blendEq===i.blendEq&&t.blendAlphaEq===i.blendAlphaEq||n.blendEquationSeparate(i.blendEq,i.blendAlphaEq)):(t.blendSrc===i.blendSrc&&t.blendDst===i.blendDst||n.blendFunc(i.blendSrc,i.blendDst),t.blendEq!==i.blendEq&&n.blendEquation(i.blendEq)):i.blendSep?(n.blendFuncSeparate(i.blendSrc,i.blendDst,i.blendSrcAlpha,i.blendDstAlpha),n.blendEquationSeparate(i.blendEq,i.blendAlphaEq)):(n.blendFunc(i.blendSrc,i.blendDst),n.blendEquation(i.blendEq)))}function w(n,t,i){if(t.depthTest!==i.depthTest)return i.depthTest?(n.enable(n.DEPTH_TEST),n.depthFunc(i.depthFunc),void n.depthMask(i.depthWrite)):void n.disable(n.DEPTH_TEST);t.depthWrite!==i.depthWrite&&n.depthMask(i.depthWrite);!1!==i.depthTest?t.depthFunc!==i.depthFunc&&n.depthFunc(i.depthFunc):i.depthWrite&&(i.depthTest=!0,i.depthFunc=f.enums.DS_FUNC_ALWAYS,n.enable(n.DEPTH_TEST),n.depthFunc(i.depthFunc))}function b(n,t,i){if(i.stencilTest!==f.enums.STENCIL_INHERIT)return i.stencilTest!==t.stencilTest?i.stencilTest===f.enums.STENCIL_DISABLE?void n.disable(n.STENCIL_TEST):(n.enable(n.STENCIL_TEST),void(i.stencilSep?(n.stencilFuncSeparate(n.FRONT,i.stencilFuncFront,i.stencilRefFront,i.stencilMaskFront),n.stencilMaskSeparate(n.FRONT,i.stencilWriteMaskFront),n.stencilOpSeparate(n.FRONT,i.stencilFailOpFront,i.stencilZFailOpFront,i.stencilZPassOpFront),n.stencilFuncSeparate(n.BACK,i.stencilFuncBack,i.stencilRefBack,i.stencilMaskBack),n.stencilMaskSeparate(n.BACK,i.stencilWriteMaskBack),n.stencilOpSeparate(n.BACK,i.stencilFailOpBack,i.stencilZFailOpBack,i.stencilZPassOpBack)):(n.stencilFunc(i.stencilFuncFront,i.stencilRefFront,i.stencilMaskFront),n.stencilMask(i.stencilWriteMaskFront),n.stencilOp(i.stencilFailOpFront,i.stencilZFailOpFront,i.stencilZPassOpFront)))):void(i.stencilTest!==f.enums.STENCIL_DISABLE&&(t.stencilSep===i.stencilSep?i.stencilSep?(t.stencilFuncFront===i.stencilFuncFront&&t.stencilRefFront===i.stencilRefFront&&t.stencilMaskFront===i.stencilMaskFront||n.stencilFuncSeparate(n.FRONT,i.stencilFuncFront,i.stencilRefFront,i.stencilMaskFront),t.stencilWriteMaskFront!==i.stencilWriteMaskFront&&n.stencilMaskSeparate(n.FRONT,i.stencilWriteMaskFront),t.stencilFailOpFront===i.stencilFailOpFront&&t.stencilZFailOpFront===i.stencilZFailOpFront&&t.stencilZPassOpFront===i.stencilZPassOpFront||n.stencilOpSeparate(n.FRONT,i.stencilFailOpFront,i.stencilZFailOpFront,i.stencilZPassOpFront),t.stencilFuncBack===i.stencilFuncBack&&t.stencilRefBack===i.stencilRefBack&&t.stencilMaskBack===i.stencilMaskBack||n.stencilFuncSeparate(n.BACK,i.stencilFuncBack,i.stencilRefBack,i.stencilMaskBack),t.stencilWriteMaskBack!==i.stencilWriteMaskBack&&n.stencilMaskSeparate(n.BACK,i.stencilWriteMaskBack),t.stencilFailOpBack===i.stencilFailOpBack&&t.stencilZFailOpBack===i.stencilZFailOpBack&&t.stencilZPassOpBack===i.stencilZPassOpBack||n.stencilOpSeparate(n.BACK,i.stencilFailOpBack,i.stencilZFailOpBack,i.stencilZPassOpBack)):(t.stencilFuncFront===i.stencilFuncFront&&t.stencilRefFront===i.stencilRefFront&&t.stencilMaskFront===i.stencilMaskFront||n.stencilFunc(i.stencilFuncFront,i.stencilRefFront,i.stencilMaskFront),t.stencilWriteMaskFront!==i.stencilWriteMaskFront&&n.stencilMask(i.stencilWriteMaskFront),t.stencilFailOpFront===i.stencilFailOpFront&&t.stencilZFailOpFront===i.stencilZFailOpFront&&t.stencilZPassOpFront===i.stencilZPassOpFront||n.stencilOp(i.stencilFailOpFront,i.stencilZFailOpFront,i.stencilZPassOpFront)):i.stencilSep?(n.stencilFuncSeparate(n.FRONT,i.stencilFuncFront,i.stencilRefFront,i.stencilMaskFront),n.stencilMaskSeparate(n.FRONT,i.stencilWriteMaskFront),n.stencilOpSeparate(n.FRONT,i.stencilFailOpFront,i.stencilZFailOpFront,i.stencilZPassOpFront),n.stencilFuncSeparate(n.BACK,i.stencilFuncBack,i.stencilRefBack,i.stencilMaskBack),n.stencilMaskSeparate(n.BACK,i.stencilWriteMaskBack),n.stencilOpSeparate(n.BACK,i.stencilFailOpBack,i.stencilZFailOpBack,i.stencilZPassOpBack)):(n.stencilFunc(i.stencilFuncFront,i.stencilRefFront,i.stencilMaskFront),n.stencilMask(i.stencilWriteMaskFront),n.stencilOp(i.stencilFailOpFront,i.stencilZFailOpFront,i.stencilZPassOpFront))))}function k(n,t,i){t.cullMode!==i.cullMode&&(i.cullMode!==f.enums.CULL_NONE?(n.enable(n.CULL_FACE),n.cullFace(i.cullMode)):n.disable(n.CULL_FACE))}function d(n,t,i,r){var c=!1,e,l,s,h,v,a,u,f,o;if(-1!==r.maxStream){if(i.maxStream!==r.maxStream)c=!0;else if(i.program!==r.program)c=!0;else for(e=0;e<r.maxStream+1;++e)if(i.vertexBuffers[e]!==r.vertexBuffers[e]||i.vertexBufferOffsets[e]!==r.vertexBufferOffsets[e]){c=!0;break}if(c){for(l=0;l<n._caps.maxVertexAttribs;++l)n._newAttributes[l]=0;for(s=0;s<r.maxStream+1;++s)if(h=r.vertexBuffers[s],v=r.vertexBufferOffsets[s],h&&-1!==h._glID)for(t.bindBuffer(t.ARRAY_BUFFER,h._glID),a=0;a<r.program._attributes.length;++a)u=r.program._attributes[a],f=h._format.element(u.name),f?(0===n._enabledAttributes[u.location]&&(t.enableVertexAttribArray(u.location),n._enabledAttributes[u.location]=1),n._newAttributes[u.location]=1,t.vertexAttribPointer(u.location,f.num,f.type,f.normalize,f.stride,f.offset+v*f.stride)):console.warn("Can not find vertex attribute: "+u.name);for(o=0;o<n._caps.maxVertexAttribs;++o)n._enabledAttributes[o]!==n._newAttributes[o]&&(t.disableVertexAttribArray(o),n._enabledAttributes[o]=0)}}}function g(n,t,i){for(var u,r=0;r<i.maxTextureSlot+1;++r)t.textureUnits[r]!==i.textureUnits[r]&&(u=i.textureUnits[r],u&&-1!==u._glID&&(n.activeTexture(n.TEXTURE0+r),n.bindTexture(u._target,u._glID)))}function e(n,t,i,r){void 0===r&&(r=0);i instanceof a.default?n.framebufferTexture2D(n.FRAMEBUFFER,t,n.TEXTURE_2D,i._glID,0):i instanceof v.default?n.framebufferTexture2D(n.FRAMEBUFFER,t,n.TEXTURE_CUBE_MAP_POSITIVE_X+r,i._glID,0):n.framebufferRenderbuffer(n.FRAMEBUFFER,t,n.RENDERBUFFER,i._glID)}var h,c,l;i.__esModule=!0;i.default=void 0;var r,u,o=s(n("./state")),f=n("./enums"),a=s(n("./texture-2d")),v=s(n("./texture-cube"));h=((r={})[5124]=function(n,t,i){n.uniform1i(t,i)},r[5126]=function(n,t,i){n.uniform1f(t,i)},r[35664]=function(n,t,i){n.uniform2fv(t,i)},r[35665]=function(n,t,i){n.uniform3fv(t,i)},r[35666]=function(n,t,i){n.uniform4fv(t,i)},r[35667]=function(n,t,i){n.uniform2iv(t,i)},r[35668]=function(n,t,i){n.uniform3iv(t,i)},r[35669]=function(n,t,i){n.uniform4iv(t,i)},r[35670]=function(n,t,i){n.uniform1i(t,i)},r[35671]=function(n,t,i){n.uniform2iv(t,i)},r[35672]=function(n,t,i){n.uniform3iv(t,i)},r[35673]=function(n,t,i){n.uniform4iv(t,i)},r[35674]=function(n,t,i){n.uniformMatrix2fv(t,!1,i)},r[35675]=function(n,t,i){n.uniformMatrix3fv(t,!1,i)},r[35676]=function(n,t,i){n.uniformMatrix4fv(t,!1,i)},r[35678]=function(n,t,i){n.uniform1i(t,i)},r[35680]=function(n,t,i){n.uniform1i(t,i)},r);c=((u={})[5124]=function(n,t,i){n.uniform1iv(t,i)},u[5126]=function(n,t,i){n.uniform1fv(t,i)},u[35664]=function(n,t,i){n.uniform2fv(t,i)},u[35665]=function(n,t,i){n.uniform3fv(t,i)},u[35666]=function(n,t,i){n.uniform4fv(t,i)},u[35667]=function(n,t,i){n.uniform2iv(t,i)},u[35668]=function(n,t,i){n.uniform3iv(t,i)},u[35669]=function(n,t,i){n.uniform4iv(t,i)},u[35670]=function(n,t,i){n.uniform1iv(t,i)},u[35671]=function(n,t,i){n.uniform2iv(t,i)},u[35672]=function(n,t,i){n.uniform3iv(t,i)},u[35673]=function(n,t,i){n.uniform4iv(t,i)},u[35674]=function(n,t,i){n.uniformMatrix2fv(t,!1,i)},u[35675]=function(n,t,i){n.uniformMatrix3fv(t,!1,i)},u[35676]=function(n,t,i){n.uniformMatrix4fv(t,!1,i)},u[35678]=function(n,t,i){n.uniform1iv(t,i)},u[35680]=function(n,t,i){n.uniform1iv(t,i)},u);l=function(){function t(n,t){var r,i;void 0===(t=t||{}).alpha&&(t.alpha=!1);void 0===t.stencil&&(t.stencil=!0);void 0===t.depth&&(t.depth=!0);void 0===t.antialias&&(t.antialias=!1);void 0===t.preserveDrawingBuffer&&(t.preserveDrawingBuffer=!1);try{r=n.getContext("webgl",t)||n.getContext("experimental-webgl",t)||n.getContext("webkit-3d",t)||n.getContext("moz-webgl",t)}catch(u){return u={},void console.error(u)}for(r||console.error("This device does not support webgl"),this._gl=r,this._extensions={},this._caps={},this._stats={texture:0,vb:0,ib:0,drawcalls:0},this._initExtensions(["EXT_texture_filter_anisotropic","EXT_shader_texture_lod","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","WEBGL_draw_buffers"]),this._initCaps(),this._initStates(),o.default.initDefault(this),this._current=new o.default(this),this._next=new o.default(this),this._uniforms={},this._vx=this._vy=this._vw=this._vh=0,this._sx=this._sy=this._sw=this._sh=0,this._framebuffer=null,this._enabledAttributes=new Array(this._caps.maxVertexAttribs),this._newAttributes=new Array(this._caps.maxVertexAttribs),i=0;i<this._caps.maxVertexAttribs;++i)this._enabledAttributes[i]=0,this._newAttributes[i]=0}var i,r,n;return i=t,(r=[{key:"caps",get:function(){return this._caps}}])&&y(i.prototype,r),n=t.prototype,n._initExtensions=function(n){for(var r,f=this._gl,t=0;t<n.length;++t)for(var e=n[t],o=["","WEBKIT_","MOZ_"],i=0;i<o.length;i++)try{if(r=f.getExtension(o[i]+e),r){this._extensions[e]=r;break}}catch(u){u={};console.error(u)}},n._initCaps=function(){var n=this._gl,t=this.ext("WEBGL_draw_buffers");this._caps.maxVertexStreams=4;this._caps.maxVertexTextures=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS);this._caps.maxFragUniforms=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS);this._caps.maxTextureUnits=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);this._caps.maxVertexAttribs=n.getParameter(n.MAX_VERTEX_ATTRIBS);this._caps.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE);this._caps.maxDrawBuffers=t?n.getParameter(t.MAX_DRAW_BUFFERS_WEBGL):1;this._caps.maxColorAttachments=t?n.getParameter(t.MAX_COLOR_ATTACHMENTS_WEBGL):1},n._initStates=function(){var n=this._gl;n.disable(n.BLEND);n.blendFunc(n.ONE,n.ZERO);n.blendEquation(n.FUNC_ADD);n.blendColor(1,1,1,1);n.colorMask(!0,!0,!0,!0);n.enable(n.CULL_FACE);n.cullFace(n.BACK);n.disable(n.DEPTH_TEST);n.depthFunc(n.LESS);n.depthMask(!1);n.disable(n.POLYGON_OFFSET_FILL);n.depthRange(0,1);n.disable(n.STENCIL_TEST);n.stencilFunc(n.ALWAYS,0,255);n.stencilMask(255);n.stencilOp(n.KEEP,n.KEEP,n.KEEP);n.clearDepth(1);n.clearColor(0,0,0,0);n.clearStencil(0);n.disable(n.SCISSOR_TEST)},n._restoreTexture=function(n){var i=this._gl,t=this._current.textureUnits[n];t&&-1!==t._glID?i.bindTexture(t._target,t._glID):i.bindTexture(i.TEXTURE_2D,null)},n._restoreIndexBuffer=function(){var n=this._gl,t=this._current.indexBuffer;t&&-1!==t._glID?n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t._glID):n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)},n.ext=function(n){return this._extensions[n]},n.allowFloatTexture=function(){return null!=this.ext("OES_texture_float")},n.setFrameBuffer=function(n){var t,u,i,f,r;if(this._framebuffer!==n)if(this._framebuffer=n,t=this._gl,n){for(t.bindFramebuffer(t.FRAMEBUFFER,n._glID),u=n._colors.length,i=0;i<u;++i)f=n._colors[i],e(t,t.COLOR_ATTACHMENT0+i,f);for(r=u;r<this._caps.maxColorAttachments;++r)t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+r,t.TEXTURE_2D,null,0);n._depth&&e(t,t.DEPTH_ATTACHMENT,n._depth);n._stencil&&e(t,t.STENCIL_ATTACHMENT,n._stencil);n._depthStencil&&e(t,t.DEPTH_STENCIL_ATTACHMENT,n._depthStencil)}else t.bindFramebuffer(t.FRAMEBUFFER,null)},n.setViewport=function(n,t,i,r){this._vx===n&&this._vy===t&&this._vw===i&&this._vh===r||(this._gl.viewport(n,t,i,r),this._vx=n,this._vy=t,this._vw=i,this._vh=r)},n.setScissor=function(n,t,i,r){this._sx===n&&this._sy===t&&this._sw===i&&this._sh===r||(this._gl.scissor(n,t,i,r),this._sx=n,this._sy=t,this._sw=i,this._sh=r)},n.clear=function(n){if(void 0!==n.color||void 0!==n.depth||void 0!==n.stencil){var t=this._gl,i=0;void 0!==n.color&&(i|=t.COLOR_BUFFER_BIT,t.clearColor(n.color[0],n.color[1],n.color[2],n.color[3]));void 0!==n.depth&&(i|=t.DEPTH_BUFFER_BIT,t.clearDepth(n.depth),t.enable(t.DEPTH_TEST),t.depthMask(!0),t.depthFunc(t.ALWAYS));void 0!==n.stencil&&(i|=t.STENCIL_BUFFER_BIT,t.clearStencil(n.stencil));t.clear(i);void 0!==n.depth&&(!1===this._current.depthTest?t.disable(t.DEPTH_TEST):(!1===this._current.depthWrite&&t.depthMask(!1),this._current.depthFunc!==f.enums.DS_FUNC_ALWAYS&&t.depthFunc(this._current.depthFunc)))}},n.enableBlend=function(){this._next.blend=!0},n.enableDepthTest=function(){this._next.depthTest=!0},n.enableDepthWrite=function(){this._next.depthWrite=!0},n.setStencilTest=function(n){this._next.stencilTest=n},n.setStencilFunc=function(n,t,i){this._next.stencilSep=!1;this._next.stencilFuncFront=this._next.stencilFuncBack=n;this._next.stencilRefFront=this._next.stencilRefBack=t;this._next.stencilMaskFront=this._next.stencilMaskBack=i},n.setStencilFuncFront=function(n,t,i){this._next.stencilSep=!0;this._next.stencilFuncFront=n;this._next.stencilRefFront=t;this._next.stencilMaskFront=i},n.setStencilFuncBack=function(n,t,i){this._next.stencilSep=!0;this._next.stencilFuncBack=n;this._next.stencilRefBack=t;this._next.stencilMaskBack=i},n.setStencilOp=function(n,t,i,r){this._next.stencilFailOpFront=this._next.stencilFailOpBack=n;this._next.stencilZFailOpFront=this._next.stencilZFailOpBack=t;this._next.stencilZPassOpFront=this._next.stencilZPassOpBack=i;this._next.stencilWriteMaskFront=this._next.stencilWriteMaskBack=r},n.setStencilOpFront=function(n,t,i,r){this._next.stencilSep=!0;this._next.stencilFailOpFront=n;this._next.stencilZFailOpFront=t;this._next.stencilZPassOpFront=i;this._next.stencilWriteMaskFront=r},n.setStencilOpBack=function(n,t,i,r){this._next.stencilSep=!0;this._next.stencilFailOpBack=n;this._next.stencilZFailOpBack=t;this._next.stencilZPassOpBack=i;this._next.stencilWriteMaskBack=r},n.setDepthFunc=function(n){this._next.depthFunc=n},n.setBlendColor32=function(n){this._next.blendColor=n},n.setBlendColor=function(n,t,i,r){this._next.blendColor=(255*n<<24|255*t<<16|255*i<<8|255*r)>>>0},n.setBlendFunc=function(n,t){this._next.blendSep=!1;this._next.blendSrc=n;this._next.blendDst=t},n.setBlendFuncSep=function(n,t,i,r){this._next.blendSep=!0;this._next.blendSrc=n;this._next.blendDst=t;this._next.blendSrcAlpha=i;this._next.blendDstAlpha=r},n.setBlendEq=function(n){this._next.blendSep=!1;this._next.blendEq=n},n.setBlendEqSep=function(n,t){this._next.blendSep=!0;this._next.blendEq=n;this._next.blendAlphaEq=t},n.setCullMode=function(n){this._next.cullMode=n},n.setVertexBuffer=function(n,t,i){void 0===i&&(i=0);this._next.vertexBuffers[n]=t;this._next.vertexBufferOffsets[n]=i;this._next.maxStream<n&&(this._next.maxStream=n)},n.setIndexBuffer=function(n){this._next.indexBuffer=n},n.setProgram=function(n){this._next.program=n},n.setTexture=function(n,t,i){i>=this._caps.maxTextureUnits?console.warn("Can not set texture "+n+" at stage "+i+", max texture exceed: "+this._caps.maxTextureUnits):(this._next.textureUnits[i]=t,this.setUniform(n,i),this._next.maxTextureSlot<i&&(this._next.maxTextureSlot=i))},n.setTextureArray=function(n,t,i){var f=t.length,r,u;if(f>=this._caps.maxTextureUnits)console.warn("Can not set "+f+" textures for "+n+", max texture exceed: "+this._caps.maxTextureUnits);else{for(r=0;r<f;++r)u=i[r],this._next.textureUnits[u]=t[r],this._next.maxTextureSlot<u&&(this._next.maxTextureSlot=u);this.setUniform(n,i)}},n.setUniform=function(n,t){var i=this._uniforms[n],c=!1,o=!1,s=!1,h=!1,u,f,r,l,e;do{if(!i)break;if(s=Array.isArray(t)||t instanceof Float32Array,h=t instanceof Int32Array,o=s||h,i.isArray!==o)break;if(i.isArray&&i.value.length!==t.length)break;c=!0}while(0);if(c){if(u=i.value,f=!1,i.isArray)for(r=0,l=u.length;r<l;r++)u[r]!==t[r]&&(f=!0,u[r]=t[r]);else u!==t&&(f=!0,i.value=t);f&&(i.dirty=!0)}else e=t,s?e=new Float32Array(t):h&&(e=new Int32Array(t)),i={dirty:!0,value:e,isArray:o};this._uniforms[n]=i},n.setUniformDirectly=function(n,t){var i=this._uniforms[n];i||(this._uniforms[n]=i={});i.dirty=!0;i.value=t},n.setPrimitiveType=function(n){this._next.primitiveType=n},n.resetDrawCalls=function(){this._stats.drawcalls=0},n.getDrawCalls=function(){return this._stats.drawcalls},n.draw=function(n,t){var r=this._gl,u=this._current,i=this._next,s,o,f,e,l;for(p(r,u,i),w(r,u,i),b(r,u,i),k(r,u,i),d(this,r,u,i),u.indexBuffer!==i.indexBuffer&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i.indexBuffer&&-1!==i.indexBuffer._glID?i.indexBuffer._glID:null),s=!1,u.program!==i.program&&(i.program._linked?r.useProgram(i.program._glID):console.warn("Failed to use program: has not linked yet."),s=!0),g(r,u,i),o=0;o<i.program._uniforms.length;++o)f=i.program._uniforms[o],e=this._uniforms[f.name],e&&(s||e.dirty)&&(e.dirty=!1,l=void 0===f.size?h[f.type]:c[f.type],l?l(r,f.location,e.value):console.warn("Can not find commit function for uniform "+f.name));t&&(i.indexBuffer?r.drawElements(this._next.primitiveType,t,i.indexBuffer._format,n*i.indexBuffer._bytesPerIndex):r.drawArrays(this._next.primitiveType,n,t),this._stats.drawcalls++);u.set(i);i.reset()},t}();i.default=l;t.exports=i.default},{"./enums":314,"./state":321,"./texture-2d":322,"./texture-cube":323}],314:[function(n,t,i){"use strict";i.__esModule=!0;i.attrTypeBytes=function(n){return n===r.ATTR_TYPE_INT8?1:n===r.ATTR_TYPE_UINT8?1:n===r.ATTR_TYPE_INT16?2:n===r.ATTR_TYPE_UINT16?2:n===r.ATTR_TYPE_INT32?4:n===r.ATTR_TYPE_UINT32?4:n===r.ATTR_TYPE_FLOAT32?4:(console.warn("Unknown ATTR_TYPE: "+n),0)};i.glFilter=function(n,t,i){void 0===i&&(i=-1);var r=f[t][i+1];return void 0===r?(console.warn("Unknown FILTER: "+t),-1===i?n.LINEAR:n.LINEAR_MIPMAP_LINEAR):r};i.glTextureFmt=function(n){var t=u[n];return void 0===t?(console.warn("Unknown TEXTURE_FMT: "+n),u[r.TEXTURE_FMT_RGBA8]):t};i.enums=void 0;var f=[[9728,9984,9986],[9729,9985,9987]],u=[{format:6407,internalFormat:33776,pixelType:null},{format:6408,internalFormat:33777,pixelType:null},{format:6408,internalFormat:33778,pixelType:null},{format:6408,internalFormat:33779,pixelType:null},{format:6407,internalFormat:36196,pixelType:null},{format:6407,internalFormat:35841,pixelType:null},{format:6408,internalFormat:35843,pixelType:null},{format:6407,internalFormat:35840,pixelType:null},{format:6408,internalFormat:35842,pixelType:null},{format:6406,internalFormat:6406,pixelType:5121},{format:6409,internalFormat:6409,pixelType:5121},{format:6410,internalFormat:6410,pixelType:5121},{format:6407,internalFormat:6407,pixelType:33635},{format:6408,internalFormat:6408,pixelType:32820},{format:6408,internalFormat:6408,pixelType:32819},{format:6407,internalFormat:6407,pixelType:5121},{format:6408,internalFormat:6408,pixelType:5121},{format:6407,internalFormat:6407,pixelType:36193},{format:6408,internalFormat:6408,pixelType:36193},{format:6407,internalFormat:6407,pixelType:5126},{format:6408,internalFormat:6408,pixelType:5126},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:6402,internalFormat:6402,pixelType:5123},{format:6402,internalFormat:6402,pixelType:5125},{format:6402,internalFormat:6402,pixelType:5125},{format:6407,internalFormat:37492,pixelType:null},{format:6408,internalFormat:37496,pixelType:null}],r={USAGE_STATIC:35044,USAGE_DYNAMIC:35048,USAGE_STREAM:35040,INDEX_FMT_UINT8:5121,INDEX_FMT_UINT16:5123,INDEX_FMT_UINT32:5125,ATTR_POSITION:"a_position",ATTR_NORMAL:"a_normal",ATTR_TANGENT:"a_tangent",ATTR_BITANGENT:"a_bitangent",ATTR_WEIGHTS:"a_weights",ATTR_JOINTS:"a_joints",ATTR_COLOR:"a_color",ATTR_COLOR0:"a_color0",ATTR_COLOR1:"a_color1",ATTR_UV:"a_uv",ATTR_UV0:"a_uv0",ATTR_UV1:"a_uv1",ATTR_UV2:"a_uv2",ATTR_UV3:"a_uv3",ATTR_UV4:"a_uv4",ATTR_UV5:"a_uv5",ATTR_UV6:"a_uv6",ATTR_UV7:"a_uv7",ATTR_TEX_COORD:"a_texCoord",ATTR_TEX_COORD1:"a_texCoord1",ATTR_TEX_COORD2:"a_texCoord2",ATTR_TEX_COORD3:"a_texCoord3",ATTR_TEX_COORD4:"a_texCoord4",ATTR_TEX_COORD5:"a_texCoord5",ATTR_TEX_COORD6:"a_texCoord6",ATTR_TEX_COORD7:"a_texCoord7",ATTR_TEX_COORD8:"a_texCoord8",ATTR_TYPE_INT8:5120,ATTR_TYPE_UINT8:5121,ATTR_TYPE_INT16:5122,ATTR_TYPE_UINT16:5123,ATTR_TYPE_INT32:5124,ATTR_TYPE_UINT32:5125,ATTR_TYPE_FLOAT32:5126,FILTER_NEAREST:0,FILTER_LINEAR:1,WRAP_REPEAT:10497,WRAP_CLAMP:33071,WRAP_MIRROR:33648,TEXTURE_FMT_RGB_DXT1:0,TEXTURE_FMT_RGBA_DXT1:1,TEXTURE_FMT_RGBA_DXT3:2,TEXTURE_FMT_RGBA_DXT5:3,TEXTURE_FMT_RGB_ETC1:4,TEXTURE_FMT_RGB_PVRTC_2BPPV1:5,TEXTURE_FMT_RGBA_PVRTC_2BPPV1:6,TEXTURE_FMT_RGB_PVRTC_4BPPV1:7,TEXTURE_FMT_RGBA_PVRTC_4BPPV1:8,TEXTURE_FMT_A8:9,TEXTURE_FMT_L8:10,TEXTURE_FMT_L8_A8:11,TEXTURE_FMT_R5_G6_B5:12,TEXTURE_FMT_R5_G5_B5_A1:13,TEXTURE_FMT_R4_G4_B4_A4:14,TEXTURE_FMT_RGB8:15,TEXTURE_FMT_RGBA8:16,TEXTURE_FMT_RGB16F:17,TEXTURE_FMT_RGBA16F:18,TEXTURE_FMT_RGB32F:19,TEXTURE_FMT_RGBA32F:20,TEXTURE_FMT_R32F:21,TEXTURE_FMT_111110F:22,TEXTURE_FMT_SRGB:23,TEXTURE_FMT_SRGBA:24,TEXTURE_FMT_D16:25,TEXTURE_FMT_D32:26,TEXTURE_FMT_D24S8:27,TEXTURE_FMT_RGB_ETC2:28,TEXTURE_FMT_RGBA_ETC2:29,DS_FUNC_NEVER:512,DS_FUNC_LESS:513,DS_FUNC_EQUAL:514,DS_FUNC_LEQUAL:515,DS_FUNC_GREATER:516,DS_FUNC_NOTEQUAL:517,DS_FUNC_GEQUAL:518,DS_FUNC_ALWAYS:519,RB_FMT_RGBA4:32854,RB_FMT_RGB5_A1:32855,RB_FMT_RGB565:36194,RB_FMT_D16:33189,RB_FMT_S8:36168,RB_FMT_D24S8:34041,BLEND_FUNC_ADD:32774,BLEND_FUNC_SUBTRACT:32778,BLEND_FUNC_REVERSE_SUBTRACT:32779,BLEND_ZERO:0,BLEND_ONE:1,BLEND_SRC_COLOR:768,BLEND_ONE_MINUS_SRC_COLOR:769,BLEND_DST_COLOR:774,BLEND_ONE_MINUS_DST_COLOR:775,BLEND_SRC_ALPHA:770,BLEND_ONE_MINUS_SRC_ALPHA:771,BLEND_DST_ALPHA:772,BLEND_ONE_MINUS_DST_ALPHA:773,BLEND_CONSTANT_COLOR:32769,BLEND_ONE_MINUS_CONSTANT_COLOR:32770,BLEND_CONSTANT_ALPHA:32771,BLEND_ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_SRC_ALPHA_SATURATE:776,STENCIL_DISABLE:0,STENCIL_ENABLE:1,STENCIL_INHERIT:2,STENCIL_OP_KEEP:7680,STENCIL_OP_ZERO:0,STENCIL_OP_REPLACE:7681,STENCIL_OP_INCR:7682,STENCIL_OP_INCR_WRAP:34055,STENCIL_OP_DECR:7683,STENCIL_OP_DECR_WRAP:34056,STENCIL_OP_INVERT:5386,CULL_NONE:0,CULL_FRONT:1028,CULL_BACK:1029,CULL_FRONT_AND_BACK:1032,PT_POINTS:0,PT_LINES:1,PT_LINE_LOOP:2,PT_LINE_STRIP:3,PT_TRIANGLES:4,PT_TRIANGLE_STRIP:5,PT_TRIANGLE_FAN:6};i.enums=r},{}],315:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var r=function(){function n(n,t,i,r){this._device=n;this._width=t;this._height=i;this._colors=r.colors||[];this._depth=r.depth||null;this._stencil=r.stencil||null;this._depthStencil=r.depthStencil||null;this._glID=n._gl.createFramebuffer()}var t=n.prototype;return t.destroy=function(){null!==this._glID?(this._device._gl.deleteFramebuffer(this._glID),this._glID=null):console.error("The frame-buffer already destroyed")},t.getHandle=function(){return this._glID},n}();i.default=r;t.exports=i.default},{}],316:[function(n,t,i){"use strict";function s(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}var r,u,f,e,o;i.__esModule=!0;i.default=void 0;u=n("./enums");f=((r={})[u.enums.INDEX_FMT_UINT8]=1,r[u.enums.INDEX_FMT_UINT16]=2,r[u.enums.INDEX_FMT_UINT32]=4,r);e=function(){function n(n,t,i,r){this._device=n;this._format=t;this._usage=i;this._bytesPerIndex=f[t];this._bytes=r.byteLength;this._numIndices=this._bytes/this._bytesPerIndex;this._needExpandDataStore=!0;this._glID=n._gl.createBuffer();this.update(0,r);n._stats.ib+=this._bytes}var i,r,t=n.prototype;return t.destroy=function(){-1!==this._glID?(this._device._gl.deleteBuffer(this._glID),this._device._stats.ib-=this.bytes,this._glID=-1):console.error("The buffer already destroyed")},t.update=function(n,t){if(-1!==this._glID){if(0!==t.byteLength){if(n+t.byteLength>this._bytes){if(n)return void console.error("Failed to update data, bytes exceed.");this._needExpandDataStore=!0;this._bytes=n+t.byteLength;this._numIndices=this._bytes/this._bytesPerIndex}var i=this._device._gl,r=this._usage;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._glID);this._needExpandDataStore?(i.bufferData(i.ELEMENT_ARRAY_BUFFER,t,r),this._needExpandDataStore=!1):i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,n,t);this._device._restoreIndexBuffer()}}else console.error("The buffer is destroyed")},t.setUsage=function(n){this._usage=n},i=n,(r=[{key:"count",get:function(){return this._numIndices}}])&&s(i.prototype,r),n}();e.BYTES_PER_INDEX=f;o=e;i.default=o;t.exports=i.default},{"./enums":314}],317:[function(n,t,i){"use strict";var u,r,f;i.__esModule=!0;i.default=void 0;r=n("./enums");u={VertexFormat:n("./vertex-format"),IndexBuffer:n("./index-buffer"),VertexBuffer:n("./vertex-buffer"),Program:n("./program"),Texture:n("./texture"),Texture2D:n("./texture-2d"),TextureCube:n("./texture-cube"),RenderBuffer:n("./render-buffer"),FrameBuffer:n("./frame-buffer"),Device:n("./device"),attrTypeBytes:r.attrTypeBytes,glFilter:r.glFilter,glTextureFmt:r.glTextureFmt};Object.assign(u,r.enums);f=u;i.default=f;cc.gfx=u;t.exports=i.default},{"./device":313,"./enums":314,"./frame-buffer":315,"./index-buffer":316,"./program":319,"./render-buffer":320,"./texture":324,"./texture-2d":322,"./texture-cube":323,"./vertex-buffer":325,"./vertex-format":326}],318:[function(n,t,i){"use strict";i.__esModule=!0;i.isPow2=function(n){return!(n&n-1||!n)}},{}],319:[function(n,t,i){"use strict";function o(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}function u(n,t,i){i.split("\n").forEach(function(i){if(!(i.length<5)){var r=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(i);r?n.push({type:t,fileID:0|r[1],line:0|r[2],message:r[3].trim()}):i.length>0&&n.push({type:t,fileID:-1,line:0,message:i})}})}function e(n,t,i){var r=n.createShader(t);return n.shaderSource(r,i),n.compileShader(r),r}var r,f;i.__esModule=!0;i.default=void 0;r=0;f=function(){function n(n,t){this._device=n;this._attributes=[];this._uniforms=[];this._samplers=[];this._errors=[];this._linked=!1;this._vertSource=t.vert;this._fragSource=t.frag;this._glID=null;this._id=r++}var t,i,f=n.prototype;return f.link=function(){var s,r,v,h,c,y,p,l,b;if(!this._linked){var n=this._device._gl,f=e(n,n.VERTEX_SHADER,this._vertSource),o=e(n,n.FRAGMENT_SHADER,this._fragSource),t=n.createProgram();if(n.attachShader(t,f),n.attachShader(t,o),n.linkProgram(t),s=!1,r=this._errors,n.getShaderParameter(f,n.COMPILE_STATUS)||(u(r,"vs",n.getShaderInfoLog(f)),s=!0),n.getShaderParameter(o,n.COMPILE_STATUS)||(u(r,"fs",n.getShaderInfoLog(o)),s=!0),n.deleteShader(f),n.deleteShader(o),s)return r;if(!n.getProgramParameter(t,n.LINK_STATUS))return r.push({info:"Failed to link shader program: "+n.getProgramInfoLog(t)}),r;for(this._glID=t,v=n.getProgramParameter(t,n.ACTIVE_ATTRIBUTES),h=0;h<v;++h)c=n.getActiveAttrib(t,h),y=n.getAttribLocation(t,c.name),this._attributes.push({name:c.name,location:y,type:c.type});for(p=n.getProgramParameter(t,n.ACTIVE_UNIFORMS),l=0;l<p;++l){var a=n.getActiveUniform(t,l),i=a.name,k=n.getUniformLocation(t,i),w="[0]"===i.substr(i.length-3);w&&(i=i.substr(0,i.length-3));b={name:i,location:k,type:a.type,size:w?a.size:void 0};this._uniforms.push(b)}this._linked=!0}},f.destroy=function(){this._device._gl.deleteProgram(this._glID);this._linked=!1;this._glID=null;this._attributes=[];this._uniforms=[];this._samplers=[]},t=n,(i=[{key:"id",get:function(){return this._id}}])&&o(t.prototype,i),n}();i.default=f;t.exports=i.default},{}],320:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var r=function(){function n(n,t,i,r){this._device=n;this._format=t;this._glID=n._gl.createRenderbuffer();this.update(i,r)}var t=n.prototype;return t.update=function(n,t){this._width=n;this._height=t;var i=this._device._gl;i.bindRenderbuffer(i.RENDERBUFFER,this._glID);i.renderbufferStorage(i.RENDERBUFFER,this._format,n,t);i.bindRenderbuffer(i.RENDERBUFFER,null)},t.destroy=function(){if(null!==this._glID){var n=this._device._gl;n.bindRenderbuffer(n.RENDERBUFFER,null);n.deleteRenderbuffer(this._glID);this._glID=null}else console.error("The render-buffer already destroyed")},n}();i.default=r;t.exports=i.default},{}],321:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var r=n("./enums"),u={blend:!1,blendSep:!1,blendColor:4294967295,blendEq:r.enums.BLEND_FUNC_ADD,blendAlphaEq:r.enums.BLEND_FUNC_ADD,blendSrc:r.enums.BLEND_ONE,blendDst:r.enums.BLEND_ZERO,blendSrcAlpha:r.enums.BLEND_ONE,blendDstAlpha:r.enums.BLEND_ZERO,depthTest:!1,depthWrite:!1,depthFunc:r.enums.DS_FUNC_LESS,stencilTest:!1,stencilSep:!1,stencilFuncFront:r.enums.DS_FUNC_ALWAYS,stencilRefFront:0,stencilMaskFront:255,stencilFailOpFront:r.enums.STENCIL_OP_KEEP,stencilZFailOpFront:r.enums.STENCIL_OP_KEEP,stencilZPassOpFront:r.enums.STENCIL_OP_KEEP,stencilWriteMaskFront:255,stencilFuncBack:r.enums.DS_FUNC_ALWAYS,stencilRefBack:0,stencilMaskBack:255,stencilFailOpBack:r.enums.STENCIL_OP_KEEP,stencilZFailOpBack:r.enums.STENCIL_OP_KEEP,stencilZPassOpBack:r.enums.STENCIL_OP_KEEP,stencilWriteMaskBack:255,cullMode:r.enums.CULL_BACK,primitiveType:r.enums.PT_TRIANGLES,maxStream:-1,vertexBuffers:[],vertexBufferOffsets:[],indexBuffer:null,maxTextureSlot:-1,textureUnits:[],program:null},f=function(){function n(n){this.vertexBuffers=new Array(n._caps.maxVertexStreams);this.vertexBufferOffsets=new Array(n._caps.maxVertexStreams);this.textureUnits=new Array(n._caps.maxTextureUnits);this.set(u)}n.initDefault=function(n){u.vertexBuffers=new Array(n._caps.maxVertexStreams);u.vertexBufferOffsets=new Array(n._caps.maxVertexStreams);u.textureUnits=new Array(n._caps.maxTextureUnits)};var t=n.prototype;return t.reset=function(){this.set(u)},t.set=function(n){var t,i,r;for(this.blend=n.blend,this.blendSep=n.blendSep,this.blendColor=n.blendColor,this.blendEq=n.blendEq,this.blendAlphaEq=n.blendAlphaEq,this.blendSrc=n.blendSrc,this.blendDst=n.blendDst,this.blendSrcAlpha=n.blendSrcAlpha,this.blendDstAlpha=n.blendDstAlpha,this.depthTest=n.depthTest,this.depthWrite=n.depthWrite,this.depthFunc=n.depthFunc,this.stencilTest=n.stencilTest,this.stencilSep=n.stencilSep,this.stencilFuncFront=n.stencilFuncFront,this.stencilRefFront=n.stencilRefFront,this.stencilMaskFront=n.stencilMaskFront,this.stencilFailOpFront=n.stencilFailOpFront,this.stencilZFailOpFront=n.stencilZFailOpFront,this.stencilZPassOpFront=n.stencilZPassOpFront,this.stencilWriteMaskFront=n.stencilWriteMaskFront,this.stencilFuncBack=n.stencilFuncBack,this.stencilRefBack=n.stencilRefBack,this.stencilMaskBack=n.stencilMaskBack,this.stencilFailOpBack=n.stencilFailOpBack,this.stencilZFailOpBack=n.stencilZFailOpBack,this.stencilZPassOpBack=n.stencilZPassOpBack,this.stencilWriteMaskBack=n.stencilWriteMaskBack,this.cullMode=n.cullMode,this.primitiveType=n.primitiveType,this.maxStream=n.maxStream,t=0;t<n.vertexBuffers.length;++t)this.vertexBuffers[t]=n.vertexBuffers[t];for(i=0;i<n.vertexBufferOffsets.length;++i)this.vertexBufferOffsets[i]=n.vertexBufferOffsets[i];for(this.indexBuffer=n.indexBuffer,this.maxTextureSlot=n.maxTextureSlot,r=0;r<n.textureUnits.length;++r)this.textureUnits[r]=n.textureUnits[r];this.program=n.program},n}();i.default=f;t.exports=i.default},{"./enums":314}],322:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var u,e=(u=n("./texture"))&&u.__esModule?u:{"default":u},r=n("./enums"),f=n("./misc"),o=function(n){function e(t,i){var r,u=(r=n.call(this,t)||this)._device._gl;return r._target=u.TEXTURE_2D,r._glID=u.createTexture(),i.images=i.images||[null],r.update(i),r}var i,u,t;return u=n,(i=e).prototype=Object.create(u.prototype),i.prototype.constructor=i,i.__proto__=u,t=e.prototype,t.update=function(n){var t=this._device._gl,i=this._genMipmap,u,e;n&&(void 0!==n.width&&(this._width=n.width),void 0!==n.height&&(this._height=n.height),void 0!==n.anisotropy&&(this._anisotropy=n.anisotropy),void 0!==n.minFilter&&(this._minFilter=n.minFilter),void 0!==n.magFilter&&(this._magFilter=n.magFilter),void 0!==n.mipFilter&&(this._mipFilter=n.mipFilter),void 0!==n.wrapS&&(this._wrapS=n.wrapS),void 0!==n.wrapT&&(this._wrapT=n.wrapT),void 0!==n.format&&(this._format=n.format,this._compressed=this._format>=r.enums.TEXTURE_FMT_RGB_DXT1&&this._format<=r.enums.TEXTURE_FMT_RGBA_PVRTC_4BPPV1||this._format>=r.enums.TEXTURE_FMT_RGB_ETC2&&this._format<=r.enums.TEXTURE_FMT_RGBA_ETC2),void 0!==n.genMipmaps&&(this._genMipmap=n.genMipmaps,i=n.genMipmaps),u=this._device.caps.maxTextureSize||Number.MAX_VALUE,e=Math.max(n.width||0,n.height||0),u<e&&console.warn("The current texture size "+e+" exceeds the maximum size ["+u+"] supported on the device."),void 0!==n.images&&n.images.length>1&&(i=!1,(n.width>n.height?n.width:n.height)>>n.images.length-1!=1&&console.error("texture-2d mipmap is invalid, should have a 1x1 mipmap.")));f.isPow2(this._width)&&f.isPow2(this._height)||(i=!1);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,this._glID);void 0!==n.images&&n.images.length>0&&(this._setMipmap(n.images,n.flipY,n.premultiplyAlpha),n.images.length>1&&(this._genMipmap=!0));i&&(t.hint(t.GENERATE_MIPMAP_HINT,t.NICEST),t.generateMipmap(t.TEXTURE_2D),this._genMipmap=!0);this._setTexInfo();this._device._restoreTexture(0)},t.updateSubImage=function(n){var t=this._device._gl,i=r.glTextureFmt(this._format);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,this._glID);this._setSubImage(i,n);this._device._restoreTexture(0)},t.updateImage=function(n){var t=this._device._gl,i=r.glTextureFmt(this._format);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,this._glID);this._setImage(i,n);this._device._restoreTexture(0)},t._setSubImage=function(n,t){var i=this._device._gl,u=t.flipY,f=t.premultiplyAlpha,r=t.image;!r||ArrayBuffer.isView(r)||r instanceof ArrayBuffer?(void 0===u?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,u),void 0===f?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),this._compressed?i.compressedTexSubImage2D(i.TEXTURE_2D,t.level,t.x,t.y,t.width,t.height,n.format,r):i.texSubImage2D(i.TEXTURE_2D,t.level,t.x,t.y,t.width,t.height,n.format,n.pixelType,r)):(void 0===u?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,u),void 0===f?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),i.texSubImage2D(i.TEXTURE_2D,t.level,t.x,t.y,n.format,n.pixelType,r))},t._setImage=function(n,t){var i=this._device._gl,u=t.flipY,f=t.premultiplyAlpha,r=t.image;!r||ArrayBuffer.isView(r)||r instanceof ArrayBuffer?(void 0===u?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,u),void 0===f?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),this._compressed?i.compressedTexImage2D(i.TEXTURE_2D,t.level,n.internalFormat,t.width,t.height,0,r):i.texImage2D(i.TEXTURE_2D,t.level,n.internalFormat,t.width,t.height,0,n.format,n.pixelType,r)):(void 0===u?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,u),void 0===f?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),i.texImage2D(i.TEXTURE_2D,t.level,n.internalFormat,n.format,n.pixelType,r))},t._setMipmap=function(n,t,i){for(var e=r.glTextureFmt(this._format),f={width:this._width,height:this._height,flipY:t,premultiplyAlpha:i,level:0,image:null},u=0;u<n.length;++u)f.level=u,f.width=this._width>>u,f.height=this._height>>u,f.image=n[u],this._setImage(e,f)},t._setTexInfo=function(){var n=this._device._gl,u=f.isPow2(this._width)&&f.isPow2(this._height),t,i;u||this._wrapS===r.enums.WRAP_CLAMP&&this._wrapT===r.enums.WRAP_CLAMP||(console.warn("WebGL1 doesn't support all wrap modes with NPOT textures"),this._wrapS=r.enums.WRAP_CLAMP,this._wrapT=r.enums.WRAP_CLAMP);t=this._genMipmap?this._mipFilter:-1;u||-1===t||(console.warn("NPOT textures do not support mipmap filter"),t=-1);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,r.glFilter(n,this._minFilter,t));n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,r.glFilter(n,this._magFilter,-1));n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,this._wrapS);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,this._wrapT);i=this._device.ext("EXT_texture_filter_anisotropic");i&&n.texParameteri(n.TEXTURE_2D,i.TEXTURE_MAX_ANISOTROPY_EXT,this._anisotropy)},e}(e.default);i.default=o;t.exports=i.default},{"./enums":314,"./misc":318,"./texture":324}],323:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var u,e=(u=n("./texture"))&&u.__esModule?u:{"default":u},r=n("./enums"),f=n("./misc"),o=function(n){function e(t,i){var r,u=(r=n.call(this,t)||this)._device._gl;return r._target=u.TEXTURE_CUBE_MAP,r._glID=u.createTexture(),r.update(i),r}var i,u,t;return u=n,(i=e).prototype=Object.create(u.prototype),i.prototype.constructor=i,i.__proto__=u,t=e.prototype,t.update=function(n){var t=this._device._gl,i=this._genMipmaps;n&&(void 0!==n.width&&(this._width=n.width),void 0!==n.height&&(this._height=n.height),void 0!==n.anisotropy&&(this._anisotropy=n.anisotropy),void 0!==n.minFilter&&(this._minFilter=n.minFilter),void 0!==n.magFilter&&(this._magFilter=n.magFilter),void 0!==n.mipFilter&&(this._mipFilter=n.mipFilter),void 0!==n.wrapS&&(this._wrapS=n.wrapS),void 0!==n.wrapT&&(this._wrapT=n.wrapT),void 0!==n.format&&(this._format=n.format,this._compressed=this._format>=r.enums.TEXTURE_FMT_RGB_DXT1&&this._format<=r.enums.TEXTURE_FMT_RGBA_PVRTC_4BPPV1||this._format>=r.enums.TEXTURE_FMT_RGB_ETC2&&this._format<=r.enums.TEXTURE_FMT_RGBA_ETC2),void 0!==n.genMipmaps&&(this._genMipmaps=n.genMipmaps,i=n.genMipmaps),void 0!==n.images&&n.images.length>1&&(i=!1,n.width!==n.height&&console.warn("texture-cube width and height should be identical."),n.width>>n.images.length-1!=1&&console.error("texture-cube mipmap is invalid. please set mipmap as 1x1, 2x2, 4x4 ... nxn")));f.isPow2(this._width)&&f.isPow2(this._height)||(i=!1);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_CUBE_MAP,this._glID);void 0!==n.images&&n.images.length>0&&(this._setMipmap(n.images,n.flipY,n.premultiplyAlpha),n.images.length>1&&(this._genMipmaps=!0));i&&(t.hint(t.GENERATE_MIPMAP_HINT,t.NICEST),t.generateMipmap(t.TEXTURE_CUBE_MAP),this._genMipmaps=!0);this._setTexInfo();this._device._restoreTexture(0)},t.updateSubImage=function(n){var t=this._device._gl,i=r.glTextureFmt(this._format);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_CUBE_MAP,this._glID);this._setSubImage(i,n);this._device._restoreTexture(0)},t.updateImage=function(n){var t=this._device._gl,i=r.glTextureFmt(this._format);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_CUBE_MAP,this._glID);this._setImage(i,n);this._device._restoreTexture(0)},t._setSubImage=function(n,t){var i=this._device._gl,f=t.flipY,e=t.premultiplyAlpha,u=t.faceIndex,r=t.image;void 0===f?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,f);void 0===e?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e);!r||ArrayBuffer.isView(r)||r instanceof ArrayBuffer?this._compressed?i.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+u,t.level,t.x,t.y,t.width,t.height,n.format,r):i.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+u,t.level,t.x,t.y,t.width,t.height,n.format,n.pixelType,r):i.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+u,t.level,t.x,t.y,n.format,n.pixelType,r)},t._setImage=function(n,t){var i=this._device._gl,f=t.flipY,e=t.premultiplyAlpha,u=t.faceIndex,r=t.image;void 0===f?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,f);void 0===e?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e);!r||ArrayBuffer.isView(r)||r instanceof ArrayBuffer?this._compressed?i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+u,t.level,n.internalFormat,t.width,t.height,0,r):i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+u,t.level,n.internalFormat,t.width,t.height,0,n.format,n.pixelType,r):i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+u,t.level,n.internalFormat,n.format,n.pixelType,r)},t._setMipmap=function(n,t,i){for(var o,e,s=r.glTextureFmt(this._format),u={width:this._width,height:this._height,faceIndex:0,flipY:t,premultiplyAlpha:i,level:0,image:null},f=0;f<n.length;++f)for(o=n[f],u.level=f,u.width=this._width>>f,u.height=this._height>>f,e=0;e<6;++e)u.faceIndex=e,u.image=o[e],this._setImage(s,u)},t._setTexInfo=function(){var n=this._device._gl,u=f.isPow2(this._width)&&f.isPow2(this._height),t,i;u||this._wrapS===r.enums.WRAP_CLAMP&&this._wrapT===r.enums.WRAP_CLAMP||(console.warn("WebGL1 doesn't support all wrap modes with NPOT textures"),this._wrapS=r.enums.WRAP_CLAMP,this._wrapT=r.enums.WRAP_CLAMP);t=this._genMipmaps?this._mipFilter:-1;u||-1===t||(console.warn("NPOT textures do not support mipmap filter"),t=-1);n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,r.glFilter(n,this._minFilter,t));n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,r.glFilter(n,this._magFilter,-1));n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,this._wrapS);n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,this._wrapT);i=this._device.ext("EXT_texture_filter_anisotropic");i&&n.texParameteri(n.TEXTURE_CUBE_MAP,i.TEXTURE_MAX_ANISOTROPY_EXT,this._anisotropy)},e}(e.default);i.default=o;t.exports=i.default},{"./enums":314,"./misc":318,"./texture":324}],324:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var r=n("./enums"),u=0,f=function(){function n(n){this._device=n;this._width=4;this._height=4;this._genMipmaps=!1;this._compressed=!1;this._anisotropy=1;this._minFilter=r.enums.FILTER_LINEAR;this._magFilter=r.enums.FILTER_LINEAR;this._mipFilter=r.enums.FILTER_LINEAR;this._wrapS=r.enums.WRAP_REPEAT;this._wrapT=r.enums.WRAP_REPEAT;this._format=r.enums.TEXTURE_FMT_RGBA8;this._target=-1;this._id=u++}return n.prototype.destroy=function(){null!==this._glID?(this._device._gl.deleteTexture(this._glID),this._device._stats.tex-=this.bytes,this._glID=null):console.error("The texture already destroyed")},n}();i.default=f;t.exports=i.default},{"./enums":314}],325:[function(n,t,i){"use strict";function r(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}i.__esModule=!0;i.default=void 0;n("./enums");var u=function(){function t(n,t,i,r){this._device=n;this._format=t;this._usage=i;this._bytesPerVertex=this._format._bytes;this._bytes=r.byteLength;this._numVertices=this._bytes/this._bytesPerVertex;this._needExpandDataStore=!0;this._glID=n._gl.createBuffer();this.update(0,r);n._stats.vb+=this._bytes}var i,u,n=t.prototype;return n.destroy=function(){-1!==this._glID?(this._device._gl.deleteBuffer(this._glID),this._device._stats.vb-=this.bytes,this._glID=-1):console.error("The buffer already destroyed")},n.update=function(n,t){if(-1!==this._glID){if(0!==t.byteLength){if(n+t.byteLength>this._bytes){if(n)return void console.error("Failed to update data, bytes exceed.");this._needExpandDataStore=!0;this._bytes=n+t.byteLength;this._numVertices=this._bytes/this._bytesPerVertex}var i=this._device._gl,r=this._usage;i.bindBuffer(i.ARRAY_BUFFER,this._glID);this._needExpandDataStore?(i.bufferData(i.ARRAY_BUFFER,t,r),this._needExpandDataStore=!1):i.bufferSubData(i.ARRAY_BUFFER,n,t);i.bindBuffer(i.ARRAY_BUFFER,null)}}else console.error("The buffer is destroyed")},n.getFormat=function(n){return this._format.element(n)},n.setUsage=function(n){this._usage=n},i=t,(u=[{key:"count",get:function(){return this._numVertices}}])&&r(i.prototype,u),t}();i.default=u;t.exports=i.default},{"./enums":314}],326:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var r,u=n("./enums"),f=(r=n("../murmurhash2_gc"))&&r.__esModule?r:{"default":r},e=function(){function n(n){var i,t,r,s;this._attr2el={};this._elements=[];this._bytes=0;for(var o="",e=0,h=n.length;e<h;++e)i=n[e],t={name:i.name,offset:this._bytes,stride:0,stream:-1,type:i.type,num:i.num,normalize:void 0!==i.normalize&&i.normalize,bytes:i.num*u.attrTypeBytes(i.type)},this._attr2el[t.name]=t,this._elements.push(t),this._bytes+=t.bytes,o+=t.name+":"+t.num+":"+t.type+":"+t.normalize;for(r=0,s=this._elements.length;r<s;++r)this._elements[r].stride=this._bytes;this._hash=f.default(o,666)}var t=n.prototype;return t.element=function(n){return this._attr2el[n]},t.getHash=function(){return this._hash},n}();i.default=e;t.exports=i.default},{"../murmurhash2_gc":335,"./enums":314}],327:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var r=function(){function n(n,t){this._cursor=0;this._data=new Array(t);for(var i=0;i<t;++i)this._data[i]=n()}return n.prototype.request=function(){var n=this._data[this._cursor];return this._cursor=(this._cursor+1)%this._data.length,n},n}();i.default=r;t.exports=i.default},{}],328:[function(n,t,i){"use strict";function e(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}var r,u,f;i.__esModule=!0;i.default=void 0;u=(r=n("./timsort"))&&r.__esModule?r:{"default":r};f=function(){function t(n){this._count=0;this._data=new Array(n)}var i,r,n=t.prototype;return n._resize=function(n){if(n>this._data.length)for(var t=this._data.length;t<n;++t)this._data[t]=void 0},n.reset=function(){for(var n=0;n<this._count;++n)this._data[n]=void 0;this._count=0},n.push=function(n){this._count>=this._data.length&&this._resize(2*this._data.length);this._data[this._count]=n;++this._count},n.pop=function(){--this._count;this._count<0&&(this._count=0);var n=this._data[this._count];return this._data[this._count]=void 0,n},n.fastRemove=function(n){if(!(n>=this._count||n<0)){var t=this._count-1;this._data[n]=this._data[t];this._data[t]=void 0;this._count-=1}},n.indexOf=function(n){return this._data.indexOf(n)},n.sort=function(n){return u.default(this._data,0,this._count,n)},i=t,(r=[{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}])&&e(i.prototype,r),t}();i.default=f;t.exports=i.default},{"./timsort":333}],329:[function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}var u,f,e,o,s,h;i.__esModule=!0;i.TypedArrayPool=i.RecyclePool=i.Pool=i.LinkedArray=i.FixedArray=i.CircularPool=void 0;u=r(n("./circular-pool"));i.CircularPool=u.default;f=r(n("./fixed-array"));i.FixedArray=f.default;e=r(n("./linked-array"));i.LinkedArray=e.default;o=r(n("./pool"));i.Pool=o.default;s=r(n("./recycle-pool"));i.RecyclePool=s.default;h=r(n("./typed-array-pool"));i.TypedArrayPool=h.default},{"./circular-pool":327,"./fixed-array":328,"./linked-array":330,"./pool":331,"./recycle-pool":332,"./typed-array-pool":334}],330:[function(n,t,i){"use strict";function e(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}var r,u,f;i.__esModule=!0;i.default=void 0;u=(r=n("./pool"))&&r.__esModule?r:{"default":r};f=function(){function n(n,t){this._fn=n;this._count=0;this._head=null;this._tail=null;this._pool=new u.default(n,t)}var i,r,t=n.prototype;return t.add=function(){var n=this._pool.alloc();return this._tail?(this._tail._next=n,n._prev=this._tail):this._head=n,this._tail=n,this._count+=1,n},t.remove=function(n){n._prev?n._prev._next=n._next:this._head=n._next;n._next?n._next._prev=n._prev:this._tail=n._prev;n._next=null;n._prev=null;this._pool.free(n);this._count-=1},t.forEach=function(n,t){var i=this._head,r,u;if(i)for(t&&(n=n.bind(t)),r=0,u=i;i;)u=i._next,n(i,r,this),i=u,++r},i=n,(r=[{key:"head",get:function(){return this._head}},{key:"tail",get:function(){return this._tail}},{key:"length",get:function(){return this._count}}])&&e(i.prototype,r),n}();i.default=f;t.exports=i.default},{"./pool":331}],331:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var r=function(){function t(n,t){this._fn=n;this._idx=t-1;this._frees=new Array(t);for(var i=0;i<t;++i)this._frees[i]=n()}var n=t.prototype;return n._expand=function(n){var f=this._frees,t,i,r,u;for(this._frees=new Array(n),t=n-f.length,i=0;i<t;++i)this._frees[i]=this._fn();for(r=t,u=0;r<n;++r,++u)this._frees[r]=f[u];this._idx+=t},n.alloc=function(){this._idx<0&&this._expand(Math.round(1.2*this._frees.length)+1);var n=this._frees[this._idx];return this._frees[this._idx]=null,--this._idx,n},n.free=function(n){++this._idx;this._frees[this._idx]=n},n.clear=function(n){for(var t=0;t<=this._idx;t++)n&&n(this._frees[t]);this._frees.length=0;this._idx=-1},t}();i.default=r;t.exports=i.default},{}],332:[function(n,t,i){"use strict";function e(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}var r,f,u;i.__esModule=!0;i.default=void 0;f=(r=n("./timsort"))&&r.__esModule?r:{"default":r};u=function(){function t(n,t){this._fn=n;this._count=0;this._data=new Array(t);for(var i=0;i<t;++i)this._data[i]=n()}var i,r,n=t.prototype;return n.reset=function(){this._count=0},n.resize=function(n){if(n>this._data.length)for(var t=this._data.length;t<n;++t)this._data[t]=this._fn()},n.add=function(){return this._count>=this._data.length&&this.resize(2*this._data.length),this._data[this._count++]},n.remove=function(n){if(!(n>=this._count)){var t=this._count-1,i=this._data[n];this._data[n]=this._data[t];this._data[t]=i;this._count-=1}},n.sort=function(n){return f.default(this._data,0,this._count,n)},i=t,(r=[{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}])&&e(i.prototype,r),t}();i.default=u;cc.RecyclePool=u;t.exports=i.default},{"./timsort":333}],333:[function(n,t,i){"use strict";function h(n){return n<1e5?n<100?n<10?0:1:n<1e4?n<1e3?2:3:4:n<1e7?n<1e6?5:6:n<1e9?n<1e8?7:8:9}function v(n,t){var f,e;if(n===t)return 0;if(~~n===n&&~~t===t){if(0===n||0===t)return n<t?-1:1;if(n<0||t<0){if(t>=0)return-1;if(n>=0)return 1;n=-n;t=-t}var i=h(n),r=h(t),u=0;return i<r?(n*=s[r-i-1],t/=10,u=-1):i>r&&(t*=s[i-r-1],n/=10,u=1),n===t?u:n<t?-1:1}return f=String(n),e=String(t),f===e?0:f<e?-1:1}function y(n){for(var t=0;n>=e;)t|=1&n,n>>=1;return n+t}function c(n,t,i,r){var u=t+1;if(u===i)return 1;if(r(n[u++],n[t])<0){for(;u<i&&r(n[u],n[u-1])<0;)u++;p(n,t,u)}else for(;u<i&&r(n[u],n[u-1])>=0;)u++;return u-t}function p(n,t,i){for(i--;t<i;){var r=n[t];n[t++]=n[i];n[i--]=r}}function l(n,t,i,r,u){var o,e;for(r===t&&r++;r<i;r++){for(var h=n[r],f=t,s=r;f<s;)o=f+s>>>1,u(h,n[o])<0?s=o:f=o+1;e=r-f;switch(e){case 3:n[f+3]=n[f+2];case 2:n[f+2]=n[f+1];case 1:n[f+1]=n[f];break;default:for(;e>0;)n[f+e]=n[f+e-1],e--}n[f]=h}}function u(n,t,i,r,u,f){var o=0,s=0,e=1,c,h;if(f(n,t[i+u])>0){for(s=r-u;e<s&&f(n,t[i+u+e])>0;)o=e,(e=1+(e<<1))<=0&&(e=s);e>s&&(e=s);o+=u;e+=u}else{for(s=u+1;e<s&&f(n,t[i+u-e])<=0;)o=e,(e=1+(e<<1))<=0&&(e=s);e>s&&(e=s);c=o;o=u-e;e=u-c}for(o++;o<e;)h=o+(e-o>>>1),f(n,t[i+h])>0?o=h+1:e=h;return e}function f(n,t,i,r,u,f){var o=0,s=0,e=1,c,h;if(f(n,t[i+u])<0){for(s=u+1;e<s&&f(n,t[i+u-e])<0;)o=e,(e=1+(e<<1))<=0&&(e=s);e>s&&(e=s);c=o;o=u-e;e=u-c}else{for(s=r-u;e<s&&f(n,t[i+u+e])>=0;)o=e,(e=1+(e<<1))<=0&&(e=s);e>s&&(e=s);o+=u;e+=u}for(o++;o<e;)h=o+(e-o>>>1),f(n,t[i+h])<0?e=h:o=h+1;return e}var a;i.__esModule=!0;i.default=function(n,t,i,r){var f,u,s,h,o;if(!Array.isArray(n))throw new TypeError("Can only sort arrays");if(void 0===t&&(t=0),void 0===i&&(i=n.length),void 0===r&&(r=v),f=i-t,!(f<2)){if(u=0,f<e)return void l(n,t,i,t+(u=c(n,t,i,r)),r);s=new a(n,r);h=y(f);do(u=c(n,t,i,r))<h&&(o=f,o>h&&(o=h),l(n,t,t+o,t+u,r),u=o),s.pushRun(t,u),s.mergeRuns(),f-=u,t+=u;while(0!==f);s.forceMergeRuns()}};var e=32,r=7,o=256,s=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];a=function(){function t(n,t){this.array=n;this.compare=t;this.minGallop=r;this.length=n.length;this.tmpStorageLength=o;this.length<2*o&&(this.tmpStorageLength=this.length>>>1);this.tmp=new Array(this.tmpStorageLength);this.stackLength=this.length<120?5:this.length<1542?10:this.length<119151?19:40;this.runStart=new Array(this.stackLength);this.runLength=new Array(this.stackLength);this.stackSize=0}var n=t.prototype;return n.pushRun=function(n,t){this.runStart[this.stackSize]=n;this.runLength[this.stackSize]=t;this.stackSize+=1},n.mergeRuns=function(){for(;this.stackSize>1;){var n=this.stackSize-2;if(n>=1&&this.runLength[n-1]<=this.runLength[n]+this.runLength[n+1]||n>=2&&this.runLength[n-2]<=this.runLength[n]+this.runLength[n-1])this.runLength[n-1]<this.runLength[n+1]&&n--;else if(this.runLength[n]>this.runLength[n+1])break;this.mergeAt(n)}},n.forceMergeRuns=function(){for(;this.stackSize>1;){var n=this.stackSize-2;n>0&&this.runLength[n-1]<this.runLength[n+1]&&n--;this.mergeAt(n)}},n.mergeAt=function(n){var h=this.compare,e=this.array,r=this.runStart[n],t=this.runLength[n],o=this.runStart[n+1],i=this.runLength[n+1],s;this.runLength[n]=t+i;n===this.stackSize-3&&(this.runStart[n+1]=this.runStart[n+2],this.runLength[n+1]=this.runLength[n+2]);this.stackSize--;s=f(e[o],e,r,t,0,h);r+=s;0!=(t-=s)&&0!==(i=u(e[r+t-1],e,o,i,i-1,h))&&(t<=i?this.mergeLow(r,t,o,i):this.mergeHigh(r,t,o,i))},n.mergeLow=function(n,t,i,e){for(var b=this.compare,s=this.array,c=this.tmp,o=0,p,o=0;o<t;o++)c[o]=s[n+o];var l=0,a=i,h=n;if(s[h++]=s[a++],0!=--e)if(1!==t){for(p=this.minGallop;;){var v=0,y=0,w=!1;do if(b(s[a],c[l])<0){if(s[h++]=s[a++],y++,v=0,0==--e){w=!0;break}}else if(s[h++]=c[l++],v++,y=0,1==--t){w=!0;break}while((v|y)<p);if(w)break;do{if(0!==(v=f(s[a],c,l,t,0,b))){for(o=0;o<v;o++)s[h+o]=c[l+o];if(h+=v,l+=v,(t-=v)<=1){w=!0;break}}if(s[h++]=s[a++],0==--e){w=!0;break}if(0!==(y=u(c[l],s,a,e,0,b))){for(o=0;o<y;o++)s[h+o]=s[a+o];if(h+=y,a+=y,0==(e-=y)){w=!0;break}}if(s[h++]=c[l++],1==--t){w=!0;break}p--}while(v>=r||y>=r);if(w)break;p<0&&(p=0);p+=2}if(this.minGallop=p,p<1&&(this.minGallop=1),1===t){for(o=0;o<e;o++)s[h+o]=s[a+o];s[h+e]=c[l]}else{if(0===t)throw new Error("mergeLow preconditions were not respected");for(o=0;o<t;o++)s[h+o]=c[l+o]}}else{for(o=0;o<e;o++)s[h+o]=s[a+o];s[h+e]=c[l]}else for(o=0;o<t;o++)s[h+o]=c[l+o]},n.mergeHigh=function(n,t,i,e){for(var d=this.compare,s=this.array,l=this.tmp,o=0,w,o=0;o<e;o++)l[o]=s[i+o];var y=n+t-1,k=e-1,h=i+e-1,c=0,p=0;if(s[h--]=s[y--],0!=--t)if(1!==e){for(w=this.minGallop;;){var a=0,v=0,b=!1;do if(d(l[k],s[y])<0){if(s[h--]=s[y--],a++,v=0,0==--t){b=!0;break}}else if(s[h--]=l[k--],v++,a=0,1==--e){b=!0;break}while((a|v)<w);if(b)break;do{if(0!=(a=t-f(l[k],s,n,t,t-1,d))){for(t-=a,p=1+(h-=a),c=1+(y-=a),o=a-1;o>=0;o--)s[p+o]=s[c+o];if(0===t){b=!0;break}}if(s[h--]=l[k--],1==--e){b=!0;break}if(0!=(v=e-u(s[y],l,0,e,e-1,d))){for(e-=v,p=1+(h-=v),c=1+(k-=v),o=0;o<v;o++)s[p+o]=l[c+o];if(e<=1){b=!0;break}}if(s[h--]=s[y--],0==--t){b=!0;break}w--}while(a>=r||v>=r);if(b)break;w<0&&(w=0);w+=2}if(this.minGallop=w,w<1&&(this.minGallop=1),1===e){for(p=1+(h-=t),c=1+(y-=t),o=t-1;o>=0;o--)s[p+o]=s[c+o];s[h]=l[k]}else{if(0===e)throw new Error("mergeHigh preconditions were not respected");for(c=h-(e-1),o=0;o<e;o++)s[c+o]=l[o]}}else{for(p=1+(h-=t),c=1+(y-=t),o=t-1;o>=0;o--)s[p+o]=s[c+o];s[h]=l[k]}else for(c=h-(e-1),o=0;o<e;o++)s[c+o]=l[o]},t}();t.exports=i.default},{}],334:[function(n,t,i){"use strict";function s(n){for(var t=16;t<=268435456;t*=16)if(n<=t)return t;return 0}function e(n){var i,t;return i=(n>65535)<<4,i|=t=((n>>>=i)>255)<<3,i|=t=((n>>>=t)>15)<<2,(i|=t=((n>>>=t)>3)<<1)|(n>>>=t)>>1}function r(n){var t=s(n),i=u[e(t)>>2];return i.length>0?i.pop():new ArrayBuffer(t)}var u,f,o;for(i.__esModule=!0,i.default=void 0,u=Array(8),f=0;f<8;++f)u[f]=[];o={alloc_int8:function(n){var t=new Int8Array(r(n),0,n);return t.length!==n?t.subarray(0,n):t},alloc_uint8:function(n){var t=new Uint8Array(r(n),0,n);return t.length!==n?t.subarray(0,n):t},alloc_int16:function(n){var t=new Int16Array(r(2*n),0,n);return t.length!==n?t.subarray(0,n):t},alloc_uint16:function(n){var t=new Uint16Array(r(2*n),0,n);return t.length!==n?t.subarray(0,n):t},alloc_int32:function(n){var t=new Int32Array(r(4*n),0,n);return t.length!==n?t.subarray(0,n):t},alloc_uint32:function(n){var t=new Uint32Array(r(4*n),0,n);return t.length!==n?t.subarray(0,n):t},alloc_float32:function(n){var t=new Float32Array(r(4*n),0,n);return t.length!==n?t.subarray(0,n):t},alloc_float64:function(n){var t=new Float64Array(r(8*n),0,n);return t.length!==n?t.subarray(0,n):t},alloc_dataview:function(n){var t=new DataView(r(n),0,n);return t.length!==n?t.subarray(0,n):t},free:function(n){var t;t=n.buffer;u[e(t.byteLength)>>2].push(t)},reset:function(){for(var t=Array(8),n=0;n<8;++n)t[n]=[]}};i.default=o;t.exports=i.default},{}],335:[function(n,t,i){"use strict";i.__esModule=!0;i.default=function(n,t){for(var u,f=n.length,i=t^f,r=0;f>=4;)u=1540483477*(65535&(u=255&n.charCodeAt(r)|(255&n.charCodeAt(++r))<<8|(255&n.charCodeAt(++r))<<16|(255&n.charCodeAt(++r))<<24))+((1540483477*(u>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++r;switch(f){case 3:i^=(255&n.charCodeAt(r+2))<<16;case 2:i^=(255&n.charCodeAt(r+1))<<8;case 1:i=1540483477*(65535&(i^=255&n.charCodeAt(r)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0};t.exports=i.default},{}],336:[function(n,t,i){"use strict";function c(n){return n&&n.__esModule?n:{"default":n}}function o(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function k(n,t){return n._priority-t._priority}var d;i.__esModule=!0;i.default=void 0;var r=n("../../core/value-types"),g=c(n("../core/base-renderer")),h=c(n("../enums")),nt=n("../memop");var l=new Float32Array(16),a=new Float32Array(16),v=new Float32Array(16),s=new Float32Array(16),y=new Float32Array(4),p=new Float32Array(64),w=[],tt=new Float32Array(4),u=new r.Vec4(0,0,0,0),b=new r.Vec3(0,0,0),e=new r.Vec3(0,0,0),f=new nt.RecyclePool(function(){return new Float32Array(16)},8);d=function(n){function d(t,i){var r;return(r=n.call(this,t,i)||this)._time=new Float32Array(4),r._lights=[],r._shadowLights=[],r._numLights=0,r._defines={},r._registerStage("shadowcast",r._shadowStage.bind(o(r))),r._registerStage("opaque",r._opaqueStage.bind(o(r))),r._registerStage("transparent",r._transparentStage.bind(o(r))),r}var i,c,t;return c=n,(i=d).prototype=Object.create(c.prototype),i.prototype.constructor=i,i.__proto__=c,t=d.prototype,t.reset=function(){f.reset();n.prototype.reset.call(this)},t.render=function(n,t){var u,i,r,f;for(this.reset(),t&&(this._time[0]+=t,this._time[1]=t,this._time[2]++),this._device.setUniform("cc_time",this._time),this._updateLights(n),u=this._device._gl.canvas,i=0;i<n._cameras.length;++i){var e=this._requestView(),o=u.width,s=u.height;n._cameras.data[i].extractView(e,o,s)}for(this._viewPools.sort(k),r=0;r<this._viewPools.length;++r)f=this._viewPools.data[r],this._render(f,n)},t.renderCamera=function(n,t){var i,u;this.reset();this._updateLights(t);var r=this._device._gl.canvas,f=r.width,e=r.height,o=this._requestView();for(n.extractView(o,f,e),this._viewPools.sort(k),i=0;i<this._viewPools.length;++i)u=this._viewPools.data[i],this._render(u,t)},t._updateLights=function(n){var i,r,t,u;for(this._lights.length=0,this._shadowLights.length=0,i=n._lights,r=0;r<i.length;++r)t=i.data[r],(t.update(this._device),t.shadowType!==h.default.SHADOW_NONE)?(this._shadowLights.length<2&&this._shadowLights.splice(0,0,t),u=this._requestView(),t.extractView(u,["shadowcast"]),this._lights.splice(0,0,t)):this._lights.push(t);this._updateLightDefines();this._numLights=i._count},t._updateLightDefines=function(){for(var i,n=this._defines,t=0;t<this._lights.length;++t){var r=this._lights[t],u="CC_LIGHT_"+t+"_TYPE",f="CC_SHADOW_"+t+"_TYPE";n[u]!==r._type&&(n[u]=r._type,this._definesChanged=!0);n[f]!==r._shadowType&&(n[f]=r._shadowType,this._definesChanged=!0)}i=Math.min(4,this._lights.length);n.CC_NUM_LIGHTS!==i&&(n.CC_NUM_LIGHTS=i,this._definesChanged=!0);i=Math.min(4,this._shadowLights.length);n.CC_NUM_SHADOW_LIGHTS!==i&&(n.CC_NUM_SHADOW_LIGHTS=i,this._definesChanged=!0)},t._submitLightsUniforms=function(){var e=this._device,t,n;if(this._lights.length>0){for(var o=f.add(),i=f.add(),r=f.add(),s=Math.min(4,this._lights.length),u=0;u<s;++u)t=this._lights[u],n=4*u,r.set(t._colorUniform,n),i.set(t._directionUniform,n),o.set(t._positionUniform,n),o[n+3]=t._range,t._type===h.default.LIGHT_SPOT?(i[n+3]=t._spotUniform[0],r[n+3]=t._spotUniform[1]):(i[n+3]=0,r[n+3]=0);e.setUniform("cc_lightDirection",i);e.setUniform("cc_lightColor",r);e.setUniform("cc_lightPositionAndRange",o)}},t._submitShadowStageUniforms=function(n){var t=n._shadowLight,i=tt;i[0]=t.shadowMinDepth;i[1]=t.shadowMaxDepth;i[2]=t.shadowDepthScale;i[3]=t.shadowDarkness;this._device.setUniform("cc_shadow_map_lightViewProjMatrix",r.Mat4.toArray(s,n._matViewProj));this._device.setUniform("cc_shadow_map_info",i);this._device.setUniform("cc_shadow_map_bias",t.shadowBias);this._defines.CC_SHADOW_TYPE=t._shadowType},t._submitOtherStagesUniforms=function(){for(var i,e,u,t=f.add(),n=0;n<this._shadowLights.length;++n)i=this._shadowLights[n],e=w[n],e||(e=w[n]=new Float32Array(p.buffer,64*n,16)),r.Mat4.toArray(e,i.viewProjMatrix),u=4*n,t[u]=i.shadowMinDepth,t[u+1]=i.shadowMaxDepth,t[u+2]=i._shadowResolution,t[u+3]=i.shadowDarkness;this._device.setUniform("cc_shadow_lightViewProjMatrix",p);this._device.setUniform("cc_shadow_info",t)},t._sortItems=function(n){n.sort(function(n,t){return n.passes.length!==t.passes.length?n.passes.length-t.passes.length:n.sortKey-t.sortKey})},t._shadowStage=function(n,t){var i,r;for(this._submitShadowStageUniforms(n),i=0;i<t.length;++i)r=t.data[i],r.effect.getDefine("CC_CASTING_SHADOW")&&this._draw(r)},t._drawItems=function(n,t){var f=this._shadowLights,r,e,u,o,i;if(0===f.length&&0===this._numLights)for(r=0;r<t.length;++r)e=t.data[r],this._draw(e);else for(u=0;u<t.length;++u){for(o=t.data[u],i=0;i<f.length;++i)this._device.setTexture("cc_shadow_map_"+i,f[i].shadowMap,this._allocTextureUnit());this._draw(o)}},t._opaqueStage=function(n,t){n.getPosition(u);this._device.setUniform("cc_matView",r.Mat4.toArray(l,n._matView));this._device.setUniform("cc_matViewInv",r.Mat4.toArray(a,n._matViewInv));this._device.setUniform("cc_matProj",r.Mat4.toArray(v,n._matProj));this._device.setUniform("cc_matViewProj",r.Mat4.toArray(s,n._matViewProj));this._device.setUniform("cc_cameraPos",r.Vec4.toArray(y,u));this._submitLightsUniforms();this._submitOtherStagesUniforms();this._drawItems(n,t)},t._transparentStage=function(n,t){var i,f;for(n.getPosition(u),n.getForward(b),this._device.setUniform("cc_matView",r.Mat4.toArray(l,n._matView)),this._device.setUniform("cc_matViewInv",r.Mat4.toArray(a,n._matViewInv)),this._device.setUniform("cc_matProj",r.Mat4.toArray(v,n._matProj)),this._device.setUniform("cc_matViewProj",r.Mat4.toArray(s,n._matViewProj)),this._device.setUniform("cc_cameraPos",r.Vec4.toArray(y,u)),this._submitLightsUniforms(),this._submitOtherStagesUniforms(),i=0;i<t.length;++i)f=t.data[i],f.node.getWorldPosition(e),r.Vec3.sub(e,e,u),f.sortKey=-r.Vec3.dot(e,b);this._sortItems(t);this._drawItems(n,t)},d}(g.default);i.default=d;t.exports=i.default},{"../../core/value-types":284,"../core/base-renderer":306,"../enums":312,"../memop":329}],337:[function(n,t,i){"use strict";function p(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}i.__esModule=!0;i.default=void 0;var h,r=n("../../core/value-types"),y=n("../../core/geom-utils"),f=(h=n("../enums"))&&h.__esModule?h:{"default":h};var e=new r.Mat4,a=new r.Mat4,v=new r.Mat4,c=new r.Mat4,s=new r.Mat4,o=new r.Mat4,u=new r.Vec3,l=new r.Vec3,w=function(){function t(){this._poolID=-1;this._node=null;this._projection=f.default.PROJ_PERSPECTIVE;this._priority=0;this._color=new r.Vec4(.2,.3,.47,1);this._depth=1;this._stencil=0;this._clearFlags=f.default.CLEAR_COLOR|f.default.CLEAR_DEPTH;this._clearModel=null;this._stages=[];this._framebuffer=null;this._near=.01;this._far=1e3;this._fov=Math.PI/4;this._rect={x:0,y:0,w:1,h:1};this._orthoHeight=10;this._cullingMask=4294967295}var i,h,n=t.prototype;return n.setCullingMask=function(n){this._cullingMask=n},n.getNode=function(){return this._node},n.setNode=function(n){this._node=n},n.getType=function(){return this._projection},n.setType=function(n){this._projection=n},n.getPriority=function(){return this._priority},n.setPriority=function(n){this._priority=n},n.getOrthoHeight=function(){return this._orthoHeight},n.setOrthoHeight=function(n){this._orthoHeight=n},n.getFov=function(){return this._fov},n.setFov=function(n){this._fov=n},n.getNear=function(){return this._near},n.setNear=function(n){this._near=n},n.getFar=function(){return this._far},n.setFar=function(n){this._far=n},n.getColor=function(n){return r.Vec4.copy(n,this._color)},n.setColor=function(n,t,i,u){r.Vec4.set(this._color,n,t,i,u)},n.getDepth=function(){return this._depth},n.setDepth=function(n){this._depth=n},n.getStencil=function(){return this._stencil},n.setStencil=function(n){this._stencil=n},n.getClearFlags=function(){return this._clearFlags},n.setClearFlags=function(n){this._clearFlags=n},n.getRect=function(n){return n.x=this._rect.x,n.y=this._rect.y,n.w=this._rect.w,n.h=this._rect.h,n},n.setRect=function(n,t,i,r){this._rect.x=n;this._rect.y=t;this._rect.w=i;this._rect.h=r},n.getStages=function(){return this._stages},n.setStages=function(n){this._stages=n},n.getFramebuffer=function(){return this._framebuffer},n.setFrameBuffer=function(n){this._framebuffer=n},n._calcMatrices=function(n,t){var i,u,e;this._node.getWorldRT(v);r.Mat4.invert(a,v);i=n/t;this._projection===f.default.PROJ_PERSPECTIVE?r.Mat4.perspective(c,this._fov,i,this._near,this._far):(u=this._orthoHeight*i,e=this._orthoHeight,r.Mat4.ortho(c,-u,u,-e,e,this._near,this._far));r.Mat4.mul(s,c,a);r.Mat4.invert(o,s)},n.extractView=function(n,t,i){this._framebuffer&&(t=this._framebuffer._width,i=this._framebuffer._height);n._priority=this._priority;n._rect.x=this._rect.x*t;n._rect.y=this._rect.y*i;n._rect.w=this._rect.w*t;n._rect.h=this._rect.h*i;this.getColor(n._color);n._depth=this._depth;n._stencil=this._stencil;n._clearFlags=this._clearFlags;n._clearModel=this._clearModel;n._stages=this._stages;n._framebuffer=this._framebuffer;this._calcMatrices(t,i);r.Mat4.copy(n._matView,a);r.Mat4.copy(n._matViewInv,v);r.Mat4.copy(n._matProj,c);r.Mat4.copy(n._matViewProj,s);r.Mat4.copy(n._matInvViewProj,o);n._cullingMask=this._cullingMask},n.screenPointToRay=function(n,t,i,e,s){if(!cc.geomUtils)return s;s=s||new y.Ray;this._calcMatrices(i,e);var h=this._rect.x*i,c=this._rect.y*e,a=this._rect.w*i,v=this._rect.h*e;return r.Vec3.set(l,(n-h)/a*2-1,(t-c)/v*2-1,1),r.Vec3.transformMat4(l,l,o),this._projection===f.default.PROJ_PERSPECTIVE?this._node.getWorldPosition(u):(r.Vec3.set(u,(n-h)/a*2-1,(t-c)/v*2-1,-1),r.Vec3.transformMat4(u,u,o)),y.Ray.fromPoints(s,u,l)},n.screenToWorld=function(n,t,i,e){this._calcMatrices(i,e);var s=this._rect.x*i,h=this._rect.y*e,c=this._rect.w*i,l=this._rect.h*e;return this._projection===f.default.PROJ_PERSPECTIVE?(r.Vec3.set(n,(t.x-s)/c*2-1,(t.y-h)/l*2-1,.9999),r.Vec3.transformMat4(n,n,o),this._node.getWorldPosition(u),r.Vec3.lerp(n,u,n,r.lerp(this._near/this._far,1,t.z))):(r.Vec3.set(n,(t.x-s)/c*2-1,(t.y-h)/l*2-1,2*t.z-1),r.Vec3.transformMat4(n,n,o)),n},n.worldToScreen=function(n,t,i,u){this._calcMatrices(i,u);var f=this._rect.x*i,e=this._rect.y*u,o=this._rect.w*i,h=this._rect.h*u;return r.Vec3.transformMat4(n,t,s),n.x=f+.5*(n.x+1)*o,n.y=e+.5*(n.y+1)*h,n.z=.5*n.z+.5,n},n.worldMatrixToScreen=function(n,t,i,f){this._calcMatrices(i,f);r.Mat4.mul(n,s,t);var o=i/2,h=f/2;return r.Mat4.identity(e),r.Mat4.transform(e,e,r.Vec3.set(u,o,h,0)),r.Mat4.scale(e,e,r.Vec3.set(u,o,h,1)),r.Mat4.mul(n,e,n),n},i=t,(h=[{key:"cullingMask",get:function(){return this._cullingMask},set:function(n){this._cullingMask=n}}])&&p(i.prototype,h),t}();i.default=w;t.exports=i.default},{"../../core/geom-utils":150,"../../core/value-types":284,"../enums":312}],338:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var r=function(){function t(){this._type="default";this._poolID=-1;this._node=null;this._inputAssembler=null;this._effect=null;this._viewID=-1;this._cameraID=-1;this._userKey=-1;this._castShadow=!1;this._boundingShape=null}var n=t.prototype;return n.setNode=function(n){this._node=n},n.setInputAssembler=function(n){this._inputAssembler=n},n.setEffect=function(n){this._effect=n},n.setUserKey=function(n){this._userKey=n},n.extractDrawItem=function(n){n.model=this;n.node=this._node;n.ia=this._inputAssembler;n.effect=this._effect},t}();i.default=r;t.exports=i.default},{}],339:[function(n,t,i){"use strict";i.__esModule=!0;i.default=void 0;var r=n("../memop"),u=function(){function t(n){this._lights=new r.FixedArray(16);this._models=new r.FixedArray(16);this._cameras=new r.FixedArray(16);this._debugCamera=null;this._app=n;this._views=[]}var n=t.prototype;return n._add=function(n,t){-1===t._poolID&&(n.push(t),t._poolID=n.length-1)},n._remove=function(n,t){-1!==t._poolID&&(n.data[n.length-1]._poolID=t._poolID,n.fastRemove(t._poolID),t._poolID=-1)},n.reset=function(){for(var n=0;n<this._models.length;++n)this._models.data[n]._viewID=-1},n.setDebugCamera=function(n){this._debugCamera=n},n.getCameraCount=function(){return this._cameras.length},n.getCamera=function(n){return this._cameras.data[n]},n.addCamera=function(n){this._add(this._cameras,n)},n.removeCamera=function(n){this._remove(this._cameras,n)},n.getModelCount=function(){return this._models.length},n.getModel=function(n){return this._models.data[n]},n.addModel=function(n){this._add(this._models,n)},n.removeModel=function(n){this._remove(this._models,n)},n.getLightCount=function(){return this._lights.length},n.getLight=function(n){return this._lights.data[n]},n.addLight=function(n){this._add(this._lights,n)},n.removeLight=function(n){this._remove(this._lights,n)},n.addView=function(n){-1===this._views.indexOf(n)&&this._views.push(n)},n.removeView=function(n){var t=this._views.indexOf(n);-1!==t&&this._views.splice(t,1)},t}();i.default=u;t.exports=i.default},{"../memop":329}],340:[function(n,t,i){"use strict";function y(n){return n&&n.__esModule?n:{"default":n}}var p,b,h,a,v,k;i.__esModule=!0;i.getInspectorProps=function(n){var t={type:n.type},i;return Object.assign(t,n.editor||n.inspector),t.defines=n.defines,t.value=a(t.type)(n.value),n.range&&(t.range=n.range),i=v(t.type),t.typeName=k[i]||i,t.valueCtor=l[t.type],"cc.Texture2D"==t.typeName&&(t.typeName="cc.Asset",t.assetType="cc.Texture2D"),t};i.getClassName=i.getInstanceCtor=i.getInstanceType=i.enums2default=i.ctor2enums=void 0;var o,f,s,e,r=y(n("./enums")),u=n("../core/value-types"),c=y(n("../core/assets/CCTexture2D"));p=n("./gfx/texture-2d");var w=cc.Object,d=((o={})[Boolean]=function(n){return n||!1},o[Number]=function(n){return n?ArrayBuffer.isView(n)?n[0]:n:0},o[u.Vec2]=function(n){return n?cc.v2(n[0],n[1]):cc.v2()},o[u.Vec3]=function(n){return n?cc.v3(n[0],n[1],n[2]):cc.v3()},o[u.Vec4]=function(n){return n?cc.v4(n[0],n[1],n[2],n[3]):cc.v4()},o[u.Color]=function(n){return n?cc.color(255*n[0],255*n[1],255*n[2],255*(n[3]||1)):cc.color()},o[u.Mat4]=function(n){return n?cc.mat4(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]):cc.mat4()},o[c.default]=function(){return null},o[w]=function(){return null},o),l=((f={})[r.default.PARAM_INT]=Number,f[r.default.PARAM_INT2]=u.Vec2,f[r.default.PARAM_INT3]=u.Vec3,f[r.default.PARAM_INT4]=u.Vec4,f[r.default.PARAM_FLOAT]=Number,f[r.default.PARAM_FLOAT2]=u.Vec2,f[r.default.PARAM_FLOAT3]=u.Vec3,f[r.default.PARAM_FLOAT4]=u.Vec4,f[r.default.PARAM_MAT4]=u.Mat4,f[r.default.PARAM_TEXTURE_2D]=c.default,f.color=u.Color,f.number=Number,f.boolean=Boolean,f.default=w,f),g=((s={})[Number]=r.default.PARAM_FLOAT,s[u.Vec2]=r.default.PARAM_FLOAT2,s[u.Vec3]=r.default.PARAM_FLOAT3,s[u.Vec4]=r.default.PARAM_FLOAT4,s[u.Color]=r.default.PARAM_COLOR3,s[u.Color]=r.default.PARAM_COLOR4,s[u.Mat4]=r.default.PARAM_MAT4,s[c.default]=r.default.PARAM_TEXTURE_2D,s[p]=r.default.PARAM_TEXTURE_2D,s);i.ctor2enums=g;b=((e={})[r.default.PARAM_INT]=new Uint32Array([0]),e[r.default.PARAM_INT2]=new Uint32Array([0,0]),e[r.default.PARAM_INT3]=new Uint32Array([0,0,0]),e[r.default.PARAM_INT4]=new Uint32Array([0,0,0,0]),e[r.default.PARAM_FLOAT]=new Float32Array([0]),e[r.default.PARAM_FLOAT2]=new Float32Array([0,0]),e[r.default.PARAM_FLOAT3]=new Float32Array([0,0,0]),e[r.default.PARAM_FLOAT4]=new Float32Array([0,0,0,0]),e[r.default.PARAM_MAT4]=cc.mat4().m,e[r.default.PARAM_TEXTURE_2D]=null,e.number=0,e.boolean=!1,e);i.enums2default=b;h=function(n){return l[n]||l.default};i.getInstanceType=h;a=function(n){return d[h(n)]};i.getInstanceCtor=a;v=function(n){return cc.js.getClassName(h(n))};i.getClassName=v;k={Number:"number",Boolean:"boolean"}},{"../core/assets/CCTexture2D":77,"../core/value-types":284,"./enums":312,"./gfx/texture-2d":322}],341:[function(n,t){"use strict";var i=cc.Class({name:"cc.TiledMapAsset","extends":cc.Asset,properties:{tmxXmlStr:"",textures:{"default":[],type:[cc.Texture2D]},textureNames:[cc.String],textureSizes:{"default":[],type:[cc.Size]},imageLayerTextures:{"default":[],type:[cc.Texture2D]},imageLayerTextureNames:[cc.String],tsxFiles:[cc.TextAsset],tsxFileNames:[cc.String]},statics:{preventDeferredLoadDependents:!0},createNode:!1});cc.TiledMapAsset=i;t.exports=i},{}],342:[function(n,t){"use strict";function r(){}var f=n("./webview-impl"),i=f.EventType,u=cc.Class({name:"cc.WebView","extends":cc.Component,editor:!1,properties:{_url:"",url:{type:cc.String,tooltip:!1,get:function(){return this._url},set:function(n){this._url=n;var t=this._impl;t&&t.loadURL(n)}},webviewEvents:{"default":[],type:cc.Component.EventHandler}},statics:{EventType:i,Impl:f},ctor:function(){this._impl=new u.Impl},onRestore:function(){this._impl||(this._impl=new u.Impl)},onEnable:function(){var n=this._impl;n.createDomElementIfNeeded(this.node.width,this.node.height);n.setEventListener(i.LOADED,this._onWebViewLoaded.bind(this));n.setEventListener(i.LOADING,this._onWebViewLoading.bind(this));n.setEventListener(i.ERROR,this._onWebViewLoadError.bind(this));n.loadURL(this._url);n.setVisible(!0)},onDisable:function(){var n=this._impl;n.setVisible(!1);n.setEventListener(i.LOADED,r);n.setEventListener(i.LOADING,r);n.setEventListener(i.ERROR,r)},onDestroy:function(){this._impl&&(this._impl.destroy(),this._impl=null)},update:function(){this._impl&&this._impl.updateMatrix(this.node)},_onWebViewLoaded:function(){cc.Component.EventHandler.emitEvents(this.webviewEvents,this,i.LOADED);this.node.emit("loaded",this)},_onWebViewLoading:function(){return cc.Component.EventHandler.emitEvents(this.webviewEvents,this,i.LOADING),this.node.emit("loading",this),!0},_onWebViewLoadError:function(){cc.Component.EventHandler.emitEvents(this.webviewEvents,this,i.ERROR);this.node.emit("error",this)},setJavascriptInterfaceScheme:function(n){this._impl&&this._impl.setJavascriptInterfaceScheme(n)},setOnJSCallback:function(n){this._impl&&this._impl.setOnJSCallback(n)},evaluateJS:function(n){this._impl&&this._impl.evaluateJS(n)}});cc.WebView=t.exports=u},{"./webview-impl":343}],343:[function(n,t){"use strict";var e=n("../core/platform/utils"),r=n("../core/platform/CCSys"),u=cc.mat4(),i=cc.Class({name:"WebViewImpl",ctor:function(){this._EventList={};this._visible=!1;this._parent=null;this._div=null;this._iframe=null;this._listener=null;this._forceUpdate=!1;this._m00=0;this._m01=0;this._m04=0;this._m05=0;this._m12=0;this._m13=0;this._w=0;this._h=0;this.__eventListeners={}},_updateVisibility:function(){if(this._div){var n=this._div;n.style.visibility=this._visible?"visible":"hidden"}},_updateSize:function(n,t){var i=this._div;i&&(i.style.width=n+"px",i.style.height=t+"px")},_initEvent:function(){var r=this._iframe,n,t;r&&(n=this.__eventListeners,t=this,n.load=function(){t._forceUpdate=!0;t._dispatchEvent(i.EventType.LOADED)},n.error=function(){t._dispatchEvent(i.EventType.ERROR)},r.addEventListener("load",n.load),r.addEventListener("error",n.error))},_initStyle:function(){if(this._div){var n=this._div;n.style.position="absolute";n.style.bottom="0px";n.style.left="0px"}},_setOpacity:function(n){var t=this._iframe;t&&t.style&&(t.style.opacity=n/255)},_createDom:function(n,t){i._polyfill.enableDiv?(this._div=document.createElement("div"),this._div.style["-webkit-overflow"]="auto",this._div.style["-webkit-overflow-scrolling"]="touch",this._iframe=document.createElement("iframe"),this._div.appendChild(this._iframe),this._iframe.style.width="100%",this._iframe.style.height="100%"):this._div=this._iframe=document.createElement("iframe");i._polyfill.enableBG&&(this._div.style.background="#FFF");this._div.style.height=t+"px";this._div.style.width=n+"px";this._div.style.overflow="scroll";this._iframe.style.border="none";cc.game.container.appendChild(this._div);this._updateVisibility()},_createNativeControl:function(n,t){this._createDom(n,t);this._initStyle();this._initEvent()},createDomElementIfNeeded:function(n,t){this._div?this._updateSize(n,t):this._createNativeControl(n,t)},removeDom:function(){var i=this._div,t,n;i&&(e.contains(cc.game.container,i)&&cc.game.container.removeChild(i),this._div=null);t=this._iframe;t&&(n=this.__eventListeners,t.removeEventListener("load",n.load),t.removeEventListener("error",n.error),n.load=null,n.error=null,this._iframe=null)},setOnJSCallback:function(){},setJavascriptInterfaceScheme:function(){},loadData:function(){},loadHTMLString:function(){},loadURL:function(n){var t=this._iframe,r;t&&(t.src=n,r=this,t.addEventListener("load",function n(){r._loaded=!0;r._updateVisibility();t.removeEventListener("load",n)}),this._dispatchEvent(i.EventType.LOADING))},stopLoading:function(){cc.logID(7800)},reload:function(){var t=this._iframe,n;t&&(n=t.contentWindow,n&&n.location&&n.location.reload())},canGoBack:function(){return cc.logID(7801),!0},canGoForward:function(){return cc.logID(7802),!0},goBack:function(){var t,n;try{if(i._polyfill.closeHistory)return cc.logID(7803);t=this._iframe;t&&(n=t.contentWindow,n&&n.location&&n.history.back.call(n))}catch(r){r={};cc.log(r)}},goForward:function(){var t,n;try{if(i._polyfill.closeHistory)return cc.logID(7804);t=this._iframe;t&&(n=t.contentWindow,n&&n.location&&n.history.forward.call(n))}catch(r){r={};cc.log(r)}},evaluateJS:function(n){var r=this._iframe,u;if(r){u=r.contentWindow;try{u.eval(n);this._dispatchEvent(i.EventType.JS_EVALUATED)}catch(t){t={};console.error(t)}}},setScalesPageToFit:function(){cc.logID(7805)},setEventListener:function(n,t){this._EventList[n]=t},removeEventListener:function(n){this._EventList[n]=null},_dispatchEvent:function(n){var t=this._EventList[n];t&&t.call(this,this,this._iframe.src)},_createRenderCmd:function(){return new i.RenderCmd(this)},destroy:function(){this.removeDom()},setVisible:function(n){this._visible!==n&&(this._visible=!!n,this._updateVisibility())},updateMatrix:function(n){var r,t;if(this._div&&this._visible&&(n.getWorldMatrix(u),r=cc.Camera._findRendererCamera(n),r&&r.worldMatrixToScreen(u,u,cc.game.canvas.width,cc.game.canvas.height),t=u.m,this._forceUpdate||this._m00!==t[0]||this._m01!==t[1]||this._m04!==t[4]||this._m05!==t[5]||this._m12!==t[12]||this._m13!==t[13]||this._w!==n._contentSize.width||this._h!==n._contentSize.height)){this._m00=t[0];this._m01=t[1];this._m04=t[4];this._m05=t[5];this._m12=t[12];this._m13=t[13];this._w=n._contentSize.width;this._h=n._contentSize.height;var o=cc.view._devicePixelRatio,f=1/o,e=1/o,i=cc.game.container,h=t[0]*f,c=t[1],l=t[4],a=t[5]*e,v=i&&i.style.paddingLeft?parseInt(i.style.paddingLeft):0,y=i&&i.style.paddingBottom?parseInt(i.style.paddingBottom):0;this._updateSize(this._w,this._h);var p=this._w*f,w=this._h*e,b=p*t[0]*n._anchorPoint.x,k=w*t[5]*n._anchorPoint.y,s="matrix("+h+","+-c+","+-l+","+a+","+(t[12]*f-b+v)+","+-(t[13]*e-k+y)+")";this._div.style.transform=s;this._div.style["-webkit-transform"]=s;this._div.style["transform-origin"]="0px 100% 0px";this._div.style["-webkit-transform-origin"]="0px 100% 0px";this._setOpacity(n.opacity);this._forceUpdate=!1}}}),f;i.EventType={LOADING:0,LOADED:1,ERROR:2,JS_EVALUATED:3};f=i._polyfill={devicePixelRatio:!1,enableDiv:!1};r.os===r.OS_IOS&&(f.enableDiv=!0);r.isMobile?r.browserType===r.BROWSER_TYPE_FIREFOX&&(f.enableBG=!0):r.browserType===r.BROWSER_TYPE_IE&&(f.closeHistory=!0);t.exports=i},{"../core/platform/CCSys":204,"../core/platform/utils":219}],344:[function(n){"use strict";n("./cocos2d/core");n("./cocos2d/animation");n("./cocos2d/particle");n("./cocos2d/tilemap");n("./cocos2d/videoplayer/CCVideoPlayer");n("./cocos2d/webview/CCWebView");n("./cocos2d/core/components/CCStudioComponent");n("./extensions/ccpool/CCNodePool");n("./cocos2d/actions");n("./extensions/spine");n("./extensions/dragonbones");n("./cocos2d/deprecated")},{"./cocos2d/actions":7,"./cocos2d/animation":16,"./cocos2d/core":162,"./cocos2d/core/components/CCStudioComponent":122,"./cocos2d/deprecated":296,"./cocos2d/particle":302,"./cocos2d/particle/CCParticleAsset":299,"./cocos2d/tilemap":void 0,"./cocos2d/tilemap/CCTiledMapAsset":341,"./cocos2d/videoplayer/CCVideoPlayer":void 0,"./cocos2d/webview/CCWebView":342,"./extensions/ccpool/CCNodePool":345,"./extensions/dragonbones":355,"./extensions/spine":360}],345:[function(n,t){"use strict";cc.NodePool=function(n){this.poolHandlerComp=n;this._pool=[]};cc.NodePool.prototype={constructor:cc.NodePool,size:function(){return this._pool.length},clear:function(){for(var t=this._pool.length,n=0;n<t;++n)this._pool[n].destroy();this._pool.length=0},put:function(n){if(n&&-1===this._pool.indexOf(n)){n.removeFromParent(!1);var t=this.poolHandlerComp?n.getComponent(this.poolHandlerComp):null;t&&t.unuse&&t.unuse();this._pool.push(n)}},get:function(){var t=this._pool.length-1,i,n;return t<0?null:(i=this._pool[t],this._pool.length=t,n=this.poolHandlerComp?i.getComponent(this.poolHandlerComp):null,n&&n.reuse&&n.reuse.apply(n,arguments),i)}};t.exports=cc.NodePool},{}],346:[function(n,t){"use strict";var l,a,o=[],w=[],h=0,c=0,i=0,v=null,y=null,r=0,f=0,u=0,e=0,p=null,b=cc.Class({ctor:function(){this._privateMode=!1;this._inited=!1;this._invalid=!0;this._enableCacheAttachedInfo=!1;this.frames=[];this.totalTime=0;this.isCompleted=!1;this._frameIdx=-1;this._armatureInfo=null;this._animationName=null;this._tempSegments=null;this._tempColors=null;this._tempBoneInfos=null},init:function(n,t){this._inited=!0;this._armatureInfo=n;this._animationName=t},clear:function(){this._inited=!1;for(var n=0,t=this.frames.length;n<t;n++)this.frames[n].segments.length=0;this.invalidAllFrame()},begin:function(){if(this._invalid){var t=this._armatureInfo,n=t.curAnimationCache;n&&n!=this&&(this._privateMode?n.invalidAllFrame():n.updateToFrame());t.armature.animation.play(this._animationName,1);t.curAnimationCache=this;this._invalid=!1;this._frameIdx=-1;this.totalTime=0;this.isCompleted=!1}},end:function(){this._needToUpdate()||(this._armatureInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0)},_needToUpdate:function(n){return!this._armatureInfo.armature.animation.isCompleted&&this.totalTime<30&&(null==n||this._frameIdx<n)},updateToFrame:function(n){if(this._inited&&(this.begin(),this._needToUpdate(n))){var t=this._armatureInfo.armature;do t.advanceTime(1/60),this._frameIdx++,this._updateFrame(t,this._frameIdx),this.totalTime+=1/60;while(this._needToUpdate(n));this.end()}},isInited:function(){return this._inited},isInvalid:function(){return this._invalid},invalidAllFrame:function(){this.isCompleted=!1;this._invalid=!0},updateAllFrame:function(){this.invalidAllFrame();this.updateToFrame()},enableCacheAttachedInfo:function(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())},_updateFrame:function(n,t){var it,nt,l,tt,a,b,k,d;i=0;h=0;c=0;v=null;y=null;r=0;f=0;u=0;e=0;p=null;this.frames[t]=this.frames[t]||{segments:[],colors:[],boneInfos:[],vertices:null,uintVert:null,indices:null};var s=this.frames[t],g=this._tempSegments=s.segments,rt=this._tempColors=s.colors,ut=this._tempBoneInfos=s.boneInfos;if(this._traverseArmature(n,1),e>0&&(rt[e-1].vfOffset=i),rt.length=e,ut.length=h,it=u-1,it>=0&&(f>0?(nt=g[it],nt.indexCount=f,nt.vfCount=5*r,nt.vertexCount=r,g.length=u):g.length=u-1),0!==g.length){for(l=s.vertices,tt=s.uintVert,(!l||l.length<i)&&(l=s.vertices=new Float32Array(i),tt=s.uintVert=new Uint32Array(l.buffer)),a=0,b=0;a<i;)l[a++]=o[b++],l[a++]=o[b++],l[a++]=o[b++],l[a++]=o[b++],tt[a++]=o[b++];for(k=s.indices,(!k||k.length<c)&&(k=s.indices=new Uint16Array(c)),d=0;d<c;d++)k[d]=w[d];s.vertices=l;s.uintVert=tt;s.indices=k}},_traverseArmature:function(n,t){var k,tt,s,d,b,it,rt,ht,st,ct=this._tempColors,lt=this._tempSegments,at=this._tempBoneInfos,nt=o,ni=w,vt=n._slots,yt=n._bones,ut,pt,wt,ft,bt,et,kt,g,dt,ot,gt;if(this._enableCacheAttachedInfo)for(ut=0,pt=yt.length;ut<pt;ut++,h++)wt=yt[ut],ft=at[h],ft||(ft=at[h]={globalTransformMatrix:new dragonBones.Matrix}),bt=wt.globalTransformMatrix,ft.globalTransformMatrix.copyFrom(bt);for(et=0,kt=vt.length;et<kt;et++)if((s=vt[et])._visible&&s._displayData)if(s.updateWorldMatrix(),b=s._color,s.childArmature)this._traverseArmature(s.childArmature,t*b.a/255);else if(rt=s.getTexture()){for(v===rt.nativeUrl&&y===s._blendMode||(v=rt.nativeUrl,y=s._blendMode,(ht=u-1)>=0&&(f>0?((st=lt[ht]).indexCount=f,st.vertexCount=r,st.vfCount=5*r):u--),lt[u]={tex:rt,blendMode:s._blendMode,indexCount:0,vertexCount:0,vfCount:0},u++,f=0,r=0),it=(b.a*t<<24>>>0)+(b.b<<16)+(b.g<<8)+b.r,p!==it&&(p=it,e>0&&(ct[e-1].vfOffset=i),ct[e++]={r:b.r,g:b.g,b:b.b,a:b.a*t,vfOffset:0}),k=s._localVertices,tt=s._indices,d=s._worldMatrix.m,g=0,dt=k.length;g<dt;)l=k[g++],a=k[g++],nt[i++]=l*d[0]+a*d[4]+d[12],nt[i++]=l*d[1]+a*d[5]+d[13],nt[i++]=k[g++],nt[i++]=k[g++],nt[i++]=it;for(ot=0,gt=tt.length;ot<gt;ot++)ni[c++]=r+tt[ot];f+=tt.length;r+=k.length/4}}}),s=cc.Class({ctor:function(){this._privateMode=!1;this._animationPool={};this._armatureCache={}},enablePrivateMode:function(){this._privateMode=!0},dispose:function(){var i,n,t;for(i in this._armatureCache)n=this._armatureCache[i],n&&(t=n.armature,t&&t.dispose());this._armatureCache=null;this._animationPool=null},_removeArmature:function(n){var u=this._armatureCache[n],f=u.animationsCache,i,t,r;for(i in f)t=f[i],t&&(this._animationPool[n+"#"+i]=t,t.clear());r=u.armature;r&&r.dispose();delete this._armatureCache[n]},resetArmature:function(n){for(var t in this._armatureCache)-1!=t.indexOf(n)&&this._removeArmature(t)},getArmatureCache:function(n,t,i){var r,f=this._armatureCache[t],u;if(f)r=f.armature;else{if(u=dragonBones.CCFactory.getInstance().buildArmatureDisplay(n,t,"",i),!u||!u._armature)return;if(r=u._armature,!s.canCache(r))return void r.dispose();this._armatureCache[t]={armature:r,animationsCache:{},curAnimationCache:null}}return r},getAnimationCache:function(n,t){var i=this._armatureCache[n];return i?i.animationsCache[t]:null},initAnimationCache:function(n,t){var r,u,f,i,e;return t?(r=this._armatureCache[n],u=r&&r.armature,!u)?null:u.animation.hasAnimation(t)?(f=r.animationsCache,i=f[t],i||(e=n+"#"+t,(i=this._animationPool[e])?delete this._animationPool[e]:(i=new b)._privateMode=this._privateMode,i.init(r,t),f[t]=i),i):null:null},invalidAnimationCache:function(n){var t=this._armatureCache[n],i,r;if(!t||!t.armature)return null;i=t.animationsCache;for(r in i)i[r].invalidAllFrame()},updateAnimationCache:function(n,t){var r,i,u,f;if(t){if(r=this.initAnimationCache(n,t),!r)return;r.updateAllFrame()}else{if(i=this._armatureCache[n],!i||!i.armature)return null;u=i.animationsCache;for(f in u)u[f].updateAllFrame()}}});s.FrameTime=1/60;s.sharedCache=new s;s.canCache=function(n){for(var i=n._slots,t=0,r=i.length;t<r;t++)if(i[t].childArmature)return!1;return!0};t.exports=s},{}],347:[function(n,t){"use strict";var f=n("../../cocos2d/core/components/CCRenderComponent"),e=n("../../cocos2d/core/event/event-target"),o=n("../../cocos2d/core/graphics/graphics"),u=n("../../cocos2d/core/renderer/render-flow").FLAG_POST_RENDER,r=n("./ArmatureCache"),s=n("./AttachUtil"),h=cc.Enum({"default":-1}),c=cc.Enum({"<None>":0}),i=(cc.Enum({REALTIME:0}),cc.Enum({REALTIME:0,SHARED_CACHE:1,PRIVATE_CACHE:2})),l=cc.Class({name:"dragonBones.ArmatureDisplay","extends":f,editor:!1,statics:{AnimationCacheMode:i},properties:{_factory:{"default":null,type:dragonBones.CCFactory,serializable:!1},dragonAsset:{"default":null,type:dragonBones.DragonBonesAsset,notify:function(){this._refresh()},tooltip:!1},dragonAtlasAsset:{"default":null,type:dragonBones.DragonBonesAtlasAsset,notify:function(){this._parseDragonAtlasAsset();this._refresh()},tooltip:!1},_armatureName:"",armatureName:{get:function(){return this._armatureName},set:function(n){this._armatureName=n;var t=this.getAnimationNames(this._armatureName);(!this.animationName||t.indexOf(this.animationName)<0)&&(this.animationName="");this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.remove(this._armature);this._refresh();this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.add(this._armature)},visible:!1},_animationName:"",animationName:{get:function(){return this._animationName},set:function(n){this._animationName=n},visible:!1},_defaultArmatureIndex:{"default":0,notify:function(){var n="",t;if(this.dragonAsset){if(this.dragonAsset&&(t=this.dragonAsset.getArmatureEnum()),!t)return cc.errorID(7400,this.name);n=t[this._defaultArmatureIndex]}void 0!==n?this.armatureName=n:cc.errorID(7401,this.name)},type:h,visible:!0,editorOnly:!0,animatable:!1,displayName:"Armature",tooltip:!1},_animationIndex:{"default":0,notify:function(){var n,t;0!==this._animationIndex?(this.dragonAsset&&(n=this.dragonAsset.getAnimsEnum(this.armatureName)),n)&&(t=n[this._animationIndex],void 0!==t?this.playAnimation(t,this.playTimes):cc.errorID(7402,this.name)):this.animationName=""},type:c,visible:!0,editorOnly:!0,animatable:!1,displayName:"Animation",tooltip:!1},_preCacheMode:-1,_cacheMode:i.REALTIME,_defaultCacheMode:{"default":0,type:i,notify:function(){if(this._defaultCacheMode!==i.REALTIME&&this._armature&&!r.canCache(this._armature))return this._defaultCacheMode=i.REALTIME,void cc.warn("Animation cache mode doesn't support skeletal nesting");this.setAnimationCacheMode(this._defaultCacheMode)},editorOnly:!0,visible:!0,animatable:!1,displayName:"Animation Cache Mode",tooltip:!1},timeScale:{"default":1,notify:function(){this._armature&&!this.isAnimationCached()&&(this._armature.animation.timeScale=this.timeScale)},tooltip:!1},playTimes:{"default":-1,tooltip:!1},premultipliedAlpha:{"default":!1,tooltip:!1},debugBones:{"default":!1,notify:function(){this._updateDebugDraw()},tooltip:!1},enableBatch:{"default":!1,notify:function(){this._updateBatch()},tooltip:!1},_armatureKey:"",_accTime:0,_playCount:0,_frameCache:null,_curFrame:null,_playing:!1,_armatureCache:null},ctor:function(){this._eventTarget=new e;this._materialCache={};this._inited=!1;this.attachUtil=new s;this._factory=dragonBones.CCFactory.getInstance()},onLoad:function(){for(var n,i=this.node.children,t=0,r=i.length;t<r;t++)n=i[t],0===(n._name&&n._name.search("CHILD_ARMATURE-"))&&n.destroy()},_updateBatch:function(){var n=this.getMaterial(0);n&&n.define("CC_USE_MODEL",!this.enableBatch);this._materialCache={}},_updateMaterial:function(){var n=this.getMaterial(0),t,i;n&&(n.define("CC_USE_MODEL",!this.enableBatch),n.define("USE_TEXTURE",!0),t=this.premultipliedAlpha?cc.gfx.BLEND_ONE:cc.gfx.BLEND_SRC_ALPHA,i=cc.gfx.BLEND_ONE_MINUS_SRC_ALPHA,n.setBlend(!0,cc.gfx.BLEND_FUNC_ADD,t,t,cc.gfx.BLEND_FUNC_ADD,i,i));this._materialCache={}},disableRender:function(){this._super();this.node._renderFlag&=~u},markForRender:function(n){this._super(n);n?this.node._renderFlag|=u:this.node._renderFlag&=~u},_validateRender:function(){var n=this.dragonAtlasAsset&&this.dragonAtlasAsset.texture;n&&n.loaded?this._super():this.disableRender()},__preload:function(){this._init()},_init:function(){var n;if(!this._inited){this._inited=!0;this._resetAssembler();this._activateMaterial();this._parseDragonAtlasAsset();this._refresh();for(var i=this.node.children,t=0,r=i.length;t<r;t++)n=i[t],n&&"DEBUG_DRAW_NODE"===n._name&&n.destroy();this._updateDebugDraw()}},getArmatureKey:function(){return this._armatureKey},setAnimationCacheMode:function(n){this._preCacheMode!==n&&(this._cacheMode=n,this._buildArmature(),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.add(this._armature))},isAnimationCached:function(){return this._cacheMode!==i.REALTIME},onEnable:function(){this._super();this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.add(this._armature)},onDisable:function(){this._super();this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.remove(this._armature)},_emitCacheCompleteEvent:function(){this._eventTarget.emit(dragonBones.EventObject.LOOP_COMPLETE);this._eventTarget.emit(dragonBones.EventObject.COMPLETE)},update:function(n){var t,i,f,e,u;if(this.isAnimationCached()&&this._frameCache&&(t=this._frameCache,t.isInited()))if(i=t.frames,this._playing){if(f=r.FrameTime,0==this._accTime&&0==this._playCount&&this._eventTarget.emit(dragonBones.EventObject.START),e=dragonBones.timeScale,this._accTime+=n*this.timeScale*e,u=Math.floor(this._accTime/f),t.isCompleted||t.updateToFrame(u),t.isCompleted&&u>=i.length){if(this._playCount++,this.playTimes>0&&this._playCount>=this.playTimes)return this._curFrame=i[i.length-1],this._accTime=0,this._playing=!1,this._playCount=0,void this._emitCacheCompleteEvent();this._accTime=0;u=0;this._emitCacheCompleteEvent()}this._curFrame=i[u]}else t.isInvalid()&&(t.updateToFrame(),this._curFrame=i[i.length-1])},onDestroy:function(){this._super();this._inited=!1;this._cacheMode===i.PRIVATE_CACHE?(this._armatureCache.dispose(),this._armatureCache=null,this._armature=null):this._cacheMode===i.SHARED_CACHE?(this._armatureCache=null,this._armature=null):this._armature&&(this._armature.dispose(),this._armature=null)},_updateDebugDraw:function(){var t,n;this.debugBones?(this._debugDraw||(t=new cc.PrivateNode,t.name="DEBUG_DRAW_NODE",n=t.addComponent(o),n.lineWidth=1,n.strokeColor=cc.color(255,0,0,255),this._debugDraw=n),this._debugDraw.node.parent=this.node):this._debugDraw&&(this._debugDraw.node.parent=null)},_buildArmature:function(){var n,t;if(this.dragonAsset&&this.dragonAtlasAsset&&this.armatureName){if(this._armature&&(this._preCacheMode===i.PRIVATE_CACHE?this._armatureCache.dispose():this._preCacheMode===i.REALTIME&&this._armature.dispose(),this._armatureCache=null,this._armature=null,this._displayProxy=null,this._frameCache=null,this._curFrame=null,this._playing=!1,this._preCacheMode=null),this._cacheMode===i.SHARED_CACHE?this._armatureCache=r.sharedCache:this._cacheMode===i.PRIVATE_CACHE&&(this._armatureCache=new r,this._armatureCache.enablePrivateMode()),n=this.dragonAtlasAsset._uuid,this._armatureKey=this.dragonAsset.init(this._factory,n),this.isAnimationCached()&&(this._armature=this._armatureCache.getArmatureCache(this.armatureName,this._armatureKey,n),this._armature||(this._cacheMode=i.REALTIME)),this._preCacheMode=this._cacheMode,this._cacheMode===i.REALTIME){if(this._displayProxy=this._factory.buildArmatureDisplay(this.armatureName,this._armatureKey,"",n),!this._displayProxy)return;this._displayProxy._ccNode=this.node;this._displayProxy.setEventTarget(this._eventTarget);this._armature=this._displayProxy._armature;this._armature.animation.timeScale=this.timeScale}(this._cacheMode!==i.REALTIME&&this.debugBones&&cc.warn("Debug bones is invalid in cached mode"),this._armature)&&(t=this._armature.armatureData.aabb,this.node.setContentSize(t.width,t.height));this._updateBatch();this.attachUtil.init(this);this.attachUtil._associateAttachedNode();this.animationName&&this.playAnimation(this.animationName,this.playTimes);this.markForRender(!0)}},_parseDragonAtlasAsset:function(){this.dragonAtlasAsset&&this.dragonAtlasAsset.init(this._factory)},_refresh:function(){this._buildArmature()},_updateCacheModeEnum:!1,_updateAnimEnum:!1,_updateArmatureEnum:!1,playAnimation:function(n,t){if(this.playTimes=void 0===t?-1:t,this.animationName=n,this.isAnimationCached()){var i=this._armatureCache.getAnimationCache(this._armatureKey,n);i||(i=this._armatureCache.initAnimationCache(this._armatureKey,n));i&&(this._accTime=0,this._playCount=0,this._frameCache=i,this.attachUtil._hasAttachedNode()&&this._frameCache.enableCacheAttachedInfo(),this._frameCache.updateToFrame(0),this._playing=!0,this._curFrame=this._frameCache.frames[0])}else if(this._armature)return this._armature.animation.play(n,this.playTimes)},updateAnimationCache:function(n){this.isAnimationCached()&&this._armatureCache.updateAnimationCache(this._armatureKey,n)},invalidAnimationCache:function(){this.isAnimationCached()&&this._armatureCache.invalidAnimationCache(this._armatureKey)},getArmatureNames:function(){var n=this._factory.getDragonBonesData(this._armatureKey);return n&&n.armatureNames||[]},getAnimationNames:function(n){var r=[],u=this._factory.getDragonBonesData(this._armatureKey),t,i;if(u&&(t=u.getArmature(n),t))for(i in t.animations)t.animations.hasOwnProperty(i)&&r.push(i);return r},on:function(n,t,i){this.addEventListener(n,t,i)},off:function(n,t,i){this.removeEventListener(n,t,i)},once:function(n,t,i){this._eventTarget.once(n,t,i)},addEventListener:function(n,t,i){this._eventTarget.on(n,t,i)},removeEventListener:function(n,t,i){this._eventTarget.off(n,t,i)},buildArmature:function(n,t){return this._factory.createArmatureNode(this,n,t)},armature:function(){return this._armature}});t.exports=dragonBones.ArmatureDisplay=l},{"../../cocos2d/core/components/CCRenderComponent":115,"../../cocos2d/core/event/event-target":142,"../../cocos2d/core/graphics/graphics":158,"../../cocos2d/core/renderer/render-flow":227,"./ArmatureCache":346,"./AttachUtil":348}],348:[function(n,t){"use strict";var i,u=(i=n("../../cocos2d/core/value-types/mat4"))&&i.__esModule?i:{"default":i},f=n("../../cocos2d/core/renderer/render-flow").FLAG_TRANSFORM,e=function(){},r=function(n){Object.defineProperty(n,"_worldMatDirty",{get:function(){return!0},set:function(){}});n._calculWorldMatrix=e;n._mulMat=e},o=new u.default,s=cc.Class({name:"dragonBones.AttachUtil",ctor:function(){this._inited=!1;this._armature=null;this._armatureNode=null;this._armatureDisplay=null;this._attachedRootNode=null;this._attachedNodeArray=[];this._boneIndexToNode={}},init:function(n){this._inited=!0;this._armature=n._armature;this._armatureNode=n.node;this._armatureDisplay=n},reset:function(){this._inited=!1;this._armature=null;this._armatureNode=null;this._armatureDisplay=null},_prepareAttachNode:function(){if(this._armature){var n=this._armatureNode.getChildByName("ATTACHED_NODE_TREE");return n&&n.isValid||(n=new cc.Node("ATTACHED_NODE_TREE"),r(n),this._armatureNode.addChild(n)),this._armatureDisplay.isAnimationCached()&&this._armatureDisplay._frameCache&&this._armatureDisplay._frameCache.enableCacheAttachedInfo(),this._attachedRootNode=n,n}},_buildBoneAttachedNode:function(n,t){var r="ATTACHED_NODE:"+n.name,i=new cc.Node(r);return this._buildBoneRelation(i,n,t),i},_buildBoneRelation:function(n,t,i){r(n);n._bone=t;n._boneIndex=i;this._attachedNodeArray.push(n);this._boneIndexToNode[i]=n},getAttachedRootNode:function(){return this._attachedRootNode},getAttachedNodes:function(n){var u=this._attachedNodeArray,r=[],i,f,t;if(!this._inited)return r;for(i=0,f=u.length;i<f;i++)t=u[i],t&&t.isValid&&t.name==="ATTACHED_NODE:"+n&&r.push(t);return r},_rebuildNodeArray:function(){for(var n,r=this._boneIndexToNode={},i=this._attachedNodeArray,u=this._attachedNodeArray=[],t=0,f=i.length;t<f;t++)n=i[t],n&&n.isValid&&!n._toRemove&&(u.push(n),r[n._boneIndex]=n)},_sortNodeArray:function(){this._attachedNodeArray.sort(function(n,t){return n._boneIndex<t._boneIndex?-1:1})},_getNodeByBoneIndex:function(n){var t=this._boneIndexToNode[n];return t&&t.isValid?t:null},destroyAttachedNodes:function(n){var t;if(this._inited){for(var r=this._attachedNodeArray,u=function n(t){for(var r,u=t.children,i=0,f=u.length;i<f;i++)r=u[i],r&&n(r);t._toRemove=!0},i=0,f=r.length;i<f;i++)t=r[i],t&&t.isValid&&t.name.split("ATTACHED_NODE:")[1]===n&&(u(t),t.removeFromParent(!0),t.destroy(),r[i]=null);this._rebuildNodeArray()}},generateAttachedNodes:function(n){var t=[],i,f;if(!this._inited||(i=this._prepareAttachNode(),!i))return t;var s=0,r=[],e=function(t){if(t){for(var i,o=t.getBones(),u=0,l=o.length;u<l;u++)(i=o[u])._boneIndex=s++,n===i.name&&r.push(i);for(var h,c=t.getSlots(),f=0,a=c.length;f<a;f++)(h=c[f]).childArmature&&e(h.childArmature)}}.bind(this);e(this._armature);for(var o=function(n){var t,u,r;if(n)return(t=this._getNodeByBoneIndex(n._boneIndex),t)?t:(t=this._buildBoneAttachedNode(n,n._boneIndex),u=null,n.armature.parent&&(u=n.armature.parent.parent),r=o(n.parent||u)||i,t.parent=r,t._rootNode=n.parent?r._rootNode:r,t)}.bind(this),u=0,h=r.length;u<h;u++)f=o(r[u]),f&&t.push(f);return this._sortNodeArray(),t},destroyAllAttachedNodes:function(){if(this._attachedRootNode=null,this._attachedNodeArray.length=0,this._boneIndexToNode={},this._inited){var n=this._armatureNode.getChildByName("ATTACHED_NODE_TREE");n&&(n.removeFromParent(!0),n.destroy(),n=null)}},generateAllAttachedNodes:function(){var n,i,t;if(this._inited&&(this._boneIndexToNode={},this._attachedNodeArray.length=0,n=this._prepareAttachNode(),n))return i=0,t=function(r){var e,h,o,u;if(r){e=n;r.parent&&(e=r.parent.parent._attachedNode);for(var f,l=r.getBones(),s=0,y=l.length;s<y;s++)h=i++,(f=l[s])._attachedNode=null,o=null,(o=f.parent?f.parent._attachedNode:e)&&(u=o.getChildByName("ATTACHED_NODE:"+f.name),u&&u.isValid?this._buildBoneRelation(u,f,h):(u=this._buildBoneAttachedNode(f,h),o.addChild(u)),u._rootNode=e,f._attachedNode=u);for(var a,v=r.getSlots(),c=0,p=v.length;c<p;c++)(a=v[c]).childArmature&&t(a.childArmature)}}.bind(this),t(this._armature),n},_hasAttachedNode:function(){return!!this._inited&&!!this._armatureNode.getChildByName("ATTACHED_NODE_TREE")},_associateAttachedNode:function(){var n,t,u,i;this._inited&&(n=this._armatureNode.getChildByName("ATTACHED_NODE_TREE"),n&&n.isValid&&(this._attachedRootNode=n,this._boneIndexToNode={},this._attachedNodeArray.length=0,t=this._armature,t&&(r(n),this._armatureDisplay.isAnimationCached()&&this._armatureDisplay._frameCache&&this._armatureDisplay._frameCache.enableCacheAttachedInfo(),u=0,i=function(t){var e,l,s,f;if(t){e=n;t.parent&&(e=t.parent.parent._attachedNode);for(var r,c=t.getBones(),o=0,y=c.length;o<y;o++)l=u++,(r=c[o])._attachedNode=null,s=null,(s=r.parent?r.parent._attachedNode:e)&&(f=s.getChildByName("ATTACHED_NODE:"+r.name),f&&f.isValid&&(this._buildBoneRelation(f,r,l),f._rootNode=e,r._attachedNode=f));for(var a,v=t.getSlots(),h=0,p=v.length;h<p;h++)(a=v[h]).childArmature&&i(a.childArmature)}}.bind(this),i(t))))},_syncAttachedNode:function(){var e,r,v,c,l,n,h;if(this._inited){if(e=this._attachedRootNode,r=this._attachedNodeArray,!e||!e.isValid)return this._attachedRootNode=null,void(r.length=0);if(v=this._armatureNode._worldMatrix,u.default.copy(e._worldMatrix,v),e._renderFlag&=~f,c=null,l=this._armatureDisplay.isAnimationCached(),!l||(c=this._armatureDisplay._curFrame&&this._armatureDisplay._curFrame.boneInfos)){for(var y,p,t,i,w=this._armatureNode._mulMat,a=!1,s=0,b=r.length;s<b;s++)n=r[s],n&&n.isValid?(h=l?c[n._boneIndex]:n._bone,h&&!h._isInPool?(y=n._worldMatrix,p=n._rootNode._worldMatrix,t=h.globalTransformMatrix,i=void 0,(i=o.m)[0]=t.a,i[1]=t.b,i[4]=-t.c,i[5]=-t.d,i[12]=t.tx,i[13]=t.ty,w(y,p,o),n._renderFlag&=~f):(n.removeFromParent(!0),n.destroy(),r[s]=null,a=!0)):(r[s]=null,a=!0);a&&this._rebuildNodeArray()}}}});t.exports=dragonBones.AttachUtil=s},{"../../cocos2d/core/renderer/render-flow":227,"../../cocos2d/core/value-types/mat4":286}],349:[function(n){"use strict";var t=n("../../cocos2d/core/event/event-target");dragonBones.CCArmatureDisplay=cc.Class({name:"dragonBones.CCArmatureDisplay",properties:{node:{get:function(){return this}}},ctor:function(){this._eventTarget=new t},setEventTarget:function(n){this._eventTarget=n},getRootDisplay:function(){var t,n=this._armature._parent;if(!n)return this;for(;n;)t=n,n=n._armature._parent;return t._armature.getDisplay()},convertToRootSpace:function(n){var r=this._armature._parent,t,i;return r?(r.updateWorldMatrix(),t=r._worldMatrix.m,i=cc.v2(0,0),i.x=n.x*t[0]+n.y*t[4]+t[12],i.y=n.x*t[1]+n.y*t[5]+t[13],i):n},convertToWorldSpace:function(n){var t=this.convertToRootSpace(n);return this.getRootNode().convertToWorldSpaceAR(t)},getRootNode:function(){var n=this.getRootDisplay();return n&&n._ccNode},dbInit:function(n){this._armature=n},dbClear:function(){this._armature=null},dbUpdate:function(){},advanceTimeBySelf:function(n){this.shouldAdvanced=!!n},hasDBEventListener:function(n){return this._eventTarget.hasEventListener(n)},addDBEventListener:function(n,t,i){this._eventTarget.on(n,t,i)},removeDBEventListener:function(n,t,i){this._eventTarget.off(n,t,i)},dispatchDBEvent:function(n,t){this._eventTarget.emit(n,t)}})},{"../../cocos2d/core/event/event-target":142}],350:[function(){"use strict";var n=dragonBones.BaseObject,i=dragonBones.BaseFactory,t=dragonBones.CCFactory=cc.Class({name:"dragonBones.CCFactory","extends":i,statics:{_factory:null,getInstance:function(){return t._factory||(t._factory=new t),t._factory}},ctor:function(){var n=new dragonBones.CCArmatureDisplay;this._dragonBones=new dragonBones.DragonBones(n);cc.director._scheduler&&(cc.game.on(cc.game.EVENT_RESTART,this.initUpdate,this),this.initUpdate())},initUpdate:function(){cc.director._scheduler.enableForTarget(this);cc.director._scheduler.scheduleUpdate(this,cc.Scheduler.PRIORITY_SYSTEM,!1)},update:function(n){this._dragonBones.advanceTime(n)},getDragonBonesDataByRawData:function(n){return(n instanceof ArrayBuffer?i._binaryParser:this._dataParser).parseDragonBonesData(n,1)},buildArmatureDisplay:function(n,t,i,r){var u=this.buildArmature(n,t,i,r);return u&&u._display},createArmatureNode:function(n,t,i){var r=(i=i||new cc.Node).getComponent(dragonBones.ArmatureDisplay);return r||(r=i.addComponent(dragonBones.ArmatureDisplay)),i.name=t,r._armatureName=t,r._N$dragonAsset=n.dragonAsset,r._N$dragonAtlasAsset=n.dragonAtlasAsset,r._init(),r},_buildTextureAtlasData:function(t,i){return t?t.renderTexture=i:t=n.borrowObject(dragonBones.CCTextureAtlasData),t},_sortSlots:function(){for(var u=this._slots,n=[],i=0,e=u.length;i<e;i++){for(var r=u[i],o=r._zOrder,f=!1,t=n.length-1;t>=0;t--)if(o>=n[t]._zOrder){n.splice(t+1,0,r);f=!0;break}f||n.splice(0,0,r)}this._slots=n},_buildArmature:function(t){var i=n.borrowObject(dragonBones.Armature),r;return i._skinData=t.skin,i._animation=n.borrowObject(dragonBones.Animation),i._animation._armature=i,i._animation.animations=t.armature.animations,i._isChildArmature=!1,r=new dragonBones.CCArmatureDisplay,i.init(t.armature,r,r,this._dragonBones),i},_buildSlot:function(t,i,r){var u=n.borrowObject(dragonBones.CCSlot),f=u;return u.init(i,r,f,f),u},getDragonBonesDataByUUID:function(n){for(var t in this._dragonBonesDataMap)if(-1!=t.indexOf(n))return this._dragonBonesDataMap[t];return null},removeDragonBonesDataByUUID:function(n,t){for(var i in void 0===t&&(t=!0),this._dragonBonesDataMap)-1!==i.indexOf(n)&&(t&&this._dragonBones.bufferObject(this._dragonBonesDataMap[i]),delete this._dragonBonesDataMap[i])}})},{}],351:[function(n){"use strict";var i,r=(i=n("../../cocos2d/core/value-types/mat4"))&&i.__esModule?i:{"default":i},t=dragonBones.BinaryOffset,u=dragonBones.BoneType;dragonBones.CCSlot=cc.Class({name:"dragonBones.CCSlot","extends":dragonBones.Slot,ctor:function(){this._localVertices=[];this._indices=[];this._matrix=cc.mat4();this._worldMatrix=cc.mat4();this._worldMatrixDirty=!0;this._visible=!1;this._color=cc.color()},_onClear:function(){this._super();this._localVertices.length=0;this._indices.length=0;r.default.identity(this._matrix);r.default.identity(this._worldMatrix);this._worldMatrixDirty=!0;this._color=cc.color();this._visible=!1},statics:{toString:function(){return"[class dragonBones.CCSlot]"}},_onUpdateDisplay:function(){},_initDisplay:function(){},_addDisplay:function(){this._visible=!0},_replaceDisplay:function(){},_removeDisplay:function(){this._visible=!1},_disposeDisplay:function(){},_updateVisible:function(){this._visible=this.parent._visible},_updateZOrder:function(){},_updateBlendMode:function(){var t;if(this._childArmature)for(var i=this._childArmature.getSlots(),n=0,r=i.length;n<r;n++)t=i[n],t._blendMode=this._blendMode,t._updateBlendMode()},_updateColor:function(){var n=this._color;n.r=255*this._colorTransform.redMultiplier;n.g=255*this._colorTransform.greenMultiplier;n.b=255*this._colorTransform.blueMultiplier;n.a=255*this._colorTransform.alphaMultiplier},getTexture:function(){return this._textureData&&this._textureData.spriteFrame&&this._textureData.spriteFrame.getTexture()},_updateFrame:function(){var y;this._indices.length=0;var u=this._indices,n=this._localVertices,p=0,i=0,h=this._textureData;if(this._display&&!(this._displayIndex<0)&&h&&h.spriteFrame){var w=h.spriteFrame.getTexture(),c=w.width,l=w.height,r=h.region,f=null!==this._deformVertices&&this._display===this._meshDisplay?this._deformVertices.verticesData:null;if(f){var b=f.data,a=b.intArray,o=b.floatArray,k=a[f.offset+t.MeshVertexCount],rt=a[f.offset+t.MeshTriangleCount],s=a[f.offset+t.MeshFloatOffset];s<0&&(s+=65536);for(var v=s+2*k,d=this._armature._armatureData.scale,e=0,ut=2*k;e<ut;e+=2)n[i++]=o[s+e]*d,n[i++]=-o[s+e+1]*d,f.rotated?(n[i++]=(r.x+(1-o[v+e])*r.width)/c,n[i++]=(r.y+o[v+e+1]*r.height)/l):(n[i++]=(r.x+o[v+e]*r.width)/c,n[i++]=(r.y+o[v+e+1]*r.height)/l);for(y=0;y<3*rt;++y)u[p++]=a[f.offset+t.MeshVertexIndices+y];n.length=i;u.length=p;f.weight&&this._identityTransform()}else{var g=r.x/c,nt=(r.y+r.height)/l,tt=(r.x+r.width)/c,it=r.y/l;n[i++]=0;n[i++]=0;n[i++]=g;n[i++]=nt;n[i++]=r.width;n[i++]=0;n[i++]=tt;n[i++]=nt;n[i++]=0;n[i++]=r.height;n[i++]=g;n[i++]=it;n[i++]=r.width;n[i++]=r.height;n[i++]=tt;n[i++]=it;u[0]=0;u[1]=1;u[2]=2;u[3]=1;u[4]=3;u[5]=2;n.length=i;u.length=6}this._visibleDirty=!0;this._blendModeDirty=!0;this._colorDirty=!0}},_updateMesh:function(){var l=this._armature._armatureData.scale,o=this._deformVertices.vertices,tt=this._deformVertices.bones,n=this._deformVertices.verticesData,a=n.weight,it=o.length>0&&n.inheritDeform,r=this._localVertices,d,h,c,i;if(a){var rt=n.data,v=rt.intArray,p=rt.floatArray,yt=v[n.offset+t.MeshVertexCount],w=v[a.offset+t.WeigthFloatOffset];w<0&&(w+=65536);for(var ut=0,ft=a.offset+t.WeigthBoneIndices+tt.length,b=w,et=0,k=0;ut<yt;ut++,k+=4){for(var pt=v[ft++],ot=0,st=0,ht=0;ht<pt;++ht)if(d=tt[v[ft++]],null!==d){var f=d.globalTransformMatrix,ct=p[b++],g=p[b++]*l,nt=p[b++]*l;it&&(g+=o[et++],nt+=o[et++]);ot+=(f.a*g+f.c*nt+f.tx)*ct;st+=(f.b*g+f.d*nt+f.ty)*ct}r[k]=ot;r[k+1]=-st}}else if(it){var wt=this._parent._boneData.type!==u.Bone,lt=n.data,at=lt.intArray,vt=lt.floatArray,bt=at[n.offset+t.MeshVertexCount],y=at[n.offset+t.MeshFloatOffset];y<0&&(y+=65536);for(var e=0,kt=bt,s=0;e<kt;e++,s+=4)h=vt[y+2*e]*l+o[2*e],c=vt[y+2*e+1]*l+o[2*e+1],wt?(i=this._parent._getGlobalTransformMatrix(h,c),r[s]=i.a*h+i.c*c+i.tx,r[s+1]=-i.b*h+i.d*c+i.ty):(r[s]=h,r[s+1]=-c)}a&&this._identityTransform()},_identityTransform:function(){var n=this._matrix.m;n[0]=1;n[1]=0;n[4]=-0;n[5]=-1;n[12]=0;n[13]=0;this._worldMatrixDirty=!0},_updateTransform:function(){var n=this._matrix.m;n[0]=this.globalTransformMatrix.a;n[1]=this.globalTransformMatrix.b;n[4]=-this.globalTransformMatrix.c;n[5]=-this.globalTransformMatrix.d;this._childArmature?(n[12]=this.globalTransformMatrix.tx,n[13]=this.globalTransformMatrix.ty):(n[12]=this.globalTransformMatrix.tx-(this.globalTransformMatrix.a*this._pivotX-this.globalTransformMatrix.c*this._pivotY),n[13]=this.globalTransformMatrix.ty-(this.globalTransformMatrix.b*this._pivotX-this.globalTransformMatrix.d*this._pivotY));this._worldMatrixDirty=!0},updateWorldMatrix:function(){var n,t,r;if(this._armature&&(n=this._armature._parent,n&&n.updateWorldMatrix(),this._worldMatrixDirty)){if(this.calculWorldMatrix(),t=this.childArmature,!t)return;for(var u=t.getSlots(),i=0,f=u.length;i<f;i++)r=u[i],r&&(r._worldMatrixDirty=!0)}},_mulMat:function(n,t,i){var u=t.m,f=i.m,r=n.m,e=u[0],s=u[1],h=u[4],o=u[5],w=u[12],b=u[13],c=f[0],l=f[1],a=f[4],v=f[5],y=f[12],p=f[13];0!==s||0!==h?(r[0]=c*e+l*h,r[1]=c*s+l*o,r[4]=a*e+v*h,r[5]=a*s+v*o,r[12]=e*y+h*p+w,r[13]=s*y+o*p+b):(r[0]=c*e,r[1]=l*o,r[4]=a*e,r[5]=v*o,r[12]=e*y+w,r[13]=o*p+b)},calculWorldMatrix:function(){var n=this._armature._parent;n?this._mulMat(this._worldMatrix,n._worldMatrix,this._matrix):r.default.copy(this._worldMatrix,this._matrix);this._worldMatrixDirty=!1}})},{"../../cocos2d/core/value-types/mat4":286}],352:[function(){"use strict";dragonBones.CCTextureAtlasData=cc.Class({"extends":dragonBones.TextureAtlasData,name:"dragonBones.CCTextureAtlasData",properties:{_renderTexture:{"default":null,serializable:!1},renderTexture:{get:function(){return this._renderTexture},set:function(n){var r,t,i,u,f,e;if(this._renderTexture=n,n)for(r in this.textures)t=this.textures[r],t.spriteFrame||(i=t.rotated?cc.rect(t.region.x,t.region.y,t.region.height,t.region.width):cc.rect(t.region.x,t.region.y,t.region.width,t.region.height),u=cc.v2(0,0),f=cc.size(i.width,i.height),t.spriteFrame=new cc.SpriteFrame,t.spriteFrame.setTexture(n,i,!1,u,f));else for(e in this.textures)this.textures[e].spriteFrame=null}}},statics:{toString:function(){return"[class dragonBones.CCTextureAtlasData]"}},_onClear:function(){dragonBones.TextureAtlasData.prototype._onClear.call(this);this.renderTexture=null},createTexture:function(){return dragonBones.BaseObject.borrowObject(dragonBones.CCTextureData)}});dragonBones.CCTextureData=cc.Class({"extends":dragonBones.TextureData,name:"dragonBones.CCTextureData",properties:{spriteFrame:{"default":null,serializable:!1}},statics:{toString:function(){return"[class dragonBones.CCTextureData]"}},_onClear:function(){dragonBones.TextureData.prototype._onClear.call(this);this.spriteFrame=null}})},{}],353:[function(n,t){"use strict";var i=n("./ArmatureCache").sharedCache,r=cc.Class({name:"dragonBones.DragonBonesAsset","extends":cc.Asset,ctor:function(){this.reset()},properties:{_dragonBonesJson:"",dragonBonesJson:{get:function(){return this._dragonBonesJson},set:function(n){this._dragonBonesJson=n;this._dragonBonesJsonData=JSON.parse(n);this.reset()}},_nativeAsset:{get:function(){return this._buffer},set:function(n){this._buffer=n.buffer||n;this.reset()},override:!0}},statics:{preventDeferredLoadDependents:!0},createNode:!1,reset:function(){this._clear()},init:function(n,t){var r,u,i;return this._factory=n,!this._dragonBonesJsonData&&this.dragonBonesJson&&(this._dragonBonesJsonData=JSON.parse(this.dragonBonesJson)),(r=this._dragonBonesJsonData?this._dragonBonesJsonData:this._nativeAsset,this._uuid)||(u=this._factory.getDragonBonesDataByRawData(r),u?this._uuid=u.name:cc.warn("dragonbones name is empty")),i=this._uuid+"#"+t,this._factory.getDragonBonesData(i)?i:(this._factory.parseDragonBonesData(r,i),i)},getArmatureEnum:!1,getAnimsEnum:!1,_clear:function(){this._factory&&(i.resetArmature(this._uuid),this._factory.removeDragonBonesDataByUUID(this._uuid,!0))},destroy:function(){this._clear();this._super()}});dragonBones.DragonBonesAsset=t.exports=r},{"./ArmatureCache":346}],354:[function(n,t){"use strict";var i=n("./ArmatureCache").sharedCache,r=cc.Class({name:"dragonBones.DragonBonesAtlasAsset","extends":cc.Asset,ctor:function(){this._clear()},properties:{_atlasJson:"",atlasJson:{get:function(){return this._atlasJson},set:function(n){this._atlasJson=n;this._atlasJsonData=JSON.parse(this.atlasJson);this._clear()}},_texture:{"default":null,type:cc.Texture2D,formerlySerializedAs:"texture"},texture:{get:function(){return this._texture},set:function(n){this._texture=n;this._clear()}},_textureAtlasData:null},statics:{preventDeferredLoadDependents:!0},createNode:!1,init:function(n){this._factory=n;this._atlasJsonData||(this._atlasJsonData=JSON.parse(this.atlasJson));var t=this._atlasJsonData;this._uuid=this._uuid||t.name;this._textureAtlasData?n.addTextureAtlasData(this._textureAtlasData,this._uuid):this._textureAtlasData=n.parseTextureAtlasData(t,this.texture,this._uuid)},_clear:function(){this._factory&&(i.resetArmature(this._uuid),this._factory.removeTextureAtlasData(this._uuid,!0),this._factory.removeDragonBonesDataByUUID(this._uuid,!0));this._textureAtlasData=null},destroy:function(){this._clear();this._super()}});dragonBones.DragonBonesAtlasAsset=t.exports=r},{"./ArmatureCache":346}],355:[function(n){"use strict";var t="undefined"==typeof window?global:window;t.dragonBones=n("./lib/dragonBones");void 0!==t.dragonBones&&(dragonBones._timeScale=1,Object.defineProperty(dragonBones,"timeScale",{get:function(){return this._timeScale},set:function(n){this._timeScale=n;this.CCFactory.getInstance()._dragonBones.clock.timeScale=n},configurable:!0}),dragonBones.DisplayType={Image:0,Armature:1,Mesh:2},dragonBones.ArmatureType={Armature:0,MovieClip:1,Stage:2},dragonBones.ExtensionType={FFD:0,AdjustColor:10,BevelFilter:11,BlurFilter:12,DropShadowFilter:13,GlowFilter:14,GradientBevelFilter:15,GradientGlowFilter:16},dragonBones.EventType={Frame:0,Sound:1},dragonBones.ActionType={Play:0,Stop:1,GotoAndPlay:2,GotoAndStop:3,FadeIn:4,FadeOut:5},dragonBones.AnimationFadeOutMode={None:0,SameLayer:1,SameGroup:2,SameLayerAndGroup:3,All:4},dragonBones.BinaryOffset={WeigthBoneCount:0,WeigthFloatOffset:1,WeigthBoneIndices:2,MeshVertexCount:0,MeshTriangleCount:1,MeshFloatOffset:2,MeshWeightOffset:3,MeshVertexIndices:4,TimelineScale:0,TimelineOffset:1,TimelineKeyFrameCount:2,TimelineFrameValueCount:3,TimelineFrameValueOffset:4,TimelineFrameOffset:5,FramePosition:0,FrameTweenType:1,FrameTweenEasingOrCurveSampleCount:2,FrameCurveSamples:3,DeformMeshOffset:0,DeformCount:1,DeformValueCount:2,DeformValueOffset:3,DeformFloatOffset:4},dragonBones.BoneType={Bone:0,Surface:1},n("./CCFactory"),n("./CCSlot"),n("./CCTextureData"),n("./CCArmatureDisplay"),n("./ArmatureCache"),n("./DragonBonesAsset"),n("./DragonBonesAtlasAsset"),n("./ArmatureDisplay"),n("./webgl-assembler"))},{"./ArmatureCache":346,"./ArmatureDisplay":347,"./CCArmatureDisplay":349,"./CCFactory":350,"./CCSlot":351,"./CCTextureData":352,"./DragonBonesAsset":353,"./DragonBonesAtlasAsset":354,"./lib/dragonBones":356,"./webgl-assembler":357}],356:[function(n,t){"use strict";var u,f,i,r=Object.setPrototypeOf||Array;i||(i={}),function(n){var t=function(){function t(i){this._clock=new n.WorldClock;this._events=[];this._objects=[];this._eventManager=null;this._eventManager=i;console.info("DragonBones: "+t.VERSION+"\nWebsite: http://dragonbones.com/\nSource and Demo: https://github.com/DragonBones/")}return t.prototype.advanceTime=function(t){var r,f,u,i,e;if(this._objects.length>0){for(r=0,f=this._objects;r<f.length;r++)f[r].returnToPool();this._objects.length=0}if(this._clock.advanceTime(t),this._events.length>0){for(u=0;u<this._events.length;++u)i=this._events[u],e=i.armature,null!==e._armatureData&&(e.eventDispatcher.dispatchDBEvent(i.type,i),i.type===n.EventObject.SOUND_EVENT&&this._eventManager.dispatchDBEvent(i.type,i)),this.bufferObject(i);this._events.length=0}},t.prototype.bufferEvent=function(n){this._events.indexOf(n)<0&&this._events.push(n)},t.prototype.bufferObject=function(n){this._objects.indexOf(n)<0&&this._objects.push(n)},Object.defineProperty(t.prototype,"clock",{get:function(){return this._clock},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eventManager",{get:function(){return this._eventManager},enumerable:!0,configurable:!0}),t.VERSION="5.6.300",t.yDown=!1,t.debug=!1,t.debugDraw=!1,t.webAssembly=!1,t}();n.DragonBones=t}(i||(i={}));console.warn||(console.warn=function(){});console.assert||(console.assert=function(){});Date.now||(Date.now=function(){return(new Date).getTime()});r=function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){var t=function(){function n(){this.hashCode=n._hashCode++;this._isInPool=!1}return n._returnObject=function(t){var i=String(t.constructor),u=i in n._maxCountMap?n._maxCountMap[i]:n._defaultMaxCount,r=n._poolsMap[i]=n._poolsMap[i]||[];r.length<u&&(t._isInPool?console.warn("The object is already in the pool."):(t._isInPool=!0,r.push(t)))},n.toString=function(){throw new Error;},n.setMaxCount=function(t,i){var r,u;if((i<0||i!=i)&&(i=0),null!==t)null!==(u=(r=String(t))in n._poolsMap?n._poolsMap[r]:null)&&u.length>i&&(u.length=i),n._maxCountMap[r]=i;else for(r in n._defaultMaxCount=i,n._poolsMap)(u=n._poolsMap[r]).length>i&&(u.length=i),r in n._maxCountMap&&(n._maxCountMap[r]=i)},n.clearPool=function(t){var r,u,i;if(void 0===t&&(t=null),null!==t)r=String(t),null!==(i=r in n._poolsMap?n._poolsMap[r]:null)&&i.length>0&&(i.length=0);else for(u in n._poolsMap)(i=n._poolsMap[u]).length=0},n.borrowObject=function(t){var f=String(t),i=f in n._poolsMap?n._poolsMap[f]:null,r,u;return null!==i&&i.length>0?(r=i.pop(),r._isInPool=!1,r):(u=new t,u._onClear(),u)},n.prototype.returnToPool=function(){this._onClear();n._returnObject(this)},n._hashCode=0,n._defaultMaxCount=3e3,n._maxCountMap={},n._poolsMap={},n}();n.BaseObject=t}(i||(i={})),function(n){var t=function(){function n(n,t,i,r,u,f){void 0===n&&(n=1);void 0===t&&(t=0);void 0===i&&(i=0);void 0===r&&(r=1);void 0===u&&(u=0);void 0===f&&(f=0);this.a=n;this.b=t;this.c=i;this.d=r;this.tx=u;this.ty=f}return n.prototype.toString=function(){return"[object dragonBones.Matrix] a:"+this.a+" b:"+this.b+" c:"+this.c+" d:"+this.d+" tx:"+this.tx+" ty:"+this.ty},n.prototype.copyFrom=function(n){return this.a=n.a,this.b=n.b,this.c=n.c,this.d=n.d,this.tx=n.tx,this.ty=n.ty,this},n.prototype.copyFromArray=function(n,t){return void 0===t&&(t=0),this.a=n[t],this.b=n[t+1],this.c=n[t+2],this.d=n[t+3],this.tx=n[t+4],this.ty=n[t+5],this},n.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this},n.prototype.concat=function(n){var r=this.a*n.a,t=0,i=0,u=this.d*n.d,f=this.tx*n.a+n.tx,e=this.ty*n.d+n.ty;return 0===this.b&&0===this.c||(r+=this.b*n.c,t+=this.b*n.d,i+=this.c*n.a,u+=this.c*n.b),0===n.b&&0===n.c||(t+=this.a*n.b,i+=this.d*n.c,f+=this.ty*n.c,e+=this.tx*n.b),this.a=r,this.b=t,this.c=i,this.d=u,this.tx=f,this.ty=e,this},n.prototype.invert=function(){var i=this.a,r=this.b,u=this.c,n=this.d,f=this.tx,e=this.ty,t,o;return 0===r&&0===u?(this.b=this.c=0,0===i||0===n?this.a=this.b=this.tx=this.ty=0:(i=this.a=1/i,n=this.d=1/n,this.tx=-i*f,this.ty=-n*e),this):(t=i*n-r*u,0===t)?(this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this):(t=1/t,o=this.a=n*t,r=this.b=-r*t,u=this.c=-u*t,n=this.d=i*t,this.tx=-(o*f+u*e),this.ty=-(r*f+n*e),this)},n.prototype.transformPoint=function(n,t,i,r){void 0===r&&(r=!1);i.x=this.a*n+this.c*t;i.y=this.b*n+this.d*t;r||(i.x+=this.tx,i.y+=this.ty)},n.prototype.transformRectangle=function(n,t){void 0===t&&(t=!1);var v=this.a,y=this.b,p=this.c,w=this.d,b=t?0:this.tx,k=t?0:this.ty,r=n.x,u=n.y,d=r+n.width,g=u+n.height,f=v*r+p*u+b,e=y*r+w*u+k,o=v*d+p*u+b,s=y*d+w*u+k,h=v*d+p*g+b,c=y*d+w*g+k,l=v*r+p*g+b,a=y*r+w*g+k,i=0;f>o&&(i=f,f=o,o=i);h>l&&(i=h,h=l,l=i);n.x=Math.floor(f<h?f:h);n.width=Math.ceil((o>l?o:l)-n.x);e>s&&(i=e,e=s,s=i);c>a&&(i=c,c=a,a=i);n.y=Math.floor(e<c?e:c);n.height=Math.ceil((s>a?s:a)-n.y)},n}();n.Matrix=t}(i||(i={})),function(n){var t=function(){function n(n,t,i,r,u,f){void 0===n&&(n=0);void 0===t&&(t=0);void 0===i&&(i=0);void 0===r&&(r=0);void 0===u&&(u=1);void 0===f&&(f=1);this.x=n;this.y=t;this.skew=i;this.rotation=r;this.scaleX=u;this.scaleY=f}return n.normalizeRadian=function(n){return(n=(n+Math.PI)%(2*Math.PI))+(n>0?-Math.PI:Math.PI)},n.prototype.toString=function(){return"[object dragonBones.Transform] x:"+this.x+" y:"+this.y+" skewX:"+180*this.skew/Math.PI+" skewY:"+180*this.rotation/Math.PI+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY},n.prototype.copyFrom=function(n){return this.x=n.x,this.y=n.y,this.skew=n.skew,this.rotation=n.rotation,this.scaleX=n.scaleX,this.scaleY=n.scaleY,this},n.prototype.identity=function(){return this.x=this.y=0,this.skew=this.rotation=0,this.scaleX=this.scaleY=1,this},n.prototype.add=function(n){return this.x+=n.x,this.y+=n.y,this.skew+=n.skew,this.rotation+=n.rotation,this.scaleX*=n.scaleX,this.scaleY*=n.scaleY,this},n.prototype.minus=function(n){return this.x-=n.x,this.y-=n.y,this.skew-=n.skew,this.rotation-=n.rotation,this.scaleX/=n.scaleX,this.scaleY/=n.scaleY,this},n.prototype.fromMatrix=function(t){var u=this.scaleX,f=this.scaleY,r=n.PI_Q,i;return this.x=t.tx,this.y=t.ty,this.rotation=Math.atan(t.b/t.a),i=Math.atan(-t.c/t.d),this.scaleX=this.rotation>-r&&this.rotation<r?t.a/Math.cos(this.rotation):t.b/Math.sin(this.rotation),this.scaleY=i>-r&&i<r?t.d/Math.cos(i):-t.c/Math.sin(i),u>=0&&this.scaleX<0&&(this.scaleX=-this.scaleX,this.rotation=this.rotation-Math.PI),f>=0&&this.scaleY<0&&(this.scaleY=-this.scaleY,i-=Math.PI),this.skew=i-this.rotation,this},n.prototype.toMatrix=function(n){return 0===this.rotation?(n.a=1,n.b=0):(n.a=Math.cos(this.rotation),n.b=Math.sin(this.rotation)),0===this.skew?(n.c=-n.b,n.d=n.a):(n.c=-Math.sin(this.skew+this.rotation),n.d=Math.cos(this.skew+this.rotation)),1!==this.scaleX&&(n.a*=this.scaleX,n.b*=this.scaleX),1!==this.scaleY&&(n.c*=this.scaleY,n.d*=this.scaleY),n.tx=this.x,n.ty=this.y,this},n.PI=Math.PI,n.PI_D=2*Math.PI,n.PI_H=Math.PI/2,n.PI_Q=Math.PI/4,n.RAD_DEG=180/Math.PI,n.DEG_RAD=Math.PI/180,n}();n.Transform=t}(i||(i={})),function(n){var t=function(){function n(n,t,i,r,u,f,e,o){void 0===n&&(n=1);void 0===t&&(t=1);void 0===i&&(i=1);void 0===r&&(r=1);void 0===u&&(u=0);void 0===f&&(f=0);void 0===e&&(e=0);void 0===o&&(o=0);this.alphaMultiplier=n;this.redMultiplier=t;this.greenMultiplier=i;this.blueMultiplier=r;this.alphaOffset=u;this.redOffset=f;this.greenOffset=e;this.blueOffset=o}return n.prototype.copyFrom=function(n){this.alphaMultiplier=n.alphaMultiplier;this.redMultiplier=n.redMultiplier;this.greenMultiplier=n.greenMultiplier;this.blueMultiplier=n.blueMultiplier;this.alphaOffset=n.alphaOffset;this.redOffset=n.redOffset;this.greenOffset=n.greenOffset;this.blueOffset=n.blueOffset},n.prototype.identity=function(){this.alphaMultiplier=this.redMultiplier=this.greenMultiplier=this.blueMultiplier=1;this.alphaOffset=this.redOffset=this.greenOffset=this.blueOffset=0},n}();n.ColorTransform=t}(i||(i={})),function(n){var t=function(){function n(n,t){void 0===n&&(n=0);void 0===t&&(t=0);this.x=n;this.y=t}return n.prototype.copyFrom=function(n){this.x=n.x;this.y=n.y},n.prototype.clear=function(){this.x=this.y=0},n}();n.Point=t}(i||(i={})),function(n){var t=function(){function n(n,t,i,r){void 0===n&&(n=0);void 0===t&&(t=0);void 0===i&&(i=0);void 0===r&&(r=0);this.x=n;this.y=t;this.width=i;this.height=r}return n.prototype.copyFrom=function(n){this.x=n.x;this.y=n.y;this.width=n.width;this.height=n.height},n.prototype.clear=function(){this.x=this.y=0;this.width=this.height=0},n}();n.Rectangle=t}(i||(i={})),function(n){var i=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.ints=[],t.floats=[],t.strings=[],t}return r(t,n),t.toString=function(){return"[class dragonBones.UserData]"},t.prototype._onClear=function(){this.ints.length=0;this.floats.length=0;this.strings.length=0},t.prototype.addInt=function(n){this.ints.push(n)},t.prototype.addFloat=function(n){this.floats.push(n)},t.prototype.addString=function(n){this.strings.push(n)},t.prototype.getInt=function(n){return void 0===n&&(n=0),n>=0&&n<this.ints.length?this.ints[n]:0},t.prototype.getFloat=function(n){return void 0===n&&(n=0),n>=0&&n<this.floats.length?this.floats[n]:0},t.prototype.getString=function(n){return void 0===n&&(n=0),n>=0&&n<this.strings.length?this.strings[n]:""},t}(n.BaseObject),t;n.UserData=i;t=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.data=null,t}return r(t,n),t.toString=function(){return"[class dragonBones.ActionData]"},t.prototype._onClear=function(){null!==this.data&&this.data.returnToPool();this.type=0;this.name="";this.bone=null;this.slot=null;this.data=null},t}(n.BaseObject);n.ActionData=t}(i||(i={})),function(n){var t=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.frameIndices=[],t.cachedFrames=[],t.armatureNames=[],t.armatures={},t.userData=null,t}return r(t,n),t.toString=function(){return"[class dragonBones.DragonBonesData]"},t.prototype._onClear=function(){for(var n in this.armatures)this.armatures[n].returnToPool(),delete this.armatures[n];null!==this.userData&&this.userData.returnToPool();this.autoSearch=!1;this.frameRate=0;this.version="";this.name="";this.stage=null;this.frameIndices.length=0;this.cachedFrames.length=0;this.armatureNames.length=0;this.binary=null;this.intArray=null;this.floatArray=null;this.frameIntArray=null;this.frameFloatArray=null;this.frameArray=null;this.timelineArray=null;this.userData=null},t.prototype.addArmature=function(n){n.name in this.armatures?console.warn("Same armature: "+n.name):(n.parent=this,this.armatures[n.name]=n,this.armatureNames.push(n.name))},t.prototype.getArmature=function(n){return n in this.armatures?this.armatures[n]:null},t.prototype.dispose=function(){console.warn("");this.returnToPool()},t}(n.BaseObject);n.DragonBonesData=t}(i||(i={})),function(n){var f=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.aabb=new n.Rectangle,i.animationNames=[],i.sortedBones=[],i.sortedSlots=[],i.defaultActions=[],i.actions=[],i.bones={},i.slots={},i.constraints={},i.skins={},i.animations={},i.canvas=null,i.userData=null,i}return r(i,t),i.toString=function(){return"[class dragonBones.ArmatureData]"},i.prototype._onClear=function(){for(var i,u,n,t=0,r=this.defaultActions;t<r.length;t++)r[t].returnToPool();for(i=0,u=this.actions;i<u.length;i++)u[i].returnToPool();for(n in this.bones)this.bones[n].returnToPool(),delete this.bones[n];for(n in this.slots)this.slots[n].returnToPool(),delete this.slots[n];for(n in this.constraints)this.constraints[n].returnToPool(),delete this.constraints[n];for(n in this.skins)this.skins[n].returnToPool(),delete this.skins[n];for(n in this.animations)this.animations[n].returnToPool(),delete this.animations[n];null!==this.canvas&&this.canvas.returnToPool();null!==this.userData&&this.userData.returnToPool();this.type=0;this.frameRate=0;this.cacheFrameRate=0;this.scale=1;this.name="";this.aabb.clear();this.animationNames.length=0;this.sortedBones.length=0;this.sortedSlots.length=0;this.defaultActions.length=0;this.actions.length=0;this.defaultSkin=null;this.defaultAnimation=null;this.canvas=null;this.userData=null;this.parent=null},i.prototype.sortBones=function(){var t=this.sortedBones.length,n,r,e,u;if(!(t<=0)){var o=this.sortedBones.concat(),i=0,f=0;for(this.sortedBones.length=0;f<t;)if(n=o[i++],i>=t&&(i=0),!(this.sortedBones.indexOf(n)>=0)){r=!1;for(e in this.constraints)if(u=this.constraints[e],u.root===n&&this.sortedBones.indexOf(u.target)<0){r=!0;break}r||null!==n.parent&&this.sortedBones.indexOf(n.parent)<0||(this.sortedBones.push(n),f++)}}},i.prototype.cacheFrames=function(n){if(!(this.cacheFrameRate>0))for(var t in this.cacheFrameRate=n,this.animations)this.animations[t].cacheFrames(this.cacheFrameRate)},i.prototype.setCacheFrame=function(n,t){var i=this.parent.cachedFrames,r=i.length;return i.length+=10,i[r]=n.a,i[r+1]=n.b,i[r+2]=n.c,i[r+3]=n.d,i[r+4]=n.tx,i[r+5]=n.ty,i[r+6]=t.rotation,i[r+7]=t.skew,i[r+8]=t.scaleX,i[r+9]=t.scaleY,r},i.prototype.getCacheFrame=function(n,t,i){var r=this.parent.cachedFrames;n.a=r[i];n.b=r[i+1];n.c=r[i+2];n.d=r[i+3];n.tx=r[i+4];n.ty=r[i+5];t.rotation=r[i+6];t.skew=r[i+7];t.scaleX=r[i+8];t.scaleY=r[i+9];t.x=n.tx;t.y=n.ty},i.prototype.addBone=function(n){n.name in this.bones?console.warn("Same bone: "+n.name):(this.bones[n.name]=n,this.sortedBones.push(n))},i.prototype.addSlot=function(n){n.name in this.slots?console.warn("Same slot: "+n.name):(this.slots[n.name]=n,this.sortedSlots.push(n))},i.prototype.addConstraint=function(n){n.name in this.constraints?console.warn("Same constraint: "+n.name):this.constraints[n.name]=n},i.prototype.addSkin=function(n){n.name in this.skins?console.warn("Same skin: "+n.name):(n.parent=this,this.skins[n.name]=n,null===this.defaultSkin&&(this.defaultSkin=n),"default"===n.name&&(this.defaultSkin=n))},i.prototype.addAnimation=function(n){n.name in this.animations?console.warn("Same animation: "+n.name):(n.parent=this,this.animations[n.name]=n,this.animationNames.push(n.name),null===this.defaultAnimation&&(this.defaultAnimation=n))},i.prototype.addAction=function(n,t){t?this.defaultActions.push(n):this.actions.push(n)},i.prototype.getBone=function(n){return n in this.bones?this.bones[n]:null},i.prototype.getSlot=function(n){return n in this.slots?this.slots[n]:null},i.prototype.getConstraint=function(n){return n in this.constraints?this.constraints[n]:null},i.prototype.getSkin=function(n){return n in this.skins?this.skins[n]:null},i.prototype.getMesh=function(n,t,i){var r=this.getSkin(n);return null===r?null:r.getDisplay(t,i)},i.prototype.getAnimation=function(n){return n in this.animations?this.animations[n]:null},i}(n.BaseObject),t,i,u;n.ArmatureData=f;t=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.transform=new n.Transform,i.userData=null,i}return r(i,t),i.toString=function(){return"[class dragonBones.BoneData]"},i.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool();this.inheritTranslation=!1;this.inheritRotation=!1;this.inheritScale=!1;this.inheritReflection=!1;this.type=0;this.length=0;this.name="";this.transform.identity();this.userData=null;this.parent=null},i}(n.BaseObject);n.BoneData=t;i=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.vertices=[],t}return r(t,n),t.toString=function(){return"[class dragonBones.SurfaceData]"},t.prototype._onClear=function(){n.prototype._onClear.call(this);this.type=1;this.segmentX=0;this.segmentY=0;this.vertices.length=0},t}(t);n.SurfaceData=i;u=function(t){function i(){var n=null!==t&&t.apply(this,arguments)||this;return n.color=null,n.userData=null,n}return r(i,t),i.createColor=function(){return new n.ColorTransform},i.toString=function(){return"[class dragonBones.SlotData]"},i.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool();this.blendMode=0;this.displayIndex=0;this.zOrder=0;this.name="";this.color=null;this.userData=null;this.parent=null},i.DEFAULT_COLOR=new n.ColorTransform,i}(n.BaseObject);n.SlotData=u}(i||(i={})),function(n){var t=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return r(t,n),t.prototype._onClear=function(){this.order=0;this.name="";this.type=0;this.target=null;this.root=null;this.bone=null},t}(n.BaseObject),i,u;n.ConstraintData=t;i=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return r(t,n),t.toString=function(){return"[class dragonBones.IKConstraintData]"},t.prototype._onClear=function(){n.prototype._onClear.call(this);this.scaleEnabled=!1;this.bendPositive=!1;this.weight=1},t}(t);n.IKConstraintData=i;u=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.bones=[],t}return r(t,n),t.toString=function(){return"[class dragonBones.PathConstraintData]"},t.prototype._onClear=function(){n.prototype._onClear.call(this);this.pathSlot=null;this.pathDisplayData=null;this.bones.length=0;this.positionMode=0;this.spacingMode=1;this.rotateMode=1;this.position=0;this.spacing=0;this.rotateOffset=0;this.rotateMix=0;this.translateMix=0},t.prototype.AddBone=function(n){this.bones.push(n)},t}(t);n.PathConstraintData=u}(i||(i={})),function(n){var t=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return r(t,n),t.toString=function(){return"[class dragonBones.CanvasData]"},t.prototype._onClear=function(){this.hasBackground=!1;this.color=0;this.x=0;this.y=0;this.width=0;this.height=0},t}(n.BaseObject);n.CanvasData=t}(i||(i={})),function(n){var t=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.displays={},t}return r(t,n),t.toString=function(){return"[class dragonBones.SkinData]"},t.prototype._onClear=function(){var t,n,i,r;for(t in this.displays){for(n=0,i=this.displays[t];n<i.length;n++)r=i[n],null!==r&&r.returnToPool();delete this.displays[t]}this.name="";this.parent=null},t.prototype.addDisplay=function(n,t){n in this.displays||(this.displays[n]=[]);null!==t&&(t.parent=this);this.displays[n].push(t)},t.prototype.getDisplay=function(n,t){var f=this.getDisplays(n),i,u,r;if(null!==f)for(i=0,u=f;i<u.length;i++)if(r=u[i],null!==r&&r.name===t)return r;return null},t.prototype.getDisplays=function(n){return n in this.displays?this.displays[n]:null},t}(n.BaseObject);n.SkinData=t}(i||(i={})),function(n){var i=function(){function n(){this.weight=null}return n.prototype.clear=function(){this.isShared||null===this.weight||this.weight.returnToPool();this.isShared=!1;this.inheritDeform=!1;this.offset=0;this.data=null;this.weight=null},n.prototype.shareFrom=function(n){this.isShared=!0;this.offset=n.offset;this.weight=n.weight},n}(),t,u,f,e,o,s,h;n.VerticesData=i;t=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.transform=new n.Transform,i}return r(i,t),i.prototype._onClear=function(){this.name="";this.path="";this.transform.identity();this.parent=null},i}(n.BaseObject);n.DisplayData=t;u=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.pivot=new n.Point,i}return r(i,t),i.toString=function(){return"[class dragonBones.ImageDisplayData]"},i.prototype._onClear=function(){t.prototype._onClear.call(this);this.type=0;this.pivot.clear();this.texture=null},i}(t);n.ImageDisplayData=u;f=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.actions=[],t}return r(t,n),t.toString=function(){return"[class dragonBones.ArmatureDisplayData]"},t.prototype._onClear=function(){n.prototype._onClear.call(this);for(var t=0,i=this.actions;t<i.length;t++)i[t].returnToPool();this.type=1;this.inheritAnimation=!1;this.actions.length=0;this.armature=null},t.prototype.addAction=function(n){this.actions.push(n)},t}(t);n.ArmatureDisplayData=f;e=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.vertices=new i,t}return r(t,n),t.toString=function(){return"[class dragonBones.MeshDisplayData]"},t.prototype._onClear=function(){n.prototype._onClear.call(this);this.type=2;this.vertices.clear();this.texture=null},t}(t);n.MeshDisplayData=e;o=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.boundingBox=null,t}return r(t,n),t.toString=function(){return"[class dragonBones.BoundingBoxDisplayData]"},t.prototype._onClear=function(){n.prototype._onClear.call(this);null!==this.boundingBox&&this.boundingBox.returnToPool();this.type=3;this.boundingBox=null},t}(t);n.BoundingBoxDisplayData=o;s=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.vertices=new i,t.curveLengths=[],t}return r(t,n),t.toString=function(){return"[class dragonBones.PathDisplayData]"},t.prototype._onClear=function(){n.prototype._onClear.call(this);this.type=4;this.closed=!1;this.constantSpeed=!1;this.vertices.clear();this.curveLengths.length=0},t}(t);n.PathDisplayData=s;h=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.bones=[],t}return r(t,n),t.toString=function(){return"[class dragonBones.WeightData]"},t.prototype._onClear=function(){this.count=0;this.offset=0;this.bones.length=0},t.prototype.addBone=function(n){this.bones.push(n)},t}(n.BaseObject);n.WeightData=h}(i||(i={})),function(n){var t=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return r(t,n),t.prototype._onClear=function(){this.color=0;this.width=0;this.height=0},t}(n.BaseObject),i,u,f;n.BoundingBoxData=t;i=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return r(t,n),t.toString=function(){return"[class dragonBones.RectangleBoundingBoxData]"},t._computeOutCode=function(n,t,i,r,u,f){var e=0;return n<i?e|=1:n>u&&(e|=2),t<r?e|=4:t>f&&(e|=8),e},t.rectangleIntersectsSegment=function(n,i,r,u,f,e,o,s,h,c,l){var d,g;if(void 0===h&&(h=null),void 0===c&&(c=null),void 0===l&&(l=null),d=n>f&&n<o&&i>e&&i<s,g=r>f&&r<o&&u>e&&u<s,d&&g)return-1;for(var a=0,v=t._computeOutCode(n,i,f,e,o,s),k=t._computeOutCode(r,u,f,e,o,s);;){if(0==(v|k)){a=2;break}if(0!=(v&k))break;var y=0,p=0,w=0,b=0!==v?v:k;0!=(4&b)?(y=n+(r-n)*(e-i)/(u-i),p=e,null!==l&&(w=.5*-Math.PI)):0!=(8&b)?(y=n+(r-n)*(s-i)/(u-i),p=s,null!==l&&(w=.5*Math.PI)):0!=(2&b)?(p=i+(u-i)*(o-n)/(r-n),y=o,null!==l&&(w=0)):0!=(1&b)&&(p=i+(u-i)*(f-n)/(r-n),y=f,null!==l&&(w=Math.PI));b===v?(n=y,i=p,v=t._computeOutCode(n,i,f,e,o,s),null!==l&&(l.x=w)):(r=y,u=p,k=t._computeOutCode(r,u,f,e,o,s),null!==l&&(l.y=w))}return a&&(d?(a=2,null!==h&&(h.x=r,h.y=u),null!==c&&(c.x=r,c.y=r),null!==l&&(l.x=l.y+Math.PI)):g?(a=1,null!==h&&(h.x=n,h.y=i),null!==c&&(c.x=n,c.y=i),null!==l&&(l.y=l.x+Math.PI)):(a=3,null!==h&&(h.x=n,h.y=i),null!==c&&(c.x=r,c.y=u))),a},t.prototype._onClear=function(){n.prototype._onClear.call(this);this.type=0},t.prototype.containsPoint=function(n,t){var r=.5*this.width,i;return n>=-r&&n<=r&&(i=.5*this.height,t>=-i&&t<=i)?!0:!1},t.prototype.intersectsSegment=function(n,i,r,u,f,e,o){void 0===f&&(f=null);void 0===e&&(e=null);void 0===o&&(o=null);var s=.5*this.width,h=.5*this.height;return t.rectangleIntersectsSegment(n,i,r,u,-s,-h,s,h,f,e,o)},t}(t);n.RectangleBoundingBoxData=i;u=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return r(t,n),t.toString=function(){return"[class dragonBones.EllipseData]"},t.ellipseIntersectsSegment=function(n,t,i,r,u,f,e,o,s,h,c){void 0===s&&(s=null);void 0===h&&(h=null);void 0===c&&(c=null);var a=e/o,b=a*a,nt=i-n,tt=(r*=a)-(t*=a),k=Math.sqrt(nt*nt+tt*tt),p=nt/k,w=tt/k,d=(u-n)*p+(f-t)*w,l=e*e,it=l-(n*n+t*t)+d*d,g=0;if(it>=0){var rt=Math.sqrt(it),v=d-rt,y=d+rt,ut=v<0?-1:v<=k?0:1,ft=y<0?-1:y<=k?0:1,et=ut*ft;if(et<0)return-1;0===et&&(-1===ut?(g=2,i=n+y*p,r=(t+y*w)/a,null!==s&&(s.x=i,s.y=r),null!==h&&(h.x=i,h.y=r),null!==c&&(c.x=Math.atan2(r/l*b,i/l),c.y=c.x+Math.PI)):1===ft?(g=1,n+=v*p,t=(t+v*w)/a,null!==s&&(s.x=n,s.y=t),null!==h&&(h.x=n,h.y=t),null!==c&&(c.x=Math.atan2(t/l*b,n/l),c.y=c.x+Math.PI)):(g=3,null!==s&&(s.x=n+v*p,s.y=(t+v*w)/a,null!==c&&(c.x=Math.atan2(s.y/l*b,s.x/l))),null!==h&&(h.x=n+y*p,h.y=(t+y*w)/a,null!==c&&(c.y=Math.atan2(h.y/l*b,h.x/l)))))}return g},t.prototype._onClear=function(){n.prototype._onClear.call(this);this.type=1},t.prototype.containsPoint=function(n,t){var i=.5*this.width,r;return n>=-i&&n<=i&&(r=.5*this.height,t>=-r&&t<=r)?(t*=i/r,Math.sqrt(n*n+t*t)<=i):!1},t.prototype.intersectsSegment=function(n,i,r,u,f,e,o){return void 0===f&&(f=null),void 0===e&&(e=null),void 0===o&&(o=null),t.ellipseIntersectsSegment(n,i,r,u,0,0,.5*this.width,.5*this.height,f,e,o)},t}(t);n.EllipseBoundingBoxData=u;f=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.vertices=[],t}return r(t,n),t.toString=function(){return"[class dragonBones.PolygonBoundingBoxData]"},t.polygonIntersectsSegment=function(n,t,i,r,u,f,e,o){var c,l,h,y;void 0===f&&(f=null);void 0===e&&(e=null);void 0===o&&(o=null);n===i&&(n=i+1e-6);t===r&&(t=r+1e-6);for(var nt=u.length,tt=n-i,it=t-r,ft=n*r-t*i,p=0,a=u[nt-2],v=u[nt-1],rt=0,ut=0,w=0,b=0,k=0,d=0,g=0;g<nt;g+=2){c=u[g];l=u[g+1];a===c&&(a=c+.0001);v===l&&(v=l+.0001);var et=a-c,ot=v-l,st=a*l-v*c,ht=tt*ot-it*et,s=(ft*et-tt*st)/ht;if((s>=a&&s<=c||s>=c&&s<=a)&&(0===tt||s>=n&&s<=i||s>=i&&s<=n)&&(h=(ft*ot-it*st)/ht,(h>=v&&h<=l||h>=l&&h<=v)&&(0===it||h>=t&&h<=r||h>=r&&h<=t))){if(null===e){w=s;b=h;k=s;d=h;p++;null!==o&&(o.x=Math.atan2(l-v,c-a)-.5*Math.PI,o.y=o.x);break}y=s-n;y<0&&(y=-y);0===p?(rt=y,ut=y,w=s,b=h,k=s,d=h,null!==o&&(o.x=Math.atan2(l-v,c-a)-.5*Math.PI,o.y=o.x)):(y<rt&&(rt=y,w=s,b=h,null!==o&&(o.x=Math.atan2(l-v,c-a)-.5*Math.PI)),y>ut&&(ut=y,k=s,d=h,null!==o&&(o.y=Math.atan2(l-v,c-a)-.5*Math.PI)));p++}a=c;v=l}return 1===p?(null!==f&&(f.x=w,f.y=b),null!==e&&(e.x=w,e.y=b),null!==o&&(o.y=o.x+Math.PI)):p>1&&(p++,null!==f&&(f.x=w,f.y=b),null!==e&&(e.x=k,e.y=d)),p},t.prototype._onClear=function(){n.prototype._onClear.call(this);this.type=2;this.x=0;this.y=0;this.vertices.length=0},t.prototype.containsPoint=function(n,t){var f=!1,u,r,h,o;if(n>=this.x&&n<=this.width&&t>=this.y&&t<=this.height)for(var i=0,s=this.vertices.length,e=s-2;i<s;i+=2)u=this.vertices[e+1],r=this.vertices[i+1],(r<t&&u>=t||u<t&&r>=t)&&(h=this.vertices[e],o=this.vertices[i],(t-r)*(h-o)/(u-r)+o<n&&(f=!f)),e=i;return f},t.prototype.intersectsSegment=function(n,r,u,f,e,o,s){void 0===e&&(e=null);void 0===o&&(o=null);void 0===s&&(s=null);var h=0;return 0!==i.rectangleIntersectsSegment(n,r,u,f,this.x,this.y,this.x+this.width,this.y+this.height,null,null,null)&&(h=t.polygonIntersectsSegment(n,r,u,f,this.vertices,e,o,s)),h},t}(t);n.PolygonBoundingBoxData=f}(i||(i={})),function(n){var i=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.cachedFrames=[],t.boneTimelines={},t.surfaceTimelines={},t.slotTimelines={},t.constraintTimelines={},t.animationTimelines={},t.boneCachedFrameIndices={},t.slotCachedFrameIndices={},t.actionTimeline=null,t.zOrderTimeline=null,t}return r(t,n),t.toString=function(){return"[class dragonBones.AnimationData]"},t.prototype._onClear=function(){var t,e,i,o,r,s,u,h,f,c;for(var n in this.boneTimelines){for(t=0,e=this.boneTimelines[n];t<e.length;t++)e[t].returnToPool();delete this.boneTimelines[n]}for(n in this.surfaceTimelines){for(i=0,o=this.surfaceTimelines[n];i<o.length;i++)o[i].returnToPool();delete this.surfaceTimelines[n]}for(n in this.slotTimelines){for(r=0,s=this.slotTimelines[n];r<s.length;r++)s[r].returnToPool();delete this.slotTimelines[n]}for(n in this.constraintTimelines){for(u=0,h=this.constraintTimelines[n];u<h.length;u++)h[u].returnToPool();delete this.constraintTimelines[n]}for(n in this.animationTimelines){for(f=0,c=this.animationTimelines[n];f<c.length;f++)c[f].returnToPool();delete this.animationTimelines[n]}for(n in this.boneCachedFrameIndices)delete this.boneCachedFrameIndices[n];for(n in this.slotCachedFrameIndices)delete this.slotCachedFrameIndices[n];null!==this.actionTimeline&&this.actionTimeline.returnToPool();null!==this.zOrderTimeline&&this.zOrderTimeline.returnToPool();this.frameIntOffset=0;this.frameFloatOffset=0;this.frameOffset=0;this.frameCount=0;this.playTimes=0;this.duration=0;this.scale=1;this.fadeInTime=0;this.cacheFrameRate=0;this.name="";this.cachedFrames.length=0;this.actionTimeline=null;this.zOrderTimeline=null;this.parent=null},t.prototype.cacheFrames=function(n){var u,t,i,f,o,h,e,s,r,c;if(!(this.cacheFrameRate>0)){for(this.cacheFrameRate=Math.max(Math.ceil(n*this.scale),1),u=Math.ceil(this.cacheFrameRate*this.duration)+1,this.cachedFrames.length=u,t=0,i=this.cacheFrames.length;t<i;++t)this.cachedFrames[t]=!1;for(f=0,o=this.parent.sortedBones;f<o.length;f++){for(h=o[f],t=0,i=(r=new Array(u)).length;t<i;++t)r[t]=-1;this.boneCachedFrameIndices[h.name]=r}for(e=0,s=this.parent.sortedSlots;e<s.length;e++){for(c=s[e],t=0,i=(r=new Array(u)).length;t<i;++t)r[t]=-1;this.slotCachedFrameIndices[c.name]=r}}},t.prototype.addBoneTimeline=function(n,t){var i=n.name in this.boneTimelines?this.boneTimelines[n.name]:this.boneTimelines[n.name]=[];i.indexOf(t)<0&&i.push(t)},t.prototype.addSurfaceTimeline=function(n,t){var i=n.name in this.surfaceTimelines?this.surfaceTimelines[n.name]:this.surfaceTimelines[n.name]=[];i.indexOf(t)<0&&i.push(t)},t.prototype.addSlotTimeline=function(n,t){var i=n.name in this.slotTimelines?this.slotTimelines[n.name]:this.slotTimelines[n.name]=[];i.indexOf(t)<0&&i.push(t)},t.prototype.addConstraintTimeline=function(n,t){var i=n.name in this.constraintTimelines?this.constraintTimelines[n.name]:this.constraintTimelines[n.name]=[];i.indexOf(t)<0&&i.push(t)},t.prototype.addAnimationTimeline=function(n,t){var i=n in this.animationTimelines?this.animationTimelines[n]:this.animationTimelines[n]=[];i.indexOf(t)<0&&i.push(t)},t.prototype.getBoneTimelines=function(n){return n in this.boneTimelines?this.boneTimelines[n]:null},t.prototype.getSurfaceTimelines=function(n){return n in this.surfaceTimelines?this.surfaceTimelines[n]:null},t.prototype.getSlotTimelines=function(n){return n in this.slotTimelines?this.slotTimelines[n]:null},t.prototype.getConstraintTimelines=function(n){return n in this.constraintTimelines?this.constraintTimelines[n]:null},t.prototype.getAnimationTimelines=function(n){return n in this.animationTimelines?this.animationTimelines[n]:null},t.prototype.getBoneCachedFrameIndices=function(n){return n in this.boneCachedFrameIndices?this.boneCachedFrameIndices[n]:null},t.prototype.getSlotCachedFrameIndices=function(n){return n in this.slotCachedFrameIndices?this.slotCachedFrameIndices[n]:null},t}(n.BaseObject),t;n.AnimationData=i;t=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return r(t,n),t.toString=function(){return"[class dragonBones.TimelineData]"},t.prototype._onClear=function(){this.type=10;this.offset=0;this.frameIndicesOffset=-1},t}(n.BaseObject);n.TimelineData=t}(i||(i={})),function(n){var t=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.boneMask=[],t}return r(t,n),t.toString=function(){return"[class dragonBones.AnimationConfig]"},t.prototype._onClear=function(){this.pauseFadeOut=!0;this.fadeOutMode=4;this.fadeOutTweenType=1;this.fadeOutTime=-1;this.actionEnabled=!0;this.additiveBlending=!1;this.displayControl=!0;this.pauseFadeIn=!0;this.resetToPose=!0;this.fadeInTweenType=1;this.playTimes=-1;this.layer=0;this.position=0;this.duration=-1;this.timeScale=-100;this.weight=1;this.fadeInTime=-1;this.autoFadeOutTime=-1;this.name="";this.animation="";this.group="";this.boneMask.length=0},t.prototype.clear=function(){this._onClear()},t.prototype.copyFrom=function(n){this.pauseFadeOut=n.pauseFadeOut;this.fadeOutMode=n.fadeOutMode;this.autoFadeOutTime=n.autoFadeOutTime;this.fadeOutTweenType=n.fadeOutTweenType;this.actionEnabled=n.actionEnabled;this.additiveBlending=n.additiveBlending;this.displayControl=n.displayControl;this.pauseFadeIn=n.pauseFadeIn;this.resetToPose=n.resetToPose;this.playTimes=n.playTimes;this.layer=n.layer;this.position=n.position;this.duration=n.duration;this.timeScale=n.timeScale;this.fadeInTime=n.fadeInTime;this.fadeOutTime=n.fadeOutTime;this.fadeInTweenType=n.fadeInTweenType;this.weight=n.weight;this.name=n.name;this.animation=n.animation;this.group=n.group;this.boneMask.length=n.boneMask.length;for(var t=0,i=this.boneMask.length;t<i;++t)this.boneMask[t]=n.boneMask[t]},t.prototype.containsBoneMask=function(n){return 0===this.boneMask.length||this.boneMask.indexOf(n)>=0},t.prototype.addBoneMask=function(n,t,i){var f,r,e,u;if(void 0===i&&(i=!0),f=n.getBone(t),null!==f&&(this.boneMask.indexOf(t)<0&&this.boneMask.push(t),i))for(r=0,e=n.getBones();r<e.length;r++)u=e[r],this.boneMask.indexOf(u.name)<0&&f.contains(u)&&this.boneMask.push(u.name)},t.prototype.removeBoneMask=function(n,t,i){var o,u,f,s,r,h,e,c;if(void 0===i&&(i=!0),o=this.boneMask.indexOf(t),(o>=0&&this.boneMask.splice(o,1),i)&&(u=n.getBone(t),null!==u))if(this.boneMask.length>0)for(f=0,s=n.getBones();f<s.length;f++)r=s[f],h=this.boneMask.indexOf(r.name),h>=0&&u.contains(r)&&this.boneMask.splice(h,1);else for(e=0,c=n.getBones();e<c.length;e++)(r=c[e])!==u&&(u.contains(r)||this.boneMask.push(r.name))},t}(n.BaseObject);n.AnimationConfig=t}(i||(i={})),function(n){var i=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.textures={},t}return r(t,n),t.prototype._onClear=function(){for(var n in this.textures)this.textures[n].returnToPool(),delete this.textures[n];this.autoSearch=!1;this.width=0;this.height=0;this.scale=1;this.name="";this.imagePath=""},t.prototype.copyFrom=function(n){var t,i;for(t in this.autoSearch=n.autoSearch,this.scale=n.scale,this.width=n.width,this.height=n.height,this.name=n.name,this.imagePath=n.imagePath,this.textures)this.textures[t].returnToPool(),delete this.textures[t];for(t in n.textures)i=this.createTexture(),i.copyFrom(n.textures[t]),this.textures[t]=i},t.prototype.addTexture=function(n){n.name in this.textures?console.warn("Same texture: "+n.name):(n.parent=this,this.textures[n.name]=n)},t.prototype.getTexture=function(n){return n in this.textures?this.textures[n]:null},t}(n.BaseObject),t;n.TextureAtlasData=i;t=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.region=new n.Rectangle,i.frame=null,i}return r(i,t),i.createRectangle=function(){return new n.Rectangle},i.prototype._onClear=function(){this.rotated=!1;this.name="";this.region.clear();this.parent=null;this.frame=null},i.prototype.copyFrom=function(n){this.rotated=n.rotated;this.name=n.name;this.region.copyFrom(n.region);this.parent=n.parent;null===this.frame&&null!==n.frame?this.frame=i.createRectangle():null!==this.frame&&null===n.frame&&(this.frame=null);null!==this.frame&&null!==n.frame&&this.frame.copyFrom(n.frame)},i}(n.BaseObject);n.TextureData=t}(i||(i={})),function(n){var t=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.vertices=[],t.bones=[],t}return r(t,n),t.toString=function(){return"[class dragonBones.DeformVertices]"},t.prototype._onClear=function(){this.verticesDirty=!1;this.vertices.length=0;this.bones.length=0;this.verticesData=null},t.prototype.init=function(n,t){var u,i,r,f;if(this.verticesData=n,null!==this.verticesData){for(u=null!==this.verticesData.weight?2*this.verticesData.weight.count:2*this.verticesData.data.intArray[this.verticesData.offset+0],this.verticesDirty=!0,this.vertices.length=u,this.bones.length=0,i=0,r=this.vertices.length;i<r;++i)this.vertices[i]=0;if(null!==this.verticesData.weight)for(i=0,r=this.verticesData.weight.bones.length;i<r;++i)f=t.getBone(this.verticesData.weight.bones[i].name),this.bones.push(f)}else this.verticesDirty=!1,this.vertices.length=0,this.bones.length=0,this.verticesData=null},t.prototype.isBonesUpdate=function(){for(var i,n=0,t=this.bones;n<t.length;n++)if(i=t[n],null!==i&&i._childrenTransformDirty)return!0;return!1},t}(n.BaseObject);n.DeformVertices=t}(i||(i={}));f=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t._bones=[],t._slots=[],t._constraints=[],t._actions=[],t._animation=null,t._proxy=null,t._replaceTextureAtlasData=null,t._clock=null,t}return r(t,n),t.toString=function(){return"[class dragonBones.Armature]"},t._onSortSlots=function(n,t){return n._zOrder>t._zOrder?1:-1},t.prototype._onClear=function(){var n,u,t,f,i,e,r,o;for(null!==this._clock&&this._clock.remove(this),n=0,u=this._bones;n<u.length;n++)u[n].returnToPool();for(t=0,f=this._slots;t<f.length;t++)f[t].returnToPool();for(i=0,e=this._constraints;i<e.length;i++)e[i].returnToPool();for(r=0,o=this._actions;r<o.length;r++)o[r].returnToPool();null!==this._animation&&this._animation.returnToPool();null!==this._proxy&&this._proxy.dbClear();null!==this._replaceTextureAtlasData&&this._replaceTextureAtlasData.returnToPool();this.inheritAnimation=!0;this.userData=null;this._lockUpdate=!1;this._slotsDirty=!0;this._zOrderDirty=!1;this._flipX=!1;this._flipY=!1;this._cacheFrameIndex=-1;this._bones.length=0;this._slots.length=0;this._constraints.length=0;this._actions.length=0;this._armatureData=null;this._animation=null;this._proxy=null;this._display=null;this._replaceTextureAtlasData=null;this._replacedTexture=null;this._dragonBones=null;this._clock=null;this._parent=null},t.prototype._sortZOrder=function(n,t){var o=this._armatureData.sortedSlots,u=null===n,i,f,r,s,e;if(this._zOrderDirty||!u){for(i=0,f=o.length;i<f;++i)r=u?i:n[t+i],r<0||r>=f||(s=o[r],e=this.getSlot(s.name),null!==e&&e._setZorder(i));this._slotsDirty=!0;this._zOrderDirty=!u}},t.prototype._addBone=function(n){this._bones.indexOf(n)<0&&this._bones.push(n)},t.prototype._addSlot=function(n){this._slots.indexOf(n)<0&&this._slots.push(n)},t.prototype._addConstraint=function(n){this._constraints.indexOf(n)<0&&this._constraints.push(n)},t.prototype._bufferAction=function(n,t){this._actions.indexOf(n)<0&&(t?this._actions.push(n):this._actions.unshift(n))},t.prototype.dispose=function(){null!==this._armatureData&&(this._lockUpdate=!0,this._dragonBones.bufferObject(this))},t.prototype.init=function(n,t,i,r){null===this._armatureData&&(this._armatureData=n,this._animation=u.BaseObject.borrowObject(u.Animation),this._proxy=t,this._display=i,this._dragonBones=r,this._proxy.dbInit(this),this._animation.init(this),this._animation.animations=this._armatureData.animations)},t.prototype.advanceTime=function(n){var a,i,f,e,h,r,u,o,c,s,l;if(!this._lockUpdate)if(null!==this._armatureData)if(null!==this._armatureData.parent){if(a=this._cacheFrameIndex,this._animation.advanceTime(n),this._slotsDirty&&(this._slotsDirty=!1,this._slots.sort(t._onSortSlots)),this._cacheFrameIndex<0||this._cacheFrameIndex!==a){for(i=0,f=0,i=0,f=this._bones.length;i<f;++i)this._bones[i].update(this._cacheFrameIndex);for(i=0,f=this._slots.length;i<f;++i)this._slots[i].update(this._cacheFrameIndex)}if(this._actions.length>0){for(this._lockUpdate=!0,e=0,h=this._actions;e<h.length;e++){if(r=h[e],u=r.actionData,null!==u&&0===u.type)if(null!==r.slot)null!==(s=r.slot.childArmature)&&s.animation.fadeIn(u.name);else if(null!==r.bone)for(o=0,c=this.getSlots();o<c.length;o++)l=c[o],l.parent===r.bone&&null!==(s=l.childArmature)&&s.animation.fadeIn(u.name);else this._animation.fadeIn(u.name);r.returnToPool()}this._actions.length=0;this._lockUpdate=!1}this._proxy.dbUpdate()}else console.warn("The armature data has been disposed.\nPlease make sure dispose armature before call factory.clear().");else console.warn("The armature has been disposed.")},t.prototype.invalidUpdate=function(n,t){var i,e,r,o,u,f,s,h;if(void 0===n&&(n=null),void 0===t&&(t=!1),null!==n&&n.length>0){if(null!==(u=this.getBone(n))&&(u.invalidUpdate(),t))for(i=0,e=this._slots;i<e.length;i++)(h=e[i]).parent===u&&h.invalidUpdate()}else{for(r=0,o=this._bones;r<o.length;r++)(u=o[r]).invalidUpdate();if(t)for(f=0,s=this._slots;f<s.length;f++)(h=s[f]).invalidUpdate()}},t.prototype.containsPoint=function(n,t){for(var u,i=0,r=this._slots;i<r.length;i++)if(u=r[i],u.containsPoint(n,t))return u;return null},t.prototype.intersectsSegment=function(n,t,i,r,u,f,e){var h,o;void 0===u&&(u=null);void 0===f&&(f=null);void 0===e&&(e=null);for(var nt=n===i,a=0,v=0,y=0,p=0,w=0,b=0,k=0,d=0,s=null,c=null,l=0,g=this._slots;l<g.length;l++)if(h=g[l],h.intersectsSegment(n,t,i,r,u,f,e)>0){if(null===u&&null===f){s=h;break}null!==u&&((o=nt?u.y-t:u.x-n)<0&&(o=-o),(null===s||o<a)&&(a=o,y=u.x,p=u.y,s=h,e&&(k=e.x)));null!==f&&((o=f.x-n)<0&&(o=-o),(null===c||o>v)&&(v=o,w=f.x,b=f.y,c=h,null!==e&&(d=e.y)))}return null!==s&&null!==u&&(u.x=y,u.y=p,null!==e&&(e.x=k)),null!==c&&null!==f&&(f.x=w,f.y=b,null!==e&&(e.y=d)),s},t.prototype.getBone=function(n){for(var r,t=0,i=this._bones;t<i.length;t++)if(r=i[t],r.name===n)return r;return null},t.prototype.getBoneByDisplay=function(n){var t=this.getSlotByDisplay(n);return null!==t?t.parent:null},t.prototype.getSlot=function(n){for(var r,t=0,i=this._slots;t<i.length;t++)if(r=i[t],r.name===n)return r;return null},t.prototype.getSlotByDisplay=function(n){var t,i,r;if(null!==n)for(t=0,i=this._slots;t<i.length;t++)if(r=i[t],r.display===n)return r;return null},t.prototype.getBones=function(){return this._bones},t.prototype.getSlots=function(){return this._slots},Object.defineProperty(t.prototype,"flipX",{get:function(){return this._flipX},set:function(n){this._flipX!==n&&(this._flipX=n,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"flipY",{get:function(){return this._flipY},set:function(n){this._flipY!==n&&(this._flipY=n,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cacheFrameRate",{get:function(){return this._armatureData.cacheFrameRate},set:function(n){var t,i,r;if(this._armatureData.cacheFrameRate!==n)for(this._armatureData.cacheFrames(n),t=0,i=this._slots;t<i.length;t++)r=i[t].childArmature,null!==r&&(r.cacheFrameRate=n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._armatureData.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"armatureData",{get:function(){return this._armatureData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"proxy",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eventDispatcher",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"display",{get:function(){return this._display},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"replacedTexture",{get:function(){return this._replacedTexture},set:function(n){var t,i,r;if(this._replacedTexture!==n)for(null!==this._replaceTextureAtlasData&&(this._replaceTextureAtlasData.returnToPool(),this._replaceTextureAtlasData=null),this._replacedTexture=n,t=0,i=this._slots;t<i.length;t++)r=i[t],r.invalidUpdate(),r.update(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clock",{get:function(){return this._clock},set:function(n){var t,i,r;if(this._clock!==n)for(null!==this._clock&&this._clock.remove(this),this._clock=n,this._clock&&this._clock.add(this),t=0,i=this._slots;t<i.length;t++)r=i[t].childArmature,null!==r&&(r.clock=this._clock)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),t.prototype.replaceTexture=function(n){this.replacedTexture=n},t.prototype.hasEventListener=function(n){return this._proxy.hasDBEventListener(n)},t.prototype.addEventListener=function(n,t,i){this._proxy.addDBEventListener(n,t,i)},t.prototype.removeEventListener=function(n,t,i){this._proxy.removeDBEventListener(n,t,i)},t.prototype.enableAnimationCache=function(n){console.warn("Deprecated.");this.cacheFrameRate=n},t.prototype.getDisplay=function(){return this._display},t}((u=i||(i={})).BaseObject);u.Armature=f,function(n){var t=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.globalTransformMatrix=new n.Matrix,i.global=new n.Transform,i.offset=new n.Transform,i}return r(i,t),i.prototype._onClear=function(){this.globalTransformMatrix.identity();this.global.identity();this.offset.identity();this.origin=null;this.userData=null;this._globalDirty=!1;this._armature=null},i.prototype.updateGlobalTransform=function(){this._globalDirty&&(this._globalDirty=!1,this.global.fromMatrix(this.globalTransformMatrix))},Object.defineProperty(i.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),i._helpMatrix=new n.Matrix,i._helpTransform=new n.Transform,i._helpPoint=new n.Point,i}(n.BaseObject);n.TransformObject=t}(i||(i={})),function(n){var t=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.animationPose=new n.Transform,i._blendState=new n.BlendState,i}return r(i,t),i.toString=function(){return"[class dragonBones.Bone]"},i.prototype._onClear=function(){t.prototype._onClear.call(this);this.offsetMode=1;this.animationPose.identity();this._transformDirty=!1;this._childrenTransformDirty=!1;this._localDirty=!0;this._hasConstraint=!1;this._visible=!0;this._cachedFrameIndex=-1;this._blendState.clear();this._boneData=null;this._parent=null;this._cachedFrameIndices=null},i.prototype._updateGlobalTransformMatrix=function(t){var a=this._boneData,i=this.global,c=this.globalTransformMatrix,u=this.origin,o=this.offset,f=this.animationPose,r=this._parent,s=this._armature.flipX,l=this._armature.flipY===n.DragonBones.yDown,p=null!==r,h=0,e,v,y;(1===this.offsetMode?null!==u?(i.x=u.x+o.x+f.x,i.scaleX=u.scaleX*o.scaleX*f.scaleX,i.scaleY=u.scaleY*o.scaleY*f.scaleY,n.DragonBones.yDown?(i.y=u.y+o.y+f.y,i.skew=u.skew+o.skew+f.skew,i.rotation=u.rotation+o.rotation+f.rotation):(i.y=u.y-o.y+f.y,i.skew=u.skew-o.skew+f.skew,i.rotation=u.rotation-o.rotation+f.rotation)):(i.copyFrom(o),n.DragonBones.yDown||(i.y=-i.y,i.skew=-i.skew,i.rotation=-i.rotation),i.add(f)):0===this.offsetMode?null!==u?i.copyFrom(u).add(f):i.copyFrom(f):(p=!1,i.copyFrom(o),n.DragonBones.yDown||(i.y=-i.y,i.skew=-i.skew,i.rotation=-i.rotation)),p)?(e=0===r._boneData.type?r.globalTransformMatrix:r._getGlobalTransformMatrix(i.x,i.y),a.inheritScale?(a.inheritRotation||(r.updateGlobalTransform(),h=s&&l?i.rotation-(r.global.rotation+Math.PI):s?i.rotation+r.global.rotation+Math.PI:l?i.rotation+r.global.rotation:i.rotation-r.global.rotation,i.rotation=h),i.toMatrix(c),c.concat(e),a.inheritTranslation?(i.x=c.tx,i.y=c.ty):(c.tx=i.x,c.ty=i.y),t?i.fromMatrix(c):this._globalDirty=!0):(a.inheritTranslation?(v=i.x,y=i.y,i.x=e.a*v+e.c*y+e.tx,i.y=e.b*v+e.d*y+e.ty):(s&&(i.x=-i.x),l&&(i.y=-i.y)),a.inheritRotation?(r.updateGlobalTransform(),h=r.global.scaleX<0?i.rotation+r.global.rotation+Math.PI:i.rotation+r.global.rotation,e.a*e.d-e.b*e.c<0&&(h-=2*i.rotation,(s!==l||a.inheritReflection)&&(i.skew+=Math.PI),n.DragonBones.yDown||(i.skew=-i.skew)),i.rotation=h):(s||l)&&(s&&l?h=i.rotation+Math.PI:(h=s?Math.PI-i.rotation:-i.rotation,i.skew+=Math.PI),i.rotation=h),i.toMatrix(c))):((s||l)&&(s&&(i.x=-i.x),l&&(i.y=-i.y),s&&l?h=i.rotation+Math.PI:(h=s?Math.PI-i.rotation:-i.rotation,i.skew+=Math.PI),i.rotation=h),i.toMatrix(c))},i.prototype.init=function(n,t){null===this._boneData&&(this._boneData=n,this._armature=t,null!==this._boneData.parent&&(this._parent=this._armature.getBone(this._boneData.parent.name)),this._armature._addBone(this),this.origin=this._boneData.transform)},i.prototype.update=function(n){var t,i,f,r,e,u,o;if(this._blendState.dirty=!1,n>=0&&null!==this._cachedFrameIndices)if(t=this._cachedFrameIndices[n],t>=0&&this._cachedFrameIndex===t)this._transformDirty=!1;else if(t>=0)this._transformDirty=!0,this._cachedFrameIndex=t;else{if(this._hasConstraint)for(i=0,f=this._armature._constraints;i<f.length;i++)(u=f[i])._root===this&&u.update();this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[n]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}else{if(this._hasConstraint)for(r=0,e=this._armature._constraints;r<e.length;r++)(u=e[r])._root===this&&u.update();(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(n=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}this._transformDirty?(this._transformDirty=!1,this._childrenTransformDirty=!0,this._cachedFrameIndex<0)?(o=n>=0,this._localDirty&&this._updateGlobalTransformMatrix(o),o&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[n]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))):this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex):this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},i.prototype.updateByConstraint=function(){this._localDirty&&(this._localDirty=!1,(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&this._updateGlobalTransformMatrix(!0),this._transformDirty=!0)},i.prototype.invalidUpdate=function(){this._transformDirty=!0},i.prototype.contains=function(n){if(n===this)return!1;for(var t=n;t!==this&&null!==t;)t=t.parent;return t===this},Object.defineProperty(i.prototype,"boneData",{get:function(){return this._boneData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){return this._visible},set:function(n){var t,i,r;if(this._visible!==n)for(this._visible=n,t=0,i=this._armature.getSlots();t<i.length;t++)r=i[t],r.parent===this&&r._updateVisible()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._boneData.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),i.prototype.getBones=function(){var t;console.warn("Deprecated.");for(var i=[],n=0,r=this._armature.getBones();n<r.length;n++)t=r[n],t.parent===this&&i.push(t);return i},i.prototype.getSlots=function(){var t;console.warn("Deprecated.");for(var i=[],n=0,r=this._armature.getSlots();n<r.length;n++)t=r[n],t.parent===this&&i.push(t);return i},Object.defineProperty(i.prototype,"slot",{get:function(){var n,t,i;for(console.warn("Deprecated."),n=0,t=this._armature.getSlots();n<t.length;n++)if(i=t[n],i.parent===this)return i;return null},enumerable:!0,configurable:!0}),i}(n.TransformObject);n.Bone=t}(i||(i={})),function(n){var t=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t._vertices=[],t._deformVertices=[],t._hullCache=[],t._matrixCahce=[],t}return r(t,n),t.toString=function(){return"[class dragonBones.Surface]"},t.prototype._onClear=function(){n.prototype._onClear.call(this);this._dX=0;this._dY=0;this._k=0;this._kX=0;this._kY=0;this._vertices.length=0;this._deformVertices.length=0;this._matrixCahce.length=0;this._hullCache.length=0},t.prototype._getAffineTransform=function(n,t,i,r,u,f,e,o,s,h,c,l,a){var v=e-u,y=o-f,p=s-u,w=h-f;c.rotation=Math.atan2(y,v);c.skew=Math.atan2(w,p)-.5*Math.PI-c.rotation;a&&(c.rotation+=Math.PI);c.scaleX=Math.sqrt(v*v+y*y)/i;c.scaleY=Math.sqrt(p*p+w*w)/r;c.toMatrix(l);c.x=l.tx=u-(l.a*n+l.c*t);c.y=l.ty=f-(l.b*n+l.d*t)},t.prototype._updateVertices=function(){var t=this._boneData.vertices,r=this._vertices,u=this._deformVertices,n,f,i;if(null!==this._parent)if(1===this._parent._boneData.type)for(n=0,f=t.length;n<f;n+=2){var e=t[n]+u[n],o=t[n+1]+u[n],s=this._parent._getGlobalTransformMatrix(e,o);r[n]=s.a*e+s.c*o+s.tx;r[n+1]=s.b*e+s.d*o+s.ty}else for(i=this._parent.globalTransformMatrix,n=0,f=t.length;n<f;n+=2)e=t[n]+u[n],o=t[n+1]+u[n+1],r[n]=i.a*e+i.c*o+i.tx,r[n+1]=i.b*e+i.d*o+i.ty;else for(n=0,f=t.length;n<f;n+=2)r[n]=t[n]+u[n],r[n+1]=t[n+1]+u[n+1]},t.prototype._updateGlobalTransformMatrix=function(){var n=2*this._boneData.segmentX,t=this._vertices.length-2,s=this._vertices[0],h=this._vertices[1],i=this._vertices[n],r=this._vertices[n+1],u=this._vertices[t],f=this._vertices[t+1],e=this._vertices[t-n],o=this._vertices[t-n+1],c=s+.5*(u-s),l=h+.5*(f-h),a=c+.5*(i+.5*(e-i)-c),v=l+.5*(r+.5*(o-r)-l),y=i+.5*(u-i),p=r+.5*(f-r),w=e+.5*(u-e),b=o+.5*(f-o);this._globalDirty=!1;this._getAffineTransform(0,0,200,200,a,v,y,p,w,b,this.global,this.globalTransformMatrix,!1)},t.prototype._getGlobalTransformMatrix=function(n,i){var b=1e3;if(n<-b||b<n||i<-b||b<i)return this.globalTransformMatrix;var k=!1,s=200,rt=this._boneData,d=rt.segmentX,nt=rt.segmentY,h=2*rt.segmentX,a=this._dX,w=this._dY,g=Math.floor((n+s)/a),p=Math.floor((i+s)/w),r=0,tt=g*a-s,it=p*w-s,f=this._matrixCahce,u=t._helpMatrix;if(n<-s){if(i<-s||i>=s)return this.globalTransformMatrix;if(r=7*(2*(d*(nt+1)+2*d+nt+p)+((k=i>this._kX*(n+s)+it)?1:0)),this._matrixCahce[r]>0)u.copyFromArray(f,r+1);else{var e=p*(h+2),v=this._hullCache[4],y=this._hullCache[5],c=this._hullCache[2]-(nt-p)*v,l=this._hullCache[3]-(nt-p)*y,o=this._vertices;k?this._getAffineTransform(-s,it+w,800,w,o[e+h+2],o[e+h+3],c+v,l+y,o[e],o[e+1],t._helpTransform,u,!0):this._getAffineTransform(-b,it,800,w,c,l,o[e],o[e+1],c+v,l+y,t._helpTransform,u,!1);f[r]=1;f[r+1]=u.a;f[r+2]=u.b;f[r+3]=u.c;f[r+4]=u.d;f[r+5]=u.tx;f[r+6]=u.ty}}else if(n>=s){if(i<-s||i>=s)return this.globalTransformMatrix;r=7*(2*(d*(nt+1)+d+p)+((k=i>this._kX*(n-b)+it)?1:0));this._matrixCahce[r]>0?u.copyFromArray(f,r+1):(e=(p+1)*(h+2)-2,v=this._hullCache[4],y=this._hullCache[5],c=this._hullCache[0]+p*v,l=this._hullCache[1]+p*y,o=this._vertices,k?this._getAffineTransform(b,it+w,800,w,c+v,l+y,o[e+h+2],o[e+h+3],c,l,t._helpTransform,u,!0):this._getAffineTransform(s,it,800,w,o[e],o[e+1],c,l,o[e+h+2],o[e+h+3],t._helpTransform,u,!1),f[r]=1,f[r+1]=u.a,f[r+2]=u.b,f[r+3]=u.c,f[r+4]=u.d,f[r+5]=u.tx,f[r+6]=u.ty)}else if(i<-s){if(n<-s||n>=s)return this.globalTransformMatrix;r=7*(d*(nt+1)+2*g+((k=i>this._kY*(n-tt-a)-b)?1:0));this._matrixCahce[r]>0?u.copyFromArray(f,r+1):(e=2*g,v=this._hullCache[10],y=this._hullCache[11],c=this._hullCache[8]+g*v,l=this._hullCache[9]+g*y,o=this._vertices,k?this._getAffineTransform(tt+a,-s,a,800,o[e+2],o[e+3],o[e],o[e+1],c+v,l+y,t._helpTransform,u,!0):this._getAffineTransform(tt,-b,a,800,c,l,c+v,l+y,o[e],o[e+1],t._helpTransform,u,!1),f[r]=1,f[r+1]=u.a,f[r+2]=u.b,f[r+3]=u.c,f[r+4]=u.d,f[r+5]=u.tx,f[r+6]=u.ty)}else if(i>=s){if(n<-s||n>=s)return this.globalTransformMatrix;r=7*(2*(d*(nt+1)+d+nt+p)+((k=i>this._kY*(n-tt-a)+s)?1:0));this._matrixCahce[r]>0?u.copyFromArray(f,r+1):(e=nt*(h+2)+2*g,v=this._hullCache[10],y=this._hullCache[11],c=this._hullCache[6]-(d-g)*v,l=this._hullCache[7]-(d-g)*y,o=this._vertices,k?this._getAffineTransform(tt+a,b,a,800,c+v,l+y,c,l,o[e+2],o[e+3],t._helpTransform,u,!0):this._getAffineTransform(tt,s,a,800,o[e],o[e+1],o[e+2],o[e+3],c,l,t._helpTransform,u,!1),f[r]=1,f[r+1]=u.a,f[r+2]=u.b,f[r+3]=u.c,f[r+4]=u.d,f[r+5]=u.tx,f[r+6]=u.ty)}else r=7*(2*(d*p+g)+((k=i>this._k*(n-tt-a)+it)?1:0)),this._matrixCahce[r]>0?u.copyFromArray(f,r+1):(e=2*g+p*(h+2),o=this._vertices,k?this._getAffineTransform(tt+a,it+w,a,w,o[e+h+4],o[e+h+5],o[e+h+2],o[e+h+3],o[e+2],o[e+3],t._helpTransform,u,!0):this._getAffineTransform(tt,it,a,w,o[e],o[e+1],o[e+2],o[e+3],o[e+h+2],o[e+h+3],t._helpTransform,u,!1),f[r]=1,f[r+1]=u.a,f[r+2]=u.b,f[r+3]=u.c,f[r+4]=u.d,f[r+5]=u.tx,f[r+6]=u.ty);return u},t.prototype.init=function(t,i){var r;if(null===this._boneData){n.prototype.init.call(this,t,i);var u=t.segmentX,f=t.segmentY,e=t.vertices.length;for(this._dX=400/u,this._dY=400/f,this._k=-this._dY/this._dX,this._kX=-this._dY/800,this._kY=-800/this._dX,this._vertices.length=e,this._deformVertices.length=e,this._matrixCahce.length=14*(u*f+2*u+2*f),this._hullCache.length=10,r=0;r<e;++r)this._deformVertices[r]=0}},t.prototype.update=function(n){var r,u,s,f,h,e,o,l,c;if(this._blendState.dirty=!1,n>=0&&null!==this._cachedFrameIndices)if(r=this._cachedFrameIndices[n],r>=0&&this._cachedFrameIndex===r)this._transformDirty=!1;else if(r>=0)this._transformDirty=!0,this._cachedFrameIndex=r;else{if(this._hasConstraint)for(u=0,s=this._armature._constraints;u<s.length;u++)(e=s[u])._root===this&&e.update();this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[n]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}else{if(this._hasConstraint)for(f=0,h=this._armature._constraints;f<h.length;f++)(e=h[f])._root===this&&e.update();(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(n=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty){for(this._transformDirty=!1,this._childrenTransformDirty=!0,o=0,l=this._matrixCahce.length;o<l;o+=7)this._matrixCahce[o]=-1;(this._updateVertices(),this._cachedFrameIndex<0)?(c=n>=0,this._localDirty&&this._updateGlobalTransformMatrix(c),c&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[n]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))):this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);var a=2*this.global.x,v=2*this.global.y,i=t._helpPoint;this.globalTransformMatrix.transformPoint(1e3,-200,i);this._hullCache[0]=i.x;this._hullCache[1]=i.y;this._hullCache[2]=a-i.x;this._hullCache[3]=v-i.y;this.globalTransformMatrix.transformPoint(0,this._dY,i,!0);this._hullCache[4]=i.x;this._hullCache[5]=i.y;this.globalTransformMatrix.transformPoint(200,1e3,i);this._hullCache[6]=i.x;this._hullCache[7]=i.y;this._hullCache[8]=a-i.x;this._hullCache[9]=v-i.y;this.globalTransformMatrix.transformPoint(this._dX,0,i,!0);this._hullCache[10]=i.x;this._hullCache[11]=i.y}else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},t}(n.Bone);n.Surface=t}(i||(i={})),function(n){var t=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i._localMatrix=new n.Matrix,i._colorTransform=new n.ColorTransform,i._displayDatas=[],i._displayList=[],i._deformVertices=null,i._rawDisplay=null,i._meshDisplay=null,i}return r(i,t),i.prototype._onClear=function(){var r,e,i;t.prototype._onClear.call(this);for(var u=[],f=0,o=this._displayList;f<o.length;f++)null!==(i=o[f])&&i!==this._rawDisplay&&i!==this._meshDisplay&&u.indexOf(i)<0&&u.push(i);for(r=0,e=u;r<e.length;r++)(i=e[r])instanceof n.Armature?i.dispose():this._disposeDisplay(i,!0);null!==this._deformVertices&&this._deformVertices.returnToPool();null!==this._meshDisplay&&this._meshDisplay!==this._rawDisplay&&this._disposeDisplay(this._meshDisplay,!1);null!==this._rawDisplay&&this._disposeDisplay(this._rawDisplay,!1);this.displayController=null;this._displayDirty=!1;this._zOrderDirty=!1;this._blendModeDirty=!1;this._colorDirty=!1;this._transformDirty=!1;this._visible=!0;this._blendMode=0;this._displayIndex=-1;this._animationDisplayIndex=-1;this._zOrder=0;this._cachedFrameIndex=-1;this._pivotX=0;this._pivotY=0;this._localMatrix.identity();this._colorTransform.identity();this._displayList.length=0;this._displayDatas.length=0;this._slotData=null;this._rawDisplayDatas=null;this._displayData=null;this._boundingBoxData=null;this._textureData=null;this._deformVertices=null;this._rawDisplay=null;this._meshDisplay=null;this._display=null;this._childArmature=null;this._parent=null;this._cachedFrameIndices=null},i.prototype._getDefaultRawDisplayData=function(n){var i=this._armature._armatureData.defaultSkin,t;return null!==i&&(t=i.getDisplays(this._slotData.name),null!==t)?n<t.length?t[n]:null:null},i.prototype._updateDisplayData=function(){var a=this._displayData,o=null!==this._deformVertices?this._deformVertices.verticesData:null,s=this._textureData,t=null,r=null;if(this._displayData=null,this._boundingBoxData=null,this._textureData=null,this._displayIndex>=0&&(null!==this._rawDisplayDatas&&(t=this._displayIndex<this._rawDisplayDatas.length?this._rawDisplayDatas[this._displayIndex]:null),null===t&&(t=this._getDefaultRawDisplayData(this._displayIndex)),this._displayIndex<this._displayDatas.length&&(this._displayData=this._displayDatas[this._displayIndex])),null!==this._displayData&&(2===this._displayData.type?r=this._displayData.vertices:4===this._displayData.type?r=this._displayData.vertices:null!==t&&(2===t.type?r=t.vertices:4===t.type&&(r=t.vertices)),3===this._displayData.type?this._boundingBoxData=this._displayData.boundingBox:null!==t&&3===t.type&&(this._boundingBoxData=t.boundingBox),0===this._displayData.type?this._textureData=this._displayData.texture:2===this._displayData.type&&(this._textureData=this._displayData.texture)),this._displayData!==a||r!==o||this._textureData!==s){if(null===r&&null!==this._textureData){var h=this._displayData,f=this._textureData.parent.scale*this._armature._armatureData.scale,u=this._textureData.frame;this._pivotX=h.pivot.x;this._pivotY=h.pivot.y;var e=null!==u?u:this._textureData.region,c=e.width,l=e.height;this._textureData.rotated&&null===u&&(c=e.height,l=e.width);this._pivotX*=c*f;this._pivotY*=l*f;null!==u&&(this._pivotX+=u.x*f,this._pivotY+=u.y*f);null!==this._displayData&&null!==t&&this._displayData!==t&&(t.transform.toMatrix(i._helpMatrix),i._helpMatrix.invert(),i._helpMatrix.transformPoint(0,0,i._helpPoint),this._pivotX-=i._helpPoint.x,this._pivotY-=i._helpPoint.y,this._displayData.transform.toMatrix(i._helpMatrix),i._helpMatrix.invert(),i._helpMatrix.transformPoint(0,0,i._helpPoint),this._pivotX+=i._helpPoint.x,this._pivotY+=i._helpPoint.y);n.DragonBones.yDown||(this._pivotY=(this._textureData.rotated?this._textureData.region.width:this._textureData.region.height)*f-this._pivotY)}else this._pivotX=0,this._pivotY=0;this.origin=null!==t?t.transform:null!==this._displayData?this._displayData.transform:null;r!==o?(null===this._deformVertices&&(this._deformVertices=n.BaseObject.borrowObject(n.DeformVertices)),this._deformVertices.init(r,this._armature)):null!==this._deformVertices&&this._textureData!==s&&(this._deformVertices.verticesDirty=!0);this._displayDirty=!0;this._transformDirty=!0}},i.prototype._updateDisplay=function(){var h=null!==this._display?this._display:this._rawDisplay,t=this._childArmature,u,o,i,r,f,s,c,e;if(this._displayIndex>=0&&this._displayIndex<this._displayList.length?(this._display=this._displayList[this._displayIndex],null!==this._display&&this._display instanceof n.Armature?(this._childArmature=this._display,this._display=this._childArmature.display):this._childArmature=null):(this._display=null,this._childArmature=null),u=null!==this._display?this._display:this._rawDisplay,u!==h&&(this._onUpdateDisplay(),this._replaceDisplay(h),this._transformDirty=!0,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0),u!==this._rawDisplay&&u!==this._meshDisplay||this._updateFrame(),this._childArmature!==t&&(null!==t&&(t._parent=null,t.clock=null,t.inheritAnimation&&t.animation.reset()),null!==this._childArmature&&(this._childArmature._parent=this,this._childArmature.clock=this._armature.clock,this._childArmature.inheritAnimation)))if(0===this._childArmature.cacheFrameRate&&(o=this._armature.cacheFrameRate,0!==o&&(this._childArmature.cacheFrameRate=o)),i=null,null!==this._displayData&&1===this._displayData.type?i=this._displayData.actions:this._displayIndex>=0&&null!==this._rawDisplayDatas&&(r=this._displayIndex<this._rawDisplayDatas.length?this._rawDisplayDatas[this._displayIndex]:null,null===r&&(r=this._getDefaultRawDisplayData(this._displayIndex)),null!==r&&1===r.type&&(i=r.actions)),null!==i&&i.length>0)for(f=0,s=i;f<s.length;f++)c=s[f],e=n.BaseObject.borrowObject(n.EventObject),n.EventObject.actionDataToInstance(c,e,this._armature),e.slot=this,this._armature._bufferAction(e,!1);else this._childArmature.animation.play()},i.prototype._updateGlobalTransformMatrix=function(n){var t=0===this._parent._boneData.type?this._parent.globalTransformMatrix:this._parent._getGlobalTransformMatrix(this.global.x,this.global.y);this.globalTransformMatrix.copyFrom(this._localMatrix);this.globalTransformMatrix.concat(t);n?this.global.fromMatrix(this.globalTransformMatrix):this._globalDirty=!0},i.prototype._setDisplayIndex=function(n,t){if(void 0===t&&(t=!1),t){if(this._animationDisplayIndex===n)return!1;this._animationDisplayIndex=n}return this._displayIndex!==n&&(this._displayIndex=n,this._displayDirty=!0,this._updateDisplayData(),this._displayDirty)},i.prototype._setZorder=function(n){return this._zOrder,this._zOrder=n,this._zOrderDirty=!0,this._zOrderDirty},i.prototype._setColor=function(n){return this._colorTransform.copyFrom(n),this._colorDirty=!0,this._colorDirty},i.prototype._setDisplayList=function(t){var r,u,i;if(null!==t&&t.length>0)for(this._displayList.length!==t.length&&(this._displayList.length=t.length),r=0,u=t.length;r<u;++r)i=t[r],null!==i&&i!==this._rawDisplay&&i!==this._meshDisplay&&!(i instanceof n.Armature)&&this._displayList.indexOf(i)<0&&this._initDisplay(i,!0),this._displayList[r]=i;else this._displayList.length>0&&(this._displayList.length=0);return this._displayDirty=this._displayIndex>=0&&this._displayIndex<this._displayList.length?this._display!==this._displayList[this._displayIndex]:null!==this._display,this._updateDisplayData(),this._displayDirty},i.prototype.init=function(n,t,i,r){if(null===this._slotData){this._slotData=n;this._isFromCache=!1;this._visibleDirty=!0;this._blendModeDirty=!0;this._colorDirty=!0;this._blendMode=this._slotData.blendMode;this._zOrder=this._slotData.zOrder;this._colorTransform.copyFrom(this._slotData.color);this._rawDisplay=i;this._meshDisplay=r;this._armature=t;var u=this._armature.getBone(this._slotData.parent.name);null!==u&&(this._parent=u);this._armature._addSlot(this);this._initDisplay(this._rawDisplay,!1);this._rawDisplay!==this._meshDisplay&&this._initDisplay(this._meshDisplay,!1);this._onUpdateDisplay();this._addDisplay()}},i.prototype.update=function(n){var t,i,r,u;if((this._isFromCache=!1,this._displayDirty&&(this._displayDirty=!1,this._updateDisplay(),this._transformDirty&&(null!==this.origin?this.global.copyFrom(this.origin).add(this.offset).toMatrix(this._localMatrix):this.global.copyFrom(this.offset).toMatrix(this._localMatrix))),this._zOrderDirty&&(this._zOrderDirty=!1,this._updateZOrder()),n>=0&&null!==this._cachedFrameIndices)?(t=this._cachedFrameIndices[n],t>=0&&this._cachedFrameIndex===t?this._transformDirty=!1:t>=0?(this._transformDirty=!0,this._cachedFrameIndex=t):this._transformDirty||this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[n]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)):(this._transformDirty||this._parent._childrenTransformDirty)&&(n=-1,this._transformDirty=!0,this._cachedFrameIndex=-1),null!==this._display){if((this._visibleDirty&&(this._visibleDirty=!1,this._updateVisible()),this._blendModeDirty&&(this._blendModeDirty=!1,this._updateBlendMode()),this._colorDirty&&(this._colorDirty=!1,this._updateColor()),null!==this._deformVertices&&null!==this._deformVertices.verticesData&&this._display===this._meshDisplay)&&(i=null!==this._deformVertices.verticesData.weight,r=0!==this._parent._boneData.type,(this._deformVertices.verticesDirty||i&&this._deformVertices.isBonesUpdate()||r&&this._parent._childrenTransformDirty)&&(this._deformVertices.verticesDirty=!1,this._updateMesh()),i||r))return;this._transformDirty&&((this._transformDirty=!1,this._cachedFrameIndex<0)?(u=n>=0,this._updateGlobalTransformMatrix(u),u&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[n]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))):(this._isFromCache=!0,this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex)),this._updateTransform())}},i.prototype.updateTransformAndMatrix=function(){this._transformDirty&&(this._transformDirty=!1,this._updateGlobalTransformMatrix(!1))},i.prototype.replaceDisplayData=function(n,t){if(void 0===t&&(t=-1),t<0&&(t=this._displayIndex<0?0:this._displayIndex),this._displayDatas.length<=t){this._displayDatas.length=t+1;for(var i=0,r=this._displayDatas.length;i<r;++i)this._displayDatas[i]||(this._displayDatas[i]=null)}this._displayDatas[t]=n},i.prototype.containsPoint=function(n,t){return null!==this._boundingBoxData&&(this.updateTransformAndMatrix(),i._helpMatrix.copyFrom(this.globalTransformMatrix),i._helpMatrix.invert(),i._helpMatrix.transformPoint(n,t,i._helpPoint),this._boundingBoxData.containsPoint(i._helpPoint.x,i._helpPoint.y))},i.prototype.intersectsSegment=function(n,t,r,u,f,e,o){if(void 0===f&&(f=null),void 0===e&&(e=null),void 0===o&&(o=null),null===this._boundingBoxData)return 0;this.updateTransformAndMatrix();i._helpMatrix.copyFrom(this.globalTransformMatrix);i._helpMatrix.invert();i._helpMatrix.transformPoint(n,t,i._helpPoint);n=i._helpPoint.x;t=i._helpPoint.y;i._helpMatrix.transformPoint(r,u,i._helpPoint);r=i._helpPoint.x;u=i._helpPoint.y;var s=this._boundingBoxData.intersectsSegment(n,t,r,u,f,e,o);return s>0&&(1===s||2===s?null!==f?(this.globalTransformMatrix.transformPoint(f.x,f.y,f),null!==e&&(e.x=f.x,e.y=f.y)):null!==e&&this.globalTransformMatrix.transformPoint(e.x,e.y,e):(null!==f&&this.globalTransformMatrix.transformPoint(f.x,f.y,f),null!==e&&this.globalTransformMatrix.transformPoint(e.x,e.y,e)),null!==o&&(this.globalTransformMatrix.transformPoint(Math.cos(o.x),Math.sin(o.x),i._helpPoint,!0),o.x=Math.atan2(i._helpPoint.y,i._helpPoint.x),this.globalTransformMatrix.transformPoint(Math.cos(o.y),Math.sin(o.y),i._helpPoint,!0),o.y=Math.atan2(i._helpPoint.y,i._helpPoint.x))),s},i.prototype.invalidUpdate=function(){this._displayDirty=!0;this._transformDirty=!0},Object.defineProperty(i.prototype,"visible",{get:function(){return this._visible},set:function(n){this._visible!==n&&(this._visible=n,this._updateVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayIndex",{get:function(){return this._displayIndex},set:function(n){this._setDisplayIndex(n)&&this.update(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._slotData.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayList",{get:function(){return this._displayList.concat()},set:function(t){var s=this._displayList.concat(),f=[],r,e,u,o,i;for(this._setDisplayList(t)&&this.update(-1),r=0,e=s;r<e.length;r++)null!==(i=e[r])&&i!==this._rawDisplay&&i!==this._meshDisplay&&this._displayList.indexOf(i)<0&&f.indexOf(i)<0&&f.push(i);for(u=0,o=f;u<o.length;u++)(i=o[u])instanceof n.Armature||this._disposeDisplay(i,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"slotData",{get:function(){return this._slotData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rawDisplayDatas",{get:function(){return this._rawDisplayDatas},set:function(n){var t,r,i;if(this._rawDisplayDatas!==n)if(this._displayDirty=!0,this._rawDisplayDatas=n,null!==this._rawDisplayDatas)for(this._displayDatas.length=this._rawDisplayDatas.length,t=0,r=this._displayDatas.length;t<r;++t)i=this._rawDisplayDatas[t],null===i&&(i=this._getDefaultRawDisplayData(t)),this._displayDatas[t]=i;else this._displayDatas.length=0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayData",{get:function(){return this._displayData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"boundingBoxData",{get:function(){return this._boundingBoxData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rawDisplay",{get:function(){return this._rawDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"meshDisplay",{get:function(){return this._meshDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"display",{get:function(){return this._display},set:function(n){var i,t;this._display!==n&&(i=this._displayList.length,(this._displayIndex<0&&0===i&&(this._displayIndex=0),this._displayIndex<0)||(t=this.displayList,i<=this._displayIndex&&(t.length=this._displayIndex+1),t[this._displayIndex]=n,this.displayList=t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"childArmature",{get:function(){return this._childArmature},set:function(n){this._childArmature!==n&&(this.display=n)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),i.prototype.getDisplay=function(){return this._display},i.prototype.setDisplay=function(n){this.display=n},i}(n.TransformObject);n.Slot=t}(i||(i={})),function(n){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return r(i,t),i.prototype._onClear=function(){this._armature=null;this._target=null;this._root=null;this._bone=null},Object.defineProperty(i.prototype,"name",{get:function(){return this._constraintData.name},enumerable:!0,configurable:!0}),i._helpMatrix=new n.Matrix,i._helpTransform=new n.Transform,i._helpPoint=new n.Point,i}(n.BaseObject),i,u;n.Constraint=t;i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return r(i,t),i.toString=function(){return"[class dragonBones.IKConstraint]"},i.prototype._onClear=function(){t.prototype._onClear.call(this);this._scaleEnabled=!1;this._bendPositive=!1;this._weight=1;this._constraintData=null},i.prototype._computeA=function(){var i=this._target.global,t=this._root.global,u=this._root.globalTransformMatrix,r=Math.atan2(i.y-t.y,i.x-t.x);t.scaleX<0&&(r+=Math.PI);t.rotation+=n.Transform.normalizeRadian(r-t.rotation)*this._weight;t.toMatrix(u)},i.prototype._computeB=function(){var d=this._bone._boneData.length,y=this._root,e=this._target.global,t=y.global,i=this._bone.global,p=this._bone.globalTransformMatrix,g=p.a*d,nt=p.b*d,tt=g*g+nt*nt,o=Math.sqrt(tt),r=i.x-t.x,u=i.y-t.y,w=r*r+u*u,f=Math.sqrt(w),it=i.rotation,rt=t.rotation,ut=Math.atan2(u,r),c=(r=e.x-t.x)*r+(u=e.y-t.y)*u,s=Math.sqrt(c),l=0,h,v,b,k;if(o+f<=s||s+o<=f||s+f<=o)l=Math.atan2(e.y-t.y,e.x-t.x),o+f<=s||f<o&&(l+=Math.PI);else{var a=(w-tt+c)/(2*c),ft=Math.sqrt(w-a*a*c)/s,et=t.x+r*a,ot=t.y+u*a,st=-u*ft,ht=r*ft,ct=!1,lt=y.parent;null!==lt&&(h=lt.globalTransformMatrix,ct=h.a*h.d-h.b*h.c<0);ct!==this._bendPositive?(i.x=et-st,i.y=ot-ht):(i.x=et+st,i.y=ot+ht);l=Math.atan2(i.y-t.y,i.x-t.x)}v=n.Transform.normalizeRadian(l-ut);t.rotation=rt+v*this._weight;t.toMatrix(y.globalTransformMatrix);b=ut+v*this._weight;i.x=t.x+Math.cos(b)*f;i.y=t.y+Math.sin(b)*f;k=Math.atan2(e.y-i.y,e.x-i.x);i.scaleX<0&&(k+=Math.PI);i.rotation=t.rotation+it-rt+n.Transform.normalizeRadian(k-v-it)*this._weight;i.toMatrix(p)},i.prototype.init=function(n,t){if(null===this._constraintData){this._constraintData=n;this._armature=t;this._target=this._armature.getBone(this._constraintData.target.name);this._root=this._armature.getBone(this._constraintData.root.name);this._bone=null!==this._constraintData.bone?this._armature.getBone(this._constraintData.bone.name):null;var i=this._constraintData;this._scaleEnabled=i.scaleEnabled;this._bendPositive=i.bendPositive;this._weight=i.weight;this._root._hasConstraint=!0}},i.prototype.update=function(){this._root.updateByConstraint();null!==this._bone?(this._bone.updateByConstraint(),this._computeB()):this._computeA()},i.prototype.invalidUpdate=function(){this._root.invalidUpdate();null!==this._bone&&this._bone.invalidUpdate()},i}(t);n.IKConstraint=i;u=function(t){function i(){var n=null!==t&&t.apply(this,arguments)||this;return n._bones=[],n._spaces=[],n._positions=[],n._curves=[],n._boneLengths=[],n._pathGlobalVertices=[],n._segments=[10],n}return r(i,t),i.toString=function(){return"[class dragonBones.PathConstraint]"},i.prototype._onClear=function(){t.prototype._onClear.call(this);this.dirty=!1;this.pathOffset=0;this.position=0;this.spacing=0;this.rotateOffset=0;this.rotateMix=1;this.translateMix=1;this._pathSlot=null;this._bones.length=0;this._spaces.length=0;this._positions.length=0;this._curves.length=0;this._boneLengths.length=0;this._pathGlobalVertices.length=0},i.prototype._updatePathVertices=function(n){var y=this._armature,p=y.armatureData.parent,o=y.armatureData.scale,r=p.intArray,u=p.floatArray,w=n.offset,c=r[w+0],rt=r[w+2],s,h,a,v;if(this._pathGlobalVertices.length=2*c,s=n.weight,null!==s)for(var ut=this._pathSlot._deformVertices.bones,ft=s.bones.length,b=s.offset,l=r[b+1],k=b+2+ft,d=(i=0,0);i<c;i++){for(var g=0,nt=0,tt=0,et=r[k++];tt<et;tt++)h=ut[r[k++]],null!==h&&(h.updateByConstraint(),t=h.globalTransformMatrix,a=u[l++],f=u[l++]*o,e=u[l++]*o,g+=(t.a*f+t.c*e+t.tx)*a,nt+=(t.b*f+t.d*e+t.ty)*a);this._pathGlobalVertices[d++]=g;this._pathGlobalVertices[d++]=nt}else{v=this._pathSlot.parent;v.updateByConstraint();for(var t=v.globalTransformMatrix,i=0,it=rt;i<c;i+=2){var f=u[it++]*o,e=u[it++]*o,ot=t.a*f+t.c*e+t.tx,st=t.b*f+t.d*e+t.ty;this._pathGlobalVertices[i]=ot;this._pathGlobalVertices[i+1]=st}}},i.prototype._computeVertices=function(n,t,i,r){for(var u=i,f=n;u<t;u+=2)r[u]=this._pathGlobalVertices[f++],r[u+1]=this._pathGlobalVertices[f++]},i.prototype._computeBezierCurve=function(n,t,i,r,u){var fi=this._armature.armatureData.parent.intArray[n.vertices.offset+0],ri=this._positions,lt=this._spaces,ht=n.closed,f=Array(),y=2*fi,ct=y/6,at=-1,v=this.position,c,vt,l,kt,a,dt,gt,ni,s,st,h,ti,ii,ui;if(ri.length=3*t+2,c=0,n.constantSpeed){ht?(y+=2,f.length=fi,this._computeVertices(2,y-4,0,f),this._computeVertices(0,2,y-4,f),f[y-2]=f[0],f[y-1]=f[1]):(ct--,y-=4,f.length=y,this._computeVertices(2,y,0,f));vt=new Array(ct);c=0;for(var yt,pt,tt,it,p,w,e,o,b=f[0],k=f[1],d=0,g=0,rt=0,ut=0,wt=0,bt=0,ft=(s=0,2);s<ct;s++,ft+=6)d=f[ft],g=f[ft+1],rt=f[ft+2],ut=f[ft+3],p=2*(yt=.1875*(b-2*d+rt))+(tt=.09375*(3*(d-rt)-b+(wt=f[ft+4]))),w=2*(pt=.1875*(k-2*g+ut))+(it=.09375*(3*(g-ut)-k+(bt=f[ft+5]))),e=.75*(d-b)+yt+.16666667*tt,o=.75*(g-k)+pt+.16666667*it,c+=Math.sqrt(e*e+o*o),e+=p,o+=w,p+=tt,w+=it,c+=Math.sqrt(e*e+o*o),e+=p,o+=w,c+=Math.sqrt(e*e+o*o),e+=p+tt,o+=w+it,c+=Math.sqrt(e*e+o*o),vt[s]=c,b=wt,k=bt;if(r&&(v*=c),u)for(s=0;s<t;s++)lt[s]*=c;for(var et=this._segments,nt=0,ot=(s=0,st=0,h=0,0);s<t;s++,st+=3){if(l=v+=lt[s],ht)(l%=c)<0&&(l+=c),h=0;else{if(l<0)continue;if(l>c)continue}for(;;h++)if(kt=vt[h],!(l>kt)){0===h?l/=kt:l=(l-(gt=vt[h-1]))/(kt-gt);break}if(h!==at){for(at=h,a=6*h,b=f[a],k=f[a+1],d=f[a+2],g=f[a+3],rt=f[a+4],ut=f[a+5],p=2*(yt=.03*(b-2*d+rt))+(tt=.006*(3*(d-rt)-b+(wt=f[a+6]))),w=2*(pt=.03*(k-2*g+ut))+(it=.006*(3*(g-ut)-k+(bt=f[a+7]))),e=.3*(d-b)+yt+.16666667*tt,o=.3*(g-k)+pt+.16666667*it,nt=Math.sqrt(e*e+o*o),et[0]=nt,a=1;a<8;a++)e+=p,o+=w,p+=tt,w+=it,nt+=Math.sqrt(e*e+o*o),et[a]=nt;e+=p;o+=w;nt+=Math.sqrt(e*e+o*o);et[8]=nt;e+=p+tt;o+=w+it;nt+=Math.sqrt(e*e+o*o);et[9]=nt;ot=0}for(l*=nt;;ot++)if(dt=et[ot],!(l>dt)){0===ot?l/=dt:l=ot+(l-(gt=et[ot-1]))/(dt-gt);break}this.addCurvePosition(.1*l,b,k,d,g,rt,ut,wt,bt,ri,st,i)}}else{if(ni=n.curveLengths,c=ni[ct-=ht?1:2],r&&(v*=c),u)for(s=0;s<t;s++)lt[s]*=c;for(f.length=8,s=0,st=0,h=0;s<t;s++,st+=3){if(v+=lt[s],ht)(v%=c)<0&&(v+=c),h=0;else{if(v<0)continue;if(v>c)continue}for(ti=0;;h++)if(ii=ni[h],!(v>ii)){0===h?ti=v/ii:(ui=ni[h-1],ti=(v-ui)/(ii-ui));break}h!==at&&(at=h,ht&&h===ct?(this._computeVertices(y-4,4,0,f),this._computeVertices(0,4,4,f)):this._computeVertices(6*h+2,8,0,f));this.addCurvePosition(ti,f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],ri,st,i)}}},i.prototype.addCurvePosition=function(n,t,i,r,u,f,e,o,s,h,c,l){if(0===n)return h[c]=t,h[c+1]=i,void(h[c+2]=0);if(1===n)return h[c]=o,h[c+1]=s,void(h[c+2]=0);var a=1-n,w=a*a,b=n*n,v=w*a,y=w*n*3,p=a*b*3,k=n*b,d=v*t+y*r+p*f+k*o,g=v*i+y*u+p*e+k*s;h[c]=d;h[c+1]=g;h[c+2]=l?Math.atan2(g-(v*i+y*u+p*e),d-(v*t+y*r+p*f)):0},i.prototype.init=function(n,t){var i,r,f,u;for(this._constraintData=n,this._armature=t,i=n,this.pathOffset=i.pathDisplayData.vertices.offset,this.position=i.position,this.spacing=i.spacing,this.rotateOffset=i.rotateOffset,this.rotateMix=i.rotateMix,this.translateMix=i.translateMix,this._root=this._armature.getBone(i.root.name),this._target=this._armature.getBone(i.target.name),this._pathSlot=this._armature.getSlot(i.pathSlot.name),r=0,f=i.bones.length;r<f;r++)u=this._armature.getBone(i.bones[r].name),null!==u&&this._bones.push(u);2===i.rotateMode&&(this._boneLengths.length=this._bones.length);this._root._hasConstraint=!0},i.prototype.update=function(){var o=this._pathSlot,i,wt,u,t,c,l,dt,at,vt;if(null!==o._deformVertices&&null!==o._deformVertices.verticesData&&o._deformVertices.verticesData.offset===this.pathOffset){var it=this._constraintData,rt=o._displayData,ut=!1,y=o._deformVertices;if(this._root._childrenTransformDirty?(this._updatePathVertices(rt.vertices),ut=!0):null!==y&&(y.verticesDirty||y.isBonesUpdate())&&(this._updatePathVertices(rt.vertices),y.verticesDirty=!1,ut=!0),ut||this.dirty){var ti=it.positionMode,yt=it.spacingMode,ft=it.rotateMode,et=this._bones,ii=0===yt,ot=2===ft,st=0===ft,ht=et.length,p=st?ht:ht+1,pt=this.spacing,w=this._spaces;if(w.length=p,ot||ii)for(w[0]=0,i=0,wt=p-1;i<wt;i++){(u=et[i]).updateByConstraint();var b=u._boneData.length,k=b*(t=u.globalTransformMatrix).a,d=b*t.b,bt=Math.sqrt(k*k+d*d);ot&&(this._boneLengths[i]=bt);w[i+1]=(b+pt)*bt/b}else for(i=0;i<p;i++)w[i]=pt;this._computeBezierCurve(rt,p,st,1===ti,2===yt);var ct,s=this._positions,lt=this.rotateOffset,g=s[0],nt=s[1];0===lt?ct=1===ft:(ct=!1,null!==(u=o.parent)&&(lt*=(t=u.globalTransformMatrix).a*t.d-t.b*t.c>0?n.Transform.DEG_RAD:-n.Transform.DEG_RAD));for(var h=this.rotateMix,kt=this.translateMix,tt=(i=0,3);i<ht;i++,tt+=3){if((u=et[i]).updateByConstraint(),(t=u.globalTransformMatrix).tx+=(g-t.tx)*kt,t.ty+=(nt-t.ty)*kt,c=(k=s[tt])-g,l=(d=s[tt+1])-nt,ot&&(dt=this._boneLengths[i],at=(Math.sqrt(c*c+l*l)/dt-1)*h+1,t.a*=at,t.b*=at),g=k,nt=d,h>0){var a=t.a,v=t.b,gt=t.c,ni=t.d,r=void 0,f=void 0,e=void 0;(r=st?s[tt-1]:Math.atan2(l,c),r-=Math.atan2(v,a),ct)?(f=Math.cos(r),e=Math.sin(r),vt=u._boneData.length,g+=(vt*(f*a-e*v)-c)*h,nt+=(vt*(e*a+f*v)-l)*h):r+=lt;r>n.Transform.PI?r-=n.Transform.PI_D:r<-n.Transform.PI&&(r+=n.Transform.PI_D);r*=h;f=Math.cos(r);e=Math.sin(r);t.a=f*a-e*v;t.b=e*a+f*v;t.c=f*gt-e*ni;t.d=e*gt+f*ni}u.global.fromMatrix(t)}this.dirty=!1}}},i.prototype.invalidUpdate=function(){},i}(t);n.PathConstraint=u}(i||(i={})),function(n){var t=function(){function n(n){void 0===n&&(n=0);this.time=0;this.timeScale=1;this._systemTime=0;this._animatebles=[];this._clock=null;this.time=n;this._systemTime=.001*(new Date).getTime()}return n.prototype.advanceTime=function(n){var u,r,e;if(n!=n&&(n=0),u=.001*Date.now(),n<0&&(n=u-this._systemTime),this._systemTime=u,1!==this.timeScale&&(n*=this.timeScale),0!==n){n<0?this.time-=n:this.time+=n;for(var t=0,i=0,f=this._animatebles.length;t<f;++t)r=this._animatebles[t],null!==r?(i>0&&(this._animatebles[t-i]=r,this._animatebles[t]=null),r.advanceTime(n)):i++;if(i>0){for(f=this._animatebles.length;t<f;++t)e=this._animatebles[t],null!==e?this._animatebles[t-i]=e:i++;this._animatebles.length-=i}}},n.prototype.contains=function(n){if(n===this)return!1;for(var t=n;t!==this&&null!==t;)t=t.clock;return t===this},n.prototype.add=function(n){this._animatebles.indexOf(n)<0&&(this._animatebles.push(n),n.clock=this)},n.prototype.remove=function(n){var t=this._animatebles.indexOf(n);t>=0&&(this._animatebles[t]=null,n.clock=null)},n.prototype.clear=function(){for(var i,n=0,t=this._animatebles;n<t.length;n++)i=t[n],null!==i&&(i.clock=null)},Object.defineProperty(n.prototype,"clock",{get:function(){return this._clock},set:function(n){this._clock!==n&&(null!==this._clock&&this._clock.remove(this),this._clock=n,null!==this._clock&&this._clock.add(this))},enumerable:!0,configurable:!0}),n.clock=new n,n}();n.WorldClock=t}(i||(i={})),function(n){var t=function(t){function i(){var n=null!==t&&t.apply(this,arguments)||this;return n._animationNames=[],n._animationStates=[],n._animations={},n._animationConfig=null,n}return r(i,t),i.toString=function(){return"[class dragonBones.Animation]"},i.prototype._onClear=function(){for(var i,n=0,t=this._animationStates;n<t.length;n++)t[n].returnToPool();for(i in this._animations)delete this._animations[i];null!==this._animationConfig&&this._animationConfig.returnToPool();this.timeScale=1;this._lockUpdate=!1;this._animationDirty=!1;this._inheritTimeScale=1;this._animationNames.length=0;this._animationStates.length=0;this._armature=null;this._animationConfig=null;this._lastAnimationState=null},i.prototype._fadeOut=function(n){var i,e,r,o,u,s,f,h,t;switch(n.fadeOutMode){case 1:for(i=0,e=this._animationStates;i<e.length;i++)null===(t=e[i])._parent&&t.layer===n.layer&&t.fadeOut(n.fadeOutTime,n.pauseFadeOut);break;case 2:for(r=0,o=this._animationStates;r<o.length;r++)null===(t=o[r])._parent&&t.group===n.group&&t.fadeOut(n.fadeOutTime,n.pauseFadeOut);break;case 3:for(u=0,s=this._animationStates;u<s.length;u++)null===(t=s[u])._parent&&t.layer===n.layer&&t.group===n.group&&t.fadeOut(n.fadeOutTime,n.pauseFadeOut);break;case 4:for(f=0,h=this._animationStates;f<h.length;f++)null===(t=h[f])._parent&&t.fadeOut(n.fadeOutTime,n.pauseFadeOut)}},i.prototype.init=function(t){null===this._armature&&(this._armature=t,this._animationConfig=n.BaseObject.borrowObject(n.AnimationConfig))},i.prototype.advanceTime=function(n){var u,e,c,o,l,a,s,v,f,h,y,i,r,t;if(n<0&&(n=-n),this._inheritTimeScale=this._armature.inheritAnimation&&null!==this._armature._parent?this._armature._parent._armature.animation._inheritTimeScale*this.timeScale:this.timeScale,1!==this._inheritTimeScale&&(n*=this._inheritTimeScale),u=this._animationStates.length,1===u)if((t=this._animationStates[0])._fadeState>0&&t._subFadeState>0)this._armature._dragonBones.bufferObject(t),this._animationStates.length=0,this._lastAnimationState=null;else{if(e=t._animationData,c=e.cacheFrameRate,this._animationDirty&&c>0){for(this._animationDirty=!1,o=0,l=this._armature.getBones();o<l.length;o++)a=l[o],a._cachedFrameIndices=e.getBoneCachedFrameIndices(a.name);for(s=0,v=this._armature.getSlots();s<v.length;s++){if(f=v[s],h=f.rawDisplayDatas,null!==h&&h.length>0&&(y=h[0],null!==y&&y.parent===this._armature.armatureData.defaultSkin)){f._cachedFrameIndices=e.getSlotCachedFrameIndices(f.name);continue}f._cachedFrameIndices=null}}t.advanceTime(n,c)}else if(u>1){for(i=0,r=0;i<u;++i)(t=this._animationStates[i])._fadeState>0&&t._subFadeState>0?(r++,this._armature._dragonBones.bufferObject(t),this._animationDirty=!0,this._lastAnimationState===t&&(this._lastAnimationState=null)):(r>0&&(this._animationStates[i-r]=t),t.advanceTime(n,0)),i===u-1&&r>0&&(this._animationStates.length-=r,null===this._lastAnimationState&&this._animationStates.length>0&&(this._lastAnimationState=this._animationStates[this._animationStates.length-1]));this._armature._cacheFrameIndex=-1}else this._armature._cacheFrameIndex=-1},i.prototype.reset=function(){for(var n=0,t=this._animationStates;n<t.length;n++)t[n].returnToPool();this._animationDirty=!1;this._animationConfig.clear();this._animationStates.length=0;this._lastAnimationState=null},i.prototype.stop=function(n){var t,i,r;if(void 0===n&&(n=null),null!==n)null!==(r=this.getState(n))&&r.stop();else for(t=0,i=this._animationStates;t<i.length;t++)(r=i[t]).stop()},i.prototype.playConfig=function(t){var f=t.animation,i,s,c,l,r,h,v,e,y,w,o;if(!(f in this._animations))return console.warn("Non-existent animation.\n","DragonBones name: "+this._armature.armatureData.parent.name,"Armature name: "+this._armature.name,"Animation name: "+f),null;if(i=this._animations[f],5===t.fadeOutMode)for(s=0,c=this._animationStates;s<c.length;s++)if(l=c[s],l._animationData===i)return l;if(0===this._animationStates.length?t.fadeInTime=0:t.fadeInTime<0&&(t.fadeInTime=i.fadeInTime),t.fadeOutTime<0&&(t.fadeOutTime=t.fadeInTime),t.timeScale<=-100&&(t.timeScale=1/i.scale),i.frameCount>1?(t.position<0?(t.position%=i.duration,t.position=i.duration-t.position):t.position===i.duration?t.position-=1e-6:t.position>i.duration&&(t.position%=i.duration),t.duration>0&&t.position+t.duration>i.duration&&(t.duration=i.duration-t.position),t.playTimes<0&&(t.playTimes=i.playTimes)):(t.playTimes=1,t.position=0,t.duration>0&&(t.duration=0)),0===t.duration&&(t.duration=-1),this._fadeOut(t),r=n.BaseObject.borrowObject(n.AnimationState),r.init(this._armature,i,t),this._animationDirty=!0,this._armature._cacheFrameIndex=-1,this._animationStates.length>0){for(var a=!1,u=0,p=this._animationStates.length;u<p;++u){if(r.layer>this._animationStates[u].layer){a=!0;this._animationStates.splice(u,0,r);break}if(u!==p-1&&r.layer>this._animationStates[u+1].layer){a=!0;this._animationStates.splice(u+1,0,r);break}}a||this._animationStates.push(r)}else this._animationStates.push(r);for(h=0,v=this._armature.getSlots();h<v.length;h++)e=v[h].childArmature,null!==e&&e.inheritAnimation&&e.animation.hasAnimation(f)&&null===e.animation.getState(f)&&e.animation.fadeIn(f);y=!1;for(w in i.animationTimelines)this._lockUpdate||(y=!0,this._lockUpdate=!0),o=this.fadeIn(w,t.fadeInTime,1,r.layer,null,0),null!==o&&(o.resetToPose=!1,o._parent=r,o.stop());return y&&(this._lockUpdate=!1),this._lockUpdate||(t.fadeInTime<=0&&this._armature.advanceTime(0),this._lastAnimationState=r),r},i.prototype.play=function(n,t){if(void 0===n&&(n=null),void 0===t&&(t=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=t,this._animationConfig.fadeInTime=0,this._animationConfig.animation=null!==n?n:"",null!==n&&n.length>0)this.playConfig(this._animationConfig);else if(null===this._lastAnimationState){var i=this._armature.armatureData.defaultAnimation;null!==i&&(this._animationConfig.animation=i.name,this.playConfig(this._animationConfig))}else this._lastAnimationState.isPlaying||this._lastAnimationState.isCompleted?(this._animationConfig.animation=this._lastAnimationState.name,this.playConfig(this._animationConfig)):this._lastAnimationState.play();return this._lastAnimationState},i.prototype.fadeIn=function(n,t,i,r,u,f){return void 0===t&&(t=-1),void 0===i&&(i=-1),void 0===r&&(r=0),void 0===u&&(u=null),void 0===f&&(f=3),this._animationConfig.clear(),this._animationConfig.fadeOutMode=f,this._animationConfig.playTimes=i,this._animationConfig.layer=r,this._animationConfig.fadeInTime=t,this._animationConfig.animation=n,this._animationConfig.group=null!==u?u:"",this.playConfig(this._animationConfig)},i.prototype.gotoAndPlayByTime=function(n,t,i){return void 0===t&&(t=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.position=t,this._animationConfig.fadeInTime=0,this._animationConfig.animation=n,this.playConfig(this._animationConfig)},i.prototype.gotoAndPlayByFrame=function(n,t,i){void 0===t&&(t=0);void 0===i&&(i=-1);this._animationConfig.clear();this._animationConfig.resetToPose=!0;this._animationConfig.playTimes=i;this._animationConfig.fadeInTime=0;this._animationConfig.animation=n;var r=n in this._animations?this._animations[n]:null;return null!==r&&(this._animationConfig.position=r.duration*t/r.frameCount),this.playConfig(this._animationConfig)},i.prototype.gotoAndPlayByProgress=function(n,t,i){void 0===t&&(t=0);void 0===i&&(i=-1);this._animationConfig.clear();this._animationConfig.resetToPose=!0;this._animationConfig.playTimes=i;this._animationConfig.fadeInTime=0;this._animationConfig.animation=n;var r=n in this._animations?this._animations[n]:null;return null!==r&&(this._animationConfig.position=r.duration*(t>0?t:0)),this.playConfig(this._animationConfig)},i.prototype.gotoAndStopByTime=function(n,t){void 0===t&&(t=0);var i=this.gotoAndPlayByTime(n,t,1);return null!==i&&i.stop(),i},i.prototype.gotoAndStopByFrame=function(n,t){void 0===t&&(t=0);var i=this.gotoAndPlayByFrame(n,t,1);return null!==i&&i.stop(),i},i.prototype.gotoAndStopByProgress=function(n,t){void 0===t&&(t=0);var i=this.gotoAndPlayByProgress(n,t,1);return null!==i&&i.stop(),i},i.prototype.getState=function(n){for(var i,t=this._animationStates.length;t--;)if(i=this._animationStates[t],i.name===n)return i;return null},i.prototype.hasAnimation=function(n){return n in this._animations},i.prototype.getStates=function(){return this._animationStates},Object.defineProperty(i.prototype,"isPlaying",{get:function(){for(var n=0,t=this._animationStates;n<t.length;n++)if(t[n].isPlaying)return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isCompleted",{get:function(){for(var n=0,t=this._animationStates;n<t.length;n++)if(!t[n].isCompleted)return!1;return this._animationStates.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastAnimationName",{get:function(){return null!==this._lastAnimationState?this._lastAnimationState.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animations",{get:function(){return this._animations},set:function(n){var t;if(this._animations!==n){for(t in this._animationNames.length=0,this._animations)delete this._animations[t];for(t in n)this._animationNames.push(t),this._animations[t]=n[t]}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationConfig",{get:function(){return this._animationConfig.clear(),this._animationConfig},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastAnimationState",{get:function(){return this._lastAnimationState},enumerable:!0,configurable:!0}),i.prototype.gotoAndPlay=function(n,t,i,r,u,f,e,o,s){void 0===t&&(t=-1);void 0===i&&(i=-1);void 0===r&&(r=-1);void 0===u&&(u=0);void 0===f&&(f=null);void 0===e&&(e=3);void 0===o&&(o=!0);void 0===s&&(s=!0);console.warn("Deprecated.");this._animationConfig.clear();this._animationConfig.resetToPose=!0;this._animationConfig.fadeOutMode=e;this._animationConfig.playTimes=r;this._animationConfig.layer=u;this._animationConfig.fadeInTime=t;this._animationConfig.animation=n;this._animationConfig.group=null!==f?f:"";var h=this._animations[n];return h&&i>0&&(this._animationConfig.timeScale=h.duration/i),this.playConfig(this._animationConfig)},i.prototype.gotoAndStop=function(n,t){return void 0===t&&(t=0),console.warn("Deprecated."),this.gotoAndStopByTime(n,t)},Object.defineProperty(i.prototype,"animationList",{get:function(){return console.warn("Deprecated."),this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationDataList",{get:function(){console.warn("Deprecated.");for(var t=[],n=0,i=this._animationNames.length;n<i;++n)t.push(this._animations[this._animationNames[n]]);return t},enumerable:!0,configurable:!0}),i}(n.BaseObject);n.Animation=t}(i||(i={})),function(n){var u=function(u){function f(){var n=null!==u&&u.apply(this,arguments)||this;return n._blendState=new i,n._boneMask=[],n._boneTimelines=[],n._surfaceTimelines=[],n._slotTimelines=[],n._constraintTimelines=[],n._animationTimelines=[],n._poseTimelines=[],n._bonePoses={},n._actionTimeline=null,n._zOrderTimeline=null,n._parent=null,n}return r(f,u),f.toString=function(){return"[class dragonBones.AnimationState]"},f.prototype._onClear=function(){for(var t,e,i,o,r,s,u,h,c,n=0,f=this._boneTimelines;n<f.length;n++)f[n].returnToPool();for(t=0,e=this._surfaceTimelines;t<e.length;t++)e[t].returnToPool();for(i=0,o=this._slotTimelines;i<o.length;i++)o[i].returnToPool();for(r=0,s=this._constraintTimelines;r<s.length;r++)s[r].returnToPool();for(u=0,h=this._animationTimelines;u<h.length;u++)h[u].returnToPool();for(c in this._bonePoses)this._bonePoses[c].returnToPool(),delete this._bonePoses[c];null!==this._actionTimeline&&this._actionTimeline.returnToPool();null!==this._zOrderTimeline&&this._zOrderTimeline.returnToPool();this.actionEnabled=!1;this.additiveBlending=!1;this.displayControl=!1;this.resetToPose=!1;this.playTimes=1;this.layer=0;this.timeScale=1;this.weight=1;this.autoFadeOutTime=0;this.fadeTotalTime=0;this.name="";this.group="";this._timelineDirty=2;this._playheadState=0;this._fadeState=-1;this._subFadeState=-1;this._position=0;this._duration=0;this._fadeTime=0;this._time=0;this._fadeProgress=0;this._weightResult=0;this._blendState.clear();this._boneMask.length=0;this._boneTimelines.length=0;this._surfaceTimelines.length=0;this._slotTimelines.length=0;this._constraintTimelines.length=0;this._animationTimelines.length=0;this._poseTimelines.length=0;this._animationData=null;this._armature=null;this._actionTimeline=null;this._zOrderTimeline=null;this._parent=null},f.prototype._updateTimelines=function(){for(var r,u,l,f,a,e,o,s,v,h,t,i=0,c=this._armature._constraints;i<c.length;i++)if(r=c[i],null!==(e=this._animationData.getConstraintTimelines(r.name)))for(u=0,l=e;u<l.length;u++)switch((h=l[u]).type){case 30:(t=n.BaseObject.borrowObject(n.IKConstraintTimelineState)).constraint=r;t.init(this._armature,this,h);this._constraintTimelines.push(t)}else this.resetToPose&&((t=n.BaseObject.borrowObject(n.IKConstraintTimelineState)).constraint=r,t.init(this._armature,this,null),this._constraintTimelines.push(t),this._poseTimelines.push(t));for(f=0,a=this._armature.animation.getStates();f<a.length;f++)if(o=a[f],o._parent===this&&null!==(e=this._animationData.getAnimationTimelines(o.name)))for(s=0,v=e;s<v.length;s++)switch((h=v[s]).type){case 40:(t=n.BaseObject.borrowObject(n.AnimationTimelineState)).animationState=o;t.init(this._armature,this,h);this._animationTimelines.push(t)}},f.prototype._updateBoneAndSlotTimelines=function(){for(var l,tt,u,r,o,c,a,it,v,rt,p,ut,i,w,ot,f,wt,st,ht,b,ct,e,k,lt,d,at,y,g,vt,s={},nt=0,yt=this._boneTimelines;nt<yt.length;nt++)(r=(i=yt[nt]).bone.name)in s||(s[r]=[]),s[r].push(i);for(l=0,tt=this._armature.getBones();l<tt.length;l++)if(u=tt[l],r=u.name,this.containsBoneMask(r))if(r in s)delete s[r];else if(0===u._boneData.type)if(o=this._animationData.getBoneTimelines(r),c=r in this._bonePoses?this._bonePoses[r]:this._bonePoses[r]=n.BaseObject.borrowObject(t),null!==o)for(a=0,it=o;a<it.length;a++)switch((e=it[a]).type){case 10:(i=n.BaseObject.borrowObject(n.BoneAllTimelineState)).bone=u;i.bonePose=c;i.init(this._armature,this,e);this._boneTimelines.push(i);break;case 11:(i=n.BaseObject.borrowObject(n.BoneTranslateTimelineState)).bone=u;i.bonePose=c;i.init(this._armature,this,e);this._boneTimelines.push(i);break;case 12:(i=n.BaseObject.borrowObject(n.BoneRotateTimelineState)).bone=u;i.bonePose=c;i.init(this._armature,this,e);this._boneTimelines.push(i);break;case 13:(i=n.BaseObject.borrowObject(n.BoneScaleTimelineState)).bone=u;i.bonePose=c;i.init(this._armature,this,e);this._boneTimelines.push(i)}else this.resetToPose&&((i=n.BaseObject.borrowObject(n.BoneAllTimelineState)).bone=u,i.bonePose=c,i.init(this._armature,this,null),this._boneTimelines.push(i),this._poseTimelines.push(i));else if(1===u._boneData.type)if(null!==(o=this._animationData.getSurfaceTimelines(r)))for(v=0,rt=o;v<rt.length;v++)switch((e=rt[v]).type){case 50:(i=n.BaseObject.borrowObject(n.SurfaceTimelineState)).surface=u;i.init(this._armature,this,e);this._surfaceTimelines.push(i)}else this.resetToPose&&((i=n.BaseObject.borrowObject(n.SurfaceTimelineState)).surface=u,i.init(this._armature,this,null),this._surfaceTimelines.push(i),this._poseTimelines.push(i));for(y in s)for(p=0,ut=s[y];p<ut.length;p++)i=ut[p],this._boneTimelines.splice(this._boneTimelines.indexOf(i),1),i.returnToPool();for(var h={},ft=[],et=0,pt=this._slotTimelines;et<pt.length;et++)(r=(i=pt[et]).slot.name)in h||(h[r]=[]),h[r].push(i);for(w=0,ot=this._armature.getSlots();w<ot.length;w++)if(f=ot[w],wt=f.parent.name,this.containsBoneMask(wt))if(r=f.name,o=this._animationData.getSlotTimelines(r),r in h)delete h[r];else{if(st=!1,ht=!1,ft.length=0,null!==o)for(b=0,ct=o;b<ct.length;b++)switch((e=ct[b]).type){case 20:(i=n.BaseObject.borrowObject(n.SlotDislayTimelineState)).slot=f;i.init(this._armature,this,e);this._slotTimelines.push(i);st=!0;break;case 21:(i=n.BaseObject.borrowObject(n.SlotColorTimelineState)).slot=f;i.init(this._armature,this,e);this._slotTimelines.push(i);ht=!0;break;case 22:(i=n.BaseObject.borrowObject(n.DeformTimelineState)).slot=f;i.init(this._armature,this,e);this._slotTimelines.push(i);ft.push(i.vertexOffset)}if(this.resetToPose&&(st||((i=n.BaseObject.borrowObject(n.SlotDislayTimelineState)).slot=f,i.init(this._armature,this,null),this._slotTimelines.push(i),this._poseTimelines.push(i)),ht||((i=n.BaseObject.borrowObject(n.SlotColorTimelineState)).slot=f,i.init(this._armature,this,null),this._slotTimelines.push(i),this._poseTimelines.push(i)),null!==f.rawDisplayDatas))for(k=0,lt=f.rawDisplayDatas;k<lt.length;k++)d=lt[k],null!==d&&2===d.type&&(at=d.vertices.offset,ft.indexOf(at)<0&&((i=n.BaseObject.borrowObject(n.DeformTimelineState)).vertexOffset=at,i.slot=f,i.init(this._armature,this,null),this._slotTimelines.push(i),this._poseTimelines.push(i)))}for(y in h)for(g=0,vt=h[y];g<vt.length;g++)i=vt[g],this._slotTimelines.splice(this._slotTimelines.indexOf(i),1),i.returnToPool()},f.prototype._advanceFadeTime=function(t){var i,r=this._fadeState>0,u;this._subFadeState<0&&(this._subFadeState=0,u=r?n.EventObject.FADE_OUT:n.EventObject.FADE_IN,this._armature.eventDispatcher.hasDBEventListener(u)&&((i=n.BaseObject.borrowObject(n.EventObject)).type=u,i.armature=this._armature,i.animationState=this,this._armature._dragonBones.bufferEvent(i)));(t<0&&(t=-t),this._fadeTime+=t,this._fadeTime>=this.fadeTotalTime?(this._subFadeState=1,this._fadeProgress=r?0:1):this._fadeProgress=this._fadeTime>0?r?1-this._fadeTime/this.fadeTotalTime:this._fadeTime/this.fadeTotalTime:r?1:0,this._subFadeState>0)&&(r||(this._playheadState|=1,this._fadeState=0),u=r?n.EventObject.FADE_OUT_COMPLETE:n.EventObject.FADE_IN_COMPLETE,this._armature.eventDispatcher.hasDBEventListener(u)&&((i=n.BaseObject.borrowObject(n.EventObject)).type=u,i.armature=this._armature,i.animationState=this,this._armature._dragonBones.bufferEvent(i)))},f.prototype.init=function(t,i,r){if(null===this._armature){if(this._armature=t,this._animationData=i,this.resetToPose=r.resetToPose,this.additiveBlending=r.additiveBlending,this.displayControl=r.displayControl,this.actionEnabled=r.actionEnabled,this.layer=r.layer,this.playTimes=r.playTimes,this.timeScale=r.timeScale,this.fadeTotalTime=r.fadeInTime,this.autoFadeOutTime=r.autoFadeOutTime,this.weight=r.weight,this.name=r.name.length>0?r.name:r.animation,this.group=r.group,this._playheadState=r.pauseFadeIn?2:3,r.duration<0?(this._position=0,this._duration=this._animationData.duration,this._time=0!==r.position?this.timeScale>=0?r.position:r.position-this._duration:0):(this._position=r.position,this._duration=r.duration,this._time=0),this.timeScale<0&&0===this._time&&(this._time=-1e-6),this.fadeTotalTime<=0&&(this._fadeProgress=.999999),r.boneMask.length>0){this._boneMask.length=r.boneMask.length;for(var u=0,f=this._boneMask.length;u<f;++u)this._boneMask[u]=r.boneMask[u]}this._actionTimeline=n.BaseObject.borrowObject(n.ActionTimelineState);this._actionTimeline.init(this._armature,this,this._animationData.actionTimeline);this._actionTimeline.currentTime=this._time;this._actionTimeline.currentTime<0&&(this._actionTimeline.currentTime=this._duration-this._actionTimeline.currentTime);null!==this._animationData.zOrderTimeline&&(this._zOrderTimeline=n.BaseObject.borrowObject(n.ZOrderTimelineState),this._zOrderTimeline.init(this._armature,this,this._animationData.zOrderTimeline))}},f.prototype.advanceTime=function(t,i){var a,s,u,f,e,h,c,v,r;if(this._blendState.dirty=!1,0===this._fadeState&&0===this._subFadeState||this._advanceFadeTime(t),3===this._playheadState&&(1!==this.timeScale&&(t*=this.timeScale),this._time+=t),0!==this._timelineDirty&&(2===this._timelineDirty&&this._updateTimelines(),this._timelineDirty=0,this._updateBoneAndSlotTimelines()),0!==this.weight){var y=0===this._fadeState&&i>0,p=!0,l=!0,o=this._time;if((this._weightResult=this.weight*this._fadeProgress,null!==this._parent&&(this._weightResult*=this._parent._weightResult/this._parent._fadeProgress),this._actionTimeline.playState<=0&&this._actionTimeline.update(o),y)&&(a=2*i,this._actionTimeline.currentTime=Math.floor(this._actionTimeline.currentTime*a)/a),(null!==this._zOrderTimeline&&this._zOrderTimeline.playState<=0&&this._zOrderTimeline.update(o),y)&&(s=Math.floor(this._actionTimeline.currentTime*i),this._armature._cacheFrameIndex===s?(p=!1,l=!1):(this._armature._cacheFrameIndex=s,this._animationData.cachedFrames[s]?l=!1:this._animationData.cachedFrames[s]=!0)),p){if(l)for(u=0,f=this._boneTimelines.length;u<f;++u)(r=this._boneTimelines[u]).playState<=0&&r.update(o),(u===f-1||r.bone!==this._boneTimelines[u+1].bone)&&0!==(e=r.bone._blendState.update(this._weightResult,this.layer))&&r.blend(e);for(u=0,f=this._surfaceTimelines.length;u<f;++u)e=(r=this._surfaceTimelines[u]).surface._blendState.update(this._weightResult,this.layer),r.playState<=0&&r.update(o),0!==e&&r.blend(e);if(this.displayControl)for(u=0,f=this._slotTimelines.length;u<f;++u)h=(r=this._slotTimelines[u]).slot.displayController,null!==h&&h!==this.name&&h!==this.group||r.playState<=0&&r.update(o);for(u=0,f=this._constraintTimelines.length;u<f;++u)(r=this._constraintTimelines[u]).playState<=0&&r.update(o);for(u=0,f=this._animationTimelines.length;u<f;++u)e=(r=this._animationTimelines[u]).animationState._blendState.update(this._weightResult,this.layer),r.playState<=0&&r.update(o),0!==e&&r.blend(e)}if(0===this._fadeState){if(this._subFadeState>0&&(this._subFadeState=0,this._poseTimelines.length>0)){for(c=0,v=this._poseTimelines;c<v.length;c++)(r=v[c])instanceof n.BoneTimelineState?this._boneTimelines.splice(this._boneTimelines.indexOf(r),1):r instanceof n.SurfaceTimelineState?this._surfaceTimelines.splice(this._surfaceTimelines.indexOf(r),1):r instanceof n.SlotTimelineState?this._slotTimelines.splice(this._slotTimelines.indexOf(r),1):r instanceof n.ConstraintTimelineState&&this._constraintTimelines.splice(this._constraintTimelines.indexOf(r),1),r.returnToPool();this._poseTimelines.length=0}this._actionTimeline.playState>0&&this.autoFadeOutTime>=0&&this.fadeOut(this.autoFadeOutTime)}}},f.prototype.play=function(){this._playheadState=3},f.prototype.stop=function(){this._playheadState&=1},f.prototype.fadeOut=function(n,t){var r,s,u,h,f,c,e,l,o,a,i;if(void 0===t&&(t=!0),n<0&&(n=0),t&&(this._playheadState&=2),this._fadeState>0){if(n>this.fadeTotalTime-this._fadeTime)return}else{for(this._fadeState=1,this._subFadeState=-1,(n<=0||this._fadeProgress<=0)&&(this._fadeProgress=1e-6),r=0,s=this._boneTimelines;r<s.length;r++)(i=s[r]).fadeOut();for(u=0,h=this._surfaceTimelines;u<h.length;u++)(i=h[u]).fadeOut();for(f=0,c=this._slotTimelines;f<c.length;f++)(i=c[f]).fadeOut();for(e=0,l=this._constraintTimelines;e<l.length;e++)(i=l[e]).fadeOut();for(o=0,a=this._animationTimelines;o<a.length;o++)(i=a[o]).animationState.fadeOut(n,t),i.fadeOut()}this.displayControl=!1;this.fadeTotalTime=this._fadeProgress>1e-6?n/this._fadeProgress:0;this._fadeTime=this.fadeTotalTime*(1-this._fadeProgress)},f.prototype.containsBoneMask=function(n){return 0===this._boneMask.length||this._boneMask.indexOf(n)>=0},f.prototype.addBoneMask=function(n,t){var u,i,f,r;if(void 0===t&&(t=!0),u=this._armature.getBone(n),null!==u){if(this._boneMask.indexOf(n)<0&&this._boneMask.push(n),t)for(i=0,f=this._armature.getBones();i<f.length;i++)r=f[i],this._boneMask.indexOf(r.name)<0&&u.contains(r)&&this._boneMask.push(r.name);this._timelineDirty=1}},f.prototype.removeBoneMask=function(n,t){var e,r,o,u,s,i,h,f,c;if(void 0===t&&(t=!0),e=this._boneMask.indexOf(n),(e>=0&&this._boneMask.splice(e,1),t)&&(r=this._armature.getBone(n),null!==r))if(o=this._armature.getBones(),this._boneMask.length>0)for(u=0,s=o;u<s.length;u++)i=s[u],h=this._boneMask.indexOf(i.name),h>=0&&r.contains(i)&&this._boneMask.splice(h,1);else for(f=0,c=o;f<c.length;f++)(i=c[f])!==r&&(r.contains(i)||this._boneMask.push(i.name));this._timelineDirty=1},f.prototype.removeAllBoneMask=function(){this._boneMask.length=0;this._timelineDirty=1},Object.defineProperty(f.prototype,"isFadeIn",{get:function(){return this._fadeState<0},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"isFadeOut",{get:function(){return this._fadeState>0},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"isFadeComplete",{get:function(){return 0===this._fadeState},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"isPlaying",{get:function(){return 0!=(2&this._playheadState)&&this._actionTimeline.playState<=0},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"isCompleted",{get:function(){return this._actionTimeline.playState>0},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"currentPlayTimes",{get:function(){return this._actionTimeline.currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"totalTime",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"currentTime",{get:function(){return this._actionTimeline.currentTime},set:function(n){var f=this._actionTimeline.currentPlayTimes-(this._actionTimeline.playState>0?1:0),t,r,i,u;if((n<0||this._duration<n)&&(n=n%this._duration+f*this._duration)<0&&(n+=this._duration),this.playTimes>0&&f===this.playTimes-1&&n===this._duration&&(n=this._duration-1e-6),this._time!==n){for(this._time=n,this._actionTimeline.setCurrentTime(this._time),null!==this._zOrderTimeline&&(this._zOrderTimeline.playState=-1),t=0,r=this._boneTimelines;t<r.length;t++)r[t].playState=-1;for(i=0,u=this._slotTimelines;i<u.length;i++)u[i].playState=-1}},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"animationData",{get:function(){return this._animationData},enumerable:!0,configurable:!0}),f}(n.BaseObject),t,i;n.AnimationState=u;t=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.current=new n.Transform,i.delta=new n.Transform,i.result=new n.Transform,i}return r(i,t),i.toString=function(){return"[class dragonBones.BonePose]"},i.prototype._onClear=function(){this.current.identity();this.delta.identity();this.result.identity()},i}(n.BaseObject);n.BonePose=t;i=function(){function n(){}return n.prototype.update=function(n,t){if(this.dirty){if(!(this.leftWeight>0))return 0;if(this.layer!==t){if(this.layerWeight>=this.leftWeight)return this.leftWeight=0,0;this.layer=t;this.leftWeight-=this.layerWeight;this.layerWeight=0}return n*=this.leftWeight,this.layerWeight+=n,this.blendWeight=n,2}return this.dirty=!0,this.layer=t,this.layerWeight=n,this.leftWeight=1,this.blendWeight=n,1},n.prototype.clear=function(){this.dirty=!1;this.layer=0;this.leftWeight=0;this.layerWeight=0;this.blendWeight=0},n}();n.BlendState=i}(i||(i={})),function(n){var i=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return r(t,n),t.prototype._onClear=function(){this.playState=-1;this.currentPlayTimes=-1;this.currentTime=-1;this._tweenState=0;this._frameRate=0;this._frameValueOffset=0;this._frameCount=0;this._frameOffset=0;this._frameIndex=-1;this._frameRateR=0;this._position=0;this._duration=0;this._timeScale=1;this._timeOffset=0;this._dragonBonesData=null;this._animationData=null;this._timelineData=null;this._armature=null;this._animationState=null;this._actionTimeline=null;this._frameArray=null;this._frameIntArray=null;this._frameFloatArray=null;this._timelineArray=null;this._frameIndices=null},t.prototype._setCurrentTime=function(n){var r=this.playState,u=this.currentPlayTimes,f=this.currentTime,t,i;return null!==this._actionTimeline&&this._frameCount<=1?(this.playState=this._actionTimeline.playState>=0?1:-1,this.currentPlayTimes=1,this.currentTime=this._actionTimeline.currentTime):null===this._actionTimeline||1!==this._timeScale||0!==this._timeOffset?(t=this._animationState.playTimes,i=t*this._duration,n*=this._timeScale,0!==this._timeOffset&&(n+=this._timeOffset*this._animationData.duration),t>0&&(n>=i||n<=-i)?(this.playState<=0&&3===this._animationState._playheadState&&(this.playState=1),this.currentPlayTimes=t,this.currentTime=n<0?0:this._duration+1e-6):(0!==this.playState&&3===this._animationState._playheadState&&(this.playState=0),n<0?(n=-n,this.currentPlayTimes=Math.floor(n/this._duration),this.currentTime=this._duration-n%this._duration):(this.currentPlayTimes=Math.floor(n/this._duration),this.currentTime=n%this._duration)),this.currentTime+=this._position):(this.playState=this._actionTimeline.playState,this.currentPlayTimes=this._actionTimeline.currentPlayTimes,this.currentTime=this._actionTimeline.currentTime),(this.currentPlayTimes!==u||this.currentTime!==f)&&((r<0&&this.playState!==r||this.playState<=0&&this.currentPlayTimes!==u)&&(this._frameIndex=-1),!0)},t.prototype.init=function(n,t,i){this._armature=n;this._animationState=t;this._timelineData=i;this._actionTimeline=this._animationState._actionTimeline;this===this._actionTimeline&&(this._actionTimeline=null);this._animationData=this._animationState._animationData;this._frameRate=this._animationData.parent.frameRate;this._frameRateR=1/this._frameRate;this._position=this._animationState._position;this._duration=this._animationState._duration;this._dragonBonesData=this._animationData.parent.parent;null!==this._timelineData&&(this._frameIntArray=this._dragonBonesData.frameIntArray,this._frameFloatArray=this._dragonBonesData.frameFloatArray,this._frameArray=this._dragonBonesData.frameArray,this._timelineArray=this._dragonBonesData.timelineArray,this._frameIndices=this._dragonBonesData.frameIndices,this._frameCount=this._timelineArray[this._timelineData.offset+2],this._frameValueOffset=this._timelineArray[this._timelineData.offset+4],this._timeScale=100/this._timelineArray[this._timelineData.offset+0],this._timeOffset=.01*this._timelineArray[this._timelineData.offset+1])},t.prototype.fadeOut=function(){},t.prototype.update=function(n){if(this._setCurrentTime(n)){if(this._frameCount>1){var i=Math.floor(this.currentTime*this._frameRate),t=this._frameIndices[this._timelineData.frameIndicesOffset+i];this._frameIndex!==t&&(this._frameIndex=t,this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex],this._onArriveAtFrame())}else this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5]),this._onArriveAtFrame());0!==this._tweenState&&this._onUpdateFrame()}},t}(n.BaseObject),t,u,f,e;n.TimelineState=i;t=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return r(t,n),t._getEasingValue=function(n,t,i){var r=t;switch(n){case 3:r=Math.pow(t,2);break;case 4:r=1-Math.pow(1-t,2);break;case 5:r=.5*(1-Math.cos(t*Math.PI))}return(r-t)*i+t},t._getEasingCurveValue=function(n,t,i,r){if(n<=0)return 0;if(n>=1)return 1;var f=i+1,u=Math.floor(n*f),e=0===u?0:t[r+u-1];return.0001*(e+((u===f-1?1e4:t[r+u])-e)*(n*f-u))},t.prototype._onClear=function(){n.prototype._onClear.call(this);this._tweenType=0;this._curveCount=0;this._framePosition=0;this._frameDurationR=0;this._tweenProgress=0;this._tweenEasing=0},t.prototype._onArriveAtFrame=function(){if(this._frameCount>1&&(this._frameIndex!==this._frameCount-1||0===this._animationState.playTimes||this._animationState.currentPlayTimes<this._animationState.playTimes-1))if(this._tweenType=this._frameArray[this._frameOffset+1],this._tweenState=0===this._tweenType?1:2,2===this._tweenType?this._curveCount=this._frameArray[this._frameOffset+2]:0!==this._tweenType&&1!==this._tweenType&&(this._tweenEasing=.01*this._frameArray[this._frameOffset+2]),this._framePosition=this._frameArray[this._frameOffset]*this._frameRateR,this._frameIndex===this._frameCount-1)this._frameDurationR=1/(this._animationData.duration-this._framePosition);else{var t=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex+1],n=this._frameArray[t]*this._frameRateR-this._framePosition;this._frameDurationR=n>0?1/n:0}else this._tweenState=1},t.prototype._onUpdateFrame=function(){2===this._tweenState?(this._tweenProgress=(this.currentTime-this._framePosition)*this._frameDurationR,2===this._tweenType?this._tweenProgress=t._getEasingCurveValue(this._tweenProgress,this._frameArray,this._curveCount,this._frameOffset+3):1!==this._tweenType&&(this._tweenProgress=t._getEasingValue(this._tweenType,this._tweenProgress,this._tweenEasing))):this._tweenProgress=0},t}(i);n.TweenTimelineState=t;u=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return r(t,n),t.prototype._onClear=function(){n.prototype._onClear.call(this);this.bone=null;this.bonePose=null},t.prototype.blend=function(n){var r=this.bone._blendState.blendWeight,t=this.bone.animationPose,i=this.bonePose.result;2===n?(t.x+=i.x*r,t.y+=i.y*r,t.rotation+=i.rotation*r,t.skew+=i.skew*r,t.scaleX+=(i.scaleX-1)*r,t.scaleY+=(i.scaleY-1)*r):1!==r?(t.x=i.x*r,t.y=i.y*r,t.rotation=i.rotation*r,t.skew=i.skew*r,t.scaleX=(i.scaleX-1)*r+1,t.scaleY=(i.scaleY-1)*r+1):(t.x=i.x,t.y=i.y,t.rotation=i.rotation,t.skew=i.skew,t.scaleX=i.scaleX,t.scaleY=i.scaleY);0===this._animationState._fadeState&&0===this._animationState._subFadeState||(this.bone._transformDirty=!0)},t}(t);n.BoneTimelineState=u;f=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return r(t,n),t.prototype._onClear=function(){n.prototype._onClear.call(this);this.slot=null},t}(t);n.SlotTimelineState=f;e=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return r(t,n),t.prototype._onClear=function(){n.prototype._onClear.call(this);this.constraint=null},t}(t);n.ConstraintTimelineState=e}(i||(i={})),function(n){var v=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return r(i,t),i.toString=function(){return"[class dragonBones.ActionTimelineState]"},i.prototype._onCrossFrame=function(t){var o=this._armature.eventDispatcher,r,i,e;if(this._animationState.actionEnabled)for(var u=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+t],s=this._frameArray[u+1],h=this._animationData.parent.actions,f=0;f<s;++f)r=h[this._frameArray[u+2+f]],0===r.type?((i=n.BaseObject.borrowObject(n.EventObject)).time=this._frameArray[u]/this._frameRate,i.animationState=this._animationState,n.EventObject.actionDataToInstance(r,i,this._armature),this._armature._bufferAction(i,!0)):(e=10===r.type?n.EventObject.FRAME_EVENT:n.EventObject.SOUND_EVENT,(11===r.type||o.hasDBEventListener(e))&&((i=n.BaseObject.borrowObject(n.EventObject)).time=this._frameArray[u]/this._frameRate,i.animationState=this._animationState,n.EventObject.actionDataToInstance(r,i,this._armature),this._armature._dragonBones.bufferEvent(i)))},i.prototype._onArriveAtFrame=function(){},i.prototype._onUpdateFrame=function(){},i.prototype.update=function(t){var y=this.playState,s=this.currentPlayTimes,l=this.currentTime,a,h,i,v,o,u;if(this._setCurrentTime(t)){if(a=this._armature.eventDispatcher,y<0){if(this.playState===y)return;(this._animationState.displayControl&&this._animationState.resetToPose&&this._armature._sortZOrder(null,0),s=this.currentPlayTimes,a.hasDBEventListener(n.EventObject.START))&&(h=n.BaseObject.borrowObject(n.EventObject),h.type=n.EventObject.START,h.armature=this._armature,h.animationState=this._animationState,this._armature._dragonBones.bufferEvent(h))}var p=this._animationState.timeScale<0,r=null,c=null;if(this.currentPlayTimes!==s&&(a.hasDBEventListener(n.EventObject.LOOP_COMPLETE)&&((r=n.BaseObject.borrowObject(n.EventObject)).type=n.EventObject.LOOP_COMPLETE,r.armature=this._armature,r.animationState=this._animationState),this.playState>0&&a.hasDBEventListener(n.EventObject.COMPLETE)&&((c=n.BaseObject.borrowObject(n.EventObject)).type=n.EventObject.COMPLETE,c.armature=this._armature,c.animationState=this._animationState)),this._frameCount>1){var f=this._timelineData,w=Math.floor(this.currentTime*this._frameRate),e=this._frameIndices[f.frameIndicesOffset+w];if(this._frameIndex!==e&&(i=this._frameIndex,this._frameIndex=e,null!==this._timelineArray))if(this._frameOffset=this._animationData.frameOffset+this._timelineArray[f.offset+5+this._frameIndex],p){for(i<0&&(v=Math.floor(l*this._frameRate),i=this._frameIndices[f.frameIndicesOffset+v],this.currentPlayTimes===s&&i===e&&(i=-1));i>=0;)if(o=this._animationData.frameOffset+this._timelineArray[f.offset+5+i],u=this._frameArray[o]/this._frameRate,this._position<=u&&u<=this._position+this._duration&&this._onCrossFrame(i),null!==r&&0===i&&(this._armature._dragonBones.bufferEvent(r),r=null),i>0?i--:i=this._frameCount-1,i===e)break}else for(i<0&&(v=Math.floor(l*this._frameRate),i=this._frameIndices[f.frameIndicesOffset+v],o=this._animationData.frameOffset+this._timelineArray[f.offset+5+i],u=this._frameArray[o]/this._frameRate,this.currentPlayTimes===s&&(l<=u?i>0?i--:i=this._frameCount-1:i===e&&(i=-1)));i>=0&&(i<this._frameCount-1?i++:i=0,o=this._animationData.frameOffset+this._timelineArray[f.offset+5+i],u=this._frameArray[o]/this._frameRate,this._position<=u&&u<=this._position+this._duration&&this._onCrossFrame(i),null!==r&&0===i&&(this._armature._dragonBones.bufferEvent(r),r=null),i!==e););}else this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData)&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5],u=this._frameArray[this._frameOffset]/this._frameRate,this.currentPlayTimes===s?l<=u&&this._onCrossFrame(this._frameIndex):this._position<=u&&(p||null===r||(this._armature._dragonBones.bufferEvent(r),r=null),this._onCrossFrame(this._frameIndex)));null!==r&&this._armature._dragonBones.bufferEvent(r);null!==c&&this._armature._dragonBones.bufferEvent(c)}},i.prototype.setCurrentTime=function(n){this._setCurrentTime(n);this._frameIndex=-1},i}(n.TimelineState),t,i,u,f,e,o,s,h,c,l,a;n.ActionTimelineState=v;t=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return r(t,n),t.toString=function(){return"[class dragonBones.ZOrderTimelineState]"},t.prototype._onArriveAtFrame=function(){this.playState>=0&&(this._frameArray[this._frameOffset+1]>0?this._armature._sortZOrder(this._frameArray,this._frameOffset+2):this._armature._sortZOrder(null,0))},t.prototype._onUpdateFrame=function(){},t}(n.TimelineState);n.ZOrderTimelineState=t;i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return r(i,t),i.toString=function(){return"[class dragonBones.BoneAllTimelineState]"},i.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var r=this._animationData.frameFloatOffset+this._frameValueOffset+6*this._frameIndex,f=this._armature._armatureData.scale,u=this._frameFloatArray,n=this.bonePose.current,i=this.bonePose.delta;n.x=u[r++]*f;n.y=u[r++]*f;n.rotation=u[r++];n.skew=u[r++];n.scaleX=u[r++];n.scaleY=u[r++];2===this._tweenState?(this._frameIndex===this._frameCount-1&&(r=this._animationData.frameFloatOffset+this._frameValueOffset),i.x=u[r++]*f-n.x,i.y=u[r++]*f-n.y,i.rotation=u[r++]-n.rotation,i.skew=u[r++]-n.skew,i.scaleX=u[r++]-n.scaleX,i.scaleY=u[r++]-n.scaleY):(i.x=0,i.y=0,i.rotation=0,i.skew=0,i.scaleX=0,i.scaleY=0)}else n=this.bonePose.current,i=this.bonePose.delta,n.x=0,n.y=0,n.rotation=0,n.skew=0,n.scaleX=1,n.scaleY=1,i.x=0,i.y=0,i.rotation=0,i.skew=0,i.scaleX=0,i.scaleY=0},i.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var n=this.bonePose.current,i=this.bonePose.delta,r=this.bonePose.result;this.bone._transformDirty=!0;2!==this._tweenState&&(this._tweenState=0);r.x=n.x+i.x*this._tweenProgress;r.y=n.y+i.y*this._tweenProgress;r.rotation=n.rotation+i.rotation*this._tweenProgress;r.skew=n.skew+i.skew*this._tweenProgress;r.scaleX=n.scaleX+i.scaleX*this._tweenProgress;r.scaleY=n.scaleY+i.scaleY*this._tweenProgress},i.prototype.fadeOut=function(){var t=this.bonePose.result;t.rotation=n.Transform.normalizeRadian(t.rotation);t.skew=n.Transform.normalizeRadian(t.skew)},i}(n.BoneTimelineState);n.BoneAllTimelineState=i;u=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return r(t,n),t.toString=function(){return"[class dragonBones.BoneTranslateTimelineState]"},t.prototype._onArriveAtFrame=function(){if(n.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var r=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,u=this._armature._armatureData.scale,f=this._frameFloatArray,t=this.bonePose.current,i=this.bonePose.delta;t.x=f[r++]*u;t.y=f[r++]*u;2===this._tweenState?(this._frameIndex===this._frameCount-1&&(r=this._animationData.frameFloatOffset+this._frameValueOffset),i.x=f[r++]*u-t.x,i.y=f[r++]*u-t.y):(i.x=0,i.y=0)}else t=this.bonePose.current,i=this.bonePose.delta,t.x=0,t.y=0,i.x=0,i.y=0},t.prototype._onUpdateFrame=function(){n.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,i=this.bonePose.delta,r=this.bonePose.result;this.bone._transformDirty=!0;2!==this._tweenState&&(this._tweenState=0);r.x=t.x+i.x*this._tweenProgress;r.y=t.y+i.y*this._tweenProgress},t}(n.BoneTimelineState);n.BoneTranslateTimelineState=u;f=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return r(i,t),i.toString=function(){return"[class dragonBones.BoneRotateTimelineState]"},i.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var u=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,f=this._frameFloatArray,i=this.bonePose.current,r=this.bonePose.delta;i.rotation=f[u++];i.skew=f[u++];2===this._tweenState?(this._frameIndex===this._frameCount-1?(u=this._animationData.frameFloatOffset+this._frameValueOffset,r.rotation=n.Transform.normalizeRadian(f[u++]-i.rotation)):r.rotation=f[u++]-i.rotation,r.skew=f[u++]-i.skew):(r.rotation=0,r.skew=0)}else i=this.bonePose.current,r=this.bonePose.delta,i.rotation=0,i.skew=0,r.rotation=0,r.skew=0},i.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var n=this.bonePose.current,i=this.bonePose.delta,r=this.bonePose.result;this.bone._transformDirty=!0;2!==this._tweenState&&(this._tweenState=0);r.rotation=n.rotation+i.rotation*this._tweenProgress;r.skew=n.skew+i.skew*this._tweenProgress},i.prototype.fadeOut=function(){var t=this.bonePose.result;t.rotation=n.Transform.normalizeRadian(t.rotation);t.skew=n.Transform.normalizeRadian(t.skew)},i}(n.BoneTimelineState);n.BoneRotateTimelineState=f;e=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return r(t,n),t.toString=function(){return"[class dragonBones.BoneScaleTimelineState]"},t.prototype._onArriveAtFrame=function(){if(n.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var r=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,u=this._frameFloatArray,t=this.bonePose.current,i=this.bonePose.delta;t.scaleX=u[r++];t.scaleY=u[r++];2===this._tweenState?(this._frameIndex===this._frameCount-1&&(r=this._animationData.frameFloatOffset+this._frameValueOffset),i.scaleX=u[r++]-t.scaleX,i.scaleY=u[r++]-t.scaleY):(i.scaleX=0,i.scaleY=0)}else t=this.bonePose.current,i=this.bonePose.delta,t.scaleX=1,t.scaleY=1,i.scaleX=0,i.scaleY=0},t.prototype._onUpdateFrame=function(){n.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,i=this.bonePose.delta,r=this.bonePose.result;this.bone._transformDirty=!0;2!==this._tweenState&&(this._tweenState=0);r.scaleX=t.scaleX+i.scaleX*this._tweenProgress;r.scaleY=t.scaleY+i.scaleY*this._tweenProgress},t}(n.BoneTimelineState);n.BoneScaleTimelineState=e;o=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t._current=[],t._delta=[],t._result=[],t}return r(t,n),t.toString=function(){return"[class dragonBones.SurfaceTimelineState]"},t.prototype._onClear=function(){n.prototype._onClear.call(this);this.surface=null;this._frameFloatOffset=0;this._valueCount=0;this._deformCount=0;this._valueOffset=0;this._current.length=0;this._delta.length=0;this._result.length=0},t.prototype._onArriveAtFrame=function(){var f,t;if(n.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var i=this._animationData.frameFloatOffset+this._frameValueOffset+this._frameIndex*this._valueCount,r=this._armature._armatureData.scale,u=this._frameFloatArray;if(2===this._tweenState)for(f=i+this._valueCount,this._frameIndex===this._frameCount-1&&(f=this._animationData.frameFloatOffset+this._frameValueOffset),t=0;t<this._valueCount;++t)this._delta[t]=u[f+t]*r-(this._current[t]=u[i+t]*r);else for(t=0;t<this._valueCount;++t)this._current[t]=u[i+t]*r}else for(t=0;t<this._valueCount;++t)this._current[t]=0},t.prototype._onUpdateFrame=function(){n.prototype._onUpdateFrame.call(this);this.surface._transformDirty=!0;2!==this._tweenState&&(this._tweenState=0);for(var t=0;t<this._valueCount;++t)this._result[t]=this._current[t]+this._delta[t]*this._tweenProgress},t.prototype.init=function(t,i,r){var u,f;for((n.prototype.init.call(this,t,i,r),null!==this._timelineData)?(u=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3],this._deformCount=this._frameIntArray[u+1],this._valueCount=this._frameIntArray[u+2],this._valueOffset=this._frameIntArray[u+3],this._frameFloatOffset=this._frameIntArray[u+4]+this._animationData.frameFloatOffset):(this._deformCount=this.surface._deformVertices.length,this._valueCount=this._deformCount,this._valueOffset=0,this._frameFloatOffset=0),this._current.length=this._valueCount,this._delta.length=this._valueCount,this._result.length=this._valueCount,f=0;f<this._valueCount;++f)this._delta[f]=0},t.prototype.blend=function(n){for(var i,r=this.surface._blendState.blendWeight,u=this.surface._deformVertices,t=0;t<this._deformCount;++t)i=t<this._valueOffset?this._frameFloatArray[this._frameFloatOffset+t]:t<this._valueOffset+this._valueCount?this._result[t-this._valueOffset]:this._frameFloatArray[this._frameFloatOffset+t-this._valueCount],2===n?u[t]+=i*r:u[t]=1!==r?i*r:i;0===this._animationState._fadeState&&0===this._animationState._subFadeState||(this.surface._transformDirty=!0)},t}(n.TweenTimelineState);n.SurfaceTimelineState=o;s=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return r(t,n),t.toString=function(){return"[class dragonBones.SlotDislayTimelineState]"},t.prototype._onArriveAtFrame=function(){if(this.playState>=0){var n=null!==this._timelineData?this._frameArray[this._frameOffset+1]:this.slot._slotData.displayIndex;this.slot.displayIndex!==n&&this.slot._setDisplayIndex(n,!0)}},t}(n.SlotTimelineState);n.SlotDislayTimelineState=s;h=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t._current=[0,0,0,0,0,0,0,0],t._delta=[0,0,0,0,0,0,0,0],t._result=[0,0,0,0,0,0,0,0],t}return r(t,n),t.toString=function(){return"[class dragonBones.SlotColorTimelineState]"},t.prototype._onClear=function(){n.prototype._onClear.call(this);this._dirty=!1},t.prototype._onArriveAtFrame=function(){var r;if(n.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var i=this._dragonBonesData.intArray,u=this._frameIntArray,f=this._animationData.frameIntOffset+this._frameValueOffset+1*this._frameIndex,t=u[f];t<0&&(t+=65536);this._current[0]=i[t++];this._current[1]=i[t++];this._current[2]=i[t++];this._current[3]=i[t++];this._current[4]=i[t++];this._current[5]=i[t++];this._current[6]=i[t++];this._current[7]=i[t++];2===this._tweenState&&((t=this._frameIndex===this._frameCount-1?u[this._animationData.frameIntOffset+this._frameValueOffset]:u[f+1])<0&&(t+=65536),this._delta[0]=i[t++]-this._current[0],this._delta[1]=i[t++]-this._current[1],this._delta[2]=i[t++]-this._current[2],this._delta[3]=i[t++]-this._current[3],this._delta[4]=i[t++]-this._current[4],this._delta[5]=i[t++]-this._current[5],this._delta[6]=i[t++]-this._current[6],this._delta[7]=i[t++]-this._current[7])}else r=this.slot._slotData.color,this._current[0]=100*r.alphaMultiplier,this._current[1]=100*r.redMultiplier,this._current[2]=100*r.greenMultiplier,this._current[3]=100*r.blueMultiplier,this._current[4]=r.alphaOffset,this._current[5]=r.redOffset,this._current[6]=r.greenOffset,this._current[7]=r.blueOffset},t.prototype._onUpdateFrame=function(){n.prototype._onUpdateFrame.call(this);this._dirty=!0;2!==this._tweenState&&(this._tweenState=0);this._result[0]=.01*(this._current[0]+this._delta[0]*this._tweenProgress);this._result[1]=.01*(this._current[1]+this._delta[1]*this._tweenProgress);this._result[2]=.01*(this._current[2]+this._delta[2]*this._tweenProgress);this._result[3]=.01*(this._current[3]+this._delta[3]*this._tweenProgress);this._result[4]=this._current[4]+this._delta[4]*this._tweenProgress;this._result[5]=this._current[5]+this._delta[5]*this._tweenProgress;this._result[6]=this._current[6]+this._delta[6]*this._tweenProgress;this._result[7]=this._current[7]+this._delta[7]*this._tweenProgress},t.prototype.fadeOut=function(){this._tweenState=0;this._dirty=!1},t.prototype.update=function(t){var i,r;(n.prototype.update.call(this,t),0!==this._tweenState||this._dirty)&&(i=this.slot._colorTransform,0!==this._animationState._fadeState||0!==this._animationState._subFadeState?(i.alphaMultiplier!==this._result[0]||i.redMultiplier!==this._result[1]||i.greenMultiplier!==this._result[2]||i.blueMultiplier!==this._result[3]||i.alphaOffset!==this._result[4]||i.redOffset!==this._result[5]||i.greenOffset!==this._result[6]||i.blueOffset!==this._result[7])&&(r=Math.pow(this._animationState._fadeProgress,4),i.alphaMultiplier+=(this._result[0]-i.alphaMultiplier)*r,i.redMultiplier+=(this._result[1]-i.redMultiplier)*r,i.greenMultiplier+=(this._result[2]-i.greenMultiplier)*r,i.blueMultiplier+=(this._result[3]-i.blueMultiplier)*r,i.alphaOffset+=(this._result[4]-i.alphaOffset)*r,i.redOffset+=(this._result[5]-i.redOffset)*r,i.greenOffset+=(this._result[6]-i.greenOffset)*r,i.blueOffset+=(this._result[7]-i.blueOffset)*r,this.slot._colorDirty=!0):this._dirty&&(this._dirty=!1,i.alphaMultiplier===this._result[0]&&i.redMultiplier===this._result[1]&&i.greenMultiplier===this._result[2]&&i.blueMultiplier===this._result[3]&&i.alphaOffset===this._result[4]&&i.redOffset===this._result[5]&&i.greenOffset===this._result[6]&&i.blueOffset===this._result[7]||(i.alphaMultiplier=this._result[0],i.redMultiplier=this._result[1],i.greenMultiplier=this._result[2],i.blueMultiplier=this._result[3],i.alphaOffset=this._result[4],i.redOffset=this._result[5],i.greenOffset=this._result[6],i.blueOffset=this._result[7],this.slot._colorDirty=!0)))},t}(n.SlotTimelineState);n.SlotColorTimelineState=h;c=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t._current=[],t._delta=[],t._result=[],t}return r(t,n),t.toString=function(){return"[class dragonBones.DeformTimelineState]"},t.prototype._onClear=function(){n.prototype._onClear.call(this);this.vertexOffset=0;this._dirty=!1;this._frameFloatOffset=0;this._valueCount=0;this._deformCount=0;this._valueOffset=0;this._current.length=0;this._delta.length=0;this._result.length=0},t.prototype._onArriveAtFrame=function(){var f,t;if(n.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var i=this._animationData.frameFloatOffset+this._frameValueOffset+this._frameIndex*this._valueCount,r=this._armature._armatureData.scale,u=this._frameFloatArray;if(2===this._tweenState)for(f=i+this._valueCount,this._frameIndex===this._frameCount-1&&(f=this._animationData.frameFloatOffset+this._frameValueOffset),t=0;t<this._valueCount;++t)this._delta[t]=u[f+t]*r-(this._current[t]=u[i+t]*r);else for(t=0;t<this._valueCount;++t)this._current[t]=u[i+t]*r}else for(t=0;t<this._valueCount;++t)this._current[t]=0},t.prototype._onUpdateFrame=function(){n.prototype._onUpdateFrame.call(this);this._dirty=!0;2!==this._tweenState&&(this._tweenState=0);for(var t=0;t<this._valueCount;++t)this._result[t]=this._current[t]+this._delta[t]*this._tweenProgress},t.prototype.init=function(t,i,r){var u,e,f;for((n.prototype.init.call(this,t,i,r),null!==this._timelineData)?(u=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3],this.vertexOffset=this._frameIntArray[u+0],this.vertexOffset<0&&(this.vertexOffset+=65536),this._deformCount=this._frameIntArray[u+1],this._valueCount=this._frameIntArray[u+2],this._valueOffset=this._frameIntArray[u+3],this._frameFloatOffset=this._frameIntArray[u+4]+this._animationData.frameFloatOffset):(e=this.slot._deformVertices,this._deformCount=null!==e?e.vertices.length:0,this._valueCount=this._deformCount,this._valueOffset=0,this._frameFloatOffset=0),this._current.length=this._valueCount,this._delta.length=this._valueCount,this._result.length=this._valueCount,f=0;f<this._valueCount;++f)this._delta[f]=0},t.prototype.fadeOut=function(){this._tweenState=0;this._dirty=!1},t.prototype.update=function(t){var r=this.slot._deformVertices,u,f,i;if(null!==r&&null!==r.verticesData&&r.verticesData.offset===this.vertexOffset&&(n.prototype.update.call(this,t),0!==this._tweenState||this._dirty))if(u=r.vertices,0!==this._animationState._fadeState||0!==this._animationState._subFadeState){for(f=Math.pow(this._animationState._fadeProgress,2),i=0;i<this._deformCount;++i)u[i]+=i<this._valueOffset?(this._frameFloatArray[this._frameFloatOffset+i]-u[i])*f:i<this._valueOffset+this._valueCount?(this._result[i-this._valueOffset]-u[i])*f:(this._frameFloatArray[this._frameFloatOffset+i-this._valueCount]-u[i])*f;r.verticesDirty=!0}else if(this._dirty){for(this._dirty=!1,i=0;i<this._deformCount;++i)u[i]=i<this._valueOffset?this._frameFloatArray[this._frameFloatOffset+i]:i<this._valueOffset+this._valueCount?this._result[i-this._valueOffset]:this._frameFloatArray[this._frameFloatOffset+i-this._valueCount];r.verticesDirty=!0}},t}(n.SlotTimelineState);n.DeformTimelineState=c;l=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return r(t,n),t.toString=function(){return"[class dragonBones.IKConstraintTimelineState]"},t.prototype._onClear=function(){n.prototype._onClear.call(this);this._current=0;this._delta=0},t.prototype._onArriveAtFrame=function(){var t,u;if(n.prototype._onArriveAtFrame.call(this),t=this.constraint,null!==this._timelineData){var i=this._animationData.frameIntOffset+this._frameValueOffset+2*this._frameIndex,r=this._frameIntArray,f=0!==r[i++];this._current=.01*r[i++];2===this._tweenState?(this._frameIndex===this._frameCount-1&&(i=this._animationData.frameIntOffset+this._frameValueOffset),this._delta=.01*r[i+1]-this._current):this._delta=0;t._bendPositive=f}else u=t._constraintData,this._current=u.weight,this._delta=0,t._bendPositive=u.bendPositive;t.invalidUpdate()},t.prototype._onUpdateFrame=function(){n.prototype._onUpdateFrame.call(this);2!==this._tweenState&&(this._tweenState=0);var t=this.constraint;t._weight=this._current+this._delta*this._tweenProgress;t.invalidUpdate()},t}(n.ConstraintTimelineState);n.IKConstraintTimelineState=l;a=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t._floats=[0,0,0,0,0,0],t}return r(t,n),t.toString=function(){return"[class dragonBones.AnimationTimelineState]"},t.prototype._onClear=function(){n.prototype._onClear.call(this);this.animationState=null},t.prototype._onArriveAtFrame=function(){if(n.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var t=this._animationData.frameIntOffset+this._frameValueOffset+2*this._frameIndex,r=1/this.animationState._animationData.parent.frameRate,i=this._frameIntArray;this._floats[0]=i[t++]*r;this._floats[3]=.01*i[t++];2===this._tweenState?(this._frameIndex===this._frameCount-1&&(t=this._animationData.frameIntOffset+this._frameValueOffset),this._floats[1]=i[t++]*r-this._floats[0],this._floats[4]=.01*i[t++]-this._floats[3]):(this._floats[1]=0,this._floats[4]=0)}},t.prototype._onUpdateFrame=function(){n.prototype._onUpdateFrame.call(this);2!==this._tweenState&&(this._tweenState=0);this._floats[0]>=0&&(this._floats[2]=this._floats[0]+this._floats[1]*this._tweenProgress);this._floats[5]=this._floats[3]+this._floats[4]*this._tweenProgress},t.prototype.blend=function(n){var t=this.animationState,i=t._blendState.blendWeight;2===n?(t.weight+=this._floats[5]*i,t.currentTime+=this._floats[2]*i):(t.weight=this._floats[5]*i,t.currentTime=this._floats[2]*i)},t}(n.TweenTimelineState);n.AnimationTimelineState=a}(i||(i={})),function(n){var t=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return r(t,n),t.actionDataToInstance=function(n,i,r){i.type=0===n.type?t.FRAME_EVENT:10===n.type?t.FRAME_EVENT:t.SOUND_EVENT;i.name=n.name;i.armature=r;i.actionData=n;i.data=n.data;null!==n.bone&&(i.bone=r.getBone(n.bone.name));null!==n.slot&&(i.slot=r.getSlot(n.slot.name))},t.toString=function(){return"[class dragonBones.EventObject]"},t.prototype._onClear=function(){this.time=0;this.type="";this.name="";this.armature=null;this.bone=null;this.slot=null;this.animationState=null;this.actionData=null;this.data=null},t.START="start",t.LOOP_COMPLETE="loopComplete",t.COMPLETE="complete",t.FADE_IN="fadeIn",t.FADE_IN_COMPLETE="fadeInComplete",t.FADE_OUT="fadeOut",t.FADE_OUT_COMPLETE="fadeOutComplete",t.FRAME_EVENT="frameEvent",t.SOUND_EVENT="soundEvent",t}(n.BaseObject);n.EventObject=t}(i||(i={})),function(n){var t=function(){function t(){}return t._getArmatureType=function(n){switch(n.toLowerCase()){case"stage":return 2;case"armature":return 0;case"movieclip":return 1;default:return 0}},t._getBoneType=function(n){switch(n.toLowerCase()){case"bone":return 0;case"surface":return 1;default:return 0}},t._getDisplayType=function(n){switch(n.toLowerCase()){case"image":return 0;case"mesh":return 2;case"armature":return 1;case"boundingbox":return 3;case"path":return 4;default:return 0}},t._getBoundingBoxType=function(n){switch(n.toLowerCase()){case"rectangle":return 0;case"ellipse":return 1;case"polygon":return 2;default:return 0}},t._getActionType=function(n){switch(n.toLowerCase()){case"play":return 0;case"frame":return 10;case"sound":return 11;default:return 0}},t._getBlendMode=function(n){switch(n.toLowerCase()){case"normal":return 0;case"add":return 1;case"alpha":return 2;case"darken":return 3;case"difference":return 4;case"erase":return 5;case"hardlight":return 6;case"invert":return 7;case"layer":return 8;case"lighten":return 9;case"multiply":return 10;case"overlay":return 11;case"screen":return 12;case"subtract":return 13;default:return 0}},t._getPositionMode=function(n){switch(n.toLocaleLowerCase()){case"percent":return 1;case"fixed":return 0;default:return 1}},t._getSpacingMode=function(n){switch(n.toLocaleLowerCase()){case"length":return 0;case"percent":return 2;case"fixed":return 1;default:return 0}},t._getRotateMode=function(n){switch(n.toLocaleLowerCase()){case"tangent":return 0;case"chain":return 1;case"chainscale":return 2;default:return 0}},t.parseDragonBonesData=function(t){return console.warn("Deprecated."),t instanceof ArrayBuffer?n.BinaryDataParser.getInstance().parseDragonBonesData(t):n.ObjectDataParser.getInstance().parseDragonBonesData(t)},t.parseTextureAtlasData=function(i,r){void 0===r&&(r=1);console.warn("");for(var s={},h=i[t.SUB_TEXTURE],o=0,c=h.length;o<c;o++){var u=h[o],l=u[t.NAME],f=new n.Rectangle,e=null;f.x=u[t.X]/r;f.y=u[t.Y]/r;f.width=u[t.WIDTH]/r;f.height=u[t.HEIGHT]/r;t.FRAME_WIDTH in u&&((e=new n.Rectangle).x=u[t.FRAME_X]/r,e.y=u[t.FRAME_Y]/r,e.width=u[t.FRAME_WIDTH]/r,e.height=u[t.FRAME_HEIGHT]/r);s[l]={region:f,frame:e,rotated:!1}}return s},t.DATA_VERSION_2_3="2.3",t.DATA_VERSION_3_0="3.0",t.DATA_VERSION_4_0="4.0",t.DATA_VERSION_4_5="4.5",t.DATA_VERSION_5_0="5.0",t.DATA_VERSION_5_5="5.5",t.DATA_VERSION=t.DATA_VERSION_5_5,t.DATA_VERSIONS=[t.DATA_VERSION_4_0,t.DATA_VERSION_4_5,t.DATA_VERSION_5_0,t.DATA_VERSION_5_5],t.TEXTURE_ATLAS="textureAtlas",t.SUB_TEXTURE="SubTexture",t.FORMAT="format",t.IMAGE_PATH="imagePath",t.WIDTH="width",t.HEIGHT="height",t.ROTATED="rotated",t.FRAME_X="frameX",t.FRAME_Y="frameY",t.FRAME_WIDTH="frameWidth",t.FRAME_HEIGHT="frameHeight",t.DRADON_BONES="dragonBones",t.USER_DATA="userData",t.ARMATURE="armature",t.BONE="bone",t.SURFACE="surface",t.SLOT="slot",t.CONSTRAINT="constraint",t.IK="ik",t.PATH_CONSTRAINT="path",t.SKIN="skin",t.DISPLAY="display",t.ANIMATION="animation",t.Z_ORDER="zOrder",t.FFD="ffd",t.FRAME="frame",t.TRANSLATE_FRAME="translateFrame",t.ROTATE_FRAME="rotateFrame",t.SCALE_FRAME="scaleFrame",t.DISPLAY_FRAME="displayFrame",t.COLOR_FRAME="colorFrame",t.DEFAULT_ACTIONS="defaultActions",t.ACTIONS="actions",t.EVENTS="events",t.INTS="ints",t.FLOATS="floats",t.STRINGS="strings",t.CANVAS="canvas",t.TRANSFORM="transform",t.PIVOT="pivot",t.AABB="aabb",t.COLOR="color",t.VERSION="version",t.COMPATIBLE_VERSION="compatibleVersion",t.FRAME_RATE="frameRate",t.TYPE="type",t.SUB_TYPE="subType",t.NAME="name",t.PARENT="parent",t.TARGET="target",t.STAGE="stage",t.SHARE="share",t.PATH="path",t.LENGTH="length",t.DISPLAY_INDEX="displayIndex",t.BLEND_MODE="blendMode",t.INHERIT_TRANSLATION="inheritTranslation",t.INHERIT_ROTATION="inheritRotation",t.INHERIT_SCALE="inheritScale",t.INHERIT_REFLECTION="inheritReflection",t.INHERIT_ANIMATION="inheritAnimation",t.INHERIT_DEFORM="inheritDeform",t.SEGMENT_X="segmentX",t.SEGMENT_Y="segmentY",t.BEND_POSITIVE="bendPositive",t.CHAIN="chain",t.WEIGHT="weight",t.FADE_IN_TIME="fadeInTime",t.PLAY_TIMES="playTimes",t.SCALE="scale",t.OFFSET="offset",t.POSITION="position",t.DURATION="duration",t.TWEEN_EASING="tweenEasing",t.TWEEN_ROTATE="tweenRotate",t.TWEEN_SCALE="tweenScale",t.CLOCK_WISE="clockwise",t.CURVE="curve",t.SOUND="sound",t.EVENT="event",t.ACTION="action",t.X="x",t.Y="y",t.SKEW_X="skX",t.SKEW_Y="skY",t.SCALE_X="scX",t.SCALE_Y="scY",t.VALUE="value",t.ROTATE="rotate",t.SKEW="skew",t.ALPHA_OFFSET="aO",t.RED_OFFSET="rO",t.GREEN_OFFSET="gO",t.BLUE_OFFSET="bO",t.ALPHA_MULTIPLIER="aM",t.RED_MULTIPLIER="rM",t.GREEN_MULTIPLIER="gM",t.BLUE_MULTIPLIER="bM",t.UVS="uvs",t.VERTICES="vertices",t.TRIANGLES="triangles",t.WEIGHTS="weights",t.SLOT_POSE="slotPose",t.BONE_POSE="bonePose",t.GLUE_WEIGHTS="glueWeights",t.GLUE_MESHES="glueMeshes",t.BONES="bones",t.POSITION_MODE="positionMode",t.SPACING_MODE="spacingMode",t.ROTATE_MODE="rotateMode",t.SPACING="spacing",t.ROTATE_OFFSET="rotateOffset",t.ROTATE_MIX="rotateMix",t.TRANSLATE_MIX="translateMix",t.TARGET_DISPLAY="targetDisplay",t.CLOSED="closed",t.CONSTANT_SPEED="constantSpeed",t.VERTEX_COUNT="vertexCount",t.LENGTHS="lengths",t.GOTO_AND_PLAY="gotoAndPlay",t.DEFAULT_NAME="default",t}();n.DataParser=t}(i||(i={})),function(n){var i=function(i){function u(){var t=null!==i&&i.apply(this,arguments)||this;return t._rawTextureAtlasIndex=0,t._rawBones=[],t._data=null,t._armature=null,t._bone=null,t._surface=null,t._slot=null,t._skin=null,t._mesh=null,t._animation=null,t._timeline=null,t._rawTextureAtlases=null,t._defaultColorOffset=-1,t._prevClockwise=0,t._prevRotation=0,t._helpMatrixA=new n.Matrix,t._helpMatrixB=new n.Matrix,t._helpTransform=new n.Transform,t._helpColorTransform=new n.ColorTransform,t._helpPoint=new n.Point,t._helpArray=[],t._intArray=[],t._floatArray=[],t._frameIntArray=[],t._frameFloatArray=[],t._frameArray=[],t._timelineArray=[],t._cacheRawMeshes=[],t._cacheMeshes=[],t._actionFrames=[],t._weightSlotPose={},t._weightBonePoses={},t._cacheBones={},t._slotChildActions={},t}return r(u,i),u._getBoolean=function(n,t,i){if(t in n){var r=n[t],u=typeof r;if("boolean"===u)return r;if("string"!==u)return!!r;switch(r){case"0":case"NaN":case"":case"false":case"null":case"undefined":return!1;default:return!0}}return i},u._getNumber=function(n,t,i){if(t in n){var r=n[t];return null===r||"NaN"===r?i:+r||0}return i},u._getString=function(t,i,r){var u,f,e;if(i in t){if(u=t[i],"string"==typeof u){if(n.DragonBones.webAssembly)for(f=0,e=u.length;f<e;++f)if(u.charCodeAt(f)>255)return encodeURI(u);return u}return String(u)}return r},u.prototype._getCurvePoint=function(n,t,i,r,u,f,e,o,s,h){var c=1-s,l=c*c,a=s*s,v=c*l,y=3*s*l,p=3*c*a,w=s*a;h.x=v*n+y*i+p*u+w*e;h.y=v*t+y*r+p*f+w*o},u.prototype._samplingEasingCurve=function(n,t){for(var e,f,h=n.length,i=-2,r=0,c=t.length;r<c;++r){for(e=(r+1)/(c+1);(i+6<h?n[i+6]:1)<e;)i+=6;for(var u=i>=0&&i+6<h,l=u?n[i]:0,a=u?n[i+1]:0,v=n[i+2],y=n[i+3],p=n[i+4],w=n[i+5],b=u?n[i+6]:1,k=u?n[i+7]:1,o=0,s=1;s-o>.0001;)f=.5*(s+o),this._getCurvePoint(l,a,v,y,p,w,b,k,f,this._helpPoint),e-this._helpPoint.x>0?o=f:s=f;t[r]=this._helpPoint.y}},u.prototype._parseActionDataInFrame=function(t,i,r,u){n.DataParser.EVENT in t&&this._mergeActionFrame(t[n.DataParser.EVENT],i,10,r,u);n.DataParser.SOUND in t&&this._mergeActionFrame(t[n.DataParser.SOUND],i,11,r,u);n.DataParser.ACTION in t&&this._mergeActionFrame(t[n.DataParser.ACTION],i,0,r,u);n.DataParser.EVENTS in t&&this._mergeActionFrame(t[n.DataParser.EVENTS],i,10,r,u);n.DataParser.ACTIONS in t&&this._mergeActionFrame(t[n.DataParser.ACTIONS],i,0,r,u)},u.prototype._mergeActionFrame=function(i,r,u,f,e){for(var w,s,a,h,c,b=n.DragonBones.webAssembly?this._armature.actions.size():this._armature.actions.length,v=this._parseActionData(i,u,f,e),y=0,o=null,l=0,p=v;l<p.length;l++)w=p[l],this._armature.addAction(w,!1);for(0===this._actionFrames.length&&((o=new t).frameStart=0,this._actionFrames.push(o),o=null),s=0,a=this._actionFrames;s<a.length;s++){if(h=a[s],h.frameStart===r){o=h;break}if(h.frameStart>r)break;y++}for(null===o&&((o=new t).frameStart=r,this._actionFrames.splice(y+1,0,o)),c=0;c<v.length;++c)o.actions.push(b+c)},u.prototype._parseArmature=function(t,i){var r=n.BaseObject.borrowObject(n.ArmatureData),h,e,l,v,ft,et,y,ot,p,st,dt,ni,w,ct,ti,b,lt,k,ii,f,d,g,at,vt,nt,yt,tt,pt,ri,it,rt,wt,c,ut,bt,s;if((r.name=u._getString(t,n.DataParser.NAME,""),r.frameRate=u._getNumber(t,n.DataParser.FRAME_RATE,this._data.frameRate),r.scale=i,r.type=n.DataParser.TYPE in t&&"string"==typeof t[n.DataParser.TYPE]?n.DataParser._getArmatureType(t[n.DataParser.TYPE]):u._getNumber(t,n.DataParser.TYPE,0),0===r.frameRate&&(r.frameRate=24),this._armature=r,n.DataParser.CANVAS in t)&&(h=t[n.DataParser.CANVAS],e=n.BaseObject.borrowObject(n.CanvasData),e.hasBackground=n.DataParser.COLOR in h?!0:!1,e.color=u._getNumber(h,n.DataParser.COLOR,0),e.x=u._getNumber(h,n.DataParser.X,0)*r.scale,e.y=u._getNumber(h,n.DataParser.Y,0)*r.scale,e.width=u._getNumber(h,n.DataParser.WIDTH,0)*r.scale,e.height=u._getNumber(h,n.DataParser.HEIGHT,0)*r.scale,r.canvas=e),n.DataParser.AABB in t&&(l=t[n.DataParser.AABB],r.aabb.x=u._getNumber(l,n.DataParser.X,0)*r.scale,r.aabb.y=u._getNumber(l,n.DataParser.Y,0)*r.scale,r.aabb.width=u._getNumber(l,n.DataParser.WIDTH,0)*r.scale,r.aabb.height=u._getNumber(l,n.DataParser.HEIGHT,0)*r.scale),n.DataParser.BONE in t)for(v=0,ft=t[n.DataParser.BONE];v<ft.length;v++){var kt=ft[v],a=u._getString(kt,n.DataParser.PARENT,""),o=this._parseBone(kt);if(a.length>0&&(et=r.getBone(a),null!==et?o.parent=et:(a in this._cacheBones||(this._cacheBones[a]=[]),this._cacheBones[a].push(o))),o.name in this._cacheBones){for(y=0,ot=this._cacheBones[o.name];y<ot.length;y++)ot[y].parent=o;delete this._cacheBones[o.name]}r.addBone(o);this._rawBones.push(o)}if(n.DataParser.IK in t)for(p=0,st=t[n.DataParser.IK];p<st.length;p++)dt=st[p],(k=this._parseIKConstraint(dt))&&r.addConstraint(k);if(r.sortBones(),n.DataParser.SLOT in t)for(var ui=0,ht=0,gt=t[n.DataParser.SLOT];ht<gt.length;ht++)ni=gt[ht],r.addSlot(this._parseSlot(ni,ui++));if(n.DataParser.SKIN in t)for(w=0,ct=t[n.DataParser.SKIN];w<ct.length;w++)ti=ct[w],r.addSkin(this._parseSkin(ti));if(n.DataParser.PATH_CONSTRAINT in t)for(b=0,lt=t[n.DataParser.PATH_CONSTRAINT];b<lt.length;b++)ii=lt[b],(k=this._parsePathConstraint(ii))&&r.addConstraint(k);for(f=0,d=this._cacheRawMeshes.length;f<d;++f)g=this._cacheRawMeshes[f],n.DataParser.GLUE_WEIGHTS in g&&n.DataParser.GLUE_MESHES in g&&this._parseMeshGlue(g,this._cacheMeshes[f]);for(f=0,d=this._cacheRawMeshes.length;f<d;++f)at=this._cacheRawMeshes[f],vt=u._getString(at,n.DataParser.SHARE,""),0!==vt.length&&(nt=u._getString(at,n.DataParser.SKIN,n.DataParser.DEFAULT_NAME),0===nt.length&&(nt=n.DataParser.DEFAULT_NAME),yt=r.getMesh(nt,"",vt),null!==yt&&this._cacheMeshes[f].vertices.shareFrom(yt.vertices));if(n.DataParser.ANIMATION in t)for(tt=0,pt=t[n.DataParser.ANIMATION];tt<pt.length;tt++)ri=pt[tt],it=this._parseAnimation(ri),r.addAnimation(it);if(n.DataParser.DEFAULT_ACTIONS in t)for(rt=0,wt=this._parseActionData(t[n.DataParser.DEFAULT_ACTIONS],0,null,null);rt<wt.length;rt++)c=wt[rt],r.addAction(c,!0),0===c.type&&null!==(it=r.getAnimation(c.name))&&(r.defaultAnimation=it);if(n.DataParser.ACTIONS in t)for(ut=0,bt=this._parseActionData(t[n.DataParser.ACTIONS],0,null,null);ut<bt.length;ut++)c=bt[ut],r.addAction(c,!1);for(s in this._rawBones.length=0,this._cacheRawMeshes.length=0,this._cacheMeshes.length=0,this._armature=null,this._weightSlotPose)delete this._weightSlotPose[s];for(s in this._weightBonePoses)delete this._weightBonePoses[s];for(s in this._cacheBones)delete this._cacheBones[s];for(s in this._slotChildActions)delete this._slotChildActions[s];return r},u.prototype._parseBone=function(t){var e=this._armature.scale,r,i;if(0===(n.DataParser.TYPE in t&&"string"==typeof t[n.DataParser.TYPE]?n.DataParser._getBoneType(t[n.DataParser.TYPE]):u._getNumber(t,n.DataParser.TYPE,0)))return r=n.BaseObject.borrowObject(n.BoneData),r.inheritTranslation=u._getBoolean(t,n.DataParser.INHERIT_TRANSLATION,!0),r.inheritRotation=u._getBoolean(t,n.DataParser.INHERIT_ROTATION,!0),r.inheritScale=u._getBoolean(t,n.DataParser.INHERIT_SCALE,!0),r.inheritReflection=u._getBoolean(t,n.DataParser.INHERIT_REFLECTION,!0),r.length=u._getNumber(t,n.DataParser.LENGTH,0)*e,r.name=u._getString(t,n.DataParser.NAME,""),n.DataParser.TRANSFORM in t&&this._parseTransform(t[n.DataParser.TRANSFORM],r.transform,e),r;if(i=n.BaseObject.borrowObject(n.SurfaceData),i.name=u._getString(t,n.DataParser.NAME,""),i.segmentX=u._getNumber(t,n.DataParser.SEGMENT_X,0),i.segmentY=u._getNumber(t,n.DataParser.SEGMENT_Y,0),i.vertices.length=(i.segmentX+1)*(i.segmentY+1)*2,n.DataParser.VERTICES in t)for(var o=t[n.DataParser.VERTICES],f=0,s=i.vertices.length;f<s;++f)i.vertices[f]=f<o.length?o[f]*e:0;return i},u.prototype._parseIKConstraint=function(t){var r=this._armature.getBone(u._getString(t,n.DataParser.BONE,"")),f,i;return null===r?null:(f=this._armature.getBone(u._getString(t,n.DataParser.TARGET,"")),null===f)?null:(i=n.BaseObject.borrowObject(n.IKConstraintData),i.scaleEnabled=u._getBoolean(t,n.DataParser.SCALE,!1),i.bendPositive=u._getBoolean(t,n.DataParser.BEND_POSITIVE,!0),i.weight=u._getNumber(t,n.DataParser.WEIGHT,1),i.name=u._getString(t,n.DataParser.NAME,""),i.type=0,i.target=f,u._getNumber(t,n.DataParser.CHAIN,0)>0&&null!==r.parent?(i.root=r.parent,i.bone=r):(i.root=r,i.bone=null),i)},u.prototype._parsePathConstraint=function(t){var r=this._armature.getSlot(u._getString(t,n.DataParser.TARGET,"")),h,f,e,i,o,c,l,s;if(null===r||(h=this._armature.defaultSkin,null===h)||(f=h.getDisplay(r.name,u._getString(t,n.DataParser.TARGET_DISPLAY,r.name)),null===f||!(f instanceof n.PathDisplayData))||(e=t[n.DataParser.BONES],null===e||0===e.length))return null;for(i=n.BaseObject.borrowObject(n.PathConstraintData),i.name=u._getString(t,n.DataParser.NAME,""),i.type=1,i.pathSlot=r,i.pathDisplayData=f,i.target=r.parent,i.positionMode=n.DataParser._getPositionMode(u._getString(t,n.DataParser.POSITION_MODE,"")),i.spacingMode=n.DataParser._getSpacingMode(u._getString(t,n.DataParser.SPACING_MODE,"")),i.rotateMode=n.DataParser._getRotateMode(u._getString(t,n.DataParser.ROTATE_MODE,"")),i.position=u._getNumber(t,n.DataParser.POSITION,0),i.spacing=u._getNumber(t,n.DataParser.SPACING,0),i.rotateOffset=u._getNumber(t,n.DataParser.ROTATE_OFFSET,0),i.rotateMix=u._getNumber(t,n.DataParser.ROTATE_MIX,1),i.translateMix=u._getNumber(t,n.DataParser.TRANSLATE_MIX,1),o=0,c=e;o<c.length;o++)l=c[o],s=this._armature.getBone(l),null!==s&&(i.AddBone(s),null===i.root&&(i.root=s));return i},u.prototype._parseSlot=function(t,i){var r=n.BaseObject.borrowObject(n.SlotData);return r.displayIndex=u._getNumber(t,n.DataParser.DISPLAY_INDEX,0),r.zOrder=i,r.name=u._getString(t,n.DataParser.NAME,""),r.parent=this._armature.getBone(u._getString(t,n.DataParser.PARENT,"")),r.blendMode=n.DataParser.BLEND_MODE in t&&"string"==typeof t[n.DataParser.BLEND_MODE]?n.DataParser._getBlendMode(t[n.DataParser.BLEND_MODE]):u._getNumber(t,n.DataParser.BLEND_MODE,0),n.DataParser.COLOR in t?(r.color=n.SlotData.createColor(),this._parseColorTransform(t[n.DataParser.COLOR],r.color)):r.color=n.SlotData.DEFAULT_COLOR,n.DataParser.ACTIONS in t&&(this._slotChildActions[r.name]=this._parseActionData(t[n.DataParser.ACTIONS],0,null,null)),r},u.prototype._parseSkin=function(t){var i=n.BaseObject.borrowObject(n.SkinData),l,r,e,f,h,c;if(i.name=u._getString(t,n.DataParser.NAME,n.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=n.DataParser.DEFAULT_NAME),n.DataParser.SLOT in t){for(l=t[n.DataParser.SLOT],this._skin=i,r=0,e=l;r<e.length;r++){var o=e[r],s=u._getString(o,n.DataParser.NAME,""),a=this._armature.getSlot(s);if(null!==a){if(this._slot=a,n.DataParser.DISPLAY in o)for(f=0,h=o[n.DataParser.DISPLAY];f<h.length;f++)c=h[f],c?i.addDisplay(s,this._parseDisplay(c)):i.addDisplay(s,null);this._slot=null}}this._skin=null}return i},u.prototype._parseDisplay=function(t){var i=u._getString(t,n.DataParser.NAME,""),r=u._getString(t,n.DataParser.PATH,""),g=0,e=null,c,s,l,w,a,b,v,k,o,d,y,p,f,h,nt;switch(g=n.DataParser.TYPE in t&&"string"==typeof t[n.DataParser.TYPE]?n.DataParser._getDisplayType(t[n.DataParser.TYPE]):u._getNumber(t,n.DataParser.TYPE,g)){case 0:c=e=n.BaseObject.borrowObject(n.ImageDisplayData);c.name=i;c.path=r.length>0?r:i;this._parsePivot(t,c);break;case 1:if(s=e=n.BaseObject.borrowObject(n.ArmatureDisplayData),s.name=i,s.path=r.length>0?r:i,s.inheritAnimation=!0,n.DataParser.ACTIONS in t)for(l=0,w=this._parseActionData(t[n.DataParser.ACTIONS],0,null,null);l<w.length;l++)a=w[l],s.addAction(a);else if(this._slot.name in this._slotChildActions&&(b=this._skin.getDisplays(this._slot.name),null===b?0===this._slot.displayIndex:this._slot.displayIndex===b.length)){for(v=0,k=this._slotChildActions[this._slot.name];v<k.length;v++)a=k[v],s.addAction(a);delete this._slotChildActions[this._slot.name]}break;case 2:o=e=n.BaseObject.borrowObject(n.MeshDisplayData);o.vertices.inheritDeform=u._getBoolean(t,n.DataParser.INHERIT_DEFORM,!0);o.name=i;o.path=r.length>0?r:i;o.vertices.data=this._data;n.DataParser.SHARE in t?(this._cacheRawMeshes.push(t),this._cacheMeshes.push(o)):this._parseMesh(t,o);n.DataParser.GLUE_WEIGHTS in t&&n.DataParser.GLUE_MESHES in t&&(this._cacheRawMeshes.push(t),this._cacheMeshes.push(o));break;case 3:d=this._parseBoundingBox(t);null!==d&&(y=e=n.BaseObject.borrowObject(n.BoundingBoxDisplayData),y.name=i,y.path=r.length>0?r:i,y.boundingBox=d);break;case 4:for(p=t[n.DataParser.LENGTHS],f=e=n.BaseObject.borrowObject(n.PathDisplayData),f.closed=u._getBoolean(t,n.DataParser.CLOSED,!1),f.constantSpeed=u._getBoolean(t,n.DataParser.CONSTANT_SPEED,!1),f.name=i,f.path=r.length>0?r:i,f.vertices.data=this._data,f.curveLengths.length=p.length,h=0,nt=p.length;h<nt;++h)f.curveLengths[h]=p[h];this._parsePath(t,f)}return null!==e&&n.DataParser.TRANSFORM in t&&this._parseTransform(t[n.DataParser.TRANSFORM],e.transform,this._armature.scale),e},u.prototype._parsePath=function(t,i){var f=t[n.DataParser.VERTICES],l=u._getNumber(t,n.DataParser.VERTEX_COUNT,0),d=this._floatArray.length,a=this._intArray.length,nt,y,b,k,r,rt;if(i.vertices.offset=a,this._intArray.length+=2,this._intArray[a+0]=l,this._intArray[a+2]=d,n.DataParser.WEIGHTS in t){var o=t[n.DataParser.WEIGHTS],v=t[n.DataParser.BONES],s=v.length,h=Math.floor(o.length-l)/2,e=this._intArray.length,g=this._floatArray.length,ut=this._armature.sortedBones,c=n.BaseObject.borrowObject(n.WeightData);for(c.count=h,c.offset=e,this._intArray.length+=2+s+l+h,this._intArray[e+0]=s,this._intArray[e+1]=g,r=0;r<s;r++)nt=v[r],y=this._rawBones[nt],c.addBone(y),this._intArray[e+2+r]=ut.indexOf(y);this._floatArray.length+=3*h;r=0;for(var p=0,tt=0,it=e+2+s,w=g;r<h;r++)for(b=o[p++],this._intArray[it++]=b,k=0;k<b;k++){var ft=o[p++],et=o[p++],ot=f[tt++],st=f[tt++];this._intArray[it++]=v.indexOf(ft);this._floatArray[w++]=et;this._floatArray[w++]=ot;this._floatArray[w++]=st}i.vertices.weight=c}else for(this._floatArray.length+=f.length,r=0,rt=f.length;r<rt;++r)this._floatArray[d+r]=f[r]},u.prototype._parsePivot=function(t,i){if(n.DataParser.PIVOT in t){var r=t[n.DataParser.PIVOT];i.pivot.x=u._getNumber(r,n.DataParser.X,0);i.pivot.y=u._getNumber(r,n.DataParser.Y,0)}else i.pivot.x=.5,i.pivot.y=.5},u.prototype._parseMesh=function(t,i){var rt=t[n.DataParser.VERTICES],ct=t[n.DataParser.UVS],ut=t[n.DataParser.TRIANGLES],u=Math.floor(rt.length/2),y=Math.floor(ut.length/3),f=this._floatArray.length,lt=f+2*u,e=this._intArray.length,ft=this._skin.name+"_"+this._slot.name+"_"+i.name,r,s,o,b,tt,it;for(i.vertices.offset=e,this._intArray.length+=4+3*y,this._intArray[e+0]=u,this._intArray[e+1]=y,this._intArray[e+2]=f,r=0,s=3*y;r<s;++r)this._intArray[e+4+r]=ut[r];for(this._floatArray.length+=2*u+2*u,r=0,s=2*u;r<s;++r)this._floatArray[f+r]=rt[r],this._floatArray[lt+r]=ct[r];if(n.DataParser.WEIGHTS in t){var h=t[n.DataParser.WEIGHTS],et=t[n.DataParser.SLOT_POSE],c=t[n.DataParser.BONE_POSE],at=this._armature.sortedBones,p=[],l=Math.floor(c.length/7),ot=this._floatArray.length,w=Math.floor(h.length-u)/2,a=this._intArray.length,v=n.BaseObject.borrowObject(n.WeightData);for(v.count=w,v.offset=a,p.length=l,this._intArray.length+=2+l+u+w,this._intArray[a+1]=ot,r=0;r<l;++r)o=c[7*r],b=this._rawBones[o],v.addBone(b),p[r]=o,this._intArray[a+2+r]=at.indexOf(b);this._floatArray.length+=3*w;this._helpMatrixA.copyFromArray(et,0);r=0;for(var k=0,st=a+2+l,d=ot;r<u;++r){var ht=2*r,vt=this._intArray[st++]=h[k++],g=this._floatArray[f+ht],nt=this._floatArray[f+ht+1];for(this._helpMatrixA.transformPoint(g,nt,this._helpPoint),g=this._helpPoint.x,nt=this._helpPoint.y,tt=0;tt<vt;++tt)o=h[k++],it=p.indexOf(o),this._helpMatrixB.copyFromArray(c,7*it+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(g,nt,this._helpPoint),this._intArray[st++]=it,this._floatArray[d++]=h[k++],this._floatArray[d++]=this._helpPoint.x,this._floatArray[d++]=this._helpPoint.y}i.vertices.weight=v;this._weightSlotPose[ft]=et;this._weightBonePoses[ft]=c}},u.prototype._parseMeshGlue=function(){},u.prototype._parseBoundingBox=function(t){var i=null,r=0;switch(r=n.DataParser.SUB_TYPE in t&&"string"==typeof t[n.DataParser.SUB_TYPE]?n.DataParser._getBoundingBoxType(t[n.DataParser.SUB_TYPE]):u._getNumber(t,n.DataParser.SUB_TYPE,r)){case 0:i=n.BaseObject.borrowObject(n.RectangleBoundingBoxData);break;case 1:i=n.BaseObject.borrowObject(n.EllipseBoundingBoxData);break;case 2:i=this._parsePolygonBoundingBox(t)}return null!==i&&(i.color=u._getNumber(t,n.DataParser.COLOR,0),0!==i.type&&1!==i.type||(i.width=u._getNumber(t,n.DataParser.WIDTH,0),i.height=u._getNumber(t,n.DataParser.HEIGHT,0))),i},u.prototype._parsePolygonBoundingBox=function(t){var i=n.BaseObject.borrowObject(n.PolygonBoundingBoxData),r,h,u,f;if(n.DataParser.VERTICES in t){var s=this._armature.scale,o=t[n.DataParser.VERTICES],e=i.vertices;for(n.DragonBones.webAssembly?e.resize(o.length,0):e.length=o.length,r=0,h=o.length;r<h;r+=2)u=o[r]*s,f=o[r+1]*s,n.DragonBones.webAssembly?(e.set(r,u),e.set(r+1,f)):(e[r]=u,e[r+1]=f),0===r?(i.x=u,i.y=f,i.width=u,i.height=f):(u<i.x?i.x=u:u>i.width&&(i.width=u),f<i.y?i.y=f:f>i.height&&(i.height=f));i.width-=i.x;i.height-=i.y}else console.warn("Data error.\n Please reexport DragonBones Data to fixed the bug.");return i},u.prototype._parseAnimation=function(t){var r=n.BaseObject.borrowObject(n.AnimationData),v,y,e,p,w,o,b,i,s,k,ut,h,d,c,g,l,tt,et,it,a,rt,f,ot;if((r.frameCount=Math.max(u._getNumber(t,n.DataParser.DURATION,1),1),r.playTimes=u._getNumber(t,n.DataParser.PLAY_TIMES,1),r.duration=r.frameCount/this._armature.frameRate,r.fadeInTime=u._getNumber(t,n.DataParser.FADE_IN_TIME,0),r.scale=u._getNumber(t,n.DataParser.SCALE,1),r.name=u._getString(t,n.DataParser.NAME,n.DataParser.DEFAULT_NAME),0===r.name.length&&(r.name=n.DataParser.DEFAULT_NAME),r.frameIntOffset=this._frameIntArray.length,r.frameFloatOffset=this._frameFloatArray.length,r.frameOffset=this._frameArray.length,this._animation=r,n.DataParser.FRAME in t)&&(v=t[n.DataParser.FRAME],y=v.length,y>0))for(e=0,p=0;e<y;++e)w=v[e],this._parseActionDataInFrame(w,p,null,null),p+=u._getNumber(w,n.DataParser.DURATION,1);if(n.DataParser.Z_ORDER in t&&(this._animation.zOrderTimeline=this._parseTimeline(t[n.DataParser.Z_ORDER],null,n.DataParser.FRAME,1,!1,!1,0,this._parseZOrderFrame)),n.DataParser.BONE in t)for(o=0,b=t[n.DataParser.BONE];o<b.length;o++)i=b[o],this._parseBoneTimeline(i);if(n.DataParser.SURFACE in t)for(s=0,k=t[n.DataParser.SURFACE];s<k.length;s++)i=k[s],ut=u._getString(i,n.DataParser.NAME,""),this._surface=this._armature.getBone(ut),null!==this._surface&&(null!==(f=this._parseTimeline(i,null,n.DataParser.FRAME,50,!1,!0,0,this._parseSurfaceFrame))&&this._animation.addSurfaceTimeline(this._surface,f),this._surface=null);if(n.DataParser.SLOT in t)for(h=0,d=t[n.DataParser.SLOT];h<d.length;h++)i=d[h],this._parseSlotTimeline(i);if(n.DataParser.FFD in t)for(c=0,g=t[n.DataParser.FFD];c<g.length;c++){i=g[c];var nt=u._getString(i,n.DataParser.SKIN,n.DataParser.DEFAULT_NAME),ft=u._getString(i,n.DataParser.SLOT,""),st=u._getString(i,n.DataParser.NAME,"");0===nt.length&&(nt=n.DataParser.DEFAULT_NAME);this._slot=this._armature.getSlot(ft);this._mesh=this._armature.getMesh(nt,ft,st);null!==this._slot&&null!==this._mesh&&(null!==(f=this._parseTimeline(i,null,n.DataParser.FRAME,22,!1,!0,0,this._parseSlotFFDFrame))&&this._animation.addSlotTimeline(this._slot,f),this._slot=null,this._mesh=null)}if(n.DataParser.IK in t)for(l=0,tt=t[n.DataParser.IK];l<tt.length;l++)i=tt[l],et=u._getString(i,n.DataParser.NAME,""),it=this._armature.getConstraint(et),null!==it&&null!==(f=this._parseTimeline(i,null,n.DataParser.FRAME,30,!0,!1,2,this._parseIKConstraintFrame))&&this._animation.addConstraintTimeline(it,f);if(n.DataParser.ANIMATION in t)for(a=0,rt=t[n.DataParser.ANIMATION];a<rt.length;a++)i=rt[a],ot=u._getString(i,n.DataParser.NAME,""),null!==(f=this._parseTimeline(i,null,n.DataParser.FRAME,40,!0,!1,2,this._parseAnimationFrame))&&this._animation.addAnimationTimeline(ot,f);return this._actionFrames.length>0&&(this._animation.actionTimeline=this._parseTimeline(null,this._actionFrames,"",0,!1,!1,0,this._parseActionFrame),this._actionFrames.length=0),this._animation=null,r},u.prototype._parseTimeline=function(i,r,f,e,o,s,h,c){var v,d;if((null!==i&&f.length>0&&f in i&&(r=i[f]),null===r)||(v=r.length,0===v))return null;var tt=this._frameIntArray.length,it=this._frameFloatArray.length,y=n.BaseObject.borrowObject(n.TimelineData),l=this._timelineArray.length;if(this._timelineArray.length+=5+v,null!==i?(this._timelineArray[l+0]=Math.round(100*u._getNumber(i,n.DataParser.SCALE,1)),this._timelineArray[l+1]=Math.round(100*u._getNumber(i,n.DataParser.OFFSET,0))):(this._timelineArray[l+0]=100,this._timelineArray[l+1]=0),this._timelineArray[l+2]=v,this._timelineArray[l+3]=h,this._timelineArray[l+4]=o?tt-this._animation.frameIntOffset:s?it-this._animation.frameFloatOffset:0,this._timeline=y,y.type=e,y.offset=l,1===v)y.frameIndicesOffset=-1,this._timelineArray[l+5+0]=c.call(this,r[0],0,0)-this._animation.frameOffset;else{var g=this._animation.frameCount+1,p=this._data.frameIndices,w=0;n.DragonBones.webAssembly?(w=p.size(),p.resize(w+g,0)):(w=p.length,p.length+=g);y.frameIndicesOffset=w;for(var b=0,a=0,k=0,nt=0;b<g;++b)k+nt<=b&&a<v&&(d=r[a],k=b,nt=a===v-1?this._animation.frameCount-k:d instanceof t?this._actionFrames[a+1].frameStart-k:u._getNumber(d,n.DataParser.DURATION,1),this._timelineArray[l+5+a]=c.call(this,d,k,nt)-this._animation.frameOffset,a++),n.DragonBones.webAssembly?p.set(w+b,a-1):p[w+b]=a-1}return this._timeline=null,y},u.prototype._parseBoneTimeline=function(t){var i,r=this._armature.getBone(u._getString(t,n.DataParser.NAME,""));null!==r&&(this._bone=r,this._slot=this._armature.getSlot(this._bone.name),n.DataParser.TRANSLATE_FRAME in t&&null!==(i=this._parseTimeline(t,null,n.DataParser.TRANSLATE_FRAME,11,!1,!0,2,this._parseBoneTranslateFrame))&&this._animation.addBoneTimeline(r,i),n.DataParser.ROTATE_FRAME in t&&null!==(i=this._parseTimeline(t,null,n.DataParser.ROTATE_FRAME,12,!1,!0,2,this._parseBoneRotateFrame))&&this._animation.addBoneTimeline(r,i),n.DataParser.SCALE_FRAME in t&&null!==(i=this._parseTimeline(t,null,n.DataParser.SCALE_FRAME,13,!1,!0,2,this._parseBoneScaleFrame))&&this._animation.addBoneTimeline(r,i),n.DataParser.FRAME in t&&null!==(i=this._parseTimeline(t,null,n.DataParser.FRAME,10,!1,!0,6,this._parseBoneAllFrame))&&this._animation.addBoneTimeline(r,i),this._bone=null,this._slot=null)},u.prototype._parseSlotTimeline=function(t){var i=this._armature.getSlot(u._getString(t,n.DataParser.NAME,"")),r,f;null!==i&&(this._slot=i,null!==(r=n.DataParser.DISPLAY_FRAME in t?this._parseTimeline(t,null,n.DataParser.DISPLAY_FRAME,20,!1,!1,0,this._parseSlotDisplayFrame):this._parseTimeline(t,null,n.DataParser.FRAME,20,!1,!1,0,this._parseSlotDisplayFrame))&&this._animation.addSlotTimeline(i,r),null!==(f=n.DataParser.COLOR_FRAME in t?this._parseTimeline(t,null,n.DataParser.COLOR_FRAME,21,!0,!1,1,this._parseSlotColorFrame):this._parseTimeline(t,null,n.DataParser.FRAME,21,!0,!1,1,this._parseSlotColorFrame))&&this._animation.addSlotTimeline(i,f),this._slot=null)},u.prototype._parseFrame=function(n,t){var i=this._frameArray.length;return this._frameArray.length+=1,this._frameArray[i+0]=t,i},u.prototype._parseTweenFrame=function(t,i,r){var f=this._parseFrame(t,i,r),s,o,e;if(r>0)if(n.DataParser.CURVE in t)for(s=r+1,this._helpArray.length=s,this._samplingEasingCurve(t[n.DataParser.CURVE],this._helpArray),this._frameArray.length+=2+this._helpArray.length,this._frameArray[f+1]=2,this._frameArray[f+2]=s,o=0;o<s;++o)this._frameArray[f+3+o]=Math.round(1e4*this._helpArray[o]);else e=-2,n.DataParser.TWEEN_EASING in t&&(e=u._getNumber(t,n.DataParser.TWEEN_EASING,-2)),-2===e?(this._frameArray.length+=1,this._frameArray[f+1]=0):0===e?(this._frameArray.length+=1,this._frameArray[f+1]=1):e<0?(this._frameArray.length+=2,this._frameArray[f+1]=3,this._frameArray[f+2]=Math.round(100*-e)):e<=1?(this._frameArray.length+=2,this._frameArray[f+1]=4,this._frameArray[f+2]=Math.round(100*e)):(this._frameArray.length+=2,this._frameArray[f+1]=5,this._frameArray[f+2]=Math.round(100*e-100));else this._frameArray.length+=1,this._frameArray[f+1]=0;return f},u.prototype._parseActionFrame=function(n,t){var r=this._frameArray.length,u=n.actions.length,i;for(this._frameArray.length+=2+u,this._frameArray[r+0]=t,this._frameArray[r+0+1]=u,i=0;i<u;++i)this._frameArray[r+0+2+i]=n.actions[i];return r},u.prototype._parseZOrderFrame=function(t,i,r){var o=this._parseFrame(t,i,r),f,l,p,w,h;if(n.DataParser.Z_ORDER in t&&(f=t[n.DataParser.Z_ORDER],f.length>0)){for(var u=this._armature.sortedSlots.length,s=new Array(u-f.length/2),c=new Array(u),v=0;v<s.length;++v)s[v]=0;for(l=0;l<u;++l)c[l]=-1;for(var e=0,y=0,a=0,b=f.length;a<b;a+=2){for(p=f[a],w=f[a+1];e!==p;)s[y++]=e++;c[e+w]=e++}for(;e<u;)s[y++]=e++;for(this._frameArray.length+=1+u,this._frameArray[o+1]=u,h=u;h--;)this._frameArray[o+2+h]=-1===c[h]?s[--y]||0:c[h]||0;return o}return this._frameArray.length+=1,this._frameArray[o+1]=0,o},u.prototype._parseBoneAllFrame=function(t,i,r){var f,o,e;return this._helpTransform.identity(),n.DataParser.TRANSFORM in t&&this._parseTransform(t[n.DataParser.TRANSFORM],this._helpTransform,1),f=this._helpTransform.rotation,0!==i&&(0===this._prevClockwise?f=this._prevRotation+n.Transform.normalizeRadian(f-this._prevRotation):((this._prevClockwise>0?f>=this._prevRotation:f<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),f=this._prevRotation+f-this._prevRotation+n.Transform.PI_D*this._prevClockwise)),this._prevClockwise=u._getNumber(t,n.DataParser.TWEEN_ROTATE,0),this._prevRotation=f,o=this._parseTweenFrame(t,i,r),e=this._frameFloatArray.length,this._frameFloatArray.length+=6,this._frameFloatArray[e++]=this._helpTransform.x,this._frameFloatArray[e++]=this._helpTransform.y,this._frameFloatArray[e++]=f,this._frameFloatArray[e++]=this._helpTransform.skew,this._frameFloatArray[e++]=this._helpTransform.scaleX,this._frameFloatArray[e++]=this._helpTransform.scaleY,this._parseActionDataInFrame(t,i,this._bone,this._slot),o},u.prototype._parseBoneTranslateFrame=function(t,i,r){var e=this._parseTweenFrame(t,i,r),f=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[f++]=u._getNumber(t,n.DataParser.X,0),this._frameFloatArray[f++]=u._getNumber(t,n.DataParser.Y,0),e},u.prototype._parseBoneRotateFrame=function(t,i,r){var f=u._getNumber(t,n.DataParser.ROTATE,0)*n.Transform.DEG_RAD,o,e;return 0!==i&&(0===this._prevClockwise?f=this._prevRotation+n.Transform.normalizeRadian(f-this._prevRotation):((this._prevClockwise>0?f>=this._prevRotation:f<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),f=this._prevRotation+f-this._prevRotation+n.Transform.PI_D*this._prevClockwise)),this._prevClockwise=u._getNumber(t,n.DataParser.CLOCK_WISE,0),this._prevRotation=f,o=this._parseTweenFrame(t,i,r),e=this._frameFloatArray.length,this._frameFloatArray.length+=2,this._frameFloatArray[e++]=f,this._frameFloatArray[e++]=u._getNumber(t,n.DataParser.SKEW,0)*n.Transform.DEG_RAD,o},u.prototype._parseBoneScaleFrame=function(t,i,r){var e=this._parseTweenFrame(t,i,r),f=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[f++]=u._getNumber(t,n.DataParser.X,1),this._frameFloatArray[f++]=u._getNumber(t,n.DataParser.Y,1),e},u.prototype._parseSurfaceFrame=function(t,i,r){var s=this._frameFloatArray.length,v=this._parseTweenFrame(t,i,r),h=t[n.DataParser.VERTICES],o=u._getNumber(t,n.DataParser.OFFSET,0),c=this._surface.vertices.length/2,l=0,a=0,f,e;for(this._frameFloatArray.length+=2*c,f=0;f<2*c;f+=2)l=f<o||f-o>=h.length?0:h[f-o],a=f+1<o||f+1-o>=h.length?0:h[f+1-o],this._frameFloatArray[s+f]=l,this._frameFloatArray[s+f+1]=a;return 0===i&&(e=this._frameIntArray.length,this._frameIntArray.length+=5,this._frameIntArray[e+0]=0,this._frameIntArray[e+1]=this._frameFloatArray.length-s,this._frameIntArray[e+2]=this._frameFloatArray.length-s,this._frameIntArray[e+3]=0,this._frameIntArray[e+4]=s-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=e-this._animation.frameIntOffset),v},u.prototype._parseSlotDisplayFrame=function(t,i,r){var f=this._parseFrame(t,i,r);return this._frameArray.length+=1,this._frameArray[f+1]=n.DataParser.VALUE in t?u._getNumber(t,n.DataParser.VALUE,0):u._getNumber(t,n.DataParser.DISPLAY_INDEX,0),this._parseActionDataInFrame(t,i,this._slot.parent,this._slot),f},u.prototype._parseSlotColorFrame=function(t,i,r){var o=this._parseTweenFrame(t,i,r),u=-1,f,s,e;if(n.DataParser.VALUE in t||n.DataParser.COLOR in t){f=n.DataParser.VALUE in t?t[n.DataParser.VALUE]:t[n.DataParser.COLOR];for(s in f){this._parseColorTransform(f,this._helpColorTransform);u=this._intArray.length;this._intArray.length+=8;this._intArray[u++]=Math.round(100*this._helpColorTransform.alphaMultiplier);this._intArray[u++]=Math.round(100*this._helpColorTransform.redMultiplier);this._intArray[u++]=Math.round(100*this._helpColorTransform.greenMultiplier);this._intArray[u++]=Math.round(100*this._helpColorTransform.blueMultiplier);this._intArray[u++]=Math.round(this._helpColorTransform.alphaOffset);this._intArray[u++]=Math.round(this._helpColorTransform.redOffset);this._intArray[u++]=Math.round(this._helpColorTransform.greenOffset);this._intArray[u++]=Math.round(this._helpColorTransform.blueOffset);u-=8;break}}return u<0&&(this._defaultColorOffset<0&&(this._defaultColorOffset=u=this._intArray.length,this._intArray.length+=8,this._intArray[u++]=100,this._intArray[u++]=100,this._intArray[u++]=100,this._intArray[u++]=100,this._intArray[u++]=0,this._intArray[u++]=0,this._intArray[u++]=0,this._intArray[u++]=0),u=this._defaultColorOffset),e=this._frameIntArray.length,this._frameIntArray.length+=1,this._frameIntArray[e]=u,o},u.prototype._parseSlotFFDFrame=function(t,i,r){var e=this._frameFloatArray.length,tt=this._parseTweenFrame(t,i,r),l=n.DataParser.VERTICES in t?t[n.DataParser.VERTICES]:null,s=u._getNumber(t,n.DataParser.OFFSET,0),p=this._intArray[this._mesh.vertices.offset+0],w=this._mesh.parent.name+"_"+this._slot.name+"_"+this._mesh.name,a=this._mesh.vertices.weight,h=0,c=0,v=0,b=0,k,f,d,g,y,nt,o;for(null!==a?(k=this._weightSlotPose[w],this._helpMatrixA.copyFromArray(k,0),this._frameFloatArray.length+=2*a.count,v=a.offset+2+a.bones.length):this._frameFloatArray.length+=2*p,f=0;f<2*p;f+=2)if(null===l?(h=0,c=0):(h=f<s||f-s>=l.length?0:l[f-s],c=f+1<s||f+1-s>=l.length?0:l[f+1-s]),null!==a)for(d=this._weightBonePoses[w],g=this._intArray[v++],this._helpMatrixA.transformPoint(h,c,this._helpPoint,!0),h=this._helpPoint.x,c=this._helpPoint.y,y=0;y<g;++y)nt=this._intArray[v++],this._helpMatrixB.copyFromArray(d,7*nt+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(h,c,this._helpPoint,!0),this._frameFloatArray[e+b++]=this._helpPoint.x,this._frameFloatArray[e+b++]=this._helpPoint.y;else this._frameFloatArray[e+f]=h,this._frameFloatArray[e+f+1]=c;return 0===i&&(o=this._frameIntArray.length,this._frameIntArray.length+=5,this._frameIntArray[o+0]=this._mesh.vertices.offset,this._frameIntArray[o+1]=this._frameFloatArray.length-e,this._frameIntArray[o+2]=this._frameFloatArray.length-e,this._frameIntArray[o+3]=0,this._frameIntArray[o+4]=e-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=o-this._animation.frameIntOffset),tt},u.prototype._parseIKConstraintFrame=function(t,i,r){var e=this._parseTweenFrame(t,i,r),f=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[f++]=u._getBoolean(t,n.DataParser.BEND_POSITIVE,!0)?1:0,this._frameIntArray[f++]=Math.round(100*u._getNumber(t,n.DataParser.WEIGHT,1)),e},u.prototype._parseAnimationFrame=function(t,i,r){var e=this._parseTweenFrame(t,i,r),f=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[f++]=u._getNumber(t,n.DataParser.VALUE,0),this._frameIntArray[f++]=Math.round(100*u._getNumber(t,n.DataParser.WEIGHT,1)),e},u.prototype._parseActionData=function(t,i,r,f){var y=[],c,p,e,o,d,g,s,l,w,h,a,b,v,k;if("string"==typeof t)(o=n.BaseObject.borrowObject(n.ActionData)).type=i,o.name=t,o.bone=r,o.slot=f,y.push(o);else if(t instanceof Array)for(c=0,p=t;c<p.length;c++){if(e=p[c],o=n.BaseObject.borrowObject(n.ActionData),(n.DataParser.GOTO_AND_PLAY in e?(o.type=0,o.name=u._getString(e,n.DataParser.GOTO_AND_PLAY,"")):(o.type=n.DataParser.TYPE in e&&"string"==typeof e[n.DataParser.TYPE]?n.DataParser._getActionType(e[n.DataParser.TYPE]):u._getNumber(e,n.DataParser.TYPE,i),o.name=u._getString(e,n.DataParser.NAME,"")),n.DataParser.BONE in e)?(d=u._getString(e,n.DataParser.BONE,""),o.bone=this._armature.getBone(d)):o.bone=r,n.DataParser.SLOT in e?(g=u._getString(e,n.DataParser.SLOT,""),o.slot=this._armature.getSlot(g)):o.slot=f,s=null,n.DataParser.INTS in e)for(null===s&&(s=n.BaseObject.borrowObject(n.UserData)),l=0,w=e[n.DataParser.INTS];l<w.length;l++)h=w[l],s.addInt(h);if(n.DataParser.FLOATS in e)for(null===s&&(s=n.BaseObject.borrowObject(n.UserData)),a=0,b=e[n.DataParser.FLOATS];a<b.length;a++)h=b[a],s.addFloat(h);if(n.DataParser.STRINGS in e)for(null===s&&(s=n.BaseObject.borrowObject(n.UserData)),v=0,k=e[n.DataParser.STRINGS];v<k.length;v++)h=k[v],s.addString(h);o.data=s;y.push(o)}return y},u.prototype._parseTransform=function(t,i,r){i.x=u._getNumber(t,n.DataParser.X,0)*r;i.y=u._getNumber(t,n.DataParser.Y,0)*r;n.DataParser.ROTATE in t||n.DataParser.SKEW in t?(i.rotation=n.Transform.normalizeRadian(u._getNumber(t,n.DataParser.ROTATE,0)*n.Transform.DEG_RAD),i.skew=n.Transform.normalizeRadian(u._getNumber(t,n.DataParser.SKEW,0)*n.Transform.DEG_RAD)):(n.DataParser.SKEW_X in t||n.DataParser.SKEW_Y in t)&&(i.rotation=n.Transform.normalizeRadian(u._getNumber(t,n.DataParser.SKEW_Y,0)*n.Transform.DEG_RAD),i.skew=n.Transform.normalizeRadian(u._getNumber(t,n.DataParser.SKEW_X,0)*n.Transform.DEG_RAD)-i.rotation);i.scaleX=u._getNumber(t,n.DataParser.SCALE_X,1);i.scaleY=u._getNumber(t,n.DataParser.SCALE_Y,1)},u.prototype._parseColorTransform=function(t,i){i.alphaMultiplier=.01*u._getNumber(t,n.DataParser.ALPHA_MULTIPLIER,100);i.redMultiplier=.01*u._getNumber(t,n.DataParser.RED_MULTIPLIER,100);i.greenMultiplier=.01*u._getNumber(t,n.DataParser.GREEN_MULTIPLIER,100);i.blueMultiplier=.01*u._getNumber(t,n.DataParser.BLUE_MULTIPLIER,100);i.alphaOffset=u._getNumber(t,n.DataParser.ALPHA_OFFSET,0);i.redOffset=u._getNumber(t,n.DataParser.RED_OFFSET,0);i.greenOffset=u._getNumber(t,n.DataParser.GREEN_OFFSET,0);i.blueOffset=u._getNumber(t,n.DataParser.BLUE_OFFSET,0)},u.prototype._parseArray=function(){this._intArray.length=0;this._floatArray.length=0;this._frameIntArray.length=0;this._frameFloatArray.length=0;this._frameArray.length=0;this._timelineArray.length=0},u.prototype._modifyArray=function(){var e;this._intArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._intArray.push(0);this._frameIntArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameIntArray.push(0);this._frameArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameArray.push(0);this._timelineArray.length%Uint16Array.BYTES_PER_ELEMENT!=0&&this._timelineArray.push(0);var r=this._intArray.length*Int16Array.BYTES_PER_ELEMENT,u=this._floatArray.length*Float32Array.BYTES_PER_ELEMENT,f=this._frameIntArray.length*Int16Array.BYTES_PER_ELEMENT,s=this._frameFloatArray.length*Float32Array.BYTES_PER_ELEMENT,c=this._frameArray.length*Int16Array.BYTES_PER_ELEMENT,b=this._timelineArray.length*Uint16Array.BYTES_PER_ELEMENT,k=r+u+f+s+c+b;if(n.DragonBones.webAssembly){for(var h=n.webAssemblyModule.HEAP16.buffer,o=n.webAssemblyModule._malloc(k),l=new Int16Array(h,o,this._intArray.length),a=new Float32Array(h,o+r,this._floatArray.length),v=new Int16Array(h,o+r+u,this._frameIntArray.length),y=new Float32Array(h,o+r+u+f,this._frameFloatArray.length),p=new Int16Array(h,o+r+u+f+s,this._frameArray.length),w=new Uint16Array(h,o+r+u+f+s+c,this._timelineArray.length),t=0,i=this._intArray.length;t<i;++t)l[t]=this._intArray[t];for(t=0,i=this._floatArray.length;t<i;++t)a[t]=this._floatArray[t];for(t=0,i=this._frameIntArray.length;t<i;++t)v[t]=this._frameIntArray[t];for(t=0,i=this._frameFloatArray.length;t<i;++t)y[t]=this._frameFloatArray[t];for(t=0,i=this._frameArray.length;t<i;++t)p[t]=this._frameArray[t];for(t=0,i=this._timelineArray.length;t<i;++t)w[t]=this._timelineArray[t];n.webAssemblyModule.setDataBinary(this._data,o,r,u,f,s,c,b)}else{for(e=new ArrayBuffer(k),l=new Int16Array(e,0,this._intArray.length),a=new Float32Array(e,r,this._floatArray.length),v=new Int16Array(e,r+u,this._frameIntArray.length),y=new Float32Array(e,r+u+f,this._frameFloatArray.length),p=new Int16Array(e,r+u+f+s,this._frameArray.length),w=new Uint16Array(e,r+u+f+s+c,this._timelineArray.length),t=0,i=this._intArray.length;t<i;++t)l[t]=this._intArray[t];for(t=0,i=this._floatArray.length;t<i;++t)a[t]=this._floatArray[t];for(t=0,i=this._frameIntArray.length;t<i;++t)v[t]=this._frameIntArray[t];for(t=0,i=this._frameFloatArray.length;t<i;++t)y[t]=this._frameFloatArray[t];for(t=0,i=this._frameArray.length;t<i;++t)p[t]=this._frameArray[t];for(t=0,i=this._timelineArray.length;t<i;++t)w[t]=this._timelineArray[t];this._data.binary=e;this._data.intArray=l;this._data.floatArray=a;this._data.frameIntArray=v;this._data.frameFloatArray=y;this._data.frameArray=p;this._data.timelineArray=w}this._defaultColorOffset=-1},u.prototype.parseDragonBonesData=function(t,i){var f,s,r,e,o,h;if(void 0===i&&(i=1),console.assert(null!=t,"Data error."),f=u._getString(t,n.DataParser.VERSION,""),s=u._getString(t,n.DataParser.COMPATIBLE_VERSION,""),n.DataParser.DATA_VERSIONS.indexOf(f)>=0||n.DataParser.DATA_VERSIONS.indexOf(s)>=0){if(r=n.BaseObject.borrowObject(n.DragonBonesData),r.version=f,r.name=u._getString(t,n.DataParser.NAME,""),r.frameRate=u._getNumber(t,n.DataParser.FRAME_RATE,24),0===r.frameRate&&(r.frameRate=24),n.DataParser.ARMATURE in t){for(this._data=r,this._parseArray(t),e=0,o=t[n.DataParser.ARMATURE];e<o.length;e++)h=o[e],r.addArmature(this._parseArmature(h,i));this._data.binary||this._modifyArray();n.DataParser.STAGE in t?r.stage=r.getArmature(u._getString(t,n.DataParser.STAGE,"")):r.armatureNames.length>0&&(r.stage=r.getArmature(r.armatureNames[0]));this._data=null}return n.DataParser.TEXTURE_ATLAS in t&&(this._rawTextureAtlases=t[n.DataParser.TEXTURE_ATLAS]),r}return console.assert(!1,"Nonsupport data version: "+f+"\nPlease convert DragonBones data to support version.\nRead more: https://github.com/DragonBones/Tools/"),null},u.prototype.parseTextureAtlasData=function(t,i,r){var c,e,f,s,h;if(void 0===r&&(r=1),console.assert(void 0!==t),null===t)return null===this._rawTextureAtlases||0===this._rawTextureAtlases.length?!1:(c=this._rawTextureAtlases[this._rawTextureAtlasIndex++],this.parseTextureAtlasData(c,i,r),this._rawTextureAtlasIndex>=this._rawTextureAtlases.length&&(this._rawTextureAtlasIndex=0,this._rawTextureAtlases=null),!0);if(i.width=u._getNumber(t,n.DataParser.WIDTH,0),i.height=u._getNumber(t,n.DataParser.HEIGHT,0),i.scale=1===r?1/u._getNumber(t,n.DataParser.SCALE,1):r,i.name=u._getString(t,n.DataParser.NAME,""),i.imagePath=u._getString(t,n.DataParser.IMAGE_PATH,""),n.DataParser.SUB_TEXTURE in t)for(var l=t[n.DataParser.SUB_TEXTURE],o=0,a=l.length;o<a;++o)e=l[o],f=i.createTexture(),f.rotated=u._getBoolean(e,n.DataParser.ROTATED,!1),f.name=u._getString(e,n.DataParser.NAME,""),f.region.x=u._getNumber(e,n.DataParser.X,0),f.region.y=u._getNumber(e,n.DataParser.Y,0),f.region.width=u._getNumber(e,n.DataParser.WIDTH,0),f.region.height=u._getNumber(e,n.DataParser.HEIGHT,0),s=u._getNumber(e,n.DataParser.FRAME_WIDTH,-1),h=u._getNumber(e,n.DataParser.FRAME_HEIGHT,-1),s>0&&h>0&&(f.frame=n.TextureData.createRectangle(),f.frame.x=u._getNumber(e,n.DataParser.FRAME_X,0),f.frame.y=u._getNumber(e,n.DataParser.FRAME_Y,0),f.frame.width=s,f.frame.height=h),i.addTexture(f);return!0},u.getInstance=function(){return null===u._objectDataParserInstance&&(u._objectDataParserInstance=new u),u._objectDataParserInstance},u._objectDataParserInstance=null,u}(n.DataParser),t;n.ObjectDataParser=i;t=function(){this.frameStart=0;this.actions=[]};n.ActionFrame=t}(i||(i={})),function(n){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return r(i,t),i.prototype._inRange=function(n,t,i){return t<=n&&n<=i},i.prototype._decodeUTF8=function(n){for(var i,s,c,t,h=0,o="",u=0,r=0,e=0,f=0;n.length>h;)i=n[h++],-1===i?t=0!==r?65533:-1:0===r?this._inRange(i,0,127)?t=i:(this._inRange(i,194,223)?(r=1,f=128,u=i-192):this._inRange(i,224,239)?(r=2,f=2048,u=i-224):this._inRange(i,240,244)&&(r=3,f=65536,u=i-240),u*=Math.pow(64,r),t=null):this._inRange(i,128,191)?(e+=1,u+=(i-128)*Math.pow(64,r-e),e!==r)?t=null:(s=u,c=f,u=0,r=0,e=0,f=0,t=this._inRange(s,c,1114111)&&!this._inRange(s,55296,57343)?s:i):(u=0,r=0,e=0,f=0,h--,t=i),null!==t&&-1!==t&&(t<=65535?t>0&&(o+=String.fromCharCode(t)):(t-=65536,o+=String.fromCharCode(55296+(t>>10&1023)),o+=String.fromCharCode(56320+(1023&t))));return o},i.prototype._getUTF16Key=function(n){for(var t=0,i=n.length;t<i;++t)if(n.charCodeAt(t)>255)return encodeURI(n);return n},i.prototype._parseBinaryTimeline=function(t,i,r){var u,h;if(void 0===r&&(r=null),u=null!==r?r:n.BaseObject.borrowObject(n.TimelineData),u.type=t,u.offset=i,this._timeline=u,h=this._timelineArrayBuffer[u.offset+2],1===h)u.frameIndicesOffset=-1;else{var e=0,l=this._animation.frameCount+1,o=this._data.frameIndices;n.DragonBones.webAssembly?(e=o.size(),o.resize(e+l,0)):(e=o.length,o.length+=l);u.frameIndicesOffset=e;for(var s=0,f=0,c=0,a=0;s<l;++s)c+a<=s&&f<h&&(c=this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[u.offset+5+f]],a=f===h-1?this._animation.frameCount-c:this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[u.offset+5+f+1]]-c,f++),n.DragonBones.webAssembly?o.set(e+s,f-1):o[e+s]=f-1}return this._timeline=null,u},i.prototype._parseVertices=function(t,i){var u,r,s,e;if(i.offset=t[n.DataParser.OFFSET],u=this._intArrayBuffer[i.offset+3],u>=0){var f=n.BaseObject.borrowObject(n.WeightData),l=this._intArrayBuffer[i.offset+0],o=this._intArrayBuffer[u+0];for(f.offset=u,r=0;r<o;++r)s=this._intArrayBuffer[u+2+r],f.addBone(this._rawBones[s]);for(var h=u+2+o,c=0,a=(r=0,l);r<a;++r)e=this._intArrayBuffer[h++],c+=e,h+=e;f.count=c;i.weight=f}},i.prototype._parseMesh=function(n,t){this._parseVertices(n,t.vertices)},i.prototype._parsePath=function(n,t){this._parseVertices(n,t.vertices)},i.prototype._parseAnimation=function(t){var f=n.BaseObject.borrowObject(n.AnimationData),l,e,u,a,r,o,v,y,p,i;if(f.frameCount=Math.max(n.ObjectDataParser._getNumber(t,n.DataParser.DURATION,1),1),f.playTimes=n.ObjectDataParser._getNumber(t,n.DataParser.PLAY_TIMES,1),f.duration=f.frameCount/this._armature.frameRate,f.fadeInTime=n.ObjectDataParser._getNumber(t,n.DataParser.FADE_IN_TIME,0),f.scale=n.ObjectDataParser._getNumber(t,n.DataParser.SCALE,1),f.name=n.ObjectDataParser._getString(t,n.DataParser.NAME,n.DataParser.DEFAULT_NAME),0===f.name.length&&(f.name=n.DataParser.DEFAULT_NAME),l=t[n.DataParser.OFFSET],f.frameIntOffset=l[0],f.frameFloatOffset=l[1],f.frameOffset=l[2],this._animation=f,n.DataParser.ACTION in t&&(f.actionTimeline=this._parseBinaryTimeline(0,t[n.DataParser.ACTION])),n.DataParser.Z_ORDER in t&&(f.zOrderTimeline=this._parseBinaryTimeline(1,t[n.DataParser.Z_ORDER])),n.DataParser.BONE in t){e=t[n.DataParser.BONE];for(i in e)if(u=e[i],n.DragonBones.webAssembly&&(i=this._getUTF16Key(i)),a=this._armature.getBone(i),null!==a)for(r=0,o=u.length;r<o;r+=2){var s=u[r],h=u[r+1],c=this._parseBinaryTimeline(s,h);this._animation.addBoneTimeline(a,c)}}if(n.DataParser.SURFACE in t)for(i in e=t[n.DataParser.SURFACE])if(u=e[i],n.DragonBones.webAssembly&&(i=this._getUTF16Key(i)),v=this._armature.getBone(i),null!==v)for(r=0,o=u.length;r<o;r+=2)s=u[r],h=u[r+1],c=this._parseBinaryTimeline(s,h),this._animation.addSurfaceTimeline(v,c);if(n.DataParser.SLOT in t)for(i in e=t[n.DataParser.SLOT])if(u=e[i],n.DragonBones.webAssembly&&(i=this._getUTF16Key(i)),y=this._armature.getSlot(i),null!==y)for(r=0,o=u.length;r<o;r+=2)s=u[r],h=u[r+1],c=this._parseBinaryTimeline(s,h),this._animation.addSlotTimeline(y,c);if(n.DataParser.CONSTRAINT in t)for(i in e=t[n.DataParser.CONSTRAINT])if(u=e[i],n.DragonBones.webAssembly&&(i=this._getUTF16Key(i)),p=this._armature.getConstraint(i),null!==p)for(r=0,o=u.length;r<o;r+=2)s=u[r],h=u[r+1],c=this._parseBinaryTimeline(s,h),this._animation.addConstraintTimeline(p,c);if(n.DataParser.ANIMATION in t)for(i in e=t[n.DataParser.ANIMATION])for(u=e[i],n.DragonBones.webAssembly&&(i=this._getUTF16Key(i)),r=0,o=u.length;r<o;r+=2)s=u[r],h=u[r+1],c=this._parseBinaryTimeline(s,h),this._animation.addAnimationTimeline(i,c);return this._animation=null,f},i.prototype._parseArray=function(t){var i=t[n.DataParser.OFFSET],u=i[1],f=i[3],e=i[5],o=i[7],s=i[9],h=i[11],l=new Int16Array(this._binary,this._binaryOffset+i[0],u/Int16Array.BYTES_PER_ELEMENT),a=new Float32Array(this._binary,this._binaryOffset+i[2],f/Float32Array.BYTES_PER_ELEMENT),v=new Int16Array(this._binary,this._binaryOffset+i[4],e/Int16Array.BYTES_PER_ELEMENT),y=new Float32Array(this._binary,this._binaryOffset+i[6],o/Float32Array.BYTES_PER_ELEMENT),p=new Int16Array(this._binary,this._binaryOffset+i[8],s/Int16Array.BYTES_PER_ELEMENT),w=new Uint16Array(this._binary,this._binaryOffset+i[10],h/Uint16Array.BYTES_PER_ELEMENT);if(n.DragonBones.webAssembly){for(var b=u+f+e+o+s+h,k=n.webAssemblyModule._malloc(b),c=new Uint8Array(this._binary,this._binaryOffset,b/Uint8Array.BYTES_PER_ELEMENT),d=new Uint8Array(n.webAssemblyModule.HEAP16.buffer,k,c.length),r=0,g=c.length;r<g;++r)d[r]=c[r];n.webAssemblyModule.setDataBinary(this._data,k,u,f,e,o,s,h);this._intArrayBuffer=l;this._floatArrayBuffer=a;this._frameIntArrayBuffer=v;this._frameFloatArrayBuffer=y;this._frameArrayBuffer=p;this._timelineArrayBuffer=w}else this._data.binary=this._binary,this._data.intArray=this._intArrayBuffer=l,this._data.floatArray=this._floatArrayBuffer=a,this._data.frameIntArray=this._frameIntArrayBuffer=v,this._data.frameFloatArray=this._frameFloatArrayBuffer=y,this._data.frameArray=this._frameArrayBuffer=p,this._data.timelineArray=this._timelineArrayBuffer=w},i.prototype.parseDragonBonesData=function(n,i){var r;if(void 0===i&&(i=1),console.assert(null!=n&&n instanceof ArrayBuffer,"Data error."),r=new Uint8Array(n,0,8),r[0]!=="D".charCodeAt(0)||r[1]!=="B".charCodeAt(0)||r[2]!=="D".charCodeAt(0)||r[3]!=="T".charCodeAt(0))return console.assert(!1,"Nonsupport data."),null;var u=new Uint32Array(n,8,1)[0],f=new Uint8Array(n,12,u),e=this._decodeUTF8(f),o=JSON.parse(e);return this._binaryOffset=12+u,this._binary=n,t.prototype.parseDragonBonesData.call(this,o,i)},i.getInstance=function(){return null===i._binaryDataParserInstance&&(i._binaryDataParserInstance=new i),i._binaryDataParserInstance},i._binaryDataParserInstance=null,i}(n.ObjectDataParser);n.BinaryDataParser=t}(i||(i={})),function(n){var i=function(){function i(t){void 0===t&&(t=null);this.autoSearch=!1;this._dragonBonesDataMap={};this._textureAtlasDataMap={};this._dragonBones=null;this._dataParser=null;null===i._objectParser&&(i._objectParser=new n.ObjectDataParser);null===i._binaryParser&&(i._binaryParser=new n.BinaryDataParser);this._dataParser=null!==t?t:i._objectParser}return i.prototype._isSupportMesh=function(){return!0},i.prototype._getTextureData=function(n,t){var i,f,s,r,e,o,u;if(n in this._textureAtlasDataMap)for(i=0,f=this._textureAtlasDataMap[n];i<f.length;i++)if(null!==(u=(o=f[i]).getTexture(t)))return u;if(this.autoSearch)for(s in this._textureAtlasDataMap)for(r=0,e=this._textureAtlasDataMap[s];r<e.length;r++)if((o=e[r]).autoSearch&&null!==(u=o.getTexture(t)))return u;return null},i.prototype._fillBuildArmaturePackage=function(n,t,i,r,u){var e=null,f=null,o,s;if(t.length>0&&t in this._dragonBonesDataMap&&(f=(e=this._dragonBonesDataMap[t]).getArmature(i)),null===f&&(0===t.length||this.autoSearch))for(o in this._dragonBonesDataMap)if(e=this._dragonBonesDataMap[o],(0===t.length||e.autoSearch)&&null!==(f=e.getArmature(i))){t=o;break}if(null!==f){if(n.dataName=t,n.textureAtlasName=u,n.data=e,n.armature=f,n.skin=null,r.length>0&&(n.skin=f.getSkin(r),null===n.skin&&this.autoSearch))for(o in this._dragonBonesDataMap)if(s=this._dragonBonesDataMap[o].getArmature(r),null!==s){n.skin=s.defaultSkin;break}return null===n.skin&&(n.skin=f.defaultSkin),!0}return!1},i.prototype._buildBones=function(t,i){for(var f,r=0,u=t.armature.sortedBones;r<u.length;r++)f=u[r],n.BaseObject.borrowObject(0===f.type?n.Bone:n.Surface).init(f,i)},i.prototype._buildSlots=function(t,i){var e=t.skin,o=t.armature.defaultSkin,f,s,r,h,v,p;if(null!==e&&null!==o){f={};for(r in o.displays)s=o.getDisplays(r),f[r]=s;if(e!==o)for(r in e.displays)s=e.getDisplays(r),f[r]=s;for(h=0,v=t.armature.sortedSlots;h<v.length;h++){var c=v[h],u=c.name in f?f[c.name]:null,l=this._buildSlot(t,c,i);if(l.rawDisplayDatas=u,null!==u){for(var y=[],a=0,w=n.DragonBones.webAssembly?u.size():u.length;a<w;++a)p=n.DragonBones.webAssembly?u.get(a):u[a],null!==p?y.push(this._getSlotDisplay(t,p,null,l)):y.push(null);l._setDisplayList(y)}l._setDisplayIndex(c.displayIndex,!0)}}},i.prototype._buildConstraints=function(t,i){var o=t.armature.constraints,s,r,u,f,e;for(s in o){r=o[s];switch(r.type){case 0:u=n.BaseObject.borrowObject(n.IKConstraint);u.init(r,i);i._addConstraint(u);break;case 1:f=n.BaseObject.borrowObject(n.PathConstraint);f.init(r,i);i._addConstraint(f);break;default:e=n.BaseObject.borrowObject(n.IKConstraint);e.init(r,i);i._addConstraint(e)}}},i.prototype._buildChildArmature=function(n,t,i){return this.buildArmature(i.path,null!==n?n.dataName:"","",null!==n?n.textureAtlasName:"")},i.prototype._getSlotDisplay=function(t,i,r,u){var y=null!==t?t.dataName:i.parent.parent.parent.name,s=null,h,e,o,f,a,c,v,p,l;switch(i.type){case 0:h=i;null!==t&&t.textureAtlasName.length>0&&(h.texture=this._getTextureData(t.textureAtlasName,i.path));null===h.texture&&(h.texture=this._getTextureData(y,i.path));s=null!==r&&2===r.type&&this._isSupportMesh()?u.meshDisplay:u.rawDisplay;break;case 2:e=i;null!==t&&t.textureAtlasName.length>0&&(e.texture=this._getTextureData(t.textureAtlasName,e.path));null===e.texture&&(e.texture=this._getTextureData(y,e.path));s=this._isSupportMesh()?u.meshDisplay:u.rawDisplay;break;case 1:if(o=i,f=this._buildChildArmature(t,u,i),null!==f){if(f.inheritAnimation=o.inheritAnimation,!f.inheritAnimation)if(a=o.actions.length>0?o.actions:f.armatureData.defaultActions,a.length>0)for(c=0,v=a;c<v.length;c++)p=v[c],l=n.BaseObject.borrowObject(n.EventObject),n.EventObject.actionDataToInstance(p,l,u.armature),l.slot=u,u.armature._bufferAction(l,!1);else f.animation.play();o.armature=f.armatureData}s=f}return s},i.prototype.parseDragonBonesData=function(n,t,r){var e,u,f;for(void 0===t&&(t=null),void 0===r&&(r=1),e=n instanceof ArrayBuffer?i._binaryParser:this._dataParser,u=e.parseDragonBonesData(n,r);;){if(f=this._buildTextureAtlasData(null,null),!e.parseTextureAtlasData(null,f,r)){f.returnToPool();break}this.addTextureAtlasData(f,t)}return null!==u&&this.addDragonBonesData(u,t),u},i.prototype.parseTextureAtlasData=function(n,t,i,r){void 0===i&&(i=null);void 0===r&&(r=1);var u=this._buildTextureAtlasData(null,null);return this._dataParser.parseTextureAtlasData(n,u,r),this._buildTextureAtlasData(u,t||null),this.addTextureAtlasData(u,i),u},i.prototype.updateTextureAtlasData=function(n,t){var r=this.getTextureAtlasData(n),i,u;if(null!==r)for(i=0,u=r.length;i<u;++i)i<t.length&&this._buildTextureAtlasData(r[i],t[i])},i.prototype.getDragonBonesData=function(n){return n in this._dragonBonesDataMap?this._dragonBonesDataMap[n]:null},i.prototype.addDragonBonesData=function(n,t){if(void 0===t&&(t=null),(t=null!==t?t:n.name)in this._dragonBonesDataMap){if(this._dragonBonesDataMap[t]===n)return;console.warn("Can not add same name data: "+t)}else this._dragonBonesDataMap[t]=n},i.prototype.removeDragonBonesData=function(n,t){void 0===t&&(t=!0);n in this._dragonBonesDataMap&&(t&&this._dragonBones.bufferObject(this._dragonBonesDataMap[n]),delete this._dragonBonesDataMap[n])},i.prototype.getTextureAtlasData=function(n){return n in this._textureAtlasDataMap?this._textureAtlasDataMap[n]:null},i.prototype.addTextureAtlasData=function(n,t){void 0===t&&(t=null);var i=(t=null!==t?t:n.name)in this._textureAtlasDataMap?this._textureAtlasDataMap[t]:this._textureAtlasDataMap[t]=[];i.indexOf(n)<0&&i.push(n)},i.prototype.removeTextureAtlasData=function(n,t){var u,i,r,f;if(void 0===t&&(t=!0),n in this._textureAtlasDataMap){if(u=this._textureAtlasDataMap[n],t)for(i=0,r=u;i<r.length;i++)f=r[i],this._dragonBones.bufferObject(f);delete this._textureAtlasDataMap[n]}},i.prototype.getArmatureData=function(n,i){void 0===i&&(i="");var r=new t;return this._fillBuildArmaturePackage(r,i,n,"","")?r.armature:null},i.prototype.clear=function(n){var t,i,r,u;for(t in void 0===n&&(n=!0),this._dragonBonesDataMap)n&&this._dragonBones.bufferObject(this._dragonBonesDataMap[t]),delete this._dragonBonesDataMap[t];for(t in this._textureAtlasDataMap){if(n)for(i=0,r=this._textureAtlasDataMap[t];i<r.length;i++)u=r[i],this._dragonBones.bufferObject(u);delete this._textureAtlasDataMap[t]}},i.prototype.buildArmature=function(n,i,r,u){var e,f;return(void 0===i&&(i=""),void 0===r&&(r=""),void 0===u&&(u=""),e=new t,!this._fillBuildArmaturePackage(e,i||"",n,r||"",u||""))?(console.warn("No armature data: "+n+", "+(null!==i?i:"")),null):(f=this._buildArmature(e),this._buildBones(e,f),this._buildSlots(e,f),this._buildConstraints(e,f),f.invalidUpdate(null,!0),f.advanceTime(0),f)},i.prototype.replaceDisplay=function(t,i,r){var u,e,s,f,o;if(void 0===r&&(r=-1),r<0&&(r=t.displayIndex),r<0&&(r=0),t.replaceDisplayData(i,r),u=t.displayList,u.length<=r)for(u.length=r+1,e=0,s=u.length;e<s;++e)u[e]||(u[e]=null);null!==i?(f=t.rawDisplayDatas,o=null,f&&(n.DragonBones.webAssembly?r<f.size()&&(o=f.get(r)):r<f.length&&(o=f[r])),u[r]=this._getSlotDisplay(null,i,o,t)):u[r]=null;t.displayList=u},i.prototype.replaceSlotDisplay=function(n,t,i,r,u,f){var e,o;return(void 0===f&&(f=-1),e=this.getArmatureData(t,n||""),!e||!e.defaultSkin)?!1:(o=e.defaultSkin.getDisplay(i,r),!!o&&(this.replaceDisplay(u,o,f),!0))},i.prototype.replaceSlotDisplayList=function(t,i,r,u){var o=this.getArmatureData(i,t||""),f,s;if(!o||!o.defaultSkin||(f=o.defaultSkin.getDisplays(r),!f))return!1;for(var h=0,e=0,c=n.DragonBones.webAssembly?f.size():f.length;e<c;++e)s=n.DragonBones.webAssembly?f.get(e):f[e],this.replaceDisplay(u,s,h++);return!0},i.prototype.replaceSkin=function(t,i,r,u){var f,e,l,s,o,p,a;void 0===r&&(r=!1);void 0===u&&(u=null);for(var v=!1,h=i.parent.defaultSkin,c=0,y=t.getSlots();c<y.length;c++)if(f=y[c],!(null!==u&&u.indexOf(f.name)>=0))if(e=i.getDisplays(f.name),e||(null!==h&&i!==h&&(e=h.getDisplays(f.name)),e)){for(l=n.DragonBones.webAssembly?e.size():e.length,s=f.displayList,s.length=l,o=0,p=l;o<p;++o)a=n.DragonBones.webAssembly?e.get(o):e[o],s[o]=null!==a?this._getSlotDisplay(null,a,null,f):null;v=!0;f.rawDisplayDatas=e;f.displayList=s}else r&&(f.rawDisplayDatas=null,f.displayList=[]);return v},i.prototype.replaceAnimation=function(t,i,r){var c,l,o,u,s,a,y,f,e,p;if(void 0===r&&(r=!0),c=i.defaultSkin,null===c)return!1;if(r)t.animation.animations=i.animations;else{l=t.animation.animations;o={};for(u in l)o[u]=l[u];for(u in i.animations)o[u]=i.animations[u];t.animation.animations=o}for(s=0,a=t.getSlots();s<a.length;s++)for(var w=a[s],h=0,v=0,b=w.displayList;v<b.length;v++)y=b[v],y instanceof n.Armature&&(f=c.getDisplays(w.name),null!==f&&h<(n.DragonBones.webAssembly?f.size():f.length)&&(e=n.DragonBones.webAssembly?f.get(h):f[h],null!==e&&1===e.type&&(p=this.getArmatureData(e.path,e.parent.parent.parent.name),p&&this.replaceAnimation(y,p,r)))),h++;return!0},i.prototype.getAllDragonBonesData=function(){return this._dragonBonesDataMap},i.prototype.getAllTextureAtlasData=function(){return this._textureAtlasDataMap},Object.defineProperty(i.prototype,"clock",{get:function(){return this._dragonBones.clock},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dragonBones",{get:function(){return this._dragonBones},enumerable:!0,configurable:!0}),i.prototype.changeSkin=function(n,t,i){return void 0===i&&(i=null),this.replaceSkin(n,t,!1,i)},i.prototype.copyAnimationsToArmature=function(n,t,i,r,u){void 0===i&&(i="");void 0===r&&(r="");void 0===u&&(u=!0);var f=this.getArmatureData(t,r);return!!f&&this.replaceAnimation(n,f,u)},i._objectParser=null,i._binaryParser=null,i}(),t;n.BaseFactory=i;t=function(){this.dataName="";this.textureAtlasName="";this.skin=null};n.BuildArmaturePackage=t}(i||(i={}));t.exports=i},{}],357:[function(n,t,i){"use strict";function ht(n){return n&&n.__esModule?n:{"default":n}}function kt(n,t){var r,u,o,f;if(!n)return null;switch(t){case 1:r=g?cc.macro.ONE:cc.macro.SRC_ALPHA;u=cc.macro.ONE;break;case 10:r=cc.macro.DST_COLOR;u=cc.macro.ONE_MINUS_SRC_ALPHA;break;case 12:r=cc.macro.ONE;u=cc.macro.ONE_MINUS_SRC_COLOR;break;case 0:default:r=g?cc.macro.ONE:cc.macro.SRC_ALPHA;u=cc.macro.ONE_MINUS_SRC_ALPHA}if(o=!s.enableBatch,f=s._materials[0],!f)return null;var e=s._materialCache,h=n.getId()+r+u+o,i=e[h];return i||(e.baseMaterial?i=cc.MaterialVariant.create(f):(i=f,e.baseMaterial=f),i.define("CC_USE_MODEL",o),i.setProperty("texture",n),i.setBlend(!0,bt.BLEND_FUNC_ADD,r,u,bt.BLEND_FUNC_ADD,r,u),e[h]=i),i}function et(n,t){ft=n.a*t*vt;nt=g?ft/255:1;yt=n.r*ct*nt;pt=n.g*lt*nt;wt=n.b*at*nt;ut=(ft<<24>>>0)+(wt<<16)+(pt<<8)+yt}var rt,st,ot;i.__esModule=!0;i.default=void 0;rt=ht(n("../../cocos2d/core/renderer/assembler"));st=ht(n("../../cocos2d/core/value-types/mat4"));var ct,lt,at,vt,g,nt,e,u,o,f,s,r,l,tt,it,a,h,c,ut,yt,pt,wt,ft,v,y,p,w,b,k,d,dt=n("./ArmatureDisplay"),gt=n("../../cocos2d/core/renderer/render-flow"),bt=cc.gfx,ni=cc.color(255,0,0,255),ti=cc.color(0,0,255,255),ii=cc.color(0,255,0,255);ot=function(n){function rt(){return n.apply(this,arguments)||this}var i,nt,t;return nt=n,(i=rt).prototype=Object.create(nt.prototype),i.prototype.constructor=i,i.__proto__=nt,t=rt.prototype,t.updateRenderData=function(){},t.realTimeTraverse=function(n,t,i){for(var nt,wt,ht,bt,rt,vt,yt,ct,v,ft,lt,s,g,ot,pt=n._slots,at=0,dt=pt.length;at<dt;at++)if(lt=(s=pt[at])._color,s._visible&&s._displayData)if(t?s._mulMat(s._worldMatrix,t,s._matrix):st.default.copy(s._worldMatrix,s._matrix),s.childArmature)this.realTimeTraverse(s.childArmature,s._worldMatrix,i*lt.a/255);else if(ct=kt(s.getTexture(),s._blendMode)){for((e||ct.getHash()!==f.material.getHash())&&(e=!1,f._flush(),f.node=o,f.material=ct),et(lt,i),g=s._worldMatrix.m,v=s._localVertices,it=v.length>>2,ft=s._indices,a=ft.length,ot=u.request(it,a),l=ot.indiceOffset,r=ot.byteOffset>>2,tt=ot.vertexOffset,rt=u._vData,vt=u._iData,yt=u._uintVData,y=g[0],p=g[4],w=g[12],b=g[1],k=g[5],d=g[13],nt=0,wt=v.length;nt<wt;)h=v[nt++],c=v[nt++],rt[r++]=h*y+c*p+w,rt[r++]=h*b+c*k+d,rt[r++]=v[nt++],rt[r++]=v[nt++],yt[r++]=ut;for(ht=0,bt=ft.length;ht<bt;ht++)vt[l++]=tt+ft[ht]}},t.cacheTraverse=function(n,t){var ot,g,lt,ti,rt,at,ii,ft,ri,nt,ui;if(n&&(ot=n.segments,0!=ot.length)){var i,pt,wt,vt,st,ei=n.vertices,oi=n.indices,ht=0,si=0,s=0;t&&(g=t.m,y=g[0],b=g[1],p=g[4],k=g[5],w=g[12],d=g[13]);var bt=16&v,hi=bt&&1===y&&0===b&&0===p&&1===k,dt=0,gt=n.colors,ct=gt[dt++],ni=ct.vfOffset;for(et(ct,1),lt=0,ti=ot.length;lt<ti;lt++){for(rt=ot[lt],vt=kt(rt.tex,rt.blendMode),(e||vt.getHash()!==f.material.getHash())&&(e=!1,f._flush(),f.node=o,f.material=vt),it=rt.vertexCount,a=rt.indexCount,st=u.request(it,a),l=st.indiceOffset,tt=st.vertexOffset,r=st.byteOffset>>2,i=u._vData,pt=u._iData,wt=u._uintVData,at=l,ii=l+a;at<ii;at++)pt[at]=tt+oi[si++];if(s=rt.vfCount,i.set(ei.subarray(ht,ht+s),r),ht+=s,hi)for(ft=r,ri=r+s;ft<ri;ft+=5)i[ft]+=w,i[ft+1]+=d;else if(bt)for(nt=r,ui=r+s;nt<ui;nt+=5)h=i[nt],c=i[nt+1],i[nt]=h*y+c*p+w,i[nt+1]=h*b+c*k+d;if(1&v)for(var fi=ht-s,yt=r+4,ci=r+4+s;yt<ci;yt+=5,fi+=5)fi>=ni&&(et(ct=gt[dt++],1),ni=ct.vfOffset),wt[yt]=ut}}},t.fillBuffers=function(n,t){var c,r,l,i;if(n.node._renderFlag|=gt.FLAG_UPDATE_RENDER_DATA,c=n._armature,c){if(e=!0,g=n.premultipliedAlpha,o=n.node,u=t._meshBuffer,f=t,s=n,v=0,r=o._color,ct=r.r/255,lt=r.g/255,at=r.b/255,vt=r.a/255,4294967295!==r._val&&(v|=1),l=void 0,s.enableBatch&&(l=o._worldMatrix,e=!1,v|=16),n.isAnimationCached())this.cacheTraverse(n._curFrame,l);else if(this.realTimeTraverse(c,l,1),i=n._debugDraw,n.debugBones&&i){i.clear();i.lineWidth=5;i.strokeColor=ni;i.fillColor=ti;for(var w=c.getBones(),a=0,k=w.length;a<k;a++){var h=w[a],b=Math.max(h.boneData.length,5),y=h.globalTransformMatrix.tx,p=h.globalTransformMatrix.ty,d=y+h.globalTransformMatrix.a*b,nt=p+h.globalTransformMatrix.b*b;i.moveTo(y,p);i.lineTo(d,nt);i.stroke();i.circle(y,p,2*Math.PI);i.fill();0===a&&(i.fillColor=ii)}}t.worldMatDirty++;n.attachUtil._syncAttachedNode();o=void 0;u=void 0;f=void 0;s=void 0}},t.postFillBuffers=function(n,t){t.worldMatDirty--},rt}(rt.default);i.default=ot;rt.default.register(dt,ot);t.exports=i.default},{"../../cocos2d/core/renderer/assembler":223,"../../cocos2d/core/renderer/render-flow":227,"../../cocos2d/core/value-types/mat4":286,"./ArmatureDisplay":347}],358:[function(n,t){"use strict";var i,u=(i=n("../../cocos2d/core/value-types/mat4"))&&i.__esModule?i:{"default":i},f=n("../../cocos2d/core/renderer/render-flow").FLAG_TRANSFORM,e=function(){},r=function(n){Object.defineProperty(n,"_worldMatDirty",{get:function(){return!0},set:function(){}});n._calculWorldMatrix=e;n._mulMat=e},o=new u.default,s=cc.Class({name:"sp.AttachUtil",ctor:function(){this._inited=!1;this._skeleton=null;this._skeletonNode=null;this._skeletonComp=null;this._attachedRootNode=null;this._attachedNodeArray=[];this._boneIndexToNode={}},init:function(n){this._inited=!0;this._skeleton=n._skeleton;this._skeletonNode=n.node;this._skeletonComp=n},reset:function(){this._inited=!1;this._skeleton=null;this._skeletonNode=null;this._skeletonComp=null},_prepareAttachNode:function(){if(this._skeleton){var n=this._skeletonNode.getChildByName("ATTACHED_NODE_TREE");return n&&n.isValid||(n=new cc.Node("ATTACHED_NODE_TREE"),r(n),this._skeletonNode.addChild(n)),this._skeletonComp.isAnimationCached()&&this._skeletonComp._frameCache&&this._skeletonComp._frameCache.enableCacheAttachedInfo(),this._attachedRootNode=n,n}},_buildBoneAttachedNode:function(n,t){var r="ATTACHED_NODE:"+n.data.name,i=new cc.Node(r);return this._buildBoneRelation(i,n,t),i},_buildBoneRelation:function(n,t,i){r(n);n._bone=t;n._boneIndex=i;this._attachedNodeArray.push(n);this._boneIndexToNode[i]=n},getAttachedRootNode:function(){return this._attachedRootNode},getAttachedNodes:function(n){var u=this._attachedNodeArray,r=[],i,f,t;if(!this._inited)return r;for(i=0,f=u.length;i<f;i++)t=u[i],t&&t.isValid&&t.name==="ATTACHED_NODE:"+n&&r.push(t);return r},_rebuildNodeArray:function(){for(var n,r=this._boneIndexToNode={},i=this._attachedNodeArray,u=this._attachedNodeArray=[],t=0,f=i.length;t<f;t++)n=i[t],n&&n.isValid&&!n._toRemove&&(u.push(n),r[n._boneIndex]=n)},_sortNodeArray:function(){this._attachedNodeArray.sort(function(n,t){return n._boneIndex<t._boneIndex?-1:1})},_getNodeByBoneIndex:function(n){var t=this._boneIndexToNode[n];return t&&t.isValid?t:null},destroyAttachedNodes:function(n){var t;if(this._inited){for(var r=this._attachedNodeArray,u=function n(t){for(var r,u=t.children,i=0,f=u.length;i<f;i++)r=u[i],r&&n(r);t._toRemove=!0},i=0,f=r.length;i<f;i++)t=r[i],t&&t.isValid&&t.name.split("ATTACHED_NODE:")[1]===n&&(u(t),t.removeFromParent(!0),t.destroy(),r[i]=null);this._rebuildNodeArray()}},generateAttachedNodes:function(n){var t=[],i,f,h;if(!this._inited||(i=this._prepareAttachNode(),!i))return t;for(var r=[],o=this._skeleton.bones,u=0,c=o.length;u<c;u++)f=o[u],f.data.name==n&&r.push(f);for(var s=function(n){var r,t,u;if(n)return(r=n.data,t=this._getNodeByBoneIndex(r.index),t)?t:(t=this._buildBoneAttachedNode(n,r.index),u=s(n.parent)||i,t.parent=u,t)}.bind(this),e=0,l=r.length;e<l;e++)h=s(r[e]),t.push(h);return this._sortNodeArray(),t},destroyAllAttachedNodes:function(){if(this._attachedRootNode=null,this._attachedNodeArray.length=0,this._boneIndexToNode={},this._inited){var n=this._skeletonNode.getChildByName("ATTACHED_NODE_TREE");n&&(n.removeFromParent(!0),n.destroy(),n=null)}},generateAllAttachedNodes:function(){var r,o,n;if(this._inited&&(this._boneIndexToNode={},this._attachedNodeArray.length=0,r=this._prepareAttachNode(),r)){for(var e=this._skeleton.bones,u=0,s=e.length;u<s;u++){var t=e[u],f=t.data,i=null;t.parent?(o=t.parent.data.index,i=this._boneIndexToNode[o]):i=r;i&&(n=i.getChildByName("ATTACHED_NODE:"+f.name),n&&n.isValid?this._buildBoneRelation(n,t,f.index):(n=this._buildBoneAttachedNode(t,f.index),i.addChild(n)))}return r}},_hasAttachedNode:function(){return!!this._inited&&!!this._skeletonNode.getChildByName("ATTACHED_NODE_TREE")},_associateAttachedNode:function(){var n,s,u;if(this._inited&&(n=this._skeletonNode.getChildByName("ATTACHED_NODE_TREE"),n&&n.isValid)){this._attachedRootNode=n;this._boneIndexToNode={};this._attachedNodeArray.length=0;r(n);this._skeletonComp.isAnimationCached()&&this._skeletonComp._frameCache&&this._skeletonComp._frameCache.enableCacheAttachedInfo();for(var e=this._skeleton.bones,f=0,h=e.length;f<h;f++){var t=e[f],o=t.data,i=null;t.parent?(s=t.parent.data.index,i=this._boneIndexToNode[s]):i=n;i&&(u=i.getChildByName("ATTACHED_NODE:"+o.name),u&&u.isValid&&this._buildBoneRelation(u,t,o.index))}}},_syncAttachedNode:function(){var t,i,h,c,n,s;if(this._inited){if(t=this._attachedRootNode,i=this._attachedNodeArray,!t||!t.isValid)return this._attachedRootNode=null,void(i.length=0);if(h=this._skeletonNode._worldMatrix,u.default.copy(t._worldMatrix,h),t._renderFlag&=~f,c=this._skeletonComp.isAnimationCached()?this._skeletonComp._curFrame&&this._skeletonComp._curFrame.boneInfos:this._skeleton.bones){for(var l=this._skeletonNode._mulMat,a=function(n,t,i){var r=o.m;r[0]=i.a;r[1]=i.c;r[4]=i.b;r[5]=i.d;r[12]=i.worldX;r[13]=i.worldY;l(n,t,o)},e=!1,r=0,v=i.length;r<v;r++)n=i[r],n&&n.isValid?(s=c[n._boneIndex],s?(a(n._worldMatrix,t._worldMatrix,s),n._renderFlag&=~f):(n.removeFromParent(!0),n.destroy(),i[r]=null,e=!0)):(i[r]=null,e=!0);e&&this._rebuildNodeArray()}}}});t.exports=sp.AttachUtil=s},{"../../cocos2d/core/renderer/render-flow":227,"../../cocos2d/core/value-types/mat4":286}],359:[function(n,t){"use strict";var i=n("./track-entry-listeners"),o=n("../../cocos2d/core/components/CCRenderComponent"),u=n("./lib/spine"),s=n("../../cocos2d/core/graphics/graphics"),f=n("../../cocos2d/core/renderer/render-flow").FLAG_POST_RENDER,e=n("./skeleton-cache"),h=n("./AttachUtil"),c=cc.Enum({"default":-1}),l=cc.Enum({"<None>":0}),r=cc.Enum({REALTIME:0,SHARED_CACHE:1,PRIVATE_CACHE:2});sp.Skeleton=cc.Class({name:"sp.Skeleton","extends":o,editor:!1,statics:{AnimationCacheMode:r},properties:{paused:{"default":!1,visible:!1},skeletonData:{"default":null,type:sp.SkeletonData,notify:function(){this.defaultSkin="";this.defaultAnimation="";this._updateSkeletonData()},tooltip:!1},defaultSkin:{"default":"",visible:!1},defaultAnimation:{"default":"",visible:!1},animation:{get:function(){if(this.isAnimationCached())return this._animationName;var n=this.getCurrent(0);return n&&n.animation.name||""},set:function(n){this.defaultAnimation=n;n?this.setAnimation(0,n,this.loop):this.isAnimationCached()||(this.clearTrack(0),this.setToSetupPose())},visible:!1},_defaultSkinIndex:{get:function(){var n,t;if(this.skeletonData&&(n=this.skeletonData.getSkinsEnum(),n))if(""===this.defaultSkin){if(n.hasOwnProperty(0))return this._defaultSkinIndex=0,0}else if(t=n[this.defaultSkin],void 0!==t)return t;return 0},set:function(n){var t,i;if(this.skeletonData&&(t=this.skeletonData.getSkinsEnum()),!t)return cc.errorID("",this.name);i=t[n];void 0!==i?(this.defaultSkin=i,this.setSkin(this.defaultSkin)):cc.errorID(7501,this.name)},type:c,visible:!0,animatable:!1,displayName:"Default Skin",tooltip:!1},_animationIndex:{get:function(){var i=this.animation,n,t;return this.skeletonData&&i&&(n=this.skeletonData.getAnimsEnum(),n&&(t=n[i],void 0!==t))?t:0},set:function(n){var t,i;if(0!==n){if(this.skeletonData&&(t=this.skeletonData.getAnimsEnum()),!t)return cc.errorID(7502,this.name);i=t[n];void 0!==i?this.animation=i:cc.errorID(7503,this.name)}else this.animation=""},type:l,visible:!0,animatable:!1,displayName:"Animation",tooltip:!1},_preCacheMode:-1,_cacheMode:r.REALTIME,_defaultCacheMode:{"default":0,type:r,notify:function(){this.setAnimationCacheMode(this._defaultCacheMode)},editorOnly:!0,visible:!0,animatable:!1,displayName:"Animation Cache Mode",tooltip:!1},loop:{"default":!0,tooltip:!1},premultipliedAlpha:{"default":!0,tooltip:!1},timeScale:{"default":1,tooltip:!1},debugSlots:{"default":!1,editorOnly:!0,tooltip:!1,notify:function(){this._updateDebugDraw()}},debugBones:{"default":!1,editorOnly:!0,tooltip:!1,notify:function(){this._updateDebugDraw()}},debugMesh:{"default":!1,editorOnly:!0,tooltip:!1,notify:function(){this._updateDebugDraw()}},useTint:{"default":!1,tooltip:!1,notify:function(){this._updateUseTint()}},enableBatch:{"default":!1,notify:function(){this._updateBatch()},tooltip:!1},_accTime:0,_playCount:0,_frameCache:null,_curFrame:null,_skeletonCache:null,_animationName:"",_animationQueue:[],_headAniInfo:null,_playTimes:0,_isAniComplete:!0},ctor:function(){this._effectDelegate=null;this._skeleton=null;this._rootBone=null;this._listener=null;this._materialCache={};this._debugRenderer=null;this._startSlotIndex=-1;this._endSlotIndex=-1;this._startEntry={animation:{name:""},trackIndex:0};this._endEntry={animation:{name:""},trackIndex:0};this.attachUtil=new h},_getDefaultMaterial:function(){return cc.Material.getBuiltinMaterial("2d-spine")},_updateMaterial:function(){var r=this.useTint||this.isAnimationCached()&&!0,n=this.getMaterial(0),t,i;n&&(n.define("USE_TINT",r),n.define("CC_USE_MODEL",!this.enableBatch),t=this.premultipliedAlpha?cc.gfx.BLEND_ONE:cc.gfx.BLEND_SRC_ALPHA,i=cc.gfx.BLEND_ONE_MINUS_SRC_ALPHA,n.setBlend(!0,cc.gfx.BLEND_FUNC_ADD,t,t,cc.gfx.BLEND_FUNC_ADD,i,i));this._materialCache={}},disableRender:function(){this._super();this.node._renderFlag&=~f},markForRender:function(n){this._super(n);n?this.node._renderFlag|=f:this.node._renderFlag&=~f},_updateUseTint:function(){var n=this.getMaterial(0),t;n&&(t=this.useTint||this.isAnimationCached()&&!0,n.define("USE_TINT",t));this._materialCache={}},_updateBatch:function(){var n=this.getMaterial(0);n&&n.define("CC_USE_MODEL",!this.enableBatch);this._materialCache={}},_validateRender:function(){var n=this.skeletonData;n&&n.isTexturesLoaded()?this._super():this.disableRender()},setSkeletonData:function(n){if(null!=n.width&&null!=n.height&&this.node.setContentSize(n.width,n.height),this._cacheMode===r.SHARED_CACHE?this._skeletonCache=e.sharedCache:this._cacheMode===r.PRIVATE_CACHE&&(this._skeletonCache=new e,this._skeletonCache.enablePrivateMode()),this.isAnimationCached()){(this.debugBones||this.debugSlots)&&cc.warn("Debug bones or slots is invalid in cached mode");var t=this._skeletonCache.getSkeletonCache(this.skeletonData._uuid,n);this._skeleton=t.skeleton;this._clipper=t.clipper;this._rootBone=this._skeleton.getRootBone()}else this._skeleton=new u.Skeleton(n),this._clipper=new u.SkeletonClipping,this._rootBone=this._skeleton.getRootBone();this.markForRender(!0)},setSlotsRange:function(n,t){this.isAnimationCached()?cc.warn("Slots visible range can not be modified in cached mode."):(this._startSlotIndex=n,this._endSlotIndex=t)},setAnimationStateData:function(n){if(this.isAnimationCached())cc.warn("'setAnimationStateData' interface can not be invoked in cached mode.");else{var t=new u.AnimationState(n);this._listener&&(this._state&&this._state.removeListener(this._listener),t.addListener(this._listener));this._state=t}},__preload:function(){var n;this._super();for(var i=this.node.children,t=0,r=i.length;t<r;t++)n=i[t],n&&"DEBUG_DRAW_NODE"===n._name&&n.destroy();this._updateSkeletonData();this._updateDebugDraw();this._updateUseTint();this._updateBatch()},setAnimationCacheMode:function(n){this._preCacheMode!==n&&(this._cacheMode=n,this._updateSkeletonData(),this._updateUseTint())},isAnimationCached:function(){return this._cacheMode!==r.REALTIME},update:function(n){var t,i,r;if(!this.paused)if(n*=this.timeScale*sp.timeScale,this.isAnimationCached()){if(this._isAniComplete){if(0===this._animationQueue.length&&!this._headAniInfo){t=this._frameCache;t&&t.isInvalid()&&(t.updateToFrame(),i=t.frames,this._curFrame=i[i.length-1]);return}(this._headAniInfo||(this._headAniInfo=this._animationQueue.shift()),this._accTime+=n,this._accTime>this._headAniInfo.delay)&&(r=this._headAniInfo,this._headAniInfo=null,this.setAnimation(0,r.animationName,r.loop));return}this._updateCache(n)}else this._updateRealtime(n)},_emitCacheCompleteEvent:function(){this._listener&&(this._endEntry.animation.name=this._animationName,this._listener.complete&&this._listener.complete(this._endEntry),this._listener.end&&this._listener.end(this._endEntry))},_updateCache:function(n){var t=this._frameCache,i,u,r;if(t.isInited()){if(i=t.frames,u=e.FrameTime,0==this._accTime&&0==this._playCount&&(this._startEntry.animation.name=this._animationName,this._listener&&this._listener.start&&this._listener.start(this._startEntry)),this._accTime+=n,r=Math.floor(this._accTime/u),t.isCompleted||t.updateToFrame(r),t.isCompleted&&r>=i.length){if(this._playCount++,this._playTimes>0&&this._playCount>=this._playTimes)return this._curFrame=i[i.length-1],this._accTime=0,this._playCount=0,this._isAniComplete=!0,void this._emitCacheCompleteEvent();this._accTime=0;r=0;this._emitCacheCompleteEvent()}this._curFrame=i[r]}},_updateRealtime:function(n){var t=this._skeleton,i=this._state;t&&(t.update(n),i&&(i.update(n),i.apply(t)))},setVertexEffectDelegate:function(n){this._effectDelegate=n},updateWorldTransform:function(){this.isAnimationCached()&&this._skeleton&&this._skeleton.updateWorldTransform()},setToSetupPose:function(){this._skeleton&&this._skeleton.setToSetupPose()},setBonesToSetupPose:function(){this._skeleton&&this._skeleton.setBonesToSetupPose()},setSlotsToSetupPose:function(){this._skeleton&&this._skeleton.setSlotsToSetupPose()},updateAnimationCache:function(n){if(this.isAnimationCached()){var t=this.skeletonData._uuid;this._skeletonCache&&this._skeletonCache.updateAnimationCache(t,n)}},invalidAnimationCache:function(){this.isAnimationCached()&&this._skeletonCache&&this._skeletonCache.invalidAnimationCache(this.skeletonData._uuid)},findBone:function(n){return this._skeleton?this._skeleton.findBone(n):null},findSlot:function(n){return this._skeleton?this._skeleton.findSlot(n):null},setSkin:function(n){this._skeleton&&(this._skeleton.setSkinByName(n),this._skeleton.setSlotsToSetupPose());this.invalidAnimationCache()},getAttachment:function(n,t){return this._skeleton?this._skeleton.getAttachmentByName(n,t):null},setAttachment:function(n,t){this._skeleton&&this._skeleton.setAttachment(n,t);this.invalidAnimationCache()},getTextureAtlas:function(n){return n.region},setMix:function(n,t,i){this._state&&this._state.data.setMix(n,t,i)},setAnimation:function(n,t,i){var r,u,f;if(this._playTimes=i?0:1,this._animationName=t,this.isAnimationCached()){if(0!==n&&cc.warn("Track index can not greater than 0 in cached mode."),!this._skeletonCache)return null;r=this._skeletonCache.getAnimationCache(this.skeletonData._uuid,t);r||(r=this._skeletonCache.initAnimationCache(this.skeletonData._uuid,t));r&&(this._isAniComplete=!1,this._accTime=0,this._playCount=0,this._frameCache=r,this.attachUtil._hasAttachedNode()&&this._frameCache.enableCacheAttachedInfo(),this._frameCache.updateToFrame(0),this._curFrame=this._frameCache.frames[0])}else if(this._skeleton)return(u=this._skeleton.data.findAnimation(t),!u)?(cc.logID(7509,t),null):(f=this._state.setAnimationWith(n,u,i),this._state.apply(this._skeleton),f);return null},addAnimation:function(n,t,i,r){if(r=r||0,this.isAnimationCached())0!==n&&cc.warn("Track index can not greater than 0 in cached mode."),this._animationQueue.push({animationName:t,loop:i,delay:r});else if(this._skeleton){var u=this._skeleton.data.findAnimation(t);return u?this._state.addAnimationWith(n,u,i,r):(cc.logID(7510,t),null)}return null},findAnimation:function(n){return this._skeleton?this._skeleton.data.findAnimation(n):null},getCurrent:function(n){if(this.isAnimationCached())cc.warn("'getCurrent' interface can not be invoked in cached mode.");else if(this._state)return this._state.getCurrent(n);return null},clearTracks:function(){this.isAnimationCached()?cc.warn("'clearTracks' interface can not be invoked in cached mode."):this._state&&this._state.clearTracks()},clearTrack:function(n){this.isAnimationCached()?cc.warn("'clearTrack' interface can not be invoked in cached mode."):this._state&&this._state.clearTrack(n)},setStartListener:function(n){this._ensureListener();this._listener.start=n},setInterruptListener:function(n){this._ensureListener();this._listener.interrupt=n},setEndListener:function(n){this._ensureListener();this._listener.end=n},setDisposeListener:function(n){this._ensureListener();this._listener.dispose=n},setCompleteListener:function(n){this._ensureListener();this._listener.complete=n},setEventListener:function(n){this._ensureListener();this._listener.event=n},setTrackStartListener:function(n,t){i.getListeners(n).start=t},setTrackInterruptListener:function(n,t){i.getListeners(n).interrupt=t},setTrackEndListener:function(n,t){i.getListeners(n).end=t},setTrackDisposeListener:function(n,t){i.getListeners(n).dispose=t},setTrackCompleteListener:function(n,t){i.getListeners(n).complete=function(n){var i=Math.floor(n.trackTime/n.animationEnd);t(n,i)}},setTrackEventListener:function(n,t){i.getListeners(n).event=t},getState:function(){return this._state},_updateAnimEnum:!1,_updateSkinEnum:!1,_ensureListener:function(){this._listener||(this._listener=new i,this._state&&this._state.addListener(this._listener))},_updateSkeletonData:function(){if(this.skeletonData){var t=this.skeletonData.getRuntimeData();if(t){try{this.setSkeletonData(t);this.isAnimationCached()||this.setAnimationStateData(new u.AnimationStateData(this._skeleton.data));this.defaultSkin&&this.setSkin(this.defaultSkin)}catch(n){n={};cc.warn(n)}this.attachUtil.init(this);this.attachUtil._associateAttachedNode();this._preCacheMode=this._cacheMode;this.animation=this.defaultAnimation}else this.disableRender()}else this.disableRender()},_refreshInspector:function(){this._updateAnimEnum();this._updateSkinEnum();Editor.Utils.refreshSelectedInspector("node",this.node.uuid)},_updateDebugDraw:function(){var t,n;this.debugBones||this.debugSlots?(this._debugRenderer||(t=new cc.PrivateNode,t.name="DEBUG_DRAW_NODE",n=t.addComponent(s),n.lineWidth=1,n.strokeColor=cc.color(255,0,0,255),this._debugRenderer=n),this._debugRenderer.node.parent=this.node,this.isAnimationCached()&&cc.warn("Debug bones or slots is invalid in cached mode")):this._debugRenderer&&(this._debugRenderer.node.parent=null)}});t.exports=sp.Skeleton},{"../../cocos2d/core/components/CCRenderComponent":115,"../../cocos2d/core/graphics/graphics":158,"../../cocos2d/core/renderer/render-flow":227,"./AttachUtil":358,"./lib/spine":361,"./skeleton-cache":362,"./track-entry-listeners":366}],360:[function(n){"use strict";var t="undefined"==typeof window?global:window;t.spine=n("./lib/spine");t.sp={};sp._timeScale=1;Object.defineProperty(sp,"timeScale",{get:function(){return this._timeScale},set:function(n){this._timeScale=n},configurable:!0});sp.ATTACHMENT_TYPE={REGION:0,BOUNDING_BOX:1,MESH:2,SKINNED_MESH:3};sp.AnimationEventType=cc.Enum({START:0,INTERRUPT:1,END:2,DISPOSE:3,COMPLETE:4,EVENT:5});sp.spine=t.spine;n("./skeleton-texture");n("./skeleton-data");n("./vertex-effect-delegate");n("./Skeleton");n("./spine-assembler")},{"./Skeleton":359,"./lib/spine":361,"./skeleton-data":363,"./skeleton-texture":364,"./spine-assembler":365,"./vertex-effect-delegate":367}],361:[function(n,t){"use strict";var u,f,i,r=(u=function(n,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])})(n,t)},function(n,t){function i(){this.constructor=n}u(n,t);n.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});(function(n){var t,e,i,u=function(){function n(n,t,i){if(null==n)throw new Error("name cannot be null.");if(null==t)throw new Error("timelines cannot be null.");this.name=n;this.timelines=t;this.timelineIds=[];for(var r=0;r<t.length;r++)this.timelineIds[t[r].getPropertyId()]=!0;this.duration=i}return n.prototype.hasTimeline=function(n){return 1==this.timelineIds[n]},n.prototype.apply=function(n,t,i,r,u,f,e,o){if(null==n)throw new Error("skeleton cannot be null.");r&&0!=this.duration&&(i%=this.duration,t>0&&(t%=this.duration));for(var h=this.timelines,s=0,c=h.length;s<c;s++)h[s].apply(n,t,i,u,f,e,o)},n.binarySearch=function(n,t,i){var u,r,f;if(void 0===i&&(i=1),u=0,r=n.length/i-2,0==r)return i;for(f=r>>>1;;){if(n[(f+1)*i]<=t?u=f+1:r=f,u==r)return(u+1)*i;f=u+r>>>1}},n.linearSearch=function(n,t,i){for(var r=0,u=n.length-i;r<=u;r+=i)if(n[r]>t)return r;return-1},n}(),f,c,o,l,a,v,y,p,s,w,b,k,d,g,h,nt,tt;n.Animation=u,function(n){n[n.setup=0]="setup";n[n.first=1]="first";n[n.replace=2]="replace";n[n.add=3]="add"}(t=n.MixBlend||(n.MixBlend={})),function(n){n[n.mixIn=0]="mixIn";n[n.mixOut=1]="mixOut"}(e=n.MixDirection||(n.MixDirection={})),function(n){n[n.rotate=0]="rotate";n[n.translate=1]="translate";n[n.scale=2]="scale";n[n.shear=3]="shear";n[n.attachment=4]="attachment";n[n.color=5]="color";n[n.deform=6]="deform";n[n.event=7]="event";n[n.drawOrder=8]="drawOrder";n[n.ikConstraint=9]="ikConstraint";n[n.transformConstraint=10]="transformConstraint";n[n.pathConstraintPosition=11]="pathConstraintPosition";n[n.pathConstraintSpacing=12]="pathConstraintSpacing";n[n.pathConstraintMix=13]="pathConstraintMix";n[n.twoColor=14]="twoColor"}(i=n.TimelineType||(n.TimelineType={}));f=function(){function t(i){if(i<=0)throw new Error("frameCount must be > 0: "+i);this.curves=n.Utils.newFloatArray((i-1)*t.BEZIER_SIZE)}return t.prototype.getFrameCount=function(){return this.curves.length/t.BEZIER_SIZE+1},t.prototype.setLinear=function(n){this.curves[n*t.BEZIER_SIZE]=t.LINEAR},t.prototype.setStepped=function(n){this.curves[n*t.BEZIER_SIZE]=t.STEPPED},t.prototype.getCurveType=function(n){var r=n*t.BEZIER_SIZE,i;return r==this.curves.length?t.LINEAR:(i=this.curves[r],i==t.LINEAR?t.LINEAR:i==t.STEPPED?t.STEPPED:t.BEZIER)},t.prototype.setCurve=function(n,i,r,u,f){var a=.03*(2*-i+u),v=.03*(2*-r+f),o=.006*(3*(i-u)+1),s=.006*(3*(r-f)+1),y=2*a+o,p=2*v+s,h=.3*i+a+.16666667*o,c=.3*r+v+.16666667*s,e=n*t.BEZIER_SIZE,l=this.curves;l[e++]=t.BEZIER;for(var w=h,b=c,k=e+t.BEZIER_SIZE-1;e<k;e+=2)l[e]=w,l[e+1]=b,h+=y,c+=p,y+=o,p+=s,w+=h,b+=c},t.prototype.getCurvePercent=function(i,r){var e,o,h;r=n.MathUtils.clamp(r,0,1);var f=this.curves,u=i*t.BEZIER_SIZE,c=f[u];if(c==t.LINEAR)return r;if(c==t.STEPPED)return 0;for(var s=0,l=++u,a=u+t.BEZIER_SIZE-1;u<a;u+=2)if((s=f[u])>=r)return e=void 0,o=void 0,u==l?(e=0,o=0):(e=f[u-2],o=f[u-1]),o+(f[u+1]-o)*(r-e)/(s-e);return h=f[u-1],h+(1-h)*(r-s)/(1-s)},t.LINEAR=0,t.STEPPED=1,t.BEZIER=2,t.BEZIER_SIZE=19,t}();n.CurveTimeline=f;c=function(f){function e(t){var i=f.call(this,t)||this;return i.frames=n.Utils.newFloatArray(t<<1),i}return r(e,f),e.prototype.getPropertyId=function(){return(i.rotate<<24)+this.boneIndex},e.prototype.setFrame=function(n,t,i){n<<=1;this.frames[n]=t;this.frames[n+e.ROTATION]=i},e.prototype.apply=function(n,i,r,f,o,s){var c=this.frames,h=n.bones[this.boneIndex],y,a;if(h.active)if(r<c[0])switch(s){case t.setup:return void(h.rotation=h.data.rotation);case t.first:y=h.data.rotation-h.rotation;h.rotation+=(y-360*(16384-(16384.499999999996-y/360|0)))*o}else if(r>=c[c.length-e.ENTRIES]){a=c[c.length+e.PREV_ROTATION];switch(s){case t.setup:h.rotation=h.data.rotation+a*o;break;case t.first:case t.replace:a+=h.data.rotation-h.rotation;a-=360*(16384-(16384.499999999996-a/360|0));case t.add:h.rotation+=a*o}}else{var v=u.binarySearch(c,r,e.ENTRIES),p=c[v+e.PREV_ROTATION],w=c[v],b=this.getCurvePercent((v>>1)-1,1-(r-w)/(c[v+e.PREV_TIME]-w)),l=c[v+e.ROTATION]-p;switch(l=p+(l-360*(16384-(16384.499999999996-l/360|0)))*b,s){case t.setup:h.rotation=h.data.rotation+(l-360*(16384-(16384.499999999996-l/360|0)))*o;break;case t.first:case t.replace:l+=h.data.rotation-h.rotation;case t.add:h.rotation+=(l-360*(16384-(16384.499999999996-l/360|0)))*o}}},e.ENTRIES=2,e.PREV_TIME=-2,e.PREV_ROTATION=-1,e.ROTATION=1,e}(f);n.RotateTimeline=c;o=function(f){function e(t){var i=f.call(this,t)||this;return i.frames=n.Utils.newFloatArray(t*e.ENTRIES),i}return r(e,f),e.prototype.getPropertyId=function(){return(i.translate<<24)+this.boneIndex},e.prototype.setFrame=function(n,t,i,r){n*=e.ENTRIES;this.frames[n]=t;this.frames[n+e.X]=i;this.frames[n+e.Y]=r},e.prototype.apply=function(n,i,r,f,o,s){var c=this.frames,h=n.bones[this.boneIndex],l,a,v,y,p;if(h.active)if(r<c[0])switch(s){case t.setup:return h.x=h.data.x,void(h.y=h.data.y);case t.first:h.x+=(h.data.x-h.x)*o;h.y+=(h.data.y-h.y)*o}else{l=0;a=0;r>=c[c.length-e.ENTRIES]?(l=c[c.length+e.PREV_X],a=c[c.length+e.PREV_Y]):(v=u.binarySearch(c,r,e.ENTRIES),l=c[v+e.PREV_X],a=c[v+e.PREV_Y],y=c[v],p=this.getCurvePercent(v/e.ENTRIES-1,1-(r-y)/(c[v+e.PREV_TIME]-y)),l+=(c[v+e.X]-l)*p,a+=(c[v+e.Y]-a)*p);switch(s){case t.setup:h.x=h.data.x+l*o;h.y=h.data.y+a*o;break;case t.first:case t.replace:h.x+=(h.data.x+l-h.x)*o;h.y+=(h.data.y+a-h.y)*o;break;case t.add:h.x+=l*o;h.y+=a*o}}},e.ENTRIES=3,e.PREV_TIME=-3,e.PREV_X=-2,e.PREV_Y=-1,e.X=1,e.Y=2,e}(f);n.TranslateTimeline=o;l=function(f){function o(n){return f.call(this,n)||this}return r(o,f),o.prototype.getPropertyId=function(){return(i.scale<<24)+this.boneIndex},o.prototype.apply=function(i,r,f,s,h,c,l){var b=this.frames,a=i.bones[this.boneIndex],p,w,k,d,g,v,y;if(a.active)if(f<b[0])switch(c){case t.setup:return a.scaleX=a.data.scaleX,void(a.scaleY=a.data.scaleY);case t.first:a.scaleX+=(a.data.scaleX-a.scaleX)*h;a.scaleY+=(a.data.scaleY-a.scaleY)*h}else if(p=0,w=0,f>=b[b.length-o.ENTRIES]?(p=b[b.length+o.PREV_X]*a.data.scaleX,w=b[b.length+o.PREV_Y]*a.data.scaleY):(k=u.binarySearch(b,f,o.ENTRIES),p=b[k+o.PREV_X],w=b[k+o.PREV_Y],d=b[k],g=this.getCurvePercent(k/o.ENTRIES-1,1-(f-d)/(b[k+o.PREV_TIME]-d)),p=(p+(b[k+o.X]-p)*g)*a.data.scaleX,w=(w+(b[k+o.Y]-w)*g)*a.data.scaleY),1==h)c==t.add?(a.scaleX+=p-a.data.scaleX,a.scaleY+=w-a.data.scaleY):(a.scaleX=p,a.scaleY=w);else if(v=0,y=0,l==e.mixOut)switch(c){case t.setup:v=a.data.scaleX;y=a.data.scaleY;a.scaleX=v+(Math.abs(p)*n.MathUtils.signum(v)-v)*h;a.scaleY=y+(Math.abs(w)*n.MathUtils.signum(y)-y)*h;break;case t.first:case t.replace:v=a.scaleX;y=a.scaleY;a.scaleX=v+(Math.abs(p)*n.MathUtils.signum(v)-v)*h;a.scaleY=y+(Math.abs(w)*n.MathUtils.signum(y)-y)*h;break;case t.add:v=a.scaleX;y=a.scaleY;a.scaleX=v+(Math.abs(p)*n.MathUtils.signum(v)-a.data.scaleX)*h;a.scaleY=y+(Math.abs(w)*n.MathUtils.signum(y)-a.data.scaleY)*h}else switch(c){case t.setup:v=Math.abs(a.data.scaleX)*n.MathUtils.signum(p);y=Math.abs(a.data.scaleY)*n.MathUtils.signum(w);a.scaleX=v+(p-v)*h;a.scaleY=y+(w-y)*h;break;case t.first:case t.replace:v=Math.abs(a.scaleX)*n.MathUtils.signum(p);y=Math.abs(a.scaleY)*n.MathUtils.signum(w);a.scaleX=v+(p-v)*h;a.scaleY=y+(w-y)*h;break;case t.add:v=n.MathUtils.signum(p);y=n.MathUtils.signum(w);a.scaleX=Math.abs(a.scaleX)*v+(p-Math.abs(a.data.scaleX)*v)*h;a.scaleY=Math.abs(a.scaleY)*y+(w-Math.abs(a.data.scaleY)*y)*h}},o}(o);n.ScaleTimeline=l;a=function(n){function f(t){return n.call(this,t)||this}return r(f,n),f.prototype.getPropertyId=function(){return(i.shear<<24)+this.boneIndex},f.prototype.apply=function(n,i,r,e,o,s){var c=this.frames,h=n.bones[this.boneIndex],l,a,v,y,p;if(h.active)if(r<c[0])switch(s){case t.setup:return h.shearX=h.data.shearX,void(h.shearY=h.data.shearY);case t.first:h.shearX+=(h.data.shearX-h.shearX)*o;h.shearY+=(h.data.shearY-h.shearY)*o}else{l=0;a=0;r>=c[c.length-f.ENTRIES]?(l=c[c.length+f.PREV_X],a=c[c.length+f.PREV_Y]):(v=u.binarySearch(c,r,f.ENTRIES),l=c[v+f.PREV_X],a=c[v+f.PREV_Y],y=c[v],p=this.getCurvePercent(v/f.ENTRIES-1,1-(r-y)/(c[v+f.PREV_TIME]-y)),l+=(c[v+f.X]-l)*p,a+=(c[v+f.Y]-a)*p);switch(s){case t.setup:h.shearX=h.data.shearX+l*o;h.shearY=h.data.shearY+a*o;break;case t.first:case t.replace:h.shearX+=(h.data.shearX+l-h.shearX)*o;h.shearY+=(h.data.shearY+a-h.shearY)*o;break;case t.add:h.shearX+=l*o;h.shearY+=a*o}}},f}(o);n.ShearTimeline=a;v=function(f){function e(t){var i=f.call(this,t)||this;return i.frames=n.Utils.newFloatArray(t*e.ENTRIES),i}return r(e,f),e.prototype.getPropertyId=function(){return(i.color<<24)+this.slotIndex},e.prototype.setFrame=function(n,t,i,r,u,f){n*=e.ENTRIES;this.frames[n]=t;this.frames[n+e.R]=i;this.frames[n+e.G]=r;this.frames[n+e.B]=u;this.frames[n+e.A]=f},e.prototype.apply=function(n,i,r,f,o,s){var a=n.slots[this.slotIndex],h,c,b,k,l,g,d;if(a.bone.active)if(h=this.frames,r<h[0])switch(s){case t.setup:return void a.color.setFromColor(a.data.color);case t.first:c=a.color;b=a.data.color;c.add((b.r-c.r)*o,(b.g-c.g)*o,(b.b-c.b)*o,(b.a-c.a)*o)}else{var v=0,y=0,p=0,w=0;r>=h[h.length-e.ENTRIES]?(k=h.length,v=h[k+e.PREV_R],y=h[k+e.PREV_G],p=h[k+e.PREV_B],w=h[k+e.PREV_A]):(l=u.binarySearch(h,r,e.ENTRIES),v=h[l+e.PREV_R],y=h[l+e.PREV_G],p=h[l+e.PREV_B],w=h[l+e.PREV_A],g=h[l],d=this.getCurvePercent(l/e.ENTRIES-1,1-(r-g)/(h[l+e.PREV_TIME]-g)),v+=(h[l+e.R]-v)*d,y+=(h[l+e.G]-y)*d,p+=(h[l+e.B]-p)*d,w+=(h[l+e.A]-w)*d);1==o?a.color.set(v,y,p,w):(c=a.color,s==t.setup&&c.setFromColor(a.data.color),c.add((v-c.r)*o,(y-c.g)*o,(p-c.b)*o,(w-c.a)*o))}},e.ENTRIES=5,e.PREV_TIME=-5,e.PREV_R=-4,e.PREV_G=-3,e.PREV_B=-2,e.PREV_A=-1,e.R=1,e.G=2,e.B=3,e.A=4,e}(f);n.ColorTimeline=v;y=function(f){function e(t){var i=f.call(this,t)||this;return i.frames=n.Utils.newFloatArray(t*e.ENTRIES),i}return r(e,f),e.prototype.getPropertyId=function(){return(i.twoColor<<24)+this.slotIndex},e.prototype.setFrame=function(n,t,i,r,u,f,o,s,h){n*=e.ENTRIES;this.frames[n]=t;this.frames[n+e.R]=i;this.frames[n+e.G]=r;this.frames[n+e.B]=u;this.frames[n+e.A]=f;this.frames[n+e.R2]=o;this.frames[n+e.G2]=s;this.frames[n+e.B2]=h},e.prototype.apply=function(n,i,r,f,o,s){var l=n.slots[this.slotIndex],h,y,c,ut,p;if(l.bone.active)if(h=this.frames,r<h[0])switch(s){case t.setup:return l.color.setFromColor(l.data.color),void l.darkColor.setFromColor(l.data.darkColor);case t.first:var a=l.color,v=l.darkColor,it=l.data.color,rt=l.data.darkColor;a.add((it.r-a.r)*o,(it.g-a.g)*o,(it.b-a.b)*o,(it.a-a.a)*o);v.add((rt.r-v.r)*o,(rt.g-v.g)*o,(rt.b-v.b)*o,0)}else{var w=0,b=0,k=0,d=0,g=0,nt=0,tt=0;r>=h[h.length-e.ENTRIES]?(y=h.length,w=h[y+e.PREV_R],b=h[y+e.PREV_G],k=h[y+e.PREV_B],d=h[y+e.PREV_A],g=h[y+e.PREV_R2],nt=h[y+e.PREV_G2],tt=h[y+e.PREV_B2]):(c=u.binarySearch(h,r,e.ENTRIES),w=h[c+e.PREV_R],b=h[c+e.PREV_G],k=h[c+e.PREV_B],d=h[c+e.PREV_A],g=h[c+e.PREV_R2],nt=h[c+e.PREV_G2],tt=h[c+e.PREV_B2],ut=h[c],p=this.getCurvePercent(c/e.ENTRIES-1,1-(r-ut)/(h[c+e.PREV_TIME]-ut)),w+=(h[c+e.R]-w)*p,b+=(h[c+e.G]-b)*p,k+=(h[c+e.B]-k)*p,d+=(h[c+e.A]-d)*p,g+=(h[c+e.R2]-g)*p,nt+=(h[c+e.G2]-nt)*p,tt+=(h[c+e.B2]-tt)*p);1==o?(l.color.set(w,b,k,d),l.darkColor.set(g,nt,tt,1)):(a=l.color,v=l.darkColor,s==t.setup&&(a.setFromColor(l.data.color),v.setFromColor(l.data.darkColor)),a.add((w-a.r)*o,(b-a.g)*o,(k-a.b)*o,(d-a.a)*o),v.add((g-v.r)*o,(nt-v.g)*o,(tt-v.b)*o,0))}},e.ENTRIES=8,e.PREV_TIME=-8,e.PREV_R=-7,e.PREV_G=-6,e.PREV_B=-5,e.PREV_A=-4,e.PREV_R2=-3,e.PREV_G2=-2,e.PREV_B2=-1,e.R=1,e.G=2,e.B=3,e.A=4,e.R2=5,e.G2=6,e.B2=7,e}(f);n.TwoColorTimeline=y;p=function(){function r(t){this.frames=n.Utils.newFloatArray(t);this.attachmentNames=new Array(t)}return r.prototype.getPropertyId=function(){return(i.attachment<<24)+this.slotIndex},r.prototype.getFrameCount=function(){return this.frames.length},r.prototype.setFrame=function(n,t,i){this.frames[n]=t;this.attachmentNames[n]=i},r.prototype.apply=function(n,i,r,f,o,s,h){var l=n.slots[this.slotIndex],c,a,p,v,y;l.bone.active&&(h!=e.mixOut||s!=t.setup?(c=this.frames,r<c[0]?(s==t.setup||s==t.first)&&(a=l.data.attachmentName,l.setAttachment(null==a?null:n.getAttachment(this.slotIndex,a))):(p=r>=c[c.length-1]?c.length-1:u.binarySearch(c,r,1)-1,v=this.attachmentNames[p],n.slots[this.slotIndex].setAttachment(null==v?null:n.getAttachment(this.slotIndex,v)))):(y=l.data.attachmentName,l.setAttachment(null==y?null:n.getAttachment(this.slotIndex,y))))},r}();n.AttachmentTimeline=p;s=null;w=function(f){function e(t){var i=f.call(this,t)||this;return i.frames=n.Utils.newFloatArray(t),i.frameVertices=new Array(t),null==s&&(s=n.Utils.newFloatArray(64)),i}return r(e,f),e.prototype.getPropertyId=function(){return(i.deform<<27)+ +this.attachment.id+this.slotIndex},e.prototype.setFrame=function(n,t,i){this.frames[n]=t;this.frameVertices[n]=i},e.prototype.apply=function(i,r,f,e,o,s){var gt=i.slots[this.slotIndex],y,ut,v,dt,a,p,l,w,ft,yt,ni,et,ot,pt,st,ht,wt,nt,h,ct,lt,ti,tt,at,it,rt,vt;if(gt.bone.active&&(y=gt.getAttachment(),y instanceof n.VertexAttachment&&y.deformAttachment==this.attachment)){ut=gt.deform;0==ut.length&&(s=t.setup);var kt=this.frameVertices,c=kt[0].length,g=this.frames;if(f<g[0]){v=y;switch(s){case t.setup:return void(ut.length=0);case t.first:if(1==o){ut.length=0;break}if(dt=n.Utils.setArraySize(ut,c),null==v.bones)for(a=v.vertices,p=0;p<c;p++)dt[p]+=(a[p]-dt[p])*o;else for(o=1-o,p=0;p<c;p++)dt[p]*=o}}else if(l=n.Utils.setArraySize(ut,c),f>=g[g.length-1])if(w=kt[g.length-1],1==o)if(s==t.add)if(null==(v=y).bones)for(a=v.vertices,ft=0;ft<c;ft++)l[ft]+=w[ft]-a[ft];else for(yt=0;yt<c;yt++)l[yt]+=w[yt];else n.Utils.arrayCopy(w,0,l,0,c);else switch(s){case t.setup:if(ni=y,null==ni.bones)for(a=ni.vertices,et=0;et<c;et++)ot=a[et],l[et]=ot+(w[et]-ot)*o;else for(pt=0;pt<c;pt++)l[pt]=w[pt]*o;break;case t.first:case t.replace:for(st=0;st<c;st++)l[st]+=(w[st]-l[st])*o;case t.add:if(null==(v=y).bones)for(a=v.vertices,ht=0;ht<c;ht++)l[ht]+=(w[ht]-a[ht])*o;else for(wt=0;wt<c;wt++)l[wt]+=w[wt]*o}else{var bt=u.binarySearch(g,f),b=kt[bt-1],k=kt[bt],ii=g[bt],d=this.getCurvePercent(bt-1,1-(f-ii)/(g[bt-1]-ii));if(1==o)if(s==t.add)if(null==(v=y).bones)for(a=v.vertices,nt=0;nt<c;nt++)h=b[nt],l[nt]+=h+(k[nt]-h)*d-a[nt];else for(ct=0;ct<c;ct++)h=b[ct],l[ct]+=h+(k[ct]-h)*d;else for(lt=0;lt<c;lt++)h=b[lt],l[lt]=h+(k[lt]-h)*d;else switch(s){case t.setup:if(ti=y,null==ti.bones)for(a=ti.vertices,tt=0;tt<c;tt++)h=b[tt],ot=a[tt],l[tt]=ot+(h+(k[tt]-h)*d-ot)*o;else for(at=0;at<c;at++)h=b[at],l[at]=(h+(k[at]-h)*d)*o;break;case t.first:case t.replace:for(it=0;it<c;it++)h=b[it],l[it]+=(h+(k[it]-h)*d-l[it])*o;break;case t.add:if(null==(v=y).bones)for(a=v.vertices,rt=0;rt<c;rt++)h=b[rt],l[rt]+=(h+(k[rt]-h)*d-a[rt])*o;else for(vt=0;vt<c;vt++)h=b[vt],l[vt]+=(h+(k[vt]-h)*d)*o}}}},e}(f);n.DeformTimeline=w;b=function(){function t(t){this.frames=n.Utils.newFloatArray(t);this.events=new Array(t)}return t.prototype.getPropertyId=function(){return i.event<<24},t.prototype.getFrameCount=function(){return this.frames.length},t.prototype.setFrame=function(n,t){this.frames[n]=t.time;this.events[n]=t},t.prototype.apply=function(n,t,i,r,f,e,o){var h,c,s,l;if(null!=r){if(h=this.frames,c=this.frames.length,t>i)this.apply(n,t,Number.MAX_VALUE,r,f,e,o),t=-1;else if(t>=h[c-1])return;if(!(i<h[0])){if(s=0,t<h[0])s=0;else for(l=h[s=u.binarySearch(h,t)];s>0&&h[s-1]==l;)s--;for(;s<c&&i>=h[s];s++)r.push(this.events[s])}}},t}();n.EventTimeline=b;k=function(){function r(t){this.frames=n.Utils.newFloatArray(t);this.drawOrders=new Array(t)}return r.prototype.getPropertyId=function(){return i.drawOrder<<24},r.prototype.getFrameCount=function(){return this.frames.length},r.prototype.setFrame=function(n,t,i){this.frames[n]=t;this.drawOrders[n]=i},r.prototype.apply=function(i,r,f,o,s,h,c){var p=i.drawOrder,y=i.slots,l,w,v,a,b;if(c!=e.mixOut||h!=t.setup)if(l=this.frames,f<l[0])h!=t.setup&&h!=t.first||n.Utils.arrayCopy(i.slots,0,i.drawOrder,0,i.slots.length);else if(w=f>=l[l.length-1]?l.length-1:u.binarySearch(l,f)-1,v=this.drawOrders[w],null==v)n.Utils.arrayCopy(y,0,p,0,y.length);else for(a=0,b=v.length;a<b;a++)p[a]=y[v[a]];else n.Utils.arrayCopy(i.slots,0,i.drawOrder,0,i.slots.length)},r}();n.DrawOrderTimeline=k;d=function(f){function o(t){var i=f.call(this,t)||this;return i.frames=n.Utils.newFloatArray(t*o.ENTRIES),i}return r(o,f),o.prototype.getPropertyId=function(){return(i.ikConstraint<<24)+this.ikConstraintIndex},o.prototype.setFrame=function(n,t,i,r,u,f,e){n*=o.ENTRIES;this.frames[n]=t;this.frames[n+o.MIX]=i;this.frames[n+o.SOFTNESS]=r;this.frames[n+o.BEND_DIRECTION]=u;this.frames[n+o.COMPRESS]=f?1:0;this.frames[n+o.STRETCH]=e?1:0},o.prototype.apply=function(n,i,r,f,s,h,c){var a=this.frames,l=n.ikConstraints[this.ikConstraintIndex];if(l.active)if(r<a[0])switch(h){case t.setup:return l.mix=l.data.mix,l.softness=l.data.softness,l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,void(l.stretch=l.data.stretch);case t.first:l.mix+=(l.data.mix-l.mix)*s;l.softness+=(l.data.softness-l.softness)*s;l.bendDirection=l.data.bendDirection;l.compress=l.data.compress;l.stretch=l.data.stretch}else if(r>=a[a.length-o.ENTRIES])h==t.setup?(l.mix=l.data.mix+(a[a.length+o.PREV_MIX]-l.data.mix)*s,l.softness=l.data.softness+(a[a.length+o.PREV_SOFTNESS]-l.data.softness)*s,c==e.mixOut?(l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch):(l.bendDirection=a[a.length+o.PREV_BEND_DIRECTION],l.compress=0!=a[a.length+o.PREV_COMPRESS],l.stretch=0!=a[a.length+o.PREV_STRETCH])):(l.mix+=(a[a.length+o.PREV_MIX]-l.mix)*s,l.softness+=(a[a.length+o.PREV_SOFTNESS]-l.softness)*s,c==e.mixIn&&(l.bendDirection=a[a.length+o.PREV_BEND_DIRECTION],l.compress=0!=a[a.length+o.PREV_COMPRESS],l.stretch=0!=a[a.length+o.PREV_STRETCH]));else{var v=u.binarySearch(a,r,o.ENTRIES),y=a[v+o.PREV_MIX],p=a[v+o.PREV_SOFTNESS],b=a[v],w=this.getCurvePercent(v/o.ENTRIES-1,1-(r-b)/(a[v+o.PREV_TIME]-b));h==t.setup?(l.mix=l.data.mix+(y+(a[v+o.MIX]-y)*w-l.data.mix)*s,l.softness=l.data.softness+(p+(a[v+o.SOFTNESS]-p)*w-l.data.softness)*s,c==e.mixOut?(l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch):(l.bendDirection=a[v+o.PREV_BEND_DIRECTION],l.compress=0!=a[v+o.PREV_COMPRESS],l.stretch=0!=a[v+o.PREV_STRETCH])):(l.mix+=(y+(a[v+o.MIX]-y)*w-l.mix)*s,l.softness+=(p+(a[v+o.SOFTNESS]-p)*w-l.softness)*s,c==e.mixIn&&(l.bendDirection=a[v+o.PREV_BEND_DIRECTION],l.compress=0!=a[v+o.PREV_COMPRESS],l.stretch=0!=a[v+o.PREV_STRETCH]))}},o.ENTRIES=6,o.PREV_TIME=-6,o.PREV_MIX=-5,o.PREV_SOFTNESS=-4,o.PREV_BEND_DIRECTION=-3,o.PREV_COMPRESS=-2,o.PREV_STRETCH=-1,o.MIX=1,o.SOFTNESS=2,o.BEND_DIRECTION=3,o.COMPRESS=4,o.STRETCH=5,o}(f);n.IkConstraintTimeline=d;g=function(f){function e(t){var i=f.call(this,t)||this;return i.frames=n.Utils.newFloatArray(t*e.ENTRIES),i}return r(e,f),e.prototype.getPropertyId=function(){return(i.transformConstraint<<24)+this.transformConstraintIndex},e.prototype.setFrame=function(n,t,i,r,u,f){n*=e.ENTRIES;this.frames[n]=t;this.frames[n+e.ROTATE]=i;this.frames[n+e.TRANSLATE]=r;this.frames[n+e.SCALE]=u;this.frames[n+e.SHEAR]=f},e.prototype.apply=function(n,i,r,f,o,s){var c=this.frames,h=n.transformConstraints[this.transformConstraintIndex],l,b,a,d,k;if(h.active)if(r<c[0]){l=h.data;switch(s){case t.setup:return h.rotateMix=l.rotateMix,h.translateMix=l.translateMix,h.scaleMix=l.scaleMix,void(h.shearMix=l.shearMix);case t.first:h.rotateMix+=(l.rotateMix-h.rotateMix)*o;h.translateMix+=(l.translateMix-h.translateMix)*o;h.scaleMix+=(l.scaleMix-h.scaleMix)*o;h.shearMix+=(l.shearMix-h.shearMix)*o}}else{var v=0,y=0,p=0,w=0;r>=c[c.length-e.ENTRIES]?(b=c.length,v=c[b+e.PREV_ROTATE],y=c[b+e.PREV_TRANSLATE],p=c[b+e.PREV_SCALE],w=c[b+e.PREV_SHEAR]):(a=u.binarySearch(c,r,e.ENTRIES),v=c[a+e.PREV_ROTATE],y=c[a+e.PREV_TRANSLATE],p=c[a+e.PREV_SCALE],w=c[a+e.PREV_SHEAR],d=c[a],k=this.getCurvePercent(a/e.ENTRIES-1,1-(r-d)/(c[a+e.PREV_TIME]-d)),v+=(c[a+e.ROTATE]-v)*k,y+=(c[a+e.TRANSLATE]-y)*k,p+=(c[a+e.SCALE]-p)*k,w+=(c[a+e.SHEAR]-w)*k);s==t.setup?(l=h.data,h.rotateMix=l.rotateMix+(v-l.rotateMix)*o,h.translateMix=l.translateMix+(y-l.translateMix)*o,h.scaleMix=l.scaleMix+(p-l.scaleMix)*o,h.shearMix=l.shearMix+(w-l.shearMix)*o):(h.rotateMix+=(v-h.rotateMix)*o,h.translateMix+=(y-h.translateMix)*o,h.scaleMix+=(p-h.scaleMix)*o,h.shearMix+=(w-h.shearMix)*o)}},e.ENTRIES=5,e.PREV_TIME=-5,e.PREV_ROTATE=-4,e.PREV_TRANSLATE=-3,e.PREV_SCALE=-2,e.PREV_SHEAR=-1,e.ROTATE=1,e.TRANSLATE=2,e.SCALE=3,e.SHEAR=4,e}(f);n.TransformConstraintTimeline=g;h=function(f){function e(t){var i=f.call(this,t)||this;return i.frames=n.Utils.newFloatArray(t*e.ENTRIES),i}return r(e,f),e.prototype.getPropertyId=function(){return(i.pathConstraintPosition<<24)+this.pathConstraintIndex},e.prototype.setFrame=function(n,t,i){n*=e.ENTRIES;this.frames[n]=t;this.frames[n+e.VALUE]=i},e.prototype.apply=function(n,i,r,f,o,s){var c=this.frames,h=n.pathConstraints[this.pathConstraintIndex],l,a,v,y;if(h.active)if(r<c[0])switch(s){case t.setup:return void(h.position=h.data.position);case t.first:h.position+=(h.data.position-h.position)*o}else l=0,r>=c[c.length-e.ENTRIES]?l=c[c.length+e.PREV_VALUE]:(a=u.binarySearch(c,r,e.ENTRIES),l=c[a+e.PREV_VALUE],v=c[a],y=this.getCurvePercent(a/e.ENTRIES-1,1-(r-v)/(c[a+e.PREV_TIME]-v)),l+=(c[a+e.VALUE]-l)*y),s==t.setup?h.position=h.data.position+(l-h.data.position)*o:h.position+=(l-h.position)*o},e.ENTRIES=2,e.PREV_TIME=-2,e.PREV_VALUE=-1,e.VALUE=1,e}(f);n.PathConstraintPositionTimeline=h;nt=function(n){function f(t){return n.call(this,t)||this}return r(f,n),f.prototype.getPropertyId=function(){return(i.pathConstraintSpacing<<24)+this.pathConstraintIndex},f.prototype.apply=function(n,i,r,e,o,s){var c=this.frames,h=n.pathConstraints[this.pathConstraintIndex],l,a,v,y;if(h.active)if(r<c[0])switch(s){case t.setup:return void(h.spacing=h.data.spacing);case t.first:h.spacing+=(h.data.spacing-h.spacing)*o}else l=0,r>=c[c.length-f.ENTRIES]?l=c[c.length+f.PREV_VALUE]:(a=u.binarySearch(c,r,f.ENTRIES),l=c[a+f.PREV_VALUE],v=c[a],y=this.getCurvePercent(a/f.ENTRIES-1,1-(r-v)/(c[a+f.PREV_TIME]-v)),l+=(c[a+f.VALUE]-l)*y),s==t.setup?h.spacing=h.data.spacing+(l-h.data.spacing)*o:h.spacing+=(l-h.spacing)*o},f}(h);n.PathConstraintSpacingTimeline=nt;tt=function(f){function e(t){var i=f.call(this,t)||this;return i.frames=n.Utils.newFloatArray(t*e.ENTRIES),i}return r(e,f),e.prototype.getPropertyId=function(){return(i.pathConstraintMix<<24)+this.pathConstraintIndex},e.prototype.setFrame=function(n,t,i,r){n*=e.ENTRIES;this.frames[n]=t;this.frames[n+e.ROTATE]=i;this.frames[n+e.TRANSLATE]=r},e.prototype.apply=function(n,i,r,f,o,s){var c=this.frames,h=n.pathConstraints[this.pathConstraintIndex],a,v,l,y,p;if(h.active)if(r<c[0])switch(s){case t.setup:return h.rotateMix=h.data.rotateMix,void(h.translateMix=h.data.translateMix);case t.first:h.rotateMix+=(h.data.rotateMix-h.rotateMix)*o;h.translateMix+=(h.data.translateMix-h.translateMix)*o}else a=0,v=0,r>=c[c.length-e.ENTRIES]?(a=c[c.length+e.PREV_ROTATE],v=c[c.length+e.PREV_TRANSLATE]):(l=u.binarySearch(c,r,e.ENTRIES),a=c[l+e.PREV_ROTATE],v=c[l+e.PREV_TRANSLATE],y=c[l],p=this.getCurvePercent(l/e.ENTRIES-1,1-(r-y)/(c[l+e.PREV_TIME]-y)),a+=(c[l+e.ROTATE]-a)*p,v+=(c[l+e.TRANSLATE]-v)*p),s==t.setup?(h.rotateMix=h.data.rotateMix+(a-h.data.rotateMix)*o,h.translateMix=h.data.translateMix+(v-h.data.translateMix)*o):(h.rotateMix+=(a-h.rotateMix)*o,h.translateMix+=(v-h.translateMix)*o)},e.ENTRIES=3,e.PREV_TIME=-3,e.PREV_ROTATE=-2,e.PREV_TRANSLATE=-1,e.ROTATE=1,e.TRANSLATE=2,e}(f);n.PathConstraintMixTimeline=tt})(i||(i={})),function(n){var f=function(){function t(t){this.tracks=[];this.timeScale=1;this.events=[];this.listeners=[];this.queue=new r(this);this.propertyIDs=new n.IntSet;this.animationsChanged=!1;this.trackEntryPool=new n.Pool(function(){return new i});this.data=t}return t.prototype.update=function(n){var t,f,i,o,r;n*=this.timeScale;for(var e=this.tracks,u=0,s=e.length;u<s;u++)if(t=e[u],null!=t){if(t.animationLast=t.nextAnimationLast,t.trackLast=t.nextTrackLast,f=n*t.timeScale,t.delay>0){if(t.delay-=f,t.delay>0)continue;f=-t.delay;t.delay=0}if(i=t.next,null!=i){if(o=t.trackLast-i.delay,o>=0){for(i.delay=0,i.trackTime+=0==t.timeScale?0:(o/t.timeScale+n)*i.timeScale,t.trackTime+=f,this.setCurrent(u,i,!0);null!=i.mixingFrom;)i.mixTime+=n,i=i.mixingFrom;continue}}else if(t.trackLast>=t.trackEnd&&null==t.mixingFrom){e[u]=null;this.queue.end(t);this.disposeNext(t);continue}if(null!=t.mixingFrom&&this.updateMixingFrom(t,n))for(r=t.mixingFrom,t.mixingFrom=null,null!=r&&(r.mixingTo=null);null!=r;)this.queue.end(r),r=r.mixingFrom;t.trackTime+=f}this.queue.drain()},t.prototype.updateMixingFrom=function(n,t){var i=n.mixingFrom,r;return null==i?!0:(r=this.updateMixingFrom(i,t),i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast,n.mixTime>0&&n.mixTime>=n.mixDuration?(0!=i.totalAlpha&&0!=n.mixDuration||(n.mixingFrom=i.mixingFrom,null!=i.mixingFrom&&(i.mixingFrom.mixingTo=n),n.interruptAlpha=i.interruptAlpha,this.queue.end(i)),r):(i.trackTime+=t*i.timeScale,n.mixTime+=t,!1))},t.prototype.apply=function(i){var r,e,f,u,k,a,d,h,v;if(null==i)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var c=this.events,y=this.tracks,p=!1,o=0,g=y.length;o<g;o++)if(r=y[o],!(null==r||r.delay>0)){p=!0;e=0==o?n.MixBlend.first:r.mixBlend;f=r.alpha;null!=r.mixingFrom?f*=this.applyMixingFrom(r,i,e):r.trackTime>=r.trackEnd&&null==r.next&&(f=0);var w=r.animationLast,s=r.getAnimationTime(),l=r.animation.timelines.length,b=r.animation.timelines;if(0==o&&1==f||e==n.MixBlend.add)for(u=0;u<l;u++)n.Utils.webkit602BugfixHelper(f,e),b[u].apply(i,w,s,c,f,e,n.MixDirection.mixIn);else for(k=r.timelineMode,a=0==r.timelinesRotation.length,a&&n.Utils.setArraySize(r.timelinesRotation,l<<1,null),d=r.timelinesRotation,u=0;u<l;u++)h=b[u],v=(k[u]&t.NOT_LAST-1)==t.SUBSEQUENT?e:n.MixBlend.setup,h instanceof n.RotateTimeline?this.applyRotateTimeline(h,i,s,f,v,d,u<<1,a):(n.Utils.webkit602BugfixHelper(f,e),h.apply(i,w,s,c,f,v,n.MixDirection.mixIn));this.queueEvents(r,s);c.length=0;r.nextAnimationLast=s;r.nextTrackLast=r.trackTime}return this.queue.drain(),p},t.prototype.applyMixingFrom=function(i,r,u){var f=i.mixingFrom,o,e,rt,b;null!=f.mixingFrom&&this.applyMixingFrom(f,r,u);o=0;0==i.mixDuration?(o=1,u==n.MixBlend.first&&(u=n.MixBlend.setup)):((o=i.mixTime/i.mixDuration)>1&&(o=1),u!=n.MixBlend.first&&(u=f.mixBlend));var k=o<f.eventThreshold?this.events:null,d=o<f.attachmentThreshold,g=o<f.drawOrderThreshold,nt=f.animationLast,l=f.getAnimationTime(),a=f.animation.timelines.length,tt=f.animation.timelines,v=f.alpha*i.interruptAlpha,y=v*(1-o);if(u==n.MixBlend.add)for(e=0;e<a;e++)tt[e].apply(r,nt,l,k,y,u,n.MixDirection.mixOut);else{var p=f.timelineMode,ut=f.timelineHoldMix,it=0==f.timelinesRotation.length;for(it&&n.Utils.setArraySize(f.timelinesRotation,a<<1,null),rt=f.timelinesRotation,f.totalAlpha=0,e=0;e<a;e++){var c=tt[e],w=n.MixDirection.mixOut,s=void 0,h=0;switch(p[e]&t.NOT_LAST-1){case t.SUBSEQUENT:if(s=u,!d&&c instanceof n.AttachmentTimeline){if((p[e]&t.NOT_LAST)==t.NOT_LAST)continue;s=n.MixBlend.setup}if(!g&&c instanceof n.DrawOrderTimeline)continue;h=y;break;case t.FIRST:s=n.MixBlend.setup;h=y;break;case t.HOLD:s=n.MixBlend.setup;h=v;break;default:s=n.MixBlend.setup;b=ut[e];h=v*Math.max(0,1-b.mixTime/b.mixDuration)}f.totalAlpha+=h;c instanceof n.RotateTimeline?this.applyRotateTimeline(c,r,l,h,s,rt,e<<1,it):(n.Utils.webkit602BugfixHelper(h,u),s==n.MixBlend.setup&&(c instanceof n.AttachmentTimeline?(d||(p[e]&t.NOT_LAST)==t.NOT_LAST)&&(w=n.MixDirection.mixIn):c instanceof n.DrawOrderTimeline&&g&&(w=n.MixDirection.mixIn)),c.apply(r,nt,l,k,h,s,w))}}return i.mixDuration>0&&this.queueEvents(f,l),this.events.length=0,f.nextAnimationLast=l,f.nextTrackLast=f.trackTime,o},t.prototype.applyRotateTimeline=function(t,i,r,u,f,e,o,s){var y,l,p,v,a,b,d,g;if(s&&(e[o]=0),1!=u){var k=t,h=k.frames,c=i.bones[k.boneIndex];if(c.active){if(y=0,l=0,r<h[0])switch(f){case n.MixBlend.setup:c.rotation=c.data.rotation;default:return;case n.MixBlend.first:y=c.rotation;l=c.data.rotation}else if(y=f==n.MixBlend.setup?c.data.rotation:c.rotation,r>=h[h.length-n.RotateTimeline.ENTRIES])l=c.data.rotation+h[h.length+n.RotateTimeline.PREV_ROTATION];else{var w=n.Animation.binarySearch(h,r,n.RotateTimeline.ENTRIES),nt=h[w+n.RotateTimeline.PREV_ROTATION],tt=h[w],it=k.getCurvePercent((w>>1)-1,1-(r-tt)/(h[w+n.RotateTimeline.PREV_TIME]-tt));l=h[w+n.RotateTimeline.ROTATION]-nt;l=nt+(l-=360*(16384-(16384.499999999996-l/360|0)))*it+c.data.rotation;l-=360*(16384-(16384.499999999996-l/360|0))}p=0;v=l-y;0==(v-=360*(16384-(16384.499999999996-v/360|0)))?p=e[o]:(a=0,b=0,s?(a=0,b=v):(a=e[o],b=e[o+1]),d=v>0,g=a>=0,n.MathUtils.signum(b)!=n.MathUtils.signum(v)&&Math.abs(b)<=90&&(Math.abs(a)>180&&(a+=360*n.MathUtils.signum(a)),g=d),p=v+a-a%360,g!=d&&(p+=360*n.MathUtils.signum(a)),e[o]=p);e[o+1]=v;y+=p*u;c.rotation=y-360*(16384-(16384.499999999996-y/360|0))}}else t.apply(i,0,r,null,1,f,n.MixDirection.mixIn)},t.prototype.queueEvents=function(n,t){for(var f,o=n.animationStart,r=n.animationEnd,e=r-o,s=n.trackLast%e,u=this.events,i=0,h=u.length;i<h;i++){if(f=u[i],f.time<s)break;f.time>r||this.queue.event(n,f)}for((n.loop?0==e||s>n.trackTime%e:t>=r&&n.animationLast<r)&&this.queue.complete(n);i<h;i++)u[i].time<o||this.queue.event(n,u[i])},t.prototype.clearTracks=function(){var i=this.queue.drainDisabled,n,t;for(this.queue.drainDisabled=!0,n=0,t=this.tracks.length;n<t;n++)this.clearTrack(n);this.tracks.length=0;this.queue.drainDisabled=i;this.queue.drain()},t.prototype.clearTrack=function(n){var t,i,r;if(!(n>=this.tracks.length)&&(t=this.tracks[n],null!=t)){for(this.queue.end(t),this.disposeNext(t),i=t;;){if(r=i.mixingFrom,null==r)break;this.queue.end(r);i.mixingFrom=null;i.mixingTo=null;i=r}this.tracks[t.trackIndex]=null;this.queue.drain()}},t.prototype.setCurrent=function(n,t,i){var r=this.expandToIndex(n);this.tracks[n]=t;null!=r&&(i&&this.queue.interrupt(r),t.mixingFrom=r,r.mixingTo=t,t.mixTime=0,null!=r.mixingFrom&&r.mixDuration>0&&(t.interruptAlpha*=Math.min(1,r.mixTime/r.mixDuration)),r.timelinesRotation.length=0);this.queue.start(t)},t.prototype.setAnimation=function(n,t,i){var r=this.data.skeletonData.findAnimation(t);if(null==r)throw new Error("Animation not found: "+t);return this.setAnimationWith(n,r,i)},t.prototype.setAnimationWith=function(n,t,i){var u,r,f;if(null==t)throw new Error("animation cannot be null.");return u=!0,r=this.expandToIndex(n),null!=r&&(-1==r.nextTrackLast?(this.tracks[n]=r.mixingFrom,this.queue.interrupt(r),this.queue.end(r),this.disposeNext(r),r=r.mixingFrom,u=!1):this.disposeNext(r)),f=this.trackEntry(n,t,i,r),this.setCurrent(n,f,u),this.queue.drain(),f},t.prototype.addAnimation=function(n,t,i,r){var u=this.data.skeletonData.findAnimation(t);if(null==u)throw new Error("Animation not found: "+t);return this.addAnimationWith(n,u,i,r)},t.prototype.addAnimationWith=function(n,t,i,r){var u,f,e;if(null==t)throw new Error("animation cannot be null.");if(u=this.expandToIndex(n),null!=u)for(;null!=u.next;)u=u.next;return f=this.trackEntry(n,t,i,u),null==u?(this.setCurrent(n,f,!0),this.queue.drain()):(u.next=f,r<=0)&&(e=u.animationEnd-u.animationStart,0!=e?(r+=u.loop?e*(1+(u.trackTime/e|0)):Math.max(e,u.trackTime),r-=this.data.getMix(u.animation,t)):r=u.trackTime),f.delay=r,f},t.prototype.setEmptyAnimation=function(n,i){var r=this.setAnimationWith(n,t.emptyAnimation,!1);return r.mixDuration=i,r.trackEnd=i,r},t.prototype.addEmptyAnimation=function(n,i,r){r<=0&&(r-=i);var u=this.addAnimationWith(n,t.emptyAnimation,!1,r);return u.mixDuration=i,u.trackEnd=i,u},t.prototype.setEmptyAnimations=function(n){var u=this.queue.drainDisabled,t,r,i;for(this.queue.drainDisabled=!0,t=0,r=this.tracks.length;t<r;t++)i=this.tracks[t],null!=i&&this.setEmptyAnimation(i.trackIndex,n);this.queue.drainDisabled=u;this.queue.drain()},t.prototype.expandToIndex=function(t){return t<this.tracks.length?this.tracks[t]:(n.Utils.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)},t.prototype.trackEntry=function(n,t,i,r){var u=this.trackEntryPool.obtain();return u.trackIndex=n,u.animation=t,u.loop=i,u.holdPrevious=!1,u.eventThreshold=0,u.attachmentThreshold=0,u.drawOrderThreshold=0,u.animationStart=0,u.animationEnd=t.duration,u.animationLast=-1,u.nextAnimationLast=-1,u.delay=0,u.trackTime=0,u.trackLast=-1,u.nextTrackLast=-1,u.trackEnd=Number.MAX_VALUE,u.timeScale=1,u.alpha=1,u.interruptAlpha=1,u.mixTime=0,u.mixDuration=null==r?0:this.data.getMix(r.animation,t),u},t.prototype.disposeNext=function(n){for(var t=n.next;null!=t;)this.queue.dispose(t),t=t.next;n.next=null},t.prototype._animationsChanged=function(){var i,r,t;for(this.animationsChanged=!1,this.propertyIDs.clear(),i=0,r=this.tracks.length;i<r;i++)if(null!=(t=this.tracks[i])){for(;null!=t.mixingFrom;)t=t.mixingFrom;do null!=t.mixingFrom&&t.mixBlend==n.MixBlend.add||this.computeHold(t),t=t.mixingTo;while(null!=t)}for(this.propertyIDs.clear(),i=this.tracks.length-1;i>=0;i--)for(t=this.tracks[i];null!=t;)this.computeNotLast(t),t=t.mixingFrom},t.prototype.computeHold=function(i){var f=i.mixingTo,l=i.animation.timelines,s=i.animation.timelines.length,e=n.Utils.setArraySize(i.timelineMode,s),a,c,r,o,h,u;if(i.timelineHoldMix.length=0,a=n.Utils.setArraySize(i.timelineHoldMix,s),c=this.propertyIDs,null!=f&&f.holdPrevious)for(r=0;r<s;r++)c.add(l[r].getPropertyId()),e[r]=t.HOLD;else n:for(r=0;r<s;r++)if(o=l[r],h=o.getPropertyId(),c.add(h))if(null==f||o instanceof n.AttachmentTimeline||o instanceof n.DrawOrderTimeline||o instanceof n.EventTimeline||!f.animation.hasTimeline(h))e[r]=t.FIRST;else{for(u=f.mixingTo;null!=u;u=u.mixingTo)if(!u.animation.hasTimeline(h)){if(i.mixDuration>0){e[r]=t.HOLD_MIX;a[r]=u;continue n}break}e[r]=t.HOLD}else e[r]=t.SUBSEQUENT},t.prototype.computeNotLast=function(i){for(var f,u=i.animation.timelines,e=i.animation.timelines.length,o=i.timelineMode,s=this.propertyIDs,r=0;r<e;r++)u[r]instanceof n.AttachmentTimeline&&(f=u[r],s.add(f.slotIndex)||(o[r]|=t.NOT_LAST))},t.prototype.getCurrent=function(n){return n>=this.tracks.length?null:this.tracks[n]},t.prototype.addListener=function(n){if(null==n)throw new Error("listener cannot be null.");this.listeners.push(n)},t.prototype.removeListener=function(n){var t=this.listeners.indexOf(n);t>=0&&this.listeners.splice(t,1)},t.prototype.clearListeners=function(){this.listeners.length=0},t.prototype.clearListenerNotifications=function(){this.queue.clear()},t.emptyAnimation=new n.Animation("<empty>",[],0),t.SUBSEQUENT=0,t.FIRST=1,t.HOLD=2,t.HOLD_MIX=3,t.NOT_LAST=4,t}(),i,t,r,u;n.AnimationState=f;i=function(){function t(){this.mixBlend=n.MixBlend.replace;this.timelineMode=[];this.timelineHoldMix=[];this.timelinesRotation=[]}return t.prototype.reset=function(){this.next=null;this.mixingFrom=null;this.mixingTo=null;this.animation=null;this.listener=null;this.timelineMode.length=0;this.timelineHoldMix.length=0;this.timelinesRotation.length=0},t.prototype.getAnimationTime=function(){if(this.loop){var n=this.animationEnd-this.animationStart;return 0==n?this.animationStart:this.trackTime%n+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)},t.prototype.setAnimationLast=function(n){this.animationLast=n;this.nextAnimationLast=n},t.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart},t.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0},t}();n.TrackEntry=i;r=function(){function n(n){this.objects=[];this.drainDisabled=!1;this.animState=n}return n.prototype.start=function(n){this.objects.push(t.start);this.objects.push(n);this.animState.animationsChanged=!0},n.prototype.interrupt=function(n){this.objects.push(t.interrupt);this.objects.push(n)},n.prototype.end=function(n){this.objects.push(t.end);this.objects.push(n);this.animState.animationsChanged=!0},n.prototype.dispose=function(n){this.objects.push(t.dispose);this.objects.push(n)},n.prototype.complete=function(n){this.objects.push(t.complete);this.objects.push(n)},n.prototype.event=function(n,i){this.objects.push(t.event);this.objects.push(n);this.objects.push(i)},n.prototype.drain=function(){var o,n,i,e;if(!this.drainDisabled){this.drainDisabled=!0;for(var f=this.objects,r=this.animState.listeners,u=0;u<f.length;u+=2){o=f[u];n=f[u+1];switch(o){case t.start:for(null!=n.listener&&n.listener.start&&n.listener.start(n),i=0;i<r.length;i++)r[i].start&&r[i].start(n);break;case t.interrupt:for(null!=n.listener&&n.listener.interrupt&&n.listener.interrupt(n),i=0;i<r.length;i++)r[i].interrupt&&r[i].interrupt(n);break;case t.end:for(null!=n.listener&&n.listener.end&&n.listener.end(n),i=0;i<r.length;i++)r[i].end&&r[i].end(n);case t.dispose:for(null!=n.listener&&n.listener.dispose&&n.listener.dispose(n),i=0;i<r.length;i++)r[i].dispose&&r[i].dispose(n);this.animState.trackEntryPool.free(n);break;case t.complete:for(null!=n.listener&&n.listener.complete&&n.listener.complete(n),i=0;i<r.length;i++)r[i].complete&&r[i].complete(n);break;case t.event:for(e=f[2+u++],null!=n.listener&&n.listener.event&&n.listener.event(n,e),i=0;i<r.length;i++)r[i].event&&r[i].event(n,e)}}this.clear();this.drainDisabled=!1}},n.prototype.clear=function(){this.objects.length=0},n}();n.EventQueue=r,function(n){n[n.start=0]="start";n[n.interrupt=1]="interrupt";n[n.end=2]="end";n[n.dispose=3]="dispose";n[n.complete=4]="complete";n[n.event=5]="event"}(t=n.EventType||(n.EventType={}));u=function(){function n(){}return n.prototype.start=function(){},n.prototype.interrupt=function(){},n.prototype.end=function(){},n.prototype.dispose=function(){},n.prototype.complete=function(){},n.prototype.event=function(){},n}();n.AnimationStateAdapter=u}(i||(i={})),function(n){var t=function(){function n(n){if(this.animationToMixTime={},this.defaultMix=0,null==n)throw new Error("skeletonData cannot be null.");this.skeletonData=n}return n.prototype.setMix=function(n,t,i){var u=this.skeletonData.findAnimation(n),r;if(null==u)throw new Error("Animation not found: "+n);if(r=this.skeletonData.findAnimation(t),null==r)throw new Error("Animation not found: "+t);this.setMixWith(u,r,i)},n.prototype.setMixWith=function(n,t,i){if(null==n)throw new Error("from cannot be null.");if(null==t)throw new Error("to cannot be null.");var r=n.name+"."+t.name;this.animationToMixTime[r]=i},n.prototype.getMix=function(n,t){var r=n.name+"."+t.name,i=this.animationToMixTime[r];return void 0===i?this.defaultMix:i},n}();n.AnimationStateData=t}(i||(i={})),function(n){var t=function(){function t(n,t){void 0===t&&(t="");this.assets={};this.errors={};this.toLoad=0;this.loaded=0;this.textureLoader=n;this.pathPrefix=t}return t.downloadText=function(n,t,i){var r=new XMLHttpRequest;r.open("GET",n,!0);r.onload=function(){200==r.status?t(r.responseText):i(r.status,r.responseText)};r.onerror=function(){i(r.status,r.responseText)};r.send()},t.downloadBinary=function(n,t,i){var r=new XMLHttpRequest;r.open("GET",n,!0);r.responseType="arraybuffer";r.onload=function(){200==r.status?t(new Uint8Array(r.response)):i(r.status,r.responseText)};r.onerror=function(){i(r.status,r.responseText)};r.send()},t.prototype.loadBinary=function(n,i,r){var u=this;void 0===i&&(i=null);void 0===r&&(r=null);n=this.pathPrefix+n;this.toLoad++;t.downloadBinary(n,function(t){u.assets[n]=t;i&&i(n,t);u.toLoad--;u.loaded++},function(t,i){u.errors[n]="Couldn't load binary "+n+": status "+status+", "+i;r&&r(n,"Couldn't load binary "+n+": status "+status+", "+i);u.toLoad--;u.loaded++})},t.prototype.loadText=function(n,i,r){var u=this;void 0===i&&(i=null);void 0===r&&(r=null);n=this.pathPrefix+n;this.toLoad++;t.downloadText(n,function(t){u.assets[n]=t;i&&i(n,t);u.toLoad--;u.loaded++},function(t,i){u.errors[n]="Couldn't load text "+n+": status "+status+", "+i;r&&r(n,"Couldn't load text "+n+": status "+status+", "+i);u.toLoad--;u.loaded++})},t.prototype.loadTexture=function(n,t,i){var r=this,u;void 0===t&&(t=null);void 0===i&&(i=null);n=this.pathPrefix+n;this.toLoad++;u=new Image;u.crossOrigin="anonymous";u.onload=function(){var i=r.textureLoader(u);r.assets[n]=i;r.toLoad--;r.loaded++;t&&t(n,u)};u.onerror=function(){r.errors[n]="Couldn't load image "+n;r.toLoad--;r.loaded++;i&&i(n,"Couldn't load image "+n)};u.src=n},t.prototype.loadTextureData=function(n,t,i,r){var u=this,f;void 0===i&&(i=null);void 0===r&&(r=null);n=this.pathPrefix+n;this.toLoad++;f=new Image;f.onload=function(){var t=u.textureLoader(f);u.assets[n]=t;u.toLoad--;u.loaded++;i&&i(n,f)};f.onerror=function(){u.errors[n]="Couldn't load image "+n;u.toLoad--;u.loaded++;r&&r(n,"Couldn't load image "+n)};f.src=t},t.prototype.loadTextureAtlas=function(i,r,u){var f=this,e;void 0===r&&(r=null);void 0===u&&(u=null);e=i.lastIndexOf("/")>=0?i.substring(0,i.lastIndexOf("/")):"";i=this.pathPrefix+i;this.toLoad++;t.downloadText(i,function(t){var o={count:0},s=[],c;try{new n.TextureAtlas(t,function(t){s.push(e+"/"+t);var i=document.createElement("img");return i.width=16,i.height=16,new n.FakeTexture(i)})}catch(h){return h={},c=h,f.errors[i]="Couldn't load texture atlas "+i+": "+c.message,u&&u(i,"Couldn't load texture atlas "+i+": "+c.message),f.toLoad--,void f.loaded++}for(var v=function(h){var c=!1;f.loadTexture(h,function(h){var l,v;if(o.count++,o.count==s.length)if(c)f.errors[i]="Couldn't load texture atlas page "+h+"} of atlas "+i,u&&u(i,"Couldn't load texture atlas page "+h+" of atlas "+i),f.toLoad--,f.loaded++;else try{l=new n.TextureAtlas(t,function(n){return f.get(e+"/"+n)});f.assets[i]=l;r&&r(i,l);f.toLoad--;f.loaded++}catch(a){a={};v=a;f.errors[i]="Couldn't load texture atlas "+i+": "+v.message;u&&u(i,"Couldn't load texture atlas "+i+": "+v.message);f.toLoad--;f.loaded++}},function(n){c=!0;o.count++;o.count==s.length&&(f.errors[i]="Couldn't load texture atlas page "+n+"} of atlas "+i,u&&u(i,"Couldn't load texture atlas page "+n+" of atlas "+i),f.toLoad--,f.loaded++)})},l=0,a=s;l<a.length;l++)v(a[l])},function(n,t){f.errors[i]="Couldn't load texture atlas "+i+": status "+status+", "+t;u&&u(i,"Couldn't load texture atlas "+i+": status "+status+", "+t);f.toLoad--;f.loaded++})},t.prototype.get=function(n){return n=this.pathPrefix+n,this.assets[n]},t.prototype.remove=function(n){n=this.pathPrefix+n;var t=this.assets[n];t.dispose&&t.dispose();this.assets[n]=null},t.prototype.removeAll=function(){var t,n;for(t in this.assets)n=this.assets[t],n.dispose&&n.dispose();this.assets={}},t.prototype.isLoadingComplete=function(){return 0==this.toLoad},t.prototype.getToLoad=function(){return this.toLoad},t.prototype.getLoaded=function(){return this.loaded},t.prototype.dispose=function(){this.removeAll()},t.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},t.prototype.getErrors=function(){return this.errors},t}();n.AssetManager=t}(i||(i={})),function(n){var t=function(){function t(n){this.atlas=n}return t.prototype.newRegionAttachment=function(t,i,r){var u=this.atlas.findRegion(r),f;return null==u?null:(u.renderObject=u,f=new n.RegionAttachment(i),f.setRegion(u),f)},t.prototype.newMeshAttachment=function(t,i,r){var u=this.atlas.findRegion(r),f;return null==u?null:(u.renderObject=u,f=new n.MeshAttachment(i),f.region=u,f)},t.prototype.newBoundingBoxAttachment=function(t,i){return new n.BoundingBoxAttachment(i)},t.prototype.newPathAttachment=function(t,i){return new n.PathAttachment(i)},t.prototype.newPointAttachment=function(t,i){return new n.PointAttachment(i)},t.prototype.newClippingAttachment=function(t,i){return new n.ClippingAttachment(i)},t}();n.AtlasAttachmentLoader=t}(i||(i={})),function(n){(function(n){n[n.Normal=0]="Normal";n[n.Additive=1]="Additive";n[n.Multiply=2]="Multiply";n[n.Screen=3]="Screen"})(n.BlendMode||(n.BlendMode={}))}(i||(i={})),function(n){var t=function(){function t(n,t,i){if(this.children=[],this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.a=0,this.b=0,this.c=0,this.d=0,this.worldY=0,this.worldX=0,this.sorted=!1,this.active=!1,null==n)throw new Error("data cannot be null.");if(null==t)throw new Error("skeleton cannot be null.");this.data=n;this.skeleton=t;this.parent=i;this.setToSetupPose()}return t.prototype.isActive=function(){return this.active},t.prototype.update=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},t.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},t.prototype.updateWorldTransformWith=function(t,i,r,u,f,e,o){var v,nt,ut,ft;if(this.ax=t,this.ay=i,this.arotation=r,this.ascaleX=u,this.ascaleY=f,this.ashearX=e,this.ashearY=o,this.appliedValid=!0,v=this.parent,null==v){var tt=this.skeleton,y=r+90+o,it=tt.scaleX,rt=tt.scaleY;return this.a=n.MathUtils.cosDeg(r+e)*u*it,this.b=n.MathUtils.cosDeg(y)*f*it,this.c=n.MathUtils.sinDeg(r+e)*u*rt,this.d=n.MathUtils.sinDeg(y)*f*rt,this.worldX=t*it+tt.x,void(this.worldY=i*rt+tt.y)}var h=v.a,l=v.b,c=v.c,a=v.d;switch(this.worldX=h*t+l*i+v.worldX,this.worldY=c*t+a*i+v.worldY,this.data.transformMode){case n.TransformMode.Normal:y=r+90+o;var p=n.MathUtils.cosDeg(r+e)*u,w=n.MathUtils.cosDeg(y)*f,b=n.MathUtils.sinDeg(r+e)*u,k=n.MathUtils.sinDeg(y)*f;return this.a=h*p+l*b,this.b=h*w+l*k,this.c=c*p+a*b,void(this.d=c*w+a*k);case n.TransformMode.OnlyTranslation:y=r+90+o;this.a=n.MathUtils.cosDeg(r+e)*u;this.b=n.MathUtils.cosDeg(y)*f;this.c=n.MathUtils.sinDeg(r+e)*u;this.d=n.MathUtils.sinDeg(y)*f;break;case n.TransformMode.NoRotationOrReflection:nt=0;(s=h*h+c*c)>.0001?(l=c*(s=Math.abs(h*a-l*c)/s),a=h*s,nt=Math.atan2(c,h)*n.MathUtils.radDeg):(h=0,c=0,nt=90-Math.atan2(a,l)*n.MathUtils.radDeg);ut=r+e-nt;ft=r+o-nt+90;p=n.MathUtils.cosDeg(ut)*u;w=n.MathUtils.cosDeg(ft)*f;b=n.MathUtils.sinDeg(ut)*u;k=n.MathUtils.sinDeg(ft)*f;this.a=h*p-l*b;this.b=h*w-l*k;this.c=c*p+a*b;this.d=c*w+a*k;break;case n.TransformMode.NoScale:case n.TransformMode.NoScaleOrReflection:var s,et=n.MathUtils.cosDeg(r),ot=n.MathUtils.sinDeg(r),d=(h*et+l*ot)/this.skeleton.scaleX,g=(c*et+a*ot)/this.skeleton.scaleY;(s=Math.sqrt(d*d+g*g))>1e-5&&(s=1/s);d*=s;g*=s;s=Math.sqrt(d*d+g*g);this.data.transformMode==n.TransformMode.NoScale&&h*a-l*c<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(s=-s);var st=Math.PI/2+Math.atan2(g,d),ht=Math.cos(st)*s,ct=Math.sin(st)*s;p=n.MathUtils.cosDeg(e)*u;w=n.MathUtils.cosDeg(90+o)*f;b=n.MathUtils.sinDeg(e)*u;k=n.MathUtils.sinDeg(90+o)*f;this.a=d*p+ht*b;this.b=d*w+ht*k;this.c=g*p+ct*b;this.d=g*w+ct*k}this.a*=this.skeleton.scaleX;this.b*=this.skeleton.scaleX;this.c*=this.skeleton.scaleY;this.d*=this.skeleton.scaleY},t.prototype.setToSetupPose=function(){var n=this.data;this.x=n.x;this.y=n.y;this.rotation=n.rotation;this.scaleX=n.scaleX;this.scaleY=n.scaleY;this.shearX=n.shearX;this.shearY=n.shearY},t.prototype.getWorldRotationX=function(){return Math.atan2(this.c,this.a)*n.MathUtils.radDeg},t.prototype.getWorldRotationY=function(){return Math.atan2(this.d,this.b)*n.MathUtils.radDeg},t.prototype.getWorldScaleX=function(){return Math.sqrt(this.a*this.a+this.c*this.c)},t.prototype.getWorldScaleY=function(){return Math.sqrt(this.b*this.b+this.d*this.d)},t.prototype.updateAppliedTransform=function(){var t,l;if(this.appliedValid=!0,t=this.parent,null==t)return this.ax=this.worldX,this.ay=this.worldY,this.arotation=Math.atan2(this.c,this.a)*n.MathUtils.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*n.MathUtils.radDeg);var o=t.a,s=t.b,h=t.c,c=t.d,i=1/(o*c-s*h),a=this.worldX-t.worldX,v=this.worldY-t.worldY;this.ax=a*c*i-v*s*i;this.ay=v*o*i-a*h*i;var y=i*c,p=i*o,w=i*s,b=i*h,r=y*this.a-w*this.c,u=y*this.b-w*this.d,f=p*this.c-b*this.a,e=p*this.d-b*this.b;(this.ashearX=0,this.ascaleX=Math.sqrt(r*r+f*f),this.ascaleX>.0001)?(l=r*e-u*f,this.ascaleY=l/this.ascaleX,this.ashearY=Math.atan2(r*u+f*e,l)*n.MathUtils.radDeg,this.arotation=Math.atan2(f,r)*n.MathUtils.radDeg):(this.ascaleX=0,this.ascaleY=Math.sqrt(u*u+e*e),this.ashearY=0,this.arotation=90-Math.atan2(e,u)*n.MathUtils.radDeg)},t.prototype.worldToLocal=function(n){var i=this.a,r=this.b,u=this.c,f=this.d,t=1/(i*f-r*u),e=n.x-this.worldX,o=n.y-this.worldY;return n.x=e*f*t-o*r*t,n.y=o*i*t-e*u*t,n},t.prototype.localToWorld=function(n){var t=n.x,i=n.y;return n.x=t*this.a+i*this.b+this.worldX,n.y=t*this.c+i*this.d+this.worldY,n},t.prototype.worldToLocalRotation=function(t){var i=n.MathUtils.sinDeg(t),r=n.MathUtils.cosDeg(t);return Math.atan2(this.a*i-this.c*r,this.d*r-this.b*i)*n.MathUtils.radDeg+this.rotation-this.shearX},t.prototype.localToWorldRotation=function(t){t-=this.rotation-this.shearX;var i=n.MathUtils.sinDeg(t),r=n.MathUtils.cosDeg(t);return Math.atan2(r*this.c+i*this.d,r*this.a+i*this.b)*n.MathUtils.radDeg},t.prototype.rotateWorld=function(t){var u=this.a,f=this.b,e=this.c,o=this.d,i=n.MathUtils.cosDeg(t),r=n.MathUtils.sinDeg(t);this.a=i*u-r*e;this.b=i*f-r*o;this.c=r*u+i*e;this.d=r*f+i*o;this.appliedValid=!1},t}();n.Bone=t}(i||(i={})),function(n){var t;n.BoneData=function(i,r,u){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=t.Normal,this.skinRequired=!1,this.color=new n.Color,i<0)throw new Error("index must be >= 0.");if(null==r)throw new Error("name cannot be null.");this.index=i;this.name=r;this.parent=u},function(n){n[n.Normal=0]="Normal";n[n.OnlyTranslation=1]="OnlyTranslation";n[n.NoRotationOrReflection=2]="NoRotationOrReflection";n[n.NoScale=3]="NoScale";n[n.NoScaleOrReflection=4]="NoScaleOrReflection"}(t=n.TransformMode||(n.TransformMode={}))}(i||(i={})),function(n){n.ConstraintData=function(n,t,i){this.name=n;this.order=t;this.skinRequired=i}}(i||(i={})),function(n){n.Event=function(n,t){if(null==t)throw new Error("data cannot be null.");this.time=n;this.data=t}}(i||(i={})),function(n){n.EventData=function(n){this.name=n}}(i||(i={})),function(n){var t=function(){function t(n,t){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==n)throw new Error("data cannot be null.");if(null==t)throw new Error("skeleton cannot be null.");this.data=n;this.mix=n.mix;this.softness=n.softness;this.bendDirection=n.bendDirection;this.compress=n.compress;this.stretch=n.stretch;this.bones=[];for(var i=0;i<n.bones.length;i++)this.bones.push(t.findBone(n.bones[i].name));this.target=t.findBone(n.target.name)}return t.prototype.isActive=function(){return this.active},t.prototype.apply=function(){this.update()},t.prototype.update=function(){var n=this.target,t=this.bones;switch(t.length){case 1:this.apply1(t[0],n.worldX,n.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(t[0],t[1],n.worldX,n.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}},t.prototype.apply1=function(t,i,r,u,f,e,o){var l,p,c,a,w;t.appliedValid||t.updateAppliedTransform();var s=t.parent,b=1/(s.a*s.d-s.b*s.c),k=i-s.worldX,d=r-s.worldY,v=(k*s.d-d*s.b)*b-t.ax,y=(d*s.a-k*s.c)*b-t.ay,h=Math.atan2(y,v)*n.MathUtils.radDeg-t.ashearX-t.arotation;t.ascaleX<0&&(h+=180);h>180?h-=360:h<-180&&(h+=360);l=t.ascaleX;p=t.ascaleY;(u||f)&&(c=t.data.length*l,a=Math.sqrt(v*v+y*y),(u&&a<c||f&&a>c&&c>.0001)&&(w=(a/c-1)*o+1,l*=w,e&&(p*=w)));t.updateWorldTransformWith(t.ax,t.ay,t.arotation+h*o,l,p,t.ashearX,t.ashearY)},t.prototype.apply2=function(t,i,r,u,f,e,o,s){var k,fi,pt,at,ut,st,hi,ct;if(0!=s){t.appliedValid||t.updateAppliedTransform();i.appliedValid||i.updateAppliedTransform();var gt=t.ax,ni=t.ay,p=t.ascaleX,ci=p,ft=t.ascaleY,lt=i.ascaleX,ti=0,ii=0,et=0;p<0?(p=-p,ti=180,et=-1):(ti=0,et=1);ft<0&&(ft=-ft,et=-et);lt<0?(lt=-lt,ii=180):ii=0;var rt=i.ax,ot=0,ri=0,ui=0,c=t.a,a=t.b,h=t.c,w=t.d,li=Math.abs(p-ft)<=.0001;li?(ri=c*rt+a*(ot=i.ay)+t.worldX,ui=h*rt+w*ot+t.worldY):(ot=0,ri=c*rt+t.worldX,ui=h*rt+t.worldY);k=t.parent;c=k.a;a=k.b;h=k.c;var b,v,yt=1/(c*(w=k.d)-a*h),g=ri-k.worldX,y=ui-k.worldY,ai=(g*w-y*a)*yt-gt,vi=(y*c-g*h)*yt-ni,l=Math.sqrt(ai*ai+vi*vi),d=i.data.length*lt;if(l<.0001)return this.apply1(t,r,u,!1,e,!1,s),void i.updateWorldTransformWith(rt,ot,0,i.ascaleX,i.ascaleY,i.ashearX,i.ashearY);var nt=((g=r-k.worldX)*w-(y=u-k.worldY)*a)*yt-gt,tt=(y*c-g*h)*yt-ni,it=nt*nt+tt*tt;0!=o&&(o*=p*(lt+1)/2,fi=Math.sqrt(it),pt=fi-l-d*p+o,pt>0&&(at=Math.min(1,pt/(2*o))-1,it=(nt-=(at=(pt-o*(1-at*at))/fi)*nt)*nt+(tt-=at*tt)*tt));n:if(li)ut=(it-l*l-(d*=p)*d)/(2*l*d),ut<-1?ut=-1:ut>1&&(ut=1,e&&(ci*=(Math.sqrt(it)/(l+d)-1)*s+1)),v=Math.acos(ut)*f,c=l+d*ut,a=d*Math.sin(v),b=Math.atan2(tt*c-nt*a,nt*c+tt*a);else{var wt=(c=p*d)*c,vt=(a=ft*d)*a,ei=Math.atan2(tt,nt),bt=-2*vt*l,yi=vt-wt;if((w=bt*bt-4*yi*(h=vt*l*l+wt*it-wt*vt))>=0){st=Math.sqrt(w);bt<0&&(st=-st);var pi=(st=-(bt+st)/2)/yi,wi=h/st,ht=Math.abs(pi)<Math.abs(wi)?pi:wi;if(ht*ht<=it){y=Math.sqrt(it-ht*ht)*f;b=ei-Math.atan2(y,ht);v=Math.atan2(y/ft,(ht-l)/p);break n}}var bi=n.MathUtils.PI,kt=l-c,oi=kt*kt,ki=0,di=0,dt=l+c,si=dt*dt,gi=0;(h=-c*l/(wt-vt))>=-1&&h<=1&&(h=Math.acos(h),(w=(g=c*Math.cos(h)+l)*g+(y=a*Math.sin(h))*y)<oi&&(bi=h,oi=w,kt=g,ki=y),w>si&&(di=h,si=w,dt=g,gi=y));it<=(oi+si)/2?(b=ei-Math.atan2(ki*f,kt),v=bi*f):(b=ei-Math.atan2(gi*f,dt),v=di*f)}hi=Math.atan2(ot,rt)*et;ct=t.arotation;(b=(b-hi)*n.MathUtils.radDeg+ti-ct)>180?b-=360:b<-180&&(b+=360);t.updateWorldTransformWith(gt,ni,ct+b*s,ci,t.ascaleY,0,0);ct=i.arotation;(v=((v+hi)*n.MathUtils.radDeg-i.ashearX)*et+ii-ct)>180?v-=360:v<-180&&(v+=360);i.updateWorldTransformWith(rt,ot,ct+v*s,i.ascaleX,i.ascaleY,i.ashearX,i.ashearY)}else i.updateWorldTransform()},t}();n.IkConstraint=t}(i||(i={})),function(n){var t=function(n){function t(t){var i=n.call(this,t,0,!1)||this;return i.bones=[],i.bendDirection=1,i.compress=!1,i.stretch=!1,i.uniform=!1,i.mix=1,i.softness=0,i}return r(t,n),t}(n.ConstraintData);n.IkConstraintData=t}(i||(i={})),function(n){var t=function(){function t(n,t){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=[],this.positions=[],this.world=[],this.curves=[],this.lengths=[],this.segments=[],this.active=!1,null==n)throw new Error("data cannot be null.");if(null==t)throw new Error("skeleton cannot be null.");this.data=n;this.bones=[];for(var i=0,r=n.bones.length;i<r;i++)this.bones.push(t.findBone(n.bones[i].name));this.target=t.findSlot(n.target.name);this.position=n.position;this.spacing=n.spacing;this.rotateMix=n.rotateMix;this.translateMix=n.translateMix}return t.prototype.isActive=function(){return this.active},t.prototype.apply=function(){this.update()},t.prototype.update=function(){var pt=this.target.getAttachment(),e,ht,f,i,b,k,at,vt,yt;if(pt instanceof n.PathAttachment){var v=this.rotateMix,ft=this.translateMix,wt=v>0;if(ft>0||wt){var y=this.data,et=y.spacingMode==n.SpacingMode.Percent,ot=y.rotateMode,st=ot==n.RotateMode.Tangent,l=ot==n.RotateMode.ChainScale,nt=this.bones.length,tt=st?nt:nt+1,bt=this.bones,p=n.Utils.setArraySize(this.spaces,tt),w=null,it=this.spacing;if(l||!et){l&&(w=n.Utils.setArraySize(this.lengths,nt));for(var gt=y.spacingMode==n.SpacingMode.Length,r=0,ni=tt-1;r<ni;)if(e=(i=bt[r]).data.length,e<t.epsilon)l&&(w[r]=0),p[++r]=0;else if(et){if(l){var h=e*i.a,c=e*i.c,ti=Math.sqrt(h*h+c*c);w[r]=ti}p[++r]=it}else h=e*i.a,c=e*i.c,ht=Math.sqrt(h*h+c*c),l&&(w[r]=ht),p[++r]=(gt?e+it:it)*ht/e}else for(r=1;r<tt;r++)p[r]=it;var a=this.computeWorldPositions(pt,tt,st,y.positionMode==n.PositionMode.Percent,et),rt=a[0],ut=a[1],ct=y.offsetRotation,lt=!1;for(0==ct?lt=ot==n.RotateMode.Chain:(lt=!1,ct*=(f=this.target.bone).a*f.d-f.b*f.c>0?n.MathUtils.degRad:-n.MathUtils.degRad),r=0,f=3;r<nt;r++,f+=3){if((i=bt[r]).worldX+=(rt-i.worldX)*ft,i.worldY+=(ut-i.worldY)*ft,b=(h=a[f])-rt,k=(c=a[f+1])-ut,l&&(at=w[r],0!=at&&(vt=(Math.sqrt(b*b+k*k)/at-1)*v+1,i.a*=vt,i.c*=vt)),rt=h,ut=c,wt){var d=i.a,kt=i.b,g=i.c,dt=i.d,u=0,o=0,s=0;(u=st?a[f-1]:0==p[r+1]?a[f+2]:Math.atan2(k,b),u-=Math.atan2(g,d),lt)?(o=Math.cos(u),s=Math.sin(u),yt=i.data.length,rt+=(yt*(o*d-s*g)-b)*v,ut+=(yt*(s*d+o*g)-k)*v):u+=ct;u>n.MathUtils.PI?u-=n.MathUtils.PI2:u<-n.MathUtils.PI&&(u+=n.MathUtils.PI2);u*=v;o=Math.cos(u);s=Math.sin(u);i.a=o*d-s*g;i.b=o*kt-s*dt;i.c=s*d+o*g;i.d=s*kt+o*dt}i.appliedValid=!1}}}},t.prototype.computeWorldPositions=function(i,r,u,f,e){var rt=this.target,bt=this.position,kt=this.spaces,ut=n.Utils.setArraySize(this.positions,3*r+2),o=null,wt=i.closed,v=i.worldVerticesLength,at=v/6,ft=t.NONE,dt,st,l,w,a,s,gt,ui,fi,y,ei,pt;if(!i.constantSpeed){if(dt=i.lengths,st=dt[at-=wt?1:2],f&&(bt*=st),e)for(l=1;l<r;l++)kt[l]*=st;for(o=n.Utils.setArraySize(this.world,8),l=0,w=0,a=0;l<r;l++,w+=3){if(s=bt+=ui=kt[l],wt)(s%=st)<0&&(s+=st),a=0;else{if(s<0){ft!=t.BEFORE&&(ft=t.BEFORE,i.computeWorldVertices(rt,2,4,o,0,2));this.addBeforePosition(s,o,0,ut,w);continue}if(s>st){ft!=t.AFTER&&(ft=t.AFTER,i.computeWorldVertices(rt,v-6,4,o,0,2));this.addAfterPosition(s-st,o,0,ut,w);continue}}for(;;a++)if(gt=dt[a],!(s>gt)){0==a?s/=gt:s=(s-(pt=dt[a-1]))/(gt-pt);break}a!=ft&&(ft=a,wt&&a==at?(i.computeWorldVertices(rt,v-4,4,o,0,2),i.computeWorldVertices(rt,0,4,o,4,2)):i.computeWorldVertices(rt,6*a+2,8,o,0,2));this.addCurvePosition(s,o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],ut,w,u||l>0&&0==ui)}return ut}wt?(v+=2,o=n.Utils.setArraySize(this.world,v),i.computeWorldVertices(rt,2,v-4,o,0,2),i.computeWorldVertices(rt,0,2,o,v-4,2),o[v-2]=o[0],o[v-1]=o[1]):(at--,v-=4,o=n.Utils.setArraySize(this.world,v),i.computeWorldVertices(rt,2,v,o,0,2));for(var oi=n.Utils.setArraySize(this.curves,at),p=0,d=o[0],g=o[1],nt=0,tt=0,ht=0,ct=0,ni=0,ti=0,ii=0,ri=0,et=0,ot=0,b=0,k=0,h=0,c=0,lt=(l=0,2);l<at;l++,lt+=6)nt=o[lt],tt=o[lt+1],ht=o[lt+2],ct=o[lt+3],b=2*(ii=.1875*(d-2*nt+ht))+(et=.09375*(3*(nt-ht)-d+(ni=o[lt+4]))),k=2*(ri=.1875*(g-2*tt+ct))+(ot=.09375*(3*(tt-ct)-g+(ti=o[lt+5]))),h=.75*(nt-d)+ii+.16666667*et,c=.75*(tt-g)+ri+.16666667*ot,p+=Math.sqrt(h*h+c*c),h+=b,c+=k,b+=et,k+=ot,p+=Math.sqrt(h*h+c*c),h+=b,c+=k,p+=Math.sqrt(h*h+c*c),h+=b+et,c+=k+ot,p+=Math.sqrt(h*h+c*c),oi[l]=p,d=ni,g=ti;if(bt*=f?p:p/i.lengths[at-1],e)for(l=1;l<r;l++)kt[l]*=p;for(var vt=this.segments,it=0,yt=(l=0,w=0,a=0,0);l<r;l++,w+=3){if(s=bt+=ui=kt[l],wt)(s%=p)<0&&(s+=p),a=0;else{if(s<0){this.addBeforePosition(s,o,0,ut,w);continue}if(s>p){this.addAfterPosition(s-p,o,v-4,ut,w);continue}}for(;;a++)if(fi=oi[a],!(s>fi)){0==a?s/=fi:s=(s-(pt=oi[a-1]))/(fi-pt);break}if(a!=ft){for(ft=a,y=6*a,d=o[y],g=o[y+1],nt=o[y+2],tt=o[y+3],ht=o[y+4],ct=o[y+5],b=2*(ii=.03*(d-2*nt+ht))+(et=.006*(3*(nt-ht)-d+(ni=o[y+6]))),k=2*(ri=.03*(g-2*tt+ct))+(ot=.006*(3*(tt-ct)-g+(ti=o[y+7]))),h=.3*(nt-d)+ii+.16666667*et,c=.3*(tt-g)+ri+.16666667*ot,it=Math.sqrt(h*h+c*c),vt[0]=it,y=1;y<8;y++)h+=b,c+=k,b+=et,k+=ot,it+=Math.sqrt(h*h+c*c),vt[y]=it;h+=b;c+=k;it+=Math.sqrt(h*h+c*c);vt[8]=it;h+=b+et;c+=k+ot;it+=Math.sqrt(h*h+c*c);vt[9]=it;yt=0}for(s*=it;;yt++)if(ei=vt[yt],!(s>ei)){0==yt?s/=ei:s=yt+(s-(pt=vt[yt-1]))/(ei-pt);break}this.addCurvePosition(.1*s,d,g,nt,tt,ht,ct,ni,ti,ut,w,u||l>0&&0==ui)}return ut},t.prototype.addBeforePosition=function(n,t,i,r,u){var e=t[i],o=t[i+1],s=t[i+2]-e,h=t[i+3]-o,f=Math.atan2(h,s);r[u]=e+n*Math.cos(f);r[u+1]=o+n*Math.sin(f);r[u+2]=f},t.prototype.addAfterPosition=function(n,t,i,r,u){var e=t[i+2],o=t[i+3],s=e-t[i],h=o-t[i+1],f=Math.atan2(h,s);r[u]=e+n*Math.cos(f);r[u+1]=o+n*Math.sin(f);r[u+2]=f},t.prototype.addCurvePosition=function(n,t,i,r,u,f,e,o,s,h,c,l){if(0==n||isNaN(n))return h[c]=t,h[c+1]=i,void(h[c+2]=Math.atan2(u-i,r-t));var v=n*n,w=v*n,a=1-n,y=a*a,b=y*a,p=a*n,k=3*p,d=a*k,g=k*n,nt=t*b+r*d+f*g+o*w,tt=i*b+u*d+e*g+s*w;h[c]=nt;h[c+1]=tt;l&&(h[c+2]=n<.001?Math.atan2(u-i,r-t):Math.atan2(tt-(i*y+u*p*2+e*v),nt-(t*y+r*p*2+f*v)))},t.NONE=-1,t.BEFORE=-2,t.AFTER=-3,t.epsilon=1e-5,t}();n.PathConstraint=t}(i||(i={})),function(n){var t=function(n){function t(t){var i=n.call(this,t,0,!1)||this;return i.bones=[],i}return r(t,n),t}(n.ConstraintData);n.PathConstraintData=t,function(n){n[n.Fixed=0]="Fixed";n[n.Percent=1]="Percent"}(n.PositionMode||(n.PositionMode={})),function(n){n[n.Length=0]="Length";n[n.Fixed=1]="Fixed";n[n.Percent=2]="Percent"}(n.SpacingMode||(n.SpacingMode={})),function(n){n[n.Tangent=0]="Tangent";n[n.Chain=1]="Chain";n[n.ChainScale=2]="ChainScale"}(n.RotateMode||(n.RotateMode={}))}(i||(i={})),function(n){var t=function(){function n(n){this.toLoad=[];this.assets={};this.clientId=n}return n.prototype.loaded=function(){var n=0;for(var t in this.assets)n++;return n},n}(),i=function(){function n(n){void 0===n&&(n="");this.clientAssets={};this.queuedAssets={};this.rawAssets={};this.errors={};this.pathPrefix=n}return n.prototype.queueAsset=function(n,i,r){var u=this.clientAssets[n];return null==u&&(u=new t(n),this.clientAssets[n]=u),null!==i&&(u.textureLoader=i),u.toLoad.push(r),this.queuedAssets[r]!==r&&(this.queuedAssets[r]=r,!0)},n.prototype.loadText=function(n,t){var r=this,i;(t=this.pathPrefix+t,this.queueAsset(n,null,t))&&(i=new XMLHttpRequest,i.onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&(i.status>=200&&i.status<300?r.rawAssets[t]=i.responseText:r.errors[t]="Couldn't load text "+t+": status "+i.status+", "+i.responseText)},i.open("GET",t,!0),i.send())},n.prototype.loadJson=function(n,t){var r=this,i;(t=this.pathPrefix+t,this.queueAsset(n,null,t))&&(i=new XMLHttpRequest,i.onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&(i.status>=200&&i.status<300?r.rawAssets[t]=JSON.parse(i.responseText):r.errors[t]="Couldn't load text "+t+": status "+i.status+", "+i.responseText)},i.open("GET",t,!0),i.send())},n.prototype.loadTexture=function(n,t,i){var u=this,r;(i=this.pathPrefix+i,this.queueAsset(n,t,i))&&(r=new Image,r.src=i,r.crossOrigin="anonymous",r.onload=function(){u.rawAssets[i]=r},r.onerror=function(){u.errors[i]="Couldn't load image "+i})},n.prototype.get=function(n,t){t=this.pathPrefix+t;var i=this.clientAssets[n];return null==i||i.assets[t]},n.prototype.updateClientAssets=function(n){for(var r,t,i=0;i<n.toLoad.length;i++)if(r=n.toLoad[i],null==n.assets[r]){if(t=this.rawAssets[r],null==t)continue;n.assets[r]=t instanceof HTMLImageElement?n.textureLoader(t):t}},n.prototype.isLoadingComplete=function(n){var t=this.clientAssets[n];return null==t||(this.updateClientAssets(t),t.toLoad.length==t.loaded())},n.prototype.dispose=function(){},n.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},n.prototype.getErrors=function(){return this.errors},n}();n.SharedAssetManager=i}(i||(i={})),function(n){var t=function(){function t(t){var i,u,r,f,e,o,s,h,c;if(this._updateCache=[],this.updateCacheReset=[],this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==t)throw new Error("data cannot be null.");for(this.data=t,this.bones=[],i=0;i<t.bones.length;i++)u=t.bones[i],r=void 0,null==u.parent?r=new n.Bone(u,this,null):(f=this.bones[u.parent.index],r=new n.Bone(u,this,f),f.children.push(r)),this.bones.push(r);for(this.slots=[],this.drawOrder=[],i=0;i<t.slots.length;i++)e=t.slots[i],o=(r=this.bones[e.boneData.index],new n.Slot(e,r)),this.slots.push(o),this.drawOrder.push(o);for(this.ikConstraints=[],i=0;i<t.ikConstraints.length;i++)s=t.ikConstraints[i],this.ikConstraints.push(new n.IkConstraint(s,this));for(this.transformConstraints=[],i=0;i<t.transformConstraints.length;i++)h=t.transformConstraints[i],this.transformConstraints.push(new n.TransformConstraint(h,this));for(this.pathConstraints=[],i=0;i<t.pathConstraints.length;i++)c=t.pathConstraints[i],this.pathConstraints.push(new n.PathConstraint(c,this));this.color=new n.Color(1,1,1,1);this.updateCache()}return t.prototype.updateCache=function(){var e,i,t,r;this._updateCache.length=0;this.updateCacheReset.length=0;for(var f=this.bones,n=0,u=f.length;n<u;n++)(i=f[n]).sorted=i.data.skinRequired,i.active=!i.sorted;if(null!=this.skin)for(e=this.skin.bones,n=0,u=this.skin.bones.length;n<u;n++){i=this.bones[e[n].index];do i.sorted=!1,i.active=!0,i=i.parent;while(null!=i)}var o=this.ikConstraints,s=this.transformConstraints,h=this.pathConstraints,c=o.length,l=s.length,a=h.length,v=c+l+a;n:for(n=0;n<v;n++){for(t=0;t<c;t++)if((r=o[t]).data.order==n){this.sortIkConstraint(r);continue n}for(t=0;t<l;t++)if((r=s[t]).data.order==n){this.sortTransformConstraint(r);continue n}for(t=0;t<a;t++)if((r=h[t]).data.order==n){this.sortPathConstraint(r);continue n}}for(n=0,u=f.length;n<u;n++)this.sortBone(f[n])},t.prototype.sortIkConstraint=function(t){var f,i,r,u;(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&n.Utils.contains(this.skin.constraints,t.data,!0)),t.active)&&(f=t.target,this.sortBone(f),i=t.bones,r=i[0],(this.sortBone(r),i.length>1)&&(u=i[i.length-1],this._updateCache.indexOf(u)>-1||this.updateCacheReset.push(u)),this._updateCache.push(t),this.sortReset(r.children),i[i.length-1].sorted=!0)},t.prototype.sortPathConstraint=function(t){var i,h,s,r,f;if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||null!=this.skin&&n.Utils.contains(this.skin.constraints,t.data,!0)),t.active){var e=t.target,o=e.data.index,u=e.bone;for(null!=this.skin&&this.sortPathConstraintAttachment(this.skin,o,u),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,o,u),i=0,h=this.data.skins.length;i<h;i++)this.sortPathConstraintAttachment(this.data.skins[i],o,u);for(s=e.getAttachment(),s instanceof n.PathAttachment&&this.sortPathConstraintAttachmentWith(s,u),r=t.bones,f=r.length,i=0;i<f;i++)this.sortBone(r[i]);for(this._updateCache.push(t),i=0;i<f;i++)this.sortReset(r[i].children);for(i=0;i<f;i++)r[i].sorted=!0}},t.prototype.sortTransformConstraint=function(t){var u,f,i,e,r;if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&n.Utils.contains(this.skin.constraints,t.data,!0)),t.active){if(this.sortBone(t.target),u=t.bones,f=u.length,t.data.local)for(i=0;i<f;i++)e=u[i],this.sortBone(e.parent),this._updateCache.indexOf(e)>-1||this.updateCacheReset.push(e);else for(i=0;i<f;i++)this.sortBone(u[i]);for(this._updateCache.push(t),r=0;r<f;r++)this.sortReset(u[r].children);for(r=0;r<f;r++)u[r].sorted=!0}},t.prototype.sortPathConstraintAttachment=function(n,t,i){var r=n.attachments[t],u;if(r)for(u in r)this.sortPathConstraintAttachmentWith(r[u],i)},t.prototype.sortPathConstraintAttachmentWith=function(t,i){var u,f,r,e,o,s;if(t instanceof n.PathAttachment)if(u=t.bones,null==u)this.sortBone(i);else for(f=this.bones,r=0;r<u.length;)for(e=u[r++],o=r+e;r<o;r++)s=u[r],this.sortBone(f[s])},t.prototype.sortBone=function(n){if(!n.sorted){var t=n.parent;null!=t&&this.sortBone(t);n.sorted=!0;this._updateCache.push(n)}},t.prototype.sortReset=function(n){for(var t,i=0,r=n.length;i<r;i++)t=n[i],t.active&&(t.sorted&&this.sortReset(t.children),t.sorted=!1)},t.prototype.updateWorldTransform=function(){for(var n,r,u=this.updateCacheReset,t=0,i=u.length;t<i;t++)n=u[t],n.ax=n.x,n.ay=n.y,n.arotation=n.rotation,n.ascaleX=n.scaleX,n.ascaleY=n.scaleY,n.ashearX=n.shearX,n.ashearY=n.shearY,n.appliedValid=!0;for(r=this._updateCache,t=0,i=r.length;t<i;t++)r[t].update()},t.prototype.setToSetupPose=function(){this.setBonesToSetupPose();this.setSlotsToSetupPose()},t.prototype.setBonesToSetupPose=function(){for(var u,f,i,e,n,o=this.bones,t=0,r=o.length;t<r;t++)o[t].setToSetupPose();for(u=this.ikConstraints,t=0,r=u.length;t<r;t++)(n=u[t]).mix=n.data.mix,n.softness=n.data.softness,n.bendDirection=n.data.bendDirection,n.compress=n.data.compress,n.stretch=n.data.stretch;for(f=this.transformConstraints,t=0,r=f.length;t<r;t++)i=(n=f[t]).data,n.rotateMix=i.rotateMix,n.translateMix=i.translateMix,n.scaleMix=i.scaleMix,n.shearMix=i.shearMix;for(e=this.pathConstraints,t=0,r=e.length;t<r;t++)i=(n=e[t]).data,n.position=i.position,n.spacing=i.spacing,n.rotateMix=i.rotateMix,n.translateMix=i.translateMix},t.prototype.setSlotsToSetupPose=function(){var t=this.slots,i,r;for(n.Utils.arrayCopy(t,0,this.drawOrder,0,t.length),i=0,r=t.length;i<r;i++)t[i].setToSetupPose()},t.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0]},t.prototype.findBone=function(n){var i;if(null==n)throw new Error("boneName cannot be null.");for(var r=this.bones,t=0,u=r.length;t<u;t++)if(i=r[t],i.data.name==n)return i;return null},t.prototype.findBoneIndex=function(n){if(null==n)throw new Error("boneName cannot be null.");for(var i=this.bones,t=0,r=i.length;t<r;t++)if(i[t].data.name==n)return t;return-1},t.prototype.findSlot=function(n){var i;if(null==n)throw new Error("slotName cannot be null.");for(var r=this.slots,t=0,u=r.length;t<u;t++)if(i=r[t],i.data.name==n)return i;return null},t.prototype.findSlotIndex=function(n){if(null==n)throw new Error("slotName cannot be null.");for(var i=this.slots,t=0,r=i.length;t<r;t++)if(i[t].data.name==n)return t;return-1},t.prototype.setSkinByName=function(n){var t=this.data.findSkin(n);if(null==t)throw new Error("Skin not found: "+n);this.setSkin(t)},t.prototype.setSkin=function(n){var i,r,u;if(n!=this.skin){if(null!=n)if(null!=this.skin)n.attachAll(this,this.skin);else for(var f=this.slots,t=0,e=f.length;t<e;t++)i=f[t],r=i.data.attachmentName,null!=r&&(u=n.getAttachment(t,r),null!=u&&i.setAttachment(u));this.skin=n;this.updateCache()}},t.prototype.getAttachmentByName=function(n,t){return this.getAttachment(this.data.findSlotIndex(n),t)},t.prototype.getAttachment=function(n,t){if(null==t)throw new Error("attachmentName cannot be null.");if(null!=this.skin){var i=this.skin.getAttachment(n,t);if(null!=i)return i}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(n,t):null},t.prototype.setAttachment=function(n,t){var r,u;if(null==n)throw new Error("slotName cannot be null.");for(var f=this.slots,i=0,e=f.length;i<e;i++)if(r=f[i],r.data.name==n){if(u=null,null!=t&&null==(u=this.getAttachment(i,t)))throw new Error("Attachment not found: "+t+", for slot: "+n);return void r.setAttachment(u)}throw new Error("Slot not found: "+n);},t.prototype.findIkConstraint=function(n){var i;if(null==n)throw new Error("constraintName cannot be null.");for(var r=this.ikConstraints,t=0,u=r.length;t<u;t++)if(i=r[t],i.data.name==n)return i;return null},t.prototype.findTransformConstraint=function(n){var i;if(null==n)throw new Error("constraintName cannot be null.");for(var r=this.transformConstraints,t=0,u=r.length;t<u;t++)if(i=r[t],i.data.name==n)return i;return null},t.prototype.findPathConstraint=function(n){var i;if(null==n)throw new Error("constraintName cannot be null.");for(var r=this.pathConstraints,t=0,u=r.length;t<u;t++)if(i=r[t],i.data.name==n)return i;return null},t.prototype.getBounds=function(t,i,r){var f,y,o,k,p,w;if(void 0===r&&(r=new Array(2)),null==t)throw new Error("offset cannot be null.");if(null==i)throw new Error("size cannot be null.");for(var b=this.drawOrder,s=Number.POSITIVE_INFINITY,h=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY,v=0,d=b.length;v<d;v++)if(f=b[v],f.bone.active){var e=0,u=null,c=f.getAttachment();if(c instanceof n.RegionAttachment?(e=8,u=n.Utils.setArraySize(r,e,0),c.computeWorldVertices(f.bone,u,0,2)):c instanceof n.MeshAttachment&&(y=c,e=y.worldVerticesLength,u=n.Utils.setArraySize(r,e,0),y.computeWorldVertices(f,0,e,u,0,2)),null!=u)for(o=0,k=u.length;o<k;o+=2)p=u[o],w=u[o+1],s=Math.min(s,p),h=Math.min(h,w),l=Math.max(l,p),a=Math.max(a,w)}t.set(s,h);i.set(l-s,a-h)},t.prototype.update=function(n){this.time+=n},t}();n.Skeleton=t}(i||(i={})),function(n){var t=function(){function t(n){this.scale=1;this.linkedMeshes=[];this.attachmentLoader=n}return t.prototype.readSkeletonData=function(r){var a=this.scale,e=new n.SkeletonData,u,v,s,o,k,d,w,c,l,y,h,b,p;for(e.name="",u=new i(r),e.hash=u.readString(),e.version=u.readString(),e.x=u.readFloat(),e.y=u.readFloat(),e.width=u.readFloat(),e.height=u.readFloat(),v=u.readBoolean(),v&&(e.fps=u.readFloat(),e.imagesPath=u.readString(),e.audioPath=u.readString()),s=0,s=u.readInt(!0),o=0;o<s;o++)u.strings.push(u.readString());for(s=u.readInt(!0),o=0;o<s;o++)k=u.readString(),d=0==o?null:e.bones[u.readInt(!0)],(f=new n.BoneData(o,k,d)).rotation=u.readFloat(),f.x=u.readFloat()*a,f.y=u.readFloat()*a,f.scaleX=u.readFloat(),f.scaleY=u.readFloat(),f.shearX=u.readFloat(),f.shearY=u.readFloat(),f.length=u.readFloat()*a,f.transformMode=t.TransformModeValues[u.readInt(!0)],f.skinRequired=u.readBoolean(),v&&n.Color.rgba8888ToColor(f.color,u.readInt32()),e.bones.push(f);for(s=u.readInt(!0),o=0;o<s;o++){var g=u.readString(),nt=e.bones[u.readInt(!0)],f=new n.SlotData(o,g,nt);n.Color.rgba8888ToColor(f.color,u.readInt32());w=u.readInt32();-1!=w&&n.Color.rgb888ToColor(f.darkColor=new n.Color,w);f.attachmentName=u.readStringRef();f.blendMode=t.BlendModeValues[u.readInt(!0)];e.slots.push(f)}for(s=u.readInt(!0),o=0,c=void 0;o<s;o++){for((f=new n.IkConstraintData(u.readString())).order=u.readInt(!0),f.skinRequired=u.readBoolean(),c=u.readInt(!0),l=0;l<c;l++)f.bones.push(e.bones[u.readInt(!0)]);f.target=e.bones[u.readInt(!0)];f.mix=u.readFloat();f.softness=u.readFloat()*a;f.bendDirection=u.readByte();f.compress=u.readBoolean();f.stretch=u.readBoolean();f.uniform=u.readBoolean();e.ikConstraints.push(f)}for(s=u.readInt(!0),o=0,c=void 0;o<s;o++){for((f=new n.TransformConstraintData(u.readString())).order=u.readInt(!0),f.skinRequired=u.readBoolean(),c=u.readInt(!0),l=0;l<c;l++)f.bones.push(e.bones[u.readInt(!0)]);f.target=e.bones[u.readInt(!0)];f.local=u.readBoolean();f.relative=u.readBoolean();f.offsetRotation=u.readFloat();f.offsetX=u.readFloat()*a;f.offsetY=u.readFloat()*a;f.offsetScaleX=u.readFloat();f.offsetScaleY=u.readFloat();f.offsetShearY=u.readFloat();f.rotateMix=u.readFloat();f.translateMix=u.readFloat();f.scaleMix=u.readFloat();f.shearMix=u.readFloat();e.transformConstraints.push(f)}for(s=u.readInt(!0),o=0,c=void 0;o<s;o++){for((f=new n.PathConstraintData(u.readString())).order=u.readInt(!0),f.skinRequired=u.readBoolean(),c=u.readInt(!0),l=0;l<c;l++)f.bones.push(e.bones[u.readInt(!0)]);f.target=e.slots[u.readInt(!0)];f.positionMode=t.PositionModeValues[u.readInt(!0)];f.spacingMode=t.SpacingModeValues[u.readInt(!0)];f.rotateMode=t.RotateModeValues[u.readInt(!0)];f.offsetRotation=u.readFloat();f.position=u.readFloat();f.positionMode==n.PositionMode.Fixed&&(f.position*=a);f.spacing=u.readFloat();f.spacingMode!=n.SpacingMode.Length&&f.spacingMode!=n.SpacingMode.Fixed||(f.spacing*=a);f.rotateMix=u.readFloat();f.translateMix=u.readFloat();e.pathConstraints.push(f)}for(y=this.readSkin(u,e,!0,v),null!=y&&(e.defaultSkin=y,e.skins.push(y)),o=e.skins.length,n.Utils.setArraySize(e.skins,s=o+u.readInt(!0));o<s;o++)e.skins[o]=this.readSkin(u,e,!1,v);for(s=this.linkedMeshes.length,o=0;o<s;o++){if(h=this.linkedMeshes[o],b=null==h.skin?e.defaultSkin:e.findSkin(h.skin),null==b)throw new Error("Skin not found: "+h.skin);if(p=b.getAttachment(h.slotIndex,h.parent),null==p)throw new Error("Parent mesh not found: "+h.parent);h.mesh.deformAttachment=h.inheritDeform?p:h.mesh;h.mesh.setParentMesh(p);h.mesh.updateUVs()}for(this.linkedMeshes.length=0,s=u.readInt(!0),o=0;o<s;o++)(f=new n.EventData(u.readStringRef())).intValue=u.readInt(!1),f.floatValue=u.readFloat(),f.stringValue=u.readString(),f.audioPath=u.readString(),null!=f.audioPath&&(f.volume=u.readFloat(),f.balance=u.readFloat()),e.events.push(f);for(s=u.readInt(!0),o=0;o<s;o++)e.animations.push(this.readAnimation(u,u.readString(),e));return e},t.prototype.readSkin=function(t,i,r,u){var e=null,s=0,f,o,h,c;if(r){if(0==(s=t.readInt(!0)))return null;e=new n.Skin("default")}else{for((e=new n.Skin(t.readStringRef())).bones.length=t.readInt(!0),f=0,o=e.bones.length;f<o;f++)e.bones[f]=i.bones[t.readInt(!0)];for(f=0,o=t.readInt(!0);f<o;f++)e.constraints.push(i.ikConstraints[t.readInt(!0)]);for(f=0,o=t.readInt(!0);f<o;f++)e.constraints.push(i.transformConstraints[t.readInt(!0)]);for(f=0,o=t.readInt(!0);f<o;f++)e.constraints.push(i.pathConstraints[t.readInt(!0)]);s=t.readInt(!0)}for(f=0;f<s;f++)for(var l=t.readInt(!0),a=0,v=t.readInt(!0);a<v;a++)h=t.readStringRef(),c=this.readAttachment(t,i,e,l,h,u),null!=c&&e.setAttachment(l,h,c);return e},t.prototype.readAttachment=function(i,u,f,e,o,s){var p=this.scale,y=i.readStringRef(),et,a,g,st,b;null==y&&(y=o);et=i.readByte();switch(t.AttachmentTypeValues[et]){case n.AttachmentType.Region:var h=i.readStringRef(),tt=i.readFloat(),it=i.readFloat(),rt=i.readFloat(),ht=i.readFloat(),ct=i.readFloat(),k=i.readFloat(),d=i.readFloat(),l=i.readInt32();return null==h&&(h=y),a=this.attachmentLoader.newRegionAttachment(f,y,h),null==a?null:(a.path=h,a.x=it*p,a.y=rt*p,a.scaleX=ht,a.scaleY=ct,a.rotation=tt,a.width=k*p,a.height=d*p,n.Color.rgba8888ToColor(a.color,l),a.updateOffset(),a);case n.AttachmentType.BoundingBox:var v=i.readInt(!0),w=this.readVertices(i,v),nt=(l=s?i.readInt32():0,this.attachmentLoader.newBoundingBoxAttachment(f,y));return null==nt?null:(nt.worldVerticesLength=v<<1,nt.vertices=w.vertices,nt.bones=w.bones,s&&n.Color.rgba8888ToColor(nt.color,l),nt);case n.AttachmentType.Mesh:h=i.readStringRef();l=i.readInt32();v=i.readInt(!0);var lt=this.readFloatArray(i,v<<1,1),at=this.readShortArray(i),vt=(w=this.readVertices(i,v),i.readInt(!0)),ot=null;return k=0,d=0,s&&(ot=this.readShortArray(i),k=i.readFloat(),d=i.readFloat()),null==h&&(h=y),null==(c=this.attachmentLoader.newMeshAttachment(f,y,h))?null:(c.path=h,n.Color.rgba8888ToColor(c.color,l),c.bones=w.bones,c.vertices=w.vertices,c.worldVerticesLength=v<<1,c.triangles=at,c.regionUVs=lt,c.updateUVs(),c.hullLength=vt<<1,s&&(c.edges=ot,c.width=k*p,c.height=d*p),c);case n.AttachmentType.LinkedMesh:h=i.readStringRef();l=i.readInt32();var c,yt=i.readStringRef(),pt=i.readStringRef(),wt=i.readBoolean();return k=0,d=0,s&&(k=i.readFloat(),d=i.readFloat()),null==h&&(h=y),null==(c=this.attachmentLoader.newMeshAttachment(f,y,h))?null:(c.path=h,n.Color.rgba8888ToColor(c.color,l),s&&(c.width=k*p,c.height=d*p),this.linkedMeshes.push(new r(c,yt,e,pt,wt)),c);case n.AttachmentType.Path:for(var bt=i.readBoolean(),kt=i.readBoolean(),ut=(v=i.readInt(!0),w=this.readVertices(i,v),n.Utils.newArray(v/3,0)),ft=0,dt=ut.length;ft<dt;ft++)ut[ft]=i.readFloat()*p;return l=s?i.readInt32():0,null==(h=this.attachmentLoader.newPathAttachment(f,y))?null:(h.closed=bt,h.constantSpeed=kt,h.worldVerticesLength=v<<1,h.vertices=w.vertices,h.bones=w.bones,h.lengths=ut,s&&n.Color.rgba8888ToColor(h.color,l),h);case n.AttachmentType.Point:return tt=i.readFloat(),it=i.readFloat(),rt=i.readFloat(),l=s?i.readInt32():0,g=this.attachmentLoader.newPointAttachment(f,y),null==g?null:(g.x=it*p,g.y=rt*p,g.rotation=tt,s&&n.Color.rgba8888ToColor(g.color,l),g);case n.AttachmentType.Clipping:return st=i.readInt(!0),b=(v=i.readInt(!0),w=this.readVertices(i,v),l=s?i.readInt32():0,this.attachmentLoader.newClippingAttachment(f,y)),null==b?null:(b.endSlot=u.slots[st],b.worldVerticesLength=v<<1,b.vertices=w.vertices,b.bones=w.bones,s&&n.Color.rgba8888ToColor(b.color,l),b)}return null},t.prototype.readVertices=function(t,i){var l=i<<1,r=new u,e=this.scale,s,h;if(!t.readBoolean())return r.vertices=this.readFloatArray(t,l,e),r;for(var f=[],o=[],c=0;c<i;c++)for(s=t.readInt(!0),o.push(s),h=0;h<s;h++)o.push(t.readInt(!0)),f.push(t.readFloat()*e),f.push(t.readFloat()*e),f.push(t.readFloat());return r.vertices=n.Utils.toFloatArray(f),r.bones=o,r},t.prototype.readFloatArray=function(n,t,i){var u=new Array(t),r;if(1==i)for(r=0;r<t;r++)u[r]=n.readFloat();else for(r=0;r<t;r++)u[r]=n.readFloat()*i;return u},t.prototype.readShortArray=function(n){for(var i=n.readInt(!0),r=new Array(i),t=0;t<i;t++)r[t]=n.readShort();return r},t.prototype.readAnimation=function(i,r,u){for(var w,o,e,p,vt,f,k,d,ct,ni,yt,ti,g,et,at,a,ri,ot,rt,bt,ut,st,gt,nt,l=[],it=this.scale,s=0,y=new n.Color,ht=new n.Color,h=0,v=i.readInt(!0);h<v;h++)for(var b=i.readInt(!0),c=0,tt=i.readInt(!0);c<tt;c++){w=i.readByte();o=i.readInt(!0);switch(w){case t.SLOT_ATTACHMENT:for((f=new n.AttachmentTimeline(o)).slotIndex=b,e=0;e<o;e++)f.setFrame(e,i.readFloat(),i.readStringRef());l.push(f);s=Math.max(s,f.frames[o-1]);break;case t.SLOT_COLOR:for((f=new n.ColorTimeline(o)).slotIndex=b,e=0;e<o;e++)p=i.readFloat(),n.Color.rgba8888ToColor(y,i.readInt32()),f.setFrame(e,p,y.r,y.g,y.b,y.a),e<o-1&&this.readCurve(i,e,f);l.push(f);s=Math.max(s,f.frames[(o-1)*n.ColorTimeline.ENTRIES]);break;case t.SLOT_TWO_COLOR:for((f=new n.TwoColorTimeline(o)).slotIndex=b,e=0;e<o;e++)p=i.readFloat(),n.Color.rgba8888ToColor(y,i.readInt32()),n.Color.rgb888ToColor(ht,i.readInt32()),f.setFrame(e,p,y.r,y.g,y.b,y.a,ht.r,ht.g,ht.b),e<o-1&&this.readCurve(i,e,f);l.push(f);s=Math.max(s,f.frames[(o-1)*n.TwoColorTimeline.ENTRIES])}}for(h=0,v=i.readInt(!0);h<v;h++)for(vt=i.readInt(!0),c=0,tt=i.readInt(!0);c<tt;c++)switch(w=i.readByte(),o=i.readInt(!0),w){case t.BONE_ROTATE:for((f=new n.RotateTimeline(o)).boneIndex=vt,e=0;e<o;e++)f.setFrame(e,i.readFloat(),i.readFloat()),e<o-1&&this.readCurve(i,e,f);l.push(f);s=Math.max(s,f.frames[(o-1)*n.RotateTimeline.ENTRIES]);break;case t.BONE_TRANSLATE:case t.BONE_SCALE:case t.BONE_SHEAR:for(f=void 0,k=1,w==t.BONE_SCALE?f=new n.ScaleTimeline(o):w==t.BONE_SHEAR?f=new n.ShearTimeline(o):(f=new n.TranslateTimeline(o),k=it),f.boneIndex=vt,e=0;e<o;e++)f.setFrame(e,i.readFloat(),i.readFloat()*k,i.readFloat()*k),e<o-1&&this.readCurve(i,e,f);l.push(f);s=Math.max(s,f.frames[(o-1)*n.TranslateTimeline.ENTRIES])}for(h=0,v=i.readInt(!0);h<v;h++){for(d=i.readInt(!0),o=i.readInt(!0),(f=new n.IkConstraintTimeline(o)).ikConstraintIndex=d,e=0;e<o;e++)f.setFrame(e,i.readFloat(),i.readFloat(),i.readFloat()*it,i.readByte(),i.readBoolean(),i.readBoolean()),e<o-1&&this.readCurve(i,e,f);l.push(f);s=Math.max(s,f.frames[(o-1)*n.IkConstraintTimeline.ENTRIES])}for(h=0,v=i.readInt(!0);h<v;h++){for(d=i.readInt(!0),o=i.readInt(!0),(f=new n.TransformConstraintTimeline(o)).transformConstraintIndex=d,e=0;e<o;e++)f.setFrame(e,i.readFloat(),i.readFloat(),i.readFloat(),i.readFloat(),i.readFloat()),e<o-1&&this.readCurve(i,e,f);l.push(f);s=Math.max(s,f.frames[(o-1)*n.TransformConstraintTimeline.ENTRIES])}for(h=0,v=i.readInt(!0);h<v;h++)for(d=i.readInt(!0),ct=u.pathConstraints[d],c=0,tt=i.readInt(!0);c<tt;c++)switch(w=i.readByte(),o=i.readInt(!0),w){case t.PATH_POSITION:case t.PATH_SPACING:for(f=void 0,k=1,w==t.PATH_SPACING?(f=new n.PathConstraintSpacingTimeline(o),ct.spacingMode!=n.SpacingMode.Length&&ct.spacingMode!=n.SpacingMode.Fixed||(k=it)):(f=new n.PathConstraintPositionTimeline(o),ct.positionMode==n.PositionMode.Fixed&&(k=it)),f.pathConstraintIndex=d,e=0;e<o;e++)f.setFrame(e,i.readFloat(),i.readFloat()*k),e<o-1&&this.readCurve(i,e,f);l.push(f);s=Math.max(s,f.frames[(o-1)*n.PathConstraintPositionTimeline.ENTRIES]);break;case t.PATH_MIX:for((f=new n.PathConstraintMixTimeline(o)).pathConstraintIndex=d,e=0;e<o;e++)f.setFrame(e,i.readFloat(),i.readFloat(),i.readFloat()),e<o-1&&this.readCurve(i,e,f);l.push(f);s=Math.max(s,f.frames[(o-1)*n.PathConstraintMixTimeline.ENTRIES])}for(h=0,v=i.readInt(!0);h<v;h++)for(ni=u.skins[i.readInt(!0)],c=0,tt=i.readInt(!0);c<tt;c++)for(b=i.readInt(!0),yt=0,ti=i.readInt(!0);yt<ti;yt++){var pt=ni.getAttachment(b,i.readStringRef()),wt=null!=pt.bones,lt=pt.vertices,ii=wt?lt.length/3*2:lt.length;for(o=i.readInt(!0),(f=new n.DeformTimeline(o)).slotIndex=b,f.attachment=pt,e=0;e<o;e++){if(p=i.readFloat(),g=void 0,et=i.readInt(!0),0==et)g=wt?n.Utils.newFloatArray(ii):lt;else{if(g=n.Utils.newFloatArray(ii),at=i.readInt(!0),et+=at,1==it)for(a=at;a<et;a++)g[a]=i.readFloat();else for(a=at;a<et;a++)g[a]=i.readFloat()*it;if(!wt)for(a=0,ri=g.length;a<ri;a++)g[a]+=lt[a]}f.setFrame(e,p,g);e<o-1&&this.readCurve(i,e,f)}l.push(f);s=Math.max(s,f.frames[o-1])}if(ot=i.readInt(!0),ot>0){for(f=new n.DrawOrderTimeline(ot),rt=u.slots.length,h=0;h<ot;h++){for(p=i.readFloat(),bt=i.readInt(!0),ut=n.Utils.newArray(rt,0),c=rt-1;c>=0;c--)ut[c]=-1;var kt=n.Utils.newArray(rt-bt,0),ft=0,dt=0;for(c=0;c<bt;c++){for(b=i.readInt(!0);ft!=b;)kt[dt++]=ft++;ut[ft+i.readInt(!0)]=ft++}for(;ft<rt;)kt[dt++]=ft++;for(c=rt-1;c>=0;c--)-1==ut[c]&&(ut[c]=kt[--dt]);f.setFrame(h,p,ut)}l.push(f);s=Math.max(s,f.frames[ot-1])}if(st=i.readInt(!0),st>0){for(f=new n.EventTimeline(st),h=0;h<st;h++)p=i.readFloat(),gt=u.events[i.readInt(!0)],nt=new n.Event(p,gt),nt.intValue=i.readInt(!1),nt.floatValue=i.readFloat(),nt.stringValue=i.readBoolean()?i.readString():gt.stringValue,null!=nt.data.audioPath&&(nt.volume=i.readFloat(),nt.balance=i.readFloat()),f.setFrame(h,nt);l.push(f);s=Math.max(s,f.frames[st-1])}return new n.Animation(r,l,s)},t.prototype.readCurve=function(n,i,r){switch(n.readByte()){case t.CURVE_STEPPED:r.setStepped(i);break;case t.CURVE_BEZIER:this.setCurve(r,i,n.readFloat(),n.readFloat(),n.readFloat(),n.readFloat())}},t.prototype.setCurve=function(n,t,i,r,u,f){n.setCurve(t,i,r,u,f)},t.AttachmentTypeValues=[0,1,2,3,4,5,6],t.TransformModeValues=[n.TransformMode.Normal,n.TransformMode.OnlyTranslation,n.TransformMode.NoRotationOrReflection,n.TransformMode.NoScale,n.TransformMode.NoScaleOrReflection],t.PositionModeValues=[n.PositionMode.Fixed,n.PositionMode.Percent],t.SpacingModeValues=[n.SpacingMode.Length,n.SpacingMode.Fixed,n.SpacingMode.Percent],t.RotateModeValues=[n.RotateMode.Tangent,n.RotateMode.Chain,n.RotateMode.ChainScale],t.BlendModeValues=[n.BlendMode.Normal,n.BlendMode.Additive,n.BlendMode.Multiply,n.BlendMode.Screen],t.BONE_ROTATE=0,t.BONE_TRANSLATE=1,t.BONE_SCALE=2,t.BONE_SHEAR=3,t.SLOT_ATTACHMENT=0,t.SLOT_COLOR=1,t.SLOT_TWO_COLOR=2,t.PATH_POSITION=0,t.PATH_SPACING=1,t.PATH_MIX=2,t.CURVE_LINEAR=0,t.CURVE_STEPPED=1,t.CURVE_BEZIER=2,t}();n.SkeletonBinary=t;var i=function(){function n(n,t,i,r){void 0===t&&(t=[]);void 0===i&&(i=0);void 0===r&&(r=new DataView(n.buffer));this.strings=t;this.index=i;this.buffer=r}return n.prototype.readByte=function(){return this.buffer.getInt8(this.index++)},n.prototype.readShort=function(){var n=this.buffer.getInt16(this.index);return this.index+=2,n},n.prototype.readInt32=function(){var n=this.buffer.getInt32(this.index);return this.index+=4,n},n.prototype.readInt=function(n){var t=this.readByte(),i=127&t;return 0!=(128&t)&&(i|=(127&(t=this.readByte()))<<7,0!=(128&t)&&(i|=(127&(t=this.readByte()))<<14,0!=(128&t)&&(i|=(127&(t=this.readByte()))<<21,0!=(128&t)&&(i|=(127&(t=this.readByte()))<<28)))),n?i:i>>>1^-(1&i)},n.prototype.readStringRef=function(){var n=this.readInt(!0);return 0==n?null:this.strings[n-1]},n.prototype.readString=function(){var r=this.readInt(!0),n,t,i;switch(r){case 0:return null;case 1:return""}for(r--,n="",t=0;t<r;){i=this.readByte();switch(i>>4){case 12:case 13:n+=String.fromCharCode((31&i)<<6|63&this.readByte());t+=2;break;case 14:n+=String.fromCharCode((15&i)<<12|(63&this.readByte())<<6|63&this.readByte());t+=3;break;default:n+=String.fromCharCode(i);t++}}return n},n.prototype.readFloat=function(){var n=this.buffer.getFloat32(this.index);return this.index+=4,n},n.prototype.readBoolean=function(){return 0!=this.readByte()},n}(),r=function(n,t,i,r,u){this.mesh=n;this.skin=t;this.slotIndex=i;this.parent=r;this.inheritDeform=u},u=function(n,t){void 0===n&&(n=null);void 0===t&&(t=null);this.bones=n;this.vertices=t}}(i||(i={})),function(n){var t=function(){function t(){this.minX=0;this.minY=0;this.maxX=0;this.maxY=0;this.boundingBoxes=[];this.polygons=[];this.polygonPool=new n.Pool(function(){return n.Utils.newFloatArray(16)})}return t.prototype.update=function(t,i){var f,e,s,r,u;if(null==t)throw new Error("skeleton cannot be null.");var h=this.boundingBoxes,o=this.polygons,c=this.polygonPool,l=t.slots,a=l.length;for(h.length=0,c.freeAll(o),o.length=0,f=0;f<a;f++)e=l[f],e.bone.active&&(s=e.getAttachment(),s instanceof n.BoundingBoxAttachment&&(r=s,h.push(r),u=c.obtain(),u.length!=r.worldVerticesLength&&(u=n.Utils.newFloatArray(r.worldVerticesLength)),o.push(u),r.computeWorldVertices(e,0,r.worldVerticesLength,u,0,2)));i?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)},t.prototype.aabbCompute=function(){for(var e,o,t=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY,s=this.polygons,f=0,l=s.length;f<l;f++)for(var h=s[f],c=h,n=0,a=h.length;n<a;n+=2)e=c[n],o=c[n+1],t=Math.min(t,e),i=Math.min(i,o),r=Math.max(r,e),u=Math.max(u,o);this.minX=t;this.minY=i;this.maxX=r;this.maxY=u},t.prototype.aabbContainsPoint=function(n,t){return n>=this.minX&&n<=this.maxX&&t>=this.minY&&t<=this.maxY},t.prototype.aabbIntersectsSegment=function(n,t,i,r){var u=this.minX,f=this.minY,e=this.maxX,o=this.maxY,s,h,c;return n<=u&&i<=u||t<=f&&r<=f||n>=e&&i>=e||t>=o&&r>=o?!1:(s=(r-t)/(i-n),h=s*(u-n)+t,h>f&&h<o)?!0:(h=s*(e-n)+t)>f&&h<o?!0:(c=(f-t)/s+n,c>u&&c<e||(c=(o-t)/s+n)>u&&c<e)},t.prototype.aabbIntersectsSkeleton=function(n){return this.minX<n.maxX&&this.maxX>n.minX&&this.minY<n.maxY&&this.maxY>n.minY},t.prototype.containsPoint=function(n,t){for(var r=this.polygons,i=0,u=r.length;i<u;i++)if(this.containsPointPolygon(r[i],n,t))return this.boundingBoxes[i];return null},t.prototype.containsPointPolygon=function(n,t,i){for(var u,e,h,f=n,c=n.length,o=c-2,s=!1,r=0;r<c;r+=2)u=f[r+1],e=f[o+1],(u<i&&e>=i||e<i&&u>=i)&&(h=f[r],h+(i-u)/(e-u)*(f[o]-h)<t&&(s=!s)),o=r;return s},t.prototype.intersectsSegment=function(n,t,i,r){for(var f=this.polygons,u=0,e=f.length;u<e;u++)if(this.intersectsSegmentPolygon(f[u],n,t,i,r))return this.boundingBoxes[u];return null},t.prototype.intersectsSegmentPolygon=function(n,t,i,r,u){for(var f,l=n,v=n.length,y=t-r,p=i-u,w=t*u-i*r,o=l[v-2],s=l[v-1],a=0;a<v;a+=2){var h=l[a],c=l[a+1],b=o*c-s*h,k=o-h,d=s-c,g=y*d-p*k,e=(w*k-y*b)/g;if((e>=o&&e<=h||e>=h&&e<=o)&&(e>=t&&e<=r||e>=r&&e<=t)&&(f=(w*d-p*b)/g,(f>=s&&f<=c||f>=c&&f<=s)&&(f>=i&&f<=u||f>=u&&f<=i)))return!0;o=h;s=c}return!1},t.prototype.getPolygon=function(n){if(null==n)throw new Error("boundingBox cannot be null.");var t=this.boundingBoxes.indexOf(n);return-1==t?null:this.polygons[t]},t.prototype.getWidth=function(){return this.maxX-this.minX},t.prototype.getHeight=function(){return this.maxY-this.minY},t}();n.SkeletonBounds=t}(i||(i={})),function(n){var t=function(){function t(){this.triangulator=new n.Triangulator;this.clippingPolygon=[];this.clipOutput=[];this.clippedVertices=[];this.clippedTriangles=[];this.scratch=[]}return t.prototype.clipStart=function(i,r){var e,h,f,u;if(null!=this.clipAttachment)return 0;this.clipAttachment=r;e=r.worldVerticesLength;h=n.Utils.setArraySize(this.clippingPolygon,e);r.computeWorldVertices(i,0,e,h,0,2);f=this.clippingPolygon;t.makeClockwise(f);for(var o=this.clippingPolygons=this.triangulator.decompose(f,this.triangulator.triangulate(f)),s=0,c=o.length;s<c;s++)u=o[s],t.makeClockwise(u),u.push(u[0]),u.push(u[1]);return o.length},t.prototype.clipEndWithSlot=function(n){null!=this.clipAttachment&&this.clipAttachment.endSlot==n.data&&this.clipEnd()},t.prototype.clipEnd=function(){null!=this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)},t.prototype.isClipping=function(){return null!=this.clipAttachment},t.prototype.clipTriangles=function(t,i,r,u,f,e,o,s,h,c,l,a){var ii=this.clipOutput,ft=this.clippedVertices,rt=this.clippedTriangles,ai=this.clippingPolygons,vi=this.clippingPolygons.length,ct=s?12:8,w=0,g,ri,v,ht,dt,gt,d;c=c||0;l=l||0;a=a||0;ft.length=0;rt.length=0;n:for(g=c,ri=c+u;g<ri;g+=3){var nt=r[g]*h,tt=nt+l,b=nt+a,lt=t[tt],et=t[tt+1],at=f[b],vt=f[b+1];b=(nt=r[g+1]*h)+a;var ot=t[tt=nt+l],st=t[tt+1],yt=f[b],pt=f[b+1];b=(nt=r[g+2]*h)+a;for(var it=t[tt=nt+l],k=t[tt+1],wt=f[b],bt=f[b+1],kt=0;kt<vi;kt++){if(v=ft.length,!this.clip(lt,et,ot,st,it,k,ai[kt],ii)){(y=n.Utils.setArraySize(ft,v+3*ct))[v]=lt;y[v+1]=et;y[v+2]=e.r;y[v+3]=e.g;y[v+4]=e.b;y[v+5]=e.a;s?(y[v+6]=at,y[v+7]=vt,y[v+8]=o.r,y[v+9]=o.g,y[v+10]=o.b,y[v+11]=o.a,y[v+12]=ot,y[v+13]=st,y[v+14]=e.r,y[v+15]=e.g,y[v+16]=e.b,y[v+17]=e.a,y[v+18]=yt,y[v+19]=pt,y[v+20]=o.r,y[v+21]=o.g,y[v+22]=o.b,y[v+23]=o.a,y[v+24]=it,y[v+25]=k,y[v+26]=e.r,y[v+27]=e.g,y[v+28]=e.b,y[v+29]=e.a,y[v+30]=wt,y[v+31]=bt,y[v+32]=o.r,y[v+33]=o.g,y[v+34]=o.b,y[v+35]=o.a):(y[v+6]=at,y[v+7]=vt,y[v+8]=ot,y[v+9]=st,y[v+10]=e.r,y[v+11]=e.g,y[v+12]=e.b,y[v+13]=e.a,y[v+14]=yt,y[v+15]=pt,y[v+16]=it,y[v+17]=k,y[v+18]=e.r,y[v+19]=e.g,y[v+20]=e.b,y[v+21]=e.a,y[v+22]=wt,y[v+23]=bt);v=rt.length;(d=n.Utils.setArraySize(rt,v+3))[v]=w;d[v+1]=w+1;d[v+2]=w+2;w+=3;continue n}if(ht=ii.length,0!=ht){for(var ui=st-k,fi=it-ot,ei=lt-it,yi=k-et,oi=1/(ui*ei+fi*(et-k)),ut=ht>>1,si=this.clipOutput,y=n.Utils.setArraySize(ft,v+ut*ct),p=0;p<ht;p+=2){dt=si[p];gt=si[p+1];y[v]=dt;y[v+1]=gt;y[v+2]=e.r;y[v+3]=e.g;y[v+4]=e.b;y[v+5]=e.a;var hi=dt-it,ci=gt-k,ni=(ui*hi+fi*ci)*oi,ti=(yi*hi+ei*ci)*oi,li=1-ni-ti;y[v+6]=at*ni+yt*ti+wt*li;y[v+7]=vt*ni+pt*ti+bt*li;s&&(y[v+8]=o.r,y[v+9]=o.g,y[v+10]=o.b,y[v+11]=o.a);v+=ct}for(v=rt.length,d=n.Utils.setArraySize(rt,v+3*(ut-2)),ut--,p=1;p<ut;p++)d[v]=w,d[v+1]=w+p,d[v+2]=w+p+1,v+=3;w+=ut+1}}}},t.prototype.clip=function(n,t,i,r,u,f,e,o){var y=o,ft=!1,s=null,w,b,rt,ut,ht,ct;e.length%4>=2?(s=o,o=this.scratch):s=this.scratch;s.length=0;s.push(n);s.push(t);s.push(i);s.push(r);s.push(u);s.push(f);s.push(n);s.push(t);o.length=0;for(var tt=e,lt=e.length-4,h=0;;h+=2){for(var c=tt[h],l=tt[h+1],a=tt[h+2],v=tt[h+3],et=c-a,ot=l-v,it=s,at=s.length-2,vt=o.length,p=0;p<at;p+=2){var k=it[p],d=it[p+1],g=it[p+2],nt=it[p+3],st=et*(nt-v)-ot*(g-a)>0;if(et*(d-v)-ot*(k-a)>0){if(st){o.push(g);o.push(nt);continue}w=(rt=nt-d)*(a-c)-(ut=g-k)*(v-l);Math.abs(w)>1e-6?(b=(ut*(l-d)-rt*(c-k))/w,o.push(c+(a-c)*b),o.push(l+(v-l)*b)):(o.push(c),o.push(l))}else st&&(w=(rt=nt-d)*(a-c)-(ut=g-k)*(v-l),Math.abs(w)>1e-6?(b=(ut*(l-d)-rt*(c-k))/w,o.push(c+(a-c)*b),o.push(l+(v-l)*b)):(o.push(c),o.push(l)),o.push(g),o.push(nt));ft=!0}if(vt==o.length)return y.length=0,!0;if(o.push(o[0]),o.push(o[1]),h==lt)break;ht=o;(o=s).length=0;s=ht}if(y!=o)for(y.length=0,h=0,ct=o.length-2;h<ct;h++)y[h]=o[h];else y.length=y.length-2;return ft},t.makeClockwise=function(n){for(var c,t=n,r=n.length,e=t[r-2]*t[1]-t[0]*t[r-1],o=0,s=0,h=0,i=0,f=r-3;i<f;i+=2)o=t[i],s=t[i+1],h=t[i+2],e+=o*t[i+3]-h*s;if(!(e<0))for(i=0,c=r-2,f=r>>1;i<f;i+=2){var l=t[i],a=t[i+1],u=c-i;t[i]=t[u];t[i+1]=t[u+1];t[u]=l;t[u+1]=a}},t}();n.SkeletonClipping=t}(i||(i={})),function(n){var t=function(){function n(){this.bones=[];this.slots=[];this.skins=[];this.events=[];this.animations=[];this.ikConstraints=[];this.transformConstraints=[];this.pathConstraints=[];this.fps=0}return n.prototype.findBone=function(n){var i;if(null==n)throw new Error("boneName cannot be null.");for(var r=this.bones,t=0,u=r.length;t<u;t++)if(i=r[t],i.name==n)return i;return null},n.prototype.findBoneIndex=function(n){if(null==n)throw new Error("boneName cannot be null.");for(var i=this.bones,t=0,r=i.length;t<r;t++)if(i[t].name==n)return t;return-1},n.prototype.findSlot=function(n){var i;if(null==n)throw new Error("slotName cannot be null.");for(var r=this.slots,t=0,u=r.length;t<u;t++)if(i=r[t],i.name==n)return i;return null},n.prototype.findSlotIndex=function(n){if(null==n)throw new Error("slotName cannot be null.");for(var i=this.slots,t=0,r=i.length;t<r;t++)if(i[t].name==n)return t;return-1},n.prototype.findSkin=function(n){var i;if(null==n)throw new Error("skinName cannot be null.");for(var r=this.skins,t=0,u=r.length;t<u;t++)if(i=r[t],i.name==n)return i;return null},n.prototype.findEvent=function(n){var i;if(null==n)throw new Error("eventDataName cannot be null.");for(var r=this.events,t=0,u=r.length;t<u;t++)if(i=r[t],i.name==n)return i;return null},n.prototype.findAnimation=function(n){var i;if(null==n)throw new Error("animationName cannot be null.");for(var r=this.animations,t=0,u=r.length;t<u;t++)if(i=r[t],i.name==n)return i;return null},n.prototype.findIkConstraint=function(n){var i;if(null==n)throw new Error("constraintName cannot be null.");for(var r=this.ikConstraints,t=0,u=r.length;t<u;t++)if(i=r[t],i.name==n)return i;return null},n.prototype.findTransformConstraint=function(n){var i;if(null==n)throw new Error("constraintName cannot be null.");for(var r=this.transformConstraints,t=0,u=r.length;t<u;t++)if(i=r[t],i.name==n)return i;return null},n.prototype.findPathConstraint=function(n){var i;if(null==n)throw new Error("constraintName cannot be null.");for(var r=this.pathConstraints,t=0,u=r.length;t<u;t++)if(i=r[t],i.name==n)return i;return null},n.prototype.findPathConstraintIndex=function(n){if(null==n)throw new Error("pathConstraintName cannot be null.");for(var i=this.pathConstraints,t=0,r=i.length;t<r;t++)if(i[t].name==n)return t;return-1},n}();n.SkeletonData=t}(i||(i={})),function(n){var i=function(){function i(n){this.scale=1;this.linkedMeshes=[];this.attachmentLoader=n}return i.prototype.readSkeletonData=function(t){var k=this.scale,f=new n.SkeletonData,o="string"==typeof t?JSON.parse(t):t,p=o.skeleton,e,r,ot,st,u,l,w,g,ht,ct,s,a,h,d,tt,it,rt,b,ut,lt,wt,v,ft,at,nt,vt,bt;if(null!=p&&(f.hash=p.hash,f.version=p.spine,f.x=p.x,f.y=p.y,f.width=p.width,f.height=p.height,f.fps=p.fps,f.imagesPath=p.images),o.bones)for(e=0;e<o.bones.length;e++){var c=o.bones[e],yt=null,et=this.getValue(c,"parent",null);if(null!=et&&null==(yt=f.findBone(et)))throw new Error("Parent bone not found: "+et);(r=new n.BoneData(f.bones.length,c.name,yt)).length=this.getValue(c,"length",0)*k;r.x=this.getValue(c,"x",0)*k;r.y=this.getValue(c,"y",0)*k;r.rotation=this.getValue(c,"rotation",0);r.scaleX=this.getValue(c,"scaleX",1);r.scaleY=this.getValue(c,"scaleY",1);r.shearX=this.getValue(c,"shearX",0);r.shearY=this.getValue(c,"shearY",0);r.transformMode=i.transformModeFromString(this.getValue(c,"transform","normal"));r.skinRequired=this.getValue(c,"skin",!1);f.bones.push(r)}if(o.slots)for(e=0;e<o.slots.length;e++){var it=(b=o.slots[e]).name,y=b.bone,pt=f.findBone(y);if(null==pt)throw new Error("Slot bone not found: "+y);r=new n.SlotData(f.slots.length,it,pt);ot=this.getValue(b,"color",null);null!=ot&&r.color.setFromString(ot);st=this.getValue(b,"dark",null);null!=st&&(r.darkColor=new n.Color(1,1,1,1),r.darkColor.setFromString(st));r.attachmentName=this.getValue(b,"attachment",null);r.blendMode=i.blendModeFromString(this.getValue(b,"blend","normal"));f.slots.push(r)}if(o.ik)for(e=0;e<o.ik.length;e++){for(u=o.ik[e],(r=new n.IkConstraintData(u.name)).order=this.getValue(u,"order",0),r.skinRequired=this.getValue(u,"skin",!1),l=0;l<u.bones.length;l++){if(y=u.bones[l],null==(d=f.findBone(y)))throw new Error("IK bone not found: "+y);r.bones.push(d)}if(w=u.target,r.target=f.findBone(w),null==r.target)throw new Error("IK target bone not found: "+w);r.mix=this.getValue(u,"mix",1);r.softness=this.getValue(u,"softness",0)*k;r.bendDirection=this.getValue(u,"bendPositive",!0)?1:-1;r.compress=this.getValue(u,"compress",!1);r.stretch=this.getValue(u,"stretch",!1);r.uniform=this.getValue(u,"uniform",!1);f.ikConstraints.push(r)}if(o.transform)for(e=0;e<o.transform.length;e++){for(u=o.transform[e],(r=new n.TransformConstraintData(u.name)).order=this.getValue(u,"order",0),r.skinRequired=this.getValue(u,"skin",!1),l=0;l<u.bones.length;l++){if(y=u.bones[l],null==(d=f.findBone(y)))throw new Error("Transform constraint bone not found: "+y);r.bones.push(d)}if(w=u.target,r.target=f.findBone(w),null==r.target)throw new Error("Transform constraint target bone not found: "+w);r.local=this.getValue(u,"local",!1);r.relative=this.getValue(u,"relative",!1);r.offsetRotation=this.getValue(u,"rotation",0);r.offsetX=this.getValue(u,"x",0)*k;r.offsetY=this.getValue(u,"y",0)*k;r.offsetScaleX=this.getValue(u,"scaleX",0);r.offsetScaleY=this.getValue(u,"scaleY",0);r.offsetShearY=this.getValue(u,"shearY",0);r.rotateMix=this.getValue(u,"rotateMix",1);r.translateMix=this.getValue(u,"translateMix",1);r.scaleMix=this.getValue(u,"scaleMix",1);r.shearMix=this.getValue(u,"shearMix",1);f.transformConstraints.push(r)}if(o.path)for(e=0;e<o.path.length;e++){for(u=o.path[e],(r=new n.PathConstraintData(u.name)).order=this.getValue(u,"order",0),r.skinRequired=this.getValue(u,"skin",!1),l=0;l<u.bones.length;l++){if(y=u.bones[l],null==(d=f.findBone(y)))throw new Error("Transform constraint bone not found: "+y);r.bones.push(d)}if(w=u.target,r.target=f.findSlot(w),null==r.target)throw new Error("Path target slot not found: "+w);r.positionMode=i.positionModeFromString(this.getValue(u,"positionMode","percent"));r.spacingMode=i.spacingModeFromString(this.getValue(u,"spacingMode","length"));r.rotateMode=i.rotateModeFromString(this.getValue(u,"rotateMode","tangent"));r.offsetRotation=this.getValue(u,"rotation",0);r.position=this.getValue(u,"position",0);r.positionMode==n.PositionMode.Fixed&&(r.position*=k);r.spacing=this.getValue(u,"spacing",0);r.spacingMode!=n.SpacingMode.Length&&r.spacingMode!=n.SpacingMode.Fixed||(r.spacing*=k);r.rotateMix=this.getValue(u,"rotateMix",1);r.translateMix=this.getValue(u,"translateMix",1);f.pathConstraints.push(r)}if(o.skins){if(g=o.skins,!(g instanceof Array)){ht=[];for(ct in g)ht.push({name:ct,attachments:g[ct]});g=ht}for(e=0;e<g.length;e++){if(s=g[e],a=new n.Skin(s.name),s.bones)for(h=0;h<s.bones.length;h++){if(null==(d=f.findBone(s.bones[h])))throw new Error("Skin bone not found: "+s.bones[e]);a.bones.push(d)}if(s.ik)for(h=0;h<s.ik.length;h++){if(null==(tt=f.findIkConstraint(s.ik[h])))throw new Error("Skin IK constraint not found: "+s.ik[e]);a.constraints.push(tt)}if(s.transform)for(h=0;h<s.transform.length;h++){if(null==(tt=f.findTransformConstraint(s.transform[h])))throw new Error("Skin transform constraint not found: "+s.transform[e]);a.constraints.push(tt)}if(s.path)for(h=0;h<s.path.length;h++){if(null==(tt=f.findPathConstraint(s.path[h])))throw new Error("Skin path constraint not found: "+s.path[e]);a.constraints.push(tt)}for(it in s.attachments){if(rt=f.findSlot(it),null==rt)throw new Error("Slot not found: "+it);b=s.attachments[it];for(ut in b)lt=this.readAttachment(b[ut],a,rt.index,ut,f),null!=lt&&a.setAttachment(rt.index,ut,lt)}f.skins.push(a);"default"==a.name&&(f.defaultSkin=a)}}for(e=0,wt=this.linkedMeshes.length;e<wt;e++){if(v=this.linkedMeshes[e],null==(a=null==v.skin?f.defaultSkin:f.findSkin(v.skin)))throw new Error("Skin not found: "+v.skin);if(ft=a.getAttachment(v.slotIndex,v.parent),null==ft)throw new Error("Parent mesh not found: "+v.parent);v.mesh.deformAttachment=v.inheritDeform?ft:v.mesh;v.mesh.setParentMesh(ft);v.mesh.updateUVs()}if(this.linkedMeshes.length=0,o.events)for(at in o.events)nt=o.events[at],(r=new n.EventData(at)).intValue=this.getValue(nt,"int",0),r.floatValue=this.getValue(nt,"float",0),r.stringValue=this.getValue(nt,"string",""),r.audioPath=this.getValue(nt,"audio",null),null!=r.audioPath&&(r.volume=this.getValue(nt,"volume",1),r.balance=this.getValue(nt,"balance",0)),f.events.push(r);if(o.animations)for(vt in o.animations)bt=o.animations[vt],this.readAnimation(bt,vt,f);return f},i.prototype.readAttachment=function(i,r,u,f,e){var l=this.scale,s,h,y,o,k,d,p,g,w,a,v,c,b,nt;switch(f=this.getValue(i,"name",f),this.getValue(i,"type","region")){case"region":return s=this.getValue(i,"path",f),h=this.attachmentLoader.newRegionAttachment(r,f,s),null==h?null:(h.path=s,h.x=this.getValue(i,"x",0)*l,h.y=this.getValue(i,"y",0)*l,h.scaleX=this.getValue(i,"scaleX",1),h.scaleY=this.getValue(i,"scaleY",1),h.rotation=this.getValue(i,"rotation",0),h.width=i.width*l,h.height=i.height*l,null!=(c=this.getValue(i,"color",null))&&h.color.setFromString(c),h.updateOffset(),h);case"boundingbox":return y=this.attachmentLoader.newBoundingBoxAttachment(r,f),null==y?null:(this.readVertices(i,y,i.vertexCount<<1),null!=(c=this.getValue(i,"color",null))&&y.color.setFromString(c),y);case"mesh":case"linkedmesh":return(s=this.getValue(i,"path",f),o=this.attachmentLoader.newMeshAttachment(r,f,s),null==o)?null:(o.path=s,null!=(c=this.getValue(i,"color",null))&&o.color.setFromString(c),o.width=this.getValue(i,"width",0)*l,o.height=this.getValue(i,"height",0)*l,k=this.getValue(i,"parent",null),null!=k)?(this.linkedMeshes.push(new t(o,this.getValue(i,"skin",null),u,k,this.getValue(i,"deform",!0))),o):(d=i.uvs,this.readVertices(i,o,d.length),o.triangles=i.triangles,o.regionUVs=d,o.updateUVs(),o.edges=this.getValue(i,"edges",null),o.hullLength=2*this.getValue(i,"hull",0),o);case"path":if(null==(s=this.attachmentLoader.newPathAttachment(r,f)))return null;for(s.closed=this.getValue(i,"closed",!1),s.constantSpeed=this.getValue(i,"constantSpeed",!0),p=i.vertexCount,this.readVertices(i,s,p<<1),g=n.Utils.newArray(p/3,0),w=0;w<i.lengths.length;w++)g[w]=i.lengths[w]*l;return s.lengths=g,null!=(c=this.getValue(i,"color",null))&&s.color.setFromString(c),s;case"point":return a=this.attachmentLoader.newPointAttachment(r,f),null==a?null:(a.x=this.getValue(i,"x",0)*l,a.y=this.getValue(i,"y",0)*l,a.rotation=this.getValue(i,"rotation",0),null!=(c=this.getValue(i,"color",null))&&a.color.setFromString(c),a);case"clipping":if(v=this.attachmentLoader.newClippingAttachment(r,f),null==v)return null;if(b=this.getValue(i,"end",null),null!=b){if(nt=e.findSlot(b),null==nt)throw new Error("Clipping end slot not found: "+b);v.endSlot=nt}return p=i.vertexCount,this.readVertices(i,v,p<<1),null!=(c=this.getValue(i,"color",null))&&v.color.setFromString(c),v}return null},i.prototype.readVertices=function(t,i,r){var o=this.scale,f,e,s,c,a,l,u,h;if(i.worldVerticesLength=r,f=t.vertices,r!=f.length){for(e=[],s=[],u=0,h=f.length;u<h;)for(c=f[u++],s.push(c),a=u+4*c;u<a;u+=4)s.push(f[u]),e.push(f[u+1]*o),e.push(f[u+2]*o),e.push(f[u+3]);i.bones=s;i.vertices=n.Utils.toFloatArray(e)}else{if(l=n.Utils.toFloatArray(f),1!=o)for(u=0,h=f.length;u<h;u++)l[u]*=o;i.vertices=l}},i.prototype.readAnimation=function(t,i,r){var it=this.scale,l=[],h=0,d,s,o,f,e,rt,ut,ot,st,ti,yt,ci,li,a,pt,wt,v,ht,bt,kt,ri,ui,w,c,ct,b,nt,lt,oi,ai,tt,at,y,ni,p,et,k;if(t.slots)for(w in t.slots){if(d=t.slots[w],-1==(y=r.findSlotIndex(w)))throw new Error("Slot not found: "+w);for(c in d)if(s=d[c],"attachment"==c){for((u=new n.AttachmentTimeline(s.length)).slotIndex=y,o=0,f=0;f<s.length;f++)e=s[f],u.setFrame(o++,this.getValue(e,"time",0),e.name);l.push(u);h=Math.max(h,u.frames[u.getFrameCount()-1])}else if("color"==c){for((u=new n.ColorTimeline(s.length)).slotIndex=y,o=0,f=0;f<s.length;f++)e=s[f],rt=new n.Color,rt.setFromString(e.color),u.setFrame(o,this.getValue(e,"time",0),rt.r,rt.g,rt.b,rt.a),this.readCurve(e,u,o),o++;l.push(u);h=Math.max(h,u.frames[(u.getFrameCount()-1)*n.ColorTimeline.ENTRIES])}else{if("twoColor"!=c)throw new Error("Invalid timeline type for a slot: "+c+" ("+w+")");for((u=new n.TwoColorTimeline(s.length)).slotIndex=y,o=0,f=0;f<s.length;f++)e=s[f],ut=new n.Color,ot=new n.Color,ut.setFromString(e.light),ot.setFromString(e.dark),u.setFrame(o,this.getValue(e,"time",0),ut.r,ut.g,ut.b,ut.a,ot.r,ot.g,ot.b),this.readCurve(e,u,o),o++;l.push(u);h=Math.max(h,u.frames[(u.getFrameCount()-1)*n.TwoColorTimeline.ENTRIES])}}if(t.bones)for(st in t.bones){if(ti=t.bones[st],yt=r.findBoneIndex(st),-1==yt)throw new Error("Bone not found: "+st);for(c in ti)if(s=ti[c],"rotate"===c){for((u=new n.RotateTimeline(s.length)).boneIndex=yt,o=0,f=0;f<s.length;f++)e=s[f],u.setFrame(o,this.getValue(e,"time",0),this.getValue(e,"angle",0)),this.readCurve(e,u,o),o++;l.push(u);h=Math.max(h,u.frames[(u.getFrameCount()-1)*n.RotateTimeline.ENTRIES])}else{if("translate"!==c&&"scale"!==c&&"shear"!==c)throw new Error("Invalid timeline type for a bone: "+c+" ("+st+")");var u=null,g=1,ii=0;for("scale"===c?(u=new n.ScaleTimeline(s.length),ii=1):"shear"===c?u=new n.ShearTimeline(s.length):(u=new n.TranslateTimeline(s.length),g=it),u.boneIndex=yt,o=0,f=0;f<s.length;f++)e=s[f],ci=this.getValue(e,"x",ii),li=this.getValue(e,"y",ii),u.setFrame(o,this.getValue(e,"time",0),ci*g,li*g),this.readCurve(e,u,o),o++;l.push(u);h=Math.max(h,u.frames[(u.getFrameCount()-1)*n.TranslateTimeline.ENTRIES])}}if(t.ik)for(v in t.ik){for(a=t.ik[v],pt=r.findIkConstraint(v),(u=new n.IkConstraintTimeline(a.length)).ikConstraintIndex=r.ikConstraints.indexOf(pt),o=0,f=0;f<a.length;f++)e=a[f],u.setFrame(o,this.getValue(e,"time",0),this.getValue(e,"mix",1),this.getValue(e,"softness",0)*it,this.getValue(e,"bendPositive",!0)?1:-1,this.getValue(e,"compress",!1),this.getValue(e,"stretch",!1)),this.readCurve(e,u,o),o++;l.push(u);h=Math.max(h,u.frames[(u.getFrameCount()-1)*n.IkConstraintTimeline.ENTRIES])}if(t.transform)for(v in t.transform){for(a=t.transform[v],pt=r.findTransformConstraint(v),(u=new n.TransformConstraintTimeline(a.length)).transformConstraintIndex=r.transformConstraints.indexOf(pt),o=0,f=0;f<a.length;f++)e=a[f],u.setFrame(o,this.getValue(e,"time",0),this.getValue(e,"rotateMix",1),this.getValue(e,"translateMix",1),this.getValue(e,"scaleMix",1),this.getValue(e,"shearMix",1)),this.readCurve(e,u,o),o++;l.push(u);h=Math.max(h,u.frames[(u.getFrameCount()-1)*n.TransformConstraintTimeline.ENTRIES])}if(wt=t.path||t.paths,wt)for(v in wt){if(a=wt[v],ht=r.findPathConstraintIndex(v),-1==ht)throw new Error("Path constraint not found: "+v);bt=r.pathConstraints[ht];for(c in a)if(s=a[c],"position"===c||"spacing"===c){for(u=null,g=1,"spacing"===c?(u=new n.PathConstraintSpacingTimeline(s.length),bt.spacingMode!=n.SpacingMode.Length&&bt.spacingMode!=n.SpacingMode.Fixed||(g=it)):(u=new n.PathConstraintPositionTimeline(s.length),bt.positionMode==n.PositionMode.Fixed&&(g=it)),u.pathConstraintIndex=ht,o=0,f=0;f<s.length;f++)e=s[f],u.setFrame(o,this.getValue(e,"time",0),this.getValue(e,c,0)*g),this.readCurve(e,u,o),o++;l.push(u);h=Math.max(h,u.frames[(u.getFrameCount()-1)*n.PathConstraintPositionTimeline.ENTRIES])}else if("mix"===c){for((u=new n.PathConstraintMixTimeline(s.length)).pathConstraintIndex=ht,o=0,f=0;f<s.length;f++)e=s[f],u.setFrame(o,this.getValue(e,"time",0),this.getValue(e,"rotateMix",1),this.getValue(e,"translateMix",1)),this.readCurve(e,u,o),o++;l.push(u);h=Math.max(h,u.frames[(u.getFrameCount()-1)*n.PathConstraintMixTimeline.ENTRIES])}}if(t.deform)for(kt in t.deform){if(ri=t.deform[kt],ui=r.findSkin(kt),null==ui)throw new Error("Skin not found: "+kt);for(w in ri){if(d=ri[w],-1==(y=r.findSlotIndex(w)))throw new Error("Slot not found: "+d.name);for(c in d)if(s=d[c],ct=ui.getAttachment(y,c),null!=ct){var fi=null!=ct.bones,dt=ct.vertices,ei=fi?dt.length/3*2:dt.length;for((u=new n.DeformTimeline(s.length)).slotIndex=y,u.attachment=ct,o=0,b=0;b<s.length;b++){if(e=s[b],nt=void 0,lt=this.getValue(e,"vertices",null),null==lt)nt=fi?n.Utils.newFloatArray(ei):dt;else{if(nt=n.Utils.newFloatArray(ei),oi=this.getValue(e,"offset",0),n.Utils.arrayCopy(lt,0,nt,oi,lt.length),1!=it)for(ai=(f=oi)+lt.length;f<ai;f++)nt[f]*=it;if(!fi)for(f=0;f<ei;f++)nt[f]+=dt[f]}u.setFrame(o,this.getValue(e,"time",0),nt);this.readCurve(e,u,o);o++}l.push(u);h=Math.max(h,u.frames[u.getFrameCount()-1])}}}if(tt=t.drawOrder,null==tt&&(tt=t.draworder),null!=tt){for(u=new n.DrawOrderTimeline(tt.length),at=r.slots.length,o=0,b=0;b<tt.length;b++){var vi=tt[b],vt=null,gt=this.getValue(vi,"offsets",null);if(null!=gt){vt=n.Utils.newArray(at,-1);var si=n.Utils.newArray(at-gt.length,0),ft=0,hi=0;for(f=0;f<gt.length;f++){if(ni=gt[f],-1==(y=r.findSlotIndex(ni.slot)))throw new Error("Slot not found: "+ni.slot);for(;ft!=y;)si[hi++]=ft++;vt[ft+ni.offset]=ft++}for(;ft<at;)si[hi++]=ft++;for(f=at-1;f>=0;f--)-1==vt[f]&&(vt[f]=si[--hi])}u.setFrame(o++,this.getValue(vi,"time",0),vt)}l.push(u);h=Math.max(h,u.frames[u.getFrameCount()-1])}if(t.events){for(u=new n.EventTimeline(t.events.length),o=0,f=0;f<t.events.length;f++){if(p=t.events[f],et=r.findEvent(p.name),null==et)throw new Error("Event not found: "+p.name);k=new n.Event(n.Utils.toSinglePrecision(this.getValue(p,"time",0)),et);k.intValue=this.getValue(p,"int",et.intValue);k.floatValue=this.getValue(p,"float",et.floatValue);k.stringValue=this.getValue(p,"string",et.stringValue);null!=k.data.audioPath&&(k.volume=this.getValue(p,"volume",1),k.balance=this.getValue(p,"balance",0));u.setFrame(o++,k)}l.push(u);h=Math.max(h,u.frames[u.getFrameCount()-1])}if(isNaN(h))throw new Error("Error while parsing animation, duration is NaN");r.animations.push(new n.Animation(i,l,h))},i.prototype.readCurve=function(n,t,i){var r=n.curve;r&&("stepped"==r?t.setStepped(i):"[object Array]"===Object.prototype.toString.call(r)?t.setCurve(i,r[0],r[1],r[2],r[3]):t.setCurve(i,r,this.getValue(n,"c2",0),this.getValue(n,"c3",1),this.getValue(n,"c4",1)))},i.prototype.getValue=function(n,t,i){return void 0!==n[t]?n[t]:i},i.blendModeFromString=function(t){if("normal"==(t=t.toLowerCase()))return n.BlendMode.Normal;if("additive"==t)return n.BlendMode.Additive;if("multiply"==t)return n.BlendMode.Multiply;if("screen"==t)return n.BlendMode.Screen;throw new Error("Unknown blend mode: "+t);},i.positionModeFromString=function(t){if("fixed"==(t=t.toLowerCase()))return n.PositionMode.Fixed;if("percent"==t)return n.PositionMode.Percent;throw new Error("Unknown position mode: "+t);},i.spacingModeFromString=function(t){if("length"==(t=t.toLowerCase()))return n.SpacingMode.Length;if("fixed"==t)return n.SpacingMode.Fixed;if("percent"==t)return n.SpacingMode.Percent;throw new Error("Unknown position mode: "+t);},i.rotateModeFromString=function(t){if("tangent"==(t=t.toLowerCase()))return n.RotateMode.Tangent;if("chain"==t)return n.RotateMode.Chain;if("chainscale"==t)return n.RotateMode.ChainScale;throw new Error("Unknown rotate mode: "+t);},i.transformModeFromString=function(t){if("normal"==(t=t.toLowerCase()))return n.TransformMode.Normal;if("onlytranslation"==t)return n.TransformMode.OnlyTranslation;if("norotationorreflection"==t)return n.TransformMode.NoRotationOrReflection;if("noscale"==t)return n.TransformMode.NoScale;if("noscaleorreflection"==t)return n.TransformMode.NoScaleOrReflection;throw new Error("Unknown transform mode: "+t);},i}(),t;n.SkeletonJson=i;t=function(n,t,i,r,u){this.mesh=n;this.skin=t;this.slotIndex=i;this.parent=r;this.inheritDeform=u}}(i||(i={})),function(n){var t=function(n,t,i){this.slotIndex=n;this.name=t;this.attachment=i},i;n.SkinEntry=t;i=function(){function i(n){if(this.attachments=[],this.bones=Array(),this.constraints=[],null==n)throw new Error("name cannot be null.");this.name=n}return i.prototype.setAttachment=function(n,t,i){if(null==i)throw new Error("attachment cannot be null.");var r=this.attachments;n>=r.length&&(r.length=n+1);r[n]||(r[n]={});r[n][t]=i},i.prototype.addSkin=function(n){for(var f,e,u,t=0;t<n.bones.length;t++){for(var o=n.bones[t],r=!1,i=0;i<this.bones.length;i++)if(this.bones[i]==o){r=!0;break}r||this.bones.push(o)}for(t=0;t<n.constraints.length;t++){for(f=n.constraints[t],r=!1,i=0;i<this.constraints.length;i++)if(this.constraints[i]==f){r=!0;break}r||this.constraints.push(f)}for(e=n.getAttachments(),t=0;t<e.length;t++)u=e[t],this.setAttachment(u.slotIndex,u.name,u.attachment)},i.prototype.copySkin=function(t){for(var e,o,i,r=0;r<t.bones.length;r++){for(var s=t.bones[r],f=!1,u=0;u<this.bones.length;u++)if(this.bones[u]==s){f=!0;break}f||this.bones.push(s)}for(r=0;r<t.constraints.length;r++){for(e=t.constraints[r],f=!1,u=0;u<this.constraints.length;u++)if(this.constraints[u]==e){f=!0;break}f||this.constraints.push(e)}for(o=t.getAttachments(),r=0;r<o.length;r++)i=o[r],null!=i.attachment&&(i.attachment instanceof n.MeshAttachment?(i.attachment=i.attachment.newLinkedMesh(),this.setAttachment(i.slotIndex,i.name,i.attachment)):(i.attachment=i.attachment.copy(),this.setAttachment(i.slotIndex,i.name,i.attachment)))},i.prototype.getAttachment=function(n,t){var i=this.attachments[n];return i?i[t]:null},i.prototype.removeAttachment=function(n,t){var i=this.attachments[n];i&&(i[t]=null)},i.prototype.getAttachments=function(){for(var i,u,f,r=[],n=0;n<this.attachments.length;n++)if(i=this.attachments[n],i)for(u in i)f=i[u],f&&r.push(new t(n,u,f));return r},i.prototype.getAttachmentsForSlot=function(n,i){var r=this.attachments[n],u,f;if(r)for(u in r)f=r[u],f&&i.push(new t(n,u,f))},i.prototype.clear=function(){this.attachments.length=0;this.bones.length=0;this.constraints.length=0},i.prototype.attachAll=function(n,t){for(var u,f,e,o,s,i=0,r=0;r<n.slots.length;r++){if(u=n.slots[r],f=u.getAttachment(),f&&i<t.attachments.length){e=t.attachments[i];for(o in e)if(f==e[o]){s=this.getAttachment(i,o);null!=s&&u.setAttachment(s);break}}i++}},i}();n.Skin=i}(i||(i={})),function(n){var t=function(){function t(t,i){if(this.deform=[],null==t)throw new Error("data cannot be null.");if(null==i)throw new Error("bone cannot be null.");this.data=t;this.bone=i;this.color=new n.Color;this.darkColor=null==t.darkColor?null:new n.Color;this.setToSetupPose()}return t.prototype.getSkeleton=function(){return this.bone.skeleton},t.prototype.getAttachment=function(){return this.attachment},t.prototype.setAttachment=function(n){this.attachment!=n&&(this.attachment=n,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)},t.prototype.setAttachmentTime=function(n){this.attachmentTime=this.bone.skeleton.time-n},t.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime},t.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color);null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor);null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))},t}();n.Slot=t}(i||(i={})),function(n){n.SlotData=function(t,i,r){if(this.color=new n.Color(1,1,1,1),t<0)throw new Error("index must be >= 0.");if(null==i)throw new Error("name cannot be null.");if(null==r)throw new Error("boneData cannot be null.");this.index=t;this.name=i;this.boneData=r}}(i||(i={})),function(n){var t,i,u=function(){function n(n){this._image=n}return n.prototype.getImage=function(){return this._image},n.filterFromString=function(n){switch(n.toLowerCase()){case"nearest":return t.Nearest;case"linear":return t.Linear;case"mipmap":return t.MipMap;case"mipmapnearestnearest":return t.MipMapNearestNearest;case"mipmaplinearnearest":return t.MipMapLinearNearest;case"mipmapnearestlinear":return t.MipMapNearestLinear;case"mipmaplinearlinear":return t.MipMapLinearLinear;default:throw new Error("Unknown texture filter "+n);}},n.wrapFromString=function(n){switch(n.toLowerCase()){case"mirroredtepeat":return i.MirroredRepeat;case"clamptoedge":return i.ClampToEdge;case"repeat":return i.Repeat;default:throw new Error("Unknown texture wrap "+n);}},n}(),f;n.Texture=u,function(n){n[n.Nearest=9728]="Nearest";n[n.Linear=9729]="Linear";n[n.MipMap=9987]="MipMap";n[n.MipMapNearestNearest=9984]="MipMapNearestNearest";n[n.MipMapLinearNearest=9985]="MipMapLinearNearest";n[n.MipMapNearestLinear=9986]="MipMapNearestLinear";n[n.MipMapLinearLinear=9987]="MipMapLinearLinear"}(t=n.TextureFilter||(n.TextureFilter={})),function(n){n[n.MirroredRepeat=33648]="MirroredRepeat";n[n.ClampToEdge=33071]="ClampToEdge";n[n.Repeat=10497]="Repeat"}(i=n.TextureWrap||(n.TextureWrap={}));n.TextureRegion=function(){this.u=0;this.v=0;this.u2=0;this.v2=0;this.width=0;this.height=0;this.rotate=!1;this.offsetX=0;this.offsetY=0;this.originalWidth=0;this.originalHeight=0};f=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return r(t,n),t.prototype.setFilters=function(){},t.prototype.setWraps=function(){},t.prototype.dispose=function(){},t}(u);n.FakeTexture=f}(i||(i={})),function(n){var f=function(){function r(n,t){this.pages=[];this.regions=[];this.load(n,t)}return r.prototype.load=function(r,f){var c,o,v,l,a,y,p,w;if(null==f)throw new Error("textureLoader cannot be null.");for(var h=new u(r),s=new Array(4),e=null;;){if(c=h.readLine(),null==c)break;0==(c=c.trim()).length?e=null:e?(o=new i,o.name=c,o.page=e,v=h.readValue(),o.degrees="true"==v.toLocaleLowerCase()?90:"false"==v.toLocaleLowerCase()?0:parseFloat(v),o.rotate=90==o.degrees,h.readTuple(s),l=parseInt(s[0]),a=parseInt(s[1]),h.readTuple(s),y=parseInt(s[0]),p=parseInt(s[1]),o.u=l/e.width,o.v=a/e.height,o.rotate?(o.u2=(l+p)/e.width,o.v2=(a+y)/e.height):(o.u2=(l+y)/e.width,o.v2=(a+p)/e.height),o.x=l,o.y=a,o.width=Math.abs(y),o.height=Math.abs(p),4==h.readTuple(s)&&4==h.readTuple(s)&&h.readTuple(s),o.originalWidth=parseInt(s[0]),o.originalHeight=parseInt(s[1]),h.readTuple(s),o.offsetX=parseInt(s[0]),o.offsetY=parseInt(s[1]),o.index=parseInt(h.readValue()),o.texture=e.texture,this.regions.push(o)):((e=new t).name=c,2==h.readTuple(s)&&(e.width=parseInt(s[0]),e.height=parseInt(s[1]),h.readTuple(s)),h.readTuple(s),e.minFilter=n.Texture.filterFromString(s[0]),e.magFilter=n.Texture.filterFromString(s[1]),w=h.readValue(),e.uWrap=n.TextureWrap.ClampToEdge,e.vWrap=n.TextureWrap.ClampToEdge,"x"==w?e.uWrap=n.TextureWrap.Repeat:"y"==w?e.vWrap=n.TextureWrap.Repeat:"xy"==w&&(e.uWrap=e.vWrap=n.TextureWrap.Repeat),e.texture=f(c),e.texture.setFilters(e.minFilter,e.magFilter),e.texture.setWraps(e.uWrap,e.vWrap),e.width=e.texture.getImage().width,e.height=e.texture.getImage().height,this.pages.push(e))}},r.prototype.findRegion=function(n){for(var t=0;t<this.regions.length;t++)if(this.regions[t].name==n)return this.regions[t];return null},r.prototype.dispose=function(){for(var n=0;n<this.pages.length;n++)this.pages[n].texture.dispose()},r}(),u,t,i;n.TextureAtlas=f;u=function(){function n(n){this.index=0;this.lines=n.split(/\r\n|\r|\n/)}return n.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++]},n.prototype.readValue=function(){var n=this.readLine(),t=n.indexOf(":");if(-1==t)throw new Error("Invalid line: "+n);return n.substring(t+1).trim()},n.prototype.readTuple=function(n){var r=this.readLine(),f=r.indexOf(":"),t,i,u;if(-1==f)throw new Error("Invalid line: "+r);for(t=0,i=f+1;t<3;t++){if(u=r.indexOf(",",i),-1==u)break;n[t]=r.substr(i,u-i).trim();i=u+1}return n[t]=r.substring(i).trim(),t+1},n}();t=function(){};n.TextureAtlasPage=t;i=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return r(t,n),t}(n.TextureRegion);n.TextureAtlasRegion=i}(i||(i={})),function(n){var t=function(){function t(t,i){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new n.Vector2,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==i)throw new Error("skeleton cannot be null.");this.data=t;this.rotateMix=t.rotateMix;this.translateMix=t.translateMix;this.scaleMix=t.scaleMix;this.shearMix=t.shearMix;this.bones=[];for(var r=0;r<t.bones.length;r++)this.bones.push(i.findBone(t.bones[r].name));this.target=i.findBone(t.target.name)}return t.prototype.isActive=function(){return this.active},t.prototype.apply=function(){this.update()},t.prototype.update=function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()},t.prototype.applyAbsoluteWorld=function(){for(var t,u,c,l,y,i,p,r,nt,tt=this.rotateMix,w=this.translateMix,b=this.scaleMix,it=this.shearMix,o=this.target,s=o.a,a=o.b,h=o.c,v=o.d,rt=s*v-a*h>0?n.MathUtils.degRad:-n.MathUtils.degRad,ft=this.data.offsetRotation*rt,et=this.data.offsetShearY*rt,ut=this.bones,k=0,ot=ut.length;k<ot;k++){if(t=ut[k],u=!1,0!=tt){var d=t.a,f=t.b,g=t.c,e=t.d;(r=Math.atan2(h,s)-Math.atan2(g,d)+ft)>n.MathUtils.PI?r-=n.MathUtils.PI2:r<-n.MathUtils.PI&&(r+=n.MathUtils.PI2);r*=tt;c=Math.cos(r);l=Math.sin(r);t.a=c*d-l*g;t.b=c*f-l*e;t.c=l*d+c*g;t.d=l*f+c*e;u=!0}0!=w&&(y=this.temp,o.localToWorld(y.set(this.data.offsetX,this.data.offsetY)),t.worldX+=(y.x-t.worldX)*w,t.worldY+=(y.y-t.worldY)*w,u=!0);b>0&&(i=Math.sqrt(t.a*t.a+t.c*t.c),p=Math.sqrt(s*s+h*h),i>1e-5&&(i=(i+(p-i+this.data.offsetScaleX)*b)/i),t.a*=i,t.c*=i,i=Math.sqrt(t.b*t.b+t.d*t.d),p=Math.sqrt(a*a+v*v),i>1e-5&&(i=(i+(p-i+this.data.offsetScaleY)*b)/i),t.b*=i,t.d*=i,u=!0);it>0&&(f=t.b,e=t.d,nt=Math.atan2(e,f),(r=Math.atan2(v,a)-Math.atan2(h,s)-(nt-Math.atan2(t.c,t.a)))>n.MathUtils.PI?r-=n.MathUtils.PI2:r<-n.MathUtils.PI&&(r+=n.MathUtils.PI2),r=nt+(r+et)*it,i=Math.sqrt(f*f+e*e),t.b=Math.cos(r)*i,t.d=Math.sin(r)*i,u=!0);u&&(t.appliedValid=!1)}},t.prototype.applyRelativeWorld=function(){for(var i,t,u,c,l,y,r,k=this.rotateMix,p=this.translateMix,w=this.scaleMix,d=this.shearMix,o=this.target,s=o.a,a=o.b,h=o.c,v=o.d,g=s*v-a*h>0?n.MathUtils.degRad:-n.MathUtils.degRad,rt=this.data.offsetRotation*g,ut=this.data.offsetShearY*g,nt=this.bones,b=0,ft=nt.length;b<ft;b++){if(t=nt[b],u=!1,0!=k){var tt=t.a,f=t.b,it=t.c,e=t.d;(i=Math.atan2(h,s)+rt)>n.MathUtils.PI?i-=n.MathUtils.PI2:i<-n.MathUtils.PI&&(i+=n.MathUtils.PI2);i*=k;c=Math.cos(i);l=Math.sin(i);t.a=c*tt-l*it;t.b=c*f-l*e;t.c=l*tt+c*it;t.d=l*f+c*e;u=!0}0!=p&&(y=this.temp,o.localToWorld(y.set(this.data.offsetX,this.data.offsetY)),t.worldX+=y.x*p,t.worldY+=y.y*p,u=!0);w>0&&(r=(Math.sqrt(s*s+h*h)-1+this.data.offsetScaleX)*w+1,t.a*=r,t.c*=r,r=(Math.sqrt(a*a+v*v)-1+this.data.offsetScaleY)*w+1,t.b*=r,t.d*=r,u=!0);d>0&&((i=Math.atan2(v,a)-Math.atan2(h,s))>n.MathUtils.PI?i-=n.MathUtils.PI2:i<-n.MathUtils.PI&&(i+=n.MathUtils.PI2),f=t.b,e=t.d,i=Math.atan2(e,f)+(i-n.MathUtils.PI/2+ut)*d,r=Math.sqrt(f*f+e*e),t.b=Math.cos(i)*r,t.d=Math.sin(i)*r,u=!0);u&&(t.appliedValid=!1)}},t.prototype.applyAbsoluteLocal=function(){var a=this.rotateMix,s=this.translateMix,h=this.scaleMix,v=this.shearMix,t=this.target,n,f,i,e,o,r,u,l;t.appliedValid||t.updateAppliedTransform();for(var y=this.bones,c=0,p=y.length;c<p;c++)n=y[c],n.appliedValid||n.updateAppliedTransform(),f=n.arotation,0!=a&&(i=t.arotation-f+this.data.offsetRotation,f+=(i-=360*(16384-(16384.499999999996-i/360|0)))*a),e=n.ax,o=n.ay,0!=s&&(e+=(t.ax-e+this.data.offsetX)*s,o+=(t.ay-o+this.data.offsetY)*s),r=n.ascaleX,u=n.ascaleY,0!=h&&(r>1e-5&&(r=(r+(t.ascaleX-r+this.data.offsetScaleX)*h)/r),u>1e-5&&(u=(u+(t.ascaleY-u+this.data.offsetScaleY)*h)/u)),l=n.ashearY,0!=v&&(i=t.ashearY-l+this.data.offsetShearY,i-=360*(16384-(16384.499999999996-i/360|0)),n.shearY+=i*v),n.updateWorldTransformWith(e,o,f,r,u,n.ashearX,l)},t.prototype.applyRelativeLocal=function(){var l=this.rotateMix,u=this.translateMix,f=this.scaleMix,a=this.shearMix,t=this.target,n,o,s,h,i,r,c;t.appliedValid||t.updateAppliedTransform();for(var v=this.bones,e=0,y=v.length;e<y;e++)n=v[e],n.appliedValid||n.updateAppliedTransform(),o=n.arotation,0!=l&&(o+=(t.arotation+this.data.offsetRotation)*l),s=n.ax,h=n.ay,0!=u&&(s+=(t.ax+this.data.offsetX)*u,h+=(t.ay+this.data.offsetY)*u),i=n.ascaleX,r=n.ascaleY,0!=f&&(i>1e-5&&(i*=(t.ascaleX-1+this.data.offsetScaleX)*f+1),r>1e-5&&(r*=(t.ascaleY-1+this.data.offsetScaleY)*f+1)),c=n.ashearY,0!=a&&(c+=(t.ashearY+this.data.offsetShearY)*a),n.updateWorldTransformWith(s,h,o,i,r,n.ashearX,c)},t}();n.TransformConstraint=t}(i||(i={})),function(n){var t=function(n){function t(t){var i=n.call(this,t,0,!1)||this;return i.bones=[],i.rotateMix=0,i.translateMix=0,i.scaleMix=0,i.shearMix=0,i.offsetRotation=0,i.offsetX=0,i.offsetY=0,i.offsetScaleX=0,i.offsetScaleY=0,i.offsetShearY=0,i.relative=!1,i.local=!1,i}return r(t,n),t}(n.ConstraintData);n.TransformConstraintData=t}(i||(i={})),function(n){var t=function(){function t(){this.convexPolygons=[];this.convexPolygonsIndices=[];this.indicesArray=[];this.isConcaveArray=[];this.triangles=[];this.polygonPool=new n.Pool(function(){return[]});this.polygonIndicesPool=new n.Pool(function(){return[]})}return t.prototype.triangulate=function(n){var f=n,r=n.length>>1,u=this.indicesArray,i,e,p,o,c,s,v,y;for(u.length=0,i=0;i<r;i++)u[i]=i;for(e=this.isConcaveArray,e.length=0,i=0,p=r;i<p;++i)e[i]=t.isConcave(i,r,f,u);for(o=this.triangles,o.length=0;r>3;){for(c=r-1,s=(i=0,1);;){n:if(!e[i]){for(var w=u[c]<<1,b=u[i]<<1,k=u[s]<<1,d=f[w],g=f[w+1],nt=f[b],tt=f[b+1],it=f[k],rt=f[k+1],h=(s+1)%r;h!=c;h=(h+1)%r)if(e[h]){var ut=u[h]<<1,l=f[ut],a=f[ut+1];if(t.positiveArea(it,rt,d,g,l,a)&&t.positiveArea(d,g,nt,tt,l,a)&&t.positiveArea(nt,tt,it,rt,l,a))break n}break}if(0==s){do{if(!e[i])break;i--}while(i>0);break}c=i;i=s;s=(s+1)%r}o.push(u[(r+i-1)%r]);o.push(u[i]);o.push(u[(i+1)%r]);u.splice(i,1);e.splice(i,1);v=(--r+i-1)%r;y=i==r?0:i;e[v]=t.isConcave(v,r,f,u);e[y]=t.isConcave(y,r,f,u)}return 3==r&&(o.push(u[2]),o.push(u[0]),o.push(u[1])),o},t.prototype.decompose=function(n,i){var l=n,e=this.convexPolygons,h,f,r,v;this.polygonPool.freeAll(e);e.length=0;h=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(h);h.length=0;f=this.polygonIndicesPool.obtain();f.length=0;r=this.polygonPool.obtain();r.length=0;for(var ft=-1,g=0,u=0,w=i.length;u<w;u+=3){var y=i[u]<<1,nt=i[u+1]<<1,b=i[u+2]<<1,et=l[y],ot=l[y+1],st=l[nt],ht=l[nt+1],o=l[b],s=l[b+1],ct=!1;if(ft==y){var c=r.length-4,tt=t.winding(r[c],r[c+1],r[c+2],r[c+3],o,s),it=t.winding(o,s,r[0],r[1],r[2],r[3]);tt==g&&it==g&&(r.push(o),r.push(s),f.push(b),ct=!0)}ct||(r.length>0?(e.push(r),h.push(f)):(this.polygonPool.free(r),this.polygonIndicesPool.free(f)),(r=this.polygonPool.obtain()).length=0,r.push(et),r.push(ot),r.push(st),r.push(ht),r.push(o),r.push(s),(f=this.polygonIndicesPool.obtain()).length=0,f.push(y),f.push(nt),f.push(b),g=t.winding(et,ot,st,ht,o,s),ft=y)}for(r.length>0&&(e.push(r),h.push(f)),u=0,w=e.length;u<w;u++)if(0!=(f=h[u]).length)for(var yt=f[0],pt=f[f.length-1],rt=(r=e[u])[c=r.length-4],ut=r[c+1],k=r[c+2],d=r[c+3],lt=r[0],at=r[1],wt=r[2],bt=r[3],vt=t.winding(rt,ut,k,d,lt,at),a=0;a<w;a++)if(a!=u&&(v=h[a],3==v.length)){var kt=v[0],dt=v[1],gt=v[2],p=e[a];o=p[p.length-2];s=p[p.length-1];kt==yt&&dt==pt&&(tt=t.winding(rt,ut,k,d,o,s),it=t.winding(o,s,lt,at,wt,bt),tt==vt&&it==vt&&(p.length=0,v.length=0,r.push(o),r.push(s),f.push(gt),rt=k,ut=d,k=o,d=s,a=0))}for(u=e.length-1;u>=0;u--)0==(r=e[u]).length&&(e.splice(u,1),this.polygonPool.free(r),f=h[u],h.splice(u,1),this.polygonIndicesPool.free(f));return e},t.isConcave=function(n,t,i,r){var u=r[(t+n-1)%t]<<1,f=r[n]<<1,e=r[(n+1)%t]<<1;return!this.positiveArea(i[u],i[u+1],i[f],i[f+1],i[e],i[e+1])},t.positiveArea=function(n,t,i,r,u,f){return n*(f-r)+i*(t-f)+u*(r-t)>=0},t.winding=function(n,t,i,r,u,f){var e=i-n,o=r-t;return u*o-f*e+e*t-n*o>=0?1:-1},t}();n.Triangulator=t}(i||(i={})),function(n){var v=function(){function n(){this.array=[]}return n.prototype.add=function(n){var t=this.contains(n);return this.array[0|n]=0|n,!t},n.prototype.contains=function(n){return null!=this.array[0|n]},n.prototype.remove=function(n){this.array[0|n]=void 0},n.prototype.clear=function(){this.array.length=0},n}(),u,f,t,i,e,o,s,h,c,l,a;n.IntSet=v;u=function(){function n(n,t,i,r){void 0===n&&(n=0);void 0===t&&(t=0);void 0===i&&(i=0);void 0===r&&(r=0);this.r=n;this.g=t;this.b=i;this.a=r}return n.prototype.set=function(n,t,i,r){return this.r=n,this.g=t,this.b=i,this.a=r,this.clamp(),this},n.prototype.setFromColor=function(n){return this.r=n.r,this.g=n.g,this.b=n.b,this.a=n.a,this},n.prototype.setFromString=function(n){return n="#"==n.charAt(0)?n.substr(1):n,this.r=parseInt(n.substr(0,2),16)/255,this.g=parseInt(n.substr(2,2),16)/255,this.b=parseInt(n.substr(4,2),16)/255,this.a=(8!=n.length?255:parseInt(n.substr(6,2),16))/255,this},n.prototype.add=function(n,t,i,r){return this.r+=n,this.g+=t,this.b+=i,this.a+=r,this.clamp(),this},n.prototype.clamp=function(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this},n.rgba8888ToColor=function(n,t){n.r=((4278190080&t)>>>24)/255;n.g=((16711680&t)>>>16)/255;n.b=((65280&t)>>>8)/255;n.a=(255&t)/255},n.rgb888ToColor=function(n,t){n.r=((16711680&t)>>>16)/255;n.g=((65280&t)>>>8)/255;n.b=(255&t)/255},n.WHITE=new n(1,1,1,1),n.RED=new n(1,0,0,1),n.GREEN=new n(0,1,0,1),n.BLUE=new n(0,0,1,1),n.MAGENTA=new n(1,0,1,1),n}();n.Color=u;f=function(){function n(){}return n.clamp=function(n,t,i){return n<t?t:n>i?i:n},n.cosDeg=function(t){return Math.cos(t*n.degRad)},n.sinDeg=function(t){return Math.sin(t*n.degRad)},n.signum=function(n){return n>0?1:n<0?-1:0},n.toInt=function(n){return n>0?Math.floor(n):Math.ceil(n)},n.cbrt=function(n){var t=Math.pow(Math.abs(n),1/3);return n<0?-t:t},n.randomTriangular=function(t,i){return n.randomTriangularWith(t,i,.5*(t+i))},n.randomTriangularWith=function(n,t,i){var r=Math.random(),u=t-n;return r<=(i-n)/u?n+Math.sqrt(r*u*(i-n)):t-Math.sqrt((1-r)*u*(t-i))},n.PI=3.1415927,n.PI2=2*n.PI,n.radiansToDegrees=180/n.PI,n.radDeg=n.radiansToDegrees,n.degreesToRadians=n.PI/180,n.degRad=n.degreesToRadians,n}();n.MathUtils=f;t=function(){function n(){}return n.prototype.apply=function(n,t,i){return n+(t-n)*this.applyInternal(i)},n}();n.Interpolation=t;i=function(n){function t(t){var i=n.call(this)||this;return i.power=2,i.power=t,i}return r(t,n),t.prototype.applyInternal=function(n){return n<=.5?Math.pow(2*n,this.power)/2:Math.pow(2*(n-1),this.power)/(this.power%2==0?-2:2)+1},t}(t);n.Pow=i;e=function(n){function t(t){return n.call(this,t)||this}return r(t,n),t.prototype.applyInternal=function(n){return Math.pow(n-1,this.power)*(this.power%2==0?-1:1)+1},t}(i);n.PowOut=e;o=function(){function n(){}return n.arrayCopy=function(n,t,i,r,u){for(var f=t,e=r;f<t+u;f++,e++)i[e]=n[f]},n.setArraySize=function(n,t,i){var r,u;if(void 0===i&&(i=0),r=n.length,r==t)return n;if(n.length=t,r<t)for(u=r;u<t;u++)n[u]=i;return n},n.ensureArrayCapacity=function(t,i,r){return void 0===r&&(r=0),t.length>=i?t:n.setArraySize(t,i,r)},n.newArray=function(n,t){for(var r=new Array(n),i=0;i<n;i++)r[i]=t;return r},n.newFloatArray=function(t){if(n.SUPPORTS_TYPED_ARRAYS)return new Float32Array(t);for(var i=new Array(t),r=0;r<i.length;r++)i[r]=0;return i},n.newShortArray=function(t){if(n.SUPPORTS_TYPED_ARRAYS)return new Int16Array(t);for(var i=new Array(t),r=0;r<i.length;r++)i[r]=0;return i},n.toFloatArray=function(t){return n.SUPPORTS_TYPED_ARRAYS?new Float32Array(t):t},n.toSinglePrecision=function(t){return n.SUPPORTS_TYPED_ARRAYS?Math.fround(t):t},n.webkit602BugfixHelper=function(){},n.contains=function(n,t,i){void 0===i&&(i=!0);for(var r=0;r<n.length;r++)if(n[r]==t)return!0;return!1},n.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array,n}();n.Utils=o;s=function(){function n(){}return n.logBones=function(n){for(var t,i=0;i<n.bones.length;i++)t=n.bones[i],console.log(t.data.name+", "+t.a+", "+t.b+", "+t.c+", "+t.d+", "+t.worldX+", "+t.worldY)},n}();n.DebugUtils=s;h=function(){function n(n){this.items=[];this.instantiator=n}return n.prototype.obtain=function(){return this.items.length>0?this.items.pop():this.instantiator()},n.prototype.free=function(n){n.reset&&n.reset();this.items.push(n)},n.prototype.freeAll=function(n){for(var t=0;t<n.length;t++)n[t].reset&&n[t].reset(),this.items[t]=n[t]},n.prototype.clear=function(){this.items.length=0},n}();n.Pool=h;c=function(){function n(n,t){void 0===n&&(n=0);void 0===t&&(t=0);this.x=n;this.y=t}return n.prototype.set=function(n,t){return this.x=n,this.y=t,this},n.prototype.length=function(){var n=this.x,t=this.y;return Math.sqrt(n*n+t*t)},n.prototype.normalize=function(){var n=this.length();return 0!=n&&(this.x/=n,this.y/=n),this},n}();n.Vector2=c;l=function(){function n(){this.maxDelta=.064;this.framesPerSecond=0;this.delta=0;this.totalTime=0;this.lastTime=Date.now()/1e3;this.frameCount=0;this.frameTime=0}return n.prototype.update=function(){var n=Date.now()/1e3;this.delta=n-this.lastTime;this.frameTime+=this.delta;this.totalTime+=this.delta;this.delta>this.maxDelta&&(this.delta=this.maxDelta);this.lastTime=n;this.frameCount++;this.frameTime>1&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0)},n}();n.TimeKeeper=l;a=function(){function n(n){void 0===n&&(n=32);this.addedValues=0;this.lastValue=0;this.mean=0;this.dirty=!0;this.values=new Array(n)}return n.prototype.hasEnoughData=function(){return this.addedValues>=this.values.length},n.prototype.addValue=function(n){this.addedValues<this.values.length&&this.addedValues++;this.values[this.lastValue++]=n;this.lastValue>this.values.length-1&&(this.lastValue=0);this.dirty=!0},n.prototype.getMean=function(){if(this.hasEnoughData()){if(this.dirty){for(var t=0,n=0;n<this.values.length;n++)t+=this.values[n];this.mean=t/this.values.length;this.dirty=!1}return this.mean}return 0},n}();n.WindowedMean=a}(i||(i={}));Math.fround||(Math.fround=(f=new Float32Array(1),function(n){return f[0]=n,f[0]})),function(n){var t=function(n){if(null==n)throw new Error("name cannot be null.");this.name=n},i;n.Attachment=t;i=function(t){function i(n){var r=t.call(this,n)||this;return r.id=(65535&i.nextID++)<<11,r.worldVerticesLength=0,r.deformAttachment=r,r}return r(i,t),i.prototype.computeWorldVertices=function(n,t,i,r,u,f){var nt,p,tt,g,l,a;i=u+(i>>1)*f;var ut=n.bone.skeleton,k=n.deform,c=this.vertices,y=this.bones;if(null!=y){for(var s=0,d=0,rt=0;rt<t;rt+=2)s+=(v=y[s])+1,d+=v;if(nt=ut.bones,0==k.length)for(o=u,h=3*d;o<i;o+=f){var w=0,b=0,v=y[s++];for(v+=s;s<v;s++,h+=3)e=nt[y[s]],l=c[h],a=c[h+1],p=c[h+2],w+=(l*e.a+a*e.b+e.worldX)*p,b+=(l*e.c+a*e.d+e.worldY)*p;r[o]=w;r[o+1]=b}else for(tt=k,g=(o=u,h=3*d,d<<1);o<i;o+=f){for(w=0,b=0,v=y[s++],v+=s;s<v;s++,h+=3,g+=2)e=nt[y[s]],l=c[h]+tt[g],a=c[h+1]+tt[g+1],p=c[h+2],w+=(l*e.a+a*e.b+e.worldX)*p,b+=(l*e.c+a*e.d+e.worldY)*p;r[o]=w;r[o+1]=b}}else{k.length>0&&(c=k);for(var e,ft=(e=n.bone).worldX,et=e.worldY,ot=e.a,h=e.b,st=e.c,ht=e.d,it=t,o=u;o<i;it+=2,o+=f)l=c[it],a=c[it+1],r[o]=l*ot+a*h+ft,r[o+1]=l*st+a*ht+et}},i.prototype.copyTo=function(t){null!=this.bones?(t.bones=new Array(this.bones.length),n.Utils.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null;null!=this.vertices?(t.vertices=n.Utils.newFloatArray(this.vertices.length),n.Utils.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)):t.vertices=null;t.worldVerticesLength=this.worldVerticesLength;t.deformAttachment=this.deformAttachment},i.nextID=0,i}(t);n.VertexAttachment=i}(i||(i={})),function(n){(function(n){n[n.Region=0]="Region";n[n.BoundingBox=1]="BoundingBox";n[n.Mesh=2]="Mesh";n[n.LinkedMesh=3]="LinkedMesh";n[n.Path=4]="Path";n[n.Point=5]="Point";n[n.Clipping=6]="Clipping"})(n.AttachmentType||(n.AttachmentType={}))}(i||(i={})),function(n){var t=function(t){function i(i){var r=t.call(this,i)||this;return r.color=new n.Color(1,1,1,1),r}return r(i,t),i.prototype.copy=function(){var n=new i(name);return this.copyTo(n),n.color.setFromColor(this.color),n},i}(n.VertexAttachment);n.BoundingBoxAttachment=t}(i||(i={})),function(n){var t=function(t){function i(i){var r=t.call(this,i)||this;return r.color=new n.Color(.2275,.2275,.8078,1),r}return r(i,t),i.prototype.copy=function(){var n=new i(name);return this.copyTo(n),n.endSlot=this.endSlot,n.color.setFromColor(this.color),n},i}(n.VertexAttachment);n.ClippingAttachment=t}(i||(i={})),function(n){var t=function(t){function i(i){var r=t.call(this,i)||this;return r.color=new n.Color(1,1,1,1),r.tempColor=new n.Color(0,0,0,0),r}return r(i,t),i.prototype.updateUVs=function(){var r=this.regionUVs,t;null!=this.uvs&&this.uvs.length==r.length||(this.uvs=n.Utils.newFloatArray(r.length));var s=this.uvs,l=this.uvs.length,u=this.region.u,f=this.region.v,e=0,o=0;if(this.region instanceof n.TextureAtlasRegion){var i=this.region,h=i.texture.getImage().width,c=i.texture.getImage().height;switch(i.degrees){case 90:for(u-=(i.originalHeight-i.offsetY-i.height)/h,f-=(i.originalWidth-i.offsetX-i.width)/c,e=i.originalHeight/h,o=i.originalWidth/c,t=0;t<l;t+=2)s[t]=u+r[t+1]*e,s[t+1]=f+(1-r[t])*o;return;case 180:for(u-=(i.originalWidth-i.offsetX-i.width)/h,f-=i.offsetY/c,e=i.originalWidth/h,o=i.originalHeight/c,t=0;t<l;t+=2)s[t]=u+(1-r[t])*e,s[t+1]=f+(1-r[t+1])*o;return;case 270:for(u-=i.offsetY/h,f-=i.offsetX/c,e=i.originalHeight/h,o=i.originalWidth/c,t=0;t<l;t+=2)s[t]=u+(1-r[t+1])*e,s[t+1]=f+r[t]*o;return}u-=i.offsetX/h;f-=(i.originalHeight-i.offsetY-i.height)/c;e=i.originalWidth/h;o=i.originalHeight/c}else null==this.region?(u=f=0,e=o=1):(e=this.region.u2-u,o=this.region.v2-f);for(t=0;t<l;t+=2)s[t]=u+r[t]*e,s[t+1]=f+r[t+1]*o},i.prototype.getParentMesh=function(){return this.parentMesh},i.prototype.setParentMesh=function(n){this.parentMesh=n;null!=n&&(this.bones=n.bones,this.vertices=n.vertices,this.worldVerticesLength=n.worldVerticesLength,this.regionUVs=n.regionUVs,this.triangles=n.triangles,this.hullLength=n.hullLength,this.worldVerticesLength=n.worldVerticesLength)},i.prototype.copy=function(){if(null!=this.parentMesh)return this.newLinkedMesh();var t=new i(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Array(this.regionUVs.length),n.Utils.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.uvs=new Array(this.uvs.length),n.Utils.arrayCopy(this.uvs,0,t.uvs,0,this.uvs.length),t.triangles=new Array(this.triangles.length),n.Utils.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,null!=this.edges&&(t.edges=new Array(this.edges.length),n.Utils.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t},i.prototype.newLinkedMesh=function(){var n=new i(this.name);return n.region=this.region,n.path=this.path,n.color.setFromColor(this.color),n.deformAttachment=this.deformAttachment,n.setParentMesh(null!=this.parentMesh?this.parentMesh:this),n.updateUVs(),n},i}(n.VertexAttachment);n.MeshAttachment=t}(i||(i={})),function(n){var t=function(t){function i(i){var r=t.call(this,i)||this;return r.closed=!1,r.constantSpeed=!1,r.color=new n.Color(1,1,1,1),r}return r(i,t),i.prototype.copy=function(){var t=new i(name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),n.Utils.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t},i}(n.VertexAttachment);n.PathAttachment=t}(i||(i={})),function(n){var t=function(t){function i(i){var r=t.call(this,i)||this;return r.color=new n.Color(.38,.94,0,1),r}return r(i,t),i.prototype.computeWorldPosition=function(n,t){return t.x=this.x*n.a+this.y*n.b+n.worldX,t.y=this.x*n.c+this.y*n.d+n.worldY,t},i.prototype.computeWorldRotation=function(t){var i=n.MathUtils.cosDeg(this.rotation),r=n.MathUtils.sinDeg(this.rotation),u=i*t.a+r*t.b,f=i*t.c+r*t.d;return Math.atan2(f,u)*n.MathUtils.radDeg},i.prototype.copy=function(){var n=new i(name);return n.x=this.x,n.y=this.y,n.rotation=this.rotation,n.color.setFromColor(this.color),n},i}(n.VertexAttachment);n.PointAttachment=t}(i||(i={})),function(n){var t=function(t){function i(i){var r=t.call(this,i)||this;return r.x=0,r.y=0,r.scaleX=1,r.scaleY=1,r.rotation=0,r.width=0,r.height=0,r.color=new n.Color(1,1,1,1),r.offset=n.Utils.newFloatArray(8),r.uvs=n.Utils.newFloatArray(8),r.tempColor=new n.Color(1,1,1,1),r}return r(i,t),i.prototype.updateOffset=function(){var e=this.width/this.region.originalWidth*this.scaleX,o=this.height/this.region.originalHeight*this.scaleY,u=-this.width/2*this.scaleX+this.region.offsetX*e,f=-this.height/2*this.scaleY+this.region.offsetY*o,s=u+this.region.width*e,h=f+this.region.height*o,c=this.rotation*Math.PI/180,t=Math.cos(c),r=Math.sin(c),l=u*t+this.x,a=u*r,v=f*t+this.y,y=f*r,p=s*t+this.x,w=s*r,b=h*t+this.y,k=h*r,n=this.offset;n[i.OX1]=l-y;n[i.OY1]=v+a;n[i.OX2]=l-k;n[i.OY2]=b+a;n[i.OX3]=p-k;n[i.OY3]=b+w;n[i.OX4]=p-y;n[i.OY4]=v+w},i.prototype.setRegion=function(n){this.region=n;var t=this.uvs;n.rotate?(t[2]=n.u,t[3]=n.v2,t[4]=n.u,t[5]=n.v,t[6]=n.u2,t[7]=n.v,t[0]=n.u2,t[1]=n.v2):(t[0]=n.u,t[1]=n.v2,t[2]=n.u,t[3]=n.v,t[4]=n.u2,t[5]=n.v,t[6]=n.u2,t[7]=n.v2)},i.prototype.computeWorldVertices=function(n,t,r,u){var o=this.offset,s=n.worldX,h=n.worldY,c=n.a,l=n.b,a=n.c,v=n.d,f=0,e=0;f=o[i.OX1];e=o[i.OY1];t[r]=f*c+e*l+s;t[r+1]=f*a+e*v+h;r+=u;f=o[i.OX2];e=o[i.OY2];t[r]=f*c+e*l+s;t[r+1]=f*a+e*v+h;r+=u;f=o[i.OX3];e=o[i.OY3];t[r]=f*c+e*l+s;t[r+1]=f*a+e*v+h;r+=u;f=o[i.OX4];e=o[i.OY4];t[r]=f*c+e*l+s;t[r+1]=f*a+e*v+h},i.prototype.copy=function(){var t=new i(name);return t.region=this.region,t.rendererObject=this.rendererObject,t.path=this.path,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,n.Utils.arrayCopy(this.uvs,0,t.uvs,0,8),n.Utils.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t},i.OX1=0,i.OY1=1,i.OX2=2,i.OY2=3,i.OX3=4,i.OY3=5,i.OX4=6,i.OY4=7,i.X1=0,i.Y1=1,i.C1R=2,i.C1G=3,i.C1B=4,i.C1A=5,i.U1=6,i.V1=7,i.X2=8,i.Y2=9,i.C2R=10,i.C2G=11,i.C2B=12,i.C2A=13,i.U2=14,i.V2=15,i.X3=16,i.Y3=17,i.C3R=18,i.C3G=19,i.C3B=20,i.C3A=21,i.U3=22,i.V3=23,i.X4=24,i.Y4=25,i.C4R=26,i.C4G=27,i.C4B=28,i.C4A=29,i.U4=30,i.V4=31,i}(n.Attachment);n.RegionAttachment=t}(i||(i={})),function(n){var t=function(){function t(n,t){this.jitterX=0;this.jitterY=0;this.jitterX=n;this.jitterY=t}return t.prototype.begin=function(){},t.prototype.transform=function(t){t.x+=n.MathUtils.randomTriangular(-this.jitterX,this.jitterY);t.y+=n.MathUtils.randomTriangular(-this.jitterX,this.jitterY)},t.prototype.end=function(){},t}();n.JitterEffect=t}(i||(i={})),function(n){var t=function(){function t(n,t){this.centerX=0;this.centerY=0;this.radius=0;this.angle=0;this.worldX=0;this.worldY=0;this.radius=n;this.interpolation=t}return t.prototype.begin=function(n){this.worldX=n.x+this.centerX;this.worldY=n.y+this.centerY},t.prototype.transform=function(t){var s=this.angle*n.MathUtils.degreesToRadians,i=t.x-this.worldX,r=t.y-this.worldY,u=Math.sqrt(i*i+r*r);if(u<this.radius){var f=this.interpolation.apply(0,s,(this.radius-u)/this.radius),e=Math.cos(f),o=Math.sin(f);t.x=e*i-o*r+this.worldX;t.y=o*i+e*r+this.worldY}},t.prototype.end=function(){},t.interpolation=new n.PowOut(2),t}();n.SwirlEffect=t}(i||(i={}));t.exports=i},{}],362:[function(n,t){"use strict";var d,g,nt,ft,y,p,et=n("./track-entry-listeners"),h=n("./lib/spine"),i=[],w=[],b=0,e=0,r=0,tt=null,it=null,c=0,a=0,l=0,v=0,rt=null,ut=null,o=0,s=0,f=new h.Color(1,1,1,1),u=new h.Color(1,1,1,1),ot=[0,1,2,2,3,0],st=cc.Class({ctor:function(){this._privateMode=!1;this._inited=!1;this._invalid=!0;this._enableCacheAttachedInfo=!1;this.frames=[];this.totalTime=0;this._frameIdx=-1;this.isCompleted=!1;this._skeletonInfo=null;this._animationName=null;this._tempSegments=null;this._tempColors=null;this._tempBoneInfos=null},init:function(n,t){this._inited=!0;this._animationName=t;this._skeletonInfo=n},clear:function(){this._inited=!1;for(var n=0,t=this.frames.length;n<t;n++)this.frames[n].segments.length=0;this.invalidAllFrame()},bind:function(n){var t=function(n){n&&n.animation.name===this._animationName&&(this.isCompleted=!0)}.bind(this);n.complete=t},unbind:function(n){n.complete=null},begin:function(){var n,t;if(this._invalid){n=this._skeletonInfo;t=n.curAnimationCache;t&&t!==this&&(this._privateMode?t.invalidAllFrame():t.updateToFrame());var i=n.skeleton,r=n.listener,u=n.state,f=i.data.findAnimation(this._animationName);u.setAnimationWith(0,f,!1);this.bind(r);n.curAnimationCache=this;this._frameIdx=-1;this.isCompleted=!1;this.totalTime=0;this._invalid=!1}},end:function(){this._needToUpdate()||(this._skeletonInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0,this.unbind(this._skeletonInfo.listener))},_needToUpdate:function(n){return!this.isCompleted&&this.totalTime<30&&(null==n||this._frameIdx<n)},updateToFrame:function(n){if(this._inited&&(this.begin(),this._needToUpdate(n))){var i=this._skeletonInfo,t=i.skeleton,u=i.clipper,r=i.state;do t.update(1/60),r.update(1/60),r.apply(t),t.updateWorldTransform(),this._frameIdx++,this._updateFrame(t,u,this._frameIdx),this.totalTime+=1/60;while(this._needToUpdate(n));this.end()}},isInited:function(){return this._inited},isInvalid:function(){return this._invalid},invalidAllFrame:function(){this.isCompleted=!1;this._invalid=!0},updateAllFrame:function(){this.invalidAllFrame();this.updateToFrame()},enableCacheAttachedInfo:function(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())},_updateFrame:function(n,t,u){var nt,g,o,p,s,h,y,k;r=0;b=0;e=0;tt=null;it=null;c=0;a=0;l=0;v=0;rt=null;ut=null;this.frames[u]=this.frames[u]||{segments:[],colors:[],boneInfos:[],vertices:null,uintVert:null,indices:null};var f=this.frames[u],d=this._tempSegments=f.segments,ft=this._tempColors=f.colors,et=this._tempBoneInfos=f.boneInfos;if(this._traverseSkeleton(n,t),v>0&&(ft[v-1].vfOffset=r),ft.length=v,et.length=b,nt=l-1,nt>=0&&(a>0?(g=d[nt],g.indexCount=a,g.vfCount=6*c,g.vertexCount=c,d.length=l):d.length=l-1),0!=d.length){for(o=f.vertices,p=f.uintVert,(!o||o.length<r)&&(o=f.vertices=new Float32Array(r),p=f.uintVert=new Uint32Array(o.buffer)),s=0,h=0;s<r;)o[s++]=i[h++],o[s++]=i[h++],o[s++]=i[h++],o[s++]=i[h++],p[s++]=i[h++],p[s++]=i[h++];for(y=f.indices,(!y||y.length<e)&&(y=f.indices=new Uint16Array(e)),k=0;k<e;k++)y[k]=w[k];f.vertices=o;f.uintVert=p;f.indices=y}},fillVertices:function(n,t,h,c,l){var et,a,it,tt,st;if((ft=h.a*t.a*n.a*255,d=t.r*n.r*255,g=t.g*n.g*255,nt=t.b*n.b*255,f.r=d*h.r,f.g=g*h.g,f.b=nt*h.b,f.a=ft,null==l.darkColor?u.set(0,0,0,1):(u.r=l.darkColor.r*d,u.g=l.darkColor.g*g,u.b=l.darkColor.b*nt),u.a=0,y=(f.a<<24>>>0)+(f.b<<16)+(f.g<<8)+f.r,p=(u.a<<24>>>0)+(u.b<<16)+(u.g<<8)+u.r,rt!==y||ut!==p)&&(et=this._tempColors,rt=y,ut=p,v>0&&(et[v-1].vfOffset=r),et[v++]={fr:f.r,fg:f.g,fb:f.b,fa:f.a,dr:u.r,dg:u.g,db:u.b,da:u.a,vfOffset:0}),c.isClipping()){c.clipTriangles(i,o,w,s,i,f,u,!0,6,e,r,r+2);a=c.clippedVertices;it=c.clippedTriangles;s=it.length;o=a.length/2;for(var ot=0,ht=e,ct=it.length;ot<ct;)w[ht++]=it[ot++];for(var k=0,lt=a.length,b=r;k<lt;k+=12,b+=6)i[b]=a[k],i[b+1]=a[k+1],i[b+2]=a[k+6],i[b+3]=a[k+7],i[b+4]=y,i[b+5]=p}else for(tt=r,st=r+o;tt<st;tt+=6)i[tt+4]=y,i[tt+5]=p},_traverseSkeleton:function(n,t){var u,lt,at,ft,p,et,st,k,vt,ht,d,f,yt=this._tempSegments,pt=this._tempBoneInfos,ni=n.color,wt=n.bones,g,bt,y,v,nt,kt,ut,gt;if(this._enableCacheAttachedInfo)for(g=0,bt=wt.length;g<bt;g++,b++)y=wt[g],v=pt[b],v||(v=pt[b]={}),v.a=y.a,v.b=y.b,v.c=y.c,v.d=y.d,v.worldX=y.worldX,v.worldY=y.worldY;for(nt=0,kt=n.drawOrder.length;nt<kt;nt++)if(f=n.drawOrder[nt],o=0,s=0,u=f.getAttachment())if(et=u instanceof h.RegionAttachment,st=u instanceof h.MeshAttachment,u instanceof h.ClippingAttachment)t.clipStart(f,u);else if(et||st)if(k=u.region.texture._texture)if(d=f.data.blendMode,tt===k.nativeUrl&&it===d||(tt=k.nativeUrl,it=d,(vt=l-1)>=0&&(a>0?((ht=yt[vt]).indexCount=a,ht.vertexCount=c,ht.vfCount=6*c):l--),yt[l]={tex:k,blendMode:d,indexCount:0,vertexCount:0,vfCount:0},l++,a=0,c=0),et?(p=ot,o=24,s=6,u.computeWorldVertices(f.bone,i,r,6)):st&&(p=u.triangles,o=6*(u.worldVerticesLength>>1),s=p.length,u.computeWorldVertices(f,0,u.worldVerticesLength,i,r,6)),0!=o&&0!=s){for(var dt=0,ti=e,ii=p.length;dt<ii;)w[ti++]=p[dt++];ft=u.uvs;for(var rt=r,ri=r+o,ct=0;rt<ri;rt+=6,ct+=2)i[rt+2]=ft[ct],i[rt+3]=ft[ct+1];if(lt=u.color,at=f.color,this.fillVertices(ni,lt,at,t,f),s>0){for(ut=e,gt=e+s;ut<gt;ut++)w[ut]+=c;e+=s;r+=o;a+=s;c+=o/6}t.clipEndWithSlot(f)}else t.clipEndWithSlot(f);else t.clipEndWithSlot(f);else t.clipEndWithSlot(f);else t.clipEndWithSlot(f);t.clipEnd()}}),k=cc.Class({ctor:function(){this._privateMode=!1;this._animationPool={};this._skeletonCache={}},enablePrivateMode:function(){this._privateMode=!0},clear:function(){this._animationPool={};this._skeletonCache={}},removeSkeleton:function(n){var u=this._skeletonCache[n],i,r,t;if(u){i=u.animationsCache;for(r in i)t=i[r],t&&(this._animationPool[n+"#"+r]=t,t.clear());delete this._skeletonCache[n]}},getSkeletonCache:function(n,t){var i=this._skeletonCache[n];if(!i){var r=new h.Skeleton(t),e=new h.SkeletonClipping,o=new h.AnimationStateData(r.data),u=new h.AnimationState(o),f=new et;u.addListener(f);this._skeletonCache[n]=i={skeleton:r,clipper:e,state:u,listener:f,animationsCache:{},curAnimationCache:null}}return i},getAnimationCache:function(n,t){var i=this._skeletonCache[n];return i?i.animationsCache[t]:null},invalidAnimationCache:function(n){var t=this._skeletonCache[n],i,r;if(t&&t.skeleton){i=t.animationsCache;for(r in i)i[r].invalidAllFrame()}},initAnimationCache:function(n,t){var r,u,f,i,e;return t?(r=this._skeletonCache[n],u=r&&r.skeleton,!u)?null:u.data.findAnimation(t)?(f=r.animationsCache,i=f[t],i||(e=n+"#"+t,(i=this._animationPool[e])?delete this._animationPool[e]:(i=new st)._privateMode=this._privateMode,i.init(r,t),f[t]=i),i):null:null},updateAnimationCache:function(n,t){var r,i,u,f;if(t){if(r=this.initAnimationCache(n,t),!r)return null;r.updateAllFrame()}else{if(i=this._skeletonCache[n],!i||!i.skeleton)return;u=i.animationsCache;for(f in u)u[f].updateAllFrame()}}});k.FrameTime=1/60;k.sharedCache=new k;t.exports=k},{"./lib/spine":361,"./track-entry-listeners":366}],363:[function(n,t){"use strict";var i=n("./skeleton-cache").sharedCache,r=cc.Class({name:"sp.SkeletonData","extends":cc.Asset,ctor:function(){this.reset()},properties:{_skeletonJson:null,skeletonJsonStr:{get:function(){return this._skeletonJson?JSON.stringify(this._skeletonJson):""}},skeletonJson:{get:function(){return this._skeletonJson},set:function(n){this.reset();this._skeletonJson="string"==typeof n?JSON.parse(n):n;!this._uuid&&n.skeleton&&(this._uuid=n.skeleton.hash)}},_atlasText:"",atlasText:{get:function(){return this._atlasText},set:function(n){this._atlasText=n;this.reset()}},textures:{"default":[],type:[cc.Texture2D]},textureNames:{"default":[],type:[cc.String]},scale:1,_nativeAsset:{get:function(){return this._buffer},set:function(n){this._buffer=n.buffer||n;this.reset()},override:!0}},statics:{preventDeferredLoadDependents:!0},createNode:!1,reset:function(){this._skeletonCache=null;this._atlasCache=null},ensureTexturesLoaded:function(n,t){var f=this.textures,i=f.length,u;if(0!=i)for(var o=0,e=function(){++o>=i&&(n&&n.call(t,!0),n=null)},r=0;r<i;r++)u=f[r],u.loaded?e():u.once("load",e);else n.call(t,!1)},isTexturesLoaded:function(){for(var t=this.textures,i=t.length,n=0;n<i;n++)if(!t[n].loaded)return!1;return!0},getRuntimeData:function(n){var t;if(this._skeletonCache)return this._skeletonCache;if(!(this.textures&&this.textures.length>0)&&this.textureNames&&this.textureNames.length>0)return n||cc.errorID(7507,this.name),null;if(t=this._getAtlas(n),!t)return null;var u=new sp.spine.AtlasAttachmentLoader(t),r=null,i=null;return this.skeletonJson?(i=new sp.spine.SkeletonJson(u),r=this.skeletonJson):(i=new sp.spine.SkeletonBinary(u),r=new Uint8Array(this._nativeAsset)),i.scale=this.scale,this._skeletonCache=i.readSkeletonData(r),t.dispose(),this._skeletonCache},getSkinsEnum:!1,getAnimsEnum:!1,_getTexture:function(n){for(var i,u,r=this.textureNames,t=0;t<r.length;t++)if(r[t]===n)return i=this.textures[t],u=new sp.SkeletonTexture({width:i.width,height:i.height}),u.setRealTexture(i),u;return cc.errorID(7506,n),null},_getAtlas:function(n){return this._atlasCache?this._atlasCache:this.atlasText?this._atlasCache=new sp.spine.TextureAtlas(this.atlasText,this._getTexture.bind(this)):(n||cc.errorID(7508,this.name),null)},destroy:function(){i.removeSkeleton(this._uuid);this._super()}});sp.SkeletonData=t.exports=r},{"./skeleton-cache":362}],364:[function(){"use strict";sp.SkeletonTexture=cc.Class({name:"sp.SkeletonTexture","extends":sp.spine.Texture,_texture:null,_material:null,setRealTexture:function(n){this._texture=n},getRealTexture:function(){return this._texture},setFilters:function(n,t){this._texture&&this._texture.setFilters(n,t)},setWraps:function(n,t){this._texture&&this._texture.setWrapMode(n,t)},dispose:function(){}})},{}],365:[function(n,t,i){"use strict";function er(n,t){var r,u,s,f;switch(t){case v.BlendMode.Additive:r=k?cc.macro.ONE:cc.macro.SRC_ALPHA;u=cc.macro.ONE;break;case v.BlendMode.Multiply:r=cc.macro.DST_COLOR;u=cc.macro.ONE_MINUS_SRC_ALPHA;break;case v.BlendMode.Screen:r=cc.macro.ONE;u=cc.macro.ONE_MINUS_SRC_COLOR;break;case v.BlendMode.Normal:default:r=k?cc.macro.ONE:cc.macro.SRC_ALPHA;u=cc.macro.ONE_MINUS_SRC_ALPHA}if(s=!o.enableBatch,f=o._materials[0],!f)return null;var h=n.getId()+r+u+c+s,e=o._materialCache,i=e[h];return i||(e.baseMaterial?i=cc.MaterialVariant.create(f):(i=f,e.baseMaterial=f),i.define("CC_USE_MODEL",s),i.define("USE_TINT",c),i.setProperty("texture",n),i.setBlend(!0,di.BLEND_FUNC_ADD,r,u,di.BLEND_FUNC_ADD,r,u),e[h]=i),i}function or(n){ai=n.fa*fi;hi=ii*(d=k?ai/255:1);ci=ri*d;li=ui*d;nr=n.fr*hi;tr=n.fg*ci;ir=n.fb*li;tt=(ai<<24>>>0)+(ir<<16)+(tr<<8)+nr;rr=n.dr*hi;ur=n.dg*ci;fr=n.db*li;it=((k?255:0)<<24>>>0)+(fr<<16)+(ur<<8)+rr}function et(n){return(n.a<<24>>>0)+(n.b<<16)+(n.g<<8)+n.r}var pi;i.__esModule=!0;i.default=void 0;var pt,k,d,wt,dt,c,gt,ni,ti,ii,ri,ui,fi,tt,it,wi,f,bt,bi=(pt=n("../../cocos2d/core/renderer/assembler"))&&pt.__esModule?pt:{"default":pt},sr=n("./Skeleton"),v=n("./lib/spine"),hr=n("../../cocos2d/core/renderer/render-flow"),ki=n("../../cocos2d/core/renderer/webgl/vertex-format"),cr=ki.vfmtPosUvColor,lr=ki.vfmtPosUvTwoColor,di=cc.gfx,kt=0,ar=[0,1,2,2,3,0],gi=cc.color(0,0,255,255),vr=cc.color(255,0,0,255),yr=cc.color(0,255,0,255),pr=cc.color(255,255,0,255),l=null,h=null,y=null,p=null;l=new v.Color(1,1,1,1);h=new v.Color(1,1,1,1);y=new v.Vector2;p=new v.Vector2;var ei,oi,si,ot,rt,ut,ft,st,ht,ct,lt,at,vt,hi,ci,li,nr,tr,ir,ai,rr,ur,fr,o,u,w,yt,vi,b,s=0,yi=0,r=0,nt=0,e=0,a=0,g=0;pi=function(n){function hi(){return n.apply(this,arguments)||this}var i,pt,t;return pt=n,(i=hi).prototype=Object.create(pt.prototype),i.prototype.constructor=i,i.__proto__=pt,t=hi.prototype,t.updateRenderData=function(n){if(!n.isAnimationCached()){var t=n._skeleton;t&&t.updateWorldTransform()}},t.fillVertices=function(n,t,i,o,v){var lt,g=u._vData,at=u._iData,ot=u._uintVData,yt,w,vt,ft,pt,ct,wt;if(l.a=i.a*t.a*n.a*fi*255,d=k?l.a:255,ei=ii*t.r*n.r*d,oi=ri*t.g*n.g*d,si=ui*t.b*n.b*d,l.r=ei*i.r,l.g=oi*i.g,l.b=si*i.b,null==v.darkColor?h.set(0,0,0,1):(h.r=v.darkColor.r*ei,h.g=v.darkColor.g*oi,h.b=v.darkColor.b*si),h.a=k?255:0,o.isClipping())if(yt=g.subarray(r+2),o.clipTriangles(g.subarray(r),s,at.subarray(a),e,yt,l,h,c,f),w=new Float32Array(o.clippedVertices),vt=o.clippedTriangles,e=vt.length,s=w.length/bt*f,lt=u.request(s/f,e),a=lt.indiceOffset,nt=lt.vertexOffset,r=lt.byteOffset>>2,g=u._vData,at=u._iData,ot=u._uintVData,at.set(vt,a),b)for(var rt=0,kt=w.length,st=r;rt<kt;rt+=bt,st+=f)y.x=w[rt],y.y=w[rt+1],l.set(w[rt+2],w[rt+3],w[rt+4],w[rt+5]),p.x=w[rt+6],p.y=w[rt+7],c?h.set(w[rt+8],w[rt+9],w[rt+10],w[rt+11]):h.set(0,0,0,0),b.transform(y,p,l,h),g[st]=y.x,g[st+1]=y.y,g[st+2]=p.x,g[st+3]=p.y,ot[st+4]=et(l),c&&(ot[st+5]=et(h));else for(var ut=0,dt=w.length,ht=r;ut<dt;ut+=bt,ht+=f)g[ht]=w[ut],g[ht+1]=w[ut+1],g[ht+2]=w[ut+6],g[ht+3]=w[ut+7],tt=(w[ut+5]<<24>>>0)+(w[ut+4]<<16)+(w[ut+3]<<8)+w[ut+2],ot[ht+4]=tt,c&&(it=(w[ut+11]<<24>>>0)+(w[ut+10]<<16)+(w[ut+9]<<8)+w[ut+8],ot[ht+5]=it);else if(b)for(ft=r,pt=r+s;ft<pt;ft+=f)y.x=g[ft],y.y=g[ft+1],p.x=g[ft+2],p.y=g[ft+3],b.transform(y,p,l,h),g[ft]=y.x,g[ft+1]=y.y,g[ft+2]=p.x,g[ft+3]=p.y,ot[ft+4]=et(l),c&&(ot[ft+5]=et(h));else for(tt=et(l),it=et(h),ct=r,wt=r+s;ct<wt;ct+=f)ot[ct+4]=tt,c&&(ot[ct+5]=it)},t.realTimeTraverse=function(n){var i,it,l,ci,li,fi,b,ei,oi,k,h,d,et=o._skeleton,rr=et.color,t=o._debugRenderer,p=o._clipper,si=null,ii,ai,pt,vi,tt,yi,ui,ki,g,di,y,kt,nr,tr,ir;for(wt=o._startSlotIndex,dt=o._endSlotIndex,ot=!1,-1==wt&&(ot=!0),gt=o.debugSlots,ni=o.debugBones,ti=o.debugMesh,t&&(ni||gt||ti)&&(t.clear(),t.lineWidth=2),bt=c?12:8,s=0,r=0,nt=0,e=0,a=0,ii=0,ai=et.drawOrder.length;ii<ai;ii++)if(null!=(h=et.drawOrder[ii]))if(wt>=0&&wt==h.data.index&&(ot=!0),ot)if(dt>=0&&dt==h.data.index&&(ot=!1),s=0,e=0,l=h.getAttachment())if(ei=l instanceof v.RegionAttachment,oi=l instanceof v.MeshAttachment,l instanceof v.ClippingAttachment)p.clipStart(h,l);else if(ei||oi)if(si=er(l.region.texture._texture,h.data.blendMode)){if((rt||si.getHash()!==w.material.getHash())&&(rt=!1,w._flush(),w.node=yt,w.material=si),ei){if(b=ar,s=4*f,e=6,k=u.request(4,6),a=k.indiceOffset,nt=k.vertexOffset,r=k.byteOffset>>2,i=u._vData,it=u._iData,l.computeWorldVertices(h.bone,i,r,f),t&&gt){for(t.strokeColor=gi,t.moveTo(i[r],i[r+1]),pt=r+f,vi=r+s;pt<vi;pt+=f)t.lineTo(i[pt],i[pt+1]);t.close();t.stroke()}}else if(oi&&(b=l.triangles,s=(l.worldVerticesLength>>1)*f,e=b.length,k=u.request(s/f,e),a=k.indiceOffset,nt=k.vertexOffset,r=k.byteOffset>>2,i=u._vData,it=u._iData,l.computeWorldVertices(h,0,l.worldVerticesLength,i,r,f),t&&ti))for(t.strokeColor=pr,tt=0,yi=b.length;tt<yi;tt+=3){var pi=b[tt]*f+r,wi=b[tt+1]*f+r,bi=b[tt+2]*f+r;t.moveTo(i[pi],i[pi+1]);t.lineTo(i[wi],i[wi+1]);t.lineTo(i[bi],i[bi+1]);t.close();t.stroke()}if(0!=s&&0!=e){it.set(b,a);fi=l.uvs;for(var ri=r,ur=r+s,hi=0;ri<ur;ri+=f,hi+=2)i[ri+2]=fi[hi],i[ri+3]=fi[hi+1];if(ci=l.color,li=h.color,this.fillVertices(rr,ci,li,p,h),i=u._vData,it=u._iData,e>0){for(ui=a,ki=a+e;ui<ki;ui++)it[ui]+=nt;if(n)for(d=n.m,st=d[0],ht=d[4],ct=d[12],lt=d[1],at=d[5],vt=d[13],g=r,di=r+s;g<di;g+=f)ut=i[g],ft=i[g+1],i[g]=ut*st+ft*ht+ct,i[g+1]=ut*lt+ft*at+vt;u.adjust(s/f,e)}p.clipEndWithSlot(h)}else p.clipEndWithSlot(h)}else p.clipEndWithSlot(h);else p.clipEndWithSlot(h);else p.clipEndWithSlot(h);else p.clipEndWithSlot(h);if(p.clipEnd(),t&&ni)for(t.strokeColor=vr,t.fillColor=gi,kt=0,nr=et.bones.length;kt<nr;kt++)tr=(y=et.bones[kt]).data.length*y.a+y.worldX,ir=y.data.length*y.c+y.worldY,t.moveTo(y.worldX,y.worldY),t.lineTo(tr,ir),t.stroke(),t.circle(y.worldX,y.worldY,1.5*Math.PI),t.fill(),0===kt&&(t.fillColor=yr)},t.cacheTraverse=function(n){var h=o._curFrame,l,b,ni,s,k,ti,c,ii,f,ri;if(h&&(l=h.segments,0!=l.length)){var t,pt,et,ot,v,i,fi=h.vertices,ei=h.indices,y=0,oi=0,r=0;n&&(i=n.m,st=i[0],lt=i[1],ht=i[4],at=i[5],ct=i[12],vt=i[13]);var wt=16&kt,si=wt&&1===st&&0===lt&&0===ht&&1===at,bt=0,dt=h.colors,p=dt[bt++],gt=p.vfOffset;for(or(p),b=0,ni=l.length;b<ni;b++)if(s=l[b],ot=er(s.tex,s.blendMode)){for((rt||ot.getHash()!==w.material.getHash())&&(rt=!1,w._flush(),w.node=yt,w.material=ot),yi=s.vertexCount,e=s.indexCount,v=u.request(yi,e),a=v.indiceOffset,nt=v.vertexOffset,g=v.byteOffset>>2,t=u._vData,pt=u._iData,et=u._uintVData,k=a,ti=a+e;k<ti;k++)pt[k]=nt+ei[oi++];if(r=s.vfCount,t.set(fi.subarray(y,y+r),g),y+=r,si)for(c=g,ii=g+r;c<ii;c+=6)t[c]+=ct,t[c+1]+=vt;else if(wt)for(f=g,ri=g+r;f<ri;f+=6)ut=t[f],ft=t[f+1],t[f]=ut*st+ft*ht+ct,t[f+1]=ut*lt+ft*at+vt;if(u.adjust(yi,e),vi)for(var ui=y-r,d=g+4,hi=g+4+r;d<hi;d+=6,ui+=6)ui>=gt&&(or(p=dt[bt++]),gt=p.vfOffset),et[d]=tt,et[d+1]=it}}},t.fillBuffers=function(n,t){var e=n.node,i,r;(e._renderFlag|=hr.FLAG_UPDATE_RENDER_DATA,n._skeleton)&&(i=e._color,ii=i.r/255,ri=i.g/255,ui=i.b/255,fi=i.a/255,c=n.useTint||n.isAnimationCached(),wi=c?lr:cr,f=c?6:5,yt=n.node,u=t.getBuffer("spine",wi),w=t,o=n,rt=!0,k=n.premultipliedAlpha,d=1,kt=0,vi=!1,b=n._effectDelegate&&n._effectDelegate._vertexEffect,(4294967295!==i._val||k)&&(vi=!0),c&&(kt|=1),r=void 0,o.enableBatch&&(r=yt._worldMatrix,rt=!1,kt|=16),n.isAnimationCached()?this.cacheTraverse(r):(b&&b.begin(n._skeleton),this.realTimeTraverse(r),b&&b.end()),t.worldMatDirty++,n.attachUtil._syncAttachedNode(),yt=void 0,u=void 0,w=void 0,o=void 0,b=null)},t.postFillBuffers=function(n,t){t.worldMatDirty--},hi}(bi.default);i.default=pi;bi.default.register(sr,pi);t.exports=i.default},{"../../cocos2d/core/renderer/assembler":223,"../../cocos2d/core/renderer/render-flow":227,"../../cocos2d/core/renderer/webgl/vertex-format":258,"./Skeleton":359,"./lib/spine":361}],366:[function(n,t){"use strict";var i=function(){this.start=null;this.end=null;this.complete=null;this.event=null;this.interrupt=null;this.dispose=null};i.getListeners=function(n){return n.listener||(n.listener=new i),n.listener};t.exports=i},{}],367:[function(n,t){"use strict";var i=n("./lib/spine");sp.VertexEffectDelegate=cc.Class({name:"sp.VertexEffectDelegate",ctor:function(){this._vertexEffect=null;this._interpolation=null;this._effectType="none"},clear:function(){this._vertexEffect=null;this._interpolation=null;this._effectType="none"},initJitter:function(n,t){return this._effectType="jitter",this._vertexEffect=new i.JitterEffect(n,t),this._vertexEffect},initSwirlWithPow:function(n,t){return this._interpolation=new i.Pow(t),this._vertexEffect=new i.SwirlEffect(n,this._interpolation),this._vertexEffect},initSwirlWithPowOut:function(n,t){return this._interpolation=new i.PowOut(t),this._vertexEffect=new i.SwirlEffect(n,this._interpolation),this._vertexEffect},getJitterVertexEffect:function(){return this._vertexEffect},getSwirlVertexEffect:function(){return this._vertexEffect},getVertexEffect:function(){return this._vertexEffect},getEffectType:function(){return this._effectType}});t.exports=sp.VertexEffectDelegate},{"./lib/spine":361}],368:[function(n,t,i){"use strict";var r;r=function(n){function u(n,t){return void 0!==n?n:t}function k(n,t){for(var r=[],i=0;i<n;++i)r.push(t(i));return r}function lt(n,t){void 0===t&&(t=0);for(var i=[],r=0;r<n;++r)i.push(t);return i}function y(n,t,i){return n<t?t:n>i?i:n}function hi(n){return n*n}function lr(n){return 1/Math.sqrt(n)}function br(u,e,o){var h,y,c,it,w,b,k,rt;++n.b2_gjkCalls;var l=o.proxyA,a=o.proxyB,d=o.transformA,g=o.transformB,s=gs;s.ReadCache(e,l,d,a,g);for(var nt=s.m_vertices,ut=nh,ft=th,tt=0,v=0;v<20;){for(tt=s.m_count,h=0;h<tt;++h)ut[h]=nt[h].indexA,ft[h]=nt[h].indexB;switch(s.m_count){case 2:s.Solve2();break;case 3:s.Solve3()}if(3===s.m_count)break;if(y=s.GetSearchDirection(rh),y.LengthSquared()<cr)break;for(c=nt[s.m_count],c.indexA=l.GetSupport(i.MulTRV(d.q,t.NegV(y,t.s_t0),fh)),r.MulXV(d,l.GetVertex(c.indexA),c.wA),c.indexB=a.GetSupport(i.MulTRV(g.q,y,eh)),r.MulXV(g,a.GetVertex(c.indexB),c.wB),t.SubVV(c.wB,c.wA,c.w),++v,++n.b2_gjkIters,it=!1,h=0;h<tt;++h)if(c.indexA===ut[h]&&c.indexB===ft[h]){it=!0;break}if(it)break;++s.m_count}(n.b2_gjkMaxIters=f(n.b2_gjkMaxIters,v),s.GetWitnessPoints(u.pointA,u.pointB),u.distance=t.DistanceVV(u.pointA,u.pointB),u.iterations=v,s.WriteCache(e),o.useRadii)&&(w=l.m_radius,b=a.m_radius,u.distance>w+b&&u.distance>p?(u.distance-=w+b,k=t.SubVV(u.pointB,u.pointA,uh),k.Normalize(),u.pointA.SelfMulAdd(w,k),u.pointB.SelfMulSub(b,k)):(rt=t.MidVV(u.pointA,u.pointB,ih),u.pointA.Copy(rt),u.pointB.Copy(rt),u.distance=0))}function gr(n,t){var i=t.lowerBound.x-n.upperBound.x,r=t.lowerBound.y-n.upperBound.y,u=n.lowerBound.x-t.upperBound.x,f=n.lowerBound.y-t.upperBound.y;return!(i>0||r>0||u>0||f>0)}function pi(i,r,u,f,e){var s=0,o=r[0],c=r[1],l=t.DotVV(u,o.v)-f,a=t.DotVV(u,c.v)-f,v,y,h;return(l<=0&&i[s++].Copy(o),a<=0&&i[s++].Copy(c),l*a<0)&&(v=l/(l-a),y=i[s].v,y.x=o.v.x+v*(c.v.x-o.v.x),y.y=o.v.y+v*(c.v.y-o.v.y),h=i[s].id,h.cf.indexA=e,h.cf.indexB=o.id.cf.indexB,h.cf.typeA=n.b2ContactFeatureType.e_vertex,h.cf.typeB=n.b2ContactFeatureType.e_face,++s),s}function nu(n,t,i,r,u,f){var e=vh.Reset(),o,s;return e.proxyA.SetShape(n,t),e.proxyB.SetShape(i,r),e.transformA.Copy(u),e.transformB.Copy(f),e.useRadii=!0,o=yh.Reset(),o.count=0,s=ph.Reset(),br(s,o,e),s.distance<10*p}function a(n){if(null===n)throw new Error;return n}function gf(n,t){return n.proxyA.m_id===t.proxyA.m_id?n.proxyB.m_id-t.proxyB.m_id:n.proxyA.m_id-t.proxyA.m_id}function iu(t,i){var vt=wh.Reset(),e,rt,ut,y,c,h,a,v,st;++n.b2_toiCalls;t.state=n.b2TOIOutputState.e_unknown;t.t=i.tMax;var ht=i.proxyA,lt=i.proxyB,g=ic.Copy(i.sweepA),nt=rc.Copy(i.sweepB);g.Normalize();nt.Normalize();var at=i.tMax,yt=ht.m_radius+lt.m_radius,u=f(s,yt-3*s),o=.25*s,r=0,tt=0,it=bh;for(it.count=0,e=kh,e.proxyA.Copy(i.proxyA),e.proxyB.Copy(i.proxyB),e.useRadii=!1;;){if(rt=tr,ut=ir,g.GetTransform(rt,r),nt.GetTransform(ut,r),e.transformA.Copy(rt),e.transformB.Copy(ut),y=dh,br(y,it,e),y.distance<=0){t.state=n.b2TOIOutputState.e_overlapped;t.t=0;break}if(y.distance<u+o){t.state=n.b2TOIOutputState.e_touching;t.t=r;break}c=gh;c.Initialize(it,ht,g,lt,nt,r);for(var p=!1,w=at,pt=0;;){var ft=nc,et=tc,b=c.FindMinSeparation(ft,et,w);if(b>u+o){t.state=n.b2TOIOutputState.e_separated;t.t=at;p=!0;break}if(b>u-o){r=w;break}if(h=c.Evaluate(ft[0],et[0],r),h<u-o){t.state=n.b2TOIOutputState.e_failed;t.t=r;p=!0;break}if(h<=u+o){t.state=n.b2TOIOutputState.e_touching;t.t=r;p=!0;break}for(var k=0,d=r,ot=w;;){if(a=1&k?d+(u-h)*(ot-d)/(b-h):.5*(d+ot),++k,++n.b2_toiRootIters,v=c.Evaluate(ft[0],et[0],a),l(v-u)<o){w=a;break}if(v>u?(d=a,h=v):(ot=a,b=v),50===k)break}if(n.b2_toiMaxRootIters=f(n.b2_toiMaxRootIters,k),++pt===ct)break}if(++tt,++n.b2_toiIters,p)break;if(20===tt){t.state=n.b2TOIOutputState.e_failed;t.t=r;break}}n.b2_toiMaxIters=f(n.b2_toiMaxIters,tt);st=vt.GetMilliseconds();n.b2_toiMaxTime=f(n.b2_toiMaxTime,st);n.b2_toiTime+=st}function fe(i,u,f,e,o){i.pointCount=0;var h=r.MulXV(f,u.m_p,re),c=r.MulXV(o,e.m_p,ue),l=t.DistanceSquaredVV(h,c),s=u.m_radius+e.m_radius;l>s*s||(i.type=n.b2ManifoldType.e_circles,i.localPoint.Copy(u.m_p),i.localNormal.SetZero(),i.pointCount=1,i.points[0].localPoint.Copy(e.m_p),i.points[0].id.key=0)}function ee(i,u,f,e,o){var w,it,rt,nt;i.pointCount=0;for(var ut=r.MulXV(o,e.m_p,uc),s=r.MulTXV(f,ut,fc),k=0,d=-c,a=u.m_radius+e.m_radius,tt=u.m_count,g=u.m_vertices,y=u.m_normals,v=0;v<tt;++v){if(w=t.DotVV(y[v],t.SubVV(s,g[v],t.s_t0)),w>a)return;w>d&&(d=w,k=v)}var b=k,ft=(b+1)%tt,h=g[b],l=g[ft];if(d<p)return i.pointCount=1,i.type=n.b2ManifoldType.e_faceA,i.localNormal.Copy(y[k]),t.MidVV(h,l,i.localPoint),i.points[0].localPoint.Copy(e.m_p),void(i.points[0].id.key=0);if(it=t.DotVV(t.SubVV(s,h,t.s_t0),t.SubVV(l,h,t.s_t1)),rt=t.DotVV(t.SubVV(s,l,t.s_t0),t.SubVV(h,l,t.s_t1)),it<=0){if(t.DistanceSquaredVV(s,h)>a*a)return;i.pointCount=1;i.type=n.b2ManifoldType.e_faceA;t.SubVV(s,h,i.localNormal).SelfNormalize();i.localPoint.Copy(h);i.points[0].localPoint.Copy(e.m_p);i.points[0].id.key=0}else if(rt<=0){if(t.DistanceSquaredVV(s,l)>a*a)return;i.pointCount=1;i.type=n.b2ManifoldType.e_faceA;t.SubVV(s,l,i.localNormal).SelfNormalize();i.localPoint.Copy(l);i.points[0].localPoint.Copy(e.m_p);i.points[0].id.key=0}else{if(nt=t.MidVV(h,l,ec),t.DotVV(t.SubVV(s,nt,t.s_t1),y[b])>a)return;i.pointCount=1;i.type=n.b2ManifoldType.e_faceA;i.localNormal.Copy(y[b]).SelfNormalize();i.localPoint.Copy(nt);i.points[0].localPoint.Copy(e.m_p);i.points[0].id.key=0}}function ur(n,u,f,e,o){for(var h,p,w,b=n.m_vertices,k=n.m_normals,d=e.m_count,l=e.m_vertices,a=i.MulRV(u.q,k[f],oc),g=i.MulTRV(o.q,a,sc),v=0,y=c,s=0;s<d;++s)h=t.DotVV(l[s],g),h<y&&(y=h,v=s);return p=r.MulXV(u,b[f],hc),w=r.MulXV(o,l[v],cc),t.DotVV(t.SubVV(w,p,t.s_t0),a)}function he(n,u,f,e,o){for(var p,s=u.m_count,tt=u.m_normals,it=t.SubVV(r.MulXV(o,e.m_centroid,t.s_t0),r.MulXV(f,u.m_centroid,t.s_t1),oe),rt=i.MulTRV(f.q,it,se),h=0,d=-c,y=0;y<s;++y)p=t.DotVV(tt[y],rt),p>d&&(d=p,h=y);var a=ur(u,f,h,e,o),g=(h+s-1)%s,w=ur(u,f,g,e,o),nt=(h+1)%s,b=ur(u,f,nt,e,o),l=0,v=0,k=0;if(w>a&&w>b)k=-1,l=g,v=w;else{if(!(b>a))return n[0]=h,a;k=1;l=nt;v=b}for(;(a=ur(u,f,h=-1===k?(l+s-1)%s:(l+1)%s,e,o))>v;)l=h,v=a;return n[0]=l,v}function lc(u,f,e,o,s,h){for(var y,l,w,a,it=f.m_normals,b=s.m_count,k=s.m_vertices,rt=s.m_normals,ut=i.MulTRV(h.q,i.MulRV(e.q,it[o],t.s_t0),ce),d=0,g=c,v=0;v<b;++v)y=t.DotVV(ut,rt[v]),y<g&&(g=y,d=v);var p=d,nt=(p+1)%b,tt=u[0];r.MulXV(h,k[p],tt.v);l=tt.id.cf;l.indexA=o;l.indexB=p;l.typeA=n.b2ContactFeatureType.e_face;l.typeB=n.b2ContactFeatureType.e_vertex;w=u[1];r.MulXV(h,k[nt],w.v);a=w.id.cf;a.indexA=o;a.indexB=nt;a.typeA=n.b2ContactFeatureType.e_face;a.typeB=n.b2ContactFeatureType.e_vertex}function le(u,f,e,o,s){var c,w,rt,b,ut,v,ft,l,k,a,g,et,nt,tt,it,h,p;if(u.pointCount=0,c=f.m_radius+o.m_radius,w=pc,w[0]=0,rt=he(w,f,e,o,s),!(rt>c)&&(b=wc,b[0]=0,ut=he(b,o,s,f,e),!(ut>c))){a=0;g=0;ut>.98*rt+.001?(v=o,ft=f,l=s,k=e,a=b[0],u.type=n.b2ManifoldType.e_faceB,g=1):(v=f,ft=o,l=e,k=s,a=w[0],u.type=n.b2ManifoldType.e_faceA,g=0);et=ac;lc(et,v,l,a,ft,k);var bt=v.m_count,ct=v.m_vertices,lt=a,at=(a+1)%bt,ot=ct[lt],st=ct[at],ht=t.SubVV(st,ot,bc);ht.Normalize();var kt=t.CrossVOne(ht,kc),dt=t.MidVV(ot,st,dc),y=i.MulRV(l.q,ht,nl),vt=t.CrossVOne(y,gc),yt=r.MulXV(l,ot,il),gt=r.MulXV(l,st,rl),ni=t.DotVV(vt,yt),ti=-t.DotVV(y,yt)+c,ii=t.DotVV(y,gt)+c,pt=vc,wt=yc;if(!(pi(pt,et,t.NegV(y,tl),ti,lt)<2||pi(wt,pt,y,ii,at)<2)){for(u.localNormal.Copy(kt),u.localPoint.Copy(dt),nt=0,tt=0;tt<d;++tt)it=wt[tt],t.DotVV(vt,it.v)-ni<=c&&(h=u.points[nt],(r.MulTXV(k,it.v,h.localPoint),h.id.Copy(it.id),g)&&(p=h.id.cf,h.id.cf.indexA=p.indexB,h.id.cf.indexB=p.indexA,h.id.cf.typeA=p.typeB,h.id.cf.typeB=p.typeA),++nt);u.pointCount=nt}}}function uu(i,u,f,e,o){var k,d,g,nt,tt,p,it,l;i.pointCount=0;var h=r.MulTXV(f,r.MulXV(o,e.m_p,t.s_t0),ul),c=u.m_vertex1,a=u.m_vertex2,v=t.SubVV(a,c,fl),w=t.DotVV(v,t.SubVV(a,h,t.s_t0)),b=t.DotVV(v,t.SubVV(h,c,t.s_t0)),y=u.m_radius+e.m_radius,s=cl;if(s.cf.indexB=0,s.cf.typeB=n.b2ContactFeatureType.e_vertex,b<=0){if(k=c,d=t.SubVV(h,k,ru),t.DotVV(d,d)>y*y)return;if(u.m_hasVertex0){var ft=u.m_vertex0,rt=c,et=t.SubVV(rt,ft,el);if(t.DotVV(et,t.SubVV(rt,h,t.s_t0))>0)return}return s.cf.indexA=0,s.cf.typeA=n.b2ContactFeatureType.e_vertex,i.pointCount=1,i.type=n.b2ManifoldType.e_circles,i.localNormal.SetZero(),i.localPoint.Copy(k),i.points[0].id.Copy(s),void i.points[0].localPoint.Copy(e.m_p)}if(w<=0){if(g=a,nt=t.SubVV(h,g,ru),t.DotVV(nt,nt)>y*y)return;if(u.m_hasVertex3){var ot=u.m_vertex3,ut=a,st=t.SubVV(ot,ut,ol);if(t.DotVV(st,t.SubVV(h,ut,t.s_t0))>0)return}return s.cf.indexA=1,s.cf.typeA=n.b2ContactFeatureType.e_vertex,i.pointCount=1,i.type=n.b2ManifoldType.e_circles,i.localNormal.SetZero(),i.localPoint.Copy(g),i.points[0].id.Copy(s),void i.points[0].localPoint.Copy(e.m_p)}tt=t.DotVV(v,v);p=sl;p.x=1/tt*(w*c.x+b*a.x);p.y=1/tt*(w*c.y+b*a.y);it=t.SubVV(h,p,ru);t.DotVV(it,it)>y*y||(l=hl.Set(-v.y,v.x),t.DotVV(l,t.SubVV(h,c,t.s_t0))<0&&l.Set(-l.x,-l.y),l.Normalize(),s.cf.indexA=0,s.cf.typeA=n.b2ContactFeatureType.e_face,i.pointCount=1,i.type=n.b2ManifoldType.e_faceA,i.localNormal.Copy(l),i.localPoint.Copy(c),i.points[0].id.Copy(s),i.points[0].localPoint.Copy(e.m_p))}function fu(n,t,i,r,u){vl.Collide(n,t,i,r,u)}function e(n,t){function i(){this.constructor=n}ve(n,t);n.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}function hu(n,t){return at(n*t)}function cu(n,t){return n>t?n:t}function go(n,t,i){return y(Math.ceil(Math.sqrt(n/(.01*t))*i),1,8)}function or(n,t,i){var r=n[t];n[t]=n[i];n[i]=r}function sr(n,t){return n<t}function hr(n,t,i,r){var o,f;void 0===t&&(t=0);void 0===i&&(i=n.length-t);void 0===r&&(r=sr);for(var u=t,s=[],e=0;;){for(;u+1<i;i++)for(o=n[u+Math.floor(Math.random()*(i-u))],s[e++]=i,f=u-1;;){for(;r(n[++f],o););for(;r(o,n[--i]););if(f>=i)break;or(n,f,i)}if(0===e)break;u=i;i=s[--e]}return n}function is(n,t,i,r){return void 0===t&&(t=0),void 0===i&&(i=n.length-t),void 0===r&&(r=sr),hr(n,t,i,r)}function rs(n,t,i){void 0===i&&(i=n.length);for(var u=0,r=0;r<i;++r)t(n[r])||(r!==u?or(n,u++,r):++u);return u}function us(n,t,i,r,u){var f,e,o;for(void 0===u&&(u=sr),f=i-t;f>0;)e=Math.floor(f/2),o=t+e,u(n[o],r)?(t=++o,f-=e+1):f=e;return t}function fs(n,t,i,r,u){var f,e,o;for(void 0===u&&(u=sr),f=i-t;f>0;)e=Math.floor(f/2),o=t+e,u(r,n[o])?f=e:(t=++o,f-=e+1);return t}function rt(n,t,i,r){for(var u=i;t!==u;)or(n,t++,u++),u===r?u=i:t===i&&(i=u)}function la(n,t,i,r){if(t===i)return i;for(var u=t;++t!==i;)r(n[u],n[t])||or(n,++u,t);return++u}var c=1e37,p=1e-5,cr=p*p,ut=3.14159265359,d=2,ct=8,s=.008,yt=2/180*ut,bt=2*s,tt=-1,sf=function(){function n(n,t,i){void 0===n&&(n=0);void 0===t&&(t=0);void 0===i&&(i=0);this.major=0;this.minor=0;this.revision=0;this.major=n;this.minor=t;this.revision=i}return n.prototype.toString=function(){return this.major+"."+this.minor+"."+this.revision},n}(),as=new sf(2,3,2),l=Math.abs,o=Math.min,f=Math.max,vs=isFinite,w,at=Math.sqrt,hf=Math.pow,ys=Math.cos,ps=Math.sin,ws=Math.acos,cf=Math.asin,ar=Math.atan2,t=function(){function n(n,t){void 0===n&&(n=0);void 0===t&&(t=0);this.x=n;this.y=t}return n.prototype.Clone=function(){return new n(this.x,this.y)},n.prototype.SetZero=function(){return this.x=0,this.y=0,this},n.prototype.Set=function(n,t){return this.x=n,this.y=t,this},n.prototype.Copy=function(n){return this.x=n.x,this.y=n.y,this},n.prototype.SelfAdd=function(n){return this.x+=n.x,this.y+=n.y,this},n.prototype.SelfAddXY=function(n,t){return this.x+=n,this.y+=t,this},n.prototype.SelfSub=function(n){return this.x-=n.x,this.y-=n.y,this},n.prototype.SelfSubXY=function(n,t){return this.x-=n,this.y-=t,this},n.prototype.SelfMul=function(n){return this.x*=n,this.y*=n,this},n.prototype.SelfMulAdd=function(n,t){return this.x+=n*t.x,this.y+=n*t.y,this},n.prototype.SelfMulSub=function(n,t){return this.x-=n*t.x,this.y-=n*t.y,this},n.prototype.Dot=function(n){return this.x*n.x+this.y*n.y},n.prototype.Cross=function(n){return this.x*n.y-this.y*n.x},n.prototype.Length=function(){var n=this.x,t=this.y;return Math.sqrt(n*n+t*t)},n.prototype.LengthSquared=function(){var n=this.x,t=this.y;return n*n+t*t},n.prototype.Normalize=function(){var n=this.Length(),t;return n>=p&&(t=1/n,this.x*=t,this.y*=t),n},n.prototype.SelfNormalize=function(){var t=this.Length(),n;return t>=p&&(n=1/t,this.x*=n,this.y*=n),this},n.prototype.SelfRotate=function(n){var t=Math.cos(n),i=Math.sin(n),r=this.x;return this.x=t*r-i*this.y,this.y=i*r+t*this.y,this},n.prototype.IsValid=function(){return isFinite(this.x)&&isFinite(this.y)},n.prototype.SelfCrossVS=function(n){var t=this.x;return this.x=n*this.y,this.y=-n*t,this},n.prototype.SelfCrossSV=function(n){var t=this.x;return this.x=-n*this.y,this.y=n*t,this},n.prototype.SelfMinV=function(n){return this.x=o(this.x,n.x),this.y=o(this.y,n.y),this},n.prototype.SelfMaxV=function(n){return this.x=f(this.x,n.x),this.y=f(this.y,n.y),this},n.prototype.SelfAbs=function(){return this.x=l(this.x),this.y=l(this.y),this},n.prototype.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this},n.prototype.SelfSkew=function(){var n=this.x;return this.x=-this.y,this.y=n,this},n.MakeArray=function(t){return k(t,function(){return new n})},n.AbsV=function(n,t){return t.x=l(n.x),t.y=l(n.y),t},n.MinV=function(n,t,i){return i.x=o(n.x,t.x),i.y=o(n.y,t.y),i},n.MaxV=function(n,t,i){return i.x=f(n.x,t.x),i.y=f(n.y,t.y),i},n.ClampV=function(n,t,i,r){return r.x=y(n.x,t.x,i.x),r.y=y(n.y,t.y,i.y),r},n.RotateV=function(n,t,i){var r=n.x,u=n.y,f=Math.cos(t),e=Math.sin(t);return i.x=f*r-e*u,i.y=e*r+f*u,i},n.DotVV=function(n,t){return n.x*t.x+n.y*t.y},n.CrossVV=function(n,t){return n.x*t.y-n.y*t.x},n.CrossVS=function(n,t,i){var r=n.x;return i.x=t*n.y,i.y=-t*r,i},n.CrossVOne=function(n,t){var i=n.x;return t.x=n.y,t.y=-i,t},n.CrossSV=function(n,t,i){var r=t.x;return i.x=-n*t.y,i.y=n*r,i},n.CrossOneV=function(n,t){var i=n.x;return t.x=-n.y,t.y=i,t},n.AddVV=function(n,t,i){return i.x=n.x+t.x,i.y=n.y+t.y,i},n.SubVV=function(n,t,i){return i.x=n.x-t.x,i.y=n.y-t.y,i},n.MulSV=function(n,t,i){return i.x=t.x*n,i.y=t.y*n,i},n.MulVS=function(n,t,i){return i.x=n.x*t,i.y=n.y*t,i},n.AddVMulSV=function(n,t,i,r){return r.x=n.x+t*i.x,r.y=n.y+t*i.y,r},n.SubVMulSV=function(n,t,i,r){return r.x=n.x-t*i.x,r.y=n.y-t*i.y,r},n.AddVCrossSV=function(n,t,i,r){var u=i.x;return r.x=n.x-t*i.y,r.y=n.y+t*u,r},n.MidVV=function(n,t,i){return i.x=.5*(n.x+t.x),i.y=.5*(n.y+t.y),i},n.ExtVV=function(n,t,i){return i.x=.5*(t.x-n.x),i.y=.5*(t.y-n.y),i},n.IsEqualToV=function(n,t){return n.x===t.x&&n.y===t.y},n.DistanceVV=function(n,t){var i=n.x-t.x,r=n.y-t.y;return Math.sqrt(i*i+r*r)},n.DistanceSquaredVV=function(n,t){var i=n.x-t.x,r=n.y-t.y;return i*i+r*r},n.NegV=function(n,t){return t.x=-n.x,t.y=-n.y,t},n.ZERO=new n(0,0),n.UNITX=new n(1,0),n.UNITY=new n(0,1),n.s_t0=new n,n.s_t1=new n,n.s_t2=new n,n.s_t3=new n,n}(),bs=new t(0,0),g=function(){function n(n,t,i){void 0===n&&(n=0);void 0===t&&(t=0);void 0===i&&(i=0);this.x=n;this.y=t;this.z=i}return n.prototype.Clone=function(){return new n(this.x,this.y,this.z)},n.prototype.SetZero=function(){return this.x=0,this.y=0,this.z=0,this},n.prototype.SetXYZ=function(n,t,i){return this.x=n,this.y=t,this.z=i,this},n.prototype.Copy=function(n){return this.x=n.x,this.y=n.y,this.z=n.z,this},n.prototype.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},n.prototype.SelfAdd=function(n){return this.x+=n.x,this.y+=n.y,this.z+=n.z,this},n.prototype.SelfAddXYZ=function(n,t,i){return this.x+=n,this.y+=t,this.z+=i,this},n.prototype.SelfSub=function(n){return this.x-=n.x,this.y-=n.y,this.z-=n.z,this},n.prototype.SelfSubXYZ=function(n,t,i){return this.x-=n,this.y-=t,this.z-=i,this},n.prototype.SelfMul=function(n){return this.x*=n,this.y*=n,this.z*=n,this},n.DotV3V3=function(n,t){return n.x*t.x+n.y*t.y+n.z*t.z},n.CrossV3V3=function(n,t,i){var r=n.x,u=n.y,f=n.z,e=t.x,o=t.y,s=t.z;return i.x=u*s-f*o,i.y=f*e-r*s,i.z=r*o-u*e,i},n.ZERO=new n(0,0,0),n.s_t0=new n,n}(),nt=function(){function n(){this.ex=new t(1,0);this.ey=new t(0,1)}return n.prototype.Clone=function(){return(new n).Copy(this)},n.FromVV=function(t,i){return(new n).SetVV(t,i)},n.FromSSSS=function(t,i,r,u){return(new n).SetSSSS(t,i,r,u)},n.FromAngle=function(t){return(new n).SetAngle(t)},n.prototype.SetSSSS=function(n,t,i,r){return this.ex.Set(n,i),this.ey.Set(t,r),this},n.prototype.SetVV=function(n,t){return this.ex.Copy(n),this.ey.Copy(t),this},n.prototype.SetAngle=function(n){var t=Math.cos(n),i=Math.sin(n);return this.ex.Set(t,i),this.ey.Set(-i,t),this},n.prototype.Copy=function(n){return this.ex.Copy(n.ex),this.ey.Copy(n.ey),this},n.prototype.SetIdentity=function(){return this.ex.Set(1,0),this.ey.Set(0,1),this},n.prototype.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this},n.prototype.GetAngle=function(){return Math.atan2(this.ex.y,this.ex.x)},n.prototype.GetInverse=function(n){var i=this.ex.x,r=this.ey.x,u=this.ex.y,f=this.ey.y,t=i*f-r*u;return 0!==t&&(t=1/t),n.ex.x=t*f,n.ey.x=-t*r,n.ex.y=-t*u,n.ey.y=t*i,n},n.prototype.Solve=function(n,t,i){var u=this.ex.x,f=this.ey.x,e=this.ex.y,o=this.ey.y,r=u*o-f*e;return 0!==r&&(r=1/r),i.x=r*(o*n-f*t),i.y=r*(u*t-e*n),i},n.prototype.SelfAbs=function(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this},n.prototype.SelfInv=function(){return this.GetInverse(this),this},n.prototype.SelfAddM=function(n){return this.ex.SelfAdd(n.ex),this.ey.SelfAdd(n.ey),this},n.prototype.SelfSubM=function(n){return this.ex.SelfSub(n.ex),this.ey.SelfSub(n.ey),this},n.AbsM=function(n,t){var i=n.ex,r=n.ey;return t.ex.x=l(i.x),t.ex.y=l(i.y),t.ey.x=l(r.x),t.ey.y=l(r.y),t},n.MulMV=function(n,t,i){var r=n.ex,u=n.ey,f=t.x,e=t.y;return i.x=r.x*f+u.x*e,i.y=r.y*f+u.y*e,i},n.MulTMV=function(n,t,i){var r=n.ex,u=n.ey,f=t.x,e=t.y;return i.x=r.x*f+r.y*e,i.y=u.x*f+u.y*e,i},n.AddMM=function(n,t,i){var r=n.ex,u=n.ey,f=t.ex,e=t.ey;return i.ex.x=r.x+f.x,i.ex.y=r.y+f.y,i.ey.x=u.x+e.x,i.ey.y=u.y+e.y,i},n.MulMM=function(n,t,i){var r=n.ex.x,u=n.ex.y,f=n.ey.x,e=n.ey.y,o=t.ex.x,s=t.ex.y,h=t.ey.x,c=t.ey.y;return i.ex.x=r*o+f*s,i.ex.y=u*o+e*s,i.ey.x=r*h+f*c,i.ey.y=u*h+e*c,i},n.MulTMM=function(n,t,i){var r=n.ex.x,u=n.ex.y,f=n.ey.x,e=n.ey.y,o=t.ex.x,s=t.ex.y,h=t.ey.x,c=t.ey.y;return i.ex.x=r*o+u*s,i.ex.y=f*o+e*s,i.ey.x=r*h+u*c,i.ey.y=f*h+e*c,i},n.IDENTITY=new n,n}(),kt=function(){function n(){this.ex=new g(1,0,0);this.ey=new g(0,1,0);this.ez=new g(0,0,1)}return n.prototype.Clone=function(){return(new n).Copy(this)},n.prototype.SetVVV=function(n,t,i){return this.ex.Copy(n),this.ey.Copy(t),this.ez.Copy(i),this},n.prototype.Copy=function(n){return this.ex.Copy(n.ex),this.ey.Copy(n.ey),this.ez.Copy(n.ez),this},n.prototype.SetIdentity=function(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this},n.prototype.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this},n.prototype.SelfAddM=function(n){return this.ex.SelfAdd(n.ex),this.ey.SelfAdd(n.ey),this.ez.SelfAdd(n.ez),this},n.prototype.Solve33=function(n,t,i,r){var l=this.ex.x,a=this.ex.y,v=this.ex.z,u=this.ey.x,f=this.ey.y,e=this.ey.z,o=this.ez.x,s=this.ez.y,h=this.ez.z,c=l*(f*h-e*s)+a*(e*o-u*h)+v*(u*s-f*o);return 0!==c&&(c=1/c),r.x=c*(n*(f*h-e*s)+t*(e*o-u*h)+i*(u*s-f*o)),r.y=c*(l*(t*h-i*s)+a*(i*o-n*h)+v*(n*s-t*o)),r.z=c*(l*(f*i-e*t)+a*(e*n-u*i)+v*(u*t-f*n)),r},n.prototype.Solve22=function(n,t,i){var u=this.ex.x,f=this.ey.x,e=this.ex.y,o=this.ey.y,r=u*o-f*e;return 0!==r&&(r=1/r),i.x=r*(o*n-f*t),i.y=r*(u*t-e*n),i},n.prototype.GetInverse22=function(n){var i=this.ex.x,r=this.ey.x,u=this.ex.y,f=this.ey.y,t=i*f-r*u;0!==t&&(t=1/t);n.ex.x=t*f;n.ey.x=-t*r;n.ex.z=0;n.ex.y=-t*u;n.ey.y=t*i;n.ey.z=0;n.ez.x=0;n.ez.y=0;n.ez.z=0},n.prototype.GetSymInverse33=function(n){var t=g.DotV3V3(this.ex,g.CrossV3V3(this.ey,this.ez,g.s_t0));0!==t&&(t=1/t);var f=this.ex.x,i=this.ey.x,r=this.ez.x,e=this.ey.y,u=this.ez.y,o=this.ez.z;n.ex.x=t*(e*o-u*u);n.ex.y=t*(r*u-i*o);n.ex.z=t*(i*u-r*e);n.ey.x=n.ex.y;n.ey.y=t*(f*o-r*r);n.ey.z=t*(r*i-f*u);n.ez.x=n.ex.z;n.ez.y=n.ey.z;n.ez.z=t*(f*e-i*i)},n.MulM33V3=function(n,t,i){var r=t.x,u=t.y,f=t.z;return i.x=n.ex.x*r+n.ey.x*u+n.ez.x*f,i.y=n.ex.y*r+n.ey.y*u+n.ez.y*f,i.z=n.ex.z*r+n.ey.z*u+n.ez.z*f,i},n.MulM33XYZ=function(n,t,i,r,u){return u.x=n.ex.x*t+n.ey.x*i+n.ez.x*r,u.y=n.ex.y*t+n.ey.y*i+n.ez.y*r,u.z=n.ex.z*t+n.ey.z*i+n.ez.z*r,u},n.MulM33V2=function(n,t,i){var r=t.x,u=t.y;return i.x=n.ex.x*r+n.ey.x*u,i.y=n.ex.y*r+n.ey.y*u,i},n.MulM33XY=function(n,t,i,r){return r.x=n.ex.x*t+n.ey.x*i,r.y=n.ex.y*t+n.ey.y*i,r},n.IDENTITY=new n,n}(),i=function(){function n(n){void 0===n&&(n=0);this.s=0;this.c=1;n&&(this.s=Math.sin(n),this.c=Math.cos(n))}return n.prototype.Clone=function(){return(new n).Copy(this)},n.prototype.Copy=function(n){return this.s=n.s,this.c=n.c,this},n.prototype.SetAngle=function(n){return this.s=Math.sin(n),this.c=Math.cos(n),this},n.prototype.SetIdentity=function(){return this.s=0,this.c=1,this},n.prototype.GetAngle=function(){return Math.atan2(this.s,this.c)},n.prototype.GetXAxis=function(n){return n.x=this.c,n.y=this.s,n},n.prototype.GetYAxis=function(n){return n.x=-this.s,n.y=this.c,n},n.MulRR=function(n,t,i){var r=n.c,u=n.s,f=t.c,e=t.s;return i.s=u*f+r*e,i.c=r*f-u*e,i},n.MulTRR=function(n,t,i){var r=n.c,u=n.s,f=t.c,e=t.s;return i.s=r*e-u*f,i.c=r*f+u*e,i},n.MulRV=function(n,t,i){var r=n.c,u=n.s,f=t.x,e=t.y;return i.x=r*f-u*e,i.y=u*f+r*e,i},n.MulTRV=function(n,t,i){var r=n.c,u=n.s,f=t.x,e=t.y;return i.x=r*f+u*e,i.y=-u*f+r*e,i},n.IDENTITY=new n,n}(),r=function(){function n(){this.p=new t;this.q=new i}return n.prototype.Clone=function(){return(new n).Copy(this)},n.prototype.Copy=function(n){return this.p.Copy(n.p),this.q.Copy(n.q),this},n.prototype.SetIdentity=function(){return this.p.SetZero(),this.q.SetIdentity(),this},n.prototype.SetPositionRotation=function(n,t){return this.p.Copy(n),this.q.Copy(t),this},n.prototype.SetPositionAngle=function(n,t){return this.p.Copy(n),this.q.SetAngle(t),this},n.prototype.SetPosition=function(n){return this.p.Copy(n),this},n.prototype.SetPositionXY=function(n,t){return this.p.Set(n,t),this},n.prototype.SetRotation=function(n){return this.q.Copy(n),this},n.prototype.SetRotationAngle=function(n){return this.q.SetAngle(n),this},n.prototype.GetPosition=function(){return this.p},n.prototype.GetRotation=function(){return this.q},n.prototype.GetRotationAngle=function(){return this.q.GetAngle()},n.prototype.GetAngle=function(){return this.q.GetAngle()},n.MulXV=function(n,t,i){var r=n.q.c,u=n.q.s,f=t.x,e=t.y;return i.x=r*f-u*e+n.p.x,i.y=u*f+r*e+n.p.y,i},n.MulTXV=function(n,t,i){var r=n.q.c,u=n.q.s,f=t.x-n.p.x,e=t.y-n.p.y;return i.x=r*f+u*e,i.y=-u*f+r*e,i},n.MulXX=function(n,r,u){return i.MulRR(n.q,r.q,u.q),t.AddVV(i.MulRV(n.q,r.p,u.p),n.p,u.p),u},n.MulTXX=function(n,r,u){return i.MulTRR(n.q,r.q,u.q),i.MulTRV(n.q,t.SubVV(r.p,n.p,u.p),u.p),u},n.IDENTITY=new n,n}(),ht=function(){function n(){this.localCenter=new t;this.c0=new t;this.c=new t;this.a0=0;this.a=0;this.alpha0=0}return n.prototype.Clone=function(){return(new n).Copy(this)},n.prototype.Copy=function(n){return this.localCenter.Copy(n.localCenter),this.c0.Copy(n.c0),this.c.Copy(n.c),this.a0=n.a0,this.a=n.a,this.alpha0=n.alpha0,this},n.prototype.GetTransform=function(n,r){var u=1-r,f;return n.p.x=u*this.c0.x+r*this.c.x,n.p.y=u*this.c0.y+r*this.c.y,f=u*this.a0+r*this.a,n.q.SetAngle(f),n.p.SelfSub(i.MulRV(n.q,this.localCenter,t.s_t0)),n},n.prototype.Advance=function(n){var t=(n-this.alpha0)/(1-this.alpha0),i=1-t;this.c0.x=i*this.c0.x+t*this.c.x;this.c0.y=i*this.c0.y+t*this.c.y;this.a0=i*this.a0+t*this.a;this.alpha0=n},n.prototype.Normalize=function(){var n=6.28318530718*Math.floor(this.a0/6.28318530718);this.a0-=n;this.a-=n},n}(),it=function(){function n(n,t,i,r){void 0===n&&(n=.5);void 0===t&&(t=.5);void 0===i&&(i=.5);void 0===r&&(r=1);this.r=n;this.g=t;this.b=i;this.a=r}return n.prototype.Clone=function(){return(new n).Copy(this)},n.prototype.Copy=function(n){return this.r=n.r,this.g=n.g,this.b=n.b,this.a=n.a,this},n.prototype.IsEqual=function(n){return this.r===n.r&&this.g===n.g&&this.b===n.b&&this.a===n.a},n.prototype.IsZero=function(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a},n.prototype.Set=function(n,t,i,r){void 0===r&&(r=this.a);this.SetRGBA(n,t,i,r)},n.prototype.SetByteRGB=function(n,t,i){return this.r=n/255,this.g=t/255,this.b=i/255,this},n.prototype.SetByteRGBA=function(n,t,i,r){return this.r=n/255,this.g=t/255,this.b=i/255,this.a=r/255,this},n.prototype.SetRGB=function(n,t,i){return this.r=n,this.g=t,this.b=i,this},n.prototype.SetRGBA=function(n,t,i,r){return this.r=n,this.g=t,this.b=i,this.a=r,this},n.prototype.SelfAdd=function(n){return this.r+=n.r,this.g+=n.g,this.b+=n.b,this.a+=n.a,this},n.prototype.Add=function(n,t){return t.r=this.r+n.r,t.g=this.g+n.g,t.b=this.b+n.b,t.a=this.a+n.a,t},n.prototype.SelfSub=function(n){return this.r-=n.r,this.g-=n.g,this.b-=n.b,this.a-=n.a,this},n.prototype.Sub=function(n,t){return t.r=this.r-n.r,t.g=this.g-n.g,t.b=this.b-n.b,t.a=this.a-n.a,t},n.prototype.SelfMul=function(n){return this.r*=n,this.g*=n,this.b*=n,this.a*=n,this},n.prototype.Mul=function(n,t){return t.r=this.r*n,t.g=this.g*n,t.b=this.b*n,t.a=this.a*n,t},n.prototype.Mix=function(t,i){n.MixColors(this,t,i)},n.MixColors=function(n,t,i){var r=i*(t.r-n.r),u=i*(t.g-n.g),f=i*(t.b-n.b),e=i*(t.a-n.a);n.r+=r;n.g+=u;n.b+=f;n.a+=e;t.r-=r;t.g-=u;t.b-=f;t.a-=e},n.prototype.MakeStyleString=function(t){return void 0===t&&(t=this.a),n.MakeStyleString(this.r,this.g,this.b,t)},n.MakeStyleString=function(n,t,i,r){return void 0===r&&(r=1),n*=255,t*=255,i*=255,r<1?"rgba("+n+","+t+","+i+","+r+")":"rgb("+n+","+t+","+i+")"},n.ZERO=new n(0,0,0,0),n.RED=new n(1,0,0),n.GREEN=new n(0,1,0),n.BLUE=new n(0,0,1),n}(),gt,gi,kr,ni,rr,re,ue,oe,se,ce,ot,wi,ti,ve,v,ri,ou,er,st,ff;(w=n.b2DrawFlags||(n.b2DrawFlags={}))[w.e_none=0]="e_none";w[w.e_shapeBit=1]="e_shapeBit";w[w.e_jointBit=2]="e_jointBit";w[w.e_aabbBit=4]="e_aabbBit";w[w.e_pairBit=8]="e_pairBit";w[w.e_centerOfMassBit=16]="e_centerOfMassBit";w[w.e_particleBit=32]="e_particleBit";w[w.e_controllerBit=64]="e_controllerBit";w[w.e_all=63]="e_all";var ks=function(){function n(){this.m_drawFlags=0}return n.prototype.SetFlags=function(n){this.m_drawFlags=n},n.prototype.GetFlags=function(){return this.m_drawFlags},n.prototype.AppendFlags=function(n){this.m_drawFlags|=n},n.prototype.ClearFlags=function(n){this.m_drawFlags&=~n},n}(),ci=function(){function n(){this.m_start=Date.now()}return n.prototype.Reset=function(){return this.m_start=Date.now(),this},n.prototype.GetMilliseconds=function(){return Date.now()-this.m_start},n}(),ds=function(){function n(){this.m_count=0;this.m_min_count=0;this.m_max_count=0}return n.prototype.GetCount=function(){return this.m_count},n.prototype.GetMinCount=function(){return this.m_min_count},n.prototype.GetMaxCount=function(){return this.m_max_count},n.prototype.ResetCount=function(){var n=this.m_count;return this.m_count=0,n},n.prototype.ResetMinCount=function(){this.m_min_count=0},n.prototype.ResetMaxCount=function(){this.m_max_count=0},n.prototype.Increment=function(){this.m_count++;this.m_max_count<this.m_count&&(this.m_max_count=this.m_count)},n.prototype.Decrement=function(){this.m_count--;this.m_min_count>this.m_count&&(this.m_min_count=this.m_count)},n}(),lf=function(){function n(n){this.m_stack=[];this.m_count=0;this.m_stack=k(n,function(){return null});this.m_count=0}return n.prototype.Reset=function(){return this.m_count=0,this},n.prototype.Push=function(n){this.m_stack[this.m_count]=n;this.m_count++},n.prototype.Pop=function(){this.m_count--;var n=this.m_stack[this.m_count];if(this.m_stack[this.m_count]=null,null===n)throw new Error;return n},n.prototype.GetCount=function(){return this.m_count},n}(),fi=function(){function n(){this.m_buffer=t.MakeArray(2);this.m_vertices=this.m_buffer;this.m_count=0;this.m_radius=0}return n.prototype.Copy=function(n){return n.m_vertices===n.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0].Copy(n.m_buffer[0]),this.m_buffer[1].Copy(n.m_buffer[1])):this.m_vertices=n.m_vertices,this.m_count=n.m_count,this.m_radius=n.m_radius,this},n.prototype.Reset=function(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this},n.prototype.SetShape=function(n,t){n.SetupDistanceProxy(this,t)},n.prototype.SetVerticesRadius=function(n,t,i){this.m_vertices=n;this.m_count=t;this.m_radius=i},n.prototype.GetSupport=function(n){for(var r,u=0,f=t.DotVV(this.m_vertices[0],n),i=1;i<this.m_count;++i)r=t.DotVV(this.m_vertices[i],n),r>f&&(u=i,f=r);return u},n.prototype.GetSupportVertex=function(n){for(var r,u=0,f=t.DotVV(this.m_vertices[0],n),i=1;i<this.m_count;++i)r=t.DotVV(this.m_vertices[i],n),r>f&&(u=i,f=r);return this.m_vertices[u]},n.prototype.GetVertexCount=function(){return this.m_count},n.prototype.GetVertex=function(n){return this.m_vertices[n]},n}(),vr=function(){function n(){this.metric=0;this.count=0;this.indexA=[0,0,0];this.indexB=[0,0,0]}return n.prototype.Reset=function(){return this.metric=0,this.count=0,this},n}(),yr=function(){function n(){this.proxyA=new fi;this.proxyB=new fi;this.transformA=new r;this.transformB=new r;this.useRadii=!1}return n.prototype.Reset=function(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this},n}(),pr=function(){function n(){this.pointA=new t;this.pointB=new t;this.distance=0;this.iterations=0}return n.prototype.Reset=function(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this},n}();n.b2_gjkCalls=0;n.b2_gjkIters=0;n.b2_gjkMaxIters=0;var bi=function(){function n(){this.wA=new t;this.wB=new t;this.w=new t;this.a=0;this.indexA=0;this.indexB=0}return n.prototype.Copy=function(n){return this.wA.Copy(n.wA),this.wB.Copy(n.wB),this.w.Copy(n.w),this.a=n.a,this.indexA=n.indexA,this.indexB=n.indexB,this},n}(),wr=function(){function n(){this.m_v1=new bi;this.m_v2=new bi;this.m_v3=new bi;this.m_vertices=[];this.m_count=0;this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3}return n.prototype.ReadCache=function(n,i,u,f,e){var a,s,h,c,v,l,o;for(this.m_count=n.count,a=this.m_vertices,s=0;s<this.m_count;++s)(o=a[s]).indexA=n.indexA[s],o.indexB=n.indexB[s],h=i.GetVertex(o.indexA),c=f.GetVertex(o.indexB),r.MulXV(u,h,o.wA),r.MulXV(e,c,o.wB),t.SubVV(o.wB,o.wA,o.w),o.a=0;this.m_count>1&&(v=n.metric,l=this.GetMetric(),(l<.5*v||2*v<l||l<p)&&(this.m_count=0));0===this.m_count&&((o=a[0]).indexA=0,o.indexB=0,h=i.GetVertex(0),c=f.GetVertex(0),r.MulXV(u,h,o.wA),r.MulXV(e,c,o.wB),t.SubVV(o.wB,o.wA,o.w),o.a=1,this.m_count=1)},n.prototype.WriteCache=function(n){n.metric=this.GetMetric();n.count=this.m_count;for(var i=this.m_vertices,t=0;t<this.m_count;++t)n.indexA[t]=i[t].indexA,n.indexB[t]=i[t].indexB},n.prototype.GetSearchDirection=function(n){switch(this.m_count){case 1:return t.NegV(this.m_v1.w,n);case 2:var i=t.SubVV(this.m_v2.w,this.m_v1.w,n);return t.CrossVV(i,t.NegV(this.m_v1.w,t.s_t0))>0?t.CrossOneV(i,n):t.CrossVOne(i,n);default:return n.SetZero()}},n.prototype.GetClosestPoint=function(n){switch(this.m_count){case 0:return n.SetZero();case 1:return n.Copy(this.m_v1.w);case 2:return n.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:default:return n.SetZero()}},n.prototype.GetWitnessPoints=function(n,t){switch(this.m_count){case 1:n.Copy(this.m_v1.wA);t.Copy(this.m_v1.wB);break;case 2:n.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;n.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;t.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;t.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:t.x=n.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;t.y=n.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}},n.prototype.GetMetric=function(){switch(this.m_count){case 0:case 1:return 0;case 2:return t.DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return t.CrossVV(t.SubVV(this.m_v2.w,this.m_v1.w,t.s_t0),t.SubVV(this.m_v3.w,this.m_v1.w,t.s_t1));default:return 0}},n.prototype.Solve2=function(){var f=this.m_v1.w,e=this.m_v2.w,o=t.SubVV(e,f,n.s_e12),r=-t.DotVV(f,o),i,u;if(r<=0)return this.m_v1.a=1,void(this.m_count=1);if(i=t.DotVV(e,o),i<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);u=1/(i+r);this.m_v1.a=i*u;this.m_v2.a=r*u;this.m_count=2},n.prototype.Solve3=function(){var i=this.m_v1.w,r=this.m_v2.w,u=this.m_v3.w,a=t.SubVV(r,i,n.s_e12),tt=t.DotVV(i,a),f=t.DotVV(r,a),e=-tt,v=t.SubVV(u,i,n.s_e13),it=t.DotVV(i,v),o=t.DotVV(u,v),s=-it,nt=t.SubVV(u,r,n.s_e23),rt=t.DotVV(r,nt),h=t.DotVV(u,nt),c=-rt,y=t.CrossVV(a,v),p=y*t.CrossVV(r,u),w=y*t.CrossVV(u,i),b=y*t.CrossVV(i,r),k,d,g,l;if(e<=0&&s<=0)return this.m_v1.a=1,void(this.m_count=1);if(f>0&&e>0&&b<=0)return k=1/(f+e),this.m_v1.a=f*k,this.m_v2.a=e*k,void(this.m_count=2);if(o>0&&s>0&&w<=0)return d=1/(o+s),this.m_v1.a=o*d,this.m_v3.a=s*d,this.m_count=2,void this.m_v2.Copy(this.m_v3);if(f<=0&&c<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);if(o<=0&&h<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v3);if(h>0&&c>0&&p<=0)return g=1/(h+c),this.m_v2.a=h*g,this.m_v3.a=c*g,this.m_count=2,void this.m_v1.Copy(this.m_v3);l=1/(p+w+b);this.m_v1.a=p*l;this.m_v2.a=w*l;this.m_v3.a=b*l;this.m_count=3},n.s_e12=new t,n.s_e13=new t,n.s_e23=new t,n}(),gs=new wr,nh=[0,0,0],th=[0,0,0],ih=new t,rh=new t,uh=new t,fh=new t,eh=new t;var ki,oh=new t,sh=new wr,af=new t,vf=new t,hh=new t,ch=new t,lh=new t,ah=new t;(ki=n.b2ContactFeatureType||(n.b2ContactFeatureType={}))[ki.e_vertex=0]="e_vertex";ki[ki.e_face=1]="e_face";var dt,yf=function(){function n(){this._key=0;this._key_invalid=!1;this._indexA=0;this._indexB=0;this._typeA=0;this._typeB=0}return Object.defineProperty(n.prototype,"key",{get:function(){return this._key_invalid&&(this._key_invalid=!1,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24),this._key},set:function(n){this._key=n;this._key_invalid=!1;this._indexA=255&this._key;this._indexB=this._key>>8&255;this._typeA=this._key>>16&255;this._typeB=this._key>>24&255},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"indexA",{get:function(){return this._indexA},set:function(n){this._indexA=n;this._key_invalid=!0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"indexB",{get:function(){return this._indexB},set:function(n){this._indexB=n;this._key_invalid=!0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"typeA",{get:function(){return this._typeA},set:function(n){this._typeA=n;this._key_invalid=!0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"typeB",{get:function(){return this._typeB},set:function(n){this._typeB=n;this._key_invalid=!0},enumerable:!0,configurable:!0}),n}(),di=function(){function n(){this.cf=new yf}return n.prototype.Copy=function(n){return this.key=n.key,this},n.prototype.Clone=function(){return(new n).Copy(this)},Object.defineProperty(n.prototype,"key",{get:function(){return this.cf.key},set:function(n){this.cf.key=n},enumerable:!0,configurable:!0}),n}(),pf=function(){function n(){this.localPoint=new t;this.normalImpulse=0;this.tangentImpulse=0;this.id=new di}return n.MakeArray=function(t){return k(t,function(){return new n})},n.prototype.Reset=function(){this.localPoint.SetZero();this.normalImpulse=0;this.tangentImpulse=0;this.id.key=0},n.prototype.Copy=function(n){return this.localPoint.Copy(n.localPoint),this.normalImpulse=n.normalImpulse,this.tangentImpulse=n.tangentImpulse,this.id.Copy(n.id),this},n}();(dt=n.b2ManifoldType||(n.b2ManifoldType={}))[dt.e_unknown=-1]="e_unknown";dt[dt.e_circles=0]="e_circles";dt[dt.e_faceA=1]="e_faceA";dt[dt.e_faceB=2]="e_faceB";gi=function(){function i(){this.points=pf.MakeArray(d);this.localNormal=new t;this.localPoint=new t;this.type=n.b2ManifoldType.e_unknown;this.pointCount=0}return i.prototype.Reset=function(){for(var t=0;t<d;++t)this.points[t].Reset();this.localNormal.SetZero();this.localPoint.SetZero();this.type=n.b2ManifoldType.e_unknown;this.pointCount=0},i.prototype.Copy=function(n){this.pointCount=n.pointCount;for(var t=0;t<d;++t)this.points[t].Copy(n.points[t]);return this.localNormal.Copy(n.localNormal),this.localPoint.Copy(n.localPoint),this.type=n.type,this},i.prototype.Clone=function(){return(new i).Copy(this)},i}();kr=function(){function u(){this.normal=new t;this.points=t.MakeArray(d);this.separations=lt(d)}return u.prototype.Initialize=function(f,e,o,s,h){var y,p,l,a,w,c,v,b;if(0!==f.pointCount)switch(f.type){case n.b2ManifoldType.e_circles:this.normal.Set(1,0);y=r.MulXV(e,f.localPoint,u.Initialize_s_pointA);p=r.MulXV(s,f.points[0].localPoint,u.Initialize_s_pointB);t.DistanceSquaredVV(y,p)>cr&&t.SubVV(p,y,this.normal).SelfNormalize();l=t.AddVMulSV(y,o,this.normal,u.Initialize_s_cA);a=t.SubVMulSV(p,h,this.normal,u.Initialize_s_cB);t.MidVV(l,a,this.points[0]);this.separations[0]=t.DotVV(t.SubVV(a,l,t.s_t0),this.normal);break;case n.b2ManifoldType.e_faceA:for(i.MulRV(e.q,f.localNormal,this.normal),w=r.MulXV(e,f.localPoint,u.Initialize_s_planePoint),c=0;c<f.pointCount;++c)v=r.MulXV(s,f.points[c].localPoint,u.Initialize_s_clipPoint),b=o-t.DotVV(t.SubVV(v,w,t.s_t0),this.normal),l=t.AddVMulSV(v,b,this.normal,u.Initialize_s_cA),a=t.SubVMulSV(v,h,this.normal,u.Initialize_s_cB),t.MidVV(l,a,this.points[c]),this.separations[c]=t.DotVV(t.SubVV(a,l,t.s_t0),this.normal);break;case n.b2ManifoldType.e_faceB:for(i.MulRV(s.q,f.localNormal,this.normal),w=r.MulXV(s,f.localPoint,u.Initialize_s_planePoint),c=0;c<f.pointCount;++c)v=r.MulXV(e,f.points[c].localPoint,u.Initialize_s_clipPoint),b=h-t.DotVV(t.SubVV(v,w,t.s_t0),this.normal),a=t.AddVMulSV(v,b,this.normal,u.Initialize_s_cB),l=t.SubVMulSV(v,o,this.normal,u.Initialize_s_cA),t.MidVV(l,a,this.points[c]),this.separations[c]=t.DotVV(t.SubVV(l,a,t.s_t0),this.normal);this.normal.SelfNeg()}},u.Initialize_s_pointA=new t,u.Initialize_s_pointB=new t,u.Initialize_s_cA=new t,u.Initialize_s_cB=new t,u.Initialize_s_planePoint=new t,u.Initialize_s_clipPoint=new t,u}();(gt=n.b2PointState||(n.b2PointState={}))[gt.b2_nullState=0]="b2_nullState";gt[gt.b2_addState=1]="b2_addState";gt[gt.b2_persistState=2]="b2_persistState";gt[gt.b2_removeState=3]="b2_removeState";var ei=function(){function n(){this.v=new t;this.id=new di}return n.MakeArray=function(t){return k(t,function(){return new n})},n.prototype.Copy=function(n){return this.v.Copy(n.v),this.id.Copy(n.id),this},n}(),nr=function(){function n(){this.p1=new t;this.p2=new t;this.maxFraction=1}return n.prototype.Copy=function(n){return this.p1.Copy(n.p1),this.p2.Copy(n.p2),this.maxFraction=n.maxFraction,this},n}(),dr=function(){function n(){this.normal=new t;this.fraction=0}return n.prototype.Copy=function(n){return this.normal.Copy(n.normal),this.fraction=n.fraction,this},n}(),b=function(){function n(){this.lowerBound=new t;this.upperBound=new t;this.m_cache_center=new t;this.m_cache_extent=new t}return n.prototype.Copy=function(n){return this.lowerBound.Copy(n.lowerBound),this.upperBound.Copy(n.upperBound),this},n.prototype.IsValid=function(){var n=this.upperBound.x-this.lowerBound.x,t=this.upperBound.y-this.lowerBound.y,i=n>=0&&t>=0;return i&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},n.prototype.GetCenter=function(){return t.MidVV(this.lowerBound,this.upperBound,this.m_cache_center)},n.prototype.GetExtents=function(){return t.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)},n.prototype.GetPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))},n.prototype.Combine1=function(n){return this.lowerBound.x=o(this.lowerBound.x,n.lowerBound.x),this.lowerBound.y=o(this.lowerBound.y,n.lowerBound.y),this.upperBound.x=f(this.upperBound.x,n.upperBound.x),this.upperBound.y=f(this.upperBound.y,n.upperBound.y),this},n.prototype.Combine2=function(n,t){return this.lowerBound.x=o(n.lowerBound.x,t.lowerBound.x),this.lowerBound.y=o(n.lowerBound.y,t.lowerBound.y),this.upperBound.x=f(n.upperBound.x,t.upperBound.x),this.upperBound.y=f(n.upperBound.y,t.upperBound.y),this},n.Combine=function(n,t,i){return i.Combine2(n,t),i},n.prototype.Contains=function(n){var t=!0;return(t=(t=(t=t&&this.lowerBound.x<=n.lowerBound.x)&&this.lowerBound.y<=n.lowerBound.y)&&n.upperBound.x<=this.upperBound.x)&&n.upperBound.y<=this.upperBound.y},n.prototype.RayCast=function(n,t){var i,u,r=-c,s=c,h=t.p1.x,a=t.p1.y,w=t.p2.x-t.p1.x,b=t.p2.y-t.p1.y,k=l(w),d=l(b),v=n.normal,f,e,y;if(k<p){if(h<this.lowerBound.x||this.upperBound.x<h)return!1}else if(f=1/w,e=-1,(i=(this.lowerBound.x-h)*f)>(u=(this.upperBound.x-h)*f)&&(y=i,i=u,u=y,e=1),i>r&&(v.x=e,v.y=0,r=i),r>(s=o(s,u)))return!1;if(d<p){if(a<this.lowerBound.y||this.upperBound.y<a)return!1}else if(f=1/b,e=-1,(i=(this.lowerBound.y-a)*f)>(u=(this.upperBound.y-a)*f)&&(y=i,i=u,u=y,e=1),i>r&&(v.x=0,v.y=e,r=i),r>(s=o(s,u)))return!1;return!(r<0||t.maxFraction<r||(n.fraction=r,0))},n.prototype.TestContain=function(n){return!(n.x<this.lowerBound.x||this.upperBound.x<n.x||n.y<this.lowerBound.y||this.upperBound.y<n.y)},n.prototype.TestOverlap=function(n){var t=n.lowerBound.x-this.upperBound.x,i=n.lowerBound.y-this.upperBound.y,r=this.lowerBound.x-n.upperBound.x,u=this.lowerBound.y-n.upperBound.y;return!(t>0||i>0||r>0||u>0)},n}();var vh=new yr,yh=new vr,ph=new pr;var wf=function(){function n(n){void 0===n&&(n=0);this.m_id=0;this.aabb=new b;this.parent=null;this.child1=null;this.child2=null;this.height=0;this.m_id=n}return n.prototype.IsLeaf=function(){return null===this.child1},n}(),bf=function(){function n(){this.m_root=null;this.m_freeList=null;this.m_path=0;this.m_insertionCount=0;this.m_stack=new lf(256)}return n.prototype.Query=function(n,t){var i,r;if(null!==this.m_root)for(i=this.m_stack.Reset(),i.Push(this.m_root);i.GetCount()>0;)if(r=i.Pop(),r.aabb.TestOverlap(n))if(r.IsLeaf()){if(!t(r))return}else i.Push(a(r.child1)),i.Push(a(r.child2))},n.prototype.QueryPoint=function(n,t){var i,r;if(null!==this.m_root)for(i=this.m_stack.Reset(),i.Push(this.m_root);i.GetCount()>0;)if(r=i.Pop(),r.aabb.TestContain(n))if(r.IsLeaf()){if(!t(r))return}else i.Push(a(r.child1)),i.Push(a(r.child2))},n.prototype.RayCast=function(i,r){var c,s,g,nt,w,b;if(null!==this.m_root){var u=i.p1,v=i.p2,k=t.SubVV(v,u,n.s_r);k.Normalize();var d=t.CrossOneV(k,n.s_v),tt=t.AbsV(d,n.s_abs_v),h=i.maxFraction,e=n.s_segmentAABB,y=u.x+h*(v.x-u.x),p=u.y+h*(v.y-u.y);for(e.lowerBound.x=o(u.x,y),e.lowerBound.y=o(u.y,p),e.upperBound.x=f(u.x,y),e.upperBound.y=f(u.y,p),c=this.m_stack.Reset(),c.Push(this.m_root);c.GetCount()>0;)if(s=c.Pop(),gr(s.aabb,e)&&(g=s.aabb.GetCenter(),nt=s.aabb.GetExtents(),!(l(t.DotVV(d,t.SubVV(u,g,t.s_t0)))-t.DotVV(tt,nt)>0)))if(s.IsLeaf()){if(w=n.s_subInput,w.p1.Copy(i.p1),w.p2.Copy(i.p2),w.maxFraction=h,b=r(w,s),0===b)return;b>0&&(h=b,y=u.x+h*(v.x-u.x),p=u.y+h*(v.y-u.y),e.lowerBound.x=o(u.x,y),e.lowerBound.y=o(u.y,p),e.upperBound.x=f(u.x,y),e.upperBound.y=f(u.y,p))}else c.Push(a(s.child1)),c.Push(a(s.child2))}},n.prototype.AllocateNode=function(){if(this.m_freeList){var t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t.height=0,delete t.userData,t}return new wf(n.s_node_id++)},n.prototype.FreeNode=function(n){n.parent=this.m_freeList;n.child1=null;n.child2=null;n.height=-1;delete n.userData;this.m_freeList=n},n.prototype.CreateProxy=function(n,t){var i=this.AllocateNode();return i.aabb.lowerBound.x=n.lowerBound.x-.1,i.aabb.lowerBound.y=n.lowerBound.y-.1,i.aabb.upperBound.x=n.upperBound.x+.1,i.aabb.upperBound.y=n.upperBound.y+.1,i.userData=t,i.height=0,this.InsertLeaf(i),i},n.prototype.DestroyProxy=function(n){this.RemoveLeaf(n);this.FreeNode(n)},n.prototype.MoveProxy=function(n,t,i){if(n.aabb.Contains(t))return!1;this.RemoveLeaf(n);var r=.1+2*(i.x>0?i.x:-i.x),u=.1+2*(i.y>0?i.y:-i.y);return n.aabb.lowerBound.x=t.lowerBound.x-r,n.aabb.lowerBound.y=t.lowerBound.y-u,n.aabb.upperBound.x=t.upperBound.x+r,n.aabb.upperBound.y=t.upperBound.y+u,this.InsertLeaf(n),!0},n.prototype.InsertLeaf=function(t){var c,u,l,r;if(++this.m_insertionCount,null===this.m_root)return this.m_root=t,void(this.m_root.parent=null);for(c=t.aabb,u=this.m_root;!u.IsLeaf();){var e=a(u.child1),o=a(u.child2),g=u.aabb.GetPerimeter(),b=n.s_combinedAABB;b.Combine2(u.aabb,c);var k=b.GetPerimeter(),d=2*k,y=2*(k-g),p=void 0,s=n.s_aabb,w=void 0;if(e.IsLeaf()?(s.Combine2(c,e.aabb),p=s.GetPerimeter()+y):(s.Combine2(c,e.aabb),w=e.aabb.GetPerimeter(),p=s.GetPerimeter()-w+y),l=void 0,o.IsLeaf()?(s.Combine2(c,o.aabb),l=s.GetPerimeter()+y):(s.Combine2(c,o.aabb),w=o.aabb.GetPerimeter(),l=s.GetPerimeter()-w+y),d<p&&d<l)break;u=p<l?e:o}var h=u,v=h.parent,i=this.AllocateNode();for(i.parent=v,delete i.userData,i.aabb.Combine2(c,h.aabb),i.height=h.height+1,v?(v.child1===h?v.child1=i:v.child2=i,i.child1=h,i.child2=t,h.parent=i,t.parent=i):(i.child1=h,i.child2=t,h.parent=i,t.parent=i,this.m_root=i),r=t.parent;null!==r;)e=a((r=this.Balance(r)).child1),o=a(r.child2),r.height=1+f(e.height,o.height),r.aabb.Combine2(e.aabb,o.aabb),r=r.parent},n.prototype.RemoveLeaf=function(n){var u,t,r,i,e,o;if(n!==this.m_root)if(t=a(n.parent),r=t&&t.parent,u=t.child1===n?a(t.child2):a(t.child1),r)for(r.child1===t?r.child1=u:r.child2=u,u.parent=r,this.FreeNode(t),i=r;i;)e=a((i=this.Balance(i)).child1),o=a(i.child2),i.aabb.Combine2(e.aabb,o.aabb),i.height=1+f(e.height,o.height),i=i.parent;else this.m_root=u,u.parent=null,this.FreeNode(t);else this.m_root=null},n.prototype.Balance=function(n){var r,u,e,o;if(n.IsLeaf()||n.height<2)return n;var t=a(n.child1),i=a(n.child2),s=i.height-t.height;return s>1?(r=a(i.child1),u=a(i.child2),i.child1=n,i.parent=n.parent,n.parent=i,null!==i.parent?i.parent.child1===n?i.parent.child1=i:i.parent.child2=i:this.m_root=i,r.height>u.height?(i.child2=r,n.child2=u,u.parent=n,n.aabb.Combine2(t.aabb,u.aabb),i.aabb.Combine2(n.aabb,r.aabb),n.height=1+f(t.height,u.height),i.height=1+f(n.height,r.height)):(i.child2=u,n.child2=r,r.parent=n,n.aabb.Combine2(t.aabb,r.aabb),i.aabb.Combine2(n.aabb,u.aabb),n.height=1+f(t.height,r.height),i.height=1+f(n.height,u.height)),i):s<-1?(e=a(t.child1),o=a(t.child2),t.child1=n,t.parent=n.parent,n.parent=t,null!==t.parent?t.parent.child1===n?t.parent.child1=t:t.parent.child2=t:this.m_root=t,e.height>o.height?(t.child2=e,n.child1=o,o.parent=n,n.aabb.Combine2(i.aabb,o.aabb),t.aabb.Combine2(n.aabb,e.aabb),n.height=1+f(i.height,o.height),t.height=1+f(n.height,e.height)):(t.child2=o,n.child1=e,e.parent=n,n.aabb.Combine2(i.aabb,e.aabb),t.aabb.Combine2(n.aabb,o.aabb),n.height=1+f(i.height,e.height),t.height=1+f(n.height,o.height)),t):n},n.prototype.GetHeight=function(){return null===this.m_root?0:this.m_root.height},n.GetAreaNode=function(t){if(null===t||t.IsLeaf())return 0;var i=t.aabb.GetPerimeter();return(i+=n.GetAreaNode(t.child1))+n.GetAreaNode(t.child2)},n.prototype.GetAreaRatio=function(){if(null===this.m_root)return 0;var t=this.m_root.aabb.GetPerimeter();return n.GetAreaNode(this.m_root)/t},n.prototype.ComputeHeightNode=function(n){if(!n||n.IsLeaf())return 0;var t=this.ComputeHeightNode(n.child1),i=this.ComputeHeightNode(n.child2);return 1+f(t,i)},n.prototype.ComputeHeight=function(){return this.ComputeHeightNode(this.m_root)},n.prototype.ValidateStructure=function(n){var t,i,r;null!==n&&(this.m_root,t=n,t.IsLeaf()||(i=a(t.child1),r=a(t.child2),this.ValidateStructure(i),this.ValidateStructure(r)))},n.prototype.ValidateMetrics=function(t){var i,r,u;null!==t&&(i=t,i.IsLeaf()||(r=a(i.child1),u=a(i.child2),n.s_aabb.Combine2(r.aabb,u.aabb),this.ValidateMetrics(r),this.ValidateMetrics(u)))},n.prototype.Validate=function(){},n.GetMaxBalanceNode=function(n,t){if(null===n||n.height<=1)return t;var i=a(n.child1),r=a(n.child2),u=l(r.height-i.height);return f(t,u)},n.prototype.GetMaxBalance=function(){return n.GetMaxBalanceNode(this.m_root,0)},n.prototype.RebuildBottomUp=function(){this.Validate()},n.ShiftOriginNode=function(t,i){if(null!==t&&!(t.height<=1)){var r=t.child1,u=t.child2;n.ShiftOriginNode(r,i);n.ShiftOriginNode(u,i);t.aabb.lowerBound.SelfSub(i);t.aabb.upperBound.SelfSub(i)}},n.prototype.ShiftOrigin=function(t){n.ShiftOriginNode(this.m_root,t)},n.s_r=new t,n.s_v=new t,n.s_abs_v=new t,n.s_segmentAABB=new b,n.s_subInput=new nr,n.s_combinedAABB=new b,n.s_aabb=new b,n.s_node_id=0,n}(),kf=function(n,t){this.proxyA=n;this.proxyB=t},df=function(){function n(){this.m_tree=new bf;this.m_proxyCount=0;this.m_moveCount=0;this.m_moveBuffer=[];this.m_pairCount=0;this.m_pairBuffer=[]}return n.prototype.CreateProxy=function(n,t){var i=this.m_tree.CreateProxy(n,t);return++this.m_proxyCount,this.BufferMove(i),i},n.prototype.DestroyProxy=function(n){this.UnBufferMove(n);--this.m_proxyCount;this.m_tree.DestroyProxy(n)},n.prototype.MoveProxy=function(n,t,i){this.m_tree.MoveProxy(n,t,i)&&this.BufferMove(n)},n.prototype.TouchProxy=function(n){this.BufferMove(n)},n.prototype.GetProxyCount=function(){return this.m_proxyCount},n.prototype.UpdatePairs=function(n){var t=this,i,f;this.m_pairCount=0;for(var h=function(n){var i=e.m_moveBuffer[n],r;if(null===i)return"continue";r=i.aabb;e.m_tree.Query(r,function(n){var r,u,f;return n.m_id===i.m_id?!0:((n.m_id<i.m_id?(r=n,u=i):(r=i,u=n),t.m_pairCount===t.m_pairBuffer.length)?t.m_pairBuffer[t.m_pairCount]=new kf(r,u):(f=t.m_pairBuffer[t.m_pairCount],f.proxyA=r,f.proxyB=u),++t.m_pairCount,!0)})},e=this,u=0;u<this.m_moveCount;++u)h(u);for(this.m_moveCount=0,this.m_pairBuffer.length=this.m_pairCount,this.m_pairBuffer.sort(gf),i=0;i<this.m_pairCount;){var r=this.m_pairBuffer[i],o=r.proxyA.userData,s=r.proxyB.userData;for(o&&s&&n(o,s),++i;i<this.m_pairCount;){if(f=this.m_pairBuffer[i],f.proxyA.m_id!==r.proxyA.m_id||f.proxyB.m_id!==r.proxyB.m_id)break;++i}}},n.prototype.Query=function(n,t){this.m_tree.Query(n,t)},n.prototype.QueryPoint=function(n,t){this.m_tree.QueryPoint(n,t)},n.prototype.RayCast=function(n,t){this.m_tree.RayCast(n,t)},n.prototype.GetTreeHeight=function(){return this.m_tree.GetHeight()},n.prototype.GetTreeBalance=function(){return this.m_tree.GetMaxBalance()},n.prototype.GetTreeQuality=function(){return this.m_tree.GetAreaRatio()},n.prototype.ShiftOrigin=function(n){this.m_tree.ShiftOrigin(n)},n.prototype.BufferMove=function(n){this.m_moveBuffer[this.m_moveCount]=n;++this.m_moveCount},n.prototype.UnBufferMove=function(n){var t=this.m_moveBuffer.indexOf(n);this.m_moveBuffer[t]=null},n}();n.b2_toiTime=0;n.b2_toiMaxTime=0;n.b2_toiCalls=0;n.b2_toiIters=0;n.b2_toiMaxIters=0;n.b2_toiRootIters=0;n.b2_toiMaxRootIters=0;var vt,tr=new r,ir=new r,pt=new t,wt=new t,li=new t,ne=new t,te=new t,tu=function(){this.proxyA=new fi;this.proxyB=new fi;this.sweepA=new ht;this.sweepB=new ht;this.tMax=0};(vt=n.b2TOIOutputState||(n.b2TOIOutputState={}))[vt.e_unknown=0]="e_unknown";vt[vt.e_failed=1]="e_failed";vt[vt.e_overlapped=2]="e_overlapped";vt[vt.e_touching=3]="e_touching";vt[vt.e_separated=4]="e_separated";rr=function(){this.state=n.b2TOIOutputState.e_unknown;this.t=0};(ni=n.b2SeparationFunctionType||(n.b2SeparationFunctionType={}))[ni.e_unknown=-1]="e_unknown";ni[ni.e_points=0]="e_points";ni[ni.e_faceA=1]="e_faceA";ni[ni.e_faceB=2]="e_faceB";var ie=function(){function u(){this.m_sweepA=new ht;this.m_sweepB=new ht;this.m_type=n.b2SeparationFunctionType.e_unknown;this.m_localPoint=new t;this.m_axis=new t}return u.prototype.Initialize=function(u,f,e,o,s,h){var tt,l,a,c,k,d,p,g,nt;if(this.m_proxyA=f,this.m_proxyB=o,tt=u.count,this.m_sweepA.Copy(e),this.m_sweepB.Copy(s),l=tr,a=ir,this.m_sweepA.GetTransform(l,h),this.m_sweepB.GetTransform(a,h),1===tt){this.m_type=n.b2SeparationFunctionType.e_points;var w=this.m_proxyA.GetVertex(u.indexA[0]),b=this.m_proxyB.GetVertex(u.indexB[0]),v=r.MulXV(l,w,pt),y=r.MulXV(a,b,wt);return t.SubVV(y,v,this.m_axis),c=this.m_axis.Normalize(),this.m_localPoint.SetZero(),c}return u.indexA[0]===u.indexA[1]?(this.m_type=n.b2SeparationFunctionType.e_faceB,k=this.m_proxyB.GetVertex(u.indexB[0]),d=this.m_proxyB.GetVertex(u.indexB[1]),t.CrossVOne(t.SubVV(d,k,t.s_t0),this.m_axis).SelfNormalize(),p=i.MulRV(a.q,this.m_axis,li),t.MidVV(k,d,this.m_localPoint),y=r.MulXV(a,this.m_localPoint,wt),w=this.m_proxyA.GetVertex(u.indexA[0]),v=r.MulXV(l,w,pt),(c=t.DotVV(t.SubVV(v,y,t.s_t0),p))<0&&(this.m_axis.SelfNeg(),c=-c),c):(this.m_type=n.b2SeparationFunctionType.e_faceA,g=this.m_proxyA.GetVertex(u.indexA[0]),nt=this.m_proxyA.GetVertex(u.indexA[1]),t.CrossVOne(t.SubVV(nt,g,t.s_t0),this.m_axis).SelfNormalize(),p=i.MulRV(l.q,this.m_axis,li),t.MidVV(g,nt,this.m_localPoint),v=r.MulXV(l,this.m_localPoint,pt),b=this.m_proxyB.GetVertex(u.indexB[0]),y=r.MulXV(a,b,wt),(c=t.DotVV(t.SubVV(y,v,t.s_t0),p))<0&&(this.m_axis.SelfNeg(),c=-c),c)},u.prototype.FindMinSeparation=function(u,f,e){var o=tr,s=ir,a,v,h;switch(this.m_sweepA.GetTransform(o,e),this.m_sweepB.GetTransform(s,e),this.m_type){case n.b2SeparationFunctionType.e_points:a=i.MulTRV(o.q,this.m_axis,ne);v=i.MulTRV(s.q,t.NegV(this.m_axis,t.s_t0),te);u[0]=this.m_proxyA.GetSupport(a);f[0]=this.m_proxyB.GetSupport(v);var y=this.m_proxyA.GetVertex(u[0]),p=this.m_proxyB.GetVertex(f[0]),c=r.MulXV(o,y,pt),l=r.MulXV(s,p,wt);return t.DotVV(t.SubVV(l,c,t.s_t0),this.m_axis);case n.b2SeparationFunctionType.e_faceA:return h=i.MulRV(o.q,this.m_axis,li),c=r.MulXV(o,this.m_localPoint,pt),v=i.MulTRV(s.q,t.NegV(h,t.s_t0),te),u[0]=-1,f[0]=this.m_proxyB.GetSupport(v),p=this.m_proxyB.GetVertex(f[0]),l=r.MulXV(s,p,wt),t.DotVV(t.SubVV(l,c,t.s_t0),h);case n.b2SeparationFunctionType.e_faceB:return h=i.MulRV(s.q,this.m_axis,li),l=r.MulXV(s,this.m_localPoint,wt),a=i.MulTRV(o.q,t.NegV(h,t.s_t0),ne),f[0]=-1,u[0]=this.m_proxyA.GetSupport(a),y=this.m_proxyA.GetVertex(u[0]),c=r.MulXV(o,y,pt),t.DotVV(t.SubVV(c,l,t.s_t0),h);default:return u[0]=-1,f[0]=-1,0}},u.prototype.Evaluate=function(u,f,e){var o=tr,s=ir,l;switch(this.m_sweepA.GetTransform(o,e),this.m_sweepB.GetTransform(s,e),this.m_type){case n.b2SeparationFunctionType.e_points:var a=this.m_proxyA.GetVertex(u),v=this.m_proxyB.GetVertex(f),h=r.MulXV(o,a,pt),c=r.MulXV(s,v,wt);return t.DotVV(t.SubVV(c,h,t.s_t0),this.m_axis);case n.b2SeparationFunctionType.e_faceA:return l=i.MulRV(o.q,this.m_axis,li),h=r.MulXV(o,this.m_localPoint,pt),v=this.m_proxyB.GetVertex(f),c=r.MulXV(s,v,wt),t.DotVV(t.SubVV(c,h,t.s_t0),l);case n.b2SeparationFunctionType.e_faceB:return l=i.MulRV(s.q,this.m_axis,li),c=r.MulXV(s,this.m_localPoint,wt),a=this.m_proxyA.GetVertex(u),h=r.MulXV(o,a,pt),t.DotVV(t.SubVV(h,c,t.s_t0),l);default:return 0}},u}(),wh=new ci,bh=new vr,kh=new yr,dh=new pr,gh=new ie,nc=[0],tc=[0],ic=new ht,rc=new ht;re=new t;ue=new t;var uc=new t,fc=new t,ec=new t;var oc=new t,sc=new t,hc=new t,cc=new t;oe=new t;se=new t;ce=new t;var ac=ei.MakeArray(2),vc=ei.MakeArray(2),yc=ei.MakeArray(2),pc=[0],wc=[0],bc=new t,kc=new t,dc=new t,gc=new t,nl=new t,tl=new t,il=new t,rl=new t;var ul=new t,fl=new t,ru=new t,el=new t,ol=new t,sl=new t,hl=new t,cl=new di;var ae=function(){this.type=0;this.index=0;this.separation=0},ll=function(){this.vertices=t.MakeArray(ct);this.normals=t.MakeArray(ct);this.count=0},al=function(){this.i1=0;this.i2=0;this.v1=new t;this.v2=new t;this.normal=new t;this.sideNormal1=new t;this.sideOffset1=0;this.sideNormal2=new t;this.sideOffset2=0},vl=new(function(){function u(){this.m_polygonB=new ll;this.m_xf=new r;this.m_centroidB=new t;this.m_v0=new t;this.m_v1=new t;this.m_v2=new t;this.m_v3=new t;this.m_normal0=new t;this.m_normal1=new t;this.m_normal2=new t;this.m_normal=new t;this.m_type1=0;this.m_type2=0;this.m_lowerLimit=new t;this.m_upperLimit=new t;this.m_radius=0;this.m_front=!1}return u.prototype.Collide=function(f,e,o,s,h){var ut,ft,l,nt,tt,g,it,c,at,vt,yt,st,pt,a,v,wt,y,ht,w;r.MulTXX(o,h,this.m_xf);r.MulXV(this.m_xf,s.m_centroid,this.m_centroidB);this.m_v0.Copy(e.m_vertex0);this.m_v1.Copy(e.m_vertex1);this.m_v2.Copy(e.m_vertex2);this.m_v3.Copy(e.m_vertex3);var ct=e.m_hasVertex0,lt=e.m_hasVertex3,rt=t.SubVV(this.m_v2,this.m_v1,u.s_edge1);rt.Normalize();this.m_normal1.Set(rt.y,-rt.x);var p=t.DotVV(this.m_normal1,t.SubVV(this.m_centroidB,this.m_v1,t.s_t0)),b=0,k=0,et=!1,ot=!1;for(ct&&(ut=t.SubVV(this.m_v1,this.m_v0,u.s_edge0),ut.Normalize(),this.m_normal0.Set(ut.y,-ut.x),et=t.CrossVV(ut,rt)>=0,b=t.DotVV(this.m_normal0,t.SubVV(this.m_centroidB,this.m_v0,t.s_t0))),lt&&(ft=t.SubVV(this.m_v3,this.m_v2,u.s_edge2),ft.Normalize(),this.m_normal2.Set(ft.y,-ft.x),ot=t.CrossVV(rt,ft)>0,k=t.DotVV(this.m_normal2,t.SubVV(this.m_centroidB,this.m_v2,t.s_t0))),ct&&lt?et&&ot?(this.m_front=b>=0||p>=0||k>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):et?(this.m_front=b>=0||p>=0&&k>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):ot?(this.m_front=k>=0||b>=0&&p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=b>=0&&p>=0&&k>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):ct?et?(this.m_front=b>=0||p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):(this.m_front=b>=0&&p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):lt?ot?(this.m_front=p>=0||k>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=p>=0&&k>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=s.m_count,l=0;l<s.m_count;++l)r.MulXV(this.m_xf,s.m_vertices[l],this.m_polygonB.vertices[l]),i.MulRV(this.m_xf.q,s.m_normals[l],this.m_polygonB.normals[l]);if(this.m_radius=s.m_radius+e.m_radius,f.pointCount=0,nt=this.ComputeEdgeSeparation(u.s_edgeAxis),0!==nt.type&&!(nt.separation>this.m_radius)&&(tt=this.ComputePolygonSeparation(u.s_polygonAxis),!(0!==tt.type&&tt.separation>this.m_radius))){if(g=0===tt.type?nt:tt.separation>.98*nt.separation+.001?tt:nt,it=u.s_ie,c=u.s_rf,1===g.type){for(f.type=n.b2ManifoldType.e_faceA,at=0,vt=t.DotVV(this.m_normal,this.m_polygonB.normals[0]),l=1;l<this.m_polygonB.count;++l)yt=t.DotVV(this.m_normal,this.m_polygonB.normals[l]),yt<vt&&(vt=yt,at=l);st=at;pt=(st+1)%this.m_polygonB.count;(a=it[0]).v.Copy(this.m_polygonB.vertices[st]);a.id.cf.indexA=0;a.id.cf.indexB=st;a.id.cf.typeA=n.b2ContactFeatureType.e_face;a.id.cf.typeB=n.b2ContactFeatureType.e_vertex;(v=it[1]).v.Copy(this.m_polygonB.vertices[pt]);v.id.cf.indexA=0;v.id.cf.indexB=pt;v.id.cf.typeA=n.b2ContactFeatureType.e_face;v.id.cf.typeB=n.b2ContactFeatureType.e_vertex;this.m_front?(c.i1=0,c.i2=1,c.v1.Copy(this.m_v1),c.v2.Copy(this.m_v2),c.normal.Copy(this.m_normal1)):(c.i1=1,c.i2=0,c.v1.Copy(this.m_v2),c.v2.Copy(this.m_v1),c.normal.Copy(this.m_normal1).SelfNeg())}else f.type=n.b2ManifoldType.e_faceB,(a=it[0]).v.Copy(this.m_v1),a.id.cf.indexA=0,a.id.cf.indexB=g.index,a.id.cf.typeA=n.b2ContactFeatureType.e_vertex,a.id.cf.typeB=n.b2ContactFeatureType.e_face,(v=it[1]).v.Copy(this.m_v2),v.id.cf.indexA=0,v.id.cf.indexB=g.index,v.id.cf.typeA=n.b2ContactFeatureType.e_vertex,v.id.cf.typeB=n.b2ContactFeatureType.e_face,c.i1=g.index,c.i2=(c.i1+1)%this.m_polygonB.count,c.v1.Copy(this.m_polygonB.vertices[c.i1]),c.v2.Copy(this.m_polygonB.vertices[c.i2]),c.normal.Copy(this.m_polygonB.normals[c.i1]);if(c.sideNormal1.Set(c.normal.y,-c.normal.x),c.sideNormal2.Copy(c.sideNormal1).SelfNeg(),c.sideOffset1=t.DotVV(c.sideNormal1,c.v1),c.sideOffset2=t.DotVV(c.sideNormal2,c.v2),wt=u.s_clipPoints1,y=u.s_clipPoints2,!(pi(wt,it,c.sideNormal1,c.sideOffset1,c.i1)<d||pi(y,wt,c.sideNormal2,c.sideOffset2,c.i2)<d)){for(1===g.type?(f.localNormal.Copy(c.normal),f.localPoint.Copy(c.v1)):(f.localNormal.Copy(s.m_normals[c.i1]),f.localPoint.Copy(s.m_vertices[c.i1])),ht=0,l=0;l<d;++l)t.DotVV(c.normal,t.SubVV(y[l].v,c.v1,t.s_t0))<=this.m_radius&&(w=f.points[ht],1===g.type?(r.MulTXV(this.m_xf,y[l].v,w.localPoint),w.id=y[l].id):(w.localPoint.Copy(y[l].v),w.id.cf.typeA=y[l].id.cf.typeB,w.id.cf.typeB=y[l].id.cf.typeA,w.id.cf.indexA=y[l].id.cf.indexB,w.id.cf.indexB=y[l].id.cf.indexA),++ht);f.pointCount=ht}}},u.prototype.ComputeEdgeSeparation=function(n){var i=n,r,u;for(i.type=1,i.index=this.m_front?0:1,i.separation=c,r=0;r<this.m_polygonB.count;++r)u=t.DotVV(this.m_normal,t.SubVV(this.m_polygonB.vertices[r],this.m_v1,t.s_t0)),u<i.separation&&(i.separation=u);return i},u.prototype.ComputePolygonSeparation=function(n){var i=n,s,r;for(i.type=0,i.index=-1,i.separation=-c,s=u.s_perp.Set(-this.m_normal.y,this.m_normal.x),r=0;r<this.m_polygonB.count;++r){var f=t.NegV(this.m_polygonB.normals[r],u.s_n),h=t.DotVV(f,t.SubVV(this.m_polygonB.vertices[r],this.m_v1,t.s_t0)),l=t.DotVV(f,t.SubVV(this.m_polygonB.vertices[r],this.m_v2,t.s_t0)),e=o(h,l);if(e>this.m_radius)return i.type=2,i.index=r,i.separation=e,i;if(t.DotVV(f,s)>=0){if(t.DotVV(t.SubVV(f,this.m_upperLimit,t.s_t0),this.m_normal)<-yt)continue}else if(t.DotVV(t.SubVV(f,this.m_lowerLimit,t.s_t0),this.m_normal)<-yt)continue;e>i.separation&&(i.type=2,i.index=r,i.separation=e)}return i},u.s_edge1=new t,u.s_edge0=new t,u.s_edge2=new t,u.s_ie=ei.MakeArray(2),u.s_rf=new al,u.s_clipPoints1=ei.MakeArray(2),u.s_clipPoints2=ei.MakeArray(2),u.s_edgeAxis=new ae,u.s_polygonAxis=new ae,u.s_n=new t,u.s_perp=new t,u}());wi=function(){this.mass=0;this.center=new t(0,0);this.I=0};(ot=n.b2ShapeType||(n.b2ShapeType={}))[ot.e_unknown=-1]="e_unknown";ot[ot.e_circleShape=0]="e_circleShape";ot[ot.e_edgeShape=1]="e_edgeShape";ot[ot.e_polygonShape=2]="e_polygonShape";ot[ot.e_chainShape=3]="e_chainShape";ot[ot.e_shapeTypeCount=4]="e_shapeTypeCount";ti=function(){function t(t,i){this.m_type=n.b2ShapeType.e_unknown;this.m_radius=0;this.m_type=t;this.m_radius=i}return t.prototype.Copy=function(n){return this.m_radius=n.m_radius,this},t.prototype.GetType=function(){return this.m_type},t}();ve=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};var ii,yl=function(i){function u(r){void 0===r&&(r=0);var u=i.call(this,n.b2ShapeType.e_circleShape,r)||this;return u.m_p=new t,u}return e(u,i),u.prototype.Set=function(n,t){return void 0===t&&(t=this.m_radius),this.m_p.Copy(n),this.m_radius=t,this},u.prototype.Clone=function(){return(new u).Copy(this)},u.prototype.Copy=function(n){return i.prototype.Copy.call(this,n),this.m_p.Copy(n.m_p),this},u.prototype.GetChildCount=function(){return 1},u.prototype.TestPoint=function(n,i){var e=r.MulXV(n,this.m_p,u.TestPoint_s_center),f=t.SubVV(i,e,u.TestPoint_s_d);return t.DotVV(f,f)<=hi(this.m_radius)},u.prototype.ComputeDistance=function(n,i,f){var e=r.MulXV(n,this.m_p,u.ComputeDistance_s_center);return t.SubVV(i,e,f),f.Normalize()-this.m_radius},u.prototype.RayCast=function(n,i,f){var a=r.MulXV(f,this.m_p,u.RayCast_s_position),o=t.SubVV(i.p1,a,u.RayCast_s_s),v=t.DotVV(o,o)-hi(this.m_radius),s=t.SubVV(i.p2,i.p1,u.RayCast_s_r),c=t.DotVV(o,s),h=t.DotVV(s,s),l=c*c-h*v,e;return l<0||h<p?!1:(e=-(c+at(l)),0<=e&&e<=i.maxFraction*h&&(e/=h,n.fraction=e,t.AddVMulSV(o,e,s,n.normal).SelfNormalize(),!0))},u.prototype.ComputeAABB=function(n,t){var i=r.MulXV(t,this.m_p,u.ComputeAABB_s_p);n.lowerBound.Set(i.x-this.m_radius,i.y-this.m_radius);n.upperBound.Set(i.x+this.m_radius,i.y+this.m_radius)},u.prototype.ComputeMass=function(n,i){var r=hi(this.m_radius);n.mass=i*ut*r;n.center.Copy(this.m_p);n.I=n.mass*(.5*r+t.DotVV(this.m_p,this.m_p))},u.prototype.SetupDistanceProxy=function(n){n.m_vertices=n.m_buffer;n.m_vertices[0].Copy(this.m_p);n.m_count=1;n.m_radius=this.m_radius},u.prototype.ComputeSubmergedArea=function(n,i,u,f){var o=r.MulXV(u,this.m_p,new t),e=-(t.DotVV(n,o)-i);if(e<-this.m_radius+p)return 0;if(e>this.m_radius)return f.Copy(o),ut*this.m_radius*this.m_radius;var s=this.m_radius*this.m_radius,h=e*e,c=s*(cf(e/this.m_radius)+ut/2)+e*at(s-h),l=-2/3*hf(s-h,1.5)/c;return f.x=o.x+n.x*l,f.y=o.y+n.y*l,c},u.prototype.Dump=function(n){n("    const shape: b2CircleShape = new b2CircleShape();\n");n("    shape.m_radius = %.15f;\n",this.m_radius);n("    shape.m_p.Set(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)},u.TestPoint_s_center=new t,u.TestPoint_s_d=new t,u.ComputeDistance_s_center=new t,u.RayCast_s_position=new t,u.RayCast_s_s=new t,u.RayCast_s_r=new t,u.ComputeAABB_s_p=new t,u}(ti),pl=function(u){function f(){var i=u.call(this,n.b2ShapeType.e_polygonShape,bt)||this;return i.m_centroid=new t(0,0),i.m_vertices=[],i.m_normals=[],i.m_count=0,i}return e(f,u),f.prototype.Clone=function(){return(new f).Copy(this)},f.prototype.Copy=function(n){u.prototype.Copy.call(this,n);this.m_centroid.Copy(n.m_centroid);this.m_count=n.m_count;this.m_vertices=t.MakeArray(this.m_count);this.m_normals=t.MakeArray(this.m_count);for(var i=0;i<this.m_count;++i)this.m_vertices[i].Copy(n.m_vertices[i]),this.m_normals[i].Copy(n.m_normals[i]);return this},f.prototype.GetChildCount=function(){return 1},f.prototype.Set=function(n,i,r){var v,p,w,l,g,nt;if(void 0===i&&(i=n.length),void 0===r&&(r=0),i<3)return this.SetAsBox(1,1);for(var y=o(i,ct),e=f.Set_s_ps,k=0,u=0;u<y;++u){for(var a=n[r+u],tt=!0,h=0;h<k;++h)if(t.DistanceSquaredVV(a,e[h])<.25*s*s){tt=!1;break}tt&&e[k++].Copy(a)}if((y=k)<3)return this.SetAsBox(1,1);for(v=0,p=e[0].x,u=1;u<y;++u)w=e[u].x,(w>p||w===p&&e[u].y<e[v].y)&&(v=u,p=w);for(var b=f.Set_s_hull,c=0,d=v;;){for(b[c]=d,l=0,h=1;h<y;++h)l!==d?(g=t.SubVV(e[l],e[b[c]],f.Set_s_r),nt=(a=t.SubVV(e[h],e[b[c]],f.Set_s_v),t.CrossVV(g,a)),nt<0&&(l=h),0===nt&&a.LengthSquared()>g.LengthSquared()&&(l=h)):l=h;if(++c,d=l,l===v)break}for(this.m_count=c,this.m_vertices=t.MakeArray(this.m_count),this.m_normals=t.MakeArray(this.m_count),u=0;u<c;++u)this.m_vertices[u].Copy(e[b[u]]);for(u=0;u<c;++u){var it=this.m_vertices[u],rt=this.m_vertices[(u+1)%c],ut=t.SubVV(rt,it,t.s_t0);t.CrossVOne(ut,this.m_normals[u]).SelfNormalize()}return f.ComputeCentroid(this.m_vertices,c,this.m_centroid),this},f.prototype.SetAsArray=function(n,t){return void 0===t&&(t=n.length),this.Set(n,t)},f.prototype.SetAsBox=function(n,u,f,e){var s,o;if(void 0===e&&(e=0),this.m_count=4,this.m_vertices=t.MakeArray(this.m_count),this.m_normals=t.MakeArray(this.m_count),this.m_vertices[0].Set(-n,-u),this.m_vertices[1].Set(n,-u),this.m_vertices[2].Set(n,u),this.m_vertices[3].Set(-n,u),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),f)for(this.m_centroid.Copy(f),s=new r,s.SetPosition(f),s.SetRotationAngle(e),o=0;o<this.m_count;++o)r.MulXV(s,this.m_vertices[o],this.m_vertices[o]),i.MulRV(s.q,this.m_normals[o],this.m_normals[o]);return this},f.prototype.TestPoint=function(n,i){for(var e=r.MulTXV(n,i,f.TestPoint_s_pLocal),u=0;u<this.m_count;++u)if(t.DotVV(this.m_normals[u],t.SubVV(e,this.m_vertices[u],t.s_t0))>0)return!1;return!0},f.prototype.ComputeDistance=function(n,u,e){for(var v,y,h,p,w,l=r.MulTXV(n,u,f.ComputeDistance_s_pLocal),s=-c,a=f.ComputeDistance_s_normalForMaxDistance.Copy(l),o=0;o<this.m_count;++o)v=t.DotVV(this.m_normals[o],t.SubVV(l,this.m_vertices[o],t.s_t0)),v>s&&(s=v,a.Copy(this.m_normals[o]));if(s>0){for(y=f.ComputeDistance_s_minDistance.Copy(a),h=s*s,o=0;o<this.m_count;++o)p=t.SubVV(l,this.m_vertices[o],f.ComputeDistance_s_distance),w=p.LengthSquared(),h>w&&(y.Copy(p),h=w);return i.MulRV(n.q,y,e),e.Normalize(),Math.sqrt(h)}return i.MulRV(n.q,a,e),s},f.prototype.RayCast=function(n,u,e){for(var h,o,v=r.MulTXV(e,u.p1,f.RayCast_s_p1),y=r.MulTXV(e,u.p2,f.RayCast_s_p2),p=t.SubVV(y,v,f.RayCast_s_d),c=0,l=u.maxFraction,a=-1,s=0;s<this.m_count;++s){if(h=t.DotVV(this.m_normals[s],t.SubVV(this.m_vertices[s],v,t.s_t0)),o=t.DotVV(this.m_normals[s],p),0===o){if(h<0)return!1}else o<0&&h<c*o?(c=h/o,a=s):o>0&&h<l*o&&(l=h/o);if(l<c)return!1}return a>=0&&(n.fraction=c,i.MulRV(e.q,this.m_normals[a],n.normal),!0)},f.prototype.ComputeAABB=function(n,i){for(var h,u,e=r.MulXV(i,this.m_vertices[0],n.lowerBound),o=n.upperBound.Copy(e),s=0;s<this.m_count;++s)h=r.MulXV(i,this.m_vertices[s],f.ComputeAABB_s_v),t.MinV(h,e,e),t.MaxV(h,o,o);u=this.m_radius;e.SelfSubXY(u,u);o.SelfAddXY(u,u)},f.prototype.ComputeMass=function(n,i){for(var u=f.ComputeMass_s_center.SetZero(),h=0,y=0,e=f.ComputeMass_s_s.SetZero(),r=0;r<this.m_count;++r)e.SelfAdd(this.m_vertices[r]);for(e.SelfMul(1/this.m_count),r=0;r<this.m_count;++r){var o=t.SubVV(this.m_vertices[r],e,f.ComputeMass_s_e1),s=t.SubVV(this.m_vertices[(r+1)%this.m_count],e,f.ComputeMass_s_e2),p=t.CrossVV(o,s),w=.5*p;h+=w;u.SelfAdd(t.MulSV(w*(1/3),t.AddVV(o,s,t.s_t0),t.s_t1));var c=o.x,l=o.y,a=s.x,v=s.y;y+=1/3*.25*p*(c*c+a*c+a*a+l*l+v*l+v*v)}n.mass=i*h;u.SelfMul(1/h);t.AddVV(u,e,n.center);n.I=i*y;n.I+=n.mass*(t.DotVV(n.center,n.center)-t.DotVV(u,u))},f.prototype.Validate=function(){for(var o,n=0;n<this.m_count;++n)for(var r=n,u=(n+1)%this.m_count,e=this.m_vertices[r],s=t.SubVV(this.m_vertices[u],e,f.Validate_s_e),i=0;i<this.m_count;++i)if(i!==r&&i!==u&&(o=t.SubVV(this.m_vertices[i],e,f.Validate_s_v),t.CrossVV(s,o)<0))return!1;return!0},f.prototype.SetupDistanceProxy=function(n){n.m_vertices=this.m_vertices;n.m_count=this.m_count;n.m_radius=this.m_radius},f.prototype.ComputeSubmergedArea=function(n,u,e,o){for(var ft,d,rt,ot=i.MulTRV(e.q,n,f.ComputeSubmergedArea_s_normalL),st=u-t.DotVV(n,e.p),s=f.ComputeSubmergedArea_s_depths,ut=0,h=-1,l=-1,k=!1,c=0;c<this.m_count;++c)s[c]=t.DotVV(ot,this.m_vertices[c])-st,ft=s[c]<-p,c>0&&(ft?k||(h=c-1,ut++):k&&(l=c-1,ut++)),k=ft;switch(ut){case 0:return k?(d=f.ComputeSubmergedArea_s_md,this.ComputeMass(d,1),r.MulXV(e,d.center,o),d.mass):0;case 1:-1===h?h=this.m_count-1:l=this.m_count-1}for(var a,y=(h+1)%this.m_count,w=(l+1)%this.m_count,g=(0-s[h])/(s[y]-s[h]),nt=(0-s[l])/(s[w]-s[l]),v=f.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[h].x*(1-g)+this.m_vertices[y].x*g,this.m_vertices[h].y*(1-g)+this.m_vertices[y].y*g),ht=f.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[l].x*(1-nt)+this.m_vertices[w].x*nt,this.m_vertices[l].y*(1-nt)+this.m_vertices[w].y*nt),et=0,tt=f.ComputeSubmergedArea_s_center.SetZero(),b=this.m_vertices[y],it=y;it!==w;)a=(it=(it+1)%this.m_count)===w?ht:this.m_vertices[it],rt=.5*((b.x-v.x)*(a.y-v.y)-(b.y-v.y)*(a.x-v.x)),et+=rt,tt.x+=rt*(v.x+b.x+a.x)/3,tt.y+=rt*(v.y+b.y+a.y)/3,b=a;return tt.SelfMul(1/et),r.MulXV(e,tt,o),et},f.prototype.Dump=function(n){n("    const shape: b2PolygonShape = new b2PolygonShape();\n");n("    const vs: b2Vec2[] = b2Vec2.MakeArray(%d);\n",ct);for(var t=0;t<this.m_count;++t)n("    vs[%d].Set(%.15f, %.15f);\n",t,this.m_vertices[t].x,this.m_vertices[t].y);n("    shape.Set(vs, %d);\n",this.m_count)},f.ComputeCentroid=function(n,i,r){var u=r;u.SetZero();for(var l=0,a=f.ComputeCentroid_s_pRef.SetZero(),e=0;e<i;++e){var o=a,s=n[e],h=n[(e+1)%i],v=t.SubVV(s,o,f.ComputeCentroid_s_e1),y=t.SubVV(h,o,f.ComputeCentroid_s_e2),c=.5*t.CrossVV(v,y);l+=c;u.x+=c*(1/3)*(o.x+s.x+h.x);u.y+=c*(1/3)*(o.y+s.y+h.y)}return u.SelfMul(1/l),u},f.Set_s_ps=t.MakeArray(ct),f.Set_s_hull=lt(ct),f.Set_s_r=new t,f.Set_s_v=new t,f.TestPoint_s_pLocal=new t,f.ComputeDistance_s_pLocal=new t,f.ComputeDistance_s_normalForMaxDistance=new t,f.ComputeDistance_s_minDistance=new t,f.ComputeDistance_s_distance=new t,f.RayCast_s_p1=new t,f.RayCast_s_p2=new t,f.RayCast_s_d=new t,f.ComputeAABB_s_v=new t,f.ComputeMass_s_center=new t,f.ComputeMass_s_s=new t,f.ComputeMass_s_e1=new t,f.ComputeMass_s_e2=new t,f.Validate_s_e=new t,f.Validate_s_v=new t,f.ComputeSubmergedArea_s_normalL=new t,f.ComputeSubmergedArea_s_depths=lt(ct),f.ComputeSubmergedArea_s_md=new wi,f.ComputeSubmergedArea_s_intoVec=new t,f.ComputeSubmergedArea_s_outoVec=new t,f.ComputeSubmergedArea_s_center=new t,f.ComputeCentroid_s_pRef=new t,f.ComputeCentroid_s_e1=new t,f.ComputeCentroid_s_e2=new t,f}(ti),ai=function(u){function f(){var i=u.call(this,n.b2ShapeType.e_edgeShape,bt)||this;return i.m_vertex1=new t,i.m_vertex2=new t,i.m_vertex0=new t,i.m_vertex3=new t,i.m_hasVertex0=!1,i.m_hasVertex3=!1,i}return e(f,u),f.prototype.Set=function(n,t){return this.m_vertex1.Copy(n),this.m_vertex2.Copy(t),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},f.prototype.Clone=function(){return(new f).Copy(this)},f.prototype.Copy=function(n){return u.prototype.Copy.call(this,n),this.m_vertex1.Copy(n.m_vertex1),this.m_vertex2.Copy(n.m_vertex2),this.m_vertex0.Copy(n.m_vertex0),this.m_vertex3.Copy(n.m_vertex3),this.m_hasVertex0=n.m_hasVertex0,this.m_hasVertex3=n.m_hasVertex3,this},f.prototype.GetChildCount=function(){return 1},f.prototype.TestPoint=function(){return!1},f.prototype.ComputeDistance=function(n,i,u){var c=r.MulXV(n,this.m_vertex1,f.ComputeDistance_s_v1),l=r.MulXV(n,this.m_vertex2,f.ComputeDistance_s_v2),e=t.SubVV(i,c,f.ComputeDistance_s_d),o=t.SubVV(l,c,f.ComputeDistance_s_s),s=t.DotVV(e,o),h;return s>0&&(h=t.DotVV(o,o),s>h?t.SubVV(i,l,e):e.SelfMulSub(s/h,o)),u.Copy(e),u.Normalize()},f.prototype.RayCast=function(n,u,e){var h=r.MulTXV(e,u.p1,f.RayCast_s_p1),d=r.MulTXV(e,u.p2,f.RayCast_s_p2),a=t.SubVV(d,h,f.RayCast_s_d),s=this.m_vertex1,v=this.m_vertex2,y=t.SubVV(v,s,f.RayCast_s_e),p=n.normal.Set(y.y,-y.x).SelfNormalize(),w=t.DotVV(p,t.SubVV(s,h,t.s_t0)),b=t.DotVV(p,a),o,l;if(0===b||(o=w/b,o<0||u.maxFraction<o))return!1;var g=t.AddVMulSV(h,o,a,f.RayCast_s_q),c=t.SubVV(v,s,f.RayCast_s_r),k=t.DotVV(c,c);return 0===k?!1:(l=t.DotVV(t.SubVV(g,s,t.s_t0),c)/k,!(l<0||1<l||(n.fraction=o,i.MulRV(e.q,n.normal,n.normal),w>0&&n.normal.SelfNeg(),0)))},f.prototype.ComputeAABB=function(n,i){var e=r.MulXV(i,this.m_vertex1,f.ComputeAABB_s_v1),o=r.MulXV(i,this.m_vertex2,f.ComputeAABB_s_v2),u;t.MinV(e,o,n.lowerBound);t.MaxV(e,o,n.upperBound);u=this.m_radius;n.lowerBound.SelfSubXY(u,u);n.upperBound.SelfAddXY(u,u)},f.prototype.ComputeMass=function(n){n.mass=0;t.MidVV(this.m_vertex1,this.m_vertex2,n.center);n.I=0},f.prototype.SetupDistanceProxy=function(n){n.m_vertices=n.m_buffer;n.m_vertices[0].Copy(this.m_vertex1);n.m_vertices[1].Copy(this.m_vertex2);n.m_count=2;n.m_radius=this.m_radius},f.prototype.ComputeSubmergedArea=function(n,t,i,r){return r.SetZero(),0},f.prototype.Dump=function(n){n("    const shape: b2EdgeShape = new b2EdgeShape();\n");n("    shape.m_radius = %.15f;\n",this.m_radius);n("    shape.m_vertex0.Set(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y);n("    shape.m_vertex1.Set(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y);n("    shape.m_vertex2.Set(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y);n("    shape.m_vertex3.Set(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y);n("    shape.m_hasVertex0 = %s;\n",this.m_hasVertex0);n("    shape.m_hasVertex3 = %s;\n",this.m_hasVertex3)},f.ComputeDistance_s_v1=new t,f.ComputeDistance_s_v2=new t,f.ComputeDistance_s_d=new t,f.ComputeDistance_s_s=new t,f.RayCast_s_p1=new t,f.RayCast_s_p2=new t,f.RayCast_s_d=new t,f.RayCast_s_e=new t,f.RayCast_s_q=new t,f.RayCast_s_r=new t,f.ComputeAABB_s_v1=new t,f.ComputeAABB_s_v2=new t,f}(ti),wl=function(i){function u(){var r=i.call(this,n.b2ShapeType.e_chainShape,bt)||this;return r.m_vertices=[],r.m_count=0,r.m_prevVertex=new t,r.m_nextVertex=new t,r.m_hasPrevVertex=!1,r.m_hasNextVertex=!1,r}return e(u,i),u.prototype.CreateLoop=function(n,i,r){if(void 0===i&&(i=n.length),void 0===r&&(r=0),i<3)return this;this.m_count=i+1;this.m_vertices=t.MakeArray(this.m_count);for(var u=0;u<i;++u)this.m_vertices[u].Copy(n[r+u]);return this.m_vertices[i].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this},u.prototype.CreateChain=function(n,i,r){void 0===i&&(i=n.length);void 0===r&&(r=0);this.m_count=i;this.m_vertices=t.MakeArray(i);for(var u=0;u<i;++u)this.m_vertices[u].Copy(n[r+u]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero(),this},u.prototype.SetPrevVertex=function(n){return this.m_prevVertex.Copy(n),this.m_hasPrevVertex=!0,this},u.prototype.SetNextVertex=function(n){return this.m_nextVertex.Copy(n),this.m_hasNextVertex=!0,this},u.prototype.Clone=function(){return(new u).Copy(this)},u.prototype.Copy=function(n){return i.prototype.Copy.call(this,n),this.CreateChain(n.m_vertices,n.m_count),this.m_prevVertex.Copy(n.m_prevVertex),this.m_nextVertex.Copy(n.m_nextVertex),this.m_hasPrevVertex=n.m_hasPrevVertex,this.m_hasNextVertex=n.m_hasNextVertex,this},u.prototype.GetChildCount=function(){return this.m_count-1},u.prototype.GetChildEdge=function(t,i){t.m_type=n.b2ShapeType.e_edgeShape;t.m_radius=this.m_radius;t.m_vertex1.Copy(this.m_vertices[i]);t.m_vertex2.Copy(this.m_vertices[i+1]);i>0?(t.m_vertex0.Copy(this.m_vertices[i-1]),t.m_hasVertex0=!0):(t.m_vertex0.Copy(this.m_prevVertex),t.m_hasVertex0=this.m_hasPrevVertex);i<this.m_count-2?(t.m_vertex3.Copy(this.m_vertices[i+2]),t.m_hasVertex3=!0):(t.m_vertex3.Copy(this.m_nextVertex),t.m_hasVertex3=this.m_hasNextVertex)},u.prototype.TestPoint=function(){return!1},u.prototype.ComputeDistance=function(n,t,i,r){var f=u.ComputeDistance_s_edgeShape;return this.GetChildEdge(f,r),f.ComputeDistance(n,t,i,0)},u.prototype.RayCast=function(n,t,i,r){var f=u.RayCast_s_edgeShape;return f.m_vertex1.Copy(this.m_vertices[r]),f.m_vertex2.Copy(this.m_vertices[(r+1)%this.m_count]),f.RayCast(n,t,i,0)},u.prototype.ComputeAABB=function(n,i,f){var s=this.m_vertices[f],h=this.m_vertices[(f+1)%this.m_count],e=r.MulXV(i,s,u.ComputeAABB_s_v1),o=r.MulXV(i,h,u.ComputeAABB_s_v2);t.MinV(e,o,n.lowerBound);t.MaxV(e,o,n.upperBound)},u.prototype.ComputeMass=function(n){n.mass=0;n.center.SetZero();n.I=0},u.prototype.SetupDistanceProxy=function(n,t){n.m_vertices=n.m_buffer;n.m_vertices[0].Copy(this.m_vertices[t]);t+1<this.m_count?n.m_vertices[1].Copy(this.m_vertices[t+1]):n.m_vertices[1].Copy(this.m_vertices[0]);n.m_count=2;n.m_radius=this.m_radius},u.prototype.ComputeSubmergedArea=function(n,t,i,r){return r.SetZero(),0},u.prototype.Dump=function(n){n("    const shape: b2ChainShape = new b2ChainShape();\n");n("    const vs: b2Vec2[] = b2Vec2.MakeArray(%d);\n",ct);for(var t=0;t<this.m_count;++t)n("    vs[%d].Set(%.15f, %.15f);\n",t,this.m_vertices[t].x,this.m_vertices[t].y);n("    shape.CreateChain(vs, %d);\n",this.m_count);n("    shape.m_prevVertex.Set(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y);n("    shape.m_nextVertex.Set(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y);n("    shape.m_hasPrevVertex = %s;\n",this.m_hasPrevVertex?"true":"false");n("    shape.m_hasNextVertex = %s;\n",this.m_hasNextVertex?"true":"false")},u.ComputeDistance_s_edgeShape=new ai,u.RayCast_s_edgeShape=new ai,u.ComputeAABB_s_v1=new t,u.ComputeAABB_s_v2=new t,u}(ti),fr=function(){function n(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0}return n.prototype.Clone=function(){return(new n).Copy(this)},n.prototype.Copy=function(n){return this.categoryBits=n.categoryBits,this.maskBits=n.maskBits,this.groupIndex=n.groupIndex||0,this},n.DEFAULT=new n,n}(),ye=function(){this.userData=null;this.friction=.2;this.restitution=0;this.density=0;this.isSensor=!1;this.filter=new fr},eu=function(n){this.aabb=new b;this.childIndex=0;this.fixture=n},pe=function(){function n(n,t){this.m_density=0;this.m_next=null;this.m_friction=0;this.m_restitution=0;this.m_proxies=[];this.m_proxyCount=0;this.m_filter=new fr;this.m_isSensor=!1;this.m_userData=null;this.m_body=t;this.m_shape=n.shape.Clone()}return n.prototype.GetType=function(){return this.m_shape.GetType()},n.prototype.GetShape=function(){return this.m_shape},n.prototype.SetSensor=function(n){n!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=n)},n.prototype.IsSensor=function(){return this.m_isSensor},n.prototype.SetFilterData=function(n){this.m_filter.Copy(n);this.Refilter()},n.prototype.GetFilterData=function(){return this.m_filter},n.prototype.Refilter=function(){for(var r,u,t,n=this.m_body.GetContactList();n;){var i=n.contact,f=i.GetFixtureA(),e=i.GetFixtureB();f!==this&&e!==this||i.FlagForFiltering();n=n.next}if(r=this.m_body.GetWorld(),null!==r)for(u=r.m_contactManager.m_broadPhase,t=0;t<this.m_proxyCount;++t)u.TouchProxy(this.m_proxies[t].treeNode)},n.prototype.GetBody=function(){return this.m_body},n.prototype.GetNext=function(){return this.m_next},n.prototype.GetUserData=function(){return this.m_userData},n.prototype.SetUserData=function(n){this.m_userData=n},n.prototype.TestPoint=function(n){return this.m_shape.TestPoint(this.m_body.GetTransform(),n)},n.prototype.ComputeDistance=function(n,t,i){return this.m_shape.ComputeDistance(this.m_body.GetTransform(),n,t,i)},n.prototype.RayCast=function(n,t,i){return this.m_shape.RayCast(n,t,this.m_body.GetTransform(),i)},n.prototype.GetMassData=function(n){return void 0===n&&(n=new wi),this.m_shape.ComputeMass(n,this.m_density),n},n.prototype.SetDensity=function(n){this.m_density=n},n.prototype.GetDensity=function(){return this.m_density},n.prototype.GetFriction=function(){return this.m_friction},n.prototype.SetFriction=function(n){this.m_friction=n},n.prototype.GetRestitution=function(){return this.m_restitution},n.prototype.SetRestitution=function(n){this.m_restitution=n},n.prototype.GetAABB=function(n){return this.m_proxies[n].aabb},n.prototype.Dump=function(n,t){n("    const fd: b2FixtureDef = new b2FixtureDef();\n");n("    fd.friction = %.15f;\n",this.m_friction);n("    fd.restitution = %.15f;\n",this.m_restitution);n("    fd.density = %.15f;\n",this.m_density);n("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false");n("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits);n("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits);n("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex);this.m_shape.Dump(n);n("\n");n("    fd.shape = shape;\n");n("\n");n("    bodies[%d].CreateFixture(fd);\n",t)},n.prototype.Create=function(n){var t=this;this.m_userData=n.userData;this.m_friction=u(n.friction,.2);this.m_restitution=u(n.restitution,0);this.m_next=null;this.m_filter.Copy(u(n.filter,fr.DEFAULT));this.m_isSensor=u(n.isSensor,!1);this.m_proxies=k(this.m_shape.GetChildCount(),function(){return new eu(t)});this.m_proxyCount=0;this.m_density=u(n.density,0)},n.prototype.Destroy=function(){},n.prototype.CreateProxies=function(n){var r=this.m_body.m_world.m_contactManager.m_broadPhase,t,i;for(this.m_proxyCount=this.m_shape.GetChildCount(),t=0;t<this.m_proxyCount;++t)i=this.m_proxies[t]=new eu(this),this.m_shape.ComputeAABB(i.aabb,n,t),i.treeNode=r.CreateProxy(i.aabb,i),i.childIndex=t},n.prototype.DestroyProxies=function(){for(var t,i=this.m_body.m_world.m_contactManager.m_broadPhase,n=0;n<this.m_proxyCount;++n)t=this.m_proxies[n],delete t.treeNode.userData,i.DestroyProxy(t.treeNode),delete t.treeNode;this.m_proxyCount=0},n.prototype.TouchProxies=function(){for(var t=this.m_body.m_world.m_contactManager.m_broadPhase,i=this.m_proxyCount,n=0;n<i;++n)t.TouchProxy(this.m_proxies[n].treeNode)},n.prototype.Synchronize=function(i,r){var e,u,h;if(0!==this.m_proxyCount)for(e=this.m_body.m_world.m_contactManager.m_broadPhase,u=0;u<this.m_proxyCount;++u){var f=this.m_proxies[u],o=n.Synchronize_s_aabb1,s=n.Synchronize_s_aabb2;this.m_shape.ComputeAABB(o,i,u);this.m_shape.ComputeAABB(s,r,u);f.aabb.Combine2(o,s);h=t.SubVV(r.p,i.p,n.Synchronize_s_displacement);e.MoveProxy(f.treeNode,f.aabb,h)}},n.Synchronize_s_aabb1=new b,n.Synchronize_s_aabb2=new b,n.Synchronize_s_displacement=new t,n}();(ii=n.b2BodyType||(n.b2BodyType={}))[ii.b2_unknown=-1]="b2_unknown";ii[ii.b2_staticBody=0]="b2_staticBody";ii[ii.b2_kinematicBody=1]="b2_kinematicBody";ii[ii.b2_dynamicBody=2]="b2_dynamicBody";ou=function(){function f(i,f){this.m_type=n.b2BodyType.b2_staticBody;this.m_islandFlag=!1;this.m_awakeFlag=!1;this.m_autoSleepFlag=!1;this.m_bulletFlag=!1;this.m_fixedRotationFlag=!1;this.m_activeFlag=!1;this.m_toiFlag=!1;this.m_islandIndex=0;this.m_xf=new r;this.m_xf0=new r;this.m_sweep=new ht;this.m_linearVelocity=new t;this.m_angularVelocity=0;this.m_force=new t;this.m_torque=0;this.m_prev=null;this.m_next=null;this.m_fixtureList=null;this.m_fixtureCount=0;this.m_jointList=null;this.m_contactList=null;this.m_mass=1;this.m_invMass=1;this.m_I=0;this.m_invI=0;this.m_linearDamping=0;this.m_angularDamping=0;this.m_gravityScale=1;this.m_sleepTime=0;this.m_userData=null;this.m_controllerList=null;this.m_controllerCount=0;this.m_bulletFlag=u(i.bullet,!1);this.m_fixedRotationFlag=u(i.fixedRotation,!1);this.m_autoSleepFlag=u(i.allowSleep,!0);this.m_awakeFlag=u(i.awake,!0);this.m_activeFlag=u(i.active,!0);this.m_world=f;this.m_xf.p.Copy(u(i.position,t.ZERO));this.m_xf.q.SetAngle(u(i.angle,0));this.m_xf0.Copy(this.m_xf);this.m_sweep.localCenter.SetZero();this.m_sweep.c0.Copy(this.m_xf.p);this.m_sweep.c.Copy(this.m_xf.p);this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle();this.m_sweep.alpha0=0;this.m_linearVelocity.Copy(u(i.linearVelocity,t.ZERO));this.m_angularVelocity=u(i.angularVelocity,0);this.m_linearDamping=u(i.linearDamping,0);this.m_angularDamping=u(i.angularDamping,0);this.m_gravityScale=u(i.gravityScale,1);this.m_force.SetZero();this.m_torque=0;this.m_sleepTime=0;this.m_type=u(i.type,n.b2BodyType.b2_staticBody);i.type===n.b2BodyType.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0);this.m_I=0;this.m_invI=0;this.m_userData=i.userData;this.m_fixtureList=null;this.m_fixtureCount=0;this.m_controllerList=null;this.m_controllerCount=0}return f.prototype.CreateFixture=function(n,t){return void 0===t&&(t=0),n instanceof ti?this.CreateFixtureShapeDensity(n,t):this.CreateFixtureDef(n)},f.prototype.CreateFixtureDef=function(n){if(this.m_world.IsLocked())throw new Error;var t=new pe(n,this);return t.Create(n),this.m_activeFlag&&t.CreateProxies(this.m_xf),t.m_next=this.m_fixtureList,this.m_fixtureList=t,++this.m_fixtureCount,t.m_density>0&&this.ResetMassData(),this.m_world.m_newFixture=!0,t},f.prototype.CreateFixtureShapeDensity=function(n,t){void 0===t&&(t=0);var i=f.CreateFixtureShapeDensity_s_def;return i.shape=n,i.density=t,this.CreateFixtureDef(i)},f.prototype.DestroyFixture=function(n){var t,r,i,u,f,e;if(this.m_world.IsLocked())throw new Error;for(t=this.m_fixtureList,r=null;null!==t;){if(t===n){r?r.m_next=n.m_next:this.m_fixtureList=n.m_next;break}r=t;t=t.m_next}for(i=this.m_contactList;i;)u=i.contact,i=i.next,f=u.GetFixtureA(),e=u.GetFixtureB(),n!==f&&n!==e||this.m_world.m_contactManager.Destroy(u);this.m_activeFlag&&n.DestroyProxies();n.m_next=null;n.Destroy();--this.m_fixtureCount;this.ResetMassData()},f.prototype.SetTransformVec=function(n,t){this.SetTransformXY(n.x,n.y,t)},f.prototype.SetTransformXY=function(n,t,i){if(this.m_world.IsLocked())throw new Error;this.m_xf.q.SetAngle(i);this.m_xf.p.Set(n,t);this.m_xf0.Copy(this.m_xf);r.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c);this.m_sweep.a=i;this.m_sweep.c0.Copy(this.m_sweep.c);this.m_sweep.a0=i;for(var u=this.m_fixtureList;u;u=u.m_next)u.Synchronize(this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()},f.prototype.SetTransform=function(n){this.SetTransformVec(n.p,n.GetAngle())},f.prototype.GetTransform=function(){return this.m_xf},f.prototype.GetPosition=function(){return this.m_xf.p},f.prototype.SetPosition=function(n){this.SetTransformVec(n,this.GetAngle())},f.prototype.SetPositionXY=function(n,t){this.SetTransformXY(n,t,this.GetAngle())},f.prototype.GetAngle=function(){return this.m_sweep.a},f.prototype.SetAngle=function(n){this.SetTransformVec(this.GetPosition(),n)},f.prototype.GetWorldCenter=function(){return this.m_sweep.c},f.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},f.prototype.SetLinearVelocity=function(i){this.m_type!==n.b2BodyType.b2_staticBody&&(t.DotVV(i,i)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(i))},f.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},f.prototype.SetAngularVelocity=function(t){this.m_type!==n.b2BodyType.b2_staticBody&&(t*t>0&&this.SetAwake(!0),this.m_angularVelocity=t)},f.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},f.prototype.GetDefinition=function(n){return n.type=this.GetType(),n.allowSleep=this.m_autoSleepFlag,n.angle=this.GetAngle(),n.angularDamping=this.m_angularDamping,n.gravityScale=this.m_gravityScale,n.angularVelocity=this.m_angularVelocity,n.fixedRotation=this.m_fixedRotationFlag,n.bullet=this.m_bulletFlag,n.awake=this.m_awakeFlag,n.linearDamping=this.m_linearDamping,n.linearVelocity.Copy(this.GetLinearVelocity()),n.position.Copy(this.GetPosition()),n.userData=this.GetUserData(),n},f.prototype.ApplyForce=function(t,i,r){void 0===r&&(r=!0);this.m_type===n.b2BodyType.b2_dynamicBody&&(r&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(i.x-this.m_sweep.c.x)*t.y-(i.y-this.m_sweep.c.y)*t.x))},f.prototype.ApplyForceToCenter=function(t,i){void 0===i&&(i=!0);this.m_type===n.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y))},f.prototype.ApplyTorque=function(t,i){void 0===i&&(i=!0);this.m_type===n.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))},f.prototype.ApplyLinearImpulse=function(t,i,r){void 0===r&&(r=!0);this.m_type===n.b2BodyType.b2_dynamicBody&&(r&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((i.x-this.m_sweep.c.x)*t.y-(i.y-this.m_sweep.c.y)*t.x)))},f.prototype.ApplyLinearImpulseToCenter=function(t,i){void 0===i&&(i=!0);this.m_type===n.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y))},f.prototype.ApplyAngularImpulse=function(t,i){void 0===i&&(i=!0);this.m_type===n.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},f.prototype.GetMass=function(){return this.m_mass},f.prototype.GetInertia=function(){return this.m_I+this.m_mass*t.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)},f.prototype.GetMassData=function(n){return n.mass=this.m_mass,n.I=this.m_I+this.m_mass*t.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),n.center.Copy(this.m_sweep.localCenter),n},f.prototype.SetMassData=function(i){if(this.m_world.IsLocked())throw new Error;if(this.m_type===n.b2BodyType.b2_dynamicBody){this.m_invMass=0;this.m_I=0;this.m_invI=0;this.m_mass=i.mass;this.m_mass<=0&&(this.m_mass=1);this.m_invMass=1/this.m_mass;i.I>0&&!this.m_fixedRotationFlag&&(this.m_I=i.I-this.m_mass*t.DotVV(i.center,i.center),this.m_invI=1/this.m_I);var u=f.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(i.center);r.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c);this.m_sweep.c0.Copy(this.m_sweep.c);t.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,t.SubVV(this.m_sweep.c,u,t.s_t0),this.m_linearVelocity)}},f.prototype.ResetMassData=function(){var i,e,u,o;if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===n.b2BodyType.b2_staticBody||this.m_type===n.b2BodyType.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);for(i=f.ResetMassData_s_localCenter.SetZero(),e=this.m_fixtureList;e;e=e.m_next)0!==e.m_density&&(u=e.GetMassData(f.ResetMassData_s_massData),this.m_mass+=u.mass,i.x+=u.center.x*u.mass,i.y+=u.center.y*u.mass,this.m_I+=u.I);this.m_mass>0?(this.m_invMass=1/this.m_mass,i.x*=this.m_invMass,i.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1);this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*t.DotVV(i,i),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);o=f.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(i);r.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c);this.m_sweep.c0.Copy(this.m_sweep.c);t.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,t.SubVV(this.m_sweep.c,o,t.s_t0),this.m_linearVelocity)},f.prototype.GetWorldPoint=function(n,t){return r.MulXV(this.m_xf,n,t)},f.prototype.GetWorldVector=function(n,t){return i.MulRV(this.m_xf.q,n,t)},f.prototype.GetLocalPoint=function(n,t){return r.MulTXV(this.m_xf,n,t)},f.prototype.GetLocalVector=function(n,t){return i.MulTRV(this.m_xf.q,n,t)},f.prototype.GetLinearVelocityFromWorldPoint=function(n,i){return t.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,t.SubVV(n,this.m_sweep.c,t.s_t0),i)},f.prototype.GetLinearVelocityFromLocalPoint=function(n,t){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(n,t),t)},f.prototype.GetLinearDamping=function(){return this.m_linearDamping},f.prototype.SetLinearDamping=function(n){this.m_linearDamping=n},f.prototype.GetAngularDamping=function(){return this.m_angularDamping},f.prototype.SetAngularDamping=function(n){this.m_angularDamping=n},f.prototype.GetGravityScale=function(){return this.m_gravityScale},f.prototype.SetGravityScale=function(n){this.m_gravityScale=n},f.prototype.SetType=function(t){var i,u,r;if(this.m_world.IsLocked())throw new Error;if(this.m_type!==t){for(this.m_type=t,this.ResetMassData(),this.m_type===n.b2BodyType.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0,i=this.m_contactList;i;)u=i,i=i.next,this.m_world.m_contactManager.Destroy(u.contact);for(this.m_contactList=null,r=this.m_fixtureList;r;r=r.m_next)r.TouchProxies()}},f.prototype.GetType=function(){return this.m_type},f.prototype.SetBullet=function(n){this.m_bulletFlag=n},f.prototype.IsBullet=function(){return this.m_bulletFlag},f.prototype.SetSleepingAllowed=function(n){this.m_autoSleepFlag=n;n||this.SetAwake(!0)},f.prototype.IsSleepingAllowed=function(){return this.m_autoSleepFlag},f.prototype.SetAwake=function(n){n?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},f.prototype.IsAwake=function(){return this.m_awakeFlag},f.prototype.SetActive=function(n){var t,i,r;if(this.m_world.IsLocked())throw new Error;if(n!==this.IsActive())if(this.m_activeFlag=n,n)for(t=this.m_fixtureList;t;t=t.m_next)t.CreateProxies(this.m_xf);else{for(t=this.m_fixtureList;t;t=t.m_next)t.DestroyProxies();for(i=this.m_contactList;i;)r=i,i=i.next,this.m_world.m_contactManager.Destroy(r.contact);this.m_contactList=null}},f.prototype.IsActive=function(){return this.m_activeFlag},f.prototype.SetFixedRotation=function(n){this.m_fixedRotationFlag!==n&&(this.m_fixedRotationFlag=n,this.m_angularVelocity=0,this.ResetMassData())},f.prototype.IsFixedRotation=function(){return this.m_fixedRotationFlag},f.prototype.GetFixtureList=function(){return this.m_fixtureList},f.prototype.GetJointList=function(){return this.m_jointList},f.prototype.GetContactList=function(){return this.m_contactList},f.prototype.GetNext=function(){return this.m_next},f.prototype.GetUserData=function(){return this.m_userData},f.prototype.SetUserData=function(n){this.m_userData=n},f.prototype.GetWorld=function(){return this.m_world},f.prototype.Dump=function(t){var u=this.m_islandIndex,i,r;t("{\n");t("  const bd: b2BodyDef = new b2BodyDef();\n");i="";switch(this.m_type){case n.b2BodyType.b2_staticBody:i="b2BodyType.b2_staticBody";break;case n.b2BodyType.b2_kinematicBody:i="b2BodyType.b2_kinematicBody";break;case n.b2BodyType.b2_dynamicBody:i="b2BodyType.b2_dynamicBody"}for(t("  bd.type = %s;\n",i),t("  bd.position.Set(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y),t("  bd.angle = %.15f;\n",this.m_sweep.a),t("  bd.linearVelocity.Set(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y),t("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity),t("  bd.linearDamping = %.15f;\n",this.m_linearDamping),t("  bd.angularDamping = %.15f;\n",this.m_angularDamping),t("  bd.allowSleep = %s;\n",this.m_autoSleepFlag?"true":"false"),t("  bd.awake = %s;\n",this.m_awakeFlag?"true":"false"),t("  bd.fixedRotation = %s;\n",this.m_fixedRotationFlag?"true":"false"),t("  bd.bullet = %s;\n",this.m_bulletFlag?"true":"false"),t("  bd.active = %s;\n",this.m_activeFlag?"true":"false"),t("  bd.gravityScale = %.15f;\n",this.m_gravityScale),t("\n"),t("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex),t("\n"),r=this.m_fixtureList;r;r=r.m_next)t("  {\n"),r.Dump(t,u),t("  }\n");t("}\n")},f.prototype.SynchronizeFixtures=function(){var n=f.SynchronizeFixtures_s_xf1,r;for(n.q.SetAngle(this.m_sweep.a0),i.MulRV(n.q,this.m_sweep.localCenter,n.p),t.SubVV(this.m_sweep.c0,n.p,n.p),r=this.m_fixtureList;r;r=r.m_next)r.Synchronize(n,this.m_xf)},f.prototype.SynchronizeTransform=function(){this.m_xf.q.SetAngle(this.m_sweep.a);i.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p);t.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},f.prototype.ShouldCollide=function(t){return(this.m_type!==n.b2BodyType.b2_staticBody||t.m_type!==n.b2BodyType.b2_staticBody)&&this.ShouldCollideConnected(t)},f.prototype.ShouldCollideConnected=function(n){for(var t=this.m_jointList;t;t=t.next)if(t.other===n&&!t.joint.m_collideConnected)return!1;return!0},f.prototype.Advance=function(n){this.m_sweep.Advance(n);this.m_sweep.c.Copy(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.m_xf.q.SetAngle(this.m_sweep.a);i.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p);t.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},f.prototype.GetControllerList=function(){return this.m_controllerList},f.prototype.GetControllerCount=function(){return this.m_controllerCount},f.CreateFixtureShapeDensity_s_def=new ye,f.SetMassData_s_oldCenter=new t,f.ResetMassData_s_localCenter=new t,f.ResetMassData_s_oldCenter=new t,f.ResetMassData_s_massData=new wi,f.SynchronizeFixtures_s_xf1=new r,f}();(v=n.b2JointType||(n.b2JointType={}))[v.e_unknownJoint=0]="e_unknownJoint";v[v.e_revoluteJoint=1]="e_revoluteJoint";v[v.e_prismaticJoint=2]="e_prismaticJoint";v[v.e_distanceJoint=3]="e_distanceJoint";v[v.e_pulleyJoint=4]="e_pulleyJoint";v[v.e_mouseJoint=5]="e_mouseJoint";v[v.e_gearJoint=6]="e_gearJoint";v[v.e_wheelJoint=7]="e_wheelJoint";v[v.e_weldJoint=8]="e_weldJoint";v[v.e_frictionJoint=9]="e_frictionJoint";v[v.e_ropeJoint=10]="e_ropeJoint";v[v.e_motorJoint=11]="e_motorJoint";v[v.e_areaJoint=12]="e_areaJoint";(ri=n.b2LimitState||(n.b2LimitState={}))[ri.e_inactiveLimit=0]="e_inactiveLimit";ri[ri.e_atLowerLimit=1]="e_atLowerLimit";ri[ri.e_atUpperLimit=2]="e_atUpperLimit";ri[ri.e_equalLimits=3]="e_equalLimits";var bl=function(){function n(){this.linear=new t;this.angularA=0;this.angularB=0}return n.prototype.SetZero=function(){return this.linear.SetZero(),this.angularA=0,this.angularB=0,this},n.prototype.Set=function(n,t,i){return this.linear.Copy(n),this.angularA=t,this.angularB=i,this},n}(),su=function(n,t){this.prev=null;this.next=null;this.joint=n;this.other=t},ft=function(t){this.type=n.b2JointType.e_unknownJoint;this.userData=null;this.collideConnected=!1;this.type=t},et=function(){function t(t){this.m_type=n.b2JointType.e_unknownJoint;this.m_prev=null;this.m_next=null;this.m_index=0;this.m_islandFlag=!1;this.m_collideConnected=!1;this.m_userData=null;this.m_type=t.type;this.m_edgeA=new su(this,t.bodyB);this.m_edgeB=new su(this,t.bodyA);this.m_bodyA=t.bodyA;this.m_bodyB=t.bodyB;this.m_collideConnected=u(t.collideConnected,!1);this.m_userData=t.userData}return t.prototype.GetType=function(){return this.m_type},t.prototype.GetBodyA=function(){return this.m_bodyA},t.prototype.GetBodyB=function(){return this.m_bodyB},t.prototype.GetNext=function(){return this.m_next},t.prototype.GetUserData=function(){return this.m_userData},t.prototype.SetUserData=function(n){this.m_userData=n},t.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},t.prototype.GetCollideConnected=function(){return this.m_collideConnected},t.prototype.Dump=function(n){n("// Dump is not supported for this joint type.\n")},t.prototype.ShiftOrigin=function(){},t}(),we=function(i){function r(){var r=i.call(this,n.b2JointType.e_distanceJoint)||this;return r.localAnchorA=new t,r.localAnchorB=new t,r.length=1,r.frequencyHz=0,r.dampingRatio=0,r}return e(r,i),r.prototype.Initialize=function(n,i,r,u){this.bodyA=n;this.bodyB=i;this.bodyA.GetLocalPoint(r,this.localAnchorA);this.bodyB.GetLocalPoint(u,this.localAnchorB);this.length=t.DistanceVV(r,u);this.frequencyHz=0;this.dampingRatio=0},r}(ft),be=function(n){function r(r){var f=n.call(this,r)||this;return f.m_frequencyHz=0,f.m_dampingRatio=0,f.m_bias=0,f.m_localAnchorA=new t,f.m_localAnchorB=new t,f.m_gamma=0,f.m_impulse=0,f.m_length=0,f.m_indexA=0,f.m_indexB=0,f.m_u=new t,f.m_rA=new t,f.m_rB=new t,f.m_localCenterA=new t,f.m_localCenterB=new t,f.m_invMassA=0,f.m_invMassB=0,f.m_invIA=0,f.m_invIB=0,f.m_mass=0,f.m_qA=new i,f.m_qB=new i,f.m_lalcA=new t,f.m_lalcB=new t,f.m_frequencyHz=u(r.frequencyHz,0),f.m_dampingRatio=u(r.dampingRatio,0),f.m_localAnchorA.Copy(r.localAnchorA),f.m_localAnchorB.Copy(r.localAnchorB),f.m_length=r.length,f}return e(r,n),r.prototype.GetAnchorA=function(n){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,n)},r.prototype.GetAnchorB=function(n){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,n)},r.prototype.GetReactionForce=function(n,t){return t.x=n*this.m_impulse*this.m_u.x,t.y=n*this.m_impulse*this.m_u.y,t},r.prototype.GetReactionTorque=function(){return 0},r.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},r.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},r.prototype.SetLength=function(n){this.m_length=n},r.prototype.Length=function(){return this.m_length},r.prototype.SetFrequency=function(n){this.m_frequencyHz=n},r.prototype.GetFrequency=function(){return this.m_frequencyHz},r.prototype.SetDampingRatio=function(n){this.m_dampingRatio=n},r.prototype.GetDampingRatio=function(){return this.m_dampingRatio},r.prototype.Dump=function(n){var t=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;n("  const jd: b2DistanceJointDef = new b2DistanceJointDef();\n");n("  jd.bodyA = bodies[%d];\n",t);n("  jd.bodyB = bodies[%d];\n",i);n("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false");n("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);n("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y);n("  jd.length = %.15f;\n",this.m_length);n("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz);n("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio);n("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},r.prototype.InitVelocityConstraints=function(n){var e,f;this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var c=n.positions[this.m_indexA].c,b=n.positions[this.m_indexA].a,k=n.velocities[this.m_indexA].v,l=n.velocities[this.m_indexA].w,a=n.positions[this.m_indexB].c,d=n.positions[this.m_indexB].a,g=n.velocities[this.m_indexB].v,v=n.velocities[this.m_indexB].w,nt=this.m_qA.SetAngle(b),tt=this.m_qB.SetAngle(d);t.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);i.MulRV(nt,this.m_lalcA,this.m_rA);t.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);i.MulRV(tt,this.m_lalcB,this.m_rB);this.m_u.x=a.x+this.m_rB.x-c.x-this.m_rA.x;this.m_u.y=a.y+this.m_rB.y-c.y-this.m_rA.y;e=this.m_u.Length();e>s?this.m_u.SelfMul(1/e):this.m_u.SetZero();var y=t.CrossVV(this.m_rA,this.m_u),p=t.CrossVV(this.m_rB,this.m_u),u=this.m_invMassA+this.m_invIA*y*y+this.m_invMassB+this.m_invIB*p*p;if(this.m_mass=0!==u?1/u:0,this.m_frequencyHz>0){var it=e-this.m_length,o=2*ut*this.m_frequencyHz,rt=2*this.m_mass*this.m_dampingRatio*o,w=this.m_mass*o*o,h=n.step.dt;this.m_gamma=h*(rt+h*w);this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0;this.m_bias=it*h*w*this.m_gamma;u+=this.m_gamma;this.m_mass=0!==u?1/u:0}else this.m_gamma=0,this.m_bias=0;n.step.warmStarting?(this.m_impulse*=n.step.dtRatio,f=t.MulSV(this.m_impulse,this.m_u,r.InitVelocityConstraints_s_P),k.SelfMulSub(this.m_invMassA,f),l-=this.m_invIA*t.CrossVV(this.m_rA,f),g.SelfMulAdd(this.m_invMassB,f),v+=this.m_invIB*t.CrossVV(this.m_rB,f)):this.m_impulse=0;n.velocities[this.m_indexA].w=l;n.velocities[this.m_indexB].w=v},r.prototype.SolveVelocityConstraints=function(n){var e=n.velocities[this.m_indexA].v,u=n.velocities[this.m_indexA].w,o=n.velocities[this.m_indexB].v,f=n.velocities[this.m_indexB].w,h=t.AddVCrossSV(e,u,this.m_rA,r.SolveVelocityConstraints_s_vpA),c=t.AddVCrossSV(o,f,this.m_rB,r.SolveVelocityConstraints_s_vpB),l=t.DotVV(this.m_u,t.SubVV(c,h,t.s_t0)),s=-this.m_mass*(l+this.m_bias+this.m_gamma*this.m_impulse),i;this.m_impulse+=s;i=t.MulSV(s,this.m_u,r.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,i);u-=this.m_invIA*t.CrossVV(this.m_rA,i);o.SelfMulAdd(this.m_invMassB,i);f+=this.m_invIB*t.CrossVV(this.m_rB,i);n.velocities[this.m_indexA].w=u;n.velocities[this.m_indexB].w=f},r.prototype.SolvePositionConstraints=function(n){var u,w,f;if(this.m_frequencyHz>0)return!0;var e=n.positions[this.m_indexA].c,o=n.positions[this.m_indexA].a,h=n.positions[this.m_indexB].c,c=n.positions[this.m_indexB].a,b=this.m_qA.SetAngle(o),k=this.m_qB.SetAngle(c),a=i.MulRV(b,this.m_lalcA,this.m_rA),v=i.MulRV(k,this.m_lalcB,this.m_rB),p=this.m_u;return p.x=h.x+v.x-e.x-a.x,p.y=h.y+v.y-e.y-a.y,u=this.m_u.Normalize()-this.m_length,u=y(u,-.2,.2),w=-this.m_mass*u,f=t.MulSV(w,p,r.SolvePositionConstraints_s_P),e.SelfMulSub(this.m_invMassA,f),o-=this.m_invIA*t.CrossVV(a,f),h.SelfMulAdd(this.m_invMassB,f),c+=this.m_invIB*t.CrossVV(v,f),n.positions[this.m_indexA].a=o,n.positions[this.m_indexB].a=c,l(u)<s},r.InitVelocityConstraints_s_P=new t,r.SolveVelocityConstraints_s_vpA=new t,r.SolveVelocityConstraints_s_vpB=new t,r.SolveVelocityConstraints_s_P=new t,r.SolvePositionConstraints_s_P=new t,r}(et),kl=function(t){function i(){var i=t.call(this,n.b2JointType.e_areaJoint)||this;return i.bodies=[],i.frequencyHz=0,i.dampingRatio=0,i}return e(i,t),i.prototype.AddBody=function(n){this.bodies.push(n);1===this.bodies.length?this.bodyA=n:2===this.bodies.length&&(this.bodyB=n)},i}(ft),ke=function(n){function i(i){var r=n.call(this,i)||this,e,f;for(r.m_frequencyHz=0,r.m_dampingRatio=0,r.m_impulse=0,r.m_targetArea=0,r.m_bodies=i.bodies,r.m_frequencyHz=u(i.frequencyHz,0),r.m_dampingRatio=u(i.dampingRatio,0),r.m_targetLengths=lt(i.bodies.length),r.m_normals=t.MakeArray(i.bodies.length),r.m_joints=[],r.m_deltas=t.MakeArray(i.bodies.length),r.m_delta=new t,e=new we,e.frequencyHz=r.m_frequencyHz,e.dampingRatio=r.m_dampingRatio,r.m_targetArea=0,f=0;f<r.m_bodies.length;++f){var o=r.m_bodies[f],c=r.m_bodies[(f+1)%r.m_bodies.length],s=o.GetWorldCenter(),h=c.GetWorldCenter();r.m_targetLengths[f]=t.DistanceVV(s,h);r.m_targetArea+=t.CrossVV(s,h);e.Initialize(o,c,s,h);r.m_joints[f]=o.GetWorld().CreateJoint(e)}return r.m_targetArea*=.5,r}return e(i,n),i.prototype.GetAnchorA=function(n){return n},i.prototype.GetAnchorB=function(n){return n},i.prototype.GetReactionForce=function(n,t){return t},i.prototype.GetReactionTorque=function(){return 0},i.prototype.SetFrequency=function(n){this.m_frequencyHz=n;for(var t=0;t<this.m_joints.length;++t)this.m_joints[t].SetFrequency(n)},i.prototype.GetFrequency=function(){return this.m_frequencyHz},i.prototype.SetDampingRatio=function(n){this.m_dampingRatio=n;for(var t=0;t<this.m_joints.length;++t)this.m_joints[t].SetDampingRatio(n)},i.prototype.GetDampingRatio=function(){return this.m_dampingRatio},i.prototype.Dump=function(n){n("Area joint dumping is not supported.\n")},i.prototype.InitVelocityConstraints=function(n){for(var u,f,i=0;i<this.m_bodies.length;++i){var e=this.m_bodies[(i+this.m_bodies.length-1)%this.m_bodies.length],o=this.m_bodies[(i+1)%this.m_bodies.length],s=n.positions[e.m_islandIndex].c,h=n.positions[o.m_islandIndex].c,r=this.m_deltas[i];t.SubVV(h,s,r)}if(n.step.warmStarting)for(this.m_impulse*=n.step.dtRatio,i=0;i<this.m_bodies.length;++i)u=this.m_bodies[i],f=n.velocities[u.m_islandIndex].v,r=this.m_deltas[i],f.x+=u.m_invMass*r.y*.5*this.m_impulse,f.y+=u.m_invMass*-r.x*.5*this.m_impulse;else this.m_impulse=0},i.prototype.SolveVelocityConstraints=function(n){for(var r,u,e,f,o=0,s=0,i=0;i<this.m_bodies.length;++i)r=this.m_bodies[i],u=n.velocities[r.m_islandIndex].v,o+=(f=this.m_deltas[i]).LengthSquared()/r.GetMass(),s+=t.CrossVV(u,f);for(e=-2*s/o,this.m_impulse+=e,i=0;i<this.m_bodies.length;++i)r=this.m_bodies[i],u=n.velocities[r.m_islandIndex].v,f=this.m_deltas[i],u.x+=r.m_invMass*f.y*.5*e,u.y+=r.m_invMass*-f.x*.5*e},i.prototype.SolvePositionConstraints=function(n){for(var v,c,r,y,e,l=0,o=0,i=0;i<this.m_bodies.length;++i){var h=this.m_bodies[i],w=this.m_bodies[(i+1)%this.m_bodies.length],u=n.positions[h.m_islandIndex].c,a=n.positions[w.m_islandIndex].c,f=(r=t.SubVV(a,u,this.m_delta)).Length();f<p&&(f=1);this.m_normals[i].x=r.y/f;this.m_normals[i].y=-r.x/f;l+=f;o+=t.CrossVV(u,a)}for(o*=.5,v=.5*(this.m_targetArea-o)/l,c=!0,i=0;i<this.m_bodies.length;++i)h=this.m_bodies[i],u=n.positions[h.m_islandIndex].c,y=(i+1)%this.m_bodies.length,(r=t.AddVV(this.m_normals[i],this.m_normals[y],this.m_delta)).SelfMul(v),e=r.LengthSquared(),e>hi(.2)&&r.SelfMul(.2/at(e)),e>hi(s)&&(c=!1),u.x+=r.x,u.y+=r.y;return c},i}(et),dl=function(i){function r(){var r=i.call(this,n.b2JointType.e_frictionJoint)||this;return r.localAnchorA=new t,r.localAnchorB=new t,r.maxForce=0,r.maxTorque=0,r}return e(r,i),r.prototype.Initialize=function(n,t,i){this.bodyA=n;this.bodyB=t;this.bodyA.GetLocalPoint(i,this.localAnchorA);this.bodyB.GetLocalPoint(i,this.localAnchorB)},r}(ft),de=function(n){function r(r){var f=n.call(this,r)||this;return f.m_localAnchorA=new t,f.m_localAnchorB=new t,f.m_linearImpulse=new t,f.m_angularImpulse=0,f.m_maxForce=0,f.m_maxTorque=0,f.m_indexA=0,f.m_indexB=0,f.m_rA=new t,f.m_rB=new t,f.m_localCenterA=new t,f.m_localCenterB=new t,f.m_invMassA=0,f.m_invMassB=0,f.m_invIA=0,f.m_invIB=0,f.m_linearMass=new nt,f.m_angularMass=0,f.m_qA=new i,f.m_qB=new i,f.m_lalcA=new t,f.m_lalcB=new t,f.m_K=new nt,f.m_localAnchorA.Copy(r.localAnchorA),f.m_localAnchorB.Copy(r.localAnchorB),f.m_linearImpulse.SetZero(),f.m_maxForce=u(r.maxForce,0),f.m_maxTorque=u(r.maxTorque,0),f.m_linearMass.SetZero(),f}return e(r,n),r.prototype.InitVelocityConstraints=function(n){var r,s;this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var v=n.positions[this.m_indexA].a,y=n.velocities[this.m_indexA].v,l=n.velocities[this.m_indexA].w,p=n.positions[this.m_indexB].a,w=n.velocities[this.m_indexB].v,a=n.velocities[this.m_indexB].w,b=this.m_qA.SetAngle(v),k=this.m_qB.SetAngle(p);t.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);r=i.MulRV(b,this.m_lalcA,this.m_rA);t.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var u=i.MulRV(k,this.m_lalcB,this.m_rB),h=this.m_invMassA,c=this.m_invMassB,e=this.m_invIA,o=this.m_invIB,f=this.m_K;(f.ex.x=h+c+e*r.y*r.y+o*u.y*u.y,f.ex.y=-e*r.x*r.y-o*u.x*u.y,f.ey.x=f.ex.y,f.ey.y=h+c+e*r.x*r.x+o*u.x*u.x,f.GetInverse(this.m_linearMass),this.m_angularMass=e+o,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),n.step.warmStarting)?(this.m_linearImpulse.SelfMul(n.step.dtRatio),this.m_angularImpulse*=n.step.dtRatio,s=this.m_linearImpulse,y.SelfMulSub(h,s),l-=e*(t.CrossVV(this.m_rA,s)+this.m_angularImpulse),w.SelfMulAdd(c,s),a+=o*(t.CrossVV(this.m_rB,s)+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0);n.velocities[this.m_indexA].w=l;n.velocities[this.m_indexB].w=a},r.prototype.SolveVelocityConstraints=function(n){var s=n.velocities[this.m_indexA].v,f=n.velocities[this.m_indexA].w,h=n.velocities[this.m_indexB].v,e=n.velocities[this.m_indexB].w,v=this.m_invMassA,p=this.m_invMassB,c=this.m_invIA,l=this.m_invIB,a=n.step.dt,w=e-f,o=-this.m_angularMass*w,b=this.m_angularImpulse,i=a*this.m_maxTorque;this.m_angularImpulse=y(this.m_angularImpulse+o,-i,i);f-=c*(o=this.m_angularImpulse-b);e+=l*o;var k=t.SubVV(t.AddVCrossSV(h,e,this.m_rB,t.s_t0),t.AddVCrossSV(s,f,this.m_rA,t.s_t1),r.SolveVelocityConstraints_s_Cdot_v2),u=nt.MulMV(this.m_linearMass,k,r.SolveVelocityConstraints_s_impulseV).SelfNeg(),d=r.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(u);i=a*this.m_maxForce;this.m_linearImpulse.LengthSquared()>i*i&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(i));t.SubVV(this.m_linearImpulse,d,u);s.SelfMulSub(v,u);f-=c*t.CrossVV(this.m_rA,u);h.SelfMulAdd(p,u);e+=l*t.CrossVV(this.m_rB,u);n.velocities[this.m_indexA].w=f;n.velocities[this.m_indexB].w=e},r.prototype.SolvePositionConstraints=function(){return!0},r.prototype.GetAnchorA=function(n){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,n)},r.prototype.GetAnchorB=function(n){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,n)},r.prototype.GetReactionForce=function(n,t){return t.x=n*this.m_linearImpulse.x,t.y=n*this.m_linearImpulse.y,t},r.prototype.GetReactionTorque=function(n){return n*this.m_angularImpulse},r.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},r.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},r.prototype.SetMaxForce=function(n){this.m_maxForce=n},r.prototype.GetMaxForce=function(){return this.m_maxForce},r.prototype.SetMaxTorque=function(n){this.m_maxTorque=n},r.prototype.GetMaxTorque=function(){return this.m_maxTorque},r.prototype.Dump=function(n){var t=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;n("  const jd: b2FrictionJointDef = new b2FrictionJointDef();\n");n("  jd.bodyA = bodies[%d];\n",t);n("  jd.bodyB = bodies[%d];\n",i);n("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false");n("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);n("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y);n("  jd.maxForce = %.15f;\n",this.m_maxForce);n("  jd.maxTorque = %.15f;\n",this.m_maxTorque);n("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},r.SolveVelocityConstraints_s_Cdot_v2=new t,r.SolveVelocityConstraints_s_impulseV=new t,r.SolveVelocityConstraints_s_oldImpulseV=new t,r}(et),gl=function(t){function i(){var i=t.call(this,n.b2JointType.e_gearJoint)||this;return i.ratio=1,i}return e(i,t),i}(ft),ge=function(r){function f(f){var h,c,e=r.call(this,f)||this,s,o,v,y,b,k;e.m_typeA=n.b2JointType.e_unknownJoint;e.m_typeB=n.b2JointType.e_unknownJoint;e.m_localAnchorA=new t;e.m_localAnchorB=new t;e.m_localAnchorC=new t;e.m_localAnchorD=new t;e.m_localAxisC=new t;e.m_localAxisD=new t;e.m_referenceAngleA=0;e.m_referenceAngleB=0;e.m_constant=0;e.m_ratio=0;e.m_impulse=0;e.m_indexA=0;e.m_indexB=0;e.m_indexC=0;e.m_indexD=0;e.m_lcA=new t;e.m_lcB=new t;e.m_lcC=new t;e.m_lcD=new t;e.m_mA=0;e.m_mB=0;e.m_mC=0;e.m_mD=0;e.m_iA=0;e.m_iB=0;e.m_iC=0;e.m_iD=0;e.m_JvAC=new t;e.m_JvBD=new t;e.m_JwA=0;e.m_JwB=0;e.m_JwC=0;e.m_JwD=0;e.m_mass=0;e.m_qA=new i;e.m_qB=new i;e.m_qC=new i;e.m_qD=new i;e.m_lalcA=new t;e.m_lalcB=new t;e.m_lalcC=new t;e.m_lalcD=new t;e.m_joint1=f.joint1;e.m_joint2=f.joint2;e.m_typeA=e.m_joint1.GetType();e.m_typeB=e.m_joint2.GetType();e.m_bodyC=e.m_joint1.GetBodyA();e.m_bodyA=e.m_joint1.GetBodyB();var l=e.m_bodyA.m_xf,d=e.m_bodyA.m_sweep.a,a=e.m_bodyC.m_xf,g=e.m_bodyC.m_sweep.a;e.m_typeA===n.b2JointType.e_revoluteJoint?(s=f.joint1,e.m_localAnchorC.Copy(s.m_localAnchorA),e.m_localAnchorA.Copy(s.m_localAnchorB),e.m_referenceAngleA=s.m_referenceAngle,e.m_localAxisC.SetZero(),h=d-g-e.m_referenceAngleA):(o=f.joint1,e.m_localAnchorC.Copy(o.m_localAnchorA),e.m_localAnchorA.Copy(o.m_localAnchorB),e.m_referenceAngleA=o.m_referenceAngle,e.m_localAxisC.Copy(o.m_localXAxisA),v=e.m_localAnchorC,y=i.MulTRV(a.q,t.AddVV(i.MulRV(l.q,e.m_localAnchorA,t.s_t0),t.SubVV(l.p,a.p,t.s_t1),t.s_t0),t.s_t0),h=t.DotVV(t.SubVV(y,v,t.s_t0),e.m_localAxisC));e.m_bodyD=e.m_joint2.GetBodyA();e.m_bodyB=e.m_joint2.GetBodyB();var p=e.m_bodyB.m_xf,nt=e.m_bodyB.m_sweep.a,w=e.m_bodyD.m_xf,tt=e.m_bodyD.m_sweep.a;return e.m_typeB===n.b2JointType.e_revoluteJoint?(s=f.joint2,e.m_localAnchorD.Copy(s.m_localAnchorA),e.m_localAnchorB.Copy(s.m_localAnchorB),e.m_referenceAngleB=s.m_referenceAngle,e.m_localAxisD.SetZero(),c=nt-tt-e.m_referenceAngleB):(o=f.joint2,e.m_localAnchorD.Copy(o.m_localAnchorA),e.m_localAnchorB.Copy(o.m_localAnchorB),e.m_referenceAngleB=o.m_referenceAngle,e.m_localAxisD.Copy(o.m_localXAxisA),b=e.m_localAnchorD,k=i.MulTRV(w.q,t.AddVV(i.MulRV(p.q,e.m_localAnchorB,t.s_t0),t.SubVV(p.p,w.p,t.s_t1),t.s_t0),t.s_t0),c=t.DotVV(t.SubVV(k,b,t.s_t0),e.m_localAxisD)),e.m_ratio=u(f.ratio,1),e.m_constant=h+e.m_ratio*c,e.m_impulse=0,e}return e(f,r),f.prototype.InitVelocityConstraints=function(r){var u,a,v,y,p;this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_indexC=this.m_bodyC.m_islandIndex;this.m_indexD=this.m_bodyD.m_islandIndex;this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter);this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter);this.m_mA=this.m_bodyA.m_invMass;this.m_mB=this.m_bodyB.m_invMass;this.m_mC=this.m_bodyC.m_invMass;this.m_mD=this.m_bodyD.m_invMass;this.m_iA=this.m_bodyA.m_invI;this.m_iB=this.m_bodyB.m_invI;this.m_iC=this.m_bodyC.m_invI;this.m_iD=this.m_bodyD.m_invI;var w=r.positions[this.m_indexA].a,b=r.velocities[this.m_indexA].v,e=r.velocities[this.m_indexA].w,k=r.positions[this.m_indexB].a,d=r.velocities[this.m_indexB].v,o=r.velocities[this.m_indexB].w,g=r.positions[this.m_indexC].a,nt=r.velocities[this.m_indexC].v,s=r.velocities[this.m_indexC].w,tt=r.positions[this.m_indexD].a,it=r.velocities[this.m_indexD].v,h=r.velocities[this.m_indexD].w,rt=this.m_qA.SetAngle(w),ut=this.m_qB.SetAngle(k),c=this.m_qC.SetAngle(g),l=this.m_qD.SetAngle(tt);(this.m_mass=0,this.m_typeA===n.b2JointType.e_revoluteJoint)?(this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC):(u=i.MulRV(c,this.m_localAxisC,f.InitVelocityConstraints_s_u),t.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC),a=i.MulRV(c,this.m_lalcC,f.InitVelocityConstraints_s_rC),t.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA),v=i.MulRV(rt,this.m_lalcA,f.InitVelocityConstraints_s_rA),this.m_JvAC.Copy(u),this.m_JwC=t.CrossVV(a,u),this.m_JwA=t.CrossVV(v,u),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA);this.m_typeB===n.b2JointType.e_revoluteJoint?(this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD)):(u=i.MulRV(l,this.m_localAxisD,f.InitVelocityConstraints_s_u),t.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD),y=i.MulRV(l,this.m_lalcD,f.InitVelocityConstraints_s_rD),t.SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB),p=i.MulRV(ut,this.m_lalcB,f.InitVelocityConstraints_s_rB),t.MulSV(this.m_ratio,u,this.m_JvBD),this.m_JwD=this.m_ratio*t.CrossVV(y,u),this.m_JwB=this.m_ratio*t.CrossVV(p,u),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB);this.m_mass=this.m_mass>0?1/this.m_mass:0;r.step.warmStarting?(b.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),e+=this.m_iA*this.m_impulse*this.m_JwA,d.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),o+=this.m_iB*this.m_impulse*this.m_JwB,nt.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),s-=this.m_iC*this.m_impulse*this.m_JwC,it.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),h-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0;r.velocities[this.m_indexA].w=e;r.velocities[this.m_indexB].w=o;r.velocities[this.m_indexC].w=s;r.velocities[this.m_indexD].w=h},f.prototype.SolveVelocityConstraints=function(n){var o=n.velocities[this.m_indexA].v,r=n.velocities[this.m_indexA].w,s=n.velocities[this.m_indexB].v,u=n.velocities[this.m_indexB].w,h=n.velocities[this.m_indexC].v,f=n.velocities[this.m_indexC].w,c=n.velocities[this.m_indexD].v,e=n.velocities[this.m_indexD].w,l=t.DotVV(this.m_JvAC,t.SubVV(o,h,t.s_t0))+t.DotVV(this.m_JvBD,t.SubVV(s,c,t.s_t0)),i;l+=this.m_JwA*r-this.m_JwC*f+(this.m_JwB*u-this.m_JwD*e);i=-this.m_mass*l;this.m_impulse+=i;o.SelfMulAdd(this.m_mA*i,this.m_JvAC);r+=this.m_iA*i*this.m_JwA;s.SelfMulAdd(this.m_mB*i,this.m_JvBD);u+=this.m_iB*i*this.m_JwB;h.SelfMulSub(this.m_mC*i,this.m_JvAC);f-=this.m_iC*i*this.m_JwC;c.SelfMulSub(this.m_mD*i,this.m_JvBD);e-=this.m_iD*i*this.m_JwD;n.velocities[this.m_indexA].w=r;n.velocities[this.m_indexB].w=u;n.velocities[this.m_indexC].w=f;n.velocities[this.m_indexD].w=e},f.prototype.SolvePositionConstraints=function(r){var d,g,h,c,l,a,rt=r.positions[this.m_indexA].c,v=r.positions[this.m_indexA].a,ut=r.positions[this.m_indexB].c,y=r.positions[this.m_indexB].a,ft=r.positions[this.m_indexC].c,p=r.positions[this.m_indexC].a,et=r.positions[this.m_indexD].c,w=r.positions[this.m_indexD].a,yt=this.m_qA.SetAngle(v),pt=this.m_qB.SetAngle(y),nt=this.m_qC.SetAngle(p),tt=this.m_qD.SetAngle(w),b=this.m_JvAC,k=this.m_JvBD,o=0,st,ht,ct,it,lt,at,vt,u;if(this.m_typeA===n.b2JointType.e_revoluteJoint)b.SetZero(),h=1,l=1,o+=this.m_iA+this.m_iC,d=v-p-this.m_referenceAngleA;else{var e=i.MulRV(nt,this.m_localAxisC,f.SolvePositionConstraints_s_u),wt=i.MulRV(nt,this.m_lalcC,f.SolvePositionConstraints_s_rC),ot=i.MulRV(yt,this.m_lalcA,f.SolvePositionConstraints_s_rA);b.Copy(e);l=t.CrossVV(wt,e);h=t.CrossVV(ot,e);o+=this.m_mC+this.m_mA+this.m_iC*l*l+this.m_iA*h*h;st=this.m_lalcC;ht=i.MulTRV(nt,t.AddVV(ot,t.SubVV(rt,ft,t.s_t0),t.s_t0),t.s_t0);d=t.DotVV(t.SubVV(ht,st,t.s_t0),this.m_localAxisC)}return this.m_typeB===n.b2JointType.e_revoluteJoint?(k.SetZero(),c=this.m_ratio,a=this.m_ratio,o+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),g=y-w-this.m_referenceAngleB):(e=i.MulRV(tt,this.m_localAxisD,f.SolvePositionConstraints_s_u),ct=i.MulRV(tt,this.m_lalcD,f.SolvePositionConstraints_s_rD),it=i.MulRV(pt,this.m_lalcB,f.SolvePositionConstraints_s_rB),t.MulSV(this.m_ratio,e,k),a=this.m_ratio*t.CrossVV(ct,e),c=this.m_ratio*t.CrossVV(it,e),o+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*a*a+this.m_iB*c*c,lt=this.m_lalcD,at=i.MulTRV(tt,t.AddVV(it,t.SubVV(ut,et,t.s_t0),t.s_t0),t.s_t0),g=t.DotVV(t.SubVV(at,lt,t.s_t0),this.m_localAxisD)),vt=d+this.m_ratio*g-this.m_constant,u=0,o>0&&(u=-vt/o),rt.SelfMulAdd(this.m_mA*u,b),v+=this.m_iA*u*h,ut.SelfMulAdd(this.m_mB*u,k),y+=this.m_iB*u*c,ft.SelfMulSub(this.m_mC*u,b),p-=this.m_iC*u*l,et.SelfMulSub(this.m_mD*u,k),w-=this.m_iD*u*a,r.positions[this.m_indexA].a=v,r.positions[this.m_indexB].a=y,r.positions[this.m_indexC].a=p,r.positions[this.m_indexD].a=w,0<s},f.prototype.GetAnchorA=function(n){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,n)},f.prototype.GetAnchorB=function(n){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,n)},f.prototype.GetReactionForce=function(n,i){return t.MulSV(n*this.m_impulse,this.m_JvAC,i)},f.prototype.GetReactionTorque=function(n){return n*this.m_impulse*this.m_JwA},f.prototype.GetJoint1=function(){return this.m_joint1},f.prototype.GetJoint2=function(){return this.m_joint2},f.prototype.GetRatio=function(){return this.m_ratio},f.prototype.SetRatio=function(n){this.m_ratio=n},f.prototype.Dump=function(n){var t=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex,r=this.m_joint1.m_index,u=this.m_joint2.m_index;n("  const jd: b2GearJointDef = new b2GearJointDef();\n");n("  jd.bodyA = bodies[%d];\n",t);n("  jd.bodyB = bodies[%d];\n",i);n("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false");n("  jd.joint1 = joints[%d];\n",r);n("  jd.joint2 = joints[%d];\n",u);n("  jd.ratio = %.15f;\n",this.m_ratio);n("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},f.InitVelocityConstraints_s_u=new t,f.InitVelocityConstraints_s_rA=new t,f.InitVelocityConstraints_s_rB=new t,f.InitVelocityConstraints_s_rC=new t,f.InitVelocityConstraints_s_rD=new t,f.SolvePositionConstraints_s_u=new t,f.SolvePositionConstraints_s_rA=new t,f.SolvePositionConstraints_s_rB=new t,f.SolvePositionConstraints_s_rC=new t,f.SolvePositionConstraints_s_rD=new t,f}(et),na=function(i){function r(){var r=i.call(this,n.b2JointType.e_motorJoint)||this;return r.linearOffset=new t(0,0),r.angularOffset=0,r.maxForce=1,r.maxTorque=1,r.correctionFactor=.3,r}return e(r,i),r.prototype.Initialize=function(n,t){this.bodyA=n;this.bodyB=t;this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);var i=this.bodyA.GetAngle(),r=this.bodyB.GetAngle();this.angularOffset=r-i},r}(ft),no=function(n){function r(r){var f=n.call(this,r)||this;return f.m_linearOffset=new t,f.m_angularOffset=0,f.m_linearImpulse=new t,f.m_angularImpulse=0,f.m_maxForce=0,f.m_maxTorque=0,f.m_correctionFactor=.3,f.m_indexA=0,f.m_indexB=0,f.m_rA=new t,f.m_rB=new t,f.m_localCenterA=new t,f.m_localCenterB=new t,f.m_linearError=new t,f.m_angularError=0,f.m_invMassA=0,f.m_invMassB=0,f.m_invIA=0,f.m_invIB=0,f.m_linearMass=new nt,f.m_angularMass=0,f.m_qA=new i,f.m_qB=new i,f.m_K=new nt,f.m_linearOffset.Copy(u(r.linearOffset,t.ZERO)),f.m_linearImpulse.SetZero(),f.m_maxForce=u(r.maxForce,0),f.m_maxTorque=u(r.maxTorque,0),f.m_correctionFactor=u(r.correctionFactor,.3),f}return e(r,n),r.prototype.GetAnchorA=function(n){var t=this.m_bodyA.GetPosition();return n.x=t.x,n.y=t.y,n},r.prototype.GetAnchorB=function(n){var t=this.m_bodyB.GetPosition();return n.x=t.x,n.y=t.y,n},r.prototype.GetReactionForce=function(n,i){return t.MulSV(n,this.m_linearImpulse,i)},r.prototype.GetReactionTorque=function(n){return n*this.m_angularImpulse},r.prototype.SetLinearOffset=function(n){t.IsEqualToV(n,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(n))},r.prototype.GetLinearOffset=function(){return this.m_linearOffset},r.prototype.SetAngularOffset=function(n){n!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=n)},r.prototype.GetAngularOffset=function(){return this.m_angularOffset},r.prototype.SetMaxForce=function(n){this.m_maxForce=n},r.prototype.GetMaxForce=function(){return this.m_maxForce},r.prototype.SetMaxTorque=function(n){this.m_maxTorque=n},r.prototype.GetMaxTorque=function(){return this.m_maxTorque},r.prototype.InitVelocityConstraints=function(n){var s;this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var p=n.positions[this.m_indexA].c,l=n.positions[this.m_indexA].a,w=n.velocities[this.m_indexA].v,a=n.velocities[this.m_indexA].w,b=n.positions[this.m_indexB].c,v=n.positions[this.m_indexB].a,k=n.velocities[this.m_indexB].v,y=n.velocities[this.m_indexB].w,d=this.m_qA.SetAngle(l),g=this.m_qB.SetAngle(v),r=i.MulRV(d,t.SubVV(this.m_linearOffset,this.m_localCenterA,t.s_t0),this.m_rA),u=i.MulRV(g,t.NegV(this.m_localCenterB,t.s_t0),this.m_rB),h=this.m_invMassA,c=this.m_invMassB,e=this.m_invIA,o=this.m_invIB,f=this.m_K;(f.ex.x=h+c+e*r.y*r.y+o*u.y*u.y,f.ex.y=-e*r.x*r.y-o*u.x*u.y,f.ey.x=f.ex.y,f.ey.y=h+c+e*r.x*r.x+o*u.x*u.x,f.GetInverse(this.m_linearMass),this.m_angularMass=e+o,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.SubVV(t.AddVV(b,u,t.s_t0),t.AddVV(p,r,t.s_t1),this.m_linearError),this.m_angularError=v-l-this.m_angularOffset,n.step.warmStarting)?(this.m_linearImpulse.SelfMul(n.step.dtRatio),this.m_angularImpulse*=n.step.dtRatio,s=this.m_linearImpulse,w.SelfMulSub(h,s),a-=e*(t.CrossVV(r,s)+this.m_angularImpulse),k.SelfMulAdd(c,s),y+=o*(t.CrossVV(u,s)+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0);n.velocities[this.m_indexA].w=a;n.velocities[this.m_indexB].w=y},r.prototype.SolveVelocityConstraints=function(n){var s=n.velocities[this.m_indexA].v,f=n.velocities[this.m_indexA].w,h=n.velocities[this.m_indexB].v,e=n.velocities[this.m_indexB].w,b=this.m_invMassA,k=this.m_invMassB,c=this.m_invIA,l=this.m_invIB,a=n.step.dt,v=n.step.inv_dt,d=e-f+v*this.m_correctionFactor*this.m_angularError,o=-this.m_angularMass*d,g=this.m_angularImpulse,i=a*this.m_maxTorque;this.m_angularImpulse=y(this.m_angularImpulse+o,-i,i);f-=c*(o=this.m_angularImpulse-g);e+=l*o;var p=this.m_rA,w=this.m_rB,tt=t.AddVV(t.SubVV(t.AddVV(h,t.CrossSV(e,w,t.s_t0),t.s_t0),t.AddVV(s,t.CrossSV(f,p,t.s_t1),t.s_t1),t.s_t2),t.MulSV(v*this.m_correctionFactor,this.m_linearError,t.s_t3),r.SolveVelocityConstraints_s_Cdot_v2),u=nt.MulMV(this.m_linearMass,tt,r.SolveVelocityConstraints_s_impulse_v2).SelfNeg(),it=r.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(u);i=a*this.m_maxForce;this.m_linearImpulse.LengthSquared()>i*i&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(i));t.SubVV(this.m_linearImpulse,it,u);s.SelfMulSub(b,u);f-=c*t.CrossVV(p,u);h.SelfMulAdd(k,u);e+=l*t.CrossVV(w,u);n.velocities[this.m_indexA].w=f;n.velocities[this.m_indexB].w=e},r.prototype.SolvePositionConstraints=function(){return!0},r.prototype.Dump=function(n){var t=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;n("  const jd: b2MotorJointDef = new b2MotorJointDef();\n");n("  jd.bodyA = bodies[%d];\n",t);n("  jd.bodyB = bodies[%d];\n",i);n("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false");n("  jd.linearOffset.Set(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y);n("  jd.angularOffset = %.15f;\n",this.m_angularOffset);n("  jd.maxForce = %.15f;\n",this.m_maxForce);n("  jd.maxTorque = %.15f;\n",this.m_maxTorque);n("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor);n("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},r.SolveVelocityConstraints_s_Cdot_v2=new t,r.SolveVelocityConstraints_s_impulse_v2=new t,r.SolveVelocityConstraints_s_oldImpulse_v2=new t,r}(et),ta=function(i){function r(){var r=i.call(this,n.b2JointType.e_mouseJoint)||this;return r.target=new t,r.maxForce=0,r.frequencyHz=5,r.dampingRatio=.7,r}return e(r,i),r}(ft),to=function(n){function f(f){var e=n.call(this,f)||this;return e.m_localAnchorB=new t,e.m_targetA=new t,e.m_frequencyHz=0,e.m_dampingRatio=0,e.m_beta=0,e.m_impulse=new t,e.m_maxForce=0,e.m_gamma=0,e.m_indexA=0,e.m_indexB=0,e.m_rB=new t,e.m_localCenterB=new t,e.m_invMassB=0,e.m_invIB=0,e.m_mass=new nt,e.m_C=new t,e.m_qB=new i,e.m_lalcB=new t,e.m_K=new nt,e.m_targetA.Copy(u(f.target,t.ZERO)),r.MulTXV(e.m_bodyB.GetTransform(),e.m_targetA,e.m_localAnchorB),e.m_maxForce=u(f.maxForce,0),e.m_impulse.SetZero(),e.m_frequencyHz=u(f.frequencyHz,0),e.m_dampingRatio=u(f.dampingRatio,0),e.m_beta=0,e.m_gamma=0,e}return e(f,n),f.prototype.SetTarget=function(n){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0);this.m_targetA.Copy(n)},f.prototype.GetTarget=function(){return this.m_targetA},f.prototype.SetMaxForce=function(n){this.m_maxForce=n},f.prototype.GetMaxForce=function(){return this.m_maxForce},f.prototype.SetFrequency=function(n){this.m_frequencyHz=n},f.prototype.GetFrequency=function(){return this.m_frequencyHz},f.prototype.SetDampingRatio=function(n){this.m_dampingRatio=n},f.prototype.GetDampingRatio=function(){return this.m_dampingRatio},f.prototype.InitVelocityConstraints=function(n){var r;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIB=this.m_bodyB.m_invI;var o=n.positions[this.m_indexB].c,l=n.positions[this.m_indexB].a,s=n.velocities[this.m_indexB].v,u=n.velocities[this.m_indexB].w,a=this.m_qB.SetAngle(l),h=this.m_bodyB.GetMass(),f=2*ut*this.m_frequencyHz,v=2*h*this.m_dampingRatio*f,c=h*f*f,e=n.step.dt;this.m_gamma=e*(v+e*c);0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma);this.m_beta=e*c*this.m_gamma;t.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);i.MulRV(a,this.m_lalcB,this.m_rB);r=this.m_K;r.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma;r.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y;r.ey.x=r.ex.y;r.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma;r.GetInverse(this.m_mass);this.m_C.x=o.x+this.m_rB.x-this.m_targetA.x;this.m_C.y=o.y+this.m_rB.y-this.m_targetA.y;this.m_C.SelfMul(this.m_beta);u*=.98;n.step.warmStarting?(this.m_impulse.SelfMul(n.step.dtRatio),s.x+=this.m_invMassB*this.m_impulse.x,s.y+=this.m_invMassB*this.m_impulse.y,u+=this.m_invIB*t.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero();n.velocities[this.m_indexB].w=u},f.prototype.SolveVelocityConstraints=function(n){var e=n.velocities[this.m_indexB].v,u=n.velocities[this.m_indexB].w,o=t.AddVCrossSV(e,u,this.m_rB,f.SolveVelocityConstraints_s_Cdot),i=nt.MulMV(this.m_mass,t.AddVV(o,t.AddVV(this.m_C,t.MulSV(this.m_gamma,this.m_impulse,t.s_t0),t.s_t0),t.s_t0).SelfNeg(),f.SolveVelocityConstraints_s_impulse),s=f.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse),r;this.m_impulse.SelfAdd(i);r=n.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>r*r&&this.m_impulse.SelfMul(r/this.m_impulse.Length());t.SubVV(this.m_impulse,s,i);e.SelfMulAdd(this.m_invMassB,i);u+=this.m_invIB*t.CrossVV(this.m_rB,i);n.velocities[this.m_indexB].w=u},f.prototype.SolvePositionConstraints=function(){return!0},f.prototype.GetAnchorA=function(n){return n.x=this.m_targetA.x,n.y=this.m_targetA.y,n},f.prototype.GetAnchorB=function(n){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,n)},f.prototype.GetReactionForce=function(n,i){return t.MulSV(n,this.m_impulse,i)},f.prototype.GetReactionTorque=function(){return 0},f.prototype.Dump=function(n){n("Mouse joint dumping is not supported.\n")},f.prototype.ShiftOrigin=function(n){this.m_targetA.SelfSub(n)},f.SolveVelocityConstraints_s_Cdot=new t,f.SolveVelocityConstraints_s_impulse=new t,f.SolveVelocityConstraints_s_oldImpulse=new t,f}(et),ia=function(i){function r(){var r=i.call(this,n.b2JointType.e_prismaticJoint)||this;return r.localAnchorA=new t,r.localAnchorB=new t,r.localAxisA=new t(1,0),r.referenceAngle=0,r.enableLimit=!1,r.lowerTranslation=0,r.upperTranslation=0,r.enableMotor=!1,r.maxMotorForce=0,r.motorSpeed=0,r}return e(r,i),r.prototype.Initialize=function(n,t,i,r){this.bodyA=n;this.bodyB=t;this.bodyA.GetLocalPoint(i,this.localAnchorA);this.bodyB.GetLocalPoint(i,this.localAnchorB);this.bodyA.GetLocalVector(r,this.localAxisA);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},r}(ft),io=function(r){function h(f){var e=r.call(this,f)||this;return e.m_localAnchorA=new t,e.m_localAnchorB=new t,e.m_localXAxisA=new t,e.m_localYAxisA=new t,e.m_referenceAngle=0,e.m_impulse=new g(0,0,0),e.m_motorImpulse=0,e.m_lowerTranslation=0,e.m_upperTranslation=0,e.m_maxMotorForce=0,e.m_motorSpeed=0,e.m_enableLimit=!1,e.m_enableMotor=!1,e.m_limitState=n.b2LimitState.e_inactiveLimit,e.m_indexA=0,e.m_indexB=0,e.m_localCenterA=new t,e.m_localCenterB=new t,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_axis=new t(0,0),e.m_perp=new t(0,0),e.m_s1=0,e.m_s2=0,e.m_a1=0,e.m_a2=0,e.m_K=new kt,e.m_K3=new kt,e.m_K2=new nt,e.m_motorMass=0,e.m_qA=new i,e.m_qB=new i,e.m_lalcA=new t,e.m_lalcB=new t,e.m_rA=new t,e.m_rB=new t,e.m_localAnchorA.Copy(u(f.localAnchorA,t.ZERO)),e.m_localAnchorB.Copy(u(f.localAnchorB,t.ZERO)),e.m_localXAxisA.Copy(u(f.localAxisA,new t(1,0))).SelfNormalize(),t.CrossOneV(e.m_localXAxisA,e.m_localYAxisA),e.m_referenceAngle=u(f.referenceAngle,0),e.m_lowerTranslation=u(f.lowerTranslation,0),e.m_upperTranslation=u(f.upperTranslation,0),e.m_maxMotorForce=u(f.maxMotorForce,0),e.m_motorSpeed=u(f.motorSpeed,0),e.m_enableLimit=u(f.enableLimit,!1),e.m_enableMotor=u(f.enableMotor,!1),e}return e(h,r),h.prototype.InitVelocityConstraints=function(r){var e,p;this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var d=r.positions[this.m_indexA].c,g=r.positions[this.m_indexA].a,nt=r.velocities[this.m_indexA].v,w=r.velocities[this.m_indexA].w,tt=r.positions[this.m_indexB].c,it=r.positions[this.m_indexB].a,rt=r.velocities[this.m_indexB].v,b=r.velocities[this.m_indexB].w,a=this.m_qA.SetAngle(g),ut=this.m_qB.SetAngle(it);t.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);e=i.MulRV(a,this.m_lalcA,this.m_rA);t.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var v=i.MulRV(ut,this.m_lalcB,this.m_rB),y=t.AddVV(t.SubVV(tt,d,t.s_t0),t.SubVV(v,e,t.s_t1),h.InitVelocityConstraints_s_d),o=this.m_invMassA,c=this.m_invMassB,u=this.m_invIA,f=this.m_invIB;if((i.MulRV(a,this.m_localXAxisA,this.m_axis),this.m_a1=t.CrossVV(t.AddVV(y,e,t.s_t0),this.m_axis),this.m_a2=t.CrossVV(v,this.m_axis),this.m_motorMass=o+c+u*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),i.MulRV(a,this.m_localYAxisA,this.m_perp),this.m_s1=t.CrossVV(t.AddVV(y,e,t.s_t0),this.m_perp),this.m_s2=t.CrossVV(v,this.m_perp),this.m_K.ex.x=o+c+u*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,this.m_K.ex.y=u*this.m_s1+f*this.m_s2,this.m_K.ex.z=u*this.m_s1*this.m_a1+f*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=u+f,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=u*this.m_a1+f*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=o+c+u*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2,this.m_enableLimit)?(p=t.DotVV(this.m_axis,y),l(this.m_upperTranslation-this.m_lowerTranslation)<2*s?this.m_limitState=n.b2LimitState.e_equalLimits:p<=this.m_lowerTranslation?this.m_limitState!==n.b2LimitState.e_atLowerLimit&&(this.m_limitState=n.b2LimitState.e_atLowerLimit,this.m_impulse.z=0):p>=this.m_upperTranslation?this.m_limitState!==n.b2LimitState.e_atUpperLimit&&(this.m_limitState=n.b2LimitState.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=n.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)):(this.m_limitState=n.b2LimitState.e_inactiveLimit,this.m_impulse.z=0),this.m_enableMotor||(this.m_motorImpulse=0),r.step.warmStarting){this.m_impulse.SelfMul(r.step.dtRatio);this.m_motorImpulse*=r.step.dtRatio;var k=t.AddVV(t.MulSV(this.m_impulse.x,this.m_perp,t.s_t0),t.MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,t.s_t1),h.InitVelocityConstraints_s_P),ft=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,et=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;nt.SelfMulSub(o,k);w-=u*ft;rt.SelfMulAdd(c,k);b+=f*et}else this.m_impulse.SetZero(),this.m_motorImpulse=0;r.velocities[this.m_indexA].w=w;r.velocities[this.m_indexB].w=b},h.prototype.SolveVelocityConstraints=function(i){var a=i.velocities[this.m_indexA].v,u=i.velocities[this.m_indexA].w,v=i.velocities[this.m_indexB].v,e=i.velocities[this.m_indexB].w,nt=this.m_invMassA,tt=this.m_invMassB,it=this.m_invIA,rt=this.m_invIB,k,d,c;if(this.m_enableMotor&&this.m_limitState!==n.b2LimitState.e_equalLimits){var ft=t.DotVV(this.m_axis,t.SubVV(v,a,t.s_t0))+this.m_a2*e-this.m_a1*u,p=this.m_motorMass*(this.m_motorSpeed-ft),et=this.m_motorImpulse,ut=i.step.dt*this.m_maxMotorForce;this.m_motorImpulse=y(this.m_motorImpulse+p,-ut,ut);p=this.m_motorImpulse-et;var s=t.MulSV(p,this.m_axis,h.SolveVelocityConstraints_s_P),w=p*this.m_a1,b=p*this.m_a2;a.SelfMulSub(nt,s);u-=it*w;v.SelfMulAdd(tt,s);e+=rt*b}if(k=t.DotVV(this.m_perp,t.SubVV(v,a,t.s_t0))+this.m_s2*e-this.m_s1*u,d=e-u,this.m_enableLimit&&this.m_limitState!==n.b2LimitState.e_inactiveLimit){var ot=t.DotVV(this.m_axis,t.SubVV(v,a,t.s_t0))+this.m_a2*e-this.m_a1*u,l=h.SolveVelocityConstraints_s_f1.Copy(this.m_impulse),r=this.m_K.Solve33(-k,-d,-ot,h.SolveVelocityConstraints_s_df3);this.m_impulse.SelfAdd(r);this.m_limitState===n.b2LimitState.e_atLowerLimit?this.m_impulse.z=f(this.m_impulse.z,0):this.m_limitState===n.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=o(this.m_impulse.z,0));var st=-k-(this.m_impulse.z-l.z)*this.m_K.ez.x,ht=-d-(this.m_impulse.z-l.z)*this.m_K.ez.y,g=this.m_K.Solve22(st,ht,h.SolveVelocityConstraints_s_f2r);g.x+=l.x;g.y+=l.y;this.m_impulse.x=g.x;this.m_impulse.y=g.y;r.x=this.m_impulse.x-l.x;r.y=this.m_impulse.y-l.y;r.z=this.m_impulse.z-l.z;s=t.AddVV(t.MulSV(r.x,this.m_perp,t.s_t0),t.MulSV(r.z,this.m_axis,t.s_t1),h.SolveVelocityConstraints_s_P);w=r.x*this.m_s1+r.y+r.z*this.m_a1;b=r.x*this.m_s2+r.y+r.z*this.m_a2;a.SelfMulSub(nt,s);u-=it*w;v.SelfMulAdd(tt,s);e+=rt*b}else c=this.m_K.Solve22(-k,-d,h.SolveVelocityConstraints_s_df2),this.m_impulse.x+=c.x,this.m_impulse.y+=c.y,s=t.MulSV(c.x,this.m_perp,h.SolveVelocityConstraints_s_P),w=c.x*this.m_s1+c.y,b=c.x*this.m_s2+c.y,a.SelfMulSub(nt,s),u-=it*w,v.SelfMulAdd(tt,s),e+=rt*b;i.velocities[this.m_indexA].w=u;i.velocities[this.m_indexB].w=e},h.prototype.SolvePositionConstraints=function(n){var bt=n.positions[this.m_indexA].c,d=n.positions[this.m_indexA].a,kt=n.positions[this.m_indexB].c,g=n.positions[this.m_indexB].a,ht=this.m_qA.SetAngle(d),ti=this.m_qB.SetAngle(g),nt=this.m_invMassA,tt=this.m_invMassB,u=this.m_invIA,e=this.m_invIB,ct=i.MulRV(ht,this.m_lalcA,this.m_rA),lt=i.MulRV(ti,this.m_lalcB,this.m_rB),it=t.SubVV(t.AddVV(kt,lt,t.s_t0),t.AddVV(bt,ct,t.s_t1),h.SolvePositionConstraints_s_d),rt=i.MulRV(ht,this.m_localXAxisA,this.m_axis),w=t.CrossVV(t.AddVV(it,ct,t.s_t0),rt),b=t.CrossVV(lt,rt),ut=i.MulRV(ht,this.m_localYAxisA,this.m_perp),c=t.CrossVV(t.AddVV(it,ct,t.s_t0),ut),a=t.CrossVV(lt,ut),r=h.SolvePositionConstraints_s_impulse,at=t.DotVV(ut,it),vt=g-d-this.m_referenceAngle,v=l(at),ii=l(vt),ft=!1,et=0,o,p,st,wt;if(this.m_enableLimit&&(o=t.DotVV(rt,it),l(this.m_upperTranslation-this.m_lowerTranslation)<2*s?(et=y(o,-.2,.2),v=f(v,l(o)),ft=!0):o<=this.m_lowerTranslation?(et=y(o-this.m_lowerTranslation+s,-.2,0),v=f(v,this.m_lowerTranslation-o),ft=!0):o>=this.m_upperTranslation&&(et=y(o-this.m_upperTranslation-s,0,.2),v=f(v,o-this.m_upperTranslation),ft=!0)),ft){var pt=nt+tt+u*c*c+e*a*a,k=u*c+e*a,dt=u*c*w+e*a*b;0===(p=u+e)&&(p=1);var gt=u*w+e*b,ri=nt+tt+u*w*w+e*b*b,ot=this.m_K3;ot.ex.SetXYZ(pt,k,dt);ot.ey.SetXYZ(k,p,gt);ot.ez.SetXYZ(dt,gt,ri);r=ot.Solve33(-at,-vt,-et,r)}else pt=nt+tt+u*c*c+e*a*a,k=u*c+e*a,0===(p=u+e)&&(p=1),st=this.m_K2,st.ex.Set(pt,k),st.ey.Set(k,p),wt=st.Solve(-at,-vt,h.SolvePositionConstraints_s_impulse1),r.x=wt.x,r.y=wt.y,r.z=0;var ni=t.AddVV(t.MulSV(r.x,ut,t.s_t0),t.MulSV(r.z,rt,t.s_t1),h.SolvePositionConstraints_s_P),ui=r.x*c+r.y+r.z*w,fi=r.x*a+r.y+r.z*b;return bt.SelfMulSub(nt,ni),d-=u*ui,kt.SelfMulAdd(tt,ni),g+=e*fi,n.positions[this.m_indexA].a=d,n.positions[this.m_indexB].a=g,v<=s&&ii<=yt},h.prototype.GetAnchorA=function(n){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,n)},h.prototype.GetAnchorB=function(n){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,n)},h.prototype.GetReactionForce=function(n,t){return t.x=n*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t.y=n*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y),t},h.prototype.GetReactionTorque=function(n){return n*this.m_impulse.y},h.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},h.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},h.prototype.GetLocalAxisA=function(){return this.m_localXAxisA},h.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},h.prototype.GetJointTranslation=function(){var n=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,h.GetJointTranslation_s_pA),i=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,h.GetJointTranslation_s_pB),r=t.SubVV(i,n,h.GetJointTranslation_s_d),u=this.m_bodyA.GetWorldVector(this.m_localXAxisA,h.GetJointTranslation_s_axis);return t.DotVV(r,u)},h.prototype.GetJointSpeed=function(){var n=this.m_bodyA,r=this.m_bodyB,u;t.SubVV(this.m_localAnchorA,n.m_sweep.localCenter,this.m_lalcA);u=i.MulRV(n.m_xf.q,this.m_lalcA,this.m_rA);t.SubVV(this.m_localAnchorB,r.m_sweep.localCenter,this.m_lalcB);var f=i.MulRV(r.m_xf.q,this.m_lalcB,this.m_rB),s=t.AddVV(n.m_sweep.c,u,t.s_t0),h=t.AddVV(r.m_sweep.c,f,t.s_t1),c=t.SubVV(h,s,t.s_t2),e=n.GetWorldVector(this.m_localXAxisA,this.m_axis),l=n.m_linearVelocity,a=r.m_linearVelocity,o=n.m_angularVelocity,v=r.m_angularVelocity;return t.DotVV(c,t.CrossSV(o,e,t.s_t0))+t.DotVV(e,t.SubVV(t.AddVCrossSV(a,v,f,t.s_t0),t.AddVCrossSV(l,o,u,t.s_t1),t.s_t0))},h.prototype.IsLimitEnabled=function(){return this.m_enableLimit},h.prototype.EnableLimit=function(n){n!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=n,this.m_impulse.z=0)},h.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},h.prototype.GetUpperLimit=function(){return this.m_upperTranslation},h.prototype.SetLimits=function(n,t){n===this.m_lowerTranslation&&t===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=n,this.m_upperTranslation=t,this.m_impulse.z=0)},h.prototype.IsMotorEnabled=function(){return this.m_enableMotor},h.prototype.EnableMotor=function(n){n!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=n)},h.prototype.SetMotorSpeed=function(n){n!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=n)},h.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},h.prototype.SetMaxMotorForce=function(n){n!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=n)},h.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},h.prototype.GetMotorForce=function(n){return n*this.m_motorImpulse},h.prototype.Dump=function(n){var t=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;n("  const jd: b2PrismaticJointDef = new b2PrismaticJointDef();\n");n("  jd.bodyA = bodies[%d];\n",t);n("  jd.bodyB = bodies[%d];\n",i);n("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false");n("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);n("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y);n("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y);n("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle);n("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false");n("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation);n("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation);n("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false");n("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed);n("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce);n("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},h.InitVelocityConstraints_s_d=new t,h.InitVelocityConstraints_s_P=new t,h.SolveVelocityConstraints_s_P=new t,h.SolveVelocityConstraints_s_f2r=new t,h.SolveVelocityConstraints_s_f1=new g,h.SolveVelocityConstraints_s_df3=new g,h.SolveVelocityConstraints_s_df2=new t,h.SolvePositionConstraints_s_d=new t,h.SolvePositionConstraints_s_impulse=new g,h.SolvePositionConstraints_s_impulse1=new t,h.SolvePositionConstraints_s_P=new t,h.GetJointTranslation_s_pA=new t,h.GetJointTranslation_s_pB=new t,h.GetJointTranslation_s_d=new t,h.GetJointTranslation_s_axis=new t,h}(et),ra=function(i){function r(){var r=i.call(this,n.b2JointType.e_pulleyJoint)||this;return r.groundAnchorA=new t(-1,1),r.groundAnchorB=new t(1,1),r.localAnchorA=new t(-1,0),r.localAnchorB=new t(1,0),r.lengthA=0,r.lengthB=0,r.ratio=1,r.collideConnected=!0,r}return e(r,i),r.prototype.Initialize=function(n,i,r,u,f,e,o){this.bodyA=n;this.bodyB=i;this.groundAnchorA.Copy(r);this.groundAnchorB.Copy(u);this.bodyA.GetLocalPoint(f,this.localAnchorA);this.bodyB.GetLocalPoint(e,this.localAnchorB);this.lengthA=t.DistanceVV(f,r);this.lengthB=t.DistanceVV(e,u);this.ratio=o},r}(ft),ro=function(n){function r(r){var f=n.call(this,r)||this;return f.m_groundAnchorA=new t,f.m_groundAnchorB=new t,f.m_lengthA=0,f.m_lengthB=0,f.m_localAnchorA=new t,f.m_localAnchorB=new t,f.m_constant=0,f.m_ratio=0,f.m_impulse=0,f.m_indexA=0,f.m_indexB=0,f.m_uA=new t,f.m_uB=new t,f.m_rA=new t,f.m_rB=new t,f.m_localCenterA=new t,f.m_localCenterB=new t,f.m_invMassA=0,f.m_invMassB=0,f.m_invIA=0,f.m_invIB=0,f.m_mass=0,f.m_qA=new i,f.m_qB=new i,f.m_lalcA=new t,f.m_lalcB=new t,f.m_groundAnchorA.Copy(u(r.groundAnchorA,new t(-1,1))),f.m_groundAnchorB.Copy(u(r.groundAnchorB,new t(1,0))),f.m_localAnchorA.Copy(u(r.localAnchorA,new t(-1,0))),f.m_localAnchorB.Copy(u(r.localAnchorB,new t(1,0))),f.m_lengthA=u(r.lengthA,0),f.m_lengthB=u(r.lengthB,0),f.m_ratio=u(r.ratio,1),f.m_constant=u(r.lengthA,0)+f.m_ratio*u(r.lengthB,0),f.m_impulse=0,f}return e(r,n),r.prototype.InitVelocityConstraints=function(n){var u,f,e,o;this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var v=n.positions[this.m_indexA].c,y=n.positions[this.m_indexA].a,p=n.velocities[this.m_indexA].v,h=n.velocities[this.m_indexA].w,w=n.positions[this.m_indexB].c,b=n.positions[this.m_indexB].a,k=n.velocities[this.m_indexB].v,c=n.velocities[this.m_indexB].w,d=this.m_qA.SetAngle(y),g=this.m_qB.SetAngle(b);t.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);i.MulRV(d,this.m_lalcA,this.m_rA);t.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);i.MulRV(g,this.m_lalcB,this.m_rB);this.m_uA.Copy(v).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA);this.m_uB.Copy(w).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);u=this.m_uA.Length();f=this.m_uB.Length();u>10*s?this.m_uA.SelfMul(1/u):this.m_uA.SetZero();f>10*s?this.m_uB.SelfMul(1/f):this.m_uB.SetZero();var l=t.CrossVV(this.m_rA,this.m_uA),a=t.CrossVV(this.m_rB,this.m_uB),nt=this.m_invMassA+this.m_invIA*l*l,tt=this.m_invMassB+this.m_invIB*a*a;(this.m_mass=nt+this.m_ratio*this.m_ratio*tt,this.m_mass>0&&(this.m_mass=1/this.m_mass),n.step.warmStarting)?(this.m_impulse*=n.step.dtRatio,e=t.MulSV(-this.m_impulse,this.m_uA,r.InitVelocityConstraints_s_PA),o=t.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,r.InitVelocityConstraints_s_PB),p.SelfMulAdd(this.m_invMassA,e),h+=this.m_invIA*t.CrossVV(this.m_rA,e),k.SelfMulAdd(this.m_invMassB,o),c+=this.m_invIB*t.CrossVV(this.m_rB,o)):this.m_impulse=0;n.velocities[this.m_indexA].w=h;n.velocities[this.m_indexB].w=c},r.prototype.SolveVelocityConstraints=function(n){var s=n.velocities[this.m_indexA].v,i=n.velocities[this.m_indexA].w,h=n.velocities[this.m_indexB].v,u=n.velocities[this.m_indexB].w,c=t.AddVCrossSV(s,i,this.m_rA,r.SolveVelocityConstraints_s_vpA),l=t.AddVCrossSV(h,u,this.m_rB,r.SolveVelocityConstraints_s_vpB),a=-t.DotVV(this.m_uA,c)-this.m_ratio*t.DotVV(this.m_uB,l),f=-this.m_mass*a,e,o;this.m_impulse+=f;e=t.MulSV(-f,this.m_uA,r.SolveVelocityConstraints_s_PA);o=t.MulSV(-this.m_ratio*f,this.m_uB,r.SolveVelocityConstraints_s_PB);s.SelfMulAdd(this.m_invMassA,e);i+=this.m_invIA*t.CrossVV(this.m_rA,e);h.SelfMulAdd(this.m_invMassB,o);u+=this.m_invIB*t.CrossVV(this.m_rB,o);n.velocities[this.m_indexA].w=i;n.velocities[this.m_indexB].w=u},r.prototype.SolvePositionConstraints=function(n){var p=n.positions[this.m_indexA].c,h=n.positions[this.m_indexA].a,w=n.positions[this.m_indexB].c,c=n.positions[this.m_indexB].a,it=this.m_qA.SetAngle(h),rt=this.m_qB.SetAngle(c),e;t.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);e=i.MulRV(it,this.m_lalcA,this.m_rA);t.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var a=i.MulRV(rt,this.m_lalcB,this.m_rB),u=this.m_uA.Copy(p).SelfAdd(e).SelfSub(this.m_groundAnchorA),f=this.m_uB.Copy(w).SelfAdd(a).SelfSub(this.m_groundAnchorB),v=u.Length(),y=f.Length();v>10*s?u.SelfMul(1/v):u.SetZero();y>10*s?f.SelfMul(1/y):f.SetZero();var b=t.CrossVV(e,u),k=t.CrossVV(a,f),ut=this.m_invMassA+this.m_invIA*b*b,ft=this.m_invMassB+this.m_invIB*k*k,o=ut+this.m_ratio*this.m_ratio*ft;o>0&&(o=1/o);var d=this.m_constant-v-this.m_ratio*y,et=l(d),g=-o*d,nt=t.MulSV(-g,u,r.SolvePositionConstraints_s_PA),tt=t.MulSV(-this.m_ratio*g,f,r.SolvePositionConstraints_s_PB);return p.SelfMulAdd(this.m_invMassA,nt),h+=this.m_invIA*t.CrossVV(e,nt),w.SelfMulAdd(this.m_invMassB,tt),c+=this.m_invIB*t.CrossVV(a,tt),n.positions[this.m_indexA].a=h,n.positions[this.m_indexB].a=c,et<s},r.prototype.GetAnchorA=function(n){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,n)},r.prototype.GetAnchorB=function(n){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,n)},r.prototype.GetReactionForce=function(n,t){return t.x=n*this.m_impulse*this.m_uB.x,t.y=n*this.m_impulse*this.m_uB.y,t},r.prototype.GetReactionTorque=function(){return 0},r.prototype.GetGroundAnchorA=function(){return this.m_groundAnchorA},r.prototype.GetGroundAnchorB=function(){return this.m_groundAnchorB},r.prototype.GetLengthA=function(){return this.m_lengthA},r.prototype.GetLengthB=function(){return this.m_lengthB},r.prototype.GetRatio=function(){return this.m_ratio},r.prototype.GetCurrentLengthA=function(){var n=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,r.GetCurrentLengthA_s_p),i=this.m_groundAnchorA;return t.DistanceVV(n,i)},r.prototype.GetCurrentLengthB=function(){var n=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,r.GetCurrentLengthB_s_p),i=this.m_groundAnchorB;return t.DistanceVV(n,i)},r.prototype.Dump=function(n){var t=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;n("  const jd: b2PulleyJointDef = new b2PulleyJointDef();\n");n("  jd.bodyA = bodies[%d];\n",t);n("  jd.bodyB = bodies[%d];\n",i);n("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false");n("  jd.groundAnchorA.Set(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y);n("  jd.groundAnchorB.Set(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y);n("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);n("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y);n("  jd.lengthA = %.15f;\n",this.m_lengthA);n("  jd.lengthB = %.15f;\n",this.m_lengthB);n("  jd.ratio = %.15f;\n",this.m_ratio);n("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},r.prototype.ShiftOrigin=function(n){this.m_groundAnchorA.SelfSub(n);this.m_groundAnchorB.SelfSub(n)},r.InitVelocityConstraints_s_PA=new t,r.InitVelocityConstraints_s_PB=new t,r.SolveVelocityConstraints_s_vpA=new t,r.SolveVelocityConstraints_s_vpB=new t,r.SolveVelocityConstraints_s_PA=new t,r.SolveVelocityConstraints_s_PB=new t,r.SolvePositionConstraints_s_PA=new t,r.SolvePositionConstraints_s_PB=new t,r.GetCurrentLengthA_s_p=new t,r.GetCurrentLengthB_s_p=new t,r}(et),ua=function(i){function r(){var r=i.call(this,n.b2JointType.e_revoluteJoint)||this;return r.localAnchorA=new t(0,0),r.localAnchorB=new t(0,0),r.referenceAngle=0,r.enableLimit=!1,r.lowerAngle=0,r.upperAngle=0,r.enableMotor=!1,r.motorSpeed=0,r.maxMotorTorque=0,r}return e(r,i),r.prototype.Initialize=function(n,t,i){this.bodyA=n;this.bodyB=t;this.bodyA.GetLocalPoint(i,this.localAnchorA);this.bodyB.GetLocalPoint(i,this.localAnchorB);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},r}(ft),uo=function(r){function f(f){var e=r.call(this,f)||this;return e.m_localAnchorA=new t,e.m_localAnchorB=new t,e.m_impulse=new g,e.m_motorImpulse=0,e.m_enableMotor=!1,e.m_maxMotorTorque=0,e.m_motorSpeed=0,e.m_enableLimit=!1,e.m_referenceAngle=0,e.m_lowerAngle=0,e.m_upperAngle=0,e.m_indexA=0,e.m_indexB=0,e.m_rA=new t,e.m_rB=new t,e.m_localCenterA=new t,e.m_localCenterB=new t,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_mass=new kt,e.m_motorMass=0,e.m_limitState=n.b2LimitState.e_inactiveLimit,e.m_qA=new i,e.m_qB=new i,e.m_lalcA=new t,e.m_lalcB=new t,e.m_K=new nt,e.m_localAnchorA.Copy(u(f.localAnchorA,t.ZERO)),e.m_localAnchorB.Copy(u(f.localAnchorB,t.ZERO)),e.m_referenceAngle=u(f.referenceAngle,0),e.m_impulse.SetZero(),e.m_motorImpulse=0,e.m_lowerAngle=u(f.lowerAngle,0),e.m_upperAngle=u(f.upperAngle,0),e.m_maxMotorTorque=u(f.maxMotorTorque,0),e.m_motorSpeed=u(f.motorSpeed,0),e.m_enableLimit=u(f.enableLimit,!1),e.m_enableMotor=u(f.enableMotor,!1),e.m_limitState=n.b2LimitState.e_inactiveLimit,e}return e(f,r),f.prototype.InitVelocityConstraints=function(r){var c,o;this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var a=r.positions[this.m_indexA].a,b=r.velocities[this.m_indexA].v,v=r.velocities[this.m_indexA].w,y=r.positions[this.m_indexB].a,k=r.velocities[this.m_indexB].v,p=r.velocities[this.m_indexB].w,d=this.m_qA.SetAngle(a),g=this.m_qB.SetAngle(y);t.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);i.MulRV(d,this.m_lalcA,this.m_rA);t.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);i.MulRV(g,this.m_lalcB,this.m_rB);var s=this.m_invMassA,h=this.m_invMassB,u=this.m_invIA,e=this.m_invIB,w=u+e===0;(this.m_mass.ex.x=s+h+this.m_rA.y*this.m_rA.y*u+this.m_rB.y*this.m_rB.y*e,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*u-this.m_rB.y*this.m_rB.x*e,this.m_mass.ez.x=-this.m_rA.y*u-this.m_rB.y*e,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=s+h+this.m_rA.x*this.m_rA.x*u+this.m_rB.x*this.m_rB.x*e,this.m_mass.ez.y=this.m_rA.x*u+this.m_rB.x*e,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=u+e,this.m_motorMass=u+e,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_enableMotor&&!w||(this.m_motorImpulse=0),this.m_enableLimit&&!w)?(c=y-a-this.m_referenceAngle,l(this.m_upperAngle-this.m_lowerAngle)<2*yt?this.m_limitState=n.b2LimitState.e_equalLimits:c<=this.m_lowerAngle?(this.m_limitState!==n.b2LimitState.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=n.b2LimitState.e_atLowerLimit):c>=this.m_upperAngle?(this.m_limitState!==n.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=n.b2LimitState.e_atUpperLimit):(this.m_limitState=n.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=n.b2LimitState.e_inactiveLimit;r.step.warmStarting?(this.m_impulse.SelfMul(r.step.dtRatio),this.m_motorImpulse*=r.step.dtRatio,o=f.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y),b.SelfMulSub(s,o),v-=u*(t.CrossVV(this.m_rA,o)+this.m_motorImpulse+this.m_impulse.z),k.SelfMulAdd(h,o),p+=e*(t.CrossVV(this.m_rB,o)+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0);r.velocities[this.m_indexA].w=v;r.velocities[this.m_indexB].w=p},f.prototype.SolveVelocityConstraints=function(i){var l=i.velocities[this.m_indexA].v,e=i.velocities[this.m_indexA].w,a=i.velocities[this.m_indexB].v,o=i.velocities[this.m_indexB].w,g=this.m_invMassA,nt=this.m_invMassB,v=this.m_invIA,p=this.m_invIB,tt=v+p===0,c,d,s;if(this.m_enableMotor&&this.m_limitState!==n.b2LimitState.e_equalLimits&&!tt){var rt=o-e-this.m_motorSpeed,w=-this.m_motorMass*rt,ut=this.m_motorImpulse,it=i.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=y(this.m_motorImpulse+w,-it,it);e-=v*(w=this.m_motorImpulse-ut);o+=p*w}if(this.m_enableLimit&&this.m_limitState!==n.b2LimitState.e_inactiveLimit&&!tt){var h=t.SubVV(t.AddVCrossSV(a,o,this.m_rB,t.s_t0),t.AddVCrossSV(l,e,this.m_rA,t.s_t1),f.SolveVelocityConstraints_s_Cdot1),ft=o-e,r=this.m_mass.Solve33(h.x,h.y,ft,f.SolveVelocityConstraints_s_impulse_v3).SelfNeg();if(this.m_limitState===n.b2LimitState.e_equalLimits)this.m_impulse.SelfAdd(r);else if(this.m_limitState===n.b2LimitState.e_atLowerLimit)if(this.m_impulse.z+r.z<0){var b=-h.x+this.m_impulse.z*this.m_mass.ez.x,k=-h.y+this.m_impulse.z*this.m_mass.ez.y,u=this.m_mass.Solve22(b,k,f.SolveVelocityConstraints_s_reduced_v2);r.x=u.x;r.y=u.y;r.z=-this.m_impulse.z;this.m_impulse.x+=u.x;this.m_impulse.y+=u.y;this.m_impulse.z=0}else this.m_impulse.SelfAdd(r);else this.m_limitState===n.b2LimitState.e_atUpperLimit&&(this.m_impulse.z+r.z>0?(b=-h.x+this.m_impulse.z*this.m_mass.ez.x,k=-h.y+this.m_impulse.z*this.m_mass.ez.y,u=this.m_mass.Solve22(b,k,f.SolveVelocityConstraints_s_reduced_v2),r.x=u.x,r.y=u.y,r.z=-this.m_impulse.z,this.m_impulse.x+=u.x,this.m_impulse.y+=u.y,this.m_impulse.z=0):this.m_impulse.SelfAdd(r));c=f.SolveVelocityConstraints_s_P.Set(r.x,r.y);l.SelfMulSub(g,c);e-=v*(t.CrossVV(this.m_rA,c)+r.z);a.SelfMulAdd(nt,c);o+=p*(t.CrossVV(this.m_rB,c)+r.z)}else d=t.SubVV(t.AddVCrossSV(a,o,this.m_rB,t.s_t0),t.AddVCrossSV(l,e,this.m_rA,t.s_t1),f.SolveVelocityConstraints_s_Cdot_v2),s=this.m_mass.Solve22(-d.x,-d.y,f.SolveVelocityConstraints_s_impulse_v2),this.m_impulse.x+=s.x,this.m_impulse.y+=s.y,l.SelfMulSub(g,s),e-=v*t.CrossVV(this.m_rA,s),a.SelfMulAdd(nt,s),o+=p*t.CrossVV(this.m_rB,s);i.velocities[this.m_indexA].w=e;i.velocities[this.m_indexB].w=o},f.prototype.SolvePositionConstraints=function(r){var it,rt=r.positions[this.m_indexA].c,h=r.positions[this.m_indexA].a,ut=r.positions[this.m_indexB].c,c=r.positions[this.m_indexB].a,ft=this.m_qA.SetAngle(h),et=this.m_qB.SetAngle(c),w=0,ot=this.m_invIA+this.m_invIB===0,b,a,u,e,o,k,p;this.m_enableLimit&&this.m_limitState!==n.b2LimitState.e_inactiveLimit&&!ot&&(b=c-h-this.m_referenceAngle,a=0,this.m_limitState===n.b2LimitState.e_equalLimits?(u=y(b-this.m_lowerAngle,-.13962634015955555,.13962634015955555),a=-this.m_motorMass*u,w=l(u)):this.m_limitState===n.b2LimitState.e_atLowerLimit?(w=-(u=b-this.m_lowerAngle),u=y(u+yt,-.13962634015955555,0),a=-this.m_motorMass*u):this.m_limitState===n.b2LimitState.e_atUpperLimit&&(w=u=b-this.m_upperAngle,u=y(u-yt,0,.13962634015955555),a=-this.m_motorMass*u),h-=this.m_invIA*a,c+=this.m_invIB*a);ft.SetAngle(h);et.SetAngle(c);t.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);e=i.MulRV(ft,this.m_lalcA,this.m_rA);t.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);o=i.MulRV(et,this.m_lalcB,this.m_rB);k=t.SubVV(t.AddVV(ut,o,t.s_t0),t.AddVV(rt,e,t.s_t1),f.SolvePositionConstraints_s_C_v2);it=k.Length();var nt=this.m_invMassA,tt=this.m_invMassB,d=this.m_invIA,g=this.m_invIB,v=this.m_K;return v.ex.x=nt+tt+d*e.y*e.y+g*o.y*o.y,v.ex.y=-d*e.x*e.y-g*o.x*o.y,v.ey.x=v.ex.y,v.ey.y=nt+tt+d*e.x*e.x+g*o.x*o.x,p=v.Solve(k.x,k.y,f.SolvePositionConstraints_s_impulse).SelfNeg(),rt.SelfMulSub(nt,p),h-=d*t.CrossVV(e,p),ut.SelfMulAdd(tt,p),c+=g*t.CrossVV(o,p),r.positions[this.m_indexA].a=h,r.positions[this.m_indexB].a=c,it<=s&&w<=yt},f.prototype.GetAnchorA=function(n){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,n)},f.prototype.GetAnchorB=function(n){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,n)},f.prototype.GetReactionForce=function(n,t){return t.x=n*this.m_impulse.x,t.y=n*this.m_impulse.y,t},f.prototype.GetReactionTorque=function(n){return n*this.m_impulse.z},f.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},f.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},f.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},f.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},f.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},f.prototype.IsMotorEnabled=function(){return this.m_enableMotor},f.prototype.EnableMotor=function(n){n!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=n)},f.prototype.GetMotorTorque=function(n){return n*this.m_motorImpulse},f.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},f.prototype.SetMaxMotorTorque=function(n){n!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=n)},f.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},f.prototype.IsLimitEnabled=function(){return this.m_enableLimit},f.prototype.EnableLimit=function(n){n!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=n,this.m_impulse.z=0)},f.prototype.GetLowerLimit=function(){return this.m_lowerAngle},f.prototype.GetUpperLimit=function(){return this.m_upperAngle},f.prototype.SetLimits=function(n,t){n===this.m_lowerAngle&&t===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=n,this.m_upperAngle=t)},f.prototype.SetMotorSpeed=function(n){n!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=n)},f.prototype.Dump=function(n){var t=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;n("  const jd: b2RevoluteJointDef = new b2RevoluteJointDef();\n");n("  jd.bodyA = bodies[%d];\n",t);n("  jd.bodyB = bodies[%d];\n",i);n("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false");n("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);n("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y);n("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle);n("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false");n("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle);n("  jd.upperAngle = %.15f;\n",this.m_upperAngle);n("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false");n("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed);n("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque);n("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},f.InitVelocityConstraints_s_P=new t,f.SolveVelocityConstraints_s_P=new t,f.SolveVelocityConstraints_s_Cdot_v2=new t,f.SolveVelocityConstraints_s_Cdot1=new t,f.SolveVelocityConstraints_s_impulse_v3=new g,f.SolveVelocityConstraints_s_reduced_v2=new t,f.SolveVelocityConstraints_s_impulse_v2=new t,f.SolvePositionConstraints_s_C_v2=new t,f.SolvePositionConstraints_s_impulse=new t,f}(et),fa=function(i){function r(){var r=i.call(this,n.b2JointType.e_ropeJoint)||this;return r.localAnchorA=new t(-1,0),r.localAnchorB=new t(1,0),r.maxLength=0,r}return e(r,i),r}(ft),fo=function(r){function f(f){var e=r.call(this,f)||this;return e.m_localAnchorA=new t,e.m_localAnchorB=new t,e.m_maxLength=0,e.m_length=0,e.m_impulse=0,e.m_indexA=0,e.m_indexB=0,e.m_u=new t,e.m_rA=new t,e.m_rB=new t,e.m_localCenterA=new t,e.m_localCenterB=new t,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_mass=0,e.m_state=n.b2LimitState.e_inactiveLimit,e.m_qA=new i,e.m_qB=new i,e.m_lalcA=new t,e.m_lalcB=new t,e.m_localAnchorA.Copy(u(f.localAnchorA,new t(-1,0))),e.m_localAnchorB.Copy(u(f.localAnchorB,new t(1,0))),e.m_maxLength=u(f.maxLength,0),e}return e(f,r),f.prototype.InitVelocityConstraints=function(r){var h,u;this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var v=r.positions[this.m_indexA].c,y=r.positions[this.m_indexA].a,p=r.velocities[this.m_indexA].v,e=r.velocities[this.m_indexA].w,w=r.positions[this.m_indexB].c,b=r.positions[this.m_indexB].a,k=r.velocities[this.m_indexB].v,o=r.velocities[this.m_indexB].w,d=this.m_qA.SetAngle(y),g=this.m_qB.SetAngle(b);if(t.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),i.MulRV(d,this.m_lalcA,this.m_rA),t.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),i.MulRV(g,this.m_lalcB,this.m_rB),this.m_u.Copy(w).SelfAdd(this.m_rB).SelfSub(v).SelfSub(this.m_rA),this.m_length=this.m_u.Length(),h=this.m_length-this.m_maxLength,this.m_state=h>0?n.b2LimitState.e_atUpperLimit:n.b2LimitState.e_inactiveLimit,!(this.m_length>s))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.SelfMul(1/this.m_length);var c=t.CrossVV(this.m_rA,this.m_u),l=t.CrossVV(this.m_rB,this.m_u),a=this.m_invMassA+this.m_invIA*c*c+this.m_invMassB+this.m_invIB*l*l;(this.m_mass=0!==a?1/a:0,r.step.warmStarting)?(this.m_impulse*=r.step.dtRatio,u=t.MulSV(this.m_impulse,this.m_u,f.InitVelocityConstraints_s_P),p.SelfMulSub(this.m_invMassA,u),e-=this.m_invIA*t.CrossVV(this.m_rA,u),k.SelfMulAdd(this.m_invMassB,u),o+=this.m_invIB*t.CrossVV(this.m_rB,u)):this.m_impulse=0;r.velocities[this.m_indexA].w=e;r.velocities[this.m_indexB].w=o},f.prototype.SolveVelocityConstraints=function(n){var s=n.velocities[this.m_indexA].v,u=n.velocities[this.m_indexA].w,h=n.velocities[this.m_indexB].v,e=n.velocities[this.m_indexB].w,v=t.AddVCrossSV(s,u,this.m_rA,f.SolveVelocityConstraints_s_vpA),y=t.AddVCrossSV(h,e,this.m_rB,f.SolveVelocityConstraints_s_vpB),c=this.m_length-this.m_maxLength,l=t.DotVV(this.m_u,t.SubVV(y,v,t.s_t0)),r,a,i;c<0&&(l+=n.step.inv_dt*c);r=-this.m_mass*l;a=this.m_impulse;this.m_impulse=o(0,this.m_impulse+r);r=this.m_impulse-a;i=t.MulSV(r,this.m_u,f.SolveVelocityConstraints_s_P);s.SelfMulSub(this.m_invMassA,i);u-=this.m_invIA*t.CrossVV(this.m_rA,i);h.SelfMulAdd(this.m_invMassB,i);e+=this.m_invIB*t.CrossVV(this.m_rB,i);n.velocities[this.m_indexA].w=u;n.velocities[this.m_indexB].w=e},f.prototype.SolvePositionConstraints=function(n){var c=n.positions[this.m_indexA].c,u=n.positions[this.m_indexA].a,l=n.positions[this.m_indexB].c,e=n.positions[this.m_indexB].a,b=this.m_qA.SetAngle(u),k=this.m_qB.SetAngle(e),o,w,r;t.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);o=i.MulRV(b,this.m_lalcA,this.m_rA);t.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var a=i.MulRV(k,this.m_lalcB,this.m_rB),v=this.m_u.Copy(l).SelfAdd(a).SelfSub(c).SelfSub(o),p=v.Normalize(),h=p-this.m_maxLength;return h=y(h,0,.2),w=-this.m_mass*h,r=t.MulSV(w,v,f.SolvePositionConstraints_s_P),c.SelfMulSub(this.m_invMassA,r),u-=this.m_invIA*t.CrossVV(o,r),l.SelfMulAdd(this.m_invMassB,r),e+=this.m_invIB*t.CrossVV(a,r),n.positions[this.m_indexA].a=u,n.positions[this.m_indexB].a=e,p-this.m_maxLength<s},f.prototype.GetAnchorA=function(n){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,n)},f.prototype.GetAnchorB=function(n){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,n)},f.prototype.GetReactionForce=function(n,i){return t.MulSV(n*this.m_impulse,this.m_u,i)},f.prototype.GetReactionTorque=function(){return 0},f.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},f.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},f.prototype.SetMaxLength=function(n){this.m_maxLength=n},f.prototype.GetMaxLength=function(){return this.m_maxLength},f.prototype.GetLimitState=function(){return this.m_state},f.prototype.Dump=function(n){var t=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;n("  const jd: b2RopeJointDef = new b2RopeJointDef();\n");n("  jd.bodyA = bodies[%d];\n",t);n("  jd.bodyB = bodies[%d];\n",i);n("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false");n("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);n("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y);n("  jd.maxLength = %.15f;\n",this.m_maxLength);n("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},f.InitVelocityConstraints_s_P=new t,f.SolveVelocityConstraints_s_vpA=new t,f.SolveVelocityConstraints_s_vpB=new t,f.SolveVelocityConstraints_s_P=new t,f.SolvePositionConstraints_s_P=new t,f}(et),ea=function(i){function r(){var r=i.call(this,n.b2JointType.e_weldJoint)||this;return r.localAnchorA=new t,r.localAnchorB=new t,r.referenceAngle=0,r.frequencyHz=0,r.dampingRatio=0,r}return e(r,i),r.prototype.Initialize=function(n,t,i){this.bodyA=n;this.bodyB=t;this.bodyA.GetLocalPoint(i,this.localAnchorA);this.bodyB.GetLocalPoint(i,this.localAnchorB);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},r}(ft),eo=function(n){function r(r){var f=n.call(this,r)||this;return f.m_frequencyHz=0,f.m_dampingRatio=0,f.m_bias=0,f.m_localAnchorA=new t,f.m_localAnchorB=new t,f.m_referenceAngle=0,f.m_gamma=0,f.m_impulse=new g(0,0,0),f.m_indexA=0,f.m_indexB=0,f.m_rA=new t,f.m_rB=new t,f.m_localCenterA=new t,f.m_localCenterB=new t,f.m_invMassA=0,f.m_invMassB=0,f.m_invIA=0,f.m_invIB=0,f.m_mass=new kt,f.m_qA=new i,f.m_qB=new i,f.m_lalcA=new t,f.m_lalcB=new t,f.m_K=new kt,f.m_frequencyHz=u(r.frequencyHz,0),f.m_dampingRatio=u(r.dampingRatio,0),f.m_localAnchorA.Copy(u(r.localAnchorA,t.ZERO)),f.m_localAnchorB.Copy(u(r.localAnchorB,t.ZERO)),f.m_referenceAngle=u(r.referenceAngle,0),f.m_impulse.SetZero(),f}return e(r,n),r.prototype.InitVelocityConstraints=function(n){var s;this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var v=n.positions[this.m_indexA].a,d=n.velocities[this.m_indexA].v,y=n.velocities[this.m_indexA].w,p=n.positions[this.m_indexB].a,g=n.velocities[this.m_indexB].v,w=n.velocities[this.m_indexB].w,nt=this.m_qA.SetAngle(v),tt=this.m_qB.SetAngle(p);t.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);i.MulRV(nt,this.m_lalcA,this.m_rA);t.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);i.MulRV(tt,this.m_lalcB,this.m_rB);var h=this.m_invMassA,c=this.m_invMassB,f=this.m_invIA,e=this.m_invIB,u=this.m_K;if(u.ex.x=h+c+this.m_rA.y*this.m_rA.y*f+this.m_rB.y*this.m_rB.y*e,u.ey.x=-this.m_rA.y*this.m_rA.x*f-this.m_rB.y*this.m_rB.x*e,u.ez.x=-this.m_rA.y*f-this.m_rB.y*e,u.ex.y=u.ey.x,u.ey.y=h+c+this.m_rA.x*this.m_rA.x*f+this.m_rB.x*this.m_rB.x*e,u.ez.y=this.m_rA.x*f+this.m_rB.x*e,u.ex.z=u.ez.x,u.ey.z=u.ez.y,u.ez.z=f+e,this.m_frequencyHz>0){u.GetInverse22(this.m_mass);var o=f+e,b=o>0?1/o:0,it=p-v-this.m_referenceAngle,l=2*ut*this.m_frequencyHz,rt=2*b*this.m_dampingRatio*l,k=b*l*l,a=n.step.dt;this.m_gamma=a*(rt+a*k);this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0;this.m_bias=it*a*k*this.m_gamma;o+=this.m_gamma;this.m_mass.ez.z=0!==o?1/o:0}else u.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;n.step.warmStarting?(this.m_impulse.SelfMul(n.step.dtRatio),s=r.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y),d.SelfMulSub(h,s),y-=f*(t.CrossVV(this.m_rA,s)+this.m_impulse.z),g.SelfMulAdd(c,s),w+=e*(t.CrossVV(this.m_rB,s)+this.m_impulse.z)):this.m_impulse.SetZero();n.velocities[this.m_indexA].w=y;n.velocities[this.m_indexB].w=w},r.prototype.SolveVelocityConstraints=function(n){var s=n.velocities[this.m_indexA].v,u=n.velocities[this.m_indexA].w,h=n.velocities[this.m_indexB].v,f=n.velocities[this.m_indexB].w,p=this.m_invMassA,w=this.m_invMassB,v=this.m_invIA,y=this.m_invIB,c,l,e,a,i,o;this.m_frequencyHz>0?(c=f-u,l=-this.m_mass.ez.z*(c+this.m_bias+this.m_gamma*this.m_impulse.z),this.m_impulse.z+=l,u-=v*l,f+=y*l,e=t.SubVV(t.AddVCrossSV(h,f,this.m_rB,t.s_t0),t.AddVCrossSV(s,u,this.m_rA,t.s_t1),r.SolveVelocityConstraints_s_Cdot1),a=kt.MulM33XY(this.m_mass,e.x,e.y,r.SolveVelocityConstraints_s_impulse1).SelfNeg(),this.m_impulse.x+=a.x,this.m_impulse.y+=a.y,i=a,s.SelfMulSub(p,i),u-=v*t.CrossVV(this.m_rA,i),h.SelfMulAdd(w,i),f+=y*t.CrossVV(this.m_rB,i)):(e=t.SubVV(t.AddVCrossSV(h,f,this.m_rB,t.s_t0),t.AddVCrossSV(s,u,this.m_rA,t.s_t1),r.SolveVelocityConstraints_s_Cdot1),c=f-u,o=kt.MulM33XYZ(this.m_mass,e.x,e.y,c,r.SolveVelocityConstraints_s_impulse).SelfNeg(),this.m_impulse.SelfAdd(o),i=r.SolveVelocityConstraints_s_P.Set(o.x,o.y),s.SelfMulSub(p,i),u-=v*(t.CrossVV(this.m_rA,i)+o.z),h.SelfMulAdd(w,i),f+=y*(t.CrossVV(this.m_rB,i)+o.z));n.velocities[this.m_indexA].w=u;n.velocities[this.m_indexB].w=f},r.prototype.SolvePositionConstraints=function(n){var w=n.positions[this.m_indexA].c,v=n.positions[this.m_indexA].a,b=n.positions[this.m_indexB].c,y=n.positions[this.m_indexB].a,it=this.m_qA.SetAngle(v),rt=this.m_qB.SetAngle(y),k=this.m_invMassA,d=this.m_invMassB,h=this.m_invIA,c=this.m_invIB,f,g,nt,e,u,o,a,tt,p;return t.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),f=i.MulRV(it,this.m_lalcA,this.m_rA),t.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),e=i.MulRV(rt,this.m_lalcB,this.m_rB),u=this.m_K,(u.ex.x=k+d+f.y*f.y*h+e.y*e.y*c,u.ey.x=-f.y*f.x*h-e.y*e.x*c,u.ez.x=-f.y*h-e.y*c,u.ex.y=u.ey.x,u.ey.y=k+d+f.x*f.x*h+e.x*e.x*c,u.ez.y=f.x*h+e.x*c,u.ex.z=u.ez.x,u.ey.z=u.ez.y,u.ez.z=h+c,this.m_frequencyHz>0)?(g=(a=t.SubVV(t.AddVV(b,e,t.s_t0),t.AddVV(w,f,t.s_t1),r.SolvePositionConstraints_s_C1)).Length(),nt=0,o=u.Solve22(a.x,a.y,r.SolvePositionConstraints_s_P).SelfNeg(),w.SelfMulSub(k,o),v-=h*t.CrossVV(f,o),b.SelfMulAdd(d,o),y+=c*t.CrossVV(e,o)):(a=t.SubVV(t.AddVV(b,e,t.s_t0),t.AddVV(w,f,t.s_t1),r.SolvePositionConstraints_s_C1),tt=y-v-this.m_referenceAngle,g=a.Length(),nt=l(tt),p=u.Solve33(a.x,a.y,tt,r.SolvePositionConstraints_s_impulse).SelfNeg(),o=r.SolvePositionConstraints_s_P.Set(p.x,p.y),w.SelfMulSub(k,o),v-=h*(t.CrossVV(this.m_rA,o)+p.z),b.SelfMulAdd(d,o),y+=c*(t.CrossVV(this.m_rB,o)+p.z)),n.positions[this.m_indexA].a=v,n.positions[this.m_indexB].a=y,g<=s&&nt<=yt},r.prototype.GetAnchorA=function(n){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,n)},r.prototype.GetAnchorB=function(n){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,n)},r.prototype.GetReactionForce=function(n,t){return t.x=n*this.m_impulse.x,t.y=n*this.m_impulse.y,t},r.prototype.GetReactionTorque=function(n){return n*this.m_impulse.z},r.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},r.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},r.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},r.prototype.SetFrequency=function(n){this.m_frequencyHz=n},r.prototype.GetFrequency=function(){return this.m_frequencyHz},r.prototype.SetDampingRatio=function(n){this.m_dampingRatio=n},r.prototype.GetDampingRatio=function(){return this.m_dampingRatio},r.prototype.Dump=function(n){var t=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;n("  const jd: b2WeldJointDef = new b2WeldJointDef();\n");n("  jd.bodyA = bodies[%d];\n",t);n("  jd.bodyB = bodies[%d];\n",i);n("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false");n("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);n("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y);n("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle);n("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz);n("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio);n("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},r.InitVelocityConstraints_s_P=new t,r.SolveVelocityConstraints_s_Cdot1=new t,r.SolveVelocityConstraints_s_impulse1=new t,r.SolveVelocityConstraints_s_impulse=new g,r.SolveVelocityConstraints_s_P=new t,r.SolvePositionConstraints_s_C1=new t,r.SolvePositionConstraints_s_P=new t,r.SolvePositionConstraints_s_impulse=new g,r}(et),oa=function(i){function r(){var r=i.call(this,n.b2JointType.e_wheelJoint)||this;return r.localAnchorA=new t(0,0),r.localAnchorB=new t(0,0),r.localAxisA=new t(1,0),r.enableMotor=!1,r.maxMotorTorque=0,r.motorSpeed=0,r.frequencyHz=2,r.dampingRatio=.7,r}return e(r,i),r.prototype.Initialize=function(n,t,i,r){this.bodyA=n;this.bodyB=t;this.bodyA.GetLocalPoint(i,this.localAnchorA);this.bodyB.GetLocalPoint(i,this.localAnchorB);this.bodyA.GetLocalVector(r,this.localAxisA)},r}(ft),oo=function(n){function r(r){var f=n.call(this,r)||this;return f.m_frequencyHz=0,f.m_dampingRatio=0,f.m_localAnchorA=new t,f.m_localAnchorB=new t,f.m_localXAxisA=new t,f.m_localYAxisA=new t,f.m_impulse=0,f.m_motorImpulse=0,f.m_springImpulse=0,f.m_maxMotorTorque=0,f.m_motorSpeed=0,f.m_enableMotor=!1,f.m_indexA=0,f.m_indexB=0,f.m_localCenterA=new t,f.m_localCenterB=new t,f.m_invMassA=0,f.m_invMassB=0,f.m_invIA=0,f.m_invIB=0,f.m_ax=new t,f.m_ay=new t,f.m_sAx=0,f.m_sBx=0,f.m_sAy=0,f.m_sBy=0,f.m_mass=0,f.m_motorMass=0,f.m_springMass=0,f.m_bias=0,f.m_gamma=0,f.m_qA=new i,f.m_qB=new i,f.m_lalcA=new t,f.m_lalcB=new t,f.m_rA=new t,f.m_rB=new t,f.m_frequencyHz=u(r.frequencyHz,2),f.m_dampingRatio=u(r.dampingRatio,.7),f.m_localAnchorA.Copy(u(r.localAnchorA,t.ZERO)),f.m_localAnchorB.Copy(u(r.localAnchorB,t.ZERO)),f.m_localXAxisA.Copy(u(r.localAxisA,t.UNITX)),t.CrossOneV(f.m_localXAxisA,f.m_localYAxisA),f.m_maxMotorTorque=u(r.maxMotorTorque,0),f.m_motorSpeed=u(r.motorSpeed,0),f.m_enableMotor=u(r.enableMotor,!1),f.m_ax.SetZero(),f.m_ay.SetZero(),f}return e(r,n),r.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},r.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},r.prototype.SetSpringFrequencyHz=function(n){this.m_frequencyHz=n},r.prototype.GetSpringFrequencyHz=function(){return this.m_frequencyHz},r.prototype.SetSpringDampingRatio=function(n){this.m_dampingRatio=n},r.prototype.GetSpringDampingRatio=function(){return this.m_dampingRatio},r.prototype.InitVelocityConstraints=function(n){var u,f,e,o;this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var v=this.m_invMassA,y=this.m_invMassB,s=this.m_invIA,h=this.m_invIB,d=n.positions[this.m_indexA].c,g=n.positions[this.m_indexA].a,nt=n.velocities[this.m_indexA].v,p=n.velocities[this.m_indexA].w,tt=n.positions[this.m_indexB].c,it=n.positions[this.m_indexB].a,rt=n.velocities[this.m_indexB].v,w=n.velocities[this.m_indexB].w,c=this.m_qA.SetAngle(g),ft=this.m_qB.SetAngle(it);if(t.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),u=i.MulRV(c,this.m_lalcA,this.m_rA),t.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),f=i.MulRV(ft,this.m_lalcB,this.m_rB),e=t.SubVV(t.AddVV(tt,f,t.s_t0),t.AddVV(d,u,t.s_t1),r.InitVelocityConstraints_s_d),i.MulRV(c,this.m_localYAxisA,this.m_ay),this.m_sAy=t.CrossVV(t.AddVV(e,u,t.s_t0),this.m_ay),this.m_sBy=t.CrossVV(f,this.m_ay),this.m_mass=v+y+s*this.m_sAy*this.m_sAy+h*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){if(i.MulRV(c,this.m_localXAxisA,this.m_ax),this.m_sAx=t.CrossVV(t.AddVV(e,u,t.s_t0),this.m_ax),this.m_sBx=t.CrossVV(f,this.m_ax),o=v+y+s*this.m_sAx*this.m_sAx+h*this.m_sBx*this.m_sBx,o>0){this.m_springMass=1/o;var et=t.DotVV(e,this.m_ax),l=2*ut*this.m_frequencyHz,ot=2*this.m_springMass*this.m_dampingRatio*l,b=this.m_springMass*l*l,a=n.step.dt;this.m_gamma=a*(ot+a*b);this.m_gamma>0&&(this.m_gamma=1/this.m_gamma);this.m_bias=et*a*b*this.m_gamma;this.m_springMass=o+this.m_gamma;this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=s+h,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),n.step.warmStarting){this.m_impulse*=n.step.dtRatio;this.m_springImpulse*=n.step.dtRatio;this.m_motorImpulse*=n.step.dtRatio;var k=t.AddVV(t.MulSV(this.m_impulse,this.m_ay,t.s_t0),t.MulSV(this.m_springImpulse,this.m_ax,t.s_t1),r.InitVelocityConstraints_s_P),st=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,ht=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;nt.SelfMulSub(this.m_invMassA,k);p-=this.m_invIA*st;rt.SelfMulAdd(this.m_invMassB,k);w+=this.m_invIB*ht}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;n.velocities[this.m_indexA].w=p;n.velocities[this.m_indexB].w=w},r.prototype.SolveVelocityConstraints=function(n){var w=this.m_invMassA,b=this.m_invMassB,c=this.m_invIA,l=this.m_invIB,s=n.velocities[this.m_indexA].v,u=n.velocities[this.m_indexA].w,h=n.velocities[this.m_indexB].v,f=n.velocities[this.m_indexB].w,e=t.DotVV(this.m_ax,t.SubVV(h,s,t.s_t0))+this.m_sBx*f-this.m_sAx*u,i=-this.m_springMass*(e+this.m_bias+this.m_gamma*this.m_springImpulse),k,p;this.m_springImpulse+=i;var o=t.MulSV(i,this.m_ax,r.SolveVelocityConstraints_s_P),a=i*this.m_sAx,v=i*this.m_sBx;s.SelfMulSub(w,o);u-=c*a;h.SelfMulAdd(b,o);e=(f+=l*v)-u-this.m_motorSpeed;i=-this.m_motorMass*e;k=this.m_motorImpulse;p=n.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=y(this.m_motorImpulse+i,-p,p);u-=c*(i=this.m_motorImpulse-k);f+=l*i;e=t.DotVV(this.m_ay,t.SubVV(h,s,t.s_t0))+this.m_sBy*f-this.m_sAy*u;i=-this.m_mass*e;this.m_impulse+=i;o=t.MulSV(i,this.m_ay,r.SolveVelocityConstraints_s_P);a=i*this.m_sAy;v=i*this.m_sBy;s.SelfMulSub(w,o);u-=c*a;h.SelfMulAdd(b,o);f+=l*v;n.velocities[this.m_indexA].w=u;n.velocities[this.m_indexB].w=f},r.prototype.SolvePositionConstraints=function(n){var c=n.positions[this.m_indexA].c,f=n.positions[this.m_indexA].a,a=n.positions[this.m_indexB].c,e=n.positions[this.m_indexB].a,v=this.m_qA.SetAngle(f),d=this.m_qB.SetAngle(e),o;t.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);o=i.MulRV(v,this.m_lalcA,this.m_rA);t.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var u,y=i.MulRV(d,this.m_lalcB,this.m_rB),p=t.AddVV(t.SubVV(a,c,t.s_t0),t.SubVV(y,o,t.s_t1),r.SolvePositionConstraints_s_d),h=i.MulRV(v,this.m_localYAxisA,this.m_ay),g=t.CrossVV(t.AddVV(p,o,t.s_t0),h),nt=t.CrossVV(y,h),w=t.DotVV(p,this.m_ay),b=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;u=0!==b?-w/b:0;var k=t.MulSV(u,h,r.SolvePositionConstraints_s_P),tt=u*g,it=u*nt;return c.SelfMulSub(this.m_invMassA,k),f-=this.m_invIA*tt,a.SelfMulAdd(this.m_invMassB,k),e+=this.m_invIB*it,n.positions[this.m_indexA].a=f,n.positions[this.m_indexB].a=e,l(w)<=s},r.prototype.GetDefinition=function(n){return n},r.prototype.GetAnchorA=function(n){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,n)},r.prototype.GetAnchorB=function(n){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,n)},r.prototype.GetReactionForce=function(n,t){return t.x=n*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),t.y=n*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),t},r.prototype.GetReactionTorque=function(n){return n*this.m_motorImpulse},r.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},r.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},r.prototype.GetLocalAxisA=function(){return this.m_localXAxisA},r.prototype.GetJointTranslation=function(){return this.GetPrismaticJointTranslation()},r.prototype.GetJointLinearSpeed=function(){return this.GetPrismaticJointSpeed()},r.prototype.GetJointAngle=function(){return this.GetRevoluteJointAngle()},r.prototype.GetJointAngularSpeed=function(){return this.GetRevoluteJointSpeed()},r.prototype.GetPrismaticJointTranslation=function(){var n=this.m_bodyA,i=this.m_bodyB,r=n.GetWorldPoint(this.m_localAnchorA,new t),u=i.GetWorldPoint(this.m_localAnchorB,new t),f=t.SubVV(u,r,new t),e=n.GetWorldVector(this.m_localXAxisA,new t);return t.DotVV(f,e)},r.prototype.GetPrismaticJointSpeed=function(){var n=this.m_bodyA,r=this.m_bodyB,u;t.SubVV(this.m_localAnchorA,n.m_sweep.localCenter,this.m_lalcA);u=i.MulRV(n.m_xf.q,this.m_lalcA,this.m_rA);t.SubVV(this.m_localAnchorB,r.m_sweep.localCenter,this.m_lalcB);var f=i.MulRV(r.m_xf.q,this.m_lalcB,this.m_rB),s=t.AddVV(n.m_sweep.c,u,t.s_t0),h=t.AddVV(r.m_sweep.c,f,t.s_t1),c=t.SubVV(h,s,t.s_t2),e=n.GetWorldVector(this.m_localXAxisA,new t),l=n.m_linearVelocity,a=r.m_linearVelocity,o=n.m_angularVelocity,v=r.m_angularVelocity;return t.DotVV(c,t.CrossSV(o,e,t.s_t0))+t.DotVV(e,t.SubVV(t.AddVCrossSV(a,v,f,t.s_t0),t.AddVCrossSV(l,o,u,t.s_t1),t.s_t0))},r.prototype.GetRevoluteJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a},r.prototype.GetRevoluteJointSpeed=function(){var n=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-n},r.prototype.IsMotorEnabled=function(){return this.m_enableMotor},r.prototype.EnableMotor=function(n){n!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=n)},r.prototype.SetMotorSpeed=function(n){n!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=n)},r.prototype.SetMaxMotorTorque=function(n){n!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=n)},r.prototype.GetMotorTorque=function(n){return n*this.m_motorImpulse},r.prototype.Dump=function(n){var t=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;n("  const jd: b2WheelJointDef = new b2WheelJointDef();\n");n("  jd.bodyA = bodies[%d];\n",t);n("  jd.bodyB = bodies[%d];\n",i);n("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false");n("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);n("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y);n("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y);n("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false");n("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed);n("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque);n("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz);n("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio);n("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},r.InitVelocityConstraints_s_d=new t,r.InitVelocityConstraints_s_P=new t,r.SolveVelocityConstraints_s_P=new t,r.SolvePositionConstraints_s_d=new t,r.SolvePositionConstraints_s_P=new t,r}(et);var h,lu=function(n){this.prev=null;this.next=null;this.contact=n},ui=function(){function n(){this.m_islandFlag=!1;this.m_touchingFlag=!1;this.m_enabledFlag=!1;this.m_filterFlag=!1;this.m_bulletHitFlag=!1;this.m_toiFlag=!1;this.m_prev=null;this.m_next=null;this.m_indexA=0;this.m_indexB=0;this.m_manifold=new gi;this.m_toiCount=0;this.m_toi=0;this.m_friction=0;this.m_restitution=0;this.m_tangentSpeed=0;this.m_oldManifold=new gi;this.m_nodeA=new lu(this);this.m_nodeB=new lu(this)}return n.prototype.GetManifold=function(){return this.m_manifold},n.prototype.GetWorldManifold=function(n){var t=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),r=this.m_fixtureA.GetShape(),u=this.m_fixtureB.GetShape();n.Initialize(this.m_manifold,t.GetTransform(),r.m_radius,i.GetTransform(),u.m_radius)},n.prototype.IsTouching=function(){return this.m_touchingFlag},n.prototype.SetEnabled=function(n){this.m_enabledFlag=n},n.prototype.IsEnabled=function(){return this.m_enabledFlag},n.prototype.GetNext=function(){return this.m_next},n.prototype.GetFixtureA=function(){return this.m_fixtureA},n.prototype.GetChildIndexA=function(){return this.m_indexA},n.prototype.GetFixtureB=function(){return this.m_fixtureB},n.prototype.GetChildIndexB=function(){return this.m_indexB},n.prototype.FlagForFiltering=function(){this.m_filterFlag=!0},n.prototype.SetFriction=function(n){this.m_friction=n},n.prototype.GetFriction=function(){return this.m_friction},n.prototype.ResetFriction=function(){this.m_friction=hu(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},n.prototype.SetRestitution=function(n){this.m_restitution=n},n.prototype.GetRestitution=function(){return this.m_restitution},n.prototype.ResetRestitution=function(){this.m_restitution=cu(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},n.prototype.SetTangentSpeed=function(n){this.m_tangentSpeed=n},n.prototype.GetTangentSpeed=function(){return this.m_tangentSpeed},n.prototype.Reset=function(n,t,i,r){this.m_islandFlag=!1;this.m_touchingFlag=!1;this.m_enabledFlag=!0;this.m_filterFlag=!1;this.m_bulletHitFlag=!1;this.m_toiFlag=!1;this.m_fixtureA=n;this.m_fixtureB=i;this.m_indexA=t;this.m_indexB=r;this.m_manifold.pointCount=0;this.m_prev=null;this.m_next=null;delete this.m_nodeA.contact;this.m_nodeA.prev=null;this.m_nodeA.next=null;delete this.m_nodeA.other;delete this.m_nodeB.contact;this.m_nodeB.prev=null;this.m_nodeB.next=null;delete this.m_nodeB.other;this.m_toiCount=0;this.m_friction=hu(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction);this.m_restitution=cu(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},n.prototype.Update=function(n){var p=this.m_oldManifold,a,v,r,i,y,u,f;this.m_oldManifold=this.m_manifold;this.m_manifold=p;this.m_enabledFlag=!0;var t=!1,e=this.m_touchingFlag,w=this.m_fixtureA.IsSensor(),b=this.m_fixtureB.IsSensor(),o=w||b,s=this.m_fixtureA.GetBody(),h=this.m_fixtureB.GetBody(),c=s.GetTransform(),l=h.GetTransform();if(o)a=this.m_fixtureA.GetShape(),v=this.m_fixtureB.GetShape(),t=nu(a,this.m_indexA,v,this.m_indexB,c,l),this.m_manifold.pointCount=0;else{for(this.Evaluate(this.m_manifold,c,l),t=this.m_manifold.pointCount>0,r=0;r<this.m_manifold.pointCount;++r)for(i=this.m_manifold.points[r],i.normalImpulse=0,i.tangentImpulse=0,y=i.id,u=0;u<this.m_oldManifold.pointCount;++u)if(f=this.m_oldManifold.points[u],f.id.key===y.key){i.normalImpulse=f.normalImpulse;i.tangentImpulse=f.tangentImpulse;break}t!==e&&(s.SetAwake(!0),h.SetAwake(!0))}this.m_touchingFlag=t;!e&&t&&n&&n.BeginContact(this);e&&!t&&n&&n.EndContact(this);!o&&t&&n&&n.PreSolve(this,this.m_oldManifold)},n.prototype.ComputeTOI=function(t,i){var r=n.ComputeTOI_s_input,u;return r.proxyA.SetShape(this.m_fixtureA.GetShape(),this.m_indexA),r.proxyB.SetShape(this.m_fixtureB.GetShape(),this.m_indexB),r.sweepA.Copy(t),r.sweepB.Copy(i),r.tMax=s,u=n.ComputeTOI_s_output,iu(u,r),u.t},n.ComputeTOI_s_input=new tu,n.ComputeTOI_s_output=new rr,n}(),au=function(n){function t(){return n.call(this)||this}return e(t,n),t.Create=function(){return new t},t.Destroy=function(){},t.prototype.Reset=function(t,i,r,u){n.prototype.Reset.call(this,t,i,r,u)},t.prototype.Evaluate=function(n,t,i){fe(n,this.m_fixtureA.GetShape(),t,this.m_fixtureB.GetShape(),i)},t}(ui),vu=function(n){function t(){return n.call(this)||this}return e(t,n),t.Create=function(){return new t},t.Destroy=function(){},t.prototype.Reset=function(t,i,r,u){n.prototype.Reset.call(this,t,i,r,u)},t.prototype.Evaluate=function(n,t,i){le(n,this.m_fixtureA.GetShape(),t,this.m_fixtureB.GetShape(),i)},t}(ui),yu=function(n){function t(){return n.call(this)||this}return e(t,n),t.Create=function(){return new t},t.Destroy=function(){},t.prototype.Reset=function(t,i,r,u){n.prototype.Reset.call(this,t,i,r,u)},t.prototype.Evaluate=function(n,t,i){ee(n,this.m_fixtureA.GetShape(),t,this.m_fixtureB.GetShape(),i)},t}(ui),pu=function(n){function t(){return n.call(this)||this}return e(t,n),t.Create=function(){return new t},t.Destroy=function(){},t.prototype.Reset=function(t,i,r,u){n.prototype.Reset.call(this,t,i,r,u)},t.prototype.Evaluate=function(n,t,i){uu(n,this.m_fixtureA.GetShape(),t,this.m_fixtureB.GetShape(),i)},t}(ui),wu=function(n){function t(){return n.call(this)||this}return e(t,n),t.Create=function(){return new t},t.Destroy=function(){},t.prototype.Reset=function(t,i,r,u){n.prototype.Reset.call(this,t,i,r,u)},t.prototype.Evaluate=function(n,t,i){fu(n,this.m_fixtureA.GetShape(),t,this.m_fixtureB.GetShape(),i)},t}(ui),bu=function(n){function t(){return n.call(this)||this}return e(t,n),t.Create=function(){return new t},t.Destroy=function(){},t.prototype.Reset=function(t,i,r,u){n.prototype.Reset.call(this,t,i,r,u)},t.prototype.Evaluate=function(n,i,r){var f=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape(),o=f,u=t.Evaluate_s_edge;o.GetChildEdge(u,this.m_indexA);uu(n,u,i,e,r)},t.Evaluate_s_edge=new ai,t}(ui),ku=function(n){function t(){return n.call(this)||this}return e(t,n),t.Create=function(){return new t},t.Destroy=function(){},t.prototype.Reset=function(t,i,r,u){n.prototype.Reset.call(this,t,i,r,u)},t.prototype.Evaluate=function(n,i,r){var f=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape(),o=f,u=t.Evaluate_s_edge;o.GetChildEdge(u,this.m_indexA);fu(n,u,i,e,r)},t.Evaluate_s_edge=new ai,t}(ui),so=function(){this.createFcn=null;this.destroyFcn=null;this.primary=!1},ho=function(){function t(n){this.m_allocator=null;this.m_allocator=n;this.InitializeRegisters()}return t.prototype.AddType=function(n,t,i,r){function f(t){return u.pop()||n(t)}function e(n){u.push(n)}var o=this,u=k(256,function(){return n(o.m_allocator)});this.m_registers[i][r].createFcn=f;this.m_registers[i][r].destroyFcn=e;this.m_registers[i][r].primary=!0;i!==r&&(this.m_registers[r][i].createFcn=f,this.m_registers[r][i].destroyFcn=e,this.m_registers[r][i].primary=!1)},t.prototype.InitializeRegisters=function(){var t,i;for(this.m_registers=[],t=0;t<n.b2ShapeType.e_shapeTypeCount;t++)for(this.m_registers[t]=[],i=0;i<n.b2ShapeType.e_shapeTypeCount;i++)this.m_registers[t][i]=new so;this.AddType(au.Create,au.Destroy,n.b2ShapeType.e_circleShape,n.b2ShapeType.e_circleShape);this.AddType(yu.Create,yu.Destroy,n.b2ShapeType.e_polygonShape,n.b2ShapeType.e_circleShape);this.AddType(vu.Create,vu.Destroy,n.b2ShapeType.e_polygonShape,n.b2ShapeType.e_polygonShape);this.AddType(pu.Create,pu.Destroy,n.b2ShapeType.e_edgeShape,n.b2ShapeType.e_circleShape);this.AddType(wu.Create,wu.Destroy,n.b2ShapeType.e_edgeShape,n.b2ShapeType.e_polygonShape);this.AddType(bu.Create,bu.Destroy,n.b2ShapeType.e_chainShape,n.b2ShapeType.e_circleShape);this.AddType(ku.Create,ku.Destroy,n.b2ShapeType.e_chainShape,n.b2ShapeType.e_polygonShape)},t.prototype.Create=function(n,t,i,r){var e=n.GetType(),o=i.GetType(),f=this.m_registers[e][o],u;return f.createFcn?(u=f.createFcn(this.m_allocator),f.primary?u.Reset(n,t,i,r):u.Reset(i,r,n,t),u):null},t.prototype.Destroy=function(n){var t=n.m_fixtureA,i=n.m_fixtureB;n.m_manifold.pointCount>0&&!t.IsSensor()&&!i.IsSensor()&&(t.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0));var u=t.GetType(),f=i.GetType(),r=this.m_registers[u][f];r.destroyFcn&&r.destroyFcn(n,this.m_allocator)},t}(),sa=function(){function n(){}return n.prototype.SayGoodbyeJoint=function(){},n.prototype.SayGoodbyeFixture=function(){},n.prototype.SayGoodbyeParticleGroup=function(){},n.prototype.SayGoodbyeParticle=function(){},n}(),co=function(){function t(){}return t.prototype.ShouldCollide=function(t,i){var f=t.GetBody(),e=i.GetBody(),r,u;return e.GetType()===n.b2BodyType.b2_staticBody&&f.GetType()===n.b2BodyType.b2_staticBody?!1:e.ShouldCollideConnected(f)?(r=t.GetFilterData(),u=i.GetFilterData(),r.groupIndex===u.groupIndex&&0!==r.groupIndex?r.groupIndex>0:0!=(r.maskBits&u.categoryBits)&&0!=(r.categoryBits&u.maskBits)):!1},t.prototype.ShouldCollideFixtureParticle=function(){return!0},t.prototype.ShouldCollideParticleParticle=function(){return!0},t.b2_defaultFilter=new t,t}(),lo=function(){this.normalImpulses=lt(d);this.tangentImpulses=lt(d);this.count=0},ao=function(){function n(){}return n.prototype.BeginContact=function(){},n.prototype.EndContact=function(){},n.prototype.BeginContactFixtureParticle=function(){},n.prototype.EndContactFixtureParticle=function(){},n.prototype.BeginContactParticleParticle=function(){},n.prototype.EndContactParticleParticle=function(){},n.prototype.PreSolve=function(){},n.prototype.PostSolve=function(){},n.b2_defaultListener=new n,n}(),vi=function(){function n(){}return n.prototype.ReportFixture=function(){return!0},n.prototype.ReportParticle=function(){return!1},n.prototype.ShouldQueryParticleSystem=function(){return!0},n}(),ha=function(){function n(){}return n.prototype.ReportFixture=function(n,t,i,r){return r},n.prototype.ReportParticle=function(){return 0},n.prototype.ShouldQueryParticleSystem=function(){return!0},n}(),vo=function(){function t(){this.m_broadPhase=new df;this.m_contactList=null;this.m_contactCount=0;this.m_contactFilter=co.b2_defaultFilter;this.m_contactListener=ao.b2_defaultListener;this.m_allocator=null;this.m_contactFactory=new ho(this.m_allocator)}return t.prototype.AddPair=function(n,t){var e=n.fixture,o=t.fixture,s=n.childIndex,h=t.childIndex,r=e.GetBody(),u=o.GetBody(),f,i;if(r!==u){for(f=u.GetContactList();f;){if(f.other===r){var c=f.contact.GetFixtureA(),l=f.contact.GetFixtureB(),a=f.contact.GetChildIndexA(),v=f.contact.GetChildIndexB();if(c===e&&l===o&&a===s&&v===h)return;if(c===o&&l===e&&a===h&&v===s)return}f=f.next}(!this.m_contactFilter||this.m_contactFilter.ShouldCollide(e,o))&&(i=this.m_contactFactory.Create(e,s,o,h),null!==i&&(e=i.GetFixtureA(),o=i.GetFixtureB(),s=i.GetChildIndexA(),h=i.GetChildIndexB(),r=e.m_body,u=o.m_body,i.m_prev=null,i.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=i),this.m_contactList=i,i.m_nodeA.contact=i,i.m_nodeA.other=u,i.m_nodeA.prev=null,i.m_nodeA.next=r.m_contactList,null!==r.m_contactList&&(r.m_contactList.prev=i.m_nodeA),r.m_contactList=i.m_nodeA,i.m_nodeB.contact=i,i.m_nodeB.other=r,i.m_nodeB.prev=null,i.m_nodeB.next=u.m_contactList,null!==u.m_contactList&&(u.m_contactList.prev=i.m_nodeB),u.m_contactList=i.m_nodeB,e.IsSensor()||o.IsSensor()||(r.SetAwake(!0),u.SetAwake(!0)),++this.m_contactCount))}},t.prototype.FindNewContacts=function(){var n=this;this.m_broadPhase.UpdatePairs(function(t,i){n.AddPair(t,i)})},t.prototype.Destroy=function(n){var r=n.GetFixtureA(),u=n.GetFixtureB(),t=r.GetBody(),i=u.GetBody();this.m_contactListener&&n.IsTouching()&&this.m_contactListener.EndContact(n);n.m_prev&&(n.m_prev.m_next=n.m_next);n.m_next&&(n.m_next.m_prev=n.m_prev);n===this.m_contactList&&(this.m_contactList=n.m_next);n.m_nodeA.prev&&(n.m_nodeA.prev.next=n.m_nodeA.next);n.m_nodeA.next&&(n.m_nodeA.next.prev=n.m_nodeA.prev);n.m_nodeA===t.m_contactList&&(t.m_contactList=n.m_nodeA.next);n.m_nodeB.prev&&(n.m_nodeB.prev.next=n.m_nodeB.next);n.m_nodeB.next&&(n.m_nodeB.next.prev=n.m_nodeB.prev);n.m_nodeB===i.m_contactList&&(i.m_contactList=n.m_nodeB.next);this.m_contactFactory.Destroy(n);--this.m_contactCount},t.prototype.Collide=function(){for(var o,s,i,h,c,t=this.m_contactList;t;){var r=t.GetFixtureA(),u=t.GetFixtureB(),l=t.GetChildIndexA(),a=t.GetChildIndexB(),f=r.GetBody(),e=u.GetBody();if(t.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(r,u)){t=(i=t).m_next;this.Destroy(i);continue}t.m_filterFlag=!1}o=f.IsAwake()&&f.m_type!==n.b2BodyType.b2_staticBody;s=e.IsAwake()&&e.m_type!==n.b2BodyType.b2_staticBody;o||s?(h=r.m_proxies[l].treeNode,c=u.m_proxies[a].treeNode,gr(h.aabb,c.aabb)?(t.Update(this.m_contactListener),t=t.m_next):(t=(i=t).m_next,this.Destroy(i))):t=t.m_next}},t}(),du=function(){function n(){this.step=0;this.collide=0;this.solve=0;this.solveInit=0;this.solveVelocity=0;this.solvePosition=0;this.broadphase=0;this.solveTOI=0}return n.prototype.Reset=function(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this},n}(),oi=function(){function n(){this.dt=0;this.inv_dt=0;this.dtRatio=0;this.velocityIterations=0;this.positionIterations=0;this.particleIterations=0;this.warmStarting=!1}return n.prototype.Copy=function(n){return this.dt=n.dt,this.inv_dt=n.inv_dt,this.dtRatio=n.dtRatio,this.positionIterations=n.positionIterations,this.velocityIterations=n.velocityIterations,this.particleIterations=n.particleIterations,this.warmStarting=n.warmStarting,this},n}(),gu=function(){function n(){this.c=new t;this.a=0}return n.MakeArray=function(t){return k(t,function(){return new n})},n}(),nf=function(){function n(){this.v=new t;this.w=0}return n.MakeArray=function(t){return k(t,function(){return new n})},n}(),yo=function(){this.step=new oi},po=function(){function n(){this.rA=new t;this.rB=new t;this.normalImpulse=0;this.tangentImpulse=0;this.normalMass=0;this.tangentMass=0;this.velocityBias=0}return n.MakeArray=function(t){return k(t,function(){return new n})},n}(),tf=function(){function n(){this.points=po.MakeArray(d);this.normal=new t;this.tangent=new t;this.normalMass=new nt;this.K=new nt;this.indexA=0;this.indexB=0;this.invMassA=0;this.invMassB=0;this.invIA=0;this.invIB=0;this.friction=0;this.restitution=0;this.tangentSpeed=0;this.pointCount=0;this.contactIndex=0}return n.MakeArray=function(t){return k(t,function(){return new n})},n}(),rf=function(){function i(){this.localPoints=t.MakeArray(d);this.localNormal=new t;this.localPoint=new t;this.indexA=0;this.indexB=0;this.invMassA=0;this.invMassB=0;this.localCenterA=new t;this.localCenterB=new t;this.invIA=0;this.invIB=0;this.type=n.b2ManifoldType.e_unknown;this.radiusA=0;this.radiusB=0;this.pointCount=0}return i.MakeArray=function(n){return k(n,function(){return new i})},i}(),wo=function(){this.step=new oi;this.count=0;this.allocator=null},uf=function(){function u(){this.normal=new t;this.point=new t;this.separation=0}return u.prototype.Initialize=function(f,e,o,s){var c=u.Initialize_s_pointA,l=u.Initialize_s_pointB,a=u.Initialize_s_planePoint,h=u.Initialize_s_clipPoint;switch(f.type){case n.b2ManifoldType.e_circles:r.MulXV(e,f.localPoint,c);r.MulXV(o,f.localPoints[0],l);t.SubVV(l,c,this.normal).SelfNormalize();t.MidVV(c,l,this.point);this.separation=t.DotVV(t.SubVV(l,c,t.s_t0),this.normal)-f.radiusA-f.radiusB;break;case n.b2ManifoldType.e_faceA:i.MulRV(e.q,f.localNormal,this.normal);r.MulXV(e,f.localPoint,a);r.MulXV(o,f.localPoints[s],h);this.separation=t.DotVV(t.SubVV(h,a,t.s_t0),this.normal)-f.radiusA-f.radiusB;this.point.Copy(h);break;case n.b2ManifoldType.e_faceB:i.MulRV(o.q,f.localNormal,this.normal);r.MulXV(o,f.localPoint,a);r.MulXV(e,f.localPoints[s],h);this.separation=t.DotVV(t.SubVV(h,a,t.s_t0),this.normal)-f.radiusA-f.radiusB;this.point.Copy(h);this.normal.SelfNeg()}},u.Initialize_s_pointA=new t,u.Initialize_s_pointB=new t,u.Initialize_s_planePoint=new t,u.Initialize_s_clipPoint=new t,u}(),bo=function(){function n(){this.m_step=new oi;this.m_allocator=null;this.m_positionConstraints=rf.MakeArray(1024);this.m_velocityConstraints=tf.MakeArray(1024);this.m_count=0}return n.prototype.Initialize=function(n){var l,u,t,h,a,r;if(this.m_step.Copy(n.step),this.m_allocator=n.allocator,this.m_count=n.count,this.m_positionConstraints.length<this.m_count)for(l=f(2*this.m_positionConstraints.length,this.m_count);this.m_positionConstraints.length<l;)this.m_positionConstraints[this.m_positionConstraints.length]=new rf;if(this.m_velocityConstraints.length<this.m_count)for(l=f(2*this.m_velocityConstraints.length,this.m_count);this.m_velocityConstraints.length<l;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new tf;for(this.m_positions=n.positions,this.m_velocities=n.velocities,this.m_contacts=n.contacts,u=0;u<this.m_count;++u){var s=this.m_contacts[u],y=s.m_fixtureA,p=s.m_fixtureB,w=y.GetShape(),b=p.GetShape(),k=w.m_radius,d=b.m_radius,e=y.GetBody(),o=p.GetBody(),c=s.GetManifold(),v=c.pointCount,i=this.m_velocityConstraints[u];for(i.friction=s.m_friction,i.restitution=s.m_restitution,i.tangentSpeed=s.m_tangentSpeed,i.indexA=e.m_islandIndex,i.indexB=o.m_islandIndex,i.invMassA=e.m_invMass,i.invMassB=o.m_invMass,i.invIA=e.m_invI,i.invIB=o.m_invI,i.contactIndex=u,i.pointCount=v,i.K.SetZero(),i.normalMass.SetZero(),t=this.m_positionConstraints[u],t.indexA=e.m_islandIndex,t.indexB=o.m_islandIndex,t.invMassA=e.m_invMass,t.invMassB=o.m_invMass,t.localCenterA.Copy(e.m_sweep.localCenter),t.localCenterB.Copy(o.m_sweep.localCenter),t.invIA=e.m_invI,t.invIB=o.m_invI,t.localNormal.Copy(c.localNormal),t.localPoint.Copy(c.localPoint),t.pointCount=v,t.radiusA=k,t.radiusB=d,t.type=c.type,h=0;h<v;++h)a=c.points[h],r=i.points[h],this.m_step.warmStarting?(r.normalImpulse=this.m_step.dtRatio*a.normalImpulse,r.tangentImpulse=this.m_step.dtRatio*a.tangentImpulse):(r.normalImpulse=0,r.tangentImpulse=0),r.rA.SetZero(),r.rB.SetZero(),r.normalMass=0,r.tangentMass=0,r.velocityBias=0,t.localPoints[h].Copy(a.localPoint)}return this},n.prototype.InitializeVelocityConstraints=function(){for(var g,f,u,v,e=n.InitializeVelocityConstraints_s_xfA,o=n.InitializeVelocityConstraints_s_xfB,s=n.InitializeVelocityConstraints_s_worldManifold,h=0;h<this.m_count;++h){var r=this.m_velocityConstraints[h],c=this.m_positionConstraints[h],ot=c.radiusA,st=c.radiusB,ht=this.m_contacts[r.contactIndex].GetManifold(),l=r.indexA,a=r.indexB,y=r.invMassA,p=r.invMassB,w=r.invIA,b=r.invIB,ct=c.localCenterA,lt=c.localCenterB,k=this.m_positions[l].c,at=this.m_positions[l].a,vt=this.m_velocities[l].v,yt=this.m_velocities[l].w,d=this.m_positions[a].c,pt=this.m_positions[a].a,wt=this.m_velocities[a].v,bt=this.m_velocities[a].w;for(e.q.SetAngle(at),o.q.SetAngle(pt),t.SubVV(k,i.MulRV(e.q,ct,t.s_t0),e.p),t.SubVV(d,i.MulRV(o.q,lt,t.s_t0),o.p),s.Initialize(ht,e,ot,o,st),r.normal.Copy(s.normal),t.CrossVOne(r.normal,r.tangent),g=r.pointCount,f=0;f<g;++f){u=r.points[f];t.SubVV(s.points[f],k,u.rA);t.SubVV(s.points[f],d,u.rB);var nt=t.CrossVV(u.rA,r.normal),tt=t.CrossVV(u.rB,r.normal),it=y+p+w*nt*nt+b*tt*tt;u.normalMass=it>0?1/it:0;var rt=r.tangent,ut=t.CrossVV(u.rA,rt),ft=t.CrossVV(u.rB,rt),et=y+p+w*ut*ut+b*ft*ft;u.tangentMass=et>0?1/et:0;u.velocityBias=0;v=t.DotVV(r.normal,t.SubVV(t.AddVCrossSV(wt,bt,u.rB,t.s_t0),t.AddVCrossSV(vt,yt,u.rA,t.s_t1),t.s_t0));v<-1&&(u.velocityBias+=-r.restitution*v)}r.pointCount}},n.prototype.WarmStart=function(){for(var u,r=n.WarmStart_s_P,f=0;f<this.m_count;++f){for(var i=this.m_velocityConstraints[f],e=i.indexA,o=i.indexB,l=i.invMassA,a=i.invIA,v=i.invMassB,y=i.invIB,p=i.pointCount,w=this.m_velocities[e].v,h=this.m_velocities[e].w,b=this.m_velocities[o].v,c=this.m_velocities[o].w,k=i.normal,d=i.tangent,s=0;s<p;++s)u=i.points[s],t.AddVV(t.MulSV(u.normalImpulse,k,t.s_t0),t.MulSV(u.tangentImpulse,d,t.s_t1),r),h-=a*t.CrossVV(u.rA,r),w.SelfMulSub(l,r),c+=y*t.CrossVV(u.rB,r),b.SelfMulAdd(v,r);this.m_velocities[e].w=h;this.m_velocities[o].w=c}},n.prototype.SolveVelocityConstraints=function(){for(var i,v,ft,c=n.SolveVelocityConstraints_s_dv,u=(n.SolveVelocityConstraints_s_dv1,n.SolveVelocityConstraints_s_dv2,n.SolveVelocityConstraints_s_P),p=(n.SolveVelocityConstraints_s_a,n.SolveVelocityConstraints_s_b,n.SolveVelocityConstraints_s_x,n.SolveVelocityConstraints_s_d,n.SolveVelocityConstraints_s_P1,n.SolveVelocityConstraints_s_P2,n.SolveVelocityConstraints_s_P1P2,0);p<this.m_count;++p){for(var r=this.m_velocityConstraints[p],w=r.indexA,b=r.indexB,k=r.invMassA,d=r.invIA,g=r.invMassB,nt=r.invIB,tt=r.pointCount,l=this.m_velocities[w].v,s=this.m_velocities[w].w,a=this.m_velocities[b].v,h=this.m_velocities[b].w,it=r.normal,rt=r.tangent,et=r.friction,e=0;e<tt;++e){i=r.points[e];t.SubVV(t.AddVCrossSV(a,h,i.rB,t.s_t0),t.AddVCrossSV(l,s,i.rA,t.s_t1),c);var ot=t.DotVV(c,rt)-r.tangentSpeed,o=i.tangentMass*-ot,ut=et*i.normalImpulse;o=(v=y(i.tangentImpulse+o,-ut,ut))-i.tangentImpulse;i.tangentImpulse=v;t.MulSV(o,rt,u);l.SelfMulSub(k,u);s-=d*t.CrossVV(i.rA,u);a.SelfMulAdd(g,u);h+=nt*t.CrossVV(i.rB,u)}for(r.pointCount,e=0;e<tt;++e)i=r.points[e],t.SubVV(t.AddVCrossSV(a,h,i.rB,t.s_t0),t.AddVCrossSV(l,s,i.rA,t.s_t1),c),ft=t.DotVV(c,it),o=-i.normalMass*(ft-i.velocityBias),o=(v=f(i.normalImpulse+o,0))-i.normalImpulse,i.normalImpulse=v,t.MulSV(o,it,u),l.SelfMulSub(k,u),s-=d*t.CrossVV(i.rA,u),a.SelfMulAdd(g,u),h+=nt*t.CrossVV(i.rB,u);this.m_velocities[w].w=s;this.m_velocities[b].w=h}},n.prototype.StoreImpulses=function(){for(var t=0;t<this.m_count;++t)for(var i=this.m_velocityConstraints[t],r=this.m_contacts[i.contactIndex].GetManifold(),n=0;n<i.pointCount;++n)r.points[n].normalImpulse=i.points[n].normalImpulse,r.points[n].tangentImpulse=i.points[n].tangentImpulse},n.prototype.SolvePositionConstraints=function(){for(var f=n.SolvePositionConstraints_s_xfA,e=n.SolvePositionConstraints_s_xfB,h=n.SolvePositionConstraints_s_psm,c=n.SolvePositionConstraints_s_rA,l=n.SolvePositionConstraints_s_rB,u=n.SolvePositionConstraints_s_P,a=0,v=0;v<this.m_count;++v){for(var r=this.m_positionConstraints[v],p=r.indexA,w=r.indexB,lt=r.localCenterA,it=r.invMassA,rt=r.invIA,at=r.localCenterB,ut=r.invMassB,ft=r.invIB,vt=r.pointCount,b=this.m_positions[p].c,k=this.m_positions[p].a,d=this.m_positions[w].c,g=this.m_positions[w].a,nt=0;nt<vt;++nt){f.q.SetAngle(k);e.q.SetAngle(g);t.SubVV(b,i.MulRV(f.q,lt,t.s_t0),f.p);t.SubVV(d,i.MulRV(e.q,at,t.s_t0),e.p);h.Initialize(r,f,e,nt);var tt=h.normal,et=h.point,ot=h.separation;t.SubVV(et,b,c);t.SubVV(et,d,l);a=o(a,ot);var yt=y(.2*(ot+s),-.2,0),st=t.CrossVV(c,tt),ht=t.CrossVV(l,tt),ct=it+ut+rt*st*st+ft*ht*ht,pt=ct>0?-yt/ct:0;t.MulSV(pt,tt,u);b.SelfMulSub(it,u);k-=rt*t.CrossVV(c,u);d.SelfMulAdd(ut,u);g+=ft*t.CrossVV(l,u)}this.m_positions[p].a=k;this.m_positions[w].a=g}return a>-3*s},n.prototype.SolveTOIPositionConstraints=function(r,u){for(var p,w,l=n.SolveTOIPositionConstraints_s_xfA,a=n.SolveTOIPositionConstraints_s_xfB,v=n.SolveTOIPositionConstraints_s_psm,b=n.SolveTOIPositionConstraints_s_rA,k=n.SolveTOIPositionConstraints_s_rB,e=n.SolveTOIPositionConstraints_s_P,d=0,g=0;g<this.m_count;++g){var f=this.m_positionConstraints[g],h=f.indexA,c=f.indexB,vt=f.localCenterA,yt=f.localCenterB,pt=f.pointCount,nt=0,tt=0;h!==r&&h!==u||(nt=f.invMassA,tt=f.invIA);p=0;w=0;c!==r&&c!==u||(p=f.invMassB,w=f.invIB);for(var it=this.m_positions[h].c,rt=this.m_positions[h].a,ut=this.m_positions[c].c,ft=this.m_positions[c].a,et=0;et<pt;++et){l.q.SetAngle(rt);a.q.SetAngle(ft);t.SubVV(it,i.MulRV(l.q,vt,t.s_t0),l.p);t.SubVV(ut,i.MulRV(a.q,yt,t.s_t0),a.p);v.Initialize(f,l,a,et);var ot=v.normal,st=v.point,ht=v.separation;t.SubVV(st,it,b);t.SubVV(st,ut,k);d=o(d,ht);var wt=y(.75*(ht+s),-.2,0),ct=t.CrossVV(b,ot),lt=t.CrossVV(k,ot),at=nt+p+tt*ct*ct+w*lt*lt,bt=at>0?-wt/at:0;t.MulSV(bt,ot,e);it.SelfMulSub(nt,e);rt-=tt*t.CrossVV(b,e);ut.SelfMulAdd(p,e);ft+=w*t.CrossVV(k,e)}this.m_positions[h].a=rt;this.m_positions[c].a=ft}return d>=-1.5*s},n.InitializeVelocityConstraints_s_xfA=new r,n.InitializeVelocityConstraints_s_xfB=new r,n.InitializeVelocityConstraints_s_worldManifold=new kr,n.WarmStart_s_P=new t,n.SolveVelocityConstraints_s_dv=new t,n.SolveVelocityConstraints_s_dv1=new t,n.SolveVelocityConstraints_s_dv2=new t,n.SolveVelocityConstraints_s_P=new t,n.SolveVelocityConstraints_s_a=new t,n.SolveVelocityConstraints_s_b=new t,n.SolveVelocityConstraints_s_x=new t,n.SolveVelocityConstraints_s_d=new t,n.SolveVelocityConstraints_s_P1=new t,n.SolveVelocityConstraints_s_P2=new t,n.SolveVelocityConstraints_s_P1P2=new t,n.SolvePositionConstraints_s_xfA=new r,n.SolvePositionConstraints_s_xfB=new r,n.SolvePositionConstraints_s_psm=new uf,n.SolvePositionConstraints_s_rA=new t,n.SolvePositionConstraints_s_rB=new t,n.SolvePositionConstraints_s_P=new t,n.SolveTOIPositionConstraints_s_xfA=new r,n.SolveTOIPositionConstraints_s_xfB=new r,n.SolveTOIPositionConstraints_s_psm=new uf,n.SolveTOIPositionConstraints_s_rA=new t,n.SolveTOIPositionConstraints_s_rB=new t,n.SolveTOIPositionConstraints_s_P=new t,n}(),ko=function(){function i(){this.m_allocator=null;this.m_bodies=[];this.m_contacts=[];this.m_joints=[];this.m_positions=gu.MakeArray(1024);this.m_velocities=nf.MakeArray(1024);this.m_bodyCount=0;this.m_jointCount=0;this.m_contactCount=0;this.m_bodyCapacity=0;this.m_contactCapacity=0;this.m_jointCapacity=0}return i.prototype.Initialize=function(n,t,i,r,u){if(this.m_bodyCapacity=n,this.m_contactCapacity=t,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=r,this.m_listener=u,this.m_positions.length<n)for(var e=f(2*this.m_positions.length,n);this.m_positions.length<e;)this.m_positions[this.m_positions.length]=new gu;if(this.m_velocities.length<n)for(e=f(2*this.m_velocities.length,n);this.m_velocities.length<e;)this.m_velocities[this.m_velocities.length]=new nf},i.prototype.Clear=function(){this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0},i.prototype.AddBody=function(n){n.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=n},i.prototype.AddContact=function(n){this.m_contacts[this.m_contactCount++]=n},i.prototype.AddJoint=function(n){this.m_joints[this.m_jointCount++]=n},i.prototype.Solve=function(r,u,f,e){for(var h,b,p,k,w,ft,it,et,rt,ot,st,ut,ht,g,nt,d=i.s_timer.Reset(),a=u.dt,s=0;s<this.m_bodyCount;++s){h=this.m_bodies[s];this.m_positions[s].c.Copy(h.m_sweep.c);var tt=h.m_sweep.a,v=this.m_velocities[s].v.Copy(h.m_linearVelocity),y=h.m_angularVelocity;h.m_sweep.c0.Copy(h.m_sweep.c);h.m_sweep.a0=h.m_sweep.a;h.m_type===n.b2BodyType.b2_dynamicBody&&(v.x+=a*(h.m_gravityScale*f.x+h.m_invMass*h.m_force.x),v.y+=a*(h.m_gravityScale*f.y+h.m_invMass*h.m_force.y),y+=a*h.m_invI*h.m_torque,v.SelfMul(1/(1+a*h.m_linearDamping)),y*=1/(1+a*h.m_angularDamping));this.m_positions[s].a=tt;this.m_velocities[s].w=y}for(d.Reset(),b=i.s_solverData,b.step.Copy(u),b.positions=this.m_positions,b.velocities=this.m_velocities,p=i.s_contactSolverDef,p.step.Copy(u),p.contacts=this.m_contacts,p.count=this.m_contactCount,p.positions=this.m_positions,p.velocities=this.m_velocities,p.allocator=this.m_allocator,k=i.s_contactSolver.Initialize(p),k.InitializeVelocityConstraints(),u.warmStarting&&k.WarmStart(),s=0;s<this.m_jointCount;++s)this.m_joints[s].InitVelocityConstraints(b);for(r.solveInit=d.GetMilliseconds(),d.Reset(),s=0;s<u.velocityIterations;++s){for(w=0;w<this.m_jointCount;++w)this.m_joints[w].SolveVelocityConstraints(b);k.SolveVelocityConstraints()}for(k.StoreImpulses(),r.solveVelocity=d.GetMilliseconds(),s=0;s<this.m_bodyCount;++s)ft=this.m_positions[s].c,it=(tt=this.m_positions[s].a,v=this.m_velocities[s].v,y=this.m_velocities[s].w,t.MulSV(a,v,i.s_translation)),t.DotVV(it,it)>4&&(et=2/it.Length(),v.SelfMul(et)),rt=a*y,rt*rt>2.4674011002726646&&(y*=et=1.570796326795/l(rt)),ft.x+=a*v.x,ft.y+=a*v.y,tt+=a*y,this.m_positions[s].a=tt,this.m_velocities[s].w=y;for(d.Reset(),ot=!1,s=0;s<u.positionIterations;++s){for(st=k.SolvePositionConstraints(),ut=!0,w=0;w<this.m_jointCount;++w)ht=this.m_joints[w].SolvePositionConstraints(b),ut=ut&&ht;if(st&&ut){ot=!0;break}}for(s=0;s<this.m_bodyCount;++s)g=this.m_bodies[s],g.m_sweep.c.Copy(this.m_positions[s].c),g.m_sweep.a=this.m_positions[s].a,g.m_linearVelocity.Copy(this.m_velocities[s].v),g.m_angularVelocity=this.m_velocities[s].w,g.SynchronizeTransform();if(r.solvePosition=d.GetMilliseconds(),this.Report(k.m_velocityConstraints),e){for(nt=c,s=0;s<this.m_bodyCount;++s)(h=this.m_bodies[s]).GetType()!==n.b2BodyType.b2_staticBody&&(!h.m_autoSleepFlag||h.m_angularVelocity*h.m_angularVelocity>.0012184696791469947||t.DotVV(h.m_linearVelocity,h.m_linearVelocity)>.0001?(h.m_sleepTime=0,nt=0):(h.m_sleepTime+=a,nt=o(nt,h.m_sleepTime)));if(nt>=.5&&ot)for(s=0;s<this.m_bodyCount;++s)(h=this.m_bodies[s]).SetAwake(!1)}},i.prototype.SolveTOI=function(n,r,u){for(var s,e,h,c,b,y,o,f=0;f<this.m_bodyCount;++f)s=this.m_bodies[f],this.m_positions[f].c.Copy(s.m_sweep.c),this.m_positions[f].a=s.m_sweep.a,this.m_velocities[f].v.Copy(s.m_linearVelocity),this.m_velocities[f].w=s.m_angularVelocity;for(e=i.s_contactSolverDef,e.contacts=this.m_contacts,e.count=this.m_contactCount,e.allocator=this.m_allocator,e.step.Copy(n),e.positions=this.m_positions,e.velocities=this.m_velocities,h=i.s_contactSolver.Initialize(e),f=0;f<n.positionIterations&&!h.SolveTOIPositionConstraints(r,u);++f);for(this.m_bodies[r].m_sweep.c0.Copy(this.m_positions[r].c),this.m_bodies[r].m_sweep.a0=this.m_positions[r].a,this.m_bodies[u].m_sweep.c0.Copy(this.m_positions[u].c),this.m_bodies[u].m_sweep.a0=this.m_positions[u].a,h.InitializeVelocityConstraints(),f=0;f<n.velocityIterations;++f)h.SolveVelocityConstraints();for(c=n.dt,f=0;f<this.m_bodyCount;++f){var k=this.m_positions[f].c,p=this.m_positions[f].a,v=this.m_velocities[f].v,a=this.m_velocities[f].w,w=t.MulSV(c,v,i.s_translation);t.DotVV(w,w)>4&&(b=2/w.Length(),v.SelfMul(b));y=c*a;y*y>2.4674011002726646&&(a*=b=1.570796326795/l(y));k.SelfMulAdd(c,v);p+=c*a;this.m_positions[f].a=p;this.m_velocities[f].w=a;o=this.m_bodies[f];o.m_sweep.c.Copy(k);o.m_sweep.a=p;o.m_linearVelocity.Copy(v);o.m_angularVelocity=a;o.SynchronizeTransform()}this.Report(h.m_velocityConstraints)},i.prototype.Report=function(n){var r,e,u,f,t;if(null!==this.m_listener)for(r=0;r<this.m_contactCount;++r)if(e=this.m_contacts[r],e){for(u=n[r],f=i.s_impulse,f.count=u.pointCount,t=0;t<u.pointCount;++t)f.normalImpulses[t]=u.points[t].normalImpulse,f.tangentImpulses[t]=u.points[t].tangentImpulse;this.m_listener.PostSolve(e,f)}},i.s_timer=new ci,i.s_solverData=new yo,i.s_contactSolverDef=new wo,i.s_contactSolver=new bo,i.s_translation=new t,i.s_impulse=new lo,i}();(h=n.b2ParticleFlag||(n.b2ParticleFlag={}))[h.b2_waterParticle=0]="b2_waterParticle";h[h.b2_zombieParticle=2]="b2_zombieParticle";h[h.b2_wallParticle=4]="b2_wallParticle";h[h.b2_springParticle=8]="b2_springParticle";h[h.b2_elasticParticle=16]="b2_elasticParticle";h[h.b2_viscousParticle=32]="b2_viscousParticle";h[h.b2_powderParticle=64]="b2_powderParticle";h[h.b2_tensileParticle=128]="b2_tensileParticle";h[h.b2_colorMixingParticle=256]="b2_colorMixingParticle";h[h.b2_destructionListenerParticle=512]="b2_destructionListenerParticle";h[h.b2_barrierParticle=1024]="b2_barrierParticle";h[h.b2_staticPressureParticle=2048]="b2_staticPressureParticle";h[h.b2_reactiveParticle=4096]="b2_reactiveParticle";h[h.b2_repulsiveParticle=8192]="b2_repulsiveParticle";h[h.b2_fixtureContactListenerParticle=16384]="b2_fixtureContactListenerParticle";h[h.b2_particleContactListenerParticle=32768]="b2_particleContactListenerParticle";h[h.b2_fixtureContactFilterParticle=65536]="b2_fixtureContactFilterParticle";h[h.b2_particleContactFilterParticle=131072]="b2_particleContactFilterParticle";er=function(){this.flags=0;this.position=new t;this.velocity=new t;this.color=new it(0,0,0,0);this.lifetime=0;this.userData=null;this.group=null};ff=function(){function n(){this.m_index=tt}return n.prototype.GetIndex=function(){return this.m_index},n.prototype.SetIndex=function(n){this.m_index=n},n}();(st=n.b2ParticleGroupFlag||(n.b2ParticleGroupFlag={}))[st.b2_solidParticleGroup=1]="b2_solidParticleGroup";st[st.b2_rigidParticleGroup=2]="b2_rigidParticleGroup";st[st.b2_particleGroupCanBeEmpty=4]="b2_particleGroupCanBeEmpty";st[st.b2_particleGroupWillBeDestroyed=8]="b2_particleGroupWillBeDestroyed";st[st.b2_particleGroupNeedsUpdateDepth=16]="b2_particleGroupNeedsUpdateDepth";st[st.b2_particleGroupInternalMask=24]="b2_particleGroupInternalMask";var ns=function(){this.flags=0;this.groupFlags=0;this.position=new t;this.angle=0;this.linearVelocity=new t;this.angularVelocity=0;this.color=new it;this.strength=1;this.shapeCount=0;this.stride=0;this.particleCount=0;this.lifetime=0;this.userData=null;this.group=null},ts=function(){function i(n){this.m_firstIndex=0;this.m_lastIndex=0;this.m_groupFlags=0;this.m_strength=1;this.m_prev=null;this.m_next=null;this.m_timestamp=-1;this.m_mass=0;this.m_inertia=0;this.m_center=new t;this.m_linearVelocity=new t;this.m_angularVelocity=0;this.m_transform=new r;this.m_userData=null;this.m_system=n}return i.prototype.GetNext=function(){return this.m_next},i.prototype.GetParticleSystem=function(){return this.m_system},i.prototype.GetParticleCount=function(){return this.m_lastIndex-this.m_firstIndex},i.prototype.GetBufferIndex=function(){return this.m_firstIndex},i.prototype.ContainsParticle=function(n){return this.m_firstIndex<=n&&n<this.m_lastIndex},i.prototype.GetAllParticleFlags=function(){if(!this.m_system.m_flagsBuffer.data)throw new Error;for(var t=0,n=this.m_firstIndex;n<this.m_lastIndex;n++)t|=this.m_system.m_flagsBuffer.data[n];return t},i.prototype.GetGroupFlags=function(){return this.m_groupFlags},i.prototype.SetGroupFlags=function(t){t|=this.m_groupFlags&n.b2ParticleGroupFlag.b2_particleGroupInternalMask;this.m_system.SetGroupFlags(this,t)},i.prototype.GetMass=function(){return this.UpdateStatistics(),this.m_mass},i.prototype.GetInertia=function(){return this.UpdateStatistics(),this.m_inertia},i.prototype.GetCenter=function(){return this.UpdateStatistics(),this.m_center},i.prototype.GetLinearVelocity=function(){return this.UpdateStatistics(),this.m_linearVelocity},i.prototype.GetAngularVelocity=function(){return this.UpdateStatistics(),this.m_angularVelocity},i.prototype.GetTransform=function(){return this.m_transform},i.prototype.GetPosition=function(){return this.m_transform.p},i.prototype.GetAngle=function(){return this.m_transform.q.GetAngle()},i.prototype.GetLinearVelocityFromWorldPoint=function(n,r){var u=i.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),t.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,t.SubVV(n,this.m_center,u),r)},i.prototype.GetUserData=function(){return this.m_userData},i.prototype.SetUserData=function(n){this.m_userData=n},i.prototype.ApplyForce=function(n){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,n)},i.prototype.ApplyLinearImpulse=function(n){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,n)},i.prototype.DestroyParticles=function(n){if(this.m_system.m_world.IsLocked())throw new Error;for(var t=this.m_firstIndex;t<this.m_lastIndex;t++)this.m_system.DestroyParticle(t,n)},i.prototype.UpdateStatistics=function(){var r,u,i,n,f;if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;if(r=new t,u=new t,this.m_timestamp!==this.m_system.m_timestamp){for(i=this.m_system.GetParticleMass(),this.m_mass=i*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero(),n=this.m_firstIndex;n<this.m_lastIndex;n++)this.m_center.SelfMulAdd(i,this.m_system.m_positionBuffer.data[n]),this.m_linearVelocity.SelfMulAdd(i,this.m_system.m_velocityBuffer.data[n]);for(this.m_mass>0&&(f=1/this.m_mass,this.m_center.SelfMul(f),this.m_linearVelocity.SelfMul(f)),this.m_inertia=0,this.m_angularVelocity=0,n=this.m_firstIndex;n<this.m_lastIndex;n++)t.SubVV(this.m_system.m_positionBuffer.data[n],this.m_center,r),t.SubVV(this.m_system.m_velocityBuffer.data[n],this.m_linearVelocity,u),this.m_inertia+=i*t.DotVV(r,r),this.m_angularVelocity+=i*t.CrossVV(r,u);this.m_inertia>0&&(this.m_angularVelocity*=1/this.m_inertia);this.m_timestamp=this.m_system.m_timestamp}},i.GetLinearVelocityFromWorldPoint_s_t0=new t,i}(),ca=function(){function n(n){this.m_front=0;this.m_back=0;this.m_capacity=0;this.m_buffer=k(n,function(){return null});this.m_capacity=n}return n.prototype.Push=function(n){if(this.m_back>=this.m_capacity){for(var t=this.m_front;t<this.m_back;t++)this.m_buffer[t-this.m_front]=this.m_buffer[t];this.m_back-=this.m_front;this.m_front=0;this.m_back>=this.m_capacity&&(this.m_capacity>0?(this.m_buffer.concat(k(this.m_capacity,function(){return null})),this.m_capacity*=2):(this.m_buffer.concat(k(1,function(){return null})),this.m_capacity=1))}this.m_buffer[this.m_back]=n;this.m_back++},n.prototype.Pop=function(){this.m_buffer[this.m_front]=null;this.m_front++},n.prototype.Empty=function(){return this.m_front===this.m_back},n.prototype.Front=function(){var n=this.m_buffer[this.m_front];if(!n)throw new Error;return n},n}(),ef=function(){function n(t){this.m_generatorCapacity=0;this.m_generatorCount=0;this.m_countX=0;this.m_countY=0;this.m_diagram=[];this.m_generatorBuffer=k(t,function(){return new n.Generator});this.m_generatorCapacity=t}return n.prototype.AddGenerator=function(n,t,i){var r=this.m_generatorBuffer[this.m_generatorCount++];r.center.Copy(n);r.tag=t;r.necessary=i},n.prototype.Generate=function(i,r){for(var o,u,f,e,s,a,y,h,w=1/i,v=new t(+c,+c),p=new t(-c,-c),b=0,l=0;l<this.m_generatorCount;l++)(s=this.m_generatorBuffer[l]).necessary&&(t.MinV(v,s.center,v),t.MaxV(p,s.center,p),++b);if(0===b)return this.m_countX=0,void(this.m_countY=0);for(v.x-=r,v.y-=r,p.x+=r,p.y+=r,this.m_countX=1+Math.floor(w*(p.x-v.x)),this.m_countY=1+Math.floor(w*(p.y-v.y)),this.m_diagram=[],o=new ca(4*this.m_countX*this.m_countY),l=0;l<this.m_generatorCount;l++)(s=this.m_generatorBuffer[l]).center.SelfSub(v).SelfMul(w),u=Math.floor(s.center.x),f=Math.floor(s.center.y),u>=0&&f>=0&&u<this.m_countX&&f<this.m_countY&&o.Push(new n.Task(u,f,u+f*this.m_countX,s));for(;!o.Empty();)u=(a=o.Front()).m_x,f=a.m_y,e=a.m_i,s=a.m_generator,o.Pop(),this.m_diagram[e]||(this.m_diagram[e]=s,u>0&&o.Push(new n.Task(u-1,f,e-1,s)),f>0&&o.Push(new n.Task(u,f-1,e-this.m_countX,s)),u<this.m_countX-1&&o.Push(new n.Task(u+1,f,e+1,s)),f<this.m_countY-1&&o.Push(new n.Task(u,f+1,e+this.m_countX,s)));for(f=0;f<this.m_countY;f++)for(u=0;u<this.m_countX-1;u++)e=u+f*this.m_countX,(y=this.m_diagram[e])!==(h=this.m_diagram[e+1])&&(o.Push(new n.Task(u,f,e,h)),o.Push(new n.Task(u+1,f,e+1,y)));for(f=0;f<this.m_countY-1;f++)for(u=0;u<this.m_countX;u++)e=u+f*this.m_countX,(y=this.m_diagram[e])!==(h=this.m_diagram[e+this.m_countX])&&(o.Push(new n.Task(u,f,e,h)),o.Push(new n.Task(u,f+1,e+this.m_countX,y)));for(;!o.Empty();)if(u=(a=o.Front()).m_x,f=a.m_y,e=a.m_i,l=a.m_generator,o.Pop(),(y=this.m_diagram[e])!==(h=l)){var k=y.center.x-u,d=y.center.y-f,g=h.center.x-u,nt=h.center.y-f;k*k+d*d>g*g+nt*nt&&(this.m_diagram[e]=h,u>0&&o.Push(new n.Task(u-1,f,e-1,h)),f>0&&o.Push(new n.Task(u,f-1,e-this.m_countX,h)),u<this.m_countX-1&&o.Push(new n.Task(u+1,f,e+1,h)),f<this.m_countY-1&&o.Push(new n.Task(u,f+1,e+this.m_countX,h)))}},n.prototype.GetNodes=function(n){for(var f,u=0;u<this.m_countY-1;u++)for(f=0;f<this.m_countX-1;f++){var e=f+u*this.m_countX,r=this.m_diagram[e],t=this.m_diagram[e+1],i=this.m_diagram[e+this.m_countX],o=this.m_diagram[e+1+this.m_countX];t!==i&&(r!==t&&r!==i&&(r.necessary||t.necessary||i.necessary)&&n(r.tag,t.tag,i.tag),o!==t&&o!==i&&(r.necessary||t.necessary||i.necessary)&&n(t.tag,o.tag,i.tag))}},n}();(function(n){n.Generator=function(){this.center=new t;this.tag=0;this.necessary=!1};n.Task=function(n,t,i,r){this.m_x=n;this.m_y=t;this.m_i=i;this.m_generator=r}})(ef||(ef={}));var si=function(){function n(n){this.data=[];this.count=0;this.capacity=0;this.allocator=n}return n.prototype.Append=function(){return this.count>=this.capacity&&this.Grow(),this.count++},n.prototype.Reserve=function(n){if(!(this.capacity>=n)){for(var t=this.capacity;t<n;++t)this.data[t]=this.allocator();this.capacity=n}},n.prototype.Grow=function(){var n=this.capacity?2*this.capacity:256;this.Reserve(n)},n.prototype.Free=function(){0!==this.data.length&&(this.data=[],this.capacity=0,this.count=0)},n.prototype.Shorten=function(){},n.prototype.Data=function(){return this.data},n.prototype.GetCount=function(){return this.count},n.prototype.SetCount=function(n){this.count=n},n.prototype.GetCapacity=function(){return this.capacity},n.prototype.RemoveIf=function(n){this.count=rs(this.data,n,this.count)},n.prototype.Unique=function(n){this.count=la(this.data,0,this.count,n)},n}(),of=function(n){function t(t){var i=n.call(this)||this;return i.m_system=t,i}return e(t,n),t.prototype.ShouldQueryParticleSystem=function(){return!1},t.prototype.ReportFixture=function(n){var i,t;if(n.IsSensor())return!0;for(i=n.GetShape().GetChildCount(),t=0;t<i;t++)for(var u=n.GetAABB(t),f=this.m_system.GetInsideBoundsEnumerator(u),r=void 0;(r=f.GetNext())>=0;)this.ReportFixtureAndParticle(n,t,r);return!0},t.prototype.ReportParticle=function(){return!1},t.prototype.ReportFixtureAndParticle=function(){},t}(vi),es=function(){function n(){this.indexA=0;this.indexB=0;this.weight=0;this.normal=new t;this.flags=0}return n.prototype.SetIndices=function(n,t){this.indexA=n;this.indexB=t},n.prototype.SetWeight=function(n){this.weight=n},n.prototype.SetNormal=function(n){this.normal.Copy(n)},n.prototype.SetFlags=function(n){this.flags=n},n.prototype.GetIndexA=function(){return this.indexA},n.prototype.GetIndexB=function(){return this.indexB},n.prototype.GetWeight=function(){return this.weight},n.prototype.GetNormal=function(){return this.normal},n.prototype.GetFlags=function(){return this.flags},n.prototype.IsEqual=function(n){return this.indexA===n.indexA&&this.indexB===n.indexB&&this.flags===n.flags&&this.weight===n.weight&&this.normal.x===n.normal.x&&this.normal.y===n.normal.y},n.prototype.IsNotEqual=function(n){return!this.IsEqual(n)},n.prototype.ApproximatelyEqual=function(n){return this.indexA===n.indexA&&this.indexB===n.indexB&&this.flags===n.flags&&l(this.weight-n.weight)<.01&&t.DistanceSquaredVV(this.normal,n.normal)<.0001},n}(),os=function(){this.index=0;this.weight=0;this.normal=new t;this.mass=0},ss=function(){this.indexA=0;this.indexB=0;this.flags=0;this.strength=0;this.distance=0},hs=function(){this.indexA=0;this.indexB=0;this.indexC=0;this.flags=0;this.strength=0;this.pa=new t(0,0);this.pb=new t(0,0);this.pc=new t(0,0);this.ka=0;this.kb=0;this.kc=0;this.s=0},cs=function(){function n(){this.strictContactCheck=!1;this.density=1;this.gravityScale=1;this.radius=1;this.maxCount=0;this.pressureStrength=.005;this.dampingStrength=1;this.elasticStrength=.25;this.springStrength=.25;this.viscousStrength=.25;this.surfaceTensionPressureStrength=.2;this.surfaceTensionNormalStrength=.2;this.repulsiveStrength=1;this.powderStrength=.5;this.ejectionStrength=.5;this.staticPressureStrength=.2;this.staticPressureRelaxation=.2;this.staticPressureIterations=8;this.colorMixingStrength=.5;this.destroyByAge=!0;this.lifetimeGranularity=1/60}return n.prototype.Copy=function(n){return this.strictContactCheck=n.strictContactCheck,this.density=n.density,this.gravityScale=n.gravityScale,this.radius=n.radius,this.maxCount=n.maxCount,this.pressureStrength=n.pressureStrength,this.dampingStrength=n.dampingStrength,this.elasticStrength=n.elasticStrength,this.springStrength=n.springStrength,this.viscousStrength=n.viscousStrength,this.surfaceTensionPressureStrength=n.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=n.surfaceTensionNormalStrength,this.repulsiveStrength=n.repulsiveStrength,this.powderStrength=n.powderStrength,this.ejectionStrength=n.ejectionStrength,this.staticPressureStrength=n.staticPressureStrength,this.staticPressureRelaxation=n.staticPressureRelaxation,this.staticPressureIterations=n.staticPressureIterations,this.colorMixingStrength=n.colorMixingStrength,this.destroyByAge=n.destroyByAge,this.lifetimeGranularity=n.lifetimeGranularity,this},n.prototype.Clone=function(){return(new n).Copy(this)},n}();n.b2ParticleSystem=function(){function e(n,t){this.m_paused=!1;this.m_timestamp=0;this.m_allParticleFlags=0;this.m_needsUpdateAllParticleFlags=!1;this.m_allGroupFlags=0;this.m_needsUpdateAllGroupFlags=!1;this.m_hasForce=!1;this.m_iterationIndex=0;this.m_inverseDensity=0;this.m_particleDiameter=0;this.m_inverseDiameter=0;this.m_squaredDiameter=0;this.m_count=0;this.m_internalAllocatedCapacity=0;this.m_handleIndexBuffer=new e.UserOverridableBuffer;this.m_flagsBuffer=new e.UserOverridableBuffer;this.m_positionBuffer=new e.UserOverridableBuffer;this.m_velocityBuffer=new e.UserOverridableBuffer;this.m_forceBuffer=[];this.m_weightBuffer=[];this.m_staticPressureBuffer=[];this.m_accumulationBuffer=[];this.m_accumulation2Buffer=[];this.m_depthBuffer=[];this.m_colorBuffer=new e.UserOverridableBuffer;this.m_groupBuffer=[];this.m_userDataBuffer=new e.UserOverridableBuffer;this.m_stuckThreshold=0;this.m_lastBodyContactStepBuffer=new e.UserOverridableBuffer;this.m_bodyContactCountBuffer=new e.UserOverridableBuffer;this.m_consecutiveContactStepsBuffer=new e.UserOverridableBuffer;this.m_stuckParticleBuffer=new si(function(){return 0});this.m_proxyBuffer=new si(function(){return new e.Proxy});this.m_contactBuffer=new si(function(){return new es});this.m_bodyContactBuffer=new si(function(){return new os});this.m_pairBuffer=new si(function(){return new ss});this.m_triadBuffer=new si(function(){return new hs});this.m_expirationTimeBuffer=new e.UserOverridableBuffer;this.m_indexByExpirationTimeBuffer=new e.UserOverridableBuffer;this.m_timeElapsed=0;this.m_expirationTimeBufferRequiresSorting=!1;this.m_groupCount=0;this.m_groupList=null;this.m_def=new cs;this.m_prev=null;this.m_next=null;this.SetStrictContactCheck(n.strictContactCheck);this.SetDensity(n.density);this.SetGravityScale(n.gravityScale);this.SetRadius(n.radius);this.SetMaxParticleCount(n.maxCount);this.m_def=n.Clone();this.m_world=t;this.SetDestructionByAge(this.m_def.destroyByAge)}return e.computeTag=function(n,t){return(t+e.yOffset>>>0<<e.yShift)+(e.xScale*n+e.xOffset>>>0)>>>0},e.computeRelativeTag=function(n,t,i){return n+(i<<e.yShift)+(t<<e.xShift)>>>0},e.prototype.Drop=function(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer);this.FreeUserOverridableBuffer(this.m_flagsBuffer);this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer);this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer);this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer);this.FreeUserOverridableBuffer(this.m_positionBuffer);this.FreeUserOverridableBuffer(this.m_velocityBuffer);this.FreeUserOverridableBuffer(this.m_colorBuffer);this.FreeUserOverridableBuffer(this.m_userDataBuffer);this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer);this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer);this.FreeBuffer(this.m_forceBuffer,this.m_internalAllocatedCapacity);this.FreeBuffer(this.m_weightBuffer,this.m_internalAllocatedCapacity);this.FreeBuffer(this.m_staticPressureBuffer,this.m_internalAllocatedCapacity);this.FreeBuffer(this.m_accumulationBuffer,this.m_internalAllocatedCapacity);this.FreeBuffer(this.m_accumulation2Buffer,this.m_internalAllocatedCapacity);this.FreeBuffer(this.m_depthBuffer,this.m_internalAllocatedCapacity);this.FreeBuffer(this.m_groupBuffer,this.m_internalAllocatedCapacity)},e.prototype.CreateParticle=function(n){var e,i,f,r;if(this.m_world.IsLocked())throw new Error;if(this.m_count>=this.m_internalAllocatedCapacity&&(e=this.m_count?2*this.m_count:256,this.ReallocateInternalAllocatedBuffers(e)),this.m_count>=this.m_internalAllocatedCapacity){if(!this.m_def.destroyByAge)return tt;this.DestroyOldestParticle(0,!1);this.SolveZombie()}if(i=this.m_count++,!this.m_flagsBuffer.data)throw new Error;if(this.m_flagsBuffer.data[i]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[i]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[i]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[i]=0),!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;this.m_positionBuffer.data[i]=(this.m_positionBuffer.data[i]||new t).Copy(u(n.position,t.ZERO));this.m_velocityBuffer.data[i]=(this.m_velocityBuffer.data[i]||new t).Copy(u(n.velocity,t.ZERO));this.m_weightBuffer[i]=0;this.m_forceBuffer[i]=(this.m_forceBuffer[i]||new t).SetZero();this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[i]=0);this.m_depthBuffer&&(this.m_depthBuffer[i]=0);f=(new it).Copy(u(n.color,it.ZERO));!this.m_colorBuffer.data&&f.IsZero()||(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[i]=(this.m_colorBuffer.data[i]||new it).Copy(f));(this.m_userDataBuffer.data||n.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[i]=n.userData);this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[i]=null);var h=this.m_proxyBuffer.data[this.m_proxyBuffer.Append()],o=u(n.lifetime,0),s=o>0;if(this.m_expirationTimeBuffer.data||s){if(this.SetParticleLifetime(i,s?o:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),!this.m_indexByExpirationTimeBuffer.data)throw new Error;this.m_indexByExpirationTimeBuffer.data[i]=i}return h.index=i,r=u(n.group,null),this.m_groupBuffer[i]=r,r&&(r.m_firstIndex<r.m_lastIndex?(this.RotateBuffer(r.m_firstIndex,r.m_lastIndex,i),r.m_lastIndex=i+1):(r.m_firstIndex=i,r.m_lastIndex=i+1)),this.SetParticleFlags(i,u(n.flags,0)),i},e.prototype.GetParticleHandleFromIndex=function(n){this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);var t=this.m_handleIndexBuffer.data[n];return t||((t=new ff).SetIndex(n),this.m_handleIndexBuffer.data[n]=t,t)},e.prototype.DestroyParticle=function(t,i){if(void 0===i&&(i=!1),!this.m_flagsBuffer.data)throw new Error;var r=n.b2ParticleFlag.b2_zombieParticle;i&&(r|=n.b2ParticleFlag.b2_destructionListenerParticle);this.SetParticleFlags(t,this.m_flagsBuffer.data[t]|r)},e.prototype.DestroyOldestParticle=function(n,t){var r,i,u;if(void 0===t&&(t=!1),r=this.GetParticleCount(),!this.m_indexByExpirationTimeBuffer.data)throw new Error;if(!this.m_expirationTimeBuffer.data)throw new Error;i=this.m_indexByExpirationTimeBuffer.data[r-(n+1)];u=this.m_indexByExpirationTimeBuffer.data[n];this.DestroyParticle(this.m_expirationTimeBuffer.data[i]>0?i:u,t)},e.prototype.DestroyParticlesInShape=function(n,t,i){var f,r,u;if(void 0===i&&(i=!1),f=e.DestroyParticlesInShape_s_aabb,this.m_world.IsLocked())throw new Error;return r=new e.DestroyParticlesInShapeCallback(this,n,t,i),u=f,n.ComputeAABB(u,t,0),this.m_world.QueryAABB(r,u),r.Destroyed()},e.prototype.CreateParticleGroup=function(n){var a=e.CreateParticleGroup_s_transform,f,o,h,r,c,s,i,l;if(this.m_world.IsLocked())throw new Error;if(f=a,f.SetPositionAngle(u(n.position,t.ZERO),u(n.angle,0)),o=this.m_count,n.shape&&this.CreateParticlesWithShapeForGroup(n.shape,n,f),n.shapes&&this.CreateParticlesWithShapesForGroup(n.shapes,u(n.shapeCount,n.shapes.length),n,f),n.positionData)for(h=u(n.particleCount,n.positionData.length),r=0;r<h;r++)c=n.positionData[r],this.CreateParticleForGroup(n,f,c);for(s=this.m_count,i=new ts(this),i.m_firstIndex=o,i.m_lastIndex=s,i.m_strength=u(n.strength,1),i.m_userData=n.userData,i.m_transform.Copy(f),i.m_prev=null,i.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=i),this.m_groupList=i,++this.m_groupCount,r=o;r<s;r++)this.m_groupBuffer[r]=i;return this.SetGroupFlags(i,u(n.groupFlags,0)),l=new e.ConnectionFilter,this.UpdateContacts(!0),this.UpdatePairsAndTriads(o,s,l),n.group&&(this.JoinParticleGroups(n.group,i),i=n.group),i},e.prototype.JoinParticleGroups=function(n,t){var r,i,u;if(this.m_world.IsLocked())throw new Error;for(this.RotateBuffer(t.m_firstIndex,t.m_lastIndex,this.m_count),this.RotateBuffer(n.m_firstIndex,n.m_lastIndex,t.m_firstIndex),r=new e.JoinParticleGroupsFilter(t.m_firstIndex),this.UpdateContacts(!0),this.UpdatePairsAndTriads(n.m_firstIndex,t.m_lastIndex,r),i=t.m_firstIndex;i<t.m_lastIndex;i++)this.m_groupBuffer[i]=n;u=n.m_groupFlags|t.m_groupFlags;this.SetGroupFlags(n,u);n.m_lastIndex=t.m_lastIndex;t.m_firstIndex=t.m_lastIndex;this.DestroyParticleGroup(t)},e.prototype.SplitParticleGroup=function(n){var t,i;this.UpdateContacts(!0);t=k(n.GetParticleCount(),function(){return new e.ParticleListNode});e.InitializeParticleLists(n,t);this.MergeParticleListsInContact(n,t);i=e.FindLongestParticleList(n,t);this.MergeZombieParticleListNodes(n,t,i);this.CreateParticleGroupsFromParticleList(n,t,i);this.UpdatePairsAndTriadsWithParticleList(n,t)},e.prototype.GetParticleGroupList=function(){return this.m_groupList},e.prototype.GetParticleGroupCount=function(){return this.m_groupCount},e.prototype.GetParticleCount=function(){return this.m_count},e.prototype.GetMaxParticleCount=function(){return this.m_def.maxCount},e.prototype.SetMaxParticleCount=function(n){this.m_def.maxCount=n},e.prototype.GetAllParticleFlags=function(){return this.m_allParticleFlags},e.prototype.GetAllGroupFlags=function(){return this.m_allGroupFlags},e.prototype.SetPaused=function(n){this.m_paused=n},e.prototype.GetPaused=function(){return this.m_paused},e.prototype.SetDensity=function(n){this.m_def.density=n;this.m_inverseDensity=1/this.m_def.density},e.prototype.GetDensity=function(){return this.m_def.density},e.prototype.SetGravityScale=function(n){this.m_def.gravityScale=n},e.prototype.GetGravityScale=function(){return this.m_def.gravityScale},e.prototype.SetDamping=function(n){this.m_def.dampingStrength=n},e.prototype.GetDamping=function(){return this.m_def.dampingStrength},e.prototype.SetStaticPressureIterations=function(n){this.m_def.staticPressureIterations=n},e.prototype.GetStaticPressureIterations=function(){return this.m_def.staticPressureIterations},e.prototype.SetRadius=function(n){this.m_particleDiameter=2*n;this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter;this.m_inverseDiameter=1/this.m_particleDiameter},e.prototype.GetRadius=function(){return this.m_particleDiameter/2},e.prototype.GetPositionBuffer=function(){if(!this.m_positionBuffer.data)throw new Error;return this.m_positionBuffer.data},e.prototype.GetVelocityBuffer=function(){if(!this.m_velocityBuffer.data)throw new Error;return this.m_velocityBuffer.data},e.prototype.GetColorBuffer=function(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data},e.prototype.GetGroupBuffer=function(){return this.m_groupBuffer},e.prototype.GetWeightBuffer=function(){return this.m_weightBuffer},e.prototype.GetUserDataBuffer=function(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data},e.prototype.GetFlagsBuffer=function(){if(!this.m_flagsBuffer.data)throw new Error;return this.m_flagsBuffer.data},e.prototype.SetParticleFlags=function(t,i){if(!this.m_flagsBuffer.data)throw new Error;this.m_flagsBuffer.data[t]&~i&&(this.m_needsUpdateAllParticleFlags=!0);~this.m_allParticleFlags&i&&(i&n.b2ParticleFlag.b2_tensileParticle&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),i&n.b2ParticleFlag.b2_colorMixingParticle&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=i);this.m_flagsBuffer.data[t]=i},e.prototype.GetParticleFlags=function(n){if(!this.m_flagsBuffer.data)throw new Error;return this.m_flagsBuffer.data[n]},e.prototype.SetFlagsBuffer=function(n,t){this.SetUserOverridableBuffer(this.m_flagsBuffer,n,t)},e.prototype.SetPositionBuffer=function(n,t){this.SetUserOverridableBuffer(this.m_positionBuffer,n,t)},e.prototype.SetVelocityBuffer=function(n,t){this.SetUserOverridableBuffer(this.m_velocityBuffer,n,t)},e.prototype.SetColorBuffer=function(n,t){this.SetUserOverridableBuffer(this.m_colorBuffer,n,t)},e.prototype.SetUserDataBuffer=function(n,t){this.SetUserOverridableBuffer(this.m_userDataBuffer,n,t)},e.prototype.GetContacts=function(){return this.m_contactBuffer.data},e.prototype.GetContactCount=function(){return this.m_contactBuffer.count},e.prototype.GetBodyContacts=function(){return this.m_bodyContactBuffer.data},e.prototype.GetBodyContactCount=function(){return this.m_bodyContactBuffer.count},e.prototype.GetPairs=function(){return this.m_pairBuffer.data},e.prototype.GetPairCount=function(){return this.m_pairBuffer.count},e.prototype.GetTriads=function(){return this.m_triadBuffer.data},e.prototype.GetTriadCount=function(){return this.m_triadBuffer.count},e.prototype.SetStuckThreshold=function(n){this.m_stuckThreshold=n;n>0&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))},e.prototype.GetStuckCandidates=function(){return this.m_stuckParticleBuffer.Data()},e.prototype.GetStuckCandidateCount=function(){return this.m_stuckParticleBuffer.GetCount()},e.prototype.ComputeCollisionEnergy=function(){if(!this.m_velocityBuffer.data)throw new Error;for(var o=e.ComputeCollisionEnergy_s_v,u=this.m_velocityBuffer.data,f=0,n=0;n<this.m_contactBuffer.count;n++){var i=this.m_contactBuffer.data[n],s=i.indexA,h=i.indexB,c=i.normal,l=t.SubVV(u[h],u[s],o),r=t.DotVV(l,c);r<0&&(f+=r*r)}return.5*this.GetParticleMass()*f},e.prototype.SetStrictContactCheck=function(n){this.m_def.strictContactCheck=n},e.prototype.GetStrictContactCheck=function(){return this.m_def.strictContactCheck},e.prototype.SetParticleLifetime=function(n,t){var e=null===this.m_indexByExpirationTimeBuffer.data,f,i,r,u;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),e)for(f=this.GetParticleCount(),i=0;i<f;++i)this.m_indexByExpirationTimeBuffer.data[i]=i;r=t/this.m_def.lifetimeGranularity;u=r>0?this.GetQuantizedTimeElapsed()+r:r;u!==this.m_expirationTimeBuffer.data[n]&&(this.m_expirationTimeBuffer.data[n]=u,this.m_expirationTimeBufferRequiresSorting=!0)},e.prototype.GetParticleLifetime=function(n){return this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[n])},e.prototype.SetDestructionByAge=function(n){n&&this.GetExpirationTimeBuffer();this.m_def.destroyByAge=n},e.prototype.GetDestructionByAge=function(){return this.m_def.destroyByAge},e.prototype.GetExpirationTimeBuffer=function(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data},e.prototype.ExpirationTimeToLifetime=function(n){return(n>0?n-this.GetQuantizedTimeElapsed():n)*this.m_def.lifetimeGranularity},e.prototype.GetIndexByExpirationTimeBuffer=function(){if(this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),!this.m_indexByExpirationTimeBuffer.data)throw new Error;return this.m_indexByExpirationTimeBuffer.data},e.prototype.ParticleApplyLinearImpulse=function(n,t){this.ApplyLinearImpulse(n,n+1,t)},e.prototype.ApplyLinearImpulse=function(n,i,r){if(!this.m_velocityBuffer.data)throw new Error;for(var f=this.m_velocityBuffer.data,e=(i-n)*this.GetParticleMass(),o=(new t).Copy(r).SelfMul(1/e),u=n;u<i;u++)f[u].SelfAdd(o)},e.IsSignificantForce=function(n){return 0!==n.x||0!==n.y},e.prototype.ParticleApplyForce=function(n,t){if(!this.m_flagsBuffer.data)throw new Error;e.IsSignificantForce(t)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[n])&&(this.PrepareForceBuffer(),this.m_forceBuffer[n].SelfAdd(t))},e.prototype.ApplyForce=function(n,i,r){var f=(new t).Copy(r).SelfMul(1/(i-n)),u;if(e.IsSignificantForce(f))for(this.PrepareForceBuffer(),u=n;u<i;u++)this.m_forceBuffer[u].SelfAdd(f)},e.prototype.GetNext=function(){return this.m_next},e.prototype.QueryAABB=function(n,t){var s,r,u,i;if(0!==this.m_proxyBuffer.count){var f=this.m_proxyBuffer.count,o=us(this.m_proxyBuffer.data,0,f,e.computeTag(this.m_inverseDiameter*t.lowerBound.x,this.m_inverseDiameter*t.lowerBound.y),e.Proxy.CompareProxyTag),h=fs(this.m_proxyBuffer.data,o,f,e.computeTag(this.m_inverseDiameter*t.upperBound.x,this.m_inverseDiameter*t.upperBound.y),e.Proxy.CompareTagProxy);if(!this.m_positionBuffer.data)throw new Error;for(s=this.m_positionBuffer.data,r=o;r<h;++r)if(u=this.m_proxyBuffer.data[r].index,i=s[u],t.lowerBound.x<i.x&&i.x<t.upperBound.x&&t.lowerBound.y<i.y&&i.y<t.upperBound.y&&!n.ReportParticle(this,u))break}},e.prototype.QueryShapeAABB=function(n,t,i,r){void 0===r&&(r=0);var u=e.QueryShapeAABB_s_aabb;t.ComputeAABB(u,i,r);this.QueryAABB(n,u)},e.prototype.QueryPointAABB=function(n,t,i){void 0===i&&(i=s);var r=e.QueryPointAABB_s_aabb;r.lowerBound.Set(t.x-i,t.y-i);r.upperBound.Set(t.x+i,t.y+i);this.QueryAABB(n,r)},e.prototype.RayCast=function(n,i,r){var d=e.RayCast_s_aabb,g=e.RayCast_s_p,nt=e.RayCast_s_v,tt=e.RayCast_s_n,it=e.RayCast_s_point,w,s,y,u,p,k;if(0!==this.m_proxyBuffer.count){if(!this.m_positionBuffer.data)throw new Error;w=this.m_positionBuffer.data;s=d;t.MinV(i,r,s.lowerBound);t.MaxV(i,r,s.upperBound);for(var a,h=1,f=t.SubVV(r,i,nt),v=t.DotVV(f,f),rt=this.GetInsideBoundsEnumerator(s);(a=rt.GetNext())>=0;){var c=t.SubVV(i,w[a],g),l=t.DotVV(c,f),b=l*l-v*(t.DotVV(c,c)-this.m_squaredDiameter);if(b>=0){if(y=at(b),u=(-l-y)/v,u>h)continue;if(u<0&&((u=(-l+y)/v)<0||u>h))continue;if(p=t.AddVMulSV(c,u,f,tt),p.Normalize(),k=n.ReportParticle(this,a,t.AddVMulSV(i,u,f,it),p,u),(h=o(h,k))<=0)break}}}},e.prototype.ComputeAABB=function(n){var f=this.GetParticleCount(),u,i,r;if(n.lowerBound.x=+c,n.lowerBound.y=+c,n.upperBound.x=-c,n.upperBound.y=-c,!this.m_positionBuffer.data)throw new Error;for(u=this.m_positionBuffer.data,i=0;i<f;i++)r=u[i],t.MinV(n.lowerBound,r,n.lowerBound),t.MaxV(n.upperBound,r,n.upperBound);n.lowerBound.x-=this.m_particleDiameter;n.lowerBound.y-=this.m_particleDiameter;n.upperBound.x+=this.m_particleDiameter;n.upperBound.y+=this.m_particleDiameter},e.prototype.FreeBuffer=function(n){null!==n&&(n.length=0)},e.prototype.FreeUserOverridableBuffer=function(n){0===n.userSuppliedCapacity&&this.FreeBuffer(n.data,this.m_internalAllocatedCapacity)},e.prototype.ReallocateBuffer3=function(n,t,i){if(i<=t)throw new Error;var r=n?n.slice():[];return r.length=i,r},e.prototype.ReallocateBuffer5=function(n,t,i,r,u){if(r<=i)throw new Error;if(t&&!(r<=t))throw new Error;return u&&!n||t||(n=this.ReallocateBuffer3(n,i,r)),n},e.prototype.ReallocateBuffer4=function(n,t,i,r){return this.ReallocateBuffer5(n.data,n.userSuppliedCapacity,t,i,r)},e.prototype.RequestBuffer=function(n){return n||(0===this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(256),(n=[]).length=this.m_internalAllocatedCapacity),n},e.prototype.ReallocateHandleBuffers=function(n){this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,n,!0)},e.prototype.ReallocateInternalAllocatedBuffers=function(n){function t(n,t){return t&&n>t?t:n}if(n=t(n,this.m_def.maxCount),n=t(n,this.m_flagsBuffer.userSuppliedCapacity),n=t(n,this.m_positionBuffer.userSuppliedCapacity),n=t(n,this.m_velocityBuffer.userSuppliedCapacity),n=t(n,this.m_colorBuffer.userSuppliedCapacity),n=t(n,this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<n){this.ReallocateHandleBuffers(n);this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,n,!1);var i=this.m_stuckThreshold>0;this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,n,i);this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,n,i);this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,n,i);this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,n,!1);this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,n,!1);this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,n,!1);this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,n,!1);this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,n,!0);this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,n,!1);this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,n,!0);this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,n,!0);this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,n,!0);this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,n,!1);this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,n,!0);this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,n,!0);this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,n,!1);this.m_internalAllocatedCapacity=n}},e.prototype.CreateParticleForGroup=function(n,i,f){var e=new er;e.flags=u(n.flags,0);r.MulXV(i,f,e.position);t.AddVV(u(n.linearVelocity,t.ZERO),t.CrossSV(u(n.angularVelocity,0),t.SubVV(e.position,u(n.position,t.ZERO),t.s_t0),t.s_t0),e.velocity);e.color.Copy(u(n.color,it.ZERO));e.lifetime=u(n.lifetime,0);e.userData=n.userData;this.CreateParticle(e)},e.prototype.CreateParticlesStrokeShapeForGroup=function(i,r,f){var y=e.CreateParticlesStrokeShapeForGroup_s_edge,p=e.CreateParticlesStrokeShapeForGroup_s_d,w=e.CreateParticlesStrokeShapeForGroup_s_p,c=u(r.stride,0),o,a,h,v;0===c&&(c=this.GetParticleStride());for(var s=0,b=i.GetChildCount(),l=0;l<b;l++){for(o=null,i.GetType()===n.b2ShapeType.e_edgeShape?o=i:(o=y,i.GetChildEdge(o,l)),a=t.SubVV(o.m_vertex2,o.m_vertex1,p),h=a.Length();s<h;)v=t.AddVMulSV(o.m_vertex1,s/h,a,w),this.CreateParticleForGroup(r,f,v),s+=c;s-=h}},e.prototype.CreateParticlesFillShapeForGroup=function(n,t,i){var a=e.CreateParticlesFillShapeForGroup_s_aabb,v=e.CreateParticlesFillShapeForGroup_s_p,f=u(t.stride,0),c,o,s,h,l;for(0===f&&(f=this.GetParticleStride()),c=r.IDENTITY,o=a,n.ComputeAABB(o,c,0),s=Math.floor(o.lowerBound.y/f)*f;s<o.upperBound.y;s+=f)for(h=Math.floor(o.lowerBound.x/f)*f;h<o.upperBound.x;h+=f)l=v.Set(h,s),n.TestPoint(c,l)&&this.CreateParticleForGroup(t,i,l)},e.prototype.CreateParticlesWithShapeForGroup=function(t,i,r){switch(t.GetType()){case n.b2ShapeType.e_edgeShape:case n.b2ShapeType.e_chainShape:this.CreateParticlesStrokeShapeForGroup(t,i,r);break;case n.b2ShapeType.e_polygonShape:case n.b2ShapeType.e_circleShape:this.CreateParticlesFillShapeForGroup(t,i,r)}},e.prototype.CreateParticlesWithShapesForGroup=function(n,t,i,r){var u=new e.CompositeShape(n,t);this.CreateParticlesFillShapeForGroup(u,i,r)},e.prototype.CloneParticle=function(n,t){var r=new er,i,u;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;return r.flags=this.m_flagsBuffer.data[n],r.position.Copy(this.m_positionBuffer.data[n]),r.velocity.Copy(this.m_velocityBuffer.data[n]),this.m_colorBuffer.data&&r.color.Copy(this.m_colorBuffer.data[n]),this.m_userDataBuffer.data&&(r.userData=this.m_userDataBuffer.data[n]),r.group=t,i=this.CreateParticle(r),this.m_handleIndexBuffer.data&&(u=this.m_handleIndexBuffer.data[n],u&&u.SetIndex(i),this.m_handleIndexBuffer.data[i]=u,this.m_handleIndexBuffer.data[n]=null),this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[i]=this.m_lastBodyContactStepBuffer.data[n]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[i]=this.m_bodyContactCountBuffer.data[n]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[i]=this.m_consecutiveContactStepsBuffer.data[n]),this.m_hasForce&&this.m_forceBuffer[i].Copy(this.m_forceBuffer[n]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[i]=this.m_staticPressureBuffer[n]),this.m_depthBuffer&&(this.m_depthBuffer[i]=this.m_depthBuffer[n]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[i]=this.m_expirationTimeBuffer.data[n]),i},e.prototype.DestroyParticlesInGroup=function(n,t){void 0===t&&(t=!1);for(var i=n.m_firstIndex;i<n.m_lastIndex;i++)this.DestroyParticle(i,t)},e.prototype.DestroyParticleGroup=function(n){this.m_world.m_destructionListener&&this.m_world.m_destructionListener.SayGoodbyeParticleGroup(n);this.SetGroupFlags(n,0);for(var t=n.m_firstIndex;t<n.m_lastIndex;t++)this.m_groupBuffer[t]=null;n.m_prev&&(n.m_prev.m_next=n.m_next);n.m_next&&(n.m_next.m_prev=n.m_prev);n===this.m_groupList&&(this.m_groupList=n.m_next);--this.m_groupCount},e.ParticleCanBeConnected=function(t,i){return 0!=(t&(n.b2ParticleFlag.b2_wallParticle|n.b2ParticleFlag.b2_springParticle|n.b2ParticleFlag.b2_elasticParticle))||null!==i&&0!=(i.GetGroupFlags()&n.b2ParticleGroupFlag.b2_rigidParticleGroup)},e.prototype.UpdatePairsAndTriads=function(i,r,u){var rt=e.UpdatePairsAndTriads_s_dab,ut=e.UpdatePairsAndTriads_s_dbc,ft=e.UpdatePairsAndTriads_s_dca,v,a,y,nt,it,tt,s;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var l=this.m_positionBuffer.data,p=0,f=i;f<r;f++)p|=this.m_flagsBuffer.data[f];if(p&e.k_pairFlags)for(v=0;v<this.m_contactBuffer.count;v++){var w=this.m_contactBuffer.data[v],h=w.indexA,c=w.indexB,b=this.m_flagsBuffer.data[h],k=this.m_flagsBuffer.data[c],d=this.m_groupBuffer[h],g=this.m_groupBuffer[c];h>=i&&h<r&&c>=i&&c<r&&!((b|k)&n.b2ParticleFlag.b2_zombieParticle)&&(b|k)&e.k_pairFlags&&(u.IsNecessary(h)||u.IsNecessary(c))&&e.ParticleCanBeConnected(b,d)&&e.ParticleCanBeConnected(k,g)&&u.ShouldCreatePair(h,c)&&(a=this.m_pairBuffer.data[this.m_pairBuffer.Append()],a.indexA=h,a.indexB=c,a.flags=w.flags,a.strength=o(d?d.m_strength:1,g?g.m_strength:1),a.distance=t.DistanceVV(l[h],l[c]));is(this.m_pairBuffer.data,0,this.m_pairBuffer.count,e.ComparePairIndices);this.m_pairBuffer.Unique(e.MatchPairIndices)}if(p&e.k_triadFlags){for(y=new ef(r-i),f=i;f<r;f++)nt=this.m_flagsBuffer.data[f],it=this.m_groupBuffer[f],nt&n.b2ParticleFlag.b2_zombieParticle||!e.ParticleCanBeConnected(nt,it)||y.AddGenerator(l[f],f,u.IsNecessary(f));tt=this.GetParticleStride();y.Generate(tt/2,2*tt);s=this;y.GetNodes(function(n,i,r){var w,b;if(!s.m_flagsBuffer.data)throw new Error;var d=s.m_flagsBuffer.data[n],g=s.m_flagsBuffer.data[i],nt=s.m_flagsBuffer.data[r];if((d|g|nt)&e.k_triadFlags&&u.ShouldCreateTriad(n,i,r)){var h=l[n],c=l[i],a=l[r],v=t.SubVV(h,c,rt),y=t.SubVV(c,a,ut),p=t.SubVV(a,h,ft),k=4*s.m_squaredDiameter;if(t.DotVV(v,v)>k||t.DotVV(y,y)>k||t.DotVV(p,p)>k)return;var tt=s.m_groupBuffer[n],it=s.m_groupBuffer[i],et=s.m_groupBuffer[r],f=s.m_triadBuffer.data[s.m_triadBuffer.Append()];f.indexA=n;f.indexB=i;f.indexC=r;f.flags=d|g|nt;f.strength=o(o(tt?tt.m_strength:1,it?it.m_strength:1),et?et.m_strength:1);w=(h.x+c.x+a.x)/3;b=(h.y+c.y+a.y)/3;f.pa.x=h.x-w;f.pa.y=h.y-b;f.pb.x=c.x-w;f.pb.y=c.y-b;f.pc.x=a.x-w;f.pc.y=a.y-b;f.ka=-t.DotVV(p,v);f.kb=-t.DotVV(v,y);f.kc=-t.DotVV(y,p);f.s=t.CrossVV(h,c)+t.CrossVV(c,a)+t.CrossVV(a,h)}});is(this.m_triadBuffer.data,0,this.m_triadBuffer.count,e.CompareTriadIndices);this.m_triadBuffer.Unique(e.MatchTriadIndices)}},e.prototype.UpdatePairsAndTriadsWithReactiveParticles=function(){var i=new e.ReactiveFilter(this.m_flagsBuffer),t;if(this.UpdatePairsAndTriads(0,this.m_count,i),!this.m_flagsBuffer.data)throw new Error;for(t=0;t<this.m_count;t++)this.m_flagsBuffer.data[t]&=~n.b2ParticleFlag.b2_reactiveParticle;this.m_allParticleFlags&=~n.b2ParticleFlag.b2_reactiveParticle},e.ComparePairIndices=function(n,t){var i=n.indexA-t.indexA;return 0!==i?i<0:n.indexB<t.indexB},e.MatchPairIndices=function(n,t){return n.indexA===t.indexA&&n.indexB===t.indexB},e.CompareTriadIndices=function(n,t){var r=n.indexA-t.indexA,i;return 0!==r?r<0:(i=n.indexB-t.indexB,0!==i?i<0:n.indexC<t.indexC)},e.MatchTriadIndices=function(n,t){return n.indexA===t.indexA&&n.indexB===t.indexB&&n.indexC===t.indexC},e.InitializeParticleLists=function(n,t){for(var i,u=n.GetBufferIndex(),f=n.GetParticleCount(),r=0;r<f;r++)i=t[r],i.list=i,i.next=null,i.count=1,i.index=r+u},e.prototype.MergeParticleListsInContact=function(n,t){for(var i,r,c,f=n.GetBufferIndex(),u=0;u<this.m_contactBuffer.count;u++){var o=this.m_contactBuffer.data[u],s=o.indexA,h=o.indexB;n.ContainsParticle(s)&&n.ContainsParticle(h)&&(i=t[s-f].list,r=t[h-f].list,i!==r&&(i.count<r.count&&(c=i,i=r,r=c),e.MergeParticleLists(i,r)))}},e.MergeParticleLists=function(n,t){for(var r,i=t;;){if(i.list=n,r=i.next,!r){i.next=n.next;break}i=r}n.next=t;n.count+=t.count;t.count=0},e.FindLongestParticleList=function(n,t){for(var u,f=n.GetParticleCount(),i=t[0],r=0;r<f;r++)u=t[r],i.count<u.count&&(i=u);return i},e.prototype.MergeZombieParticleListNodes=function(t,i,r){var o,u,f;if(!this.m_flagsBuffer.data)throw new Error;for(o=t.GetParticleCount(),u=0;u<o;u++)f=i[u],f!==r&&this.m_flagsBuffer.data[f.index]&n.b2ParticleFlag.b2_zombieParticle&&e.MergeParticleListAndNode(r,f)},e.MergeParticleListAndNode=function(n,t){t.list=n;t.next=n.next;n.next=t;n.count++;t.count=0},e.prototype.CreateParticleGroupsFromParticleList=function(t,i,r){var h,f,e,o,c,u,s,l;if(!this.m_flagsBuffer.data)throw new Error;for(h=t.GetParticleCount(),f=new ns,f.groupFlags=t.GetGroupFlags(),f.userData=t.GetUserData(),e=0;e<h;e++)if(o=i[e],o.count&&o!==r)for(c=this.CreateParticleGroup(f),u=o;u;u=u.next)s=u.index,l=this.CloneParticle(s,c),this.m_flagsBuffer.data[s]|=n.b2ParticleFlag.b2_zombieParticle,u.index=l},e.prototype.UpdatePairsAndTriadsWithParticleList=function(n,t){for(var r,s,u=n.GetBufferIndex(),i=0;i<this.m_pairBuffer.count;i++){var o=this.m_pairBuffer.data[i],f=o.indexA,e=o.indexB;n.ContainsParticle(f)&&(o.indexA=t[f-u].index);n.ContainsParticle(e)&&(o.indexB=t[e-u].index)}for(i=0;i<this.m_triadBuffer.count;i++)r=this.m_triadBuffer.data[i],s=(f=r.indexA,e=r.indexB,r.indexC),n.ContainsParticle(f)&&(r.indexA=t[f-u].index),n.ContainsParticle(e)&&(r.indexB=t[e-u].index),n.ContainsParticle(s)&&(r.indexC=t[s-u].index)},e.prototype.ComputeDepth=function(){for(var i,s,h,k,b,l,o,a=[],v=0,r=0;r<this.m_contactBuffer.count;r++){var f=(u=this.m_contactBuffer.data[r]).indexA,e=u.indexB,y=this.m_groupBuffer[f],rt=this.m_groupBuffer[e];y&&y===rt&&y.m_groupFlags&n.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&(a[v++]=u)}for(var p=[],w=0,t=this.m_groupList;t;t=t.GetNext())if(t.m_groupFlags&n.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth)for(p[w++]=t,this.SetGroupFlags(t,t.m_groupFlags&~n.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth),i=t.m_firstIndex;i<t.m_lastIndex;i++)this.m_accumulationBuffer[i]=0;for(r=0;r<v;r++)f=(u=a[r]).indexA,e=u.indexB,s=u.weight,this.m_accumulationBuffer[f]+=s,this.m_accumulationBuffer[e]+=s;for(i=0;i<w;i++)for(h=(t=p[i]).m_firstIndex;h<t.m_lastIndex;h++)s=this.m_accumulationBuffer[h],this.m_depthBuffer[h]=s<.8?0:c;for(k=at(this.m_count)>>0,b=0;b<k;b++){for(l=!1,r=0;r<v;r++){f=(u=a[r]).indexA;e=u.indexB;var u,d=1-u.weight,g=this.m_depthBuffer[f],nt=this.m_depthBuffer[e],tt=nt+d,it=g+d;g>tt&&(this.m_depthBuffer[f]=tt,l=!0);nt>it&&(this.m_depthBuffer[e]=it,l=!0)}if(!l)break}for(i=0;i<w;i++)for(o=(t=p[i]).m_firstIndex;o<t.m_lastIndex;o++)this.m_depthBuffer[o]<c?this.m_depthBuffer[o]*=this.m_particleDiameter:this.m_depthBuffer[o]=0},e.prototype.GetInsideBoundsEnumerator=function(n){var t=e.computeTag(this.m_inverseDiameter*n.lowerBound.x-1,this.m_inverseDiameter*n.lowerBound.y-1),i=e.computeTag(this.m_inverseDiameter*n.upperBound.x+1,this.m_inverseDiameter*n.upperBound.y+1),r=this.m_proxyBuffer.count,u=us(this.m_proxyBuffer.data,0,r,t,e.Proxy.CompareProxyTag),f=fs(this.m_proxyBuffer.data,0,r,i,e.Proxy.CompareTagProxy);return new e.InsideBoundsEnumerator(this,t,i,u,f)},e.prototype.UpdateAllParticleFlags=function(){if(!this.m_flagsBuffer.data)throw new Error;this.m_allParticleFlags=0;for(var n=0;n<this.m_count;n++)this.m_allParticleFlags|=this.m_flagsBuffer.data[n];this.m_needsUpdateAllParticleFlags=!1},e.prototype.UpdateAllGroupFlags=function(){this.m_allGroupFlags=0;for(var n=this.m_groupList;n;n=n.GetNext())this.m_allGroupFlags|=n.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1},e.prototype.AddContact=function(n,i){var u,r;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;var h=e.AddContact_s_d,s=this.m_positionBuffer.data,f=t.SubVV(s[i],s[n],h),o=t.DotVV(f,f);o<this.m_squaredDiameter&&(u=lr(o),isFinite(u)||(u=198177537e11),r=this.m_contactBuffer.data[this.m_contactBuffer.Append()],r.indexA=n,r.indexB=i,r.flags=this.m_flagsBuffer.data[n]|this.m_flagsBuffer.data[i],r.weight=1-o*u*this.m_inverseDiameter,t.MulSV(u,f,r.normal))},e.prototype.FindContacts_Reference=function(){var r=this.m_proxyBuffer.count,t,i,u,n,f,o;for(this.m_contactBuffer.count=0,t=0,i=0;t<r;t++){for(u=e.computeRelativeTag(this.m_proxyBuffer.data[t].tag,1,0),n=t+1;n<r&&!(u<this.m_proxyBuffer.data[n].tag);n++)this.AddContact(this.m_proxyBuffer.data[t].index,this.m_proxyBuffer.data[n].index,this.m_contactBuffer);for(f=e.computeRelativeTag(this.m_proxyBuffer.data[t].tag,-1,1);i<r&&!(f<=this.m_proxyBuffer.data[i].tag);i++);for(o=e.computeRelativeTag(this.m_proxyBuffer.data[t].tag,1,1),n=i;n<r&&!(o<this.m_proxyBuffer.data[n].tag);n++)this.AddContact(this.m_proxyBuffer.data[t].index,this.m_proxyBuffer.data[n].index,this.m_contactBuffer)}},e.prototype.FindContacts=function(n){this.FindContacts_Reference(n)},e.prototype.UpdateProxies_Reference=function(){var t,i;if(!this.m_positionBuffer.data)throw new Error;for(var u=this.m_positionBuffer.data,r=this.m_inverseDiameter,n=0;n<this.m_proxyBuffer.count;++n)t=this.m_proxyBuffer.data[n],i=u[t.index],t.tag=e.computeTag(r*i.x,r*i.y)},e.prototype.UpdateProxies=function(n){this.UpdateProxies_Reference(n)},e.prototype.SortProxies=function(){hr(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,e.Proxy.CompareProxyProxy)},e.prototype.FilterContacts=function(){var t=this.GetParticleContactFilter(),i;null!==t&&(i=this,this.m_contactBuffer.RemoveIf(function(r){return 0!=(r.flags&n.b2ParticleFlag.b2_particleContactFilterParticle)&&!t.ShouldCollideParticleParticle(i,r.indexA,r.indexB)}))},e.prototype.NotifyContactListenerPreContact=function(n){if(null!==this.GetParticleContactListener())throw n.Initialize(this.m_contactBuffer,this.m_flagsBuffer),new Error;},e.prototype.NotifyContactListenerPostContact=function(){var t=this.GetParticleContactListener(),n,i;if(null!==t){for(n=0;n<this.m_contactBuffer.count;++n)i=this.m_contactBuffer.data[n],t.BeginContactParticleParticle(this,i);throw new Error;}},e.b2ParticleContactIsZombie=function(t){return(t.flags&n.b2ParticleFlag.b2_zombieParticle)===n.b2ParticleFlag.b2_zombieParticle},e.prototype.UpdateContacts=function(n){this.UpdateProxies(this.m_proxyBuffer);this.SortProxies(this.m_proxyBuffer);var t=new e.b2ParticlePairSet;this.NotifyContactListenerPreContact(t);this.FindContacts(this.m_contactBuffer);this.FilterContacts(this.m_contactBuffer);this.NotifyContactListenerPostContact(t);n&&this.m_contactBuffer.RemoveIf(e.b2ParticleContactIsZombie)},e.prototype.NotifyBodyContactListenerPreContact=function(n){if(null!==this.GetFixtureContactListener())throw n.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),new Error;},e.prototype.NotifyBodyContactListenerPostContact=function(){var t=this.GetFixtureContactListener(),n,i;if(null!==t){for(n=0;n<this.m_bodyContactBuffer.count;n++)i=this.m_bodyContactBuffer.data[n],t.BeginContactFixtureParticle(this,i);throw new Error;}},e.prototype.UpdateBodyContacts=function(){var f=e.UpdateBodyContacts_s_aabb,i=new e.FixtureParticleSet,r,n,t,u;if(this.NotifyBodyContactListenerPreContact(i),this.m_stuckThreshold>0){if(!this.m_bodyContactCountBuffer.data)throw new Error;if(!this.m_lastBodyContactStepBuffer.data)throw new Error;if(!this.m_consecutiveContactStepsBuffer.data)throw new Error;for(r=this.GetParticleCount(),n=0;n<r;n++)this.m_bodyContactCountBuffer.data[n]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[n]+1&&(this.m_consecutiveContactStepsBuffer.data[n]=0)}this.m_bodyContactBuffer.SetCount(0);this.m_stuckParticleBuffer.SetCount(0);t=f;this.ComputeAABB(t);u=new e.UpdateBodyContactsCallback(this,this.GetFixtureContactFilter());this.m_world.QueryAABB(u,t);this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts();this.NotifyBodyContactListenerPostContact(i)},e.prototype.Solve=function(t){var u=e.Solve_s_subStep,i,r;if(0!==this.m_count&&(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(t),this.m_allParticleFlags&n.b2ParticleFlag.b2_zombieParticle&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),!this.m_paused))for(this.m_iterationIndex=0;this.m_iterationIndex<t.particleIterations;this.m_iterationIndex++){if(++this.m_timestamp,i=u.Copy(t),i.dt/=t.particleIterations,i.inv_dt*=t.particleIterations,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),this.m_allGroupFlags&n.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&this.ComputeDepth(),this.m_allParticleFlags&n.b2ParticleFlag.b2_reactiveParticle&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(i),this.m_allParticleFlags&n.b2ParticleFlag.b2_viscousParticle&&this.SolveViscous(),this.m_allParticleFlags&n.b2ParticleFlag.b2_repulsiveParticle&&this.SolveRepulsive(i),this.m_allParticleFlags&n.b2ParticleFlag.b2_powderParticle&&this.SolvePowder(i),this.m_allParticleFlags&n.b2ParticleFlag.b2_tensileParticle&&this.SolveTensile(i),this.m_allGroupFlags&n.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SolveSolid(i),this.m_allParticleFlags&n.b2ParticleFlag.b2_colorMixingParticle&&this.SolveColorMixing(),this.SolveGravity(i),this.m_allParticleFlags&n.b2ParticleFlag.b2_staticPressureParticle&&this.SolveStaticPressure(i),this.SolvePressure(i),this.SolveDamping(i),this.m_allParticleFlags&e.k_extraDampingFlags&&this.SolveExtraDamping(),this.m_allParticleFlags&n.b2ParticleFlag.b2_elasticParticle&&this.SolveElastic(i),this.m_allParticleFlags&n.b2ParticleFlag.b2_springParticle&&this.SolveSpring(i),this.LimitVelocity(i),this.m_allGroupFlags&n.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigidDamping(),this.m_allParticleFlags&n.b2ParticleFlag.b2_barrierParticle&&this.SolveBarrier(i),this.SolveCollision(i),this.m_allGroupFlags&n.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigid(i),this.m_allParticleFlags&n.b2ParticleFlag.b2_wallParticle&&this.SolveWall(),!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(r=0;r<this.m_count;r++)this.m_positionBuffer.data[r].SelfMulAdd(i.dt,this.m_velocityBuffer.data[r])}},e.prototype.SolveCollision=function(n){var a=e.SolveCollision_s_aabb,r,l;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;var v=this.m_positionBuffer.data,y=this.m_velocityBuffer.data,t=a;for(t.lowerBound.x=+c,t.lowerBound.y=+c,t.upperBound.x=-c,t.upperBound.y=-c,r=0;r<this.m_count;r++){var u=y[r],i=v[r],s=i.x+n.dt*u.x,h=i.y+n.dt*u.y;t.lowerBound.x=o(t.lowerBound.x,o(i.x,s));t.lowerBound.y=o(t.lowerBound.y,o(i.y,h));t.upperBound.x=f(t.upperBound.x,f(i.x,s));t.upperBound.y=f(t.upperBound.y,f(i.y,h))}l=new e.SolveCollisionCallback(this,n);this.m_world.QueryAABB(l,t)},e.prototype.LimitVelocity=function(n){var i,u;if(!this.m_velocityBuffer.data)throw new Error;for(var e=this.m_velocityBuffer.data,f=this.GetCriticalVelocitySquared(n),r=0;r<this.m_count;r++)i=e[r],u=t.DotVV(i,i),u>f&&i.SelfMul(at(f/u))},e.prototype.SolveGravity=function(n){if(!this.m_velocityBuffer.data)throw new Error;for(var r=e.SolveGravity_s_gravity,u=this.m_velocityBuffer.data,f=t.MulSV(n.dt*this.m_def.gravityScale,this.m_world.GetGravity(),r),i=0;i<this.m_count;i++)u[i].SelfAdd(f)},e.prototype.SolveBarrier=function(i){var ti=e.SolveBarrier_s_aabb,ii=e.SolveBarrier_s_va,ri=e.SolveBarrier_s_vb,ui=e.SolveBarrier_s_pba,fi=e.SolveBarrier_s_vba,ei=e.SolveBarrier_s_vc,oi=e.SolveBarrier_s_pca,si=e.SolveBarrier_s_vca,hi=e.SolveBarrier_s_qba,ci=e.SolveBarrier_s_qca,li=e.SolveBarrier_s_dv,ai=e.SolveBarrier_s_f,k,nt,f,vt,ni,w,ut,yt,pt;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var ft=this.m_positionBuffer.data,wt=this.m_velocityBuffer.data,b=0;b<this.m_count;b++)0!=(this.m_flagsBuffer.data[b]&e.k_barrierWallFlags)&&wt[b].SetZero();for(var et=2.5*i.dt,vi=this.GetParticleMass(),ot=0;ot<this.m_pairBuffer.count;ot++)if(k=this.m_pairBuffer.data[ot],k.flags&n.b2ParticleFlag.b2_barrierParticle){var st=k.indexA,ht=k.indexB,a=ft[st],d=ft[ht],ct=ti;t.MinV(a,d,ct.lowerBound);t.MaxV(a,d,ct.upperBound);for(var bt=this.m_groupBuffer[st],kt=this.m_groupBuffer[ht],g=this.GetLinearVelocity(bt,st,a,ii),yi=this.GetLinearVelocity(kt,ht,d,ri),v=t.SubVV(d,a,ui),s=t.SubVV(yi,g,fi),pi=this.GetInsideBoundsEnumerator(ct),h=void 0;(h=pi.GetNext())>=0;)if(nt=ft[h],f=this.m_groupBuffer[h],bt!==f&&kt!==f){var lt=this.GetLinearVelocity(f,h,nt,ei),y=t.SubVV(nt,a,oi),p=t.SubVV(lt,g,si),tt=t.CrossVV(s,p),c=t.CrossVV(v,p)-t.CrossVV(y,s),dt=t.CrossVV(v,y),o=void 0,r=void 0,u=hi,l=ci;if(0===tt){if(0===c)continue;if(!((r=-dt/c)>=0&&r<et))continue;if(t.AddVMulSV(v,r,s,u),t.AddVMulSV(y,r,p,l),!((o=t.DotVV(u,l)/t.DotVV(u,u))>=0&&o<=1))continue}else{if(vt=c*c-4*dt*tt,vt<0)continue;var gt=at(vt),it=(-c-gt)/(2*tt),rt=(-c+gt)/(2*tt);if(it>rt&&(ni=it,it=rt,rt=ni),r=it,t.AddVMulSV(v,r,s,u),t.AddVMulSV(y,r,p,l),o=t.DotVV(u,l)/t.DotVV(u,u),!(r>=0&&r<et&&o>=0&&o<=1)){if(!((r=rt)>=0&&r<et))continue;if(t.AddVMulSV(v,r,s,u),t.AddVMulSV(y,r,p,l),!((o=t.DotVV(u,l)/t.DotVV(u,u))>=0&&o<=1))continue}}w=li;w.x=g.x+o*s.x-lt.x;w.y=g.y+o*s.y-lt.y;ut=t.MulSV(vi,w,ai);f&&this.IsRigidGroup(f)?(yt=f.GetMass(),pt=f.GetInertia(),yt>0&&f.m_linearVelocity.SelfMulAdd(1/yt,ut),pt>0&&(f.m_angularVelocity+=t.CrossVV(t.SubVV(nt,f.GetCenter(),t.s_t0),ut)/pt)):wt[h].SelfAdd(w);this.ParticleApplyForce(h,ut.SelfMul(-i.inv_dt))}}},e.prototype.SolveStaticPressure=function(t){var i,f,r,c;if(!this.m_flagsBuffer.data)throw new Error;this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);for(var e=this.GetCriticalPressure(t),l=this.m_def.staticPressureStrength*e,a=.25*e,v=this.m_def.staticPressureRelaxation,o=0;o<this.m_def.staticPressureIterations;o++){for(i=0;i<this.m_count;i++)this.m_accumulationBuffer[i]=0;for(f=0;f<this.m_contactBuffer.count;f++)if(r=this.m_contactBuffer.data[f],r.flags&n.b2ParticleFlag.b2_staticPressureParticle){var s=r.indexA,h=r.indexB,u=r.weight;this.m_accumulationBuffer[s]+=u*this.m_staticPressureBuffer[h];this.m_accumulationBuffer[h]+=u*this.m_staticPressureBuffer[s]}for(i=0;i<this.m_count;i++)(u=this.m_weightBuffer[i],this.m_flagsBuffer.data[i]&n.b2ParticleFlag.b2_staticPressureParticle)?(c=(this.m_accumulationBuffer[i]+l*(u-1))/(u+v),this.m_staticPressureBuffer[i]=y(c,0,a)):this.m_staticPressureBuffer[i]=0}},e.prototype.ComputeWeight=function(){for(var r,t,i,u,n=0;n<this.m_count;n++)this.m_weightBuffer[n]=0;for(n=0;n<this.m_bodyContactBuffer.count;n++)r=(i=this.m_bodyContactBuffer.data[n]).index,t=i.weight,this.m_weightBuffer[r]+=t;for(n=0;n<this.m_contactBuffer.count;n++)r=(i=this.m_contactBuffer.data[n]).indexA,u=i.indexB,t=i.weight,this.m_weightBuffer[r]+=t,this.m_weightBuffer[u]+=t},e.prototype.SolvePressure=function(i){var w=e.SolvePressure_s_f,s,c,u;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var g=this.m_positionBuffer.data,y=this.m_velocityBuffer.data,b=this.GetCriticalPressure(i),k=this.m_def.pressureStrength*b,nt=.25*b,r=0;r<this.m_count;r++)s=this.m_weightBuffer[r],c=k*f(0,s-1),this.m_accumulationBuffer[r]=o(c,nt);if(this.m_allParticleFlags&e.k_noPressureFlags)for(r=0;r<this.m_count;r++)this.m_flagsBuffer.data[r]&e.k_noPressureFlags&&(this.m_accumulationBuffer[r]=0);if(this.m_allParticleFlags&n.b2ParticleFlag.b2_staticPressureParticle)for(r=0;r<this.m_count;r++)this.m_flagsBuffer.data[r]&n.b2ParticleFlag.b2_staticPressureParticle&&(this.m_accumulationBuffer[r]+=this.m_staticPressureBuffer[r]);for(var d=i.dt/(this.m_def.density*this.m_particleDiameter),tt=this.GetParticleInvMass(),h=0;h<this.m_bodyContactBuffer.count;h++){var l=(u=this.m_bodyContactBuffer.data[h]).index,v=u.body,it=(s=u.weight,u.mass),p=u.normal,rt=g[l],a=(c=this.m_accumulationBuffer[l]+k*s,t.MulSV(d*s*it*c,p,w));y[l].SelfMulSub(tt,a);v.ApplyLinearImpulse(a,rt,!0)}for(h=0;h<this.m_contactBuffer.count;h++)l=(u=this.m_contactBuffer.data[h]).indexA,v=u.indexB,s=u.weight,p=u.normal,c=this.m_accumulationBuffer[l]+this.m_accumulationBuffer[v],a=t.MulSV(d*s*c,p,w),y[l].SelfSub(a),y[v].SelfAdd(a)},e.prototype.SolveDamping=function(n){var w=e.SolveDamping_s_v,b=e.SolveDamping_s_f,v,h,i,c;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var nt=this.m_positionBuffer.data,u=this.m_velocityBuffer.data,k=this.m_def.dampingStrength,d=1/this.GetCriticalVelocity(n),tt=this.GetParticleInvMass(),r=0;r<this.m_bodyContactBuffer.count;r++){var s=(i=this.m_bodyContactBuffer.data[r]).index,l=i.body,y=i.weight,it=i.mass,a=i.normal,g=nt[s],p=t.SubVV(l.GetLinearVelocityFromWorldPoint(g,t.s_t0),u[s],w);(c=t.DotVV(p,a))<0&&(v=f(k*y,o(-d*c,.5)),h=t.MulSV(v*it*c,a,b),u[s].SelfMulAdd(tt,h),l.ApplyLinearImpulse(h.SelfNeg(),g,!0))}for(r=0;r<this.m_contactBuffer.count;r++)s=(i=this.m_contactBuffer.data[r]).indexA,l=i.indexB,y=i.weight,a=i.normal,p=t.SubVV(u[l],u[s],w),(c=t.DotVV(p,a))<0&&(v=f(k*y,o(-d*c,.5)),h=t.MulSV(v*c,a,b),u[s].SelfAdd(h),u[l].SelfSub(h))},e.prototype.SolveRigidDamping=function(){var rt=e.SolveRigidDamping_s_t0,ut=e.SolveRigidDamping_s_t1,ot=e.SolveRigidDamping_s_p,ft=e.SolveRigidDamping_s_v,c=[0],l=[0],a=[0],y=[0],p=[0],w=[0],i,v;if(!this.m_positionBuffer.data)throw new Error;for(var d=this.m_positionBuffer.data,et=this.m_def.dampingStrength,h=0;h<this.m_bodyContactBuffer.count;h++)if(i=(s=this.m_bodyContactBuffer.data[h]).index,(f=this.m_groupBuffer[i])&&this.IsRigidGroup(f)){var n=s.body,r=s.normal,g=s.weight,u=d[i],nt=t.SubVV(n.GetLinearVelocityFromWorldPoint(u,rt),f.GetLinearVelocityFromWorldPoint(u,ut),ft);(k=t.DotVV(nt,r))<0&&(this.InitDampingParameterWithRigidGroupOrParticle(c,l,a,!0,f,i,u,r),this.InitDampingParameter(y,p,w,n.GetMass(),n.GetInertia()-n.GetMass()*n.GetLocalCenter().LengthSquared(),n.GetWorldCenter(),u,r),v=et*o(g,1)*this.ComputeDampingImpulse(c[0],l[0],a[0],y[0],p[0],w[0],k),this.ApplyDamping(c[0],l[0],a[0],!0,f,i,v,r),n.ApplyLinearImpulse(t.MulSV(-v,r,t.s_t0),u,!0))}for(h=0;h<this.m_contactBuffer.count;h++){i=(s=this.m_contactBuffer.data[h]).indexA;n=s.indexB;r=s.normal;g=s.weight;var s,k,f=this.m_groupBuffer[i],b=this.m_groupBuffer[n],tt=this.IsRigidGroup(f),it=this.IsRigidGroup(b);f!==b&&(tt||it)&&(u=t.MidVV(d[i],d[n],ot),nt=t.SubVV(this.GetLinearVelocity(b,n,u,rt),this.GetLinearVelocity(f,i,u,ut),ft),(k=t.DotVV(nt,r))<0&&(this.InitDampingParameterWithRigidGroupOrParticle(c,l,a,tt,f,i,u,r),this.InitDampingParameterWithRigidGroupOrParticle(y,p,w,it,b,n,u,r),v=et*g*this.ComputeDampingImpulse(c[0],l[0],a[0],y[0],p[0],w[0],k),this.ApplyDamping(c[0],l[0],a[0],tt,f,i,v,r),this.ApplyDamping(y[0],p[0],w[0],it,b,n,-v,r)))}},e.prototype.SolveExtraDamping=function(){var l=e.SolveExtraDamping_s_v,a=e.SolveExtraDamping_s_f,n,i,u;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var f=this.m_velocityBuffer.data,v=this.m_positionBuffer.data,y=this.GetParticleInvMass(),r=0;r<this.m_bodyContactBuffer.count;r++)if(n=this.m_bodyContactBuffer.data[r],i=n.index,this.m_flagsBuffer.data[i]&e.k_extraDampingFlags){var o=n.body,p=n.mass,s=n.normal,h=v[i],w=t.SubVV(o.GetLinearVelocityFromWorldPoint(h,t.s_t0),f[i],l),c=t.DotVV(w,s);c<0&&(u=t.MulSV(.5*p*c,s,a),f[i].SelfMulAdd(y,u),o.ApplyLinearImpulse(u.SelfNeg(),h,!0))}},e.prototype.SolveWall=function(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var i=this.m_velocityBuffer.data,t=0;t<this.m_count;t++)this.m_flagsBuffer.data[t]&n.b2ParticleFlag.b2_wallParticle&&i[t].SetZero()},e.prototype.SolveRigid=function(u){var a=e.SolveRigid_s_position,v=e.SolveRigid_s_rotation,y=e.SolveRigid_s_transform,p=e.SolveRigid_s_velocityTransform,c,l,o,s,h;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var w=this.m_positionBuffer.data,b=this.m_velocityBuffer.data,f=this.m_groupList;f;f=f.GetNext())if(f.m_groupFlags&n.b2ParticleGroupFlag.b2_rigidParticleGroup)for(f.UpdateStatistics(),c=v,c.SetAngle(u.dt*f.m_angularVelocity),l=t.AddVV(f.m_center,t.SubVV(t.MulSV(u.dt,f.m_linearVelocity,t.s_t0),i.MulRV(c,f.m_center,t.s_t1),t.s_t0),a),o=y,o.SetPositionRotation(l,c),r.MulXX(o,f.m_transform,f.m_transform),s=p,s.p.x=u.inv_dt*o.p.x,s.p.y=u.inv_dt*o.p.y,s.q.s=u.inv_dt*o.q.s,s.q.c=u.inv_dt*(o.q.c-1),h=f.m_firstIndex;h<f.m_lastIndex;h++)r.MulXV(s,w[h],b[h])},e.prototype.SolveElastic=function(r){var et=e.SolveElastic_s_pa,ot=e.SolveElastic_s_pb,st=e.SolveElastic_s_pc,ht=e.SolveElastic_s_r,u=e.SolveElastic_s_t0,o,a,v,f,l,y;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var p=this.m_positionBuffer.data,w=this.m_velocityBuffer.data,ct=r.inv_dt*this.m_def.elasticStrength,b=0;b<this.m_triadBuffer.count;b++)if(o=this.m_triadBuffer.data[b],o.flags&n.b2ParticleFlag.b2_elasticParticle){var nt=o.indexA,tt=o.indexB,it=o.indexC,k=o.pa,d=o.pb,g=o.pc,s=et.Copy(p[nt]),h=ot.Copy(p[tt]),c=st.Copy(p[it]),rt=w[nt],ut=w[tt],ft=w[it];s.SelfMulAdd(r.dt,rt);h.SelfMulAdd(r.dt,ut);c.SelfMulAdd(r.dt,ft);a=(s.x+h.x+c.x)/3;v=(s.y+h.y+c.y)/3;s.x-=a;s.y-=v;h.x-=a;h.y-=v;c.x-=a;c.y-=v;f=ht;f.s=t.CrossVV(k,s)+t.CrossVV(d,h)+t.CrossVV(g,c);f.c=t.DotVV(k,s)+t.DotVV(d,h)+t.DotVV(g,c);l=lr(f.s*f.s+f.c*f.c);isFinite(l)||(l=198177537e11);f.s*=l;f.c*=l;y=ct*o.strength;i.MulRV(f,k,u);t.SubVV(u,s,u);t.MulSV(y,u,u);rt.SelfAdd(u);i.MulRV(f,d,u);t.SubVV(u,h,u);t.MulSV(y,u,u);ut.SelfAdd(u);i.MulRV(f,g,u);t.SubVV(u,c,u);t.MulSV(y,u,u);ft.SelfAdd(u)}},e.prototype.SolveSpring=function(i){var b=e.SolveSpring_s_pa,k=e.SolveSpring_s_pb,d=e.SolveSpring_s_d,g=e.SolveSpring_s_f,r;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var f=this.m_positionBuffer.data,o=this.m_velocityBuffer.data,nt=i.inv_dt*this.m_def.springStrength,u=0;u<this.m_pairBuffer.count;u++)if(r=this.m_pairBuffer.data[u],r.flags&n.b2ParticleFlag.b2_springParticle){var s=r.indexA,h=r.indexB,c=b.Copy(f[s]),l=k.Copy(f[h]),a=o[s],v=o[h];c.SelfMulAdd(i.dt,a);l.SelfMulAdd(i.dt,v);var y=t.SubVV(l,c,d),tt=r.distance,p=y.Length(),it=nt*r.strength,w=t.MulSV(it*(tt-p)/p,y,g);a.SelfSub(w);v.SelfAdd(w)}},e.prototype.SolveTensile=function(i){var w=e.SolveTensile_s_weightedNormal,b=e.SolveTensile_s_s,k=e.SolveTensile_s_f,a,f,u,r;if(!this.m_velocityBuffer.data)throw new Error;for(a=this.m_velocityBuffer.data,f=0;f<this.m_count;f++)this.m_accumulation2Buffer[f]=new t,this.m_accumulation2Buffer[f].SetZero();for(u=0;u<this.m_contactBuffer.count;u++)if((r=this.m_contactBuffer.data[u]).flags&n.b2ParticleFlag.b2_tensileParticle){var s=r.indexA,h=r.indexB,c=r.weight,l=r.normal,y=t.MulSV((1-c)*c,l,w);this.m_accumulation2Buffer[s].SelfSub(y);this.m_accumulation2Buffer[h].SelfAdd(y)}var v=this.GetCriticalVelocity(i),d=this.m_def.surfaceTensionPressureStrength*v,g=this.m_def.surfaceTensionNormalStrength*v,nt=.5*v;for(u=0;u<this.m_contactBuffer.count;u++)if((r=this.m_contactBuffer.data[u]).flags&n.b2ParticleFlag.b2_tensileParticle){s=r.indexA;h=r.indexB;c=r.weight;l=r.normal;var tt=this.m_weightBuffer[s]+this.m_weightBuffer[h],it=t.SubVV(this.m_accumulation2Buffer[h],this.m_accumulation2Buffer[s],b),rt=o(d*(tt-2)+g*t.DotVV(it,l),nt)*c,p=t.MulSV(rt,l,k);a[s].SelfSub(p);a[h].SelfAdd(p)}},e.prototype.SolveViscous=function(){var l=e.SolveViscous_s_v,a=e.SolveViscous_s_f,i,r;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var p=this.m_positionBuffer.data,f=this.m_velocityBuffer.data,v=this.m_def.viscousStrength,w=this.GetParticleInvMass(),u=0;u<this.m_bodyContactBuffer.count;u++)if(i=(r=this.m_bodyContactBuffer.data[u]).index,this.m_flagsBuffer.data[i]&n.b2ParticleFlag.b2_viscousParticle){var o=r.body,h=r.weight,b=r.mass,y=p[i],c=t.SubVV(o.GetLinearVelocityFromWorldPoint(y,t.s_t0),f[i],l),s=t.MulSV(v*b*h,c,a);f[i].SelfMulAdd(w,s);o.ApplyLinearImpulse(s.SelfNeg(),y,!0)}for(u=0;u<this.m_contactBuffer.count;u++)(r=this.m_contactBuffer.data[u]).flags&n.b2ParticleFlag.b2_viscousParticle&&(i=r.indexA,o=r.indexB,h=r.weight,c=t.SubVV(f[o],f[i],l),s=t.MulSV(v*h,c,a),f[i].SelfAdd(s),f[o].SelfSub(s))},e.prototype.SolveRepulsive=function(i){var c=e.SolveRepulsive_s_f,r,f,o;if(!this.m_velocityBuffer.data)throw new Error;for(var s=this.m_velocityBuffer.data,l=this.m_def.repulsiveStrength*this.GetCriticalVelocity(i),u=0;u<this.m_contactBuffer.count;u++)if(r=this.m_contactBuffer.data[u],r.flags&n.b2ParticleFlag.b2_repulsiveParticle&&(f=r.indexA,o=r.indexB,this.m_groupBuffer[f]!==this.m_groupBuffer[o])){var a=r.weight,v=r.normal,h=t.MulSV(l*a,v,c);s[f].SelfSub(h);s[o].SelfAdd(h)}},e.prototype.SolvePowder=function(i){var a=e.SolvePowder_s_f,f,r,s;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var y=this.m_positionBuffer.data,h=this.m_velocityBuffer.data,v=this.m_def.powderStrength*this.GetCriticalVelocity(i),p=this.GetParticleInvMass(),u=0;u<this.m_bodyContactBuffer.count;u++)if(f=(r=this.m_bodyContactBuffer.data[u]).index,this.m_flagsBuffer.data[f]&n.b2ParticleFlag.b2_powderParticle&&(s=r.weight)>.25){var c=r.body,w=r.mass,b=y[f],l=r.normal,o=t.MulSV(v*w*(s-.25),l,a);h[f].SelfMulSub(p,o);c.ApplyLinearImpulse(o,b,!0)}for(u=0;u<this.m_contactBuffer.count;u++)(r=this.m_contactBuffer.data[u]).flags&n.b2ParticleFlag.b2_powderParticle&&(s=r.weight)>.25&&(f=r.indexA,c=r.indexB,l=r.normal,o=t.MulSV(v*(s-.25),l,a),h[f].SelfSub(o),h[c].SelfAdd(o))},e.prototype.SolveSolid=function(n){var c=e.SolveSolid_s_f,u,s,i;if(!this.m_velocityBuffer.data)throw new Error;for(u=this.m_velocityBuffer.data,this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer),s=n.inv_dt*this.m_def.ejectionStrength,i=0;i<this.m_contactBuffer.count;i++){var r=this.m_contactBuffer.data[i],f=r.indexA,o=r.indexB;if(this.m_groupBuffer[f]!==this.m_groupBuffer[o]){var l=r.weight,a=r.normal,v=this.m_depthBuffer[f]+this.m_depthBuffer[o],h=t.MulSV(s*v*l,a,c);u[f].SelfSub(h);u[o].SelfAdd(h)}}},e.prototype.SolveForce=function(n){if(!this.m_velocityBuffer.data)throw new Error;for(var i=this.m_velocityBuffer.data,r=n.dt*this.GetParticleInvMass(),t=0;t<this.m_count;t++)i[t].SelfMulAdd(r,this.m_forceBuffer[t]);this.m_hasForce=!1},e.prototype.SolveColorMixing=function(){var i,t,e,o;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_colorBuffer.data)throw new Error;if(i=.5*this.m_def.colorMixingStrength,i)for(t=0;t<this.m_contactBuffer.count;t++){var r=this.m_contactBuffer.data[t],u=r.indexA,f=r.indexB;this.m_flagsBuffer.data[u]&this.m_flagsBuffer.data[f]&n.b2ParticleFlag.b2_colorMixingParticle&&(e=this.m_colorBuffer.data[u],o=this.m_colorBuffer.data[f],it.MixColors(e,o,i))}},e.prototype.SolveZombie=function(){var b,a,k,c,u,d,h,l,s,nt,v,g,i,w,rt;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var r=0,e=[],t=0;t<this.m_count;t++)e[t]=tt;for(b=0,t=0;t<this.m_count;t++)a=this.m_flagsBuffer.data[t],a&n.b2ParticleFlag.b2_zombieParticle?(k=this.m_world.m_destructionListener,a&n.b2ParticleFlag.b2_destructionListenerParticle&&k&&k.SayGoodbyeParticle(this,t),this.m_handleIndexBuffer.data&&(c=this.m_handleIndexBuffer.data[t])&&(c.SetIndex(tt),this.m_handleIndexBuffer.data[t]=null),e[t]=tt):(e[t]=r,t!==r&&(this.m_handleIndexBuffer.data&&((c=this.m_handleIndexBuffer.data[t])&&c.SetIndex(r),this.m_handleIndexBuffer.data[r]=c),this.m_flagsBuffer.data[r]=this.m_flagsBuffer.data[t],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[r]=this.m_lastBodyContactStepBuffer.data[t]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[r]=this.m_bodyContactCountBuffer.data[t]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[r]=this.m_consecutiveContactStepsBuffer.data[t]),this.m_positionBuffer.data[r].Copy(this.m_positionBuffer.data[t]),this.m_velocityBuffer.data[r].Copy(this.m_velocityBuffer.data[t]),this.m_groupBuffer[r]=this.m_groupBuffer[t],this.m_hasForce&&this.m_forceBuffer[r].Copy(this.m_forceBuffer[t]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[r]=this.m_staticPressureBuffer[t]),this.m_depthBuffer&&(this.m_depthBuffer[r]=this.m_depthBuffer[t]),this.m_colorBuffer.data&&this.m_colorBuffer.data[r].Copy(this.m_colorBuffer.data[t]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[r]=this.m_userDataBuffer.data[t]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[r]=this.m_expirationTimeBuffer.data[t])),r++,b|=a);for(u=0;u<this.m_proxyBuffer.count;u++)d=this.m_proxyBuffer.data[u],d.index=e[d.index];for(this.m_proxyBuffer.RemoveIf(function(n){return n.index<0}),u=0;u<this.m_contactBuffer.count;u++)(h=this.m_contactBuffer.data[u]).indexA=e[h.indexA],h.indexB=e[h.indexB];for(this.m_contactBuffer.RemoveIf(function(n){return n.indexA<0||n.indexB<0}),u=0;u<this.m_bodyContactBuffer.count;u++)(h=this.m_bodyContactBuffer.data[u]).index=e[h.index];for(this.m_bodyContactBuffer.RemoveIf(function(n){return n.index<0}),u=0;u<this.m_pairBuffer.count;u++)l=this.m_pairBuffer.data[u],l.indexA=e[l.indexA],l.indexB=e[l.indexB];for(this.m_pairBuffer.RemoveIf(function(n){return n.indexA<0||n.indexB<0}),u=0;u<this.m_triadBuffer.count;u++)s=this.m_triadBuffer.data[u],s.indexA=e[s.indexA],s.indexB=e[s.indexB],s.indexC=e[s.indexC];if(this.m_triadBuffer.RemoveIf(function(n){return n.indexA<0||n.indexB<0||n.indexC<0}),this.m_indexByExpirationTimeBuffer.data)for(nt=0,v=0;v<this.m_count;v++)g=e[this.m_indexByExpirationTimeBuffer.data[v]],g!==tt&&(this.m_indexByExpirationTimeBuffer.data[nt++]=g);for(i=this.m_groupList;i;i=i.GetNext()){var y=r,p=0,it=!1;for(t=i.m_firstIndex;t<i.m_lastIndex;t++)w=e[t],w>=0?(y=o(y,w),p=f(p,w+1)):it=!0;y<p?(i.m_firstIndex=y,i.m_lastIndex=p,it&&i.m_groupFlags&n.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SetGroupFlags(i,i.m_groupFlags|n.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth)):(i.m_firstIndex=0,i.m_lastIndex=0,i.m_groupFlags&n.b2ParticleGroupFlag.b2_particleGroupCanBeEmpty||this.SetGroupFlags(i,i.m_groupFlags|n.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed))}for(this.m_count=r,this.m_allParticleFlags=b,this.m_needsUpdateAllParticleFlags=!1,i=this.m_groupList;i;)rt=i.GetNext(),i.m_groupFlags&n.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed&&this.DestroyParticleGroup(i),i=rt},e.prototype.SolveLifetimes=function(n){var t,r,u;if(!this.m_expirationTimeBuffer.data)throw new Error;if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;this.m_timeElapsed=this.LifetimeToExpirationTime(n.dt);var o=this.GetQuantizedTimeElapsed(),i=this.m_expirationTimeBuffer.data,f=this.m_indexByExpirationTimeBuffer.data,e=this.GetParticleCount();for(this.m_expirationTimeBufferRequiresSorting&&(hr(f,0,e,function(n,t){var r=i[n],u=i[t],f=r<=0;return f===u<=0?r>u:f}),this.m_expirationTimeBufferRequiresSorting=!1),t=e-1;t>=0;--t){if(r=f[t],u=i[r],o<u||u<=0)break;this.DestroyParticle(r)}},e.prototype.RotateBuffer=function(n,t,i){function u(r){return r<n?r:r<t?r+i-t:r<i?r+n-t:r}var f,c,v,l,r,a,s,h,o,e;if(n!==t&&t!==i){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;if(rt(this.m_flagsBuffer.data,n,t,i),this.m_lastBodyContactStepBuffer.data&&rt(this.m_lastBodyContactStepBuffer.data,n,t,i),this.m_bodyContactCountBuffer.data&&rt(this.m_bodyContactCountBuffer.data,n,t,i),this.m_consecutiveContactStepsBuffer.data&&rt(this.m_consecutiveContactStepsBuffer.data,n,t,i),rt(this.m_positionBuffer.data,n,t,i),rt(this.m_velocityBuffer.data,n,t,i),rt(this.m_groupBuffer,n,t,i),this.m_hasForce&&rt(this.m_forceBuffer,n,t,i),this.m_staticPressureBuffer&&rt(this.m_staticPressureBuffer,n,t,i),this.m_depthBuffer&&rt(this.m_depthBuffer,n,t,i),this.m_colorBuffer.data&&rt(this.m_colorBuffer.data,n,t,i),this.m_userDataBuffer.data&&rt(this.m_userDataBuffer.data,n,t,i),this.m_handleIndexBuffer.data)for(rt(this.m_handleIndexBuffer.data,n,t,i),f=n;f<i;++f)c=this.m_handleIndexBuffer.data[f],c&&c.SetIndex(u(c.GetIndex()));if(this.m_expirationTimeBuffer.data){if(rt(this.m_expirationTimeBuffer.data,n,t,i),v=this.GetParticleCount(),!this.m_indexByExpirationTimeBuffer.data)throw new Error;for(l=this.m_indexByExpirationTimeBuffer.data,f=0;f<v;++f)l[f]=u(l[f])}for(r=0;r<this.m_proxyBuffer.count;r++)a=this.m_proxyBuffer.data[r],a.index=u(a.index);for(r=0;r<this.m_contactBuffer.count;r++)(s=this.m_contactBuffer.data[r]).indexA=u(s.indexA),s.indexB=u(s.indexB);for(r=0;r<this.m_bodyContactBuffer.count;r++)(s=this.m_bodyContactBuffer.data[r]).index=u(s.index);for(r=0;r<this.m_pairBuffer.count;r++)h=this.m_pairBuffer.data[r],h.indexA=u(h.indexA),h.indexB=u(h.indexB);for(r=0;r<this.m_triadBuffer.count;r++)o=this.m_triadBuffer.data[r],o.indexA=u(o.indexA),o.indexB=u(o.indexB),o.indexC=u(o.indexC);for(e=this.m_groupList;e;e=e.GetNext())e.m_firstIndex=u(e.m_firstIndex),e.m_lastIndex=u(e.m_lastIndex-1)+1}},e.prototype.GetCriticalVelocity=function(n){return this.m_particleDiameter*n.inv_dt},e.prototype.GetCriticalVelocitySquared=function(n){var t=this.GetCriticalVelocity(n);return t*t},e.prototype.GetCriticalPressure=function(n){return this.m_def.density*this.GetCriticalVelocitySquared(n)},e.prototype.GetParticleStride=function(){return.75*this.m_particleDiameter},e.prototype.GetParticleMass=function(){var n=this.GetParticleStride();return this.m_def.density*n*n},e.prototype.GetParticleInvMass=function(){var n=this.m_inverseDiameter*(1/.75);return this.m_inverseDensity*n*n},e.prototype.GetFixtureContactFilter=function(){return this.m_allParticleFlags&n.b2ParticleFlag.b2_fixtureContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null},e.prototype.GetParticleContactFilter=function(){return this.m_allParticleFlags&n.b2ParticleFlag.b2_particleContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null},e.prototype.GetFixtureContactListener=function(){return this.m_allParticleFlags&n.b2ParticleFlag.b2_fixtureContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null},e.prototype.GetParticleContactListener=function(){return this.m_allParticleFlags&n.b2ParticleFlag.b2_particleContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null},e.prototype.SetUserOverridableBuffer=function(n,t,i){n.data=t;n.userSuppliedCapacity=i},e.prototype.SetGroupFlags=function(t,i){var r=t.m_groupFlags;(r^i)&n.b2ParticleGroupFlag.b2_solidParticleGroup&&(i|=n.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth);r&~i&&(this.m_needsUpdateAllGroupFlags=!0);~this.m_allGroupFlags&i&&(i&n.b2ParticleGroupFlag.b2_solidParticleGroup&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=i);t.m_groupFlags=i},e.BodyContactCompare=function(n,t){return n.index===t.index?n.weight>t.weight:n.index<t.index},e.prototype.RemoveSpuriousBodyContacts=function(){hr(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,e.BodyContactCompare);var u=e.RemoveSpuriousBodyContacts_s_n,f=e.RemoveSpuriousBodyContacts_s_pos,o=e.RemoveSpuriousBodyContacts_s_normal,n=this,i=-1,r=0;this.m_bodyContactBuffer.count=rs(this.m_bodyContactBuffer.data,function(e){var c,l,a,h,v;if(e.index!==i&&(r=0,i=e.index),r++>3)return!0;if(c=u.Copy(e.normal),c.SelfMul(n.m_particleDiameter*(1-e.weight)),!n.m_positionBuffer.data)throw new Error;if(l=t.AddVV(n.m_positionBuffer.data[e.index],c,f),!e.fixture.TestPoint(l)){for(a=e.fixture.GetShape().GetChildCount(),h=0;h<a;h++)if(v=o,e.fixture.ComputeDistance(l,v,h)<s)return!1;return!0}return!1},this.m_bodyContactBuffer.count)},e.prototype.DetectStuckParticle=function(n){if(!(this.m_stuckThreshold<=0)){if(!this.m_bodyContactCountBuffer.data)throw new Error;if(!this.m_consecutiveContactStepsBuffer.data)throw new Error;if(!this.m_lastBodyContactStepBuffer.data)throw new Error;++this.m_bodyContactCountBuffer.data[n];2===this.m_bodyContactCountBuffer.data[n]&&(++this.m_consecutiveContactStepsBuffer.data[n],this.m_consecutiveContactStepsBuffer.data[n]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=n));this.m_lastBodyContactStepBuffer.data[n]=this.m_timestamp}},e.prototype.ValidateParticleIndex=function(n){return n>=0&&n<this.GetParticleCount()&&n!==tt},e.prototype.GetQuantizedTimeElapsed=function(){return Math.floor(this.m_timeElapsed/4294967296)},e.prototype.LifetimeToExpirationTime=function(n){return this.m_timeElapsed+Math.floor(n/this.m_def.lifetimeGranularity*4294967296)},e.prototype.ForceCanBeApplied=function(t){return!(t&n.b2ParticleFlag.b2_wallParticle)},e.prototype.PrepareForceBuffer=function(){if(!this.m_hasForce){for(var n=0;n<this.m_count;n++)this.m_forceBuffer[n].SetZero();this.m_hasForce=!0}},e.prototype.IsRigidGroup=function(t){return null!==t&&0!=(t.m_groupFlags&n.b2ParticleGroupFlag.b2_rigidParticleGroup)},e.prototype.GetLinearVelocity=function(n,t,i,r){if(n&&this.IsRigidGroup(n))return n.GetLinearVelocityFromWorldPoint(i,r);if(!this.m_velocityBuffer.data)throw new Error;return r.Copy(this.m_velocityBuffer.data[t])},e.prototype.InitDampingParameter=function(n,i,r,u,f,e,o,s){n[0]=u>0?1/u:0;i[0]=f>0?1/f:0;r[0]=t.CrossVV(t.SubVV(o,e,t.s_t0),s)},e.prototype.InitDampingParameterWithRigidGroupOrParticle=function(t,i,r,u,f,e,o,s){if(f&&u)this.InitDampingParameter(t,i,r,f.GetMass(),f.GetInertia(),f.GetCenter(),o,s);else{if(!this.m_flagsBuffer.data)throw new Error;var h=this.m_flagsBuffer.data[e];this.InitDampingParameter(t,i,r,h&n.b2ParticleFlag.b2_wallParticle?0:this.GetParticleMass(),0,o,o,s)}},e.prototype.ComputeDampingImpulse=function(n,t,i,r,u,f,e){var o=n+t*i*i+r+u*f*f;return o>0?e/o:0},e.prototype.ApplyDamping=function(n,t,i,r,u,f,e,o){if(u&&r)u.m_linearVelocity.SelfMulAdd(e*n,o),u.m_angularVelocity+=e*i*t;else{if(!this.m_velocityBuffer.data)throw new Error;this.m_velocityBuffer.data[f].SelfMulAdd(e*n,o)}},e.xTruncBits=12,e.yTruncBits=12,e.tagBits=32,e.yOffset=1<<e.yTruncBits-1,e.yShift=e.tagBits-e.yTruncBits,e.xShift=e.tagBits-e.yTruncBits-e.xTruncBits,e.xScale=1<<e.xShift,e.xOffset=e.xScale*(1<<e.xTruncBits-1),e.yMask=(1<<e.yTruncBits)-1<<e.yShift,e.xMask=~e.yMask,e.DestroyParticlesInShape_s_aabb=new b,e.CreateParticleGroup_s_transform=new r,e.ComputeCollisionEnergy_s_v=new t,e.QueryShapeAABB_s_aabb=new b,e.QueryPointAABB_s_aabb=new b,e.RayCast_s_aabb=new b,e.RayCast_s_p=new t,e.RayCast_s_v=new t,e.RayCast_s_n=new t,e.RayCast_s_point=new t,e.k_pairFlags=n.b2ParticleFlag.b2_springParticle,e.k_triadFlags=n.b2ParticleFlag.b2_elasticParticle,e.k_noPressureFlags=n.b2ParticleFlag.b2_powderParticle|n.b2ParticleFlag.b2_tensileParticle,e.k_extraDampingFlags=n.b2ParticleFlag.b2_staticPressureParticle,e.k_barrierWallFlags=n.b2ParticleFlag.b2_barrierParticle|n.b2ParticleFlag.b2_wallParticle,e.CreateParticlesStrokeShapeForGroup_s_edge=new ai,e.CreateParticlesStrokeShapeForGroup_s_d=new t,e.CreateParticlesStrokeShapeForGroup_s_p=new t,e.CreateParticlesFillShapeForGroup_s_aabb=new b,e.CreateParticlesFillShapeForGroup_s_p=new t,e.UpdatePairsAndTriads_s_dab=new t,e.UpdatePairsAndTriads_s_dbc=new t,e.UpdatePairsAndTriads_s_dca=new t,e.AddContact_s_d=new t,e.UpdateBodyContacts_s_aabb=new b,e.Solve_s_subStep=new oi,e.SolveCollision_s_aabb=new b,e.SolveGravity_s_gravity=new t,e.SolveBarrier_s_aabb=new b,e.SolveBarrier_s_va=new t,e.SolveBarrier_s_vb=new t,e.SolveBarrier_s_pba=new t,e.SolveBarrier_s_vba=new t,e.SolveBarrier_s_vc=new t,e.SolveBarrier_s_pca=new t,e.SolveBarrier_s_vca=new t,e.SolveBarrier_s_qba=new t,e.SolveBarrier_s_qca=new t,e.SolveBarrier_s_dv=new t,e.SolveBarrier_s_f=new t,e.SolvePressure_s_f=new t,e.SolveDamping_s_v=new t,e.SolveDamping_s_f=new t,e.SolveRigidDamping_s_t0=new t,e.SolveRigidDamping_s_t1=new t,e.SolveRigidDamping_s_p=new t,e.SolveRigidDamping_s_v=new t,e.SolveExtraDamping_s_v=new t,e.SolveExtraDamping_s_f=new t,e.SolveRigid_s_position=new t,e.SolveRigid_s_rotation=new i,e.SolveRigid_s_transform=new r,e.SolveRigid_s_velocityTransform=new r,e.SolveElastic_s_pa=new t,e.SolveElastic_s_pb=new t,e.SolveElastic_s_pc=new t,e.SolveElastic_s_r=new i,e.SolveElastic_s_t0=new t,e.SolveSpring_s_pa=new t,e.SolveSpring_s_pb=new t,e.SolveSpring_s_d=new t,e.SolveSpring_s_f=new t,e.SolveTensile_s_weightedNormal=new t,e.SolveTensile_s_s=new t,e.SolveTensile_s_f=new t,e.SolveViscous_s_v=new t,e.SolveViscous_s_f=new t,e.SolveRepulsive_s_f=new t,e.SolvePowder_s_f=new t,e.SolveSolid_s_f=new t,e.RemoveSpuriousBodyContacts_s_n=new t,e.RemoveSpuriousBodyContacts_s_pos=new t,e.RemoveSpuriousBodyContacts_s_normal=new t,e}(),function(u){var f,o,h,l,a,v,y,p,w,k,d,g;u.UserOverridableBuffer=function(){this.data=null;this.userSuppliedCapacity=0};f=function(){function n(){this.index=tt;this.tag=0}return n.CompareProxyProxy=function(n,t){return n.tag<t.tag},n.CompareTagProxy=function(n,t){return n<t.tag},n.CompareProxyTag=function(n,t){return n.tag<t},n}();u.Proxy=f;o=function(){function n(n,t,i,r,f){this.m_system=n;this.m_xLower=(t&u.xMask)>>>0;this.m_xUpper=(i&u.xMask)>>>0;this.m_yLower=(t&u.yMask)>>>0;this.m_yUpper=(i&u.yMask)>>>0;this.m_first=r;this.m_last=f}return n.prototype.GetNext=function(){for(;this.m_first<this.m_last;){var n=(this.m_system.m_proxyBuffer.data[this.m_first].tag&u.xMask)>>>0;if(n>=this.m_xLower&&n<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return tt},n}();u.InsideBoundsEnumerator=o;u.ParticleListNode=function(){this.next=null;this.count=0;this.index=0};h=function(){function n(){}return n.prototype.Allocate=function(n,t){return t},n.prototype.Clear=function(){},n.prototype.GetCount=function(){return 0},n.prototype.Invalidate=function(){},n.prototype.GetValidBuffer=function(){return[]},n.prototype.GetBuffer=function(){return[]},n.prototype.SetCount=function(){},n}();u.FixedSetAllocator=h;u.FixtureParticle=function(n,t){this.second=tt;this.first=n;this.second=t};l=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return e(t,n),t.prototype.Initialize=function(){},t.prototype.Find=function(){return tt},t}(u.FixedSetAllocator);u.FixtureParticleSet=l;u.ParticlePair=function(n,t){this.first=tt;this.second=tt;this.first=n;this.second=t};a=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return e(t,n),t.prototype.Initialize=function(){},t.prototype.Find=function(){return tt},t}(u.FixedSetAllocator);u.b2ParticlePairSet=a;v=function(){function n(){}return n.prototype.IsNecessary=function(){return!0},n.prototype.ShouldCreatePair=function(){return!0},n.prototype.ShouldCreateTriad=function(){return!0},n}();u.ConnectionFilter=v;y=function(n){function t(t,i,r,u){var f=n.call(this)||this;return f.m_callDestructionListener=!1,f.m_destroyed=0,f.m_system=t,f.m_shape=i,f.m_xf=r,f.m_callDestructionListener=u,f.m_destroyed=0,f}return e(t,n),t.prototype.ReportFixture=function(){return!1},t.prototype.ReportParticle=function(n,t){if(n!==this.m_system)return!1;if(!this.m_system.m_positionBuffer.data)throw new Error;return this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[t])&&(this.m_system.DestroyParticle(t,this.m_callDestructionListener),this.m_destroyed++),!0},t.prototype.Destroyed=function(){return this.m_destroyed},t}(vi);u.DestroyParticlesInShapeCallback=y;p=function(n){function t(t){var i=n.call(this)||this;return i.m_threshold=0,i.m_threshold=t,i}return e(t,n),t.prototype.ShouldCreatePair=function(n,t){return n<this.m_threshold&&this.m_threshold<=t||t<this.m_threshold&&this.m_threshold<=n},t.prototype.ShouldCreateTriad=function(n,t,i){return(n<this.m_threshold||t<this.m_threshold||i<this.m_threshold)&&(this.m_threshold<=n||this.m_threshold<=t||this.m_threshold<=i)},t}(u.ConnectionFilter);u.JoinParticleGroupsFilter=p;w=function(t){function i(i,r){void 0===r&&(r=i.length);var u=t.call(this,n.b2ShapeType.e_unknown,0)||this;return u.m_shapeCount=0,u.m_shapes=i,u.m_shapeCount=r,u}return e(i,t),i.prototype.Clone=function(){throw new Error;},i.prototype.GetChildCount=function(){return 1},i.prototype.TestPoint=function(n,t){for(var i=0;i<this.m_shapeCount;i++)if(this.m_shapes[i].TestPoint(n,t))return!0;return!1},i.prototype.ComputeDistance=function(){return 0},i.prototype.RayCast=function(){return!1},i.prototype.ComputeAABB=function(n,t){var e=new b,i,f,r,u;for(n.lowerBound.x=+c,n.lowerBound.y=+c,n.upperBound.x=-c,n.upperBound.y=-c,i=0;i<this.m_shapeCount;i++)for(f=this.m_shapes[i].GetChildCount(),r=0;r<f;r++)u=e,this.m_shapes[i].ComputeAABB(u,t,r),n.Combine1(u)},i.prototype.ComputeMass=function(){},i.prototype.SetupDistanceProxy=function(){},i.prototype.ComputeSubmergedArea=function(){return 0},i.prototype.Dump=function(){},i}(ti);u.CompositeShape=w;k=function(t){function i(n){var i=t.call(this)||this;return i.m_flagsBuffer=n,i}return e(i,t),i.prototype.IsNecessary=function(t){if(!this.m_flagsBuffer.data)throw new Error;return 0!=(this.m_flagsBuffer.data[t]&n.b2ParticleFlag.b2_reactiveParticle)},i}(u.ConnectionFilter);u.ReactiveFilter=k;d=function(i){function r(n,t){var r=i.call(this,n)||this;return r.m_contactFilter=t,r}return e(r,i),r.prototype.ShouldCollideFixtureParticle=function(t,i,r){return!(this.m_contactFilter&&this.m_system.GetFlagsBuffer()[r]&n.b2ParticleFlag.b2_fixtureContactFilterParticle)||this.m_contactFilter.ShouldCollideFixtureParticle(t,this.m_system,r)},r.prototype.ReportFixtureAndParticle=function(i,r,f){var p=u.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_n,w=u.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_rp;if(!this.m_system.m_flagsBuffer.data)throw new Error;if(!this.m_system.m_positionBuffer.data)throw new Error;var c=this.m_system.m_positionBuffer.data[f],s=p,l=i.ComputeDistance(c,s,r);if(l<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(i,this.m_system,f)){var o=i.GetBody(),b=o.GetWorldCenter(),h=o.GetMass(),a=o.GetInertia()-h*o.GetLocalCenter().LengthSquared(),k=h>0?1/h:0,d=a>0?1/a:0,g=this.m_system.m_flagsBuffer.data[f]&n.b2ParticleFlag.b2_wallParticle?0:this.m_system.GetParticleInvMass(),nt=t.SubVV(c,b,w),v=t.CrossVV(nt,s),y=g+k+d*v*v,e=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()];e.index=f;e.body=o;e.fixture=i;e.weight=1-l*this.m_system.m_inverseDiameter;e.normal.Copy(s.SelfNeg());e.mass=y>0?1/y:0;this.m_system.DetectStuckParticle(f)}},r.ReportFixtureAndParticle_s_n=new t,r.ReportFixtureAndParticle_s_rp=new t,r}(of);u.UpdateBodyContactsCallback=d;g=function(f){function o(n,t){var i=f.call(this,n)||this;return i.m_step=t,i}return e(o,f),o.prototype.ReportFixtureAndParticle=function(f,e,o){var d=u.SolveCollisionCallback.ReportFixtureAndParticle_s_p1,g=u.SolveCollisionCallback.ReportFixtureAndParticle_s_output,nt=u.SolveCollisionCallback.ReportFixtureAndParticle_s_input,tt=u.SolveCollisionCallback.ReportFixtureAndParticle_s_p,it=u.SolveCollisionCallback.ReportFixtureAndParticle_s_v,rt=u.SolveCollisionCallback.ReportFixtureAndParticle_s_f,l=f.GetBody(),c,k,p,v,w;if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;var y=this.m_system.m_positionBuffer.data[o],b=this.m_system.m_velocityBuffer.data[o],a=g,h=nt;0===this.m_system.m_iterationIndex?(c=r.MulTXV(l.m_xf0,y,d),f.GetShape().GetType()===n.b2ShapeType.e_circleShape&&(c.SelfSub(l.GetLocalCenter()),i.MulRV(l.m_xf0.q,c,c),i.MulTRV(l.m_xf.q,c,c),c.SelfAdd(l.GetLocalCenter())),r.MulXV(l.m_xf,c,h.p1)):h.p1.Copy(y);(t.AddVMulSV(y,this.m_step.dt,b,h.p2),h.maxFraction=1,f.RayCast(a,h,e))&&(k=a.normal,p=tt,p.x=(1-a.fraction)*h.p1.x+a.fraction*h.p2.x+s*k.x,p.y=(1-a.fraction)*h.p1.y+a.fraction*h.p2.y+s*k.y,v=it,v.x=this.m_step.inv_dt*(p.x-y.x),v.y=this.m_step.inv_dt*(p.y-y.y),this.m_system.m_velocityBuffer.data[o].Copy(v),w=rt,w.x=this.m_step.inv_dt*this.m_system.GetParticleMass()*(b.x-v.x),w.y=this.m_step.inv_dt*this.m_system.GetParticleMass()*(b.y-v.y),this.m_system.ParticleApplyForce(o,w))},o.prototype.ReportParticle=function(){return!1},o.ReportFixtureAndParticle_s_p1=new t,o.ReportFixtureAndParticle_s_output=new dr,o.ReportFixtureAndParticle_s_input=new nr,o.ReportFixtureAndParticle_s_p=new t,o.ReportFixtureAndParticle_s_v=new t,o.ReportFixtureAndParticle_s_f=new t,o}(of);u.SolveCollisionCallback=g}(n.b2ParticleSystem||(n.b2ParticleSystem={}));var aa=function(){function i(n){this.m_newFixture=!1;this.m_locked=!1;this.m_clearForces=!0;this.m_contactManager=new vo;this.m_bodyList=null;this.m_jointList=null;this.m_particleSystemList=null;this.m_bodyCount=0;this.m_jointCount=0;this.m_gravity=new t;this.m_allowSleep=!0;this.m_destructionListener=null;this.m_debugDraw=null;this.m_inv_dt0=0;this.m_warmStarting=!0;this.m_continuousPhysics=!0;this.m_subStepping=!1;this.m_stepComplete=!0;this.m_profile=new du;this.m_island=new ko;this.s_stack=[];this.m_controllerList=null;this.m_controllerCount=0;this.m_gravity.Copy(n)}return i.prototype.SetDestructionListener=function(n){this.m_destructionListener=n},i.prototype.SetContactFilter=function(n){this.m_contactManager.m_contactFilter=n},i.prototype.SetContactListener=function(n){this.m_contactManager.m_contactListener=n},i.prototype.SetDebugDraw=function(n){this.m_debugDraw=n},i.prototype.CreateBody=function(n){if(void 0===n&&(n={}),this.IsLocked())throw new Error;var t=new ou(n,this);return t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount,t},i.prototype.DestroyBody=function(n){var t,e,r,o,u,s,i,f;if(this.IsLocked())throw new Error;for(t=n.m_jointList;t;)e=t,t=t.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(e.joint),this.DestroyJoint(e.joint),n.m_jointList=t;for(n.m_jointList=null,r=n.m_controllerList;r;)o=r,r=r.nextController,o.controller.RemoveBody(n);for(u=n.m_contactList;u;)s=u,u=u.next,this.m_contactManager.Destroy(s.contact);for(n.m_contactList=null,i=n.m_fixtureList;i;)f=i,i=i.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(f),f.DestroyProxies(),f.Destroy(),n.m_fixtureList=i,n.m_fixtureCount-=1;n.m_fixtureList=null;n.m_fixtureCount=0;n.m_prev&&(n.m_prev.m_next=n.m_next);n.m_next&&(n.m_next.m_prev=n.m_prev);n===this.m_bodyList&&(this.m_bodyList=n.m_next);--this.m_bodyCount},i._Joint_Create=function(t){switch(t.type){case n.b2JointType.e_distanceJoint:return new be(t);case n.b2JointType.e_mouseJoint:return new to(t);case n.b2JointType.e_prismaticJoint:return new io(t);case n.b2JointType.e_revoluteJoint:return new uo(t);case n.b2JointType.e_pulleyJoint:return new ro(t);case n.b2JointType.e_gearJoint:return new ge(t);case n.b2JointType.e_wheelJoint:return new oo(t);case n.b2JointType.e_weldJoint:return new eo(t);case n.b2JointType.e_frictionJoint:return new de(t);case n.b2JointType.e_ropeJoint:return new fo(t);case n.b2JointType.e_motorJoint:return new no(t);case n.b2JointType.e_areaJoint:return new ke(t)}throw new Error;},i._Joint_Destroy=function(){},i.prototype.CreateJoint=function(n){var t,u,f,r;if(this.IsLocked())throw new Error;if(t=i._Joint_Create(n,null),t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB,u=n.bodyA,f=n.bodyB,!n.collideConnected)for(r=f.GetContactList();r;)r.other===u&&r.contact.FlagForFiltering(),r=r.next;return t},i.prototype.DestroyJoint=function(n){var f,r,u,t;if(this.IsLocked())throw new Error;if(f=n.m_collideConnected,n.m_prev&&(n.m_prev.m_next=n.m_next),n.m_next&&(n.m_next.m_prev=n.m_prev),n===this.m_jointList&&(this.m_jointList=n.m_next),r=n.m_bodyA,u=n.m_bodyB,r.SetAwake(!0),u.SetAwake(!0),n.m_edgeA.prev&&(n.m_edgeA.prev.next=n.m_edgeA.next),n.m_edgeA.next&&(n.m_edgeA.next.prev=n.m_edgeA.prev),n.m_edgeA===r.m_jointList&&(r.m_jointList=n.m_edgeA.next),n.m_edgeA.prev=null,n.m_edgeA.next=null,n.m_edgeB.prev&&(n.m_edgeB.prev.next=n.m_edgeB.next),n.m_edgeB.next&&(n.m_edgeB.next.prev=n.m_edgeB.prev),n.m_edgeB===u.m_jointList&&(u.m_jointList=n.m_edgeB.next),n.m_edgeB.prev=null,n.m_edgeB.next=null,i._Joint_Destroy(n,null),--this.m_jointCount,!f)for(t=u.GetContactList();t;)t.other===r&&t.contact.FlagForFiltering(),t=t.next},i.prototype.CreateParticleSystem=function(t){if(this.IsLocked())throw new Error;var i=new n.b2ParticleSystem(t,this);return i.m_prev=null,i.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=i),this.m_particleSystemList=i,i},i.prototype.DestroyParticleSystem=function(n){if(this.IsLocked())throw new Error;n.m_prev&&(n.m_prev.m_next=n.m_next);n.m_next&&(n.m_next.m_prev=n.m_prev);n===this.m_particleSystemList&&(this.m_particleSystemList=n.m_next)},i.prototype.CalculateReasonableParticleIterations=function(n){return null===this.m_particleSystemList?1:go(this.m_gravity.Length(),function(n){for(var i=c,t=n.GetParticleSystemList();null!==t;t=t.m_next)i=o(i,t.GetRadius());return i}(this),n)},i.prototype.Step=function(n,t,r,u){var o,f,s,h,e,c;if(void 0===u&&(u=this.CalculateReasonableParticleIterations(n)),o=i.Step_s_stepTimer.Reset(),this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_locked=!0,f=i.Step_s_step,f.dt=n,f.velocityIterations=t,f.positionIterations=r,f.particleIterations=u,f.inv_dt=n>0?1/n:0,f.dtRatio=this.m_inv_dt0*n,f.warmStarting=this.m_warmStarting,s=i.Step_s_timer.Reset(),this.m_contactManager.Collide(),this.m_profile.collide=s.GetMilliseconds(),this.m_stepComplete&&f.dt>0){for(h=i.Step_s_timer.Reset(),e=this.m_particleSystemList;e;e=e.m_next)e.Solve(f);this.Solve(f);this.m_profile.solve=h.GetMilliseconds()}this.m_continuousPhysics&&f.dt>0&&(c=i.Step_s_timer.Reset(),this.SolveTOI(f),this.m_profile.solveTOI=c.GetMilliseconds());f.dt>0&&(this.m_inv_dt0=f.inv_dt);this.m_clearForces&&this.ClearForces();this.m_locked=!1;this.m_profile.step=o.GetMilliseconds()},i.prototype.ClearForces=function(){for(var n=this.m_bodyList;n;n=n.m_next)n.m_force.SetZero(),n.m_torque=0},i.prototype.DrawParticleSystem=function(n){var t,i,r,u;null!==this.m_debugDraw&&(t=n.GetParticleCount(),t&&(i=n.GetRadius(),r=n.GetPositionBuffer(),n.m_colorBuffer.data?(u=n.GetColorBuffer(),this.m_debugDraw.DrawParticles(r,i,u,t)):this.m_debugDraw.DrawParticles(r,i,null,t)))},i.prototype.DrawDebugData=function(){var e,u,t,o,r,h,c,s,a,f,l;if(null!==this.m_debugDraw){if(e=this.m_debugDraw.GetFlags(),u=i.DrawDebugData_s_color.SetRGB(0,0,0),e&n.b2DrawFlags.e_shapeBit)for(t=this.m_bodyList;t;t=t.m_next){for(o=t.m_xf,this.m_debugDraw.PushTransform(o),r=t.GetFixtureList();r;r=r.m_next)t.IsActive()?t.GetType()===n.b2BodyType.b2_staticBody?(u.SetRGB(.5,.9,.5),this.DrawShape(r,u)):t.GetType()===n.b2BodyType.b2_kinematicBody?(u.SetRGB(.5,.5,.9),this.DrawShape(r,u)):t.IsAwake()?(u.SetRGB(.9,.7,.7),this.DrawShape(r,u)):(u.SetRGB(.6,.6,.6),this.DrawShape(r,u)):(u.SetRGB(.5,.5,.3),this.DrawShape(r,u));this.m_debugDraw.PopTransform(o)}if(e&n.b2DrawFlags.e_particleBit)for(h=this.m_particleSystemList;h;h=h.m_next)this.DrawParticleSystem(h);if(e&n.b2DrawFlags.e_jointBit)for(c=this.m_jointList;c;c=c.m_next)this.DrawJoint(c);if(e&n.b2DrawFlags.e_aabbBit)for(u.SetRGB(.9,.3,.9),s=i.DrawDebugData_s_vs,t=this.m_bodyList;t;t=t.m_next)if(t.IsActive())for(r=t.GetFixtureList();r;r=r.m_next)for(a=0;a<r.m_proxyCount;++a)f=r.m_proxies[a].treeNode.aabb,s[0].Set(f.lowerBound.x,f.lowerBound.y),s[1].Set(f.upperBound.x,f.lowerBound.y),s[2].Set(f.upperBound.x,f.upperBound.y),s[3].Set(f.lowerBound.x,f.upperBound.y),this.m_debugDraw.DrawPolygon(s,4,u);if(e&n.b2DrawFlags.e_centerOfMassBit)for(t=this.m_bodyList;t;t=t.m_next)(o=i.DrawDebugData_s_xf).q.Copy(t.m_xf.q),o.p.Copy(t.GetWorldCenter()),this.m_debugDraw.DrawTransform(o);if(e&n.b2DrawFlags.e_controllerBit)for(l=this.m_controllerList;l;l=l.m_next)l.Draw(this.m_debugDraw)}},i.prototype.QueryAABB=function(n,t,i){if(this.m_contactManager.m_broadPhase.Query(t,function(t){var r=t.userData.fixture;return n?n.ReportFixture(r):!i||i(r)}),n instanceof vi)for(var r=this.m_particleSystemList;r;r=r.m_next)n.ShouldQueryParticleSystem(r)&&r.QueryAABB(n,t)},i.prototype.QueryAllAABB=function(n,t){return void 0===t&&(t=[]),this.QueryAABB(null,n,function(n){return t.push(n),!0}),t},i.prototype.QueryPointAABB=function(n,t,i){if(this.m_contactManager.m_broadPhase.QueryPoint(t,function(t){var r=t.userData.fixture;return n?n.ReportFixture(r):!i||i(r)}),n instanceof vi)for(var r=this.m_particleSystemList;r;r=r.m_next)n.ShouldQueryParticleSystem(r)&&r.QueryPointAABB(n,t)},i.prototype.QueryAllPointAABB=function(n,t){return void 0===t&&(t=[]),this.QueryPointAABB(null,n,function(n){return t.push(n),!0}),t},i.prototype.QueryFixtureShape=function(n,t,r,u,f){var o=i.QueryFixtureShape_s_aabb,e;if(t.ComputeAABB(o,u,r),this.m_contactManager.m_broadPhase.Query(o,function(i){var o=i.userData,e=o.fixture;if(nu(t,r,e.GetShape(),o.childIndex,u,e.GetBody().GetTransform())){if(n)return n.ReportFixture(e);if(f)return f(e)}return!0}),n instanceof vi)for(e=this.m_particleSystemList;e;e=e.m_next)n.ShouldQueryParticleSystem(e)&&e.QueryAABB(n,o)},i.prototype.QueryAllFixtureShape=function(n,t,i,r){return void 0===r&&(r=[]),this.QueryFixtureShape(null,n,t,i,function(n){return r.push(n),!0}),r},i.prototype.QueryFixturePoint=function(n,t,i){if(this.m_contactManager.m_broadPhase.QueryPoint(t,function(r){var u=r.userData.fixture;if(u.TestPoint(t)){if(n)return n.ReportFixture(u);if(i)return i(u)}return!0}),n)for(var r=this.m_particleSystemList;r;r=r.m_next)n.ShouldQueryParticleSystem(r)&&r.QueryPointAABB(n,t)},i.prototype.QueryAllFixturePoint=function(n,t){return void 0===t&&(t=[]),this.QueryFixturePoint(null,n,function(n){return t.push(n),!0}),t},i.prototype.RayCast=function(n,t,r,u){var e=i.RayCast_s_input,f;if(e.maxFraction=1,e.p1.Copy(t),e.p2.Copy(r),this.m_contactManager.m_broadPhase.RayCast(e,function(f,e){var l=e.userData,c=l.fixture,a=l.childIndex,s=i.RayCast_s_output,o,h;if(c.RayCast(s,f,a)){if(o=s.fraction,h=i.RayCast_s_point,h.Set((1-o)*t.x+o*r.x,(1-o)*t.y+o*r.y),n)return n.ReportFixture(c,h,s.normal,o);if(u)return u(c,h,s.normal,o)}return f.maxFraction}),n)for(f=this.m_particleSystemList;f;f=f.m_next)n.ShouldQueryParticleSystem(f)&&f.RayCast(n,t,r)},i.prototype.RayCastOne=function(n,t){var r=null,i=1;return this.RayCast(null,n,t,function(n,t,u,f){return f<i&&(i=f,r=n),i}),r},i.prototype.RayCastAll=function(n,t,i){return void 0===i&&(i=[]),this.RayCast(null,n,t,function(n){return i.push(n),1}),i},i.prototype.GetBodyList=function(){return this.m_bodyList},i.prototype.GetJointList=function(){return this.m_jointList},i.prototype.GetParticleSystemList=function(){return this.m_particleSystemList},i.prototype.GetContactList=function(){return this.m_contactManager.m_contactList},i.prototype.SetAllowSleeping=function(n){if(n!==this.m_allowSleep&&(this.m_allowSleep=n,!this.m_allowSleep))for(var t=this.m_bodyList;t;t=t.m_next)t.SetAwake(!0)},i.prototype.GetAllowSleeping=function(){return this.m_allowSleep},i.prototype.SetWarmStarting=function(n){this.m_warmStarting=n},i.prototype.GetWarmStarting=function(){return this.m_warmStarting},i.prototype.SetContinuousPhysics=function(n){this.m_continuousPhysics=n},i.prototype.GetContinuousPhysics=function(){return this.m_continuousPhysics},i.prototype.SetSubStepping=function(n){this.m_subStepping=n},i.prototype.GetSubStepping=function(){return this.m_subStepping},i.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},i.prototype.GetBodyCount=function(){return this.m_bodyCount},i.prototype.GetJointCount=function(){return this.m_jointCount},i.prototype.GetContactCount=function(){return this.m_contactManager.m_contactCount},i.prototype.GetTreeHeight=function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()},i.prototype.GetTreeBalance=function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()},i.prototype.GetTreeQuality=function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()},i.prototype.SetGravity=function(n,i){if(void 0===i&&(i=!0),!t.IsEqualToV(this.m_gravity,n)&&(this.m_gravity.Copy(n),i))for(var r=this.m_bodyList;r;r=r.m_next)r.SetAwake(!0)},i.prototype.GetGravity=function(){return this.m_gravity},i.prototype.IsLocked=function(){return this.m_locked},i.prototype.SetAutoClearForces=function(n){this.m_clearForces=n},i.prototype.GetAutoClearForces=function(){return this.m_clearForces},i.prototype.ShiftOrigin=function(n){var t,i;if(this.IsLocked())throw new Error;for(t=this.m_bodyList;t;t=t.m_next)t.m_xf.p.SelfSub(n),t.m_sweep.c0.SelfSub(n),t.m_sweep.c.SelfSub(n);for(i=this.m_jointList;i;i=i.m_next)i.ShiftOrigin(n);this.m_contactManager.m_broadPhase.ShiftOrigin(n)},i.prototype.GetContactManager=function(){return this.m_contactManager},i.prototype.GetProfile=function(){return this.m_profile},i.prototype.Dump=function(t){var r,u,i;if(!this.m_locked){for(t("const g: b2Vec2 = new b2Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y),t("this.m_world.SetGravity(g);\n"),t("const bodies: b2Body[] = [];\n"),t("const joints: b2Joint[] = [];\n"),r=0,u=this.m_bodyList;u;u=u.m_next)u.m_islandIndex=r,u.Dump(t),++r;for(r=0,i=this.m_jointList;i;i=i.m_next)i.m_index=r,++r;for(i=this.m_jointList;i;i=i.m_next)i.m_type!==n.b2JointType.e_gearJoint&&(t("{\n"),i.Dump(t),t("}\n"));for(i=this.m_jointList;i;i=i.m_next)i.m_type===n.b2JointType.e_gearJoint&&(t("{\n"),i.Dump(t),t("}\n"))}},i.prototype.DrawJoint=function(t){var e;if(null!==this.m_debugDraw){var c=t.GetBodyA(),l=t.GetBodyB(),a=c.m_xf,v=l.m_xf,y=a.p,p=v.p,u=t.GetAnchorA(i.DrawJoint_s_p1),f=t.GetAnchorB(i.DrawJoint_s_p2),r=i.DrawJoint_s_color.SetRGB(.5,.8,.8);switch(t.m_type){case n.b2JointType.e_distanceJoint:this.m_debugDraw.DrawSegment(u,f,r);break;case n.b2JointType.e_pulleyJoint:var o=t,s=o.GetGroundAnchorA(),h=o.GetGroundAnchorB();this.m_debugDraw.DrawSegment(s,u,r);this.m_debugDraw.DrawSegment(h,f,r);this.m_debugDraw.DrawSegment(s,h,r);break;case n.b2JointType.e_mouseJoint:e=i.DrawJoint_s_c;e.Set(0,1,0);this.m_debugDraw.DrawPoint(u,4,e);this.m_debugDraw.DrawPoint(f,4,e);e.Set(.8,.8,.8);this.m_debugDraw.DrawSegment(u,f,e);break;default:this.m_debugDraw.DrawSegment(y,u,r);this.m_debugDraw.DrawSegment(u,f,r);this.m_debugDraw.DrawSegment(p,f,r)}}},i.prototype.DrawShape=function(r,u){var e,a,l,v,y,b;if(null!==this.m_debugDraw){e=r.GetShape();switch(e.m_type){case n.b2ShapeType.e_circleShape:var p=e,k=p.m_p,d=p.m_radius,g=t.UNITX;this.m_debugDraw.DrawSolidCircle(k,d,g,u);break;case n.b2ShapeType.e_edgeShape:var w=e,f=w.m_vertex1,s=w.m_vertex2;this.m_debugDraw.DrawSegment(f,s,u);break;case n.b2ShapeType.e_chainShape:var o=e,nt=o.m_count,h=o.m_vertices,c=i.DrawShape_s_ghostColor.SetRGBA(.75*u.r,.75*u.g,.75*u.b,u.a);for((f=h[0],this.m_debugDraw.DrawPoint(f,4,u),o.m_hasPrevVertex)&&(a=o.m_prevVertex,this.m_debugDraw.DrawSegment(a,f,c),this.m_debugDraw.DrawCircle(a,.1,c)),l=1;l<nt;++l)s=h[l],this.m_debugDraw.DrawSegment(f,s,u),this.m_debugDraw.DrawPoint(s,4,u),f=s;o.m_hasNextVertex&&(v=o.m_nextVertex,this.m_debugDraw.DrawSegment(v,f,c),this.m_debugDraw.DrawCircle(v,.1,c));break;case n.b2ShapeType.e_polygonShape:y=e;b=y.m_count;h=y.m_vertices;this.m_debugDraw.DrawSolidPolygon(h,b,u)}}},i.prototype.Solve=function(t){for(var a,u,v,y,e,r,c,l,o,w,b,s,h,p,f,k,i=this.m_bodyList;i;i=i.m_next)i.m_xf0.Copy(i.m_xf);for(a=this.m_controllerList;a;a=a.m_next)a.Step(t);for(this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0,u=this.m_island,u.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener),i=this.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1;for(v=this.m_contactManager.m_contactList;v;v=v.m_next)v.m_islandFlag=!1;for(y=this.m_jointList;y;y=y.m_next)y.m_islandFlag=!1;for(e=this.s_stack,r=this.m_bodyList;r;r=r.m_next)if(!r.m_islandFlag&&r.IsAwake()&&r.IsActive()&&r.GetType()!==n.b2BodyType.b2_staticBody){for(u.Clear(),c=0,e[c++]=r,r.m_islandFlag=!0;c>0;){if(!(i=e[--c]))throw new Error;if(u.AddBody(i),i.m_awakeFlag=!0,i.GetType()!==n.b2BodyType.b2_staticBody){for(l=i.m_contactList;l;l=l.next)if(o=l.contact,!o.m_islandFlag&&o.IsEnabled()&&o.IsTouching()&&(w=o.m_fixtureA.m_isSensor,b=o.m_fixtureB.m_isSensor,!w&&!b)){if(u.AddContact(o),o.m_islandFlag=!0,!(h=l.other))throw new Error;h.m_islandFlag||(e[c++]=h,h.m_islandFlag=!0)}for(s=i.m_jointList;s;s=s.next)s.joint.m_islandFlag||(h=s.other).IsActive()&&(u.AddJoint(s.joint),s.joint.m_islandFlag=!0,h.m_islandFlag||(e[c++]=h,h.m_islandFlag=!0))}}for(p=new du,u.Solve(p,t,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=p.solveInit,this.m_profile.solveVelocity+=p.solveVelocity,this.m_profile.solvePosition+=p.solvePosition,f=0;f<u.m_bodyCount;++f)(i=u.m_bodies[f]).GetType()===n.b2BodyType.b2_staticBody&&(i.m_islandFlag=!1)}for(f=0;f<e.length&&e[f];++f)e[f]=null;for(k=new ci,i=this.m_bodyList;i;i=i.m_next)i.m_islandFlag&&i.GetType()!==n.b2BodyType.b2_staticBody&&i.SynchronizeFixtures();this.m_contactManager.FindNewContacts();this.m_profile.broadphase=k.GetMilliseconds()},i.prototype.SolveTOI=function(t){var u=this.m_island,g,r,f,y,nt,it,rt,ot,st,k,ut,ht,b,s,v,e,ct,lt,at,h,d;if(u.Initialize(64,32,0,null,this.m_contactManager.m_contactListener),this.m_stepComplete){for(g=this.m_bodyList;g;g=g.m_next)g.m_islandFlag=!1,g.m_sweep.alpha0=0;for(r=this.m_contactManager.m_contactList;r;r=r.m_next)r.m_toiFlag=!1,r.m_islandFlag=!1,r.m_toiCount=0,r.m_toi=1}for(;;){for(f=null,y=1,r=this.m_contactManager.m_contactList;r;r=r.m_next)if(r.IsEnabled()&&!(r.m_toiCount>8)){if(nt=1,r.m_toiFlag)nt=r.m_toi;else{if(it=r.GetFixtureA(),rt=r.GetFixtureB(),it.IsSensor()||rt.IsSensor())continue;var c=it.GetBody(),w=rt.GetBody(),ft=c.m_type,et=w.m_type,vt=c.IsAwake()&&ft!==n.b2BodyType.b2_staticBody,yt=w.IsAwake()&&et!==n.b2BodyType.b2_staticBody;if(!vt&&!yt)continue;if(ot=c.IsBullet()||ft!==n.b2BodyType.b2_dynamicBody,st=w.IsBullet()||et!==n.b2BodyType.b2_dynamicBody,!ot&&!st)continue;k=c.m_sweep.alpha0;c.m_sweep.alpha0<w.m_sweep.alpha0?(k=w.m_sweep.alpha0,c.m_sweep.Advance(k)):w.m_sweep.alpha0<c.m_sweep.alpha0&&(k=c.m_sweep.alpha0,w.m_sweep.Advance(k));var pt=r.GetChildIndexA(),wt=r.GetChildIndexB(),tt=i.SolveTOI_s_toi_input;tt.proxyA.SetShape(it.GetShape(),pt);tt.proxyB.SetShape(rt.GetShape(),wt);tt.sweepA.Copy(c.m_sweep);tt.sweepB.Copy(w.m_sweep);tt.tMax=1;ut=i.SolveTOI_s_toi_output;iu(ut,tt);ht=ut.t;nt=ut.state===n.b2TOIOutputState.e_touching?o(k+(1-k)*ht,1):1;r.m_toi=nt;r.m_toiFlag=!0}nt<y&&(f=r,y=nt)}if(null===f||1-10*p<y){this.m_stepComplete=!0;break}var bt=f.GetFixtureA(),kt=f.GetFixtureB(),l=bt.GetBody(),a=kt.GetBody(),dt=i.SolveTOI_s_backup1.Copy(l.m_sweep),gt=i.SolveTOI_s_backup2.Copy(a.m_sweep);if(l.Advance(y),a.Advance(y),f.Update(this.m_contactManager.m_contactListener),f.m_toiFlag=!1,++f.m_toiCount,f.IsEnabled()&&f.IsTouching()){for(l.SetAwake(!0),a.SetAwake(!0),u.Clear(),u.AddBody(l),u.AddBody(a),u.AddContact(f),l.m_islandFlag=!0,a.m_islandFlag=!0,f.m_islandFlag=!0,b=0;b<2;++b)if((d=0===b?l:a).m_type===n.b2BodyType.b2_dynamicBody)for(s=d.m_contactList;s&&u.m_bodyCount!==u.m_bodyCapacity&&u.m_contactCount!==u.m_contactCapacity;s=s.next)v=s.contact,v.m_islandFlag||(e=s.other,(e.m_type!==n.b2BodyType.b2_dynamicBody||d.IsBullet()||e.IsBullet())&&(ct=v.m_fixtureA.m_isSensor,lt=v.m_fixtureB.m_isSensor,ct||lt||(at=i.SolveTOI_s_backup.Copy(e.m_sweep),e.m_islandFlag||e.Advance(y),v.Update(this.m_contactManager.m_contactListener),v.IsEnabled()&&v.IsTouching()?(v.m_islandFlag=!0,u.AddContact(v),e.m_islandFlag||(e.m_islandFlag=!0,e.m_type!==n.b2BodyType.b2_staticBody&&e.SetAwake(!0),u.AddBody(e))):(e.m_sweep.Copy(at),e.SynchronizeTransform()))));for(h=i.SolveTOI_s_subStep,h.dt=(1-y)*t.dt,h.inv_dt=1/h.dt,h.dtRatio=1,h.positionIterations=20,h.velocityIterations=t.velocityIterations,h.particleIterations=t.particleIterations,h.warmStarting=!1,u.SolveTOI(h,l.m_islandIndex,a.m_islandIndex),b=0;b<u.m_bodyCount;++b)if((d=u.m_bodies[b]).m_islandFlag=!1,d.m_type===n.b2BodyType.b2_dynamicBody)for(d.SynchronizeFixtures(),s=d.m_contactList;s;s=s.next)s.contact.m_toiFlag=!1,s.contact.m_islandFlag=!1;if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}else f.SetEnabled(!1),l.m_sweep.Copy(dt),a.m_sweep.Copy(gt),l.SynchronizeTransform(),a.SynchronizeTransform()}},i.prototype.AddController=function(n){return n.m_next=this.m_controllerList,n.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=n),this.m_controllerList=n,++this.m_controllerCount,n},i.prototype.RemoveController=function(n){return n.m_prev&&(n.m_prev.m_next=n.m_next),n.m_next&&(n.m_next.m_prev=n.m_prev),this.m_controllerList===n&&(this.m_controllerList=n.m_next),--this.m_controllerCount,n.m_prev=null,n.m_next=null,n},i.Step_s_step=new oi,i.Step_s_stepTimer=new ci,i.Step_s_timer=new ci,i.DrawDebugData_s_color=new it(0,0,0),i.DrawDebugData_s_vs=t.MakeArray(4),i.DrawDebugData_s_xf=new r,i.QueryFixtureShape_s_aabb=new b,i.RayCast_s_input=new nr,i.RayCast_s_output=new dr,i.RayCast_s_point=new t,i.DrawJoint_s_p1=new t,i.DrawJoint_s_p2=new t,i.DrawJoint_s_color=new it(.5,.8,.8),i.DrawJoint_s_c=new it,i.DrawShape_s_ghostColor=new it,i.SolveTOI_s_subStep=new oi,i.SolveTOI_s_backup=new ht,i.SolveTOI_s_backup1=new ht,i.SolveTOI_s_backup2=new ht,i.SolveTOI_s_toi_input=new tu,i.SolveTOI_s_toi_output=new rr,i}(),ls=function(n,t){this.prevBody=null;this.nextBody=null;this.prevController=null;this.nextController=null;this.controller=n;this.body=t},yi=function(){function n(){this.m_bodyList=null;this.m_bodyCount=0;this.m_prev=null;this.m_next=null}return n.prototype.GetNext=function(){return this.m_next},n.prototype.GetPrev=function(){return this.m_prev},n.prototype.GetBodyList=function(){return this.m_bodyList},n.prototype.AddBody=function(n){var t=new ls(this,n);t.nextBody=this.m_bodyList;t.prevBody=null;this.m_bodyList&&(this.m_bodyList.prevBody=t);this.m_bodyList=t;++this.m_bodyCount;t.nextController=n.m_controllerList;t.prevController=null;n.m_controllerList&&(n.m_controllerList.prevController=t);n.m_controllerList=t;++n.m_controllerCount},n.prototype.RemoveBody=function(n){if(this.m_bodyCount<=0)throw new Error;for(var t=this.m_bodyList;t&&t.body!==n;)t=t.nextBody;if(null===t)throw new Error;t.prevBody&&(t.prevBody.nextBody=t.nextBody);t.nextBody&&(t.nextBody.prevBody=t.prevBody);this.m_bodyList===t&&(this.m_bodyList=t.nextBody);--this.m_bodyCount;t.nextController&&(t.nextController.prevController=t.prevController);t.prevController&&(t.prevController.nextController=t.nextController);n.m_controllerList===t&&(n.m_controllerList=t.nextController);--n.m_controllerCount},n.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0},n}(),va=function(n){function i(){var i=null!==n&&n.apply(this,arguments)||this;return i.normal=new t(0,1),i.offset=0,i.density=0,i.velocity=new t(0,0),i.linearDrag=0,i.angularDrag=0,i.useDensity=!1,i.useWorldGravity=!0,i.gravity=new t(0,0),i}return e(i,n),i.prototype.Step=function(){var e,n,f,r,l,a,h;if(this.m_bodyList)for(this.useWorldGravity&&this.gravity.Copy(this.m_bodyList.body.GetWorld().GetGravity()),e=this.m_bodyList;e;e=e.nextBody)if(n=e.body,n.IsAwake()){for(var u=new t,o=new t,i=0,c=0,s=n.GetFixtureList();s;s=s.m_next)f=new t,r=s.GetShape().ComputeSubmergedArea(this.normal,this.offset,n.GetTransform(),f),i+=r,u.x+=r*f.x,u.y+=r*f.y,c+=r*(l=this.useDensity?s.GetDensity():1),o.x+=r*f.x*l,o.y+=r*f.y*l;(u.x/=i,u.y/=i,o.x/=c,o.y/=c,i<p)||(a=this.gravity.Clone().SelfNeg(),a.SelfMul(this.density*i),n.ApplyForce(a,o),h=n.GetLinearVelocityFromWorldPoint(u,new t),h.SelfSub(this.velocity),h.SelfMul(-this.linearDrag*i),n.ApplyForce(h,u),n.ApplyTorque(-n.GetInertia()/n.GetMass()*i*n.GetAngularVelocity()*this.angularDrag))}},i.prototype.Draw=function(n){var i=100,r=new t,u=new t,f;r.x=this.normal.x*this.offset+this.normal.y*i;r.y=this.normal.y*this.offset-this.normal.x*i;u.x=this.normal.x*this.offset-this.normal.y*i;u.y=this.normal.y*this.offset+this.normal.x*i;f=new it(0,0,.8);n.DrawSegment(r,u,f)},i}(yi),ya=function(n){function i(){var i=null!==n&&n.apply(this,arguments)||this;return i.A=new t(0,0),i}return e(i,n),i.prototype.Step=function(n){for(var u,f=t.MulSV(n.dt,this.A,i.Step_s_dtA),r=this.m_bodyList;r;r=r.nextBody)u=r.body,u.IsAwake()&&u.SetLinearVelocity(t.AddVV(u.GetLinearVelocity(),f,t.s_t0))},i.prototype.Draw=function(){},i.Step_s_dtA=new t,i}(yi),pa=function(n){function i(){var i=null!==n&&n.apply(this,arguments)||this;return i.F=new t(0,0),i}return e(i,n),i.prototype.Step=function(){for(var t,n=this.m_bodyList;n;n=n.nextBody)t=n.body,t.IsAwake()&&t.ApplyForce(this.F,t.GetWorldCenter())},i.prototype.Draw=function(){},i}(yi),wa=function(n){function i(){var t=null!==n&&n.apply(this,arguments)||this;return t.G=1,t.invSqr=!0,t}return e(i,n),i.prototype.Step=function(){var n,r,l,u,f,o,s,c,h;if(this.invSqr)for(n=this.m_bodyList;n;n=n.nextBody)for(var e=(u=n.body).GetWorldCenter(),a=u.GetMass(),t=this.m_bodyList;t&&t!==n;t=t.nextBody)r=(f=t.body).GetWorldCenter(),l=f.GetMass(),(c=(o=r.x-e.x)*o+(s=r.y-e.y)*s)<p||((h=i.Step_s_f.Set(o,s)).SelfMul(this.G/c/at(c)*a*l),u.IsAwake()&&u.ApplyForce(h,e),f.IsAwake()&&f.ApplyForce(h.SelfMul(-1),r));else for(n=this.m_bodyList;n;n=n.nextBody)for(e=(u=n.body).GetWorldCenter(),a=u.GetMass(),t=this.m_bodyList;t&&t!==n;t=t.nextBody)r=(f=t.body).GetWorldCenter(),l=f.GetMass(),(c=(o=r.x-e.x)*o+(s=r.y-e.y)*s)<p||((h=i.Step_s_f.Set(o,s)).SelfMul(this.G/c*a*l),u.IsAwake()&&u.ApplyForce(h,e),f.IsAwake()&&f.ApplyForce(h.SelfMul(-1),r))},i.prototype.Draw=function(){},i.Step_s_f=new t,i}(yi),ba=function(n){function i(){var t=null!==n&&n.apply(this,arguments)||this;return t.T=new nt,t.maxTimestep=0,t}return e(i,n),i.prototype.Step=function(n){var f=n.dt,u,r,e;if(!(f<=p))for(f>this.maxTimestep&&this.maxTimestep>0&&(f=this.maxTimestep),u=this.m_bodyList;u;u=u.nextBody)r=u.body,r.IsAwake()&&(e=r.GetWorldVector(nt.MulMV(this.T,r.GetLocalVector(r.GetLinearVelocity(),t.s_t0),t.s_t1),i.Step_s_damping),r.SetLinearVelocity(t.AddVV(r.GetLinearVelocity(),t.MulSV(f,e,t.s_t0),t.s_t1)))},i.prototype.Draw=function(){},i.prototype.SetAxisAligned=function(n,t){this.T.ex.x=-n;this.T.ex.y=0;this.T.ey.x=0;this.T.ey.y=-t;this.maxTimestep=n>0||t>0?1/f(n,t):0},i.Step_s_damping=new t,i}(yi),ka=function(){function n(){this.m_count=0;this.m_ps=[];this.m_p0s=[];this.m_vs=[];this.m_ims=[];this.m_Ls=[];this.m_as=[];this.m_gravity=new t;this.m_damping=0;this.m_k2=1;this.m_k3=.1}return n.prototype.GetVertexCount=function(){return this.m_count},n.prototype.GetVertices=function(){return this.m_ps},n.prototype.Initialize=function(n){var i,f,e,o,u,r;for(this.m_count=n.count,this.m_ps=t.MakeArray(this.m_count),this.m_p0s=t.MakeArray(this.m_count),this.m_vs=t.MakeArray(this.m_count),this.m_ims=lt(this.m_count),i=0;i<this.m_count;++i)this.m_ps[i].Copy(n.vertices[i]),this.m_p0s[i].Copy(n.vertices[i]),this.m_vs[i].SetZero(),f=n.masses[i],this.m_ims[i]=f>0?1/f:0;for(e=this.m_count-1,o=this.m_count-2,this.m_Ls=lt(e),this.m_as=lt(o),i=0;i<e;++i)u=this.m_ps[i],r=this.m_ps[i+1],this.m_Ls[i]=t.DistanceVV(u,r);for(i=0;i<o;++i){u=this.m_ps[i];r=this.m_ps[i+1];var c=this.m_ps[i+2],s=t.SubVV(r,u,t.s_t0),h=t.SubVV(c,r,t.s_t1),l=t.CrossVV(s,h),a=t.DotVV(s,h);this.m_as[i]=ar(l,a)}this.m_gravity.Copy(n.gravity);this.m_damping=n.damping;this.m_k2=n.k2;this.m_k3=n.k3},n.prototype.Step=function(n,i){var u,r,f;if(0!==n){for(u=Math.exp(-n*this.m_damping),r=0;r<this.m_count;++r)this.m_p0s[r].Copy(this.m_ps[r]),this.m_ims[r]>0&&this.m_vs[r].SelfMulAdd(n,this.m_gravity),this.m_vs[r].SelfMul(u),this.m_ps[r].SelfMulAdd(n,this.m_vs[r]);for(r=0;r<i;++r)this.SolveC2(),this.SolveC3(),this.SolveC2();for(f=1/n,r=0;r<this.m_count;++r)t.MulSV(f,t.SubVV(this.m_ps[r],this.m_p0s[r],t.s_t0),this.m_vs[r])}},n.prototype.SolveC2=function(){for(var c,l,e=this.m_count-1,i=0;i<e;++i){var o=this.m_ps[i],s=this.m_ps[i+1],f=t.SubVV(s,o,n.s_d),h=f.Normalize(),r=this.m_ims[i],u=this.m_ims[i+1];r+u!==0&&(c=r/(r+u),l=u/(r+u),o.SelfMulSub(this.m_k2*c*(this.m_Ls[i]-h),f),s.SelfMulAdd(this.m_k2*l*(this.m_Ls[i]-h),f))}},n.prototype.SetAngle=function(n){for(var i=this.m_count-2,t=0;t<i;++t)this.m_as[t]=n},n.prototype.SolveC3=function(){for(var r,o,v=this.m_count-2,i=0;i<v;++i){var y=this.m_ps[i],s=this.m_ps[i+1],p=this.m_ps[i+2],w=this.m_ims[i],b=this.m_ims[i+1],k=this.m_ims[i+2],u=t.SubVV(s,y,n.s_d1),f=t.SubVV(p,s,n.s_d2),d=u.LengthSquared(),g=f.LengthSquared();if(d*g!=0){var it=t.CrossVV(u,f),rt=t.DotVV(u,f),h=ar(it,rt),nt=t.MulSV(-1/d,u.SelfSkew(),n.s_Jd1),tt=t.MulSV(1/g,f.SelfSkew(),n.s_Jd2),c=t.NegV(nt,n.s_J1),l=t.SubVV(nt,tt,n.s_J2),a=tt,e=w*t.DotVV(c,c)+b*t.DotVV(l,l)+k*t.DotVV(a,a);if(0!==e){for(e=1/e,r=h-this.m_as[i];r>ut;)r=(h-=2*ut)-this.m_as[i];for(;r<-ut;)r=(h+=2*ut)-this.m_as[i];o=-this.m_k3*e*r;y.SelfMulAdd(w*o,c);s.SelfMulAdd(b*o,l);p.SelfMulAdd(k*o,a)}}}},n.prototype.Draw=function(n){for(var i=new it(.4,.5,.7),t=0;t<this.m_count-1;++t)n.DrawSegment(this.m_ps[t],this.m_ps[t+1],i)},n.s_d=new t,n.s_d1=new t,n.s_d2=new t,n.s_Jd1=new t,n.s_Jd2=new t,n.s_J1=new t,n.s_J2=new t,n}();n.b2Assert=function(n){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];if(!n)throw new(Error.bind.apply(Error,[void 0].concat(i)));};n.b2Maybe=u;n.b2_maxFloat=c;n.b2_epsilon=p;n.b2_epsilon_sq=cr;n.b2_pi=ut;n.b2_maxManifoldPoints=d;n.b2_maxPolygonVertices=ct;n.b2_aabbExtension=.1;n.b2_aabbMultiplier=2;n.b2_linearSlop=s;n.b2_angularSlop=yt;n.b2_polygonRadius=bt;n.b2_maxSubSteps=8;n.b2_maxTOIContacts=32;n.b2_velocityThreshold=1;n.b2_maxLinearCorrection=.2;n.b2_maxAngularCorrection=.13962634015955555;n.b2_maxTranslation=2;n.b2_maxTranslationSquared=4;n.b2_maxRotation=1.570796326795;n.b2_maxRotationSquared=2.4674011002726646;n.b2_baumgarte=.2;n.b2_toiBaumgarte=.75;n.b2_invalidParticleIndex=tt;n.b2_maxParticleIndex=2147483647;n.b2_particleStride=.75;n.b2_minParticleWeight=1;n.b2_maxParticlePressure=.25;n.b2_maxParticleForce=.5;n.b2_maxTriadDistance=2;n.b2_maxTriadDistanceSquared=4;n.b2_minParticleSystemBufferCapacity=256;n.b2_barrierCollisionTime=2.5;n.b2_timeToSleep=.5;n.b2_linearSleepTolerance=.01;n.b2_angularSleepTolerance=.034906585039888888;n.b2Alloc=function(){return null};n.b2Free=function(){};n.b2Log=function(){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n]};n.b2Version=sf;n.b2_version=as;n.b2_branch="master";n.b2_commit="fbf51801d80fc389d43dc46524520e89043b6faf";n.b2ParseInt=function(n){return parseInt(n,10)};n.b2ParseUInt=function(n){return Math.abs(parseInt(n,10))};n.b2MakeArray=k;n.b2MakeNullArray=function(n){for(var t=[],i=0;i<n;++i)t.push(null);return t};n.b2MakeNumberArray=lt;n.b2_pi_over_180=.017453292519944444;n.b2_180_over_pi=57.29577951307855;n.b2_two_pi=6.28318530718;n.b2Abs=l;n.b2Min=o;n.b2Max=f;n.b2Clamp=y;n.b2Swap=function(n,t){var i=n[0];n[0]=t[0];t[0]=i};n.b2IsValid=vs;n.b2Sq=hi;n.b2InvSqrt=lr;n.b2Sqrt=at;n.b2Pow=hf;n.b2DegToRad=function(n){return.017453292519944444*n};n.b2RadToDeg=function(n){return 57.29577951307855*n};n.b2Cos=ys;n.b2Sin=ps;n.b2Acos=ws;n.b2Asin=cf;n.b2Atan2=ar;n.b2NextPowerOfTwo=function(n){return n|=n>>1&2147483647,n|=n>>2&1073741823,n|=n>>4&268435455,1+((n|=n>>8&16777215)|n>>16&65535)};n.b2IsPowerOfTwo=function(n){return n>0&&0==(n&n-1)};n.b2Random=function(){return 2*Math.random()-1};n.b2RandomRange=function(n,t){return(t-n)*Math.random()+n};n.b2Vec2=t;n.b2Vec2_zero=bs;n.b2Vec3=g;n.b2Mat22=nt;n.b2Mat33=kt;n.b2Rot=i;n.b2Transform=r;n.b2Sweep=ht;n.b2Color=it;n.b2Draw=ks;n.b2Timer=ci;n.b2Counter=ds;n.b2GrowableStack=lf;n.b2BlockAllocator=function(){};n.b2StackAllocator=function(){};n.b2ContactFeature=yf;n.b2ContactID=di;n.b2ManifoldPoint=pf;n.b2Manifold=gi;n.b2WorldManifold=kr;n.b2GetPointStates=function(t,i,r,u){for(var o,e,s,f=0;f<r.pointCount;++f)for(o=r.points[f].id.key,t[f]=n.b2PointState.b2_removeState,e=0,s=u.pointCount;e<s;++e)if(u.points[e].id.key===o){t[f]=n.b2PointState.b2_persistState;break}for(;f<d;++f)t[f]=n.b2PointState.b2_nullState;for(f=0;f<u.pointCount;++f)for(o=u.points[f].id.key,i[f]=n.b2PointState.b2_addState,e=0,s=r.pointCount;e<s;++e)if(r.points[e].id.key===o){i[f]=n.b2PointState.b2_persistState;break}for(;f<d;++f)i[f]=n.b2PointState.b2_nullState};n.b2ClipVertex=ei;n.b2RayCastInput=nr;n.b2RayCastOutput=dr;n.b2AABB=b;n.b2TestOverlapAABB=gr;n.b2ClipSegmentToLine=pi;n.b2TestOverlapShape=nu;n.b2DistanceProxy=fi;n.b2SimplexCache=vr;n.b2DistanceInput=yr;n.b2DistanceOutput=pr;n.b2ShapeCastInput=function(){this.proxyA=new fi;this.proxyB=new fi;this.transformA=new r;this.transformB=new r;this.translationB=new t};n.b2ShapeCastOutput=function(){this.point=new t;this.normal=new t;this.lambda=0;this.iterations=0};n.b2_gjk_reset=function(){n.b2_gjkCalls=0;n.b2_gjkIters=0;n.b2_gjkMaxIters=0};n.b2SimplexVertex=bi;n.b2Simplex=wr;n.b2Distance=br;n.b2ShapeCast=function(n,u){var ft,ut,tt,h,et,ot;n.iterations=0;n.lambda=1;n.normal.SetZero();n.point.SetZero();var c=u.proxyA,a=u.proxyB,st=f(c.m_radius,bt)+f(a.m_radius,bt),v=u.transformA,y=u.transformB,p=u.translationB,w=oh.Set(0,0),b=0,e=sh;e.m_count=0;for(var ht=e.m_vertices,k=c.GetSupport(i.MulTRV(v.q,t.NegV(p,t.s_t1),t.s_t0)),d=r.MulXV(v,c.GetVertex(k),af),g=a.GetSupport(i.MulTRV(y.q,p,t.s_t0)),nt=r.MulXV(y,a.GetVertex(g),vf),o=t.SubVV(d,nt,hh),it=f(bt,st-bt),ct=.5*s,rt=0;rt<20&&l(o.Length()-it)>ct;){if(n.iterations+=1,k=c.GetSupport(i.MulTRV(v.q,t.NegV(o,t.s_t1),t.s_t0)),d=r.MulXV(v,c.GetVertex(k),af),g=a.GetSupport(i.MulTRV(y.q,o,t.s_t0)),nt=r.MulXV(y,a.GetVertex(g),vf),ft=t.SubVV(d,nt,ch),o.Normalize(),ut=t.DotVV(o,ft),tt=t.DotVV(o,p),ut-it>b*tt){if(tt<=0||(b=(ut-it)/tt)>1)return!1;w.Copy(o).SelfNeg();e.m_count=0}h=ht[e.m_count];switch(h.indexA=g,h.wA.Copy(nt).SelfMulAdd(b,p),h.indexB=k,h.wB.Copy(d),h.w.Copy(h.wB).SelfSub(h.wA),h.a=1,e.m_count+=1,e.m_count){case 2:e.Solve2();break;case 3:e.Solve3()}if(3===e.m_count)return!1;e.GetClosestPoint(o);++rt}return et=lh,ot=ah,e.GetWitnessPoints(et,ot),o.LengthSquared()>0&&(w.Copy(o).SelfNeg(),w.Normalize()),n.normal.Copy(w),n.lambda=b,n.iterations=rt,!0};n.b2Pair=kf;n.b2BroadPhase=df;n.b2PairLessThan=gf;n.b2TreeNode=wf;n.b2DynamicTree=bf;n.b2_toi_reset=function(){n.b2_toiTime=0;n.b2_toiMaxTime=0;n.b2_toiCalls=0;n.b2_toiIters=0;n.b2_toiMaxIters=0;n.b2_toiRootIters=0;n.b2_toiMaxRootIters=0};n.b2TOIInput=tu;n.b2TOIOutput=rr;n.b2SeparationFunction=ie;n.b2TimeOfImpact=iu;n.b2CollideCircles=fe;n.b2CollidePolygonAndCircle=ee;n.b2CollidePolygons=le;n.b2CollideEdgeAndCircle=uu;n.b2CollideEdgeAndPolygon=fu;n.b2MassData=wi;n.b2Shape=ti;n.b2CircleShape=yl;n.b2PolygonShape=pl;n.b2EdgeShape=ai;n.b2ChainShape=wl;n.b2Filter=fr;n.b2FixtureDef=ye;n.b2FixtureProxy=eu;n.b2Fixture=pe;n.b2BodyDef=function(){this.type=n.b2BodyType.b2_staticBody;this.position=new t(0,0);this.angle=0;this.linearVelocity=new t(0,0);this.angularVelocity=0;this.linearDamping=0;this.angularDamping=0;this.allowSleep=!0;this.awake=!0;this.fixedRotation=!1;this.bullet=!1;this.active=!0;this.userData=null;this.gravityScale=1};n.b2Body=ou;n.b2World=aa;n.b2DestructionListener=sa;n.b2ContactFilter=co;n.b2ContactImpulse=lo;n.b2ContactListener=ao;n.b2QueryCallback=vi;n.b2RayCastCallback=ha;n.b2Island=ko;n.b2Profile=du;n.b2TimeStep=oi;n.b2Position=gu;n.b2Velocity=nf;n.b2SolverData=yo;n.b2ContactManager=vo;n.b2MixFriction=hu;n.b2MixRestitution=cu;n.b2ContactEdge=lu;n.b2Contact=ui;n.b2ContactRegister=so;n.b2ContactFactory=ho;n.g_blockSolve=!1;n.b2VelocityConstraintPoint=po;n.b2ContactVelocityConstraint=tf;n.b2ContactPositionConstraint=rf;n.b2ContactSolverDef=wo;n.b2PositionSolverManifold=uf;n.b2ContactSolver=bo;n.b2CircleContact=au;n.b2PolygonContact=vu;n.b2PolygonAndCircleContact=yu;n.b2EdgeAndCircleContact=pu;n.b2EdgeAndPolygonContact=wu;n.b2ChainAndCircleContact=bu;n.b2ChainAndPolygonContact=ku;n.b2Jacobian=bl;n.b2JointEdge=su;n.b2JointDef=ft;n.b2Joint=et;n.b2AreaJointDef=kl;n.b2AreaJoint=ke;n.b2DistanceJointDef=we;n.b2DistanceJoint=be;n.b2FrictionJointDef=dl;n.b2FrictionJoint=de;n.b2GearJointDef=gl;n.b2GearJoint=ge;n.b2MotorJointDef=na;n.b2MotorJoint=no;n.b2MouseJointDef=ta;n.b2MouseJoint=to;n.b2PrismaticJointDef=ia;n.b2PrismaticJoint=io;n.b2_minPulleyLength=2;n.b2PulleyJointDef=ra;n.b2PulleyJoint=ro;n.b2RevoluteJointDef=ua;n.b2RevoluteJoint=uo;n.b2RopeJointDef=fa;n.b2RopeJoint=fo;n.b2WeldJointDef=ea;n.b2WeldJoint=eo;n.b2WheelJointDef=oa;n.b2WheelJoint=oo;n.b2ControllerEdge=ls;n.b2Controller=yi;n.b2BuoyancyController=va;n.b2ConstantAccelController=ya;n.b2ConstantForceController=pa;n.b2GravityController=wa;n.b2TensorDampingController=ba;n.b2ParticleDef=er;n.b2CalculateParticleIterations=go;n.b2ParticleHandle=ff;n.b2ParticleGroupDef=ns;n.b2ParticleGroup=ts;n.b2GrowableBuffer=si;n.b2FixtureParticleQueryCallback=of;n.b2ParticleContact=es;n.b2ParticleBodyContact=os;n.b2ParticlePair=ss;n.b2ParticleTriad=hs;n.b2ParticleSystemDef=cs;n.b2RopeDef=function(){this.vertices=[];this.count=0;this.masses=[];this.gravity=new t(0,0);this.damping=.1;this.k2=.9;this.k3=.1};n.b2Rope=ka;Object.defineProperty(n,"__esModule",{value:!0})};"object"==typeof i&&void 0!==t?r(i):"function"==typeof define&&define.amd?define(["exports"],r):r((void 0).box2d={})},{}],369:[function(n,t){"use strict";var i="undefined"==typeof window?global:window;i.cc=i.cc||{};cc.internal=cc.internal||{};n("./predefine");n("./polyfill/string");n("./polyfill/misc");n("./polyfill/array");n("./polyfill/object");n("./polyfill/array-buffer");n("./polyfill/number");n("./polyfill/typescript");n("./cocos2d/core/predefine");n("./cocos2d");n("./extends");t.exports=i.cc},{"./cocos2d":297,"./cocos2d/core/predefine":220,"./extends":344,"./package":void 0,"./polyfill/array":371,"./polyfill/array-buffer":370,"./polyfill/misc":372,"./polyfill/number":373,"./polyfill/object":374,"./polyfill/string":375,"./polyfill/typescript":376,"./predefine":377}],370:[function(){"use strict";if(!ArrayBuffer.isView){var n=Object.getPrototypeOf(Int8Array);ArrayBuffer.isView="function"==typeof n?function(t){return t instanceof n}:function(n){if("object"!=typeof n)return!1;var t=n.constructor;return t===Float64Array||t===Float32Array||t===Uint8Array||t===Uint32Array||t===Int8Array}}},{}],371:[function(){"use strict";Array.isArray||(Array.isArray=function(n){return"[object Array]"===Object.prototype.toString.call(n)});Array.prototype.find||(Array.prototype.find=function(n){for(var i,r=this.length,t=0;t<r;t++)if(i=this[t],n.call(this,i,t,this))return i});Array.prototype.includes||(Array.prototype.includes=function(n){return-1!==this.indexOf(n)})},{}],372:[function(){"use strict";if(Math.sign||(Math.sign=function(n){return 0==(n=+n)||isNaN(n)?n:n>0?1:-1}),Math.log2||(Math.log2=function(n){return Math.log(n)*Math.LOG2E}),Number.isInteger||(Number.isInteger=function(n){return"number"==typeof n&&isFinite(n)&&Math.floor(n)===n}),!console.time){var n=window.performance||Date,t=Object.create(null);console.time=function(i){t[i]=n.now()};console.timeEnd=function(i){var r=t[i],u=n.now()-r;console.log(i+": "+u+"ms")}}},{}],373:[function(){"use strict";Number.parseFloat=Number.parseFloat||parseFloat;Number.parseInt=Number.parseInt||parseInt},{}],374:[function(){"use strict";Object.assign||(Object.assign=function(n,t){return cc.js.mixin(n,t)});Object.getOwnPropertyDescriptors||(Object.getOwnPropertyDescriptors=function(n){var u={},t=Object.getOwnPropertyNames(n),i,r;for(Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(n))),i=0;i<t.length;++i)r=t[i],u[r]=Object.getOwnPropertyDescriptor(n,r);return u})},{}],375:[function(){"use strict";String.prototype.startsWith||(String.prototype.startsWith=function(n,t){return t=t||0,this.lastIndexOf(n,t)===t});String.prototype.endsWith||(String.prototype.endsWith=function(n,t){(void 0===t||t>this.length)&&(t=this.length);t-=n.length;var i=this.indexOf(n,t);return-1!==i&&i===t});String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")})},{}],376:[function(){"use strict";var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n;window.__extends=function(n,i){function r(){this.constructor=n}t(n,i);n.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)};window.__assign=Object.assign||function(n){for(var r,i,t=1,u=arguments.length;t<u;t++)for(i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i]);return n};window.__rest=function(n,t){var u={},i,r;for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(u[i]=n[i]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols)for(r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(u[i[r]]=n[i[r]]);return u};window.__decorate=function(n,t,i,r){var f,e=arguments.length,u=e<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r,o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(n,t,i,r);else for(o=n.length-1;o>=0;o--)(f=n[o])&&(u=(e<3?f(u):e>3?f(t,i,u):f(t,i))||u);return e>3&&u&&Object.defineProperty(t,i,u),u};window.__param=function(n,t){return function(i,r){t(i,r,n)}};window.__metadata=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};window.__awaiter=function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){t={};f(t)}}function s(n){try{e(r.throw(n))}catch(t){t={};f(t)}}function e(n){var t;n.done?u(n.value):(t=n.value,t instanceof i?t:new i(function(n){n(t)})).then(o,s)}e((r=r.apply(n,t||[])).next())})};window.__generator=function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");for(;r;)try{if(f=1,u&&(i=2&e[0]?u.return:e[0]?u.throw||((i=u.return)&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;switch(u=0,i&&(e=[2&e[0],i.value]),e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=(i=r.trys).length>0&&i[i.length-1])&&(6===e[0]||2===e[0])){r=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(6===e[0]&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){o={};e=[6,o];u=0}finally{f=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var f,u,i,e,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:o(0),"throw":o(1),"return":o(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e};window.__exportStar=function(n,t){for(var i in n)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||__createBinding(t,n,i)};window.__createBinding=Object.create?function(n,t,i,r){void 0===r&&(r=i);Object.defineProperty(n,r,{enumerable:!0,get:function(){return t[i]}})}:function(n,t,i,r){void 0===r&&(r=i);n[r]=t[i]};window.__values=function(n){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&n[t],r=0;if(i)return i.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.");};window.__read=function(n,t){var i="function"==typeof Symbol&&n[Symbol.iterator],r,f,u,e;if(!i)return n;u=i.call(n);e=[];try{for(;(void 0===t||t-->0)&&!(r=u.next()).done;)e.push(r.value)}catch(o){o={};f={error:o}}finally{try{r&&!r.done&&(i=u.return)&&i.call(u)}finally{if(f)throw f.error;}}return e};window.__spread=function(){for(var n=[],t=0;t<arguments.length;t++)n=n.concat(__read(arguments[t]));return n};window.__spreadArrays=function(){for(var t,i,u=0,n=0,f=arguments.length;n<f;n++)u+=arguments[n].length;for(t=Array(u),i=0,n=0;n<f;n++)for(var e=arguments[n],r=0,o=e.length;r<o;r++,i++)t[i]=e[r];return t};window.__await=function(n){return this instanceof __await?(this.v=n,this):new __await(n)};window.__asyncGenerator=function(n,t,i){function e(n){o[n]&&(u[n]=function(t){return new Promise(function(i,u){r.push([n,t,i,u])>1||f(n,t)})})}function f(n,t){try{(u=o[n](t)).value instanceof __await?Promise.resolve(u.value.v).then(h,c):s(r[0][2],u)}catch(i){i={};s(r[0][3],i)}var u}function h(n){f("next",n)}function c(n){f("throw",n)}function s(n,t){n(t);r.shift();r.length&&f(r[0][0],r[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u,o=i.apply(n,t||[]),r=[];return u={},e("next"),e("throw"),e("return"),u[Symbol.asyncIterator]=function(){return this},u};window.__asyncDelegator=function(n){function i(i,u){t[i]=n[i]?function(t){return(r=!r)?{value:__await(n[i](t)),done:"return"===i}:u?u(t):t}:u}var t,r;return t={},i("next"),i("throw",function(n){throw n;}),i("return"),t[Symbol.iterator]=function(){return this},t};window.__asyncValues=function(n){function i(i){t[i]=n[i]&&function(t){return new Promise(function(r,f){u(r,f,(t=n[i](t)).done,t.value)})}}function u(n,t,i,r){Promise.resolve(r).then(function(t){n({value:t,done:i})},t)}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=n[Symbol.asyncIterator];return r?r.call(n):(n="function"==typeof __values?__values(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t)};window.__makeTemplateObject=function(n,t){return Object.defineProperty?Object.defineProperty(n,"raw",{value:t}):n.raw=t,n};n=Object.create?function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}:function(n,t){n.default=t};window.__importStar=function(t){var i,r;if(t&&t.__esModule)return t;if(i={},null!=t)for(r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&__createBinding(i,t,r);return n(i,t),i};window.__importDefault=function(n){return n&&n.__esModule?n:{"default":n}};window.__classPrivateFieldGet=function(n,t){if(!t.has(n))throw new TypeError("attempted to get private field on non-instance");return t.get(n)};window.__classPrivateFieldSet=function(n,t,i){if(!t.has(n))throw new TypeError("attempted to set private field on non-instance");return t.set(n,i),i}},{}],377:[function(){"use strict";function t(t,i){void 0===n[t]&&Object.defineProperty(n,t,{get:function(){var n;return"CC_WECHATGAMESUB"===t?n="cc.sys.platform === cc.sys.WECHAT_GAME_SUB":"CC_WECHATGAME"===t?n="cc.sys.platform === cc.sys.WECHAT_GAME":"CC_QQPLAY"===t&&(n="cc.sys.platform === cc.sys.QQ_PLAY"),cc.warnID(1400,t,n),i}})}function i(t){return"object"==typeof n[t]}var n="undefined"==typeof window?global:window;(function(t,i){void 0===n[t]&&(n[t]=i)})("CC_BUILD",!1);n.CC_BUILD=!0;n.CC_DEV=!1;n.CC_DEBUG=!1;n.CC_JSB=!1;n.CC_NATIVERENDERER=!1;n.CC_SUPPORT_JIT=!1;n.CC_PHYSICS_BUILTIN=!1;n.CC_PHYSICS_CANNON=!1;n.CC_EDITOR=!1;n.CC_PREVIEW=!1;n.CC_TEST=!1;n.CC_RUNTIME=!1;n.CC_JSB=!1;var r=!(!i("wx")||!wx.getSharedCanvas),u=!(!i("wx")||!wx.getSystemInfoSync&&!wx.getSharedCanvas),f=i("bk");t("CC_WECHATGAMESUB",r);t("CC_WECHATGAME",u);t("CC_QQPLAY",f);n.CocosEngine=cc.ENGINE_VERSION="2.4.4"},{}]},{},[369])