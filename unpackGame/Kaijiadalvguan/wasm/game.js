
	define("wasm/laya.physics3D.wasm-wx.min.js", function(require, module, exports){ 			
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function set(t,e,i,o){return(set="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,e,i,o){var s,n=_superPropBase(t,e);if(n){if((s=Object.getOwnPropertyDescriptor(n,e)).set)return s.set.call(o,i),!0;if(!s.writable)return!1}if(s=Object.getOwnPropertyDescriptor(o,e)){if(!s.writable)return!1;s.value=i,Object.defineProperty(o,e,s)}else _defineProperty(o,e,i);return!0})(t,e,i,o)}function _set(t,e,i,o,s){if(!set(t,e,i,o||t)&&s)throw new Error("failed to set property");return i}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _get(t,e,i){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var o=_superPropBase(t,e);if(o){var s=Object.getOwnPropertyDescriptor(o,e);return s.get?s.get.call(i):s.value}})(t,e,i||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}window.Physics3D=function(t,e){return new Promise(function(i){var o=new WXWebAssembly.Memory({initial:t});WXWebAssembly.instantiate("wasm/laya.physics3D.wasm.wasm",{LayaAirInteractive:e,wasi_unstable:{fd_close:function(){console.log("fd_close")},fd_seek:function(){console.log("fd_seek")},fd_write:function(){console.log("fd_write")}},env:{memory:o}}).then(function(t){window.Physics3D=t.instance.exports,i()})})},function(t,i){var c=function(){function e(){_classCallCheck(this,e),this._scale=new i.Vector3(1,1,1),this._centerMatrix=new i.Matrix4x4,this._attatched=!1,this._indexInCompound=-1,this._compoundParent=null,this._attatchedCollisionObject=null,this._referenceCount=0,this._localOffset=new i.Vector3(0,0,0),this._localRotation=new i.Quaternion(0,0,0,1),this.needsCustomCollisionCallback=!1}return _createClass(e,[{key:"_setScale",value:function(t){if(this._compoundParent)this.updateLocalTransformations();else{var o=i.ILaya3D.Physics3D._bullet;o.btVector3_setValue(e._btScale,t.x,t.y,t.z),o.btCollisionShape_setLocalScaling(this._btShape,e._btScale)}}},{key:"_addReference",value:function(){this._referenceCount++}},{key:"_removeReference",value:function(){this._referenceCount--}},{key:"updateLocalTransformations",value:function(){if(this._compoundParent){var t=e._tempVector30;i.Vector3.multiply(this.localOffset,this._scale,t),e._createAffineTransformation(t,this.localRotation,this._centerMatrix.elements)}else e._createAffineTransformation(this.localOffset,this.localRotation,this._centerMatrix.elements)}},{key:"cloneTo",value:function(t){var e=t;this._localOffset.cloneTo(e.localOffset),this._localRotation.cloneTo(e.localRotation),e.localOffset=e.localOffset,e.localRotation=e.localRotation}},{key:"clone",value:function(){return null}},{key:"destroy",value:function(){this._btShape&&(i.ILaya3D.Physics3D._bullet.btCollisionShape_destroy(this._btShape),this._btShape=null)}},{key:"type",get:function(){return this._type}},{key:"localOffset",get:function(){return this._localOffset},set:function(t){this._localOffset=t,this._compoundParent&&this._compoundParent._updateChildTransform(this)}},{key:"localRotation",get:function(){return this._localRotation},set:function(t){this._localRotation=t,this._compoundParent&&this._compoundParent._updateChildTransform(this)}}],[{key:"__init__",value:function(){var t=i.ILaya3D.Physics3D._bullet;e._btScale=t.btVector3_create(1,1,1),e._btVector30=t.btVector3_create(0,0,0),e._btQuaternion0=t.btQuaternion_create(0,0,0,1),e._btTransform0=t.btTransform_create()}},{key:"_createAffineTransformation",value:function(t,e,i){var o=e.x,s=e.y,n=e.z,r=e.w,a=o+o,l=s+s,_=n+n,c=o*a,h=o*l,u=o*_,b=s*l,y=s*_,d=n*_,C=r*a,p=r*l,g=r*_;i[0]=1-(b+d),i[1]=h+g,i[2]=u-p,i[3]=0,i[4]=h-g,i[5]=1-(c+d),i[6]=y+C,i[7]=0,i[8]=u+p,i[9]=y-C,i[10]=1-(c+b),i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1}}]),e}();c.SHAPEORIENTATION_UPX=0,c.SHAPEORIENTATION_UPY=1,c.SHAPEORIENTATION_UPZ=2,c.SHAPETYPES_BOX=0,c.SHAPETYPES_SPHERE=1,c.SHAPETYPES_CYLINDER=2,c.SHAPETYPES_CAPSULE=3,c.SHAPETYPES_CONVEXHULL=4,c.SHAPETYPES_COMPOUND=5,c.SHAPETYPES_STATICPLANE=6,c.SHAPETYPES_CONE=7,c._tempVector30=new i.Vector3;var d=function(t){function s(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;_classCallCheck(this,s),(t=_possibleConstructorReturn(this,_getPrototypeOf(s).call(this)))._sizeX=e,t._sizeY=o,t._sizeZ=n,t._type=c.SHAPETYPES_BOX;var r=i.ILaya3D.Physics3D._bullet;return r.btVector3_setValue(s._btSize,e/2,o/2,n/2),t._btShape=r.btBoxShape_create(s._btSize),t}return _inherits(s,c),_createClass(s,[{key:"clone",value:function(){var t=new s(this._sizeX,this._sizeY,this._sizeZ);return this.cloneTo(t),t}},{key:"sizeX",get:function(){return this._sizeX}},{key:"sizeY",get:function(){return this._sizeY}},{key:"sizeZ",get:function(){return this._sizeZ}}],[{key:"__init__",value:function(){s._btSize=i.ILaya3D.Physics3D._bullet.btVector3_create(0,0,0)}}]),s}(),f=function(t){function o(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1.25,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.SHAPEORIENTATION_UPY;_classCallCheck(this,o),(t=_possibleConstructorReturn(this,_getPrototypeOf(o).call(this)))._radius=e,t._length=s,t._orientation=n,t._type=c.SHAPETYPES_CAPSULE;var r=i.ILaya3D.Physics3D._bullet;switch(n){case c.SHAPEORIENTATION_UPX:t._btShape=r.btCapsuleShapeX_create(e,s-2*e);break;case c.SHAPEORIENTATION_UPY:t._btShape=r.btCapsuleShape_create(e,s-2*e);break;case c.SHAPEORIENTATION_UPZ:t._btShape=r.btCapsuleShapeZ_create(e,s-2*e);break;default:throw"CapsuleColliderShape:unknown orientation."}return t}return _inherits(o,c),_createClass(o,[{key:"_setScale",value:function(t){var e=o._tempVector30;switch(this.orientation){case c.SHAPEORIENTATION_UPX:e.x=t.x,e.y=e.z=Math.max(t.y,t.z);break;case c.SHAPEORIENTATION_UPY:e.y=t.y,e.x=e.z=Math.max(t.x,t.z);break;case c.SHAPEORIENTATION_UPZ:e.z=t.z,e.x=e.y=Math.max(t.x,t.y);break;default:throw"CapsuleColliderShape:unknown orientation."}_get(_getPrototypeOf(o.prototype),"_setScale",this).call(this,e)}},{key:"clone",value:function(){var t=new o(this._radius,this._length,this._orientation);return this.cloneTo(t),t}},{key:"radius",get:function(){return this._radius}},{key:"length",get:function(){return this._length}},{key:"orientation",get:function(){return this._orientation}}]),o}();f._tempVector30=new i.Vector3;var v=function(t){function r(){var t;return _classCallCheck(this,r),(t=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this)))._childColliderShapes=[],t._type=c.SHAPETYPES_COMPOUND,t._btShape=i.ILaya3D.Physics3D._bullet.btCompoundShape_create(),t}return _inherits(r,c),_createClass(r,[{key:"_clearChildShape",value:function(t){t._attatched=!1,t._compoundParent=null,t._indexInCompound=-1}},{key:"_addReference",value:function(){}},{key:"_removeReference",value:function(){}},{key:"_updateChildTransform",value:function(t){var e=i.ILaya3D.Physics3D._bullet,o=t.localOffset,s=t.localRotation,n=c._btVector30,r=c._btQuaternion0,a=c._btTransform0;e.btVector3_setValue(n,-o.x,o.y,o.z),e.btQuaternion_setValue(r,-s.x,s.y,s.z,-s.w),e.btTransform_setOrigin(a,n),e.btTransform_setRotation(a,r),e.btCompoundShape_updateChildTransform(this._btShape,t._indexInCompound,a,!0)}},{key:"addChildShape",value:function(t){if(t._attatched)throw"CompoundColliderShape: this shape has attatched to other entity.";t._attatched=!0,t._compoundParent=this,t._indexInCompound=this._childColliderShapes.length,this._childColliderShapes.push(t);var e=t.localOffset,o=t.localRotation,s=i.ILaya3D.Physics3D._bullet;s.btVector3_setValue(r._btOffset,-e.x,e.y,e.z),s.btQuaternion_setValue(r._btRotation,-o.x,o.y,o.z,-o.w),s.btTransform_setOrigin(r._btTransform,r._btOffset),s.btTransform_setRotation(r._btTransform,r._btRotation);var n=s.btCollisionShape_getLocalScaling(this._btShape);s.btCollisionShape_setLocalScaling(this._btShape,r._btVector3One),s.btCompoundShape_addChildShape(this._btShape,r._btTransform,t._btShape),s.btCollisionShape_setLocalScaling(this._btShape,n),this._attatchedCollisionObject&&(this._attatchedCollisionObject.colliderShape=this)}},{key:"removeChildShape",value:function(t){if(t._compoundParent===this){var e=t._indexInCompound;this._clearChildShape(t);var o=this._childColliderShapes[this._childColliderShapes.length-1];o._indexInCompound=e,this._childColliderShapes[e]=o,this._childColliderShapes.pop(),i.ILaya3D.Physics3D._bullet.btCompoundShape_removeChildShapeByIndex(this._btShape,e)}}},{key:"clearChildShape",value:function(){for(var t=0,e=this._childColliderShapes.length;t<e;t++)this._clearChildShape(this._childColliderShapes[t]),i.ILaya3D.Physics3D._bullet.btCompoundShape_removeChildShapeByIndex(this._btShape,0);this._childColliderShapes.length=0}},{key:"getChildShapeCount",value:function(){return this._childColliderShapes.length}},{key:"cloneTo",value:function(t){var e=t;e.clearChildShape();for(var i=0,o=this._childColliderShapes.length;i<o;i++)e.addChildShape(this._childColliderShapes[i].clone())}},{key:"clone",value:function(){var t=new r;return this.cloneTo(t),t}},{key:"destroy",value:function(){_get(_getPrototypeOf(r.prototype),"destroy",this).call(this);for(var t=0,e=this._childColliderShapes.length;t<e;t++){var i=this._childColliderShapes[t];0===i._referenceCount&&i.destroy()}}}],[{key:"__init__",value:function(){var t=i.ILaya3D.Physics3D._bullet;r._btVector3One=t.btVector3_create(1,1,1),r._btTransform=t.btTransform_create(),r._btOffset=t.btVector3_create(0,0,0),r._btRotation=t.btQuaternion_create(0,0,0,1)}}]),r}(),L=function(t){function a(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.SHAPEORIENTATION_UPY;_classCallCheck(this,a),(t=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this)))._radius=1,t._height=.5,t._radius=e,t._height=o,t._orientation=s,t._type=c.SHAPETYPES_CYLINDER;var n=i.ILaya3D.Physics3D._bullet;switch(s){case c.SHAPEORIENTATION_UPX:t._btShape=n.btConeShapeX_create(e,o);break;case c.SHAPEORIENTATION_UPY:t._btShape=n.btConeShape_create(e,o);break;case c.SHAPEORIENTATION_UPZ:t._btShape=n.btConeShapeZ_create(e,o);break;default:throw"ConeColliderShape:unknown orientation."}return t}return _inherits(a,c),_createClass(a,[{key:"clone",value:function(){var t=new a(this._radius,this._height,this._orientation);return this.cloneTo(t),t}},{key:"radius",get:function(){return this._radius}},{key:"height",get:function(){return this._height}},{key:"orientation",get:function(){return this._orientation}}]),a}(),D=function(t){function n(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.SHAPEORIENTATION_UPY;_classCallCheck(this,n),(t=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this)))._radius=1,t._height=.5,t._radius=e,t._height=o,t._orientation=s,t._type=c.SHAPETYPES_CYLINDER;var r=i.ILaya3D.Physics3D._bullet;switch(s){case c.SHAPEORIENTATION_UPX:r.btVector3_setValue(n._btSize,o/2,e,e),t._btShape=r.btCylinderShapeX_create(n._btSize);break;case c.SHAPEORIENTATION_UPY:r.btVector3_setValue(n._btSize,e,o/2,e),t._btShape=r.btCylinderShape_create(n._btSize);break;case c.SHAPEORIENTATION_UPZ:r.btVector3_setValue(n._btSize,e,e,o/2),t._btShape=r.btCylinderShapeZ_create(n._btSize);break;default:throw"CapsuleColliderShape:unknown orientation."}return t}return _inherits(n,c),_createClass(n,[{key:"clone",value:function(){var t=new n(this._radius,this._height,this._orientation);return this.cloneTo(t),t}},{key:"radius",get:function(){return this._radius}},{key:"height",get:function(){return this._height}},{key:"orientation",get:function(){return this._orientation}}],[{key:"__init__",value:function(){n._btSize=i.ILaya3D.Physics3D._bullet.btVector3_create(0,0,0)}}]),n}(),A=function(t){function l(){var t;return _classCallCheck(this,l),(t=_possibleConstructorReturn(this,_getPrototypeOf(l).call(this)))._mesh=null,t._convex=!1,t}return _inherits(l,c),_createClass(l,[{key:"_setScale",value:function(t){if(this._compoundParent)this.updateLocalTransformations();else{var e=i.ILaya3D.Physics3D._bullet;e.btVector3_setValue(c._btScale,t.x,t.y,t.z),e.btCollisionShape_setLocalScaling(this._btShape,c._btScale),e.btGImpactShapeInterface_updateBound(this._btShape)}}},{key:"cloneTo",value:function(t){var e=t;e.convex=this._convex,e.mesh=this._mesh,_get(_getPrototypeOf(l.prototype),"cloneTo",this).call(this,t)}},{key:"clone",value:function(){var t=new l;return this.cloneTo(t),t}},{key:"destroy",value:function(){this._btShape&&(i.ILaya3D.Physics3D._bullet.btCollisionShape_destroy(this._btShape),this._btShape=null)}},{key:"mesh",get:function(){return this._mesh},set:function(t){if(this._mesh!==t){var e=i.ILaya3D.Physics3D._bullet;this._mesh&&e.btCollisionShape_destroy(this._btShape),t&&(this._btShape=e.btGImpactMeshShape_create(t._getPhysicMesh()),e.btGImpactShapeInterface_updateBound(this._btShape)),this._mesh=t}}},{key:"convex",get:function(){return this._convex},set:function(t){this._convex=t}}]),l}(),R=function(t){function _(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;return _classCallCheck(this,_),(t=_possibleConstructorReturn(this,_getPrototypeOf(_).call(this)))._radius=e,t._type=c.SHAPETYPES_SPHERE,t._btShape=i.ILaya3D.Physics3D._bullet.btSphereShape_create(e),t}return _inherits(_,c),_createClass(_,[{key:"clone",value:function(){var t=new _(this._radius);return this.cloneTo(t),t}},{key:"radius",get:function(){return this._radius}}]),_}(),P=function(t){function h(t,e){var o;return _classCallCheck(this,h),(o=_possibleConstructorReturn(this,_getPrototypeOf(h).call(this)))._restitution=0,o._friction=.5,o._rollingFriction=0,o._ccdMotionThreshold=0,o._ccdSweptSphereRadius=0,o._collisionGroup=i.Physics3DUtils.COLLISIONFILTERGROUP_DEFAULTFILTER,o._canCollideWith=i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,o._colliderShape=null,o._transformFlag=2147483647,o._controlBySimulation=!1,o._enableProcessCollisions=!0,o._inPhysicUpdateListIndex=-1,o.canScaleShape=!0,o._collisionGroup=t,o._canCollideWith=e,h._physicObjectsMap[o.id]=_assertThisInitialized(o),o}return _inherits(h,i.Component),_createClass(h,[{key:"_parseShape",value:function(t){var e=t.length;if(1===e){var i=h._creatShape(t[0]);this.colliderShape=i}else{for(var o=new v,s=0;s<e;s++)i=h._creatShape(t[s]),o.addChildShape(i);this.colliderShape=o}}},{key:"_onScaleChange",value:function(t){this._colliderShape._setScale(t)}},{key:"_onEnable",value:function(){this._simulation=this.owner._scene.physicsSimulation,i.ILaya3D.Physics3D._bullet.btCollisionObject_setContactProcessingThreshold(this._btColliderObject,0),this._colliderShape&&(this._derivePhysicsTransformation(!0),this._addToSimulation())}},{key:"_onDisable",value:function(){this._colliderShape&&(this._removeFromSimulation(),-1!==this._inPhysicUpdateListIndex&&this._simulation._physicsUpdateList.remove(this)),this._simulation=null}},{key:"_onDestroy",value:function(){delete h._physicObjectsMap[this.id],i.ILaya3D.Physics3D._bullet.btCollisionObject_destroy(this._btColliderObject),this._colliderShape.destroy(),_get(_getPrototypeOf(h.prototype),"_onDestroy",this).call(this),this._btColliderObject=null,this._colliderShape=null,this._simulation=null,this.owner.transform.off(i.Event.TRANSFORM_CHANGED,this,this._onTransformChanged)}},{key:"_isValid",value:function(){return this._simulation&&this._colliderShape&&this._enabled}},{key:"_parse",value:function(t){null!=t.collisionGroup&&(this.collisionGroup=t.collisionGroup),null!=t.canCollideWith&&(this.canCollideWith=t.canCollideWith),null!=t.ccdMotionThreshold&&(this.ccdMotionThreshold=t.ccdMotionThreshold),null!=t.ccdSweptSphereRadius&&(this.ccdSweptSphereRadius=t.ccdSweptSphereRadius)}},{key:"_setTransformFlag",value:function(t,e){e?this._transformFlag|=t:this._transformFlag&=~t}},{key:"_getTransformFlag",value:function(t){return 0!=(this._transformFlag&t)}},{key:"_addToSimulation",value:function(){}},{key:"_removeFromSimulation",value:function(){}},{key:"_derivePhysicsTransformation",value:function(t){var e=i.ILaya3D.Physics3D._bullet,o=this._btColliderObject,s=e.btCollisionObject_getWorldTransform(o);this._innerDerivePhysicsTransformation(s,t),e.btCollisionObject_setWorldTransform(o,s)}},{key:"_innerDerivePhysicsTransformation",value:function(t,e){var o=i.ILaya3D.Physics3D._bullet,s=this.owner._transform;if(e||this._getTransformFlag(i.Transform3D.TRANSFORM_WORLDPOSITION)){var n=this._colliderShape.localOffset,r=s.position,a=h._btVector30;if(0!==n.x||0!==n.y||0!==n.z){var l=h._tempVector30,_=s.worldMatrix;i.Vector3.transformCoordinate(n,_,l),o.btVector3_setValue(a,-l.x,l.y,l.z)}else o.btVector3_setValue(a,-r.x,r.y,r.z);o.btTransform_setOrigin(t,a),this._setTransformFlag(i.Transform3D.TRANSFORM_WORLDPOSITION,!1)}if(e||this._getTransformFlag(i.Transform3D.TRANSFORM_WORLDQUATERNION)){var c=this._colliderShape.localRotation,u=h._btQuaternion0,b=s.rotation;if(0!==c.x||0!==c.y||0!==c.z||1!==c.w){var y=h._tempQuaternion0;h.physicQuaternionMultiply(b.x,b.y,b.z,b.w,c,y),o.btQuaternion_setValue(u,-y.x,y.y,y.z,-y.w)}else o.btQuaternion_setValue(u,-b.x,b.y,b.z,-b.w);o.btTransform_setRotation(t,u),this._setTransformFlag(i.Transform3D.TRANSFORM_WORLDQUATERNION,!1)}(e||this._getTransformFlag(i.Transform3D.TRANSFORM_WORLDSCALE))&&(this._onScaleChange(s.getWorldLossyScale()),this._setTransformFlag(i.Transform3D.TRANSFORM_WORLDSCALE,!1))}},{key:"_updateTransformComponent",value:function(t){var e=i.ILaya3D.Physics3D._bullet,o=this._colliderShape,s=o.localOffset,n=o.localRotation,r=this.owner._transform,a=r.position,l=r.rotation,_=e.btTransform_getOrigin(t),c=e.btTransform_getRotation(t),u=-e.btQuaternion_x(c),b=e.btQuaternion_y(c),y=e.btQuaternion_z(c),d=-e.btQuaternion_w(c);if(0!==n.x||0!==n.y||0!==n.z||1!==n.w){var C=h._tempQuaternion0;n.invert(C),h.physicQuaternionMultiply(u,b,y,d,C,l)}else l.x=u,l.y=b,l.z=y,l.w=d;if(r.rotation=l,0!==s.x||0!==s.y||0!==s.z){var p=e.btCollisionShape_getLocalScaling(o._btShape),g=h._tempVector30;g.x=s.x*e.btVector3_x(p),g.y=s.y*e.btVector3_y(p),g.z=s.z*e.btVector3_z(p),i.Vector3.transformQuat(g,l,g),a.x=-e.btVector3_x(_)-g.x,a.y=e.btVector3_y(_)-g.y,a.z=e.btVector3_z(_)-g.z}else a.x=-e.btVector3_x(_),a.y=e.btVector3_y(_),a.z=e.btVector3_z(_);r.position=a}},{key:"_onShapeChange",value:function(t){var e=this._btColliderObject,o=i.ILaya3D.Physics3D._bullet,s=o.btCollisionObject_getCollisionFlags(e);t.needsCustomCollisionCallback?0==(s&h.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)&&o.btCollisionObject_setCollisionFlags(e,s|h.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK):(s&h.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)>0&&o.btCollisionObject_setCollisionFlags(e,s^h.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)}},{key:"_onAdded",value:function(){this.enabled=this._enabled,this.restitution=this._restitution,this.friction=this._friction,this.rollingFriction=this._rollingFriction,this.ccdMotionThreshold=this._ccdMotionThreshold,this.ccdSweptSphereRadius=this._ccdSweptSphereRadius,this.owner.transform.on(i.Event.TRANSFORM_CHANGED,this,this._onTransformChanged)}},{key:"_onTransformChanged",value:function(t){!h._addUpdateList&&this._controlBySimulation||(t&=i.Transform3D.TRANSFORM_WORLDPOSITION|i.Transform3D.TRANSFORM_WORLDQUATERNION|i.Transform3D.TRANSFORM_WORLDSCALE)&&(this._transformFlag|=t,this._isValid()&&-1===this._inPhysicUpdateListIndex&&this._simulation._physicsUpdateList.add(this))}},{key:"_cloneTo",value:function(t){var e=t;e.restitution=this._restitution,e.friction=this._friction,e.rollingFriction=this._rollingFriction,e.ccdMotionThreshold=this._ccdMotionThreshold,e.ccdSweptSphereRadius=this._ccdSweptSphereRadius,e.collisionGroup=this._collisionGroup,e.canCollideWith=this._canCollideWith,e.canScaleShape=this.canScaleShape,this._colliderShape&&(e.colliderShape=this._colliderShape.clone())}},{key:"restitution",get:function(){return this._restitution},set:function(t){this._restitution=t,this._btColliderObject&&i.ILaya3D.Physics3D._bullet.btCollisionObject_setRestitution(this._btColliderObject,t)}},{key:"friction",get:function(){return this._friction},set:function(t){this._friction=t,this._btColliderObject&&i.ILaya3D.Physics3D._bullet.btCollisionObject_setFriction(this._btColliderObject,t)}},{key:"rollingFriction",get:function(){return this._rollingFriction},set:function(t){this._rollingFriction=t,this._btColliderObject&&i.ILaya3D.Physics3D._bullet.btCollisionObject_setRollingFriction(this._btColliderObject,t)}},{key:"ccdMotionThreshold",get:function(){return this._ccdMotionThreshold},set:function(t){this._ccdMotionThreshold=t,this._btColliderObject&&i.ILaya3D.Physics3D._bullet.btCollisionObject_setCcdMotionThreshold(this._btColliderObject,t)}},{key:"ccdSweptSphereRadius",get:function(){return this._ccdSweptSphereRadius},set:function(t){this._ccdSweptSphereRadius=t,this._btColliderObject&&i.ILaya3D.Physics3D._bullet.btCollisionObject_setCcdSweptSphereRadius(this._btColliderObject,t)}},{key:"isActive",get:function(){return!!this._btColliderObject&&i.ILaya3D.Physics3D._bullet.btCollisionObject_isActive(this._btColliderObject)}},{key:"colliderShape",get:function(){return this._colliderShape},set:function(t){var e=this._colliderShape;if(e&&(e._attatched=!1,e._attatchedCollisionObject=null),this._colliderShape=t,t){if(t._attatched)throw"PhysicsComponent: this shape has attatched to other entity.";if(t._attatched=!0,t._attatchedCollisionObject=this,this._btColliderObject){i.ILaya3D.Physics3D._bullet.btCollisionObject_setCollisionShape(this._btColliderObject,t._btShape);var o=this._simulation&&this._enabled;o&&e&&this._removeFromSimulation(),this._onShapeChange(t),o&&(this._derivePhysicsTransformation(!0),this._addToSimulation())}}else this._simulation&&this._enabled&&e&&this._removeFromSimulation()}},{key:"simulation",get:function(){return this._simulation}},{key:"collisionGroup",get:function(){return this._collisionGroup},set:function(t){this._collisionGroup!==t&&(this._collisionGroup=t,this._simulation&&this._colliderShape&&this._enabled&&(this._removeFromSimulation(),this._addToSimulation()))}},{key:"canCollideWith",get:function(){return this._canCollideWith},set:function(t){this._canCollideWith!==t&&(this._canCollideWith=t,this._simulation&&this._colliderShape&&this._enabled&&(this._removeFromSimulation(),this._addToSimulation()))}}],[{key:"__init__",value:function(){var t=i.ILaya3D.Physics3D._bullet;h._btVector30=t.btVector3_create(0,0,0),h._btQuaternion0=t.btQuaternion_create(0,0,0,1)}},{key:"_createAffineTransformationArray",value:function(t,e,i,o,s,n,r,a,l){var _=o+o,c=s+s,h=n+n,u=o*_,b=o*c,y=o*h,d=s*c,C=s*h,p=n*h,g=r*_,f=r*c,m=r*h,T=a[0],O=a[1],I=a[2];l[0]=(1-(d+p))*T,l[1]=(b+m)*T,l[2]=(y-f)*T,l[3]=0,l[4]=(b-m)*O,l[5]=(1-(u+p))*O,l[6]=(C+g)*O,l[7]=0,l[8]=(y+f)*I,l[9]=(C-g)*I,l[10]=(1-(u+d))*I,l[11]=0,l[12]=t,l[13]=e,l[14]=i,l[15]=1}},{key:"_creatShape",value:function(t){var e;switch(t.type){case"BoxColliderShape":var o=t.size;e=o?new d(o[0],o[1],o[2]):new d;break;case"SphereColliderShape":e=new R(t.radius);break;case"CapsuleColliderShape":e=new f(t.radius,t.height,t.orientation);break;case"MeshColliderShape":var s=new A;t.mesh&&(s.mesh=i.Loader.getRes(t.mesh)),e=s;break;case"ConeColliderShape":e=new L(t.radius,t.height,t.orientation);break;case"CylinderColliderShape":e=new D(t.radius,t.height,t.orientation);break;default:throw"unknown shape type."}if(t.center){var n=e.localOffset;n.fromArray(t.center),e.localOffset=n}return e}},{key:"physicVector3TransformQuat",value:function(t,e,i,o,s,n){var r=t.x,a=t.y,l=t.z,_=s*r+i*l-o*a,c=s*a+o*r-e*l,h=s*l+e*a-i*r,u=-e*r-i*a-o*l;n.x=_*s+u*-e+c*-o-h*-i,n.y=c*s+u*-i+h*-e-_*-o,n.z=h*s+u*-o+_*-i-c*-e}},{key:"physicQuaternionMultiply",value:function(t,e,i,o,s,n){var r=s.x,a=s.y,l=s.z,_=s.w,c=e*l-i*a,h=i*r-t*l,u=t*a-e*r,b=t*r+e*a+i*l;n.x=t*_+r*o+c,n.y=e*_+a*o+h,n.z=i*_+l*o+u,n.w=o*_-b}}]),h}();P.ACTIVATIONSTATE_ACTIVE_TAG=1,P.ACTIVATIONSTATE_ISLAND_SLEEPING=2,P.ACTIVATIONSTATE_WANTS_DEACTIVATION=3,P.ACTIVATIONSTATE_DISABLE_DEACTIVATION=4,P.ACTIVATIONSTATE_DISABLE_SIMULATION=5,P.COLLISIONFLAGS_STATIC_OBJECT=1,P.COLLISIONFLAGS_KINEMATIC_OBJECT=2,P.COLLISIONFLAGS_NO_CONTACT_RESPONSE=4,P.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK=8,P.COLLISIONFLAGS_CHARACTER_OBJECT=16,P.COLLISIONFLAGS_DISABLE_VISUALIZE_OBJECT=32,P.COLLISIONFLAGS_DISABLE_SPU_COLLISION_PROCESSING=64,P._tempVector30=new i.Vector3,P._tempQuaternion0=new i.Quaternion,P._tempQuaternion1=new i.Quaternion,P._tempMatrix4x40=new i.Matrix4x4,P._physicObjectsMap={},P._addUpdateList=!0;var N=function c(){_classCallCheck(this,c)};N._interactive={getWorldTransform:function(t,e){},setWorldTransform:function(t,e){var i=P._physicObjectsMap[t];i._simulation._updatedRigidbodies++,i._updateTransformComponent(e)}};var k=function(t){function b(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.Physics3DUtils.COLLISIONFILTERGROUP_DEFAULTFILTER,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER;return _classCallCheck(this,b),(t=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,s,n)))._upAxis=new i.Vector3(0,1,0),t._maxSlope=45,t._jumpSpeed=10,t._fallSpeed=55,t._gravity=new i.Vector3(0,3*-9.8,0),t._btKinematicCharacter=null,t._stepHeight=e,o&&(t._upAxis=o),t._controlBySimulation=!0,t}return _inherits(b,P),_createClass(b,[{key:"_constructCharacter",value:function(){var t=i.ILaya3D.Physics3D._bullet;this._btKinematicCharacter&&t.btKinematicCharacterController_destroy(this._btKinematicCharacter);var e=b._btTempVector30;t.btVector3_setValue(e,this._upAxis.x,this._upAxis.y,this._upAxis.z),this._btKinematicCharacter=t.btKinematicCharacterController_create(this._btColliderObject,this._colliderShape._btShape,this._stepHeight,e),this.fallSpeed=this._fallSpeed,this.maxSlope=this._maxSlope,this.jumpSpeed=this._jumpSpeed,this.gravity=this._gravity}},{key:"_onShapeChange",value:function(t){_get(_getPrototypeOf(b.prototype),"_onShapeChange",this).call(this,t),this._constructCharacter()}},{key:"_onAdded",value:function(){var t=i.ILaya3D.Physics3D._bullet,e=t.btPairCachingGhostObject_create();t.btCollisionObject_setUserIndex(e,this.id),t.btCollisionObject_setCollisionFlags(e,P.COLLISIONFLAGS_CHARACTER_OBJECT),this._btColliderObject=e,this._colliderShape&&this._constructCharacter(),_get(_getPrototypeOf(b.prototype),"_onAdded",this).call(this)}},{key:"_addToSimulation",value:function(){this._simulation._characters.push(this),this._simulation._addCharacter(this,this._collisionGroup,this._canCollideWith)}},{key:"_removeFromSimulation",value:function(){this._simulation._removeCharacter(this);var t=this._simulation._characters;t.splice(t.indexOf(this),1)}},{key:"_cloneTo",value:function(t){_get(_getPrototypeOf(b.prototype),"_cloneTo",this).call(this,t);var e=t;e.stepHeight=this._stepHeight,e.upAxis=this._upAxis,e.maxSlope=this._maxSlope,e.jumpSpeed=this._jumpSpeed,e.fallSpeed=this._fallSpeed,e.gravity=this._gravity}},{key:"_onDestroy",value:function(){i.ILaya3D.Physics3D._bullet.btKinematicCharacterController_destroy(this._btKinematicCharacter),_get(_getPrototypeOf(b.prototype),"_onDestroy",this).call(this),this._btKinematicCharacter=null}},{key:"move",value:function(t){var e=b._btVector30,o=i.ILaya3D.Physics3D._bullet;o.btVector3_setValue(e,-t.x,t.y,t.z),o.btKinematicCharacterController_setWalkDirection(this._btKinematicCharacter,e)}},{key:"jump",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=i.ILaya3D.Physics3D._bullet,o=b._btVector30;t?(i.Utils3D._convertToBulletVec3(t,o,!0),e.btKinematicCharacterController_jump(this._btKinematicCharacter,o)):(e.btVector3_setValue(o,0,0,0),e.btKinematicCharacterController_jump(this._btKinematicCharacter,o))}},{key:"fallSpeed",get:function(){return this._fallSpeed},set:function(t){this._fallSpeed=t,i.ILaya3D.Physics3D._bullet.btKinematicCharacterController_setFallSpeed(this._btKinematicCharacter,t)}},{key:"jumpSpeed",get:function(){return this._jumpSpeed},set:function(t){this._jumpSpeed=t,i.ILaya3D.Physics3D._bullet.btKinematicCharacterController_setJumpSpeed(this._btKinematicCharacter,t)}},{key:"gravity",get:function(){return this._gravity},set:function(t){this._gravity=t;var e=i.ILaya3D.Physics3D._bullet,o=b._btTempVector30;e.btVector3_setValue(o,-t.x,t.y,t.z),e.btKinematicCharacterController_setGravity(this._btKinematicCharacter,o)}},{key:"maxSlope",get:function(){return this._maxSlope},set:function(t){this._maxSlope=t,i.ILaya3D.Physics3D._bullet.btKinematicCharacterController_setMaxSlope(this._btKinematicCharacter,t/180*Math.PI)}},{key:"isGrounded",get:function(){return i.ILaya3D.Physics3D._bullet.btKinematicCharacterController_onGround(this._btKinematicCharacter)}},{key:"stepHeight",get:function(){return this._stepHeight},set:function(t){this._stepHeight=t,i.ILaya3D.Physics3D._bullet.btKinematicCharacterController_setStepHeight(this._btKinematicCharacter,t)}},{key:"upAxis",get:function(){return this._upAxis},set:function(t){this._upAxis=t;var e=b._btTempVector30;i.Utils3D._convertToBulletVec3(t,e,!1),i.ILaya3D.Physics3D._bullet.btKinematicCharacterController_setUp(this._btKinematicCharacter,e)}}],[{key:"__init__",value:function(){b._btTempVector30=i.ILaya3D.Physics3D._bullet.btVector3_create(0,0,0)}}]),b}();k.UPAXIS_X=0,k.UPAXIS_Y=1,k.UPAXIS_Z=2;var E=function(){function d(){_classCallCheck(this,d),this._lastUpdateFrame=-2147483648,this._updateFrame=-2147483648,this._isTrigger=!1,this.contacts=[]}return _createClass(d,[{key:"_setUpdateFrame",value:function(t){this._lastUpdateFrame=this._updateFrame,this._updateFrame=t}}]),d}(),V=function u(){_classCallCheck(this,u),this._idCounter=0,this.colliderA=null,this.colliderB=null,this.distance=0,this.normal=new i.Vector3,this.positionOnA=new i.Vector3,this.positionOnB=new i.Vector3,this._id=++this._idCounter},F=function C(){_classCallCheck(this,C),this.succeeded=!1,this.collider=null,this.point=new i.Vector3,this.normal=new i.Vector3,this.hitFraction=0},x=function(){function y(){_classCallCheck(this,y),this._hitResultsPoolIndex=0,this._hitResultsPool=[],this._contactPonintsPoolIndex=0,this._contactPointsPool=[],this._collisionsPool=[],this._collisions={}}return _createClass(y,[{key:"getHitResult",value:function(){var t=this._hitResultsPool[this._hitResultsPoolIndex++];return t||(t=new F,this._hitResultsPool.push(t)),t}},{key:"recoverAllHitResultsPool",value:function(){this._hitResultsPoolIndex=0}},{key:"getContactPoints",value:function(){var t=this._contactPointsPool[this._contactPonintsPoolIndex++];return t||(t=new V,this._contactPointsPool.push(t)),t}},{key:"recoverAllContactPointsPool",value:function(){this._contactPonintsPoolIndex=0}},{key:"getCollision",value:function(t,e){var i,o=t.id,s=e.id,n=this._collisions[o];return n&&(i=n[s]),i||(n||(n={},this._collisions[o]=n),(i=0===this._collisionsPool.length?new E:this._collisionsPool.pop())._colliderA=t,i._colliderB=e,n[s]=i),i}},{key:"recoverCollision",value:function(t){var e=t._colliderA.id,i=t._colliderB.id;this._collisions[e][i]=null,this._collisionsPool.push(t)}},{key:"garbageCollection",value:function(){for(var t in this._hitResultsPoolIndex=0,this._hitResultsPool.length=0,this._contactPonintsPoolIndex=0,this._contactPointsPool.length=0,this._collisionsPool.length=0,this._collisionsPool){var e=this._collisionsPool[t],i=!0;for(var o in e)e[o]?i=!1:delete e[o];i&&delete this._collisionsPool[t]}}}]),y}(),B=function(t){function m(t,e){var i;return _classCallCheck(this,m),(i=_possibleConstructorReturn(this,_getPrototypeOf(m).call(this,t,e)))._isTrigger=!1,i}return _inherits(m,P),_createClass(m,[{key:"_onAdded",value:function(){_get(_getPrototypeOf(m.prototype),"_onAdded",this).call(this),this.isTrigger=this._isTrigger}},{key:"_cloneTo",value:function(t){_get(_getPrototypeOf(m.prototype),"_cloneTo",this).call(this,t),t.isTrigger=this._isTrigger}},{key:"isTrigger",get:function(){return this._isTrigger},set:function(t){this._isTrigger=t;var e=i.ILaya3D.Physics3D._bullet;if(this._btColliderObject){var o=e.btCollisionObject_getCollisionFlags(this._btColliderObject);t?0==(o&P.COLLISIONFLAGS_NO_CONTACT_RESPONSE)&&e.btCollisionObject_setCollisionFlags(this._btColliderObject,o|P.COLLISIONFLAGS_NO_CONTACT_RESPONSE):0!=(o&P.COLLISIONFLAGS_NO_CONTACT_RESPONSE)&&e.btCollisionObject_setCollisionFlags(this._btColliderObject,o^P.COLLISIONFLAGS_NO_CONTACT_RESPONSE)}}}]),m}(),M=function(t){function p(){return _classCallCheck(this,p),_possibleConstructorReturn(this,_getPrototypeOf(p).call(this))}return _inherits(p,i.SingletonList),_createClass(p,[{key:"add",value:function(t){if(-1!==t._inPhysicUpdateListIndex)throw"PhysicsUpdateList:element has  in  PhysicsUpdateList.";this._add(t),t._inPhysicUpdateListIndex=this.length++}},{key:"remove",value:function(t){var e=t._inPhysicUpdateListIndex;if(this.length--,e!==this.length){var i=this.elements[this.length];this.elements[e]=i,i._inPhysicUpdateListIndex=e}t._inPhysicUpdateListIndex=-1}}]),p}(),w=function(){function g(t){_classCallCheck(this,g),this._gravity=new i.Vector3(0,-10,0),this._btVector3Zero=i.ILaya3D.Physics3D._bullet.btVector3_create(0,0,0),this._btDefaultQuaternion=i.ILaya3D.Physics3D._bullet.btQuaternion_create(0,0,0,-1),this._collisionsUtils=new x,this._previousFrameCollisions=[],this._currentFrameCollisions=[],this._currentConstraint={},this._physicsUpdateList=new M,this._characters=[],this._updatedRigidbodies=0,this.maxSubSteps=1,this.fixedTimeStep=1/60,this.maxSubSteps=t.maxSubSteps,this.fixedTimeStep=t.fixedTimeStep;var e=i.ILaya3D.Physics3D._bullet;this._btCollisionConfiguration=e.btDefaultCollisionConfiguration_create(),this._btDispatcher=e.btCollisionDispatcher_create(this._btCollisionConfiguration),this._btBroadphase=e.btDbvtBroadphase_create(),e.btOverlappingPairCache_setInternalGhostPairCallback(e.btDbvtBroadphase_getOverlappingPairCache(this._btBroadphase),e.btGhostPairCallback_create());var o=t.flags;if(o&g.PHYSICSENGINEFLAGS_COLLISIONSONLY)this._btCollisionWorld=new e.btCollisionWorld(this._btDispatcher,this._btBroadphase,this._btCollisionConfiguration);else{if(o&g.PHYSICSENGINEFLAGS_SOFTBODYSUPPORT)throw"PhysicsSimulation:SoftBody processing is not yet available";var s=e.btSequentialImpulseConstraintSolver_create();this._btDiscreteDynamicsWorld=e.btDiscreteDynamicsWorld_create(this._btDispatcher,this._btBroadphase,s,this._btCollisionConfiguration),this._btCollisionWorld=this._btDiscreteDynamicsWorld}this._btDiscreteDynamicsWorld&&(this._btSolverInfo=e.btDynamicsWorld_getSolverInfo(this._btDiscreteDynamicsWorld),this._btDispatchInfo=e.btCollisionWorld_getDispatchInfo(this._btDiscreteDynamicsWorld)),this._btClosestRayResultCallback=e.ClosestRayResultCallback_create(this._btVector3Zero,this._btVector3Zero),this._btAllHitsRayResultCallback=e.AllHitsRayResultCallback_create(this._btVector3Zero,this._btVector3Zero),this._btClosestConvexResultCallback=e.ClosestConvexResultCallback_create(this._btVector3Zero,this._btVector3Zero),this._btAllConvexResultCallback=e.AllConvexResultCallback_create(this._btVector3Zero,this._btVector3Zero),this.setHitsRayResultCallbackFlag(),e.btGImpactCollisionAlgorithm_RegisterAlgorithm(this._btDispatcher)}return _createClass(g,[{key:"_simulate",value:function(t){this._updatedRigidbodies=0;var e=i.ILaya3D.Physics3D._bullet;this._btDiscreteDynamicsWorld?e.btDiscreteDynamicsWorld_stepSimulation(this._btDiscreteDynamicsWorld,t,this.maxSubSteps,this.fixedTimeStep):e.PerformDiscreteCollisionDetection(this._btCollisionWorld)}},{key:"_destroy",value:function(){var t=i.ILaya3D.Physics3D._bullet;this._btDiscreteDynamicsWorld?(t.btCollisionWorld_destroy(this._btDiscreteDynamicsWorld),this._btDiscreteDynamicsWorld=null):(t.btCollisionWorld_destroy(this._btCollisionWorld),this._btCollisionWorld=null),t.btDbvtBroadphase_destroy(this._btBroadphase),this._btBroadphase=null,t.btCollisionDispatcher_destroy(this._btDispatcher),this._btDispatcher=null,t.btDefaultCollisionConfiguration_destroy(this._btCollisionConfiguration),this._btCollisionConfiguration=null}},{key:"_addPhysicsCollider",value:function(t,e,o){i.ILaya3D.Physics3D._bullet.btCollisionWorld_addCollisionObject(this._btCollisionWorld,t._btColliderObject,e,o)}},{key:"_removePhysicsCollider",value:function(t){i.ILaya3D.Physics3D._bullet.btCollisionWorld_removeCollisionObject(this._btCollisionWorld,t._btColliderObject)}},{key:"_addRigidBody",value:function(t,e,o){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";i.ILaya3D.Physics3D._bullet.btDiscreteDynamicsWorld_addRigidBody(this._btCollisionWorld,t._btColliderObject,e,o)}},{key:"_removeRigidBody",value:function(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";i.ILaya3D.Physics3D._bullet.btDiscreteDynamicsWorld_removeRigidBody(this._btCollisionWorld,t._btColliderObject)}},{key:"_addCharacter",value:function(t,e,o){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";var s=i.ILaya3D.Physics3D._bullet;s.btCollisionWorld_addCollisionObject(this._btCollisionWorld,t._btColliderObject,e,o),s.btDynamicsWorld_addAction(this._btCollisionWorld,t._btKinematicCharacter)}},{key:"_removeCharacter",value:function(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";var e=i.ILaya3D.Physics3D._bullet;e.btCollisionWorld_removeCollisionObject(this._btCollisionWorld,t._btColliderObject),e.btDynamicsWorld_removeAction(this._btCollisionWorld,t._btKinematicCharacter)}},{key:"raycastFromTo",value:function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,r=i.ILaya3D.Physics3D._bullet,a=this._btClosestRayResultCallback,l=g._btTempVector30,_=g._btTempVector31;if(r.btVector3_setValue(l,-t.x,t.y,t.z),r.btVector3_setValue(_,-e.x,e.y,e.z),r.ClosestRayResultCallback_set_m_rayFromWorld(a,l),r.ClosestRayResultCallback_set_m_rayToWorld(a,_),r.RayResultCallback_set_m_collisionFilterGroup(a,s),r.RayResultCallback_set_m_collisionFilterMask(a,n),r.RayResultCallback_set_m_collisionObject(a,null),r.RayResultCallback_set_m_closestHitFraction(a,1),r.btCollisionWorld_rayTest(this._btCollisionWorld,l,_,a),r.RayResultCallback_hasHit(a)){if(o){o.succeeded=!0,o.collider=P._physicObjectsMap[r.btCollisionObject_getUserIndex(r.RayResultCallback_get_m_collisionObject(a))],o.hitFraction=r.RayResultCallback_get_m_closestHitFraction(a);var c=r.ClosestRayResultCallback_get_m_hitPointWorld(a),h=o.point;h.x=-r.btVector3_x(c),h.y=r.btVector3_y(c),h.z=r.btVector3_z(c);var u=r.ClosestRayResultCallback_get_m_hitNormalWorld(a),b=o.normal;b.x=-r.btVector3_x(u),b.y=r.btVector3_y(u),b.z=r.btVector3_z(u)}return!0}return o&&(o.succeeded=!1),!1}},{key:"raycastAllFromTo",value:function(t,e,o){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,r=i.ILaya3D.Physics3D._bullet,a=this._btAllHitsRayResultCallback,l=g._btTempVector30,_=g._btTempVector31;o.length=0,r.btVector3_setValue(l,-t.x,t.y,t.z),r.btVector3_setValue(_,-e.x,e.y,e.z),r.AllHitsRayResultCallback_set_m_rayFromWorld(a,l),r.AllHitsRayResultCallback_set_m_rayToWorld(a,_),r.RayResultCallback_set_m_collisionFilterGroup(a,s),r.RayResultCallback_set_m_collisionFilterMask(a,n);var c=r.AllHitsRayResultCallback_get_m_collisionObjects(a),h=r.AllHitsRayResultCallback_get_m_hitPointWorld(a),u=r.AllHitsRayResultCallback_get_m_hitNormalWorld(a),b=r.AllHitsRayResultCallback_get_m_hitFractions(a);r.tBtCollisionObjectArray_clear(c),r.tVector3Array_clear(h),r.tVector3Array_clear(u),r.tScalarArray_clear(b),r.btCollisionWorld_rayTest(this._btCollisionWorld,l,_,a);var y=r.tBtCollisionObjectArray_size(c);if(y>0){this._collisionsUtils.recoverAllHitResultsPool();for(var d=0;d<y;d++){var C=this._collisionsUtils.getHitResult();o.push(C),C.succeeded=!0,C.collider=P._physicObjectsMap[r.btCollisionObject_getUserIndex(r.tBtCollisionObjectArray_at(c,d))],C.hitFraction=r.tScalarArray_at(b,d);var p=r.tVector3Array_at(h,d),f=C.point;f.x=-r.btVector3_x(p),f.y=r.btVector3_y(p),f.z=r.btVector3_z(p);var m=r.tVector3Array_at(u,d),T=C.normal;T.x=-r.btVector3_x(m),T.y=r.btVector3_y(m),T.z=r.btVector3_z(m)}return!0}return!1}},{key:"rayCast",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2147483647,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,r=t.origin,a=g._tempVector30;return i.Vector3.normalize(t.direction,a),i.Vector3.scale(a,o,a),i.Vector3.add(r,a,a),this.raycastFromTo(r,a,e,s,n)}},{key:"rayCastAll",value:function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2147483647,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,r=t.origin,a=g._tempVector30;return i.Vector3.normalize(t.direction,a),i.Vector3.scale(a,o,a),i.Vector3.add(r,a,a),this.raycastAllFromTo(r,a,e,s,n)}},{key:"shapeCast",value:function(t,e,o){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,_=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c=i.ILaya3D.Physics3D._bullet,h=this._btClosestConvexResultCallback,u=g._btTempVector30,b=g._btTempVector31,y=g._btTempQuaternion0,d=g._btTempQuaternion1,C=g._btTempTransform0,p=g._btTempTransform1,f=t._btShape;if(c.btVector3_setValue(u,-e.x,e.y,e.z),c.btVector3_setValue(b,-o.x,o.y,o.z),c.ConvexResultCallback_set_m_collisionFilterGroup(h,a),c.ConvexResultCallback_set_m_collisionFilterMask(h,l),c.btTransform_setOrigin(C,u),c.btTransform_setOrigin(p,b),n?(c.btQuaternion_setValue(y,-n.x,n.y,n.z,-n.w),c.btTransform_setRotation(C,y)):c.btTransform_setRotation(C,this._btDefaultQuaternion),r?(c.btQuaternion_setValue(d,-r.x,r.y,r.z,-r.w),c.btTransform_setRotation(p,d)):c.btTransform_setRotation(p,this._btDefaultQuaternion),c.ClosestConvexResultCallback_set_m_hitCollisionObject(h,null),c.ConvexResultCallback_set_m_closestHitFraction(h,1),c.btCollisionWorld_convexSweepTest(this._btCollisionWorld,f,C,p,h,_),c.ConvexResultCallback_hasHit(h)){if(s){s.succeeded=!0,s.collider=P._physicObjectsMap[c.btCollisionObject_getUserIndex(c.ClosestConvexResultCallback_get_m_hitCollisionObject(h))],s.hitFraction=c.ConvexResultCallback_get_m_closestHitFraction(h);var m=c.ClosestConvexResultCallback_get_m_hitPointWorld(h),T=c.ClosestConvexResultCallback_get_m_hitNormalWorld(h),O=s.point,I=s.normal;O.x=-c.btVector3_x(m),O.y=c.btVector3_y(m),O.z=c.btVector3_z(m),I.x=-c.btVector3_x(T),I.y=c.btVector3_y(T),I.z=c.btVector3_z(T)}return!0}return s&&(s.succeeded=!1),!1}},{key:"shapeCastAll",value:function(t,e,o,s){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,_=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c=i.ILaya3D.Physics3D._bullet,h=this._btAllConvexResultCallback,u=g._btTempVector30,b=g._btTempVector31,y=g._btTempQuaternion0,d=g._btTempQuaternion1,C=g._btTempTransform0,p=g._btTempTransform1,f=t._btShape;s.length=0,c.btVector3_setValue(u,-e.x,e.y,e.z),c.btVector3_setValue(b,-o.x,o.y,o.z),c.ConvexResultCallback_set_m_collisionFilterGroup(h,a),c.ConvexResultCallback_set_m_collisionFilterMask(h,l),c.btTransform_setOrigin(C,u),c.btTransform_setOrigin(p,b),n?(c.btQuaternion_setValue(y,-n.x,n.y,n.z,-n.w),c.btTransform_setRotation(C,y)):c.btTransform_setRotation(C,this._btDefaultQuaternion),r?(c.btQuaternion_setValue(d,-r.x,r.y,r.z,-r.w),c.btTransform_setRotation(p,d)):c.btTransform_setRotation(p,this._btDefaultQuaternion);var m=c.AllConvexResultCallback_get_m_collisionObjects(h),T=c.AllConvexResultCallback_get_m_hitPointWorld(h),O=c.AllConvexResultCallback_get_m_hitNormalWorld(h),I=c.AllConvexResultCallback_get_m_hitFractions(h);c.tVector3Array_clear(T),c.tVector3Array_clear(O),c.tScalarArray_clear(I),c.tBtCollisionObjectArray_clear(m),c.btCollisionWorld_convexSweepTest(this._btCollisionWorld,f,C,p,h,_);var S=c.tBtCollisionObjectArray_size(m);if(S>0){this._collisionsUtils.recoverAllHitResultsPool();for(var v=0;v<S;v++){var L=this._collisionsUtils.getHitResult();s.push(L),L.succeeded=!0,L.collider=P._physicObjectsMap[c.btCollisionObject_getUserIndex(c.tBtCollisionObjectArray_at(m,v))],L.hitFraction=c.tScalarArray_at(I,v);var D=c.tVector3Array_at(T,v),A=L.point;A.x=-c.btVector3_x(D),A.y=c.btVector3_y(D),A.z=c.btVector3_z(D);var R=c.tVector3Array_at(O,v),N=L.normal;N.x=-c.btVector3_x(R),N.y=c.btVector3_y(R),N.z=c.btVector3_z(R)}return!0}return!1}},{key:"addConstraint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._btDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";i.ILaya3D.Physics3D._bullet.btCollisionWorld_addConstraint(this._btDiscreteDynamicsWorld,t._btConstraint,e),this._currentConstraint[t.id]=t}},{key:"removeConstraint",value:function(t){if(!this._btDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";i.ILaya3D.Physics3D._bullet.btCollisionWorld_removeConstraint(this._btDiscreteDynamicsWorld,t._btConstraint),delete this._currentConstraint[t.id]}},{key:"setHitsRayResultCallbackFlag",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=i.ILaya3D.Physics3D._bullet;e.RayResultCallback_set_m_flags(this._btAllHitsRayResultCallback,t),e.RayResultCallback_set_m_flags(this._btClosestRayResultCallback,t)}},{key:"_updatePhysicsTransformFromRender",value:function(){for(var t=this._physicsUpdateList.elements,e=0,i=this._physicsUpdateList.length;e<i;e++){var o=t[e];o._derivePhysicsTransformation(!1),o._inPhysicUpdateListIndex=-1}this._physicsUpdateList.length=0}},{key:"_updateCharacters",value:function(){for(var t=0,e=this._characters.length;t<e;t++){var o=this._characters[t];o._updateTransformComponent(i.ILaya3D.Physics3D._bullet.btCollisionObject_getWorldTransform(o._btColliderObject))}}},{key:"_updateCollisions",value:function(){this._collisionsUtils.recoverAllContactPointsPool();var t=this._currentFrameCollisions;this._currentFrameCollisions=this._previousFrameCollisions,this._currentFrameCollisions.length=0,this._previousFrameCollisions=t;for(var e=i.Stat.loopCount,o=i.ILaya3D.Physics3D._bullet,s=o.btDispatcher_getNumManifolds(this._btDispatcher),n=0;n<s;n++){var r,a=o.btDispatcher_getManifoldByIndexInternal(this._btDispatcher,n),l=P._physicObjectsMap[o.btCollisionObject_getUserIndex(o.btPersistentManifold_getBody0(a))],_=P._physicObjectsMap[o.btCollisionObject_getUserIndex(o.btPersistentManifold_getBody1(a))],c=null,h=null;if((l.isTrigger||_.isTrigger)&&(l.owner._needProcessTriggers||_.owner._needProcessTriggers))for(var u=o.btPersistentManifold_getNumContacts(a),b=0;b<u;b++){var y=o.btPersistentManifold_getContactPoint(a,b),d=o.btManifoldPoint_getDistance(y);if(d<=0){h=(c=this._collisionsUtils.getCollision(l,_)).contacts,(r=c._updateFrame!==e)&&(c._isTrigger=!0,h.length=0);break}}else if((l.owner._needProcessCollisions||_.owner._needProcessCollisions)&&(l._enableProcessCollisions||_._enableProcessCollisions))for(u=o.btPersistentManifold_getNumContacts(a),b=0;b<u;b++)if(y=o.btPersistentManifold_getContactPoint(a,b),(d=o.btManifoldPoint_getDistance(y))<=0){var C=this._collisionsUtils.getContactPoints();C.colliderA=l,C.colliderB=_,C.distance=d;var p=o.btManifoldPoint_get_m_normalWorldOnB(y),g=C.normal;g.x=-o.btVector3_x(p),g.y=o.btVector3_y(p),g.z=o.btVector3_z(p);var f=o.btManifoldPoint_get_m_positionWorldOnA(y),m=C.positionOnA;m.x=-o.btVector3_x(f),m.y=o.btVector3_y(f),m.z=o.btVector3_z(f);var T=o.btManifoldPoint_get_m_positionWorldOnB(y),O=C.positionOnB;O.x=-o.btVector3_x(T),O.y=o.btVector3_y(T),O.z=o.btVector3_z(T),c||(h=(c=this._collisionsUtils.getCollision(l,_)).contacts,(r=c._updateFrame!==e)&&(c._isTrigger=!1,h.length=0)),h.push(C)}c&&r&&(this._currentFrameCollisions.push(c),c._setUpdateFrame(e))}}},{key:"_eventScripts",value:function(){for(var t=i.Stat.loopCount,e=0,o=this._currentFrameCollisions.length;e<o;e++){var s=this._currentFrameCollisions[e],n=s._colliderA,r=s._colliderB;if(!n.destroyed&&!r.destroyed)if(t-s._lastUpdateFrame==1){var a=n.owner,l=a._scripts;if(l)if(s._isTrigger){if(a._needProcessTriggers)for(var _=0,c=l.length;_<c;_++)l[_].onTriggerStay(r)}else if(a._needProcessCollisions)for(_=0,c=l.length;_<c;_++)s.other=r,l[_].onCollisionStay(s);var h=r.owner,u=h._scripts;if(u)if(s._isTrigger){if(h._needProcessTriggers)for(_=0,c=u.length;_<c;_++)u[_].onTriggerStay(n)}else if(h._needProcessCollisions)for(_=0,c=u.length;_<c;_++)s.other=n,u[_].onCollisionStay(s)}else{if(l=(a=n.owner)._scripts)if(s._isTrigger){if(a._needProcessTriggers)for(_=0,c=l.length;_<c;_++)l[_].onTriggerEnter(r)}else if(a._needProcessCollisions)for(_=0,c=l.length;_<c;_++)s.other=r,l[_].onCollisionEnter(s);if(u=(h=r.owner)._scripts)if(s._isTrigger){if(h._needProcessTriggers)for(_=0,c=u.length;_<c;_++)u[_].onTriggerEnter(n)}else if(h._needProcessCollisions)for(_=0,c=u.length;_<c;_++)s.other=n,u[_].onCollisionEnter(s)}}for(e=0,o=this._previousFrameCollisions.length;e<o;e++){var b=this._previousFrameCollisions[e],y=b._colliderA,d=b._colliderB;if(!y.destroyed&&!d.destroyed&&t-b._updateFrame==1){if(this._collisionsUtils.recoverCollision(b),l=(a=y.owner)._scripts)if(b._isTrigger){if(a._needProcessTriggers)for(_=0,c=l.length;_<c;_++)l[_].onTriggerExit(d)}else if(a._needProcessCollisions)for(_=0,c=l.length;_<c;_++)b.other=d,l[_].onCollisionExit(b);if(u=(h=d.owner)._scripts)if(b._isTrigger){if(h._needProcessTriggers)for(_=0,c=u.length;_<c;_++)u[_].onTriggerExit(y)}else if(h._needProcessCollisions)for(_=0,c=u.length;_<c;_++)b.other=y,u[_].onCollisionExit(b)}}for(var C in this._currentConstraint){var p=this._currentConstraint[C],g=p.owner._scripts;if(p.enabled&&p._isBreakConstrained()&&g&&0!=g.length)for(e=0,o=g.length;e<o;e++)g[e].onJointBreak()}}},{key:"clearForces",value:function(){if(!this._btDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";i.ILaya3D.Physics3D._bullet.btDiscreteDynamicsWorld_clearForces(this._btDiscreteDynamicsWorld)}},{key:"continuousCollisionDetection",get:function(){return i.ILaya3D.Physics3D._bullet.btCollisionWorld_get_m_useContinuous(this._btDispatchInfo)},set:function(t){i.ILaya3D.Physics3D._bullet.btCollisionWorld_set_m_useContinuous(this._btDispatchInfo,t)}},{key:"gravity",get:function(){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";return this._gravity},set:function(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";this._gravity=t;var e=i.ILaya3D.Physics3D._bullet,o=g._btTempVector30;e.btVector3_setValue(o,-t.x,t.y,t.z),e.btDiscreteDynamicsWorld_setGravity(this._btDiscreteDynamicsWorld,o)}},{key:"speculativeContactRestitution",get:function(){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot Cannot perform this action when the physics engine is set to CollisionsOnly";return i.ILaya3D.Physics3D._bullet.btDiscreteDynamicsWorld_getApplySpeculativeContactRestitution(this._btDiscreteDynamicsWorld)},set:function(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot Cannot perform this action when the physics engine is set to CollisionsOnly";i.ILaya3D.Physics3D._bullet.btDiscreteDynamicsWorld_setApplySpeculativeContactRestitution(this._btDiscreteDynamicsWorld,t)}}],[{key:"__init__",value:function(){var t=i.ILaya3D.Physics3D._bullet;g._btTempVector30=t.btVector3_create(0,0,0),g._btTempVector31=t.btVector3_create(0,0,0),g._btTempQuaternion0=t.btQuaternion_create(0,0,0,1),g._btTempQuaternion1=t.btQuaternion_create(0,0,0,1),g._btTempTransform0=t.btTransform_create(),g._btTempTransform1=t.btTransform_create()}},{key:"createConstraint",value:function(){}}]),g}();w.PHYSICSENGINEFLAGS_NONE=0,w.PHYSICSENGINEFLAGS_COLLISIONSONLY=1,w.PHYSICSENGINEFLAGS_SOFTBODYSUPPORT=2,w.PHYSICSENGINEFLAGS_MULTITHREADED=4,w.PHYSICSENGINEFLAGS_USEHARDWAREWHENPOSSIBLE=8,w.SOLVERMODE_RANDMIZE_ORDER=1,w.SOLVERMODE_FRICTION_SEPARATE=2,w.SOLVERMODE_USE_WARMSTARTING=4,w.SOLVERMODE_USE_2_FRICTION_DIRECTIONS=16,w.SOLVERMODE_ENABLE_FRICTION_DIRECTION_CACHING=32,w.SOLVERMODE_DISABLE_VELOCITY_DEPENDENT_FRICTION_DIRECTION=64,w.SOLVERMODE_CACHE_FRIENDLY=128,w.SOLVERMODE_SIMD=256,w.SOLVERMODE_INTERLEAVE_CONTACT_AND_FRICTION_CONSTRAINTS=512,w.SOLVERMODE_ALLOW_ZERO_LENGTH_FRICTION_DIRECTIONS=1024,w.HITSRAYRESULTCALLBACK_FLAG_NONE=0,w.HITSRAYRESULTCALLBACK_FLAG_FILTERBACKFACESS=1,w.HITSRAYRESULTCALLBACK_FLAG_KEEPUNFILIPPEDNORMAL=2,w.HITSRAYRESULTCALLBACK_FLAG_USESUBSIMPLEXCONVEXCASTRAYTEST=4,w.HITSRAYRESULTCALLBACK_FLAG_USEGJKCONVEXCASTRAYTEST=8,w.HITSRAYRESULTCALLBACK_FLAG_TERMINATOR=4294967295,w._tempVector30=new i.Vector3,w.disableSimulation=!1;var j=function(t){function T(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.Physics3DUtils.COLLISIONFILTERGROUP_DEFAULTFILTER,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER;return _classCallCheck(this,T),(t=_possibleConstructorReturn(this,_getPrototypeOf(T).call(this,e,o)))._isKinematic=!1,t._mass=1,t._gravity=new i.Vector3(0,-10,0),t._angularDamping=0,t._linearDamping=0,t._overrideGravity=!1,t._totalTorque=new i.Vector3(0,0,0),t._totalForce=new i.Vector3(0,0,0),t._linearVelocity=new i.Vector3,t._angularVelocity=new i.Vector3,t._linearFactor=new i.Vector3(1,1,1),t._angularFactor=new i.Vector3(1,1,1),t._detectCollisions=!0,t._controlBySimulation=!0,t}return _inherits(T,B),_createClass(T,[{key:"_updateMass",value:function(t){if(this._btColliderObject&&this._colliderShape){var e=i.ILaya3D.Physics3D._bullet;e.btCollisionShape_calculateLocalInertia(this._colliderShape._btShape,t,T._btInertia),e.btRigidBody_setMassProps(this._btColliderObject,t,T._btInertia),e.btRigidBody_updateInertiaTensor(this._btColliderObject)}}},{key:"_onScaleChange",value:function(t){_get(_getPrototypeOf(T.prototype),"_onScaleChange",this).call(this,t),this._updateMass(this._isKinematic?0:this._mass)}},{key:"_derivePhysicsTransformation",value:function(t){var e=i.ILaya3D.Physics3D._bullet,o=this._btColliderObject,s=e.btCollisionObject_getWorldTransform(o),n=T._btTransform0;e.btTransform_equal(n,s),this._innerDerivePhysicsTransformation(n,t),e.btRigidBody_setCenterOfMassTransform(o,n)}},{key:"_onAdded",value:function(){var t=i.ILaya3D.Physics3D._bullet,e=t.layaMotionState_create();t.layaMotionState_set_rigidBodyID(e,this._id),this._btLayaMotionState=e;var o=t.btRigidBodyConstructionInfo_create(0,e,null,T._btVector3Zero),s=t.btRigidBody_create(o);t.btCollisionObject_setUserIndex(s,this.id),this._btColliderObject=s,_get(_getPrototypeOf(T.prototype),"_onAdded",this).call(this),this.mass=this._mass,this.linearFactor=this._linearFactor,this.angularFactor=this._angularFactor,this.linearDamping=this._linearDamping,this.angularDamping=this._angularDamping,this.overrideGravity=this._overrideGravity,this.gravity=this._gravity,this.isKinematic=this._isKinematic,t.btRigidBodyConstructionInfo_destroy(o)}},{key:"_onEnable",value:function(){_get(_getPrototypeOf(T.prototype),"_onEnable",this).call(this),this._constaintRigidbodyA&&this._constaintRigidbodyA.connectedBody._simulation&&(this._constaintRigidbodyA._createConstraint(),this._constaintRigidbodyA._onEnable()),this._constaintRigidbodyB&&this._constaintRigidbodyB.ownBody._simulation&&(this._constaintRigidbodyB._createConstraint(),this._constaintRigidbodyB._onEnable())}},{key:"_onShapeChange",value:function(t){if(_get(_getPrototypeOf(T.prototype),"_onShapeChange",this).call(this,t),this._isKinematic)this._updateMass(0);else{var e=i.ILaya3D.Physics3D._bullet;e.btRigidBody_setCenterOfMassTransform(this._btColliderObject,e.btCollisionObject_getWorldTransform(this._btColliderObject)),this._updateMass(this._mass)}}},{key:"_parse",value:function(t){if(null!=t.friction&&(this.friction=t.friction),null!=t.rollingFriction&&(this.rollingFriction=t.rollingFriction),null!=t.restitution&&(this.restitution=t.restitution),null!=t.isTrigger&&(this.isTrigger=t.isTrigger),null!=t.mass&&(this.mass=t.mass),null!=t.linearDamping&&(this.linearDamping=t.linearDamping),null!=t.angularDamping&&(this.angularDamping=t.angularDamping),null!=t.overrideGravity&&(this.overrideGravity=t.overrideGravity),null!=t.linearFactor){var e=this.linearFactor;e.fromArray(t.linearFactor),this.linearFactor=e}if(null!=t.angularFactor){var i=this.angularFactor;i.fromArray(t.angularFactor),this.angularFactor=i}if(t.gravity){var o=this.gravity;o.fromArray(t.gravity),this.gravity=o}_get(_getPrototypeOf(T.prototype),"_parse",this).call(this,t),this._parseShape(t.shapes),null!=t.isKinematic&&(this.isKinematic=t.isKinematic)}},{key:"_onDestroy",value:function(){i.ILaya3D.Physics3D._bullet.btMotionState_destroy(this._btLayaMotionState),_get(_getPrototypeOf(T.prototype),"_onDestroy",this).call(this),this._btLayaMotionState=null,this._gravity=null,this._totalTorque=null,this._linearVelocity=null,this._angularVelocity=null,this._linearFactor=null,this._angularFactor=null,this.constaintRigidbodyA&&this.constaintRigidbodyA._breakConstrained(),this.constaintRigidbodyB&&(this.constaintRigidbodyB.connectedBody=null,this.constaintRigidbodyB._onDisable())}},{key:"_addToSimulation",value:function(){this._simulation._addRigidBody(this,this._collisionGroup,this._detectCollisions?this._canCollideWith:0)}},{key:"_removeFromSimulation",value:function(){this._simulation._removeRigidBody(this)}},{key:"_cloneTo",value:function(t){_get(_getPrototypeOf(T.prototype),"_cloneTo",this).call(this,t);var e=t;e.isKinematic=this._isKinematic,e.mass=this._mass,e.gravity=this._gravity,e.angularDamping=this._angularDamping,e.linearDamping=this._linearDamping,e.overrideGravity=this._overrideGravity,e.linearVelocity=this._linearVelocity,e.angularVelocity=this._angularVelocity,e.linearFactor=this._linearFactor,e.angularFactor=this._angularFactor,e.detectCollisions=this._detectCollisions}},{key:"applyForce",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var o=i.ILaya3D.Physics3D._bullet,s=T._btTempVector30;if(o.btVector3_setValue(s,-t.x,t.y,t.z),e){var n=T._btTempVector31;o.btVector3_setValue(n,-e.x,e.y,e.z),o.btRigidBody_applyForce(this._btColliderObject,s,n)}else o.btRigidBody_applyCentralForce(this._btColliderObject,s)}},{key:"applyTorque",value:function(t){if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var e=i.ILaya3D.Physics3D._bullet,o=T._btTempVector30;e.btVector3_setValue(o,-t.x,t.y,t.z),e.btRigidBody_applyTorque(this._btColliderObject,o)}},{key:"applyImpulse",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var o=i.ILaya3D.Physics3D._bullet;o.btVector3_setValue(T._btImpulse,-t.x,t.y,t.z),e?(o.btVector3_setValue(T._btImpulseOffset,-e.x,e.y,e.z),o.btRigidBody_applyImpulse(this._btColliderObject,T._btImpulse,T._btImpulseOffset)):o.btRigidBody_applyCentralImpulse(this._btColliderObject,T._btImpulse)}},{key:"applyTorqueImpulse",value:function(t){if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var e=i.ILaya3D.Physics3D._bullet,o=T._btTempVector30;e.btVector3_setValue(o,-t.x,t.y,t.z),e.btRigidBody_applyTorqueImpulse(this._btColliderObject,o)}},{key:"wakeUp",value:function(){this._btColliderObject&&i.ILaya3D.Physics3D._bullet.btCollisionObject_activate(this._btColliderObject,!1)}},{key:"clearForces",value:function(){var t=this._btColliderObject;if(null==t)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var e=i.ILaya3D.Physics3D._bullet;e.btRigidBody_clearForces(t);var o=T._btVector3Zero;e.btCollisionObject_setInterpolationLinearVelocity(t,o),e.btRigidBody_setLinearVelocity(t,o),e.btCollisionObject_setInterpolationAngularVelocity(t,o),e.btRigidBody_setAngularVelocity(t,o)}},{key:"mass",get:function(){return this._mass},set:function(t){t=Math.max(t,1e-7),this._mass=t,this._isKinematic||this._updateMass(t)}},{key:"isKinematic",get:function(){return this._isKinematic},set:function(t){this._isKinematic=t,this._controlBySimulation=!t;var e=i.ILaya3D.Physics3D._bullet,o=!!(this._simulation&&this._enabled&&this._colliderShape);o&&this._removeFromSimulation();var s=this._btColliderObject,n=e.btCollisionObject_getCollisionFlags(s);t?(n|=P.COLLISIONFLAGS_KINEMATIC_OBJECT,e.btCollisionObject_setCollisionFlags(s,n),e.btCollisionObject_forceActivationState(this._btColliderObject,P.ACTIVATIONSTATE_DISABLE_DEACTIVATION),this._enableProcessCollisions=!1,this._updateMass(0)):((n&P.COLLISIONFLAGS_KINEMATIC_OBJECT)>0&&(n^=P.COLLISIONFLAGS_KINEMATIC_OBJECT),e.btCollisionObject_setCollisionFlags(s,n),e.btCollisionObject_setActivationState(this._btColliderObject,P.ACTIVATIONSTATE_ACTIVE_TAG),this._enableProcessCollisions=!0,this._updateMass(this._mass));var r=T._btVector3Zero;e.btCollisionObject_setInterpolationLinearVelocity(s,r),e.btRigidBody_setLinearVelocity(s,r),e.btCollisionObject_setInterpolationAngularVelocity(s,r),e.btRigidBody_setAngularVelocity(s,r),o&&this._addToSimulation()}},{key:"linearDamping",get:function(){return this._linearDamping},set:function(t){this._linearDamping=t,this._btColliderObject&&i.ILaya3D.Physics3D._bullet.btRigidBody_setDamping(this._btColliderObject,t,this._angularDamping)}},{key:"angularDamping",get:function(){return this._angularDamping},set:function(t){this._angularDamping=t,this._btColliderObject&&i.ILaya3D.Physics3D._bullet.btRigidBody_setDamping(this._btColliderObject,this._linearDamping,t)}},{key:"overrideGravity",get:function(){return this._overrideGravity},set:function(t){this._overrideGravity=t;var e=i.ILaya3D.Physics3D._bullet;if(this._btColliderObject){var o=e.btRigidBody_getFlags(this._btColliderObject);t?0==(o&T._BT_DISABLE_WORLD_GRAVITY)&&e.btRigidBody_setFlags(this._btColliderObject,o|T._BT_DISABLE_WORLD_GRAVITY):(o&T._BT_DISABLE_WORLD_GRAVITY)>0&&e.btRigidBody_setFlags(this._btColliderObject,o^T._BT_DISABLE_WORLD_GRAVITY)}}},{key:"gravity",get:function(){var t=i.ILaya3D.Physics3D._bullet;return T._btGravity=t.btRigidBody_getGravity(this._btColliderObject),i.Utils3D._convertToLayaVec3(T._btGravity,this._gravity,!0),this._gravity},set:function(t){this._gravity=t;var e=i.ILaya3D.Physics3D._bullet;e.btVector3_setValue(T._btGravity,-t.x,t.y,t.z),e.btRigidBody_setGravity(this._btColliderObject,T._btGravity)}},{key:"totalForce",get:function(){if(this._btColliderObject){var t=i.ILaya3D.Physics3D._bullet.btRigidBody_getTotalForce(this._btColliderObject);return i.Utils3D._convertToLayaVec3(t,this._totalForce,!0),this._totalForce}return null}},{key:"linearFactor",get:function(){return this._linearFactor},set:function(t){this._linearFactor=t;var e=T._btTempVector30;i.Utils3D._convertToBulletVec3(t,e,!1),i.ILaya3D.Physics3D._bullet.btRigidBody_setLinearFactor(this._btColliderObject,e)}},{key:"linearVelocity",get:function(){return this._btColliderObject&&i.Utils3D._convertToLayaVec3(i.ILaya3D.Physics3D._bullet.btRigidBody_getLinearVelocity(this._btColliderObject),this._linearVelocity,!0),this._linearVelocity},set:function(t){if(this._linearVelocity=t,this._btColliderObject){var e=T._btTempVector30;i.Utils3D._convertToBulletVec3(t,e,!0),this.isSleeping&&this.wakeUp(),i.ILaya3D.Physics3D._bullet.btRigidBody_setLinearVelocity(this._btColliderObject,e)}}},{key:"angularFactor",get:function(){return this._angularFactor},set:function(t){this._angularFactor=t;var e=T._btTempVector30;i.Utils3D._convertToBulletVec3(t,e,!1),i.ILaya3D.Physics3D._bullet.btRigidBody_setAngularFactor(this._btColliderObject,e)}},{key:"angularVelocity",get:function(){return this._btColliderObject&&i.Utils3D._convertToLayaVec3(i.ILaya3D.Physics3D._bullet.btRigidBody_getAngularVelocity(this._btColliderObject),this._angularVelocity,!0),this._angularVelocity},set:function(t){if(this._angularVelocity=t,this._btColliderObject){var e=T._btTempVector30;i.Utils3D._convertToBulletVec3(t,e,!0),this.isSleeping&&this.wakeUp(),i.ILaya3D.Physics3D._bullet.btRigidBody_setAngularVelocity(this._btColliderObject,e)}}},{key:"totalTorque",get:function(){if(this._btColliderObject){var t=i.ILaya3D.Physics3D._bullet.btRigidBody_getTotalTorque(this._btColliderObject);return i.Utils3D._convertToLayaVec3(t,this._totalTorque,!0),this._totalTorque}return null}},{key:"detectCollisions",get:function(){return this._detectCollisions},set:function(t){this._detectCollisions!==t&&(this._detectCollisions=t,this._colliderShape&&this._enabled&&this._simulation&&(this._simulation._removeRigidBody(this),this._simulation._addRigidBody(this,this._collisionGroup,t?this._canCollideWith:0)))}},{key:"isSleeping",get:function(){return!!this._btColliderObject&&i.ILaya3D.Physics3D._bullet.btCollisionObject_getActivationState(this._btColliderObject)===P.ACTIVATIONSTATE_ISLAND_SLEEPING}},{key:"sleepLinearVelocity",get:function(){return i.ILaya3D.Physics3D._bullet.btRigidBody_getLinearSleepingThreshold(this._btColliderObject)},set:function(t){var e=i.ILaya3D.Physics3D._bullet;e.btRigidBody_setSleepingThresholds(this._btColliderObject,t,e.btRigidBody_getAngularSleepingThreshold(this._btColliderObject))}},{key:"sleepAngularVelocity",get:function(){return i.ILaya3D.Physics3D._bullet.btRigidBody_getAngularSleepingThreshold(this._btColliderObject)},set:function(t){var e=i.ILaya3D.Physics3D._bullet;e.btRigidBody_setSleepingThresholds(this._btColliderObject,e.btRigidBody_getLinearSleepingThreshold(this._btColliderObject),t)}},{key:"btColliderObject",get:function(){return this._btColliderObject}},{key:"constaintRigidbodyA",set:function(t){this._constaintRigidbodyA=t},get:function(){return this._constaintRigidbodyA}},{key:"constaintRigidbodyB",set:function(t){this._constaintRigidbodyB=t},get:function(){return this._constaintRigidbodyB}}],[{key:"__init__",value:function(){var t=i.ILaya3D.Physics3D._bullet;T._btTempVector30=t.btVector3_create(0,0,0),T._btTempVector31=t.btVector3_create(0,0,0),T._btVector3Zero=t.btVector3_create(0,0,0),T._btInertia=t.btVector3_create(0,0,0),T._btImpulse=t.btVector3_create(0,0,0),T._btImpulseOffset=t.btVector3_create(0,0,0),T._btGravity=t.btVector3_create(0,0,0),T._btTransform0=t.btTransform_create()}}]),T}();j.TYPE_STATIC=0,j.TYPE_DYNAMIC=1,j.TYPE_KINEMATIC=2,j._BT_DISABLE_WORLD_GRAVITY=1,j._BT_ENABLE_GYROPSCOPIC_FORCE=2;var U=function(t){function S(t){var e;_classCallCheck(this,S),(e=_possibleConstructorReturn(this,_getPrototypeOf(S).call(this)))._anchor=new i.Vector3,e._connectAnchor=new i.Vector3,e._feedbackEnabled=!1,e._getJointFeedBack=!1,e._currentForce=new i.Vector3,e._currentTorque=new i.Vector3,e._constraintType=t;var o=i.Physics3D._bullet;return e._btframATrans=o.btTransform_create(),e._btframBTrans=o.btTransform_create(),o.btTransform_setIdentity(e._btframATrans),o.btTransform_setIdentity(e._btframBTrans),e._btframAPos=o.btVector3_create(0,0,0),e._btframBPos=o.btVector3_create(0,0,0),o.btTransform_setOrigin(e._btframATrans,e._btframAPos),o.btTransform_setOrigin(e._btframBTrans,e._btframBPos),e._breakForce=-1,e._breakTorque=-1,e}return _inherits(S,i.Component),_createClass(S,[{key:"setOverrideNumSolverIterations",value:function(t){i.Physics3D._bullet.btTypedConstraint_setOverrideNumSolverIterations(this._btConstraint,t)}},{key:"setConstraintEnabled",value:function(t){i.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,t)}},{key:"_onEnable",value:function(){_get(_getPrototypeOf(S.prototype),"_onEnable",this).call(this),this.enabled=!0}},{key:"_onDisable",value:function(){_get(_getPrototypeOf(S.prototype),"_onDisable",this).call(this),this.enabled=!1}},{key:"setFrames",value:function(){var t=i.Physics3D._bullet;t.btVector3_setValue(this._btframAPos,-this._anchor.x,this.anchor.y,this.anchor.z),t.btVector3_setValue(this._btframBPos,-this._connectAnchor.x,this._connectAnchor.y,this._connectAnchor.z),t.btTransform_setOrigin(this._btframATrans,this._btframAPos),t.btTransform_setOrigin(this._btframBTrans,this._btframBPos)}},{key:"_addToSimulation",value:function(){}},{key:"_removeFromSimulation",value:function(){}},{key:"_createConstraint",value:function(){}},{key:"setConnectRigidBody",value:function(t,e){var i=t&&!!(t._simulation&&t._enabled&&t.colliderShape),o=e&&!!(e._simulation&&e._enabled&&e.colliderShape);if(!i||!o)throw"ownerRigid or connectRigidBody is not in Simulation";t==this._ownBody&&e==this._connectedBody||(!(!this.enabled||!this._simulation)&&this._removeFromSimulation(),this._ownBody=t,this._connectedBody=e,this._ownBody.constaintRigidbodyA=this,this._connectedBody.constaintRigidbodyB=this,this._createConstraint())}},{key:"getcurrentForce",value:function(t){if(!this._btJointFeedBackObj)throw"this Constraint is not simulation";var e=i.Physics3D._bullet,o=e.btJointFeedback_getAppliedForceBodyA(this._btJointFeedBackObj);t.setValue(e.btVector3_x(o),e.btVector3_y(o),e.btVector3_z(o))}},{key:"getcurrentTorque",value:function(t){if(!this._btJointFeedBackObj)throw"this Constraint is not simulation";var e=i.Physics3D._bullet,o=e.btJointFeedback_getAppliedTorqueBodyA(this._btJointFeedBackObj);t.setValue(e.btVector3_x(o),e.btVector3_y(o),e.btVector3_z(o))}},{key:"_onDestroy",value:function(){var t=i.Physics3D._bullet;this._simulation&&this._removeFromSimulation(),this._btConstraint&&this._btJointFeedBackObj&&this._simulation&&(t.btTypedConstraint_destroy(this._btConstraint),t.btJointFeedback_destroy(this._btJointFeedBackObj),this._btJointFeedBackObj=null,this._btConstraint=null),_get(_getPrototypeOf(S.prototype),"_onDisable",this).call(this)}},{key:"_isBreakConstrained",value:function(){if(this._getJointFeedBack=!1,-1==this.breakForce&&-1==this.breakTorque)return!1;this._getFeedBackInfo();var t=-1!=this._breakForce&&i.Vector3.scalarLength(this._currentForce)>this._breakForce,e=-1!=this._breakTorque&&i.Vector3.scalarLength(this._currentTorque)>this._breakTorque;return!(!t&&!e||(this._breakConstrained(),0))}},{key:"_parse",value:function(t){this._anchor.fromArray(t.anchor),this._connectAnchor.fromArray(t.connectAnchor),this.setFrames()}},{key:"_getFeedBackInfo",value:function(){var t=i.Physics3D._bullet,e=t.btJointFeedback_getAppliedForceBodyA(this._btJointFeedBackObj),o=t.btJointFeedback_getAppliedTorqueBodyA(this._btJointFeedBackObj);this._currentTorque.setValue(t.btVector3_x(o),t.btVector3_y(o),t.btVector3_z(o)),this._currentForce.setValue(t.btVector3_x(e),t.btVector3_y(e),t.btVector3_z(e)),this._getJointFeedBack=!0}},{key:"_breakConstrained",value:function(){this.ownBody.constaintRigidbodyA=null,this.connectedBody&&(this.connectedBody.constaintRigidbodyB=null),this.destroy()}},{key:"enabled",get:function(){return _get(_getPrototypeOf(S.prototype),"enabled",this)},set:function(t){_set(_getPrototypeOf(S.prototype),"enabled",t,this,!0)}},{key:"appliedImpulse",get:function(){return this._feedbackEnabled||(this._btConstraint.EnableFeedback(!0),this._feedbackEnabled=!0),this._btConstraint.AppliedImpulse}},{key:"connectedBody",set:function(t){this._connectedBody=t,t&&(t.constaintRigidbodyB=this)},get:function(){return this._connectedBody}},{key:"ownBody",get:function(){return this._ownBody},set:function(t){this._ownBody=t,t.constaintRigidbodyA=this}},{key:"currentForce",get:function(){return this._getJointFeedBack||this._getFeedBackInfo(),this._currentForce}},{key:"currentTorque",get:function(){return this._getJointFeedBack||this._getFeedBackInfo(),this._currentTorque}},{key:"breakForce",get:function(){return this._breakForce},set:function(t){this._breakForce=t}},{key:"breakTorque",get:function(){return this._breakTorque},set:function(t){this._breakTorque=t}},{key:"anchor",set:function(t){t.cloneTo(this._anchor),this.setFrames()},get:function(){return this._anchor}},{key:"connectAnchor",set:function(t){t.cloneTo(this._connectAnchor),this.setFrames()},get:function(){return this._connectAnchor}}]),S}();U.CONSTRAINT_POINT2POINT_CONSTRAINT_TYPE=3,U.CONSTRAINT_HINGE_CONSTRAINT_TYPE=4,U.CONSTRAINT_CONETWIST_CONSTRAINT_TYPE=5,U.CONSTRAINT_D6_CONSTRAINT_TYPE=6,U.CONSTRAINT_SLIDER_CONSTRAINT_TYPE=7,U.CONSTRAINT_CONTACT_CONSTRAINT_TYPE=8,U.CONSTRAINT_D6_SPRING_CONSTRAINT_TYPE=9,U.CONSTRAINT_GEAR_CONSTRAINT_TYPE=10,U.CONSTRAINT_FIXED_CONSTRAINT_TYPE=11,U.CONSTRAINT_MAX_CONSTRAINT_TYPE=12,U.CONSTRAINT_CONSTRAINT_ERP=1,U.CONSTRAINT_CONSTRAINT_STOP_ERP=2,U.CONSTRAINT_CONSTRAINT_CFM=3,U.CONSTRAINT_CONSTRAINT_STOP_CFM=4,U.tempForceV3=new i.Vector3;var G=function(t){function I(){var t;_classCallCheck(this,I),(t=_possibleConstructorReturn(this,_getPrototypeOf(I).call(this,U.CONSTRAINT_D6_SPRING_CONSTRAINT_TYPE)))._axis=new i.Vector3,t._secondaryAxis=new i.Vector3,t._minLinearLimit=new i.Vector3,t._maxLinearLimit=new i.Vector3,t._minAngularLimit=new i.Vector3,t._maxAngularLimit=new i.Vector3,t._linearLimitSpring=new i.Vector3,t._angularLimitSpring=new i.Vector3,t._linearBounce=new i.Vector3,t._angularBounce=new i.Vector3,t._linearDamp=new i.Vector3,t._angularDamp=new i.Vector3,t._xMotion=0,t._yMotion=0,t._zMotion=0,t._angularXMotion=0,t._angularYMotion=0,t._angularZMotion=0;var e=i.Physics3D._bullet;return t._btAxis=e.btVector3_create(-1,0,0),t._btSecondaryAxis=e.btVector3_create(0,1,0),t}return _inherits(I,U),_createClass(I,[{key:"setAxis",value:function(t,e){if(this._btConstraint){var o=i.Physics3D._bullet;this._axis.setValue(t.x,t.y,t.y),this._secondaryAxis.setValue(e.x,e.y,e.z),this._btAxis=o.btVector3_setValue(-t.x,t.y,t.z),this._btSecondaryAxis=o.btVector3_setValue(-e.x,e.y,e.z),o.btGeneric6DofSpring2Constraint_setAxis(this._btConstraint,this._btAxis,this._btSecondaryAxis)}}},{key:"setLimit",value:function(t,e,o,s){if(this._btConstraint){var n=i.Physics3D._bullet;switch(e){case I.CONFIG_MOTION_TYPE_LOCKED:n.btGeneric6DofSpring2Constraint_setLimit(this._btConstraint,t,0,0);break;case I.CONFIG_MOTION_TYPE_LIMITED:o<s&&n.btGeneric6DofSpring2Constraint_setLimit(this._btConstraint,t,o,s);break;case I.CONFIG_MOTION_TYPE_FREE:n.btGeneric6DofSpring2Constraint_setLimit(this._btConstraint,t,1,0);break;default:throw"No Type of Axis Motion"}}}},{key:"setSpring",value:function(t,e){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._btConstraint){var s=i.Physics3D._bullet,n=e>0;s.btGeneric6DofSpring2Constraint_enableSpring(this._btConstraint,t,n),n&&s.btGeneric6DofSpring2Constraint_setStiffness(this._btConstraint,t,e,o)}}},{key:"setBounce",value:function(t,e){this._btConstraint&&(e=e<=0?0:e,i.Physics3D._bullet.btGeneric6DofSpring2Constraint_setBounce(this._btConstraint,t,e))}},{key:"setDamping",value:function(t,e){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._btConstraint&&(e=e<=0?0:e,i.Physics3D._bullet.btGeneric6DofSpring2Constraint_setDamping(this._btConstraint,t,e,o))}},{key:"setEquilibriumPoint",value:function(t,e){i.Physics3D._bullet.btGeneric6DofSpring2Constraint_setEquilibriumPoint(this._btConstraint,t,e)}},{key:"enableMotor",value:function(t,e){i.Physics3D._bullet.btGeneric6DofSpring2Constraint_enableMotor(this._btConstraint,t,e)}},{key:"setServo",value:function(t,e){i.Physics3D._bullet.btGeneric6DofSpring2Constraint_setServo(this._btConstraint,t,e)}},{key:"setTargetVelocity",value:function(t,e){i.Physics3D._bullet.btGeneric6DofSpring2Constraint_setTargetVelocity(this._btConstraint,t,e)}},{key:"setTargetPosition",value:function(t,e){i.Physics3D._bullet.btGeneric6DofSpring2Constraint_setServoTarget(this._btConstraint,t,e)}},{key:"setMaxMotorForce",value:function(t,e){i.Physics3D._bullet.btGeneric6DofSpring2Constraint_setMaxMotorForce(this._btConstraint,t,e)}},{key:"setParam",value:function(t,e,o){i.Physics3D._bullet.btTypedConstraint_setParam(this._btConstraint,t,e,o)}},{key:"setFrames",value:function(){_get(_getPrototypeOf(I.prototype),"setFrames",this).call(this);var t=i.Physics3D._bullet;this._btConstraint&&t.btGeneric6DofSpring2Constraint_setFrames(this._btConstraint,this._btframATrans,this._btframBTrans)}},{key:"_addToSimulation",value:function(){this._simulation&&this._simulation.addConstraint(this,this.enabled)}},{key:"_removeFromSimulation",value:function(){this._simulation.removeConstraint(this),this._simulation=null}},{key:"_createConstraint",value:function(){var t=i.Physics3D._bullet;this._btConstraint=t.btGeneric6DofSpring2Constraint_create(this.ownBody.btColliderObject,this._btframAPos,this.connectedBody.btColliderObject,this._btframBPos,I.RO_XYZ),this._btJointFeedBackObj=t.btJointFeedback_create(this._btConstraint),t.btTypedConstraint_setJointFeedback(this._btConstraint,this._btJointFeedBackObj),this._simulation=this.owner._scene.physicsSimulation,this._initAllConstraintInfo(),this._addToSimulation(),i.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!0)}},{key:"_initAllConstraintInfo",value:function(){this.setLimit(I.MOTION_LINEAR_INDEX_X,this._xMotion,-this._maxLinearLimit.x,-this._minLinearLimit.x),this.setLimit(I.MOTION_LINEAR_INDEX_Y,this._yMotion,this._minLinearLimit.y,this._maxLinearLimit.y),this.setLimit(I.MOTION_LINEAR_INDEX_Z,this._zMotion,this._minLinearLimit.z,this._maxLinearLimit.z),this.setLimit(I.MOTION_ANGULAR_INDEX_X,this._angularXMotion,-this._maxAngularLimit.x,-this._minAngularLimit.x),this.setLimit(I.MOTION_ANGULAR_INDEX_Y,this._angularYMotion,this._minAngularLimit.y,this._maxAngularLimit.y),this.setLimit(I.MOTION_ANGULAR_INDEX_Z,this._angularZMotion,this._minAngularLimit.z,this._maxAngularLimit.z),this.setSpring(I.MOTION_LINEAR_INDEX_X,this._linearLimitSpring.x),this.setSpring(I.MOTION_LINEAR_INDEX_Y,this._linearLimitSpring.y),this.setSpring(I.MOTION_LINEAR_INDEX_Z,this._linearLimitSpring.z),this.setSpring(I.MOTION_ANGULAR_INDEX_X,this._angularLimitSpring.x),this.setSpring(I.MOTION_ANGULAR_INDEX_Y,this._angularLimitSpring.y),this.setSpring(I.MOTION_ANGULAR_INDEX_Z,this._angularLimitSpring.z),this.setBounce(I.MOTION_LINEAR_INDEX_X,this._linearBounce.x),this.setBounce(I.MOTION_LINEAR_INDEX_Y,this._linearBounce.y),this.setBounce(I.MOTION_LINEAR_INDEX_Z,this._linearBounce.z),this.setBounce(I.MOTION_ANGULAR_INDEX_X,this._angularBounce.x),this.setBounce(I.MOTION_ANGULAR_INDEX_Y,this._angularBounce.y),this.setBounce(I.MOTION_ANGULAR_INDEX_Z,this._angularBounce.z),this.setDamping(I.MOTION_LINEAR_INDEX_X,this._linearDamp.x),this.setDamping(I.MOTION_LINEAR_INDEX_Y,this._linearDamp.y),this.setDamping(I.MOTION_LINEAR_INDEX_Z,this._linearDamp.z),this.setDamping(I.MOTION_ANGULAR_INDEX_X,this._angularDamp.x),this.setDamping(I.MOTION_ANGULAR_INDEX_Y,this._angularDamp.y),this.setDamping(I.MOTION_ANGULAR_INDEX_Z,this._angularDamp.z),this.setFrames(),this.setEquilibriumPoint(0,0)}},{key:"_onAdded",value:function(){_get(_getPrototypeOf(I.prototype),"_onAdded",this).call(this)}},{key:"_onEnable",value:function(){this._btConstraint&&(_get(_getPrototypeOf(I.prototype),"_onEnable",this).call(this),this._btConstraint&&i.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!0))}},{key:"_onDisable",value:function(){_get(_getPrototypeOf(I.prototype),"_onDisable",this).call(this),!this.connectedBody&&this._simulation&&this._removeFromSimulation(),this._btConstraint&&i.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!1)}},{key:"_parse",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(I.prototype),"_parse",this).call(this,t),this._axis.fromArray(t.axis),this._secondaryAxis.fromArray(t.secondaryAxis);var i=t.linearLimit;this._minLinearLimit.setValue(-i,-i,-i),this._maxLinearLimit.setValue(i,i,i);var o=t.linearLimitSpring;this._linearLimitSpring.setValue(o,o,o);var s=t.linearLimitDamper;this._linearDamp.setValue(s,s,s);var n=t.linearLimitBounciness;this._linearBounce.setValue(n,n,n);var r=t.lowAngularXLimit,a=t.highAngularXLimit,l=t.angularYLimit,_=t.angularZLimit;this._minAngularLimit.setValue(r,-l,-_),this._maxAngularLimit.setValue(a,l,_);var c=t.highAngularXLimitBounciness,h=t.angularYLimitBounciness,u=t.angularZLimitBounciness;this._angularBounce.setValue(c,h,u);var b=t.angularXLimitSpring,y=t.angularYZLimitSpring;this._angularLimitSpring.setValue(b,y,y);var d=t.angularXLimitDamper,C=t.angularYZLimitDamper;this._angularDamp.setValue(d,C,C),this.XMotion=t.xMotion,this.YMotion=t.yMotion,this.ZMotion=t.zMotion,this.angularXMotion=t.angularXMotion,this.angularYMotion=t.angularYMotion,this.angularZMotion=t.angularZMotion,-1!=t.rigidbodyID&&-1!=t.connectRigidbodyID&&(e.component.push(this),e.data.push(t)),null!=t.breakForce&&(this.breakForce=t.breakForce),null!=t.breakTorque&&(this.breakTorque=t.breakTorque)}},{key:"_parseInteractive",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=e[t.rigidbodyID].getComponent(j),o=e[t.connectRigidbodyID].getComponent(j);this.ownBody=i,this.connectedBody=o}},{key:"_onDestroy",value:function(){_get(_getPrototypeOf(I.prototype),"_onDestroy",this).call(this)}},{key:"axis",get:function(){return this._axis}},{key:"secondaryAxis",get:function(){return this._secondaryAxis}},{key:"maxAngularLimit",set:function(t){t.cloneTo(this._maxAngularLimit)},get:function(){return this._maxAngularLimit}},{key:"minAngularLimit",set:function(t){t.cloneTo(this._minAngularLimit)},get:function(){return this._minAngularLimit}},{key:"maxLinearLimit",set:function(t){t.cloneTo(this._maxLinearLimit)},get:function(){return this._maxLinearLimit}},{key:"minLinearLimit",set:function(t){t.cloneTo(this._minLinearLimit)},get:function(){return this._minLinearLimit}},{key:"XMotion",set:function(t){this._xMotion!=t&&(this._xMotion=t,this.setLimit(I.MOTION_LINEAR_INDEX_X,t,-this._maxLinearLimit.x,-this._minLinearLimit.x))},get:function(){return this._xMotion}},{key:"YMotion",set:function(t){this._yMotion!=t&&(this._yMotion=t,this.setLimit(I.MOTION_LINEAR_INDEX_Y,t,this._minLinearLimit.y,this._maxLinearLimit.y))},get:function(){return this._yMotion}},{key:"ZMotion",set:function(t){this._zMotion!=t&&(this._zMotion=t,this.setLimit(I.MOTION_LINEAR_INDEX_Z,t,this._minLinearLimit.z,this._maxLinearLimit.z))},get:function(){return this._zMotion}},{key:"angularXMotion",set:function(t){this._angularXMotion!=t&&(this._angularXMotion=t,this.setLimit(I.MOTION_ANGULAR_INDEX_X,t,-this._maxAngularLimit.x,-this._minAngularLimit.x))},get:function(){return this._angularXMotion}},{key:"angularYMotion",set:function(t){this._angularYMotion!=t&&(this._angularYMotion=t,this.setLimit(I.MOTION_ANGULAR_INDEX_Y,t,this._minAngularLimit.y,this._maxAngularLimit.y))},get:function(){return this._angularYMotion}},{key:"angularZMotion",set:function(t){this._angularZMotion!=t&&(this._angularZMotion=t,this.setLimit(I.MOTION_ANGULAR_INDEX_Z,t,this._minAngularLimit.z,this._maxAngularLimit.z))},get:function(){return this._angularZMotion}},{key:"linearLimitSpring",set:function(t){i.Vector3.equals(this._linearLimitSpring,t)||(t.cloneTo(this._linearLimitSpring),this.setSpring(I.MOTION_LINEAR_INDEX_X,t.x),this.setSpring(I.MOTION_LINEAR_INDEX_Y,t.y),this.setSpring(I.MOTION_LINEAR_INDEX_Z,t.z))},get:function(){return this._linearLimitSpring}},{key:"angularLimitSpring",set:function(t){i.Vector3.equals(this._angularLimitSpring,t)||(t.cloneTo(this._angularLimitSpring),this.setSpring(I.MOTION_ANGULAR_INDEX_X,t.x),this.setSpring(I.MOTION_ANGULAR_INDEX_Y,t.y),this.setSpring(I.MOTION_ANGULAR_INDEX_Z,t.z))},get:function(){return this._angularLimitSpring}},{key:"linearBounce",set:function(t){i.Vector3.equals(this._linearBounce,t)||(t.cloneTo(this._linearBounce),this.setBounce(I.MOTION_LINEAR_INDEX_X,t.x),this.setBounce(I.MOTION_LINEAR_INDEX_Y,t.y),this.setBounce(I.MOTION_LINEAR_INDEX_Z,t.z))},get:function(){return this._linearBounce}},{key:"angularBounce",set:function(t){i.Vector3.equals(this._angularBounce,t)||(t.cloneTo(this._angularBounce),this.setBounce(I.MOTION_ANGULAR_INDEX_X,t.x),this.setBounce(I.MOTION_ANGULAR_INDEX_Y,t.y),this.setBounce(I.MOTION_ANGULAR_INDEX_Z,t.z))},get:function(){return this._angularBounce}},{key:"linearDamp",set:function(t){i.Vector3.equals(this._linearDamp,t)||(t.cloneTo(this._linearDamp),this.setDamping(I.MOTION_LINEAR_INDEX_X,t.x),this.setDamping(I.MOTION_LINEAR_INDEX_Y,t.y),this.setDamping(I.MOTION_LINEAR_INDEX_Z,t.z))},get:function(){return this._linearDamp}},{key:"angularDamp",set:function(t){i.Vector3.equals(this._angularDamp,t)||(t.cloneTo(this._angularDamp),this.setDamping(I.MOTION_ANGULAR_INDEX_X,t.x),this.setDamping(I.MOTION_ANGULAR_INDEX_Y,t.y),this.setDamping(I.MOTION_ANGULAR_INDEX_Z,t.z))},get:function(){return this._angularDamp}},{key:"anchor",set:function(t){t.cloneTo(this._anchor),this.setFrames()},get:function(){return this._anchor}},{key:"connectAnchor",set:function(t){t.cloneTo(this._connectAnchor),this.setFrames()},get:function(){return this._connectAnchor}}]),I}();G.CONFIG_MOTION_TYPE_LOCKED=0,G.CONFIG_MOTION_TYPE_LIMITED=1,G.CONFIG_MOTION_TYPE_FREE=2,G.MOTION_LINEAR_INDEX_X=0,G.MOTION_LINEAR_INDEX_Y=1,G.MOTION_LINEAR_INDEX_Z=2,G.MOTION_ANGULAR_INDEX_X=3,G.MOTION_ANGULAR_INDEX_Y=4,G.MOTION_ANGULAR_INDEX_Z=5,G.RO_XYZ=0,G.RO_XZY=1,G.RO_YXZ=2,G.RO_YZX=3,G.RO_ZXY=4,G.RO_ZYX=5;var z=function(t){function O(t,e){var o;_classCallCheck(this,O),(o=_possibleConstructorReturn(this,_getPrototypeOf(O).call(this)))._normal=t,o._offset=e,o._type=c.SHAPETYPES_STATICPLANE;var s=i.ILaya3D.Physics3D._bullet;return s.btVector3_setValue(O._btNormal,-t.x,t.y,t.z),o._btShape=s.btStaticPlaneShape_create(O._btNormal,e),o}return _inherits(O,c),_createClass(O,[{key:"clone",value:function(){var t=new O(this._normal,this._offset);return this.cloneTo(t),t}}],[{key:"__init__",value:function(){O._btNormal=i.ILaya3D.Physics3D._bullet.btVector3_create(0,0,0)}}]),O}();t.BoxColliderShape=d,t.BulletInteractive=N,t.CapsuleColliderShape=f,t.CharacterController=k,t.ColliderShape=c,t.Collision=E,t.CollisionTool=x,t.CompoundColliderShape=v,t.ConeColliderShape=L,t.ConfigurableConstraint=G,t.Constraint3D=function(){return function _class(){_classCallCheck(this,_class)}}(),t.ConstraintComponent=U,t.ContactPoint=V,t.CylinderColliderShape=D,t.FixedConstraint=function(t){function _class2(){var t;return _classCallCheck(this,_class2),(t=_possibleConstructorReturn(this,_getPrototypeOf(_class2).call(this,U.CONSTRAINT_FIXED_CONSTRAINT_TYPE))).breakForce=-1,t.breakTorque=-1,t}return _inherits(_class2,U),_createClass(_class2,[{key:"_addToSimulation",value:function(){this._simulation&&this._simulation.addConstraint(this,this.enabled)}},{key:"_removeFromSimulation",value:function(){this._simulation.removeConstraint(this),this._simulation=null}},{key:"_createConstraint",value:function(){if(this.ownBody&&this.ownBody._simulation&&this.connectedBody&&this.connectedBody._simulation){var t=i.Physics3D._bullet;this._btConstraint=t.btFixedConstraint_create(this.ownBody.btColliderObject,this._btframATrans,this.connectedBody.btColliderObject,this._btframBTrans),this._btJointFeedBackObj=t.btJointFeedback_create(this._btConstraint),t.btTypedConstraint_setJointFeedback(this._btConstraint,this._btJointFeedBackObj),this._simulation=this.owner._scene.physicsSimulation,this._addToSimulation(),i.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!0)}}},{key:"_onAdded",value:function(){_get(_getPrototypeOf(_class2.prototype),"_onAdded",this).call(this)}},{key:"_onEnable",value:function(){this._btConstraint&&(_get(_getPrototypeOf(_class2.prototype),"_onEnable",this).call(this),this._btConstraint&&i.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!0))}},{key:"_onDisable",value:function(){_get(_getPrototypeOf(_class2.prototype),"_onDisable",this).call(this),this.connectedBody||this._removeFromSimulation(),this._btConstraint&&i.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!1)}},{key:"_onDestroy",value:function(){_get(_getPrototypeOf(_class2.prototype),"_onDestroy",this).call(this)}},{key:"_parse",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(_class2.prototype),"_parse",this).call(this,t),-1!=t.rigidbodyID&&-1!=t.connectRigidbodyID&&(e.component.push(this),e.data.push(t)),null!=t.breakForce&&(this.breakForce=t.breakForce),null!=t.breakTorque&&(this.breakTorque=t.breakTorque)}},{key:"_parseInteractive",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=e[t.rigidbodyID].getComponent(j),o=e[t.connectRigidbodyID].getComponent(j);this.ownBody=i,this.connectedBody=o}}]),_class2}(),t.HitResult=F,t.MeshColliderShape=A,t.PhysicsCollider=function(t){function _class3(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.Physics3DUtils.COLLISIONFILTERGROUP_DEFAULTFILTER,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER;return _classCallCheck(this,_class3),(t=_possibleConstructorReturn(this,_getPrototypeOf(_class3).call(this,e,o)))._enableProcessCollisions=!1,t}return _inherits(_class3,B),_createClass(_class3,[{key:"_addToSimulation",value:function(){this._simulation._addPhysicsCollider(this,this._collisionGroup,this._canCollideWith)}},{key:"_removeFromSimulation",value:function(){this._simulation._removePhysicsCollider(this)}},{key:"_parse",value:function(t){null!=t.friction&&(this.friction=t.friction),null!=t.rollingFriction&&(this.rollingFriction=t.rollingFriction),null!=t.restitution&&(this.restitution=t.restitution),null!=t.isTrigger&&(this.isTrigger=t.isTrigger),_get(_getPrototypeOf(_class3.prototype),"_parse",this).call(this,t),this._parseShape(t.shapes)}},{key:"_onAdded",value:function(){var t=i.Physics3D._bullet,e=t.btCollisionObject_create();t.btCollisionObject_setUserIndex(e,this.id),t.btCollisionObject_forceActivationState(e,P.ACTIVATIONSTATE_DISABLE_SIMULATION);var o=t.btCollisionObject_getCollisionFlags(e);this.owner.isStatic?((o&P.COLLISIONFLAGS_KINEMATIC_OBJECT)>0&&(o^=P.COLLISIONFLAGS_KINEMATIC_OBJECT),o|=P.COLLISIONFLAGS_STATIC_OBJECT):((o&P.COLLISIONFLAGS_STATIC_OBJECT)>0&&(o^=P.COLLISIONFLAGS_STATIC_OBJECT),o|=P.COLLISIONFLAGS_KINEMATIC_OBJECT),t.btCollisionObject_setCollisionFlags(e,o),this._btColliderObject=e,_get(_getPrototypeOf(_class3.prototype),"_onAdded",this).call(this)}}]),_class3}(),t.PhysicsComponent=P,t.PhysicsSettings=function(){return function _class4(){_classCallCheck(this,_class4),this.flags=0,this.maxSubSteps=1,this.fixedTimeStep=1/60}}(),t.PhysicsSimulation=w,t.PhysicsTriggerComponent=B,t.PhysicsUpdateList=M,t.Rigidbody3D=j,t.SphereColliderShape=R,t.StaticPlaneColliderShape=z}(window.Laya=window.Laya||{},Laya); 
 			});
 		var global = (function () { return this })();	if (!global && typeof GameGlobal !== 'undefined') global = GameGlobal;	var pluginInfoMap = {};	;	global.requirePlugin = global.requirePlugin || function(path) {		    var position = path.indexOf('/');    		var alias = '';    		var pagePath = '';    		if (position !== -1) {    		    alias = path.substr(0, position);    		    pagePath = path.substr(position + 1, path.length);    		}    		else {    		    alias = path;    		}    		if (pluginInfoMap.hasOwnProperty(alias)) {    		    var realPath = '';    		    if (pagePath.length === 0) {    		        realPath =  '__plugin__/' + pluginInfoMap[alias].appid;    		        return require(realPath);    		    } else {    		        realPath = '__plugin__/' + pluginInfoMap[alias].appid + '/' + pagePath;    		        return require(realPath);    		    }    		}    		else {    		    console.error('not found alias: ', alias);    		    throw new Error('Plugin ' + alias + ' is not defined.')    		}	};	define("wasm/game.js", function(require, module, exports){ 			
 
 			}); 	require("game.js");
 	