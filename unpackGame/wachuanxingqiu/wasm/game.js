
	define("wasm/laya.physics3D.wasm-wx.min.js", function(require, module, exports){ 			
"use strict";var t=require("../@babel/runtime/helpers/set"),i=require("../@babel/runtime/helpers/assertThisInitialized"),e=require("../@babel/runtime/helpers/get"),o=require("../@babel/runtime/helpers/getPrototypeOf"),n=require("../@babel/runtime/helpers/inherits"),s=require("../@babel/runtime/helpers/createSuper"),a=require("../@babel/runtime/helpers/classCallCheck"),r=require("../@babel/runtime/helpers/createClass");window.Physics3D=function(t,i){return new Promise((function(e){var o=new WXWebAssembly.Memory({initial:t});WXWebAssembly.instantiate("wasm/laya.physics3D.wasm.wasm",{LayaAirInteractive:i,wasi_unstable:{fd_close:function(){console.log("fd_close")},fd_seek:function(){console.log("fd_seek")},fd_write:function(){console.log("fd_write")}},env:{memory:o}}).then((function(t){window.Physics3D=t.instance.exports,e()}))}))},function(l,_){var c=function(){function t(){a(this,t),this._scale=new _.Vector3(1,1,1),this._centerMatrix=new _.Matrix4x4,this._attatched=!1,this._indexInCompound=-1,this._compoundParent=null,this._attatchedCollisionObject=null,this._referenceCount=0,this._localOffset=new _.Vector3(0,0,0),this._localRotation=new _.Quaternion(0,0,0,1),this.needsCustomCollisionCallback=!1}return r(t,[{key:"type",get:function(){return this._type}},{key:"localOffset",get:function(){return this._localOffset},set:function(t){this._localOffset=t,this._compoundParent&&this._compoundParent._updateChildTransform(this)}},{key:"localRotation",get:function(){return this._localRotation},set:function(t){this._localRotation=t,this._compoundParent&&this._compoundParent._updateChildTransform(this)}},{key:"_setScale",value:function(i){if(this._compoundParent)this.updateLocalTransformations();else{var e=_.ILaya3D.Physics3D._bullet;e.btVector3_setValue(t._btScale,i.x,i.y,i.z),e.btCollisionShape_setLocalScaling(this._btShape,t._btScale)}}},{key:"_addReference",value:function(){this._referenceCount++}},{key:"_removeReference",value:function(){this._referenceCount--}},{key:"updateLocalTransformations",value:function(){if(this._compoundParent){var i=t._tempVector30;_.Vector3.multiply(this.localOffset,this._scale,i),t._createAffineTransformation(i,this.localRotation,this._centerMatrix.elements)}else t._createAffineTransformation(this.localOffset,this.localRotation,this._centerMatrix.elements)}},{key:"cloneTo",value:function(t){var i=t;this._localOffset.cloneTo(i.localOffset),this._localRotation.cloneTo(i.localRotation),i.localOffset=i.localOffset,i.localRotation=i.localRotation}},{key:"clone",value:function(){return null}},{key:"destroy",value:function(){this._btShape&&(_.ILaya3D.Physics3D._bullet.btCollisionShape_destroy(this._btShape),this._btShape=null)}}],[{key:"__init__",value:function(){var i=_.ILaya3D.Physics3D._bullet;t._btScale=i.btVector3_create(1,1,1),t._btVector30=i.btVector3_create(0,0,0),t._btQuaternion0=i.btQuaternion_create(0,0,0,1),t._btTransform0=i.btTransform_create()}},{key:"_createAffineTransformation",value:function(t,i,e){var o=i.x,n=i.y,s=i.z,a=i.w,r=o+o,l=n+n,_=s+s,c=o*r,h=o*l,u=o*_,b=n*l,d=n*_,y=s*_,C=a*r,m=a*l,p=a*_;e[0]=1-(b+y),e[1]=h+p,e[2]=u-m,e[3]=0,e[4]=h-p,e[5]=1-(c+y),e[6]=d+C,e[7]=0,e[8]=u+m,e[9]=d-C,e[10]=1-(c+b),e[11]=0,e[12]=t.x,e[13]=t.y,e[14]=t.z,e[15]=1}}]),t}();c.SHAPEORIENTATION_UPX=0,c.SHAPEORIENTATION_UPY=1,c.SHAPEORIENTATION_UPZ=2,c.SHAPETYPES_BOX=0,c.SHAPETYPES_SPHERE=1,c.SHAPETYPES_CYLINDER=2,c.SHAPETYPES_CAPSULE=3,c.SHAPETYPES_CONVEXHULL=4,c.SHAPETYPES_COMPOUND=5,c.SHAPETYPES_STATICPLANE=6,c.SHAPETYPES_CONE=7,c._tempVector30=new _.Vector3;var h=function(t){n(e,t);var i=s(e);function e(){var t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;a(this,e),(t=i.call(this))._sizeX=o,t._sizeY=n,t._sizeZ=s,t._type=c.SHAPETYPES_BOX;var r=_.ILaya3D.Physics3D._bullet;return r.btVector3_setValue(e._btSize,o/2,n/2,s/2),t._btShape=r.btBoxShape_create(e._btSize),t}return r(e,[{key:"sizeX",get:function(){return this._sizeX}},{key:"sizeY",get:function(){return this._sizeY}},{key:"sizeZ",get:function(){return this._sizeZ}},{key:"clone",value:function(){var t=new e(this._sizeX,this._sizeY,this._sizeZ);return this.cloneTo(t),t}}],[{key:"__init__",value:function(){e._btSize=_.ILaya3D.Physics3D._bullet.btVector3_create(0,0,0)}}]),e}(c),u=function(t){n(l,t);var i=s(l);function l(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1.25,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.SHAPEORIENTATION_UPY;a(this,l),(t=i.call(this))._radius=e,t._length=o,t._orientation=n,t._type=c.SHAPETYPES_CAPSULE;var s=_.ILaya3D.Physics3D._bullet;switch(n){case c.SHAPEORIENTATION_UPX:t._btShape=s.btCapsuleShapeX_create(e,o-2*e);break;case c.SHAPEORIENTATION_UPY:t._btShape=s.btCapsuleShape_create(e,o-2*e);break;case c.SHAPEORIENTATION_UPZ:t._btShape=s.btCapsuleShapeZ_create(e,o-2*e);break;default:throw"CapsuleColliderShape:unknown orientation."}return t}return r(l,[{key:"radius",get:function(){return this._radius}},{key:"length",get:function(){return this._length}},{key:"orientation",get:function(){return this._orientation}},{key:"_setScale",value:function(t){var i=l._tempVector30;switch(this.orientation){case c.SHAPEORIENTATION_UPX:i.x=t.x,i.y=i.z=Math.max(t.y,t.z);break;case c.SHAPEORIENTATION_UPY:i.y=t.y,i.x=i.z=Math.max(t.x,t.z);break;case c.SHAPEORIENTATION_UPZ:i.z=t.z,i.x=i.y=Math.max(t.x,t.y);break;default:throw"CapsuleColliderShape:unknown orientation."}e(o(l.prototype),"_setScale",this).call(this,i)}},{key:"clone",value:function(){var t=new l(this._radius,this._length,this._orientation);return this.cloneTo(t),t}}]),l}(c);u._tempVector30=new _.Vector3;var b=function(t){n(l,t);var i=s(l);function l(){var t;return a(this,l),(t=i.call(this))._childColliderShapes=[],t._type=c.SHAPETYPES_COMPOUND,t._btShape=_.ILaya3D.Physics3D._bullet.btCompoundShape_create(),t}return r(l,[{key:"_clearChildShape",value:function(t){t._attatched=!1,t._compoundParent=null,t._indexInCompound=-1}},{key:"_addReference",value:function(){}},{key:"_removeReference",value:function(){}},{key:"_updateChildTransform",value:function(t){var i=_.ILaya3D.Physics3D._bullet,e=t.localOffset,o=t.localRotation,n=c._btVector30,s=c._btQuaternion0,a=c._btTransform0;i.btVector3_setValue(n,-e.x,e.y,e.z),i.btQuaternion_setValue(s,-o.x,o.y,o.z,-o.w),i.btTransform_setOrigin(a,n),i.btTransform_setRotation(a,s),i.btCompoundShape_updateChildTransform(this._btShape,t._indexInCompound,a,!0)}},{key:"addChildShape",value:function(t){if(t._attatched)throw"CompoundColliderShape: this shape has attatched to other entity.";t._attatched=!0,t._compoundParent=this,t._indexInCompound=this._childColliderShapes.length,this._childColliderShapes.push(t);var i=t.localOffset,e=t.localRotation,o=_.ILaya3D.Physics3D._bullet;o.btVector3_setValue(l._btOffset,-i.x,i.y,i.z),o.btQuaternion_setValue(l._btRotation,-e.x,e.y,e.z,-e.w),o.btTransform_setOrigin(l._btTransform,l._btOffset),o.btTransform_setRotation(l._btTransform,l._btRotation);var n=o.btCollisionShape_getLocalScaling(this._btShape);o.btCollisionShape_setLocalScaling(this._btShape,l._btVector3One),o.btCompoundShape_addChildShape(this._btShape,l._btTransform,t._btShape),o.btCollisionShape_setLocalScaling(this._btShape,n),this._attatchedCollisionObject&&(this._attatchedCollisionObject.colliderShape=this)}},{key:"removeChildShape",value:function(t){if(t._compoundParent===this){var i=t._indexInCompound;this._clearChildShape(t);var e=this._childColliderShapes[this._childColliderShapes.length-1];e._indexInCompound=i,this._childColliderShapes[i]=e,this._childColliderShapes.pop(),_.ILaya3D.Physics3D._bullet.btCompoundShape_removeChildShapeByIndex(this._btShape,i)}}},{key:"clearChildShape",value:function(){for(var t=0,i=this._childColliderShapes.length;t<i;t++)this._clearChildShape(this._childColliderShapes[t]),_.ILaya3D.Physics3D._bullet.btCompoundShape_removeChildShapeByIndex(this._btShape,0);this._childColliderShapes.length=0}},{key:"getChildShapeCount",value:function(){return this._childColliderShapes.length}},{key:"cloneTo",value:function(t){var i=t;i.clearChildShape();for(var e=0,o=this._childColliderShapes.length;e<o;e++)i.addChildShape(this._childColliderShapes[e].clone())}},{key:"clone",value:function(){var t=new l;return this.cloneTo(t),t}},{key:"destroy",value:function(){e(o(l.prototype),"destroy",this).call(this);for(var t=0,i=this._childColliderShapes.length;t<i;t++){var n=this._childColliderShapes[t];0===n._referenceCount&&n.destroy()}}}],[{key:"__init__",value:function(){var t=_.ILaya3D.Physics3D._bullet;l._btVector3One=t.btVector3_create(1,1,1),l._btTransform=t.btTransform_create(),l._btOffset=t.btVector3_create(0,0,0),l._btRotation=t.btQuaternion_create(0,0,0,1)}}]),l}(c),d=function(t){n(e,t);var i=s(e);function e(){var t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.SHAPEORIENTATION_UPY;a(this,e),(t=i.call(this))._radius=1,t._height=.5,t._radius=o,t._height=n,t._orientation=s,t._type=c.SHAPETYPES_CYLINDER;var r=_.ILaya3D.Physics3D._bullet;switch(s){case c.SHAPEORIENTATION_UPX:t._btShape=r.btConeShapeX_create(o,n);break;case c.SHAPEORIENTATION_UPY:t._btShape=r.btConeShape_create(o,n);break;case c.SHAPEORIENTATION_UPZ:t._btShape=r.btConeShapeZ_create(o,n);break;default:throw"ConeColliderShape:unknown orientation."}return t}return r(e,[{key:"radius",get:function(){return this._radius}},{key:"height",get:function(){return this._height}},{key:"orientation",get:function(){return this._orientation}},{key:"clone",value:function(){var t=new e(this._radius,this._height,this._orientation);return this.cloneTo(t),t}}]),e}(c),y=function(t){n(e,t);var i=s(e);function e(){var t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.SHAPEORIENTATION_UPY;a(this,e),(t=i.call(this))._radius=1,t._height=.5,t._radius=o,t._height=n,t._orientation=s,t._type=c.SHAPETYPES_CYLINDER;var r=_.ILaya3D.Physics3D._bullet;switch(s){case c.SHAPEORIENTATION_UPX:r.btVector3_setValue(e._btSize,n/2,o,o),t._btShape=r.btCylinderShapeX_create(e._btSize);break;case c.SHAPEORIENTATION_UPY:r.btVector3_setValue(e._btSize,o,n/2,o),t._btShape=r.btCylinderShape_create(e._btSize);break;case c.SHAPEORIENTATION_UPZ:r.btVector3_setValue(e._btSize,o,o,n/2),t._btShape=r.btCylinderShapeZ_create(e._btSize);break;default:throw"CapsuleColliderShape:unknown orientation."}return t}return r(e,[{key:"radius",get:function(){return this._radius}},{key:"height",get:function(){return this._height}},{key:"orientation",get:function(){return this._orientation}},{key:"clone",value:function(){var t=new e(this._radius,this._height,this._orientation);return this.cloneTo(t),t}}],[{key:"__init__",value:function(){e._btSize=_.ILaya3D.Physics3D._bullet.btVector3_create(0,0,0)}}]),e}(c),C=function(t){n(l,t);var i=s(l);function l(){var t;return a(this,l),(t=i.call(this))._mesh=null,t._convex=!1,t}return r(l,[{key:"mesh",get:function(){return this._mesh},set:function(t){if(this._mesh!==t){var i=_.ILaya3D.Physics3D._bullet;this._mesh&&i.btCollisionShape_destroy(this._btShape),t&&(this._btShape=i.btGImpactMeshShape_create(t._getPhysicMesh()),i.btGImpactShapeInterface_updateBound(this._btShape)),this._mesh=t}}},{key:"convex",get:function(){return this._convex},set:function(t){this._convex=t}},{key:"_setScale",value:function(t){if(this._compoundParent)this.updateLocalTransformations();else{var i=_.ILaya3D.Physics3D._bullet;i.btVector3_setValue(c._btScale,t.x,t.y,t.z),i.btCollisionShape_setLocalScaling(this._btShape,c._btScale),i.btGImpactShapeInterface_updateBound(this._btShape)}}},{key:"cloneTo",value:function(t){var i=t;i.convex=this._convex,i.mesh=this._mesh,e(o(l.prototype),"cloneTo",this).call(this,t)}},{key:"clone",value:function(){var t=new l;return this.cloneTo(t),t}},{key:"destroy",value:function(){this._btShape&&(_.ILaya3D.Physics3D._bullet.btCollisionShape_destroy(this._btShape),this._btShape=null)}}]),l}(c),m=function(t){n(e,t);var i=s(e);function e(){var t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;return a(this,e),(t=i.call(this))._radius=o,t._type=c.SHAPETYPES_SPHERE,t._btShape=_.ILaya3D.Physics3D._bullet.btSphereShape_create(o),t}return r(e,[{key:"radius",get:function(){return this._radius}},{key:"clone",value:function(){var t=new e(this._radius);return this.cloneTo(t),t}}]),e}(c),p=function(t){n(c,t);var l=s(c);function c(t,e){var o;return a(this,c),(o=l.call(this))._restitution=0,o._friction=.5,o._rollingFriction=0,o._ccdMotionThreshold=0,o._ccdSweptSphereRadius=0,o._collisionGroup=_.Physics3DUtils.COLLISIONFILTERGROUP_DEFAULTFILTER,o._canCollideWith=_.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,o._colliderShape=null,o._transformFlag=2147483647,o._controlBySimulation=!1,o._enableProcessCollisions=!0,o._inPhysicUpdateListIndex=-1,o.canScaleShape=!0,o._collisionGroup=t,o._canCollideWith=e,c._physicObjectsMap[o.id]=i(o),o}return r(c,[{key:"restitution",get:function(){return this._restitution},set:function(t){this._restitution=t,this._btColliderObject&&_.ILaya3D.Physics3D._bullet.btCollisionObject_setRestitution(this._btColliderObject,t)}},{key:"friction",get:function(){return this._friction},set:function(t){this._friction=t,this._btColliderObject&&_.ILaya3D.Physics3D._bullet.btCollisionObject_setFriction(this._btColliderObject,t)}},{key:"rollingFriction",get:function(){return this._rollingFriction},set:function(t){this._rollingFriction=t,this._btColliderObject&&_.ILaya3D.Physics3D._bullet.btCollisionObject_setRollingFriction(this._btColliderObject,t)}},{key:"ccdMotionThreshold",get:function(){return this._ccdMotionThreshold},set:function(t){this._ccdMotionThreshold=t,this._btColliderObject&&_.ILaya3D.Physics3D._bullet.btCollisionObject_setCcdMotionThreshold(this._btColliderObject,t)}},{key:"ccdSweptSphereRadius",get:function(){return this._ccdSweptSphereRadius},set:function(t){this._ccdSweptSphereRadius=t,this._btColliderObject&&_.ILaya3D.Physics3D._bullet.btCollisionObject_setCcdSweptSphereRadius(this._btColliderObject,t)}},{key:"isActive",get:function(){return!!this._btColliderObject&&_.ILaya3D.Physics3D._bullet.btCollisionObject_isActive(this._btColliderObject)}},{key:"colliderShape",get:function(){return this._colliderShape},set:function(t){var i=this._colliderShape;if(i&&(i._attatched=!1,i._attatchedCollisionObject=null),this._colliderShape=t,t){if(t._attatched)throw"PhysicsComponent: this shape has attatched to other entity.";if(t._attatched=!0,t._attatchedCollisionObject=this,this._btColliderObject){_.ILaya3D.Physics3D._bullet.btCollisionObject_setCollisionShape(this._btColliderObject,t._btShape);var e=this._simulation&&this._enabled;e&&i&&this._removeFromSimulation(),this._onShapeChange(t),e&&(this._derivePhysicsTransformation(!0),this._addToSimulation())}}else this._simulation&&this._enabled&&i&&this._removeFromSimulation()}},{key:"simulation",get:function(){return this._simulation}},{key:"collisionGroup",get:function(){return this._collisionGroup},set:function(t){this._collisionGroup!==t&&(this._collisionGroup=t,this._simulation&&this._colliderShape&&this._enabled&&(this._removeFromSimulation(),this._addToSimulation()))}},{key:"canCollideWith",get:function(){return this._canCollideWith},set:function(t){this._canCollideWith!==t&&(this._canCollideWith=t,this._simulation&&this._colliderShape&&this._enabled&&(this._removeFromSimulation(),this._addToSimulation()))}},{key:"_parseShape",value:function(t){var i=t.length;if(1===i){var e=c._creatShape(t[0]);this.colliderShape=e}else{for(var o=new b,n=0;n<i;n++)e=c._creatShape(t[n]),o.addChildShape(e);this.colliderShape=o}}},{key:"_onScaleChange",value:function(t){this._colliderShape._setScale(t)}},{key:"_onEnable",value:function(){this._simulation=this.owner._scene.physicsSimulation,_.ILaya3D.Physics3D._bullet.btCollisionObject_setContactProcessingThreshold(this._btColliderObject,0),this._colliderShape&&(this._derivePhysicsTransformation(!0),this._addToSimulation())}},{key:"_onDisable",value:function(){this._colliderShape&&(this._removeFromSimulation(),-1!==this._inPhysicUpdateListIndex&&this._simulation._physicsUpdateList.remove(this)),this._simulation=null}},{key:"_onDestroy",value:function(){delete c._physicObjectsMap[this.id],_.ILaya3D.Physics3D._bullet.btCollisionObject_destroy(this._btColliderObject),this._colliderShape.destroy(),e(o(c.prototype),"_onDestroy",this).call(this),this._btColliderObject=null,this._colliderShape=null,this._simulation=null,this.owner.transform.off(_.Event.TRANSFORM_CHANGED,this,this._onTransformChanged)}},{key:"_isValid",value:function(){return this._simulation&&this._colliderShape&&this._enabled}},{key:"_parse",value:function(t){null!=t.collisionGroup&&(this.collisionGroup=t.collisionGroup),null!=t.canCollideWith&&(this.canCollideWith=t.canCollideWith),null!=t.ccdMotionThreshold&&(this.ccdMotionThreshold=t.ccdMotionThreshold),null!=t.ccdSweptSphereRadius&&(this.ccdSweptSphereRadius=t.ccdSweptSphereRadius)}},{key:"_setTransformFlag",value:function(t,i){i?this._transformFlag|=t:this._transformFlag&=~t}},{key:"_getTransformFlag",value:function(t){return 0!=(this._transformFlag&t)}},{key:"_addToSimulation",value:function(){}},{key:"_removeFromSimulation",value:function(){}},{key:"_derivePhysicsTransformation",value:function(t){var i=_.ILaya3D.Physics3D._bullet,e=this._btColliderObject,o=i.btCollisionObject_getWorldTransform(e);this._innerDerivePhysicsTransformation(o,t),i.btCollisionObject_setWorldTransform(e,o)}},{key:"_innerDerivePhysicsTransformation",value:function(t,i){var e=_.ILaya3D.Physics3D._bullet,o=this.owner._transform;if(i||this._getTransformFlag(_.Transform3D.TRANSFORM_WORLDPOSITION)){var n=this._colliderShape.localOffset,s=o.position,a=c._btVector30;if(0!==n.x||0!==n.y||0!==n.z){var r=c._tempVector30,l=o.worldMatrix;_.Vector3.transformCoordinate(n,l,r),e.btVector3_setValue(a,-r.x,r.y,r.z)}else e.btVector3_setValue(a,-s.x,s.y,s.z);e.btTransform_setOrigin(t,a),this._setTransformFlag(_.Transform3D.TRANSFORM_WORLDPOSITION,!1)}if(i||this._getTransformFlag(_.Transform3D.TRANSFORM_WORLDQUATERNION)){var h=this._colliderShape.localRotation,u=c._btQuaternion0,b=o.rotation;if(0!==h.x||0!==h.y||0!==h.z||1!==h.w){var d=c._tempQuaternion0;c.physicQuaternionMultiply(b.x,b.y,b.z,b.w,h,d),e.btQuaternion_setValue(u,-d.x,d.y,d.z,-d.w)}else e.btQuaternion_setValue(u,-b.x,b.y,b.z,-b.w);e.btTransform_setRotation(t,u),this._setTransformFlag(_.Transform3D.TRANSFORM_WORLDQUATERNION,!1)}(i||this._getTransformFlag(_.Transform3D.TRANSFORM_WORLDSCALE))&&(this._onScaleChange(o.getWorldLossyScale()),this._setTransformFlag(_.Transform3D.TRANSFORM_WORLDSCALE,!1))}},{key:"_updateTransformComponent",value:function(t){var i=_.ILaya3D.Physics3D._bullet,e=this._colliderShape,o=e.localOffset,n=e.localRotation,s=this.owner._transform,a=s.position,r=s.rotation,l=i.btTransform_getOrigin(t),h=i.btTransform_getRotation(t),u=-i.btQuaternion_x(h),b=i.btQuaternion_y(h),d=i.btQuaternion_z(h),y=-i.btQuaternion_w(h);if(0!==n.x||0!==n.y||0!==n.z||1!==n.w){var C=c._tempQuaternion0;n.invert(C),c.physicQuaternionMultiply(u,b,d,y,C,r)}else r.x=u,r.y=b,r.z=d,r.w=y;if(s.rotation=r,0!==o.x||0!==o.y||0!==o.z){var m=i.btCollisionShape_getLocalScaling(e._btShape),p=c._tempVector30;p.x=o.x*i.btVector3_x(m),p.y=o.y*i.btVector3_y(m),p.z=o.z*i.btVector3_z(m),_.Vector3.transformQuat(p,r,p),a.x=-i.btVector3_x(l)-p.x,a.y=i.btVector3_y(l)-p.y,a.z=i.btVector3_z(l)-p.z}else a.x=-i.btVector3_x(l),a.y=i.btVector3_y(l),a.z=i.btVector3_z(l);s.position=a}},{key:"_onShapeChange",value:function(t){var i=this._btColliderObject,e=_.ILaya3D.Physics3D._bullet,o=e.btCollisionObject_getCollisionFlags(i);t.needsCustomCollisionCallback?0==(o&c.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)&&e.btCollisionObject_setCollisionFlags(i,o|c.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK):(o&c.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)>0&&e.btCollisionObject_setCollisionFlags(i,o^c.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)}},{key:"_onAdded",value:function(){this.enabled=this._enabled,this.restitution=this._restitution,this.friction=this._friction,this.rollingFriction=this._rollingFriction,this.ccdMotionThreshold=this._ccdMotionThreshold,this.ccdSweptSphereRadius=this._ccdSweptSphereRadius,this.owner.transform.on(_.Event.TRANSFORM_CHANGED,this,this._onTransformChanged)}},{key:"_onTransformChanged",value:function(t){!c._addUpdateList&&this._controlBySimulation||(t&=_.Transform3D.TRANSFORM_WORLDPOSITION|_.Transform3D.TRANSFORM_WORLDQUATERNION|_.Transform3D.TRANSFORM_WORLDSCALE)&&(this._transformFlag|=t,this._isValid()&&-1===this._inPhysicUpdateListIndex&&this._simulation._physicsUpdateList.add(this))}},{key:"_cloneTo",value:function(t){var i=t;i.restitution=this._restitution,i.friction=this._friction,i.rollingFriction=this._rollingFriction,i.ccdMotionThreshold=this._ccdMotionThreshold,i.ccdSweptSphereRadius=this._ccdSweptSphereRadius,i.collisionGroup=this._collisionGroup,i.canCollideWith=this._canCollideWith,i.canScaleShape=this.canScaleShape,this._colliderShape&&(i.colliderShape=this._colliderShape.clone())}}],[{key:"__init__",value:function(){var t=_.ILaya3D.Physics3D._bullet;c._btVector30=t.btVector3_create(0,0,0),c._btQuaternion0=t.btQuaternion_create(0,0,0,1)}},{key:"_createAffineTransformationArray",value:function(t,i,e,o,n,s,a,r,l){var _=o+o,c=n+n,h=s+s,u=o*_,b=o*c,d=o*h,y=n*c,C=n*h,m=s*h,p=a*_,g=a*c,f=a*h,T=r[0],S=r[1],I=r[2];l[0]=(1-(y+m))*T,l[1]=(b+f)*T,l[2]=(d-g)*T,l[3]=0,l[4]=(b-f)*S,l[5]=(1-(u+m))*S,l[6]=(C+p)*S,l[7]=0,l[8]=(d+g)*I,l[9]=(C-p)*I,l[10]=(1-(u+y))*I,l[11]=0,l[12]=t,l[13]=i,l[14]=e,l[15]=1}},{key:"_creatShape",value:function(t){var i;switch(t.type){case"BoxColliderShape":var e=t.size;i=e?new h(e[0],e[1],e[2]):new h;break;case"SphereColliderShape":i=new m(t.radius);break;case"CapsuleColliderShape":i=new u(t.radius,t.height,t.orientation);break;case"MeshColliderShape":var o=new C;t.mesh&&(o.mesh=_.Loader.getRes(t.mesh)),i=o;break;case"ConeColliderShape":i=new d(t.radius,t.height,t.orientation);break;case"CylinderColliderShape":i=new y(t.radius,t.height,t.orientation);break;default:throw"unknown shape type."}if(t.center){var n=i.localOffset;n.fromArray(t.center),i.localOffset=n}return i}},{key:"physicVector3TransformQuat",value:function(t,i,e,o,n,s){var a=t.x,r=t.y,l=t.z,_=n*a+e*l-o*r,c=n*r+o*a-i*l,h=n*l+i*r-e*a,u=-i*a-e*r-o*l;s.x=_*n+u*-i+c*-o-h*-e,s.y=c*n+u*-e+h*-i-_*-o,s.z=h*n+u*-o+_*-e-c*-i}},{key:"physicQuaternionMultiply",value:function(t,i,e,o,n,s){var a=n.x,r=n.y,l=n.z,_=n.w,c=i*l-e*r,h=e*a-t*l,u=t*r-i*a,b=t*a+i*r+e*l;s.x=t*_+a*o+c,s.y=i*_+r*o+h,s.z=e*_+l*o+u,s.w=o*_-b}}]),c}(_.Component);p.ACTIVATIONSTATE_ACTIVE_TAG=1,p.ACTIVATIONSTATE_ISLAND_SLEEPING=2,p.ACTIVATIONSTATE_WANTS_DEACTIVATION=3,p.ACTIVATIONSTATE_DISABLE_DEACTIVATION=4,p.ACTIVATIONSTATE_DISABLE_SIMULATION=5,p.COLLISIONFLAGS_STATIC_OBJECT=1,p.COLLISIONFLAGS_KINEMATIC_OBJECT=2,p.COLLISIONFLAGS_NO_CONTACT_RESPONSE=4,p.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK=8,p.COLLISIONFLAGS_CHARACTER_OBJECT=16,p.COLLISIONFLAGS_DISABLE_VISUALIZE_OBJECT=32,p.COLLISIONFLAGS_DISABLE_SPU_COLLISION_PROCESSING=64,p._tempVector30=new _.Vector3,p._tempQuaternion0=new _.Quaternion,p._tempQuaternion1=new _.Quaternion,p._tempMatrix4x40=new _.Matrix4x4,p._physicObjectsMap={},p._addUpdateList=!0;var g=function t(){a(this,t)};g._interactive={getWorldTransform:function(t,i){},setWorldTransform:function(t,i){var e=p._physicObjectsMap[t];e._simulation._updatedRigidbodies++,e._updateTransformComponent(i)}};var f=function(t){n(l,t);var i=s(l);function l(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_.Physics3DUtils.COLLISIONFILTERGROUP_DEFAULTFILTER,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER;return a(this,l),(t=i.call(this,n,s))._upAxis=new _.Vector3(0,1,0),t._maxSlope=45,t._jumpSpeed=10,t._fallSpeed=55,t._gravity=new _.Vector3(0,3*-9.8,0),t._btKinematicCharacter=null,t._stepHeight=e,o&&(t._upAxis=o),t._controlBySimulation=!0,t}return r(l,[{key:"fallSpeed",get:function(){return this._fallSpeed},set:function(t){this._fallSpeed=t,_.ILaya3D.Physics3D._bullet.btKinematicCharacterController_setFallSpeed(this._btKinematicCharacter,t)}},{key:"jumpSpeed",get:function(){return this._jumpSpeed},set:function(t){this._jumpSpeed=t,_.ILaya3D.Physics3D._bullet.btKinematicCharacterController_setJumpSpeed(this._btKinematicCharacter,t)}},{key:"gravity",get:function(){return this._gravity},set:function(t){this._gravity=t;var i=_.ILaya3D.Physics3D._bullet,e=l._btTempVector30;i.btVector3_setValue(e,-t.x,t.y,t.z),i.btKinematicCharacterController_setGravity(this._btKinematicCharacter,e)}},{key:"maxSlope",get:function(){return this._maxSlope},set:function(t){this._maxSlope=t,_.ILaya3D.Physics3D._bullet.btKinematicCharacterController_setMaxSlope(this._btKinematicCharacter,t/180*Math.PI)}},{key:"isGrounded",get:function(){return _.ILaya3D.Physics3D._bullet.btKinematicCharacterController_onGround(this._btKinematicCharacter)}},{key:"stepHeight",get:function(){return this._stepHeight},set:function(t){this._stepHeight=t,_.ILaya3D.Physics3D._bullet.btKinematicCharacterController_setStepHeight(this._btKinematicCharacter,t)}},{key:"upAxis",get:function(){return this._upAxis},set:function(t){this._upAxis=t;var i=l._btTempVector30;_.Utils3D._convertToBulletVec3(t,i,!1),_.ILaya3D.Physics3D._bullet.btKinematicCharacterController_setUp(this._btKinematicCharacter,i)}},{key:"_constructCharacter",value:function(){var t=_.ILaya3D.Physics3D._bullet;this._btKinematicCharacter&&t.btKinematicCharacterController_destroy(this._btKinematicCharacter);var i=l._btTempVector30;t.btVector3_setValue(i,this._upAxis.x,this._upAxis.y,this._upAxis.z),this._btKinematicCharacter=t.btKinematicCharacterController_create(this._btColliderObject,this._colliderShape._btShape,this._stepHeight,i),this.fallSpeed=this._fallSpeed,this.maxSlope=this._maxSlope,this.jumpSpeed=this._jumpSpeed,this.gravity=this._gravity}},{key:"_onShapeChange",value:function(t){e(o(l.prototype),"_onShapeChange",this).call(this,t),this._constructCharacter()}},{key:"_onAdded",value:function(){var t=_.ILaya3D.Physics3D._bullet,i=t.btPairCachingGhostObject_create();t.btCollisionObject_setUserIndex(i,this.id),t.btCollisionObject_setCollisionFlags(i,p.COLLISIONFLAGS_CHARACTER_OBJECT),this._btColliderObject=i,this._colliderShape&&this._constructCharacter(),e(o(l.prototype),"_onAdded",this).call(this)}},{key:"_addToSimulation",value:function(){this._simulation._characters.push(this),this._simulation._addCharacter(this,this._collisionGroup,this._canCollideWith)}},{key:"_removeFromSimulation",value:function(){this._simulation._removeCharacter(this);var t=this._simulation._characters;t.splice(t.indexOf(this),1)}},{key:"_cloneTo",value:function(t){e(o(l.prototype),"_cloneTo",this).call(this,t);var i=t;i.stepHeight=this._stepHeight,i.upAxis=this._upAxis,i.maxSlope=this._maxSlope,i.jumpSpeed=this._jumpSpeed,i.fallSpeed=this._fallSpeed,i.gravity=this._gravity}},{key:"_onDestroy",value:function(){_.ILaya3D.Physics3D._bullet.btKinematicCharacterController_destroy(this._btKinematicCharacter),e(o(l.prototype),"_onDestroy",this).call(this),this._btKinematicCharacter=null}},{key:"move",value:function(t){var i=l._btVector30,e=_.ILaya3D.Physics3D._bullet;e.btVector3_setValue(i,-t.x,t.y,t.z),e.btKinematicCharacterController_setWalkDirection(this._btKinematicCharacter,i)}},{key:"jump",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=_.ILaya3D.Physics3D._bullet,e=l._btVector30;t?(_.Utils3D._convertToBulletVec3(t,e,!0),i.btKinematicCharacterController_jump(this._btKinematicCharacter,e)):(i.btVector3_setValue(e,0,0,0),i.btKinematicCharacterController_jump(this._btKinematicCharacter,e))}}],[{key:"__init__",value:function(){l._btTempVector30=_.ILaya3D.Physics3D._bullet.btVector3_create(0,0,0)}}]),l}(p);f.UPAXIS_X=0,f.UPAXIS_Y=1,f.UPAXIS_Z=2;var T=function(){function t(){a(this,t),this._lastUpdateFrame=-2147483648,this._updateFrame=-2147483648,this._isTrigger=!1,this.contacts=[]}return r(t,[{key:"_setUpdateFrame",value:function(t){this._lastUpdateFrame=this._updateFrame,this._updateFrame=t}}]),t}(),S=function t(){a(this,t),this._idCounter=0,this.colliderA=null,this.colliderB=null,this.distance=0,this.normal=new _.Vector3,this.positionOnA=new _.Vector3,this.positionOnB=new _.Vector3,this._id=++this._idCounter},I=function t(){a(this,t),this.succeeded=!1,this.collider=null,this.point=new _.Vector3,this.normal=new _.Vector3,this.hitFraction=0},O=function(){function t(){a(this,t),this._hitResultsPoolIndex=0,this._hitResultsPool=[],this._contactPonintsPoolIndex=0,this._contactPointsPool=[],this._collisionsPool=[],this._collisions={}}return r(t,[{key:"getHitResult",value:function(){var t=this._hitResultsPool[this._hitResultsPoolIndex++];return t||(t=new I,this._hitResultsPool.push(t)),t}},{key:"recoverAllHitResultsPool",value:function(){this._hitResultsPoolIndex=0}},{key:"getContactPoints",value:function(){var t=this._contactPointsPool[this._contactPonintsPoolIndex++];return t||(t=new S,this._contactPointsPool.push(t)),t}},{key:"recoverAllContactPointsPool",value:function(){this._contactPonintsPoolIndex=0}},{key:"getCollision",value:function(t,i){var e,o=t.id,n=i.id,s=this._collisions[o];return s&&(e=s[n]),e||(s||(s={},this._collisions[o]=s),(e=0===this._collisionsPool.length?new T:this._collisionsPool.pop())._colliderA=t,e._colliderB=i,s[n]=e),e}},{key:"recoverCollision",value:function(t){var i=t._colliderA.id,e=t._colliderB.id;this._collisions[i][e]=null,this._collisionsPool.push(t)}},{key:"garbageCollection",value:function(){for(var t in this._hitResultsPoolIndex=0,this._hitResultsPool.length=0,this._contactPonintsPoolIndex=0,this._contactPointsPool.length=0,this._collisionsPool.length=0,this._collisionsPool){var i=this._collisionsPool[t],e=!0;for(var o in i)i[o]?e=!1:delete i[o];e&&delete this._collisionsPool[t]}}}]),t}(),v=function(t){n(l,t);var i=s(l);function l(t,e){var o;return a(this,l),(o=i.call(this,t,e))._isTrigger=!1,o}return r(l,[{key:"isTrigger",get:function(){return this._isTrigger},set:function(t){this._isTrigger=t;var i=_.ILaya3D.Physics3D._bullet;if(this._btColliderObject){var e=i.btCollisionObject_getCollisionFlags(this._btColliderObject);t?0==(e&p.COLLISIONFLAGS_NO_CONTACT_RESPONSE)&&i.btCollisionObject_setCollisionFlags(this._btColliderObject,e|p.COLLISIONFLAGS_NO_CONTACT_RESPONSE):0!=(e&p.COLLISIONFLAGS_NO_CONTACT_RESPONSE)&&i.btCollisionObject_setCollisionFlags(this._btColliderObject,e^p.COLLISIONFLAGS_NO_CONTACT_RESPONSE)}}},{key:"_onAdded",value:function(){e(o(l.prototype),"_onAdded",this).call(this),this.isTrigger=this._isTrigger}},{key:"_cloneTo",value:function(t){e(o(l.prototype),"_cloneTo",this).call(this,t),t.isTrigger=this._isTrigger}}]),l}(p),L=function(t){n(e,t);var i=s(e);function e(){return a(this,e),i.call(this)}return r(e,[{key:"add",value:function(t){if(-1!==t._inPhysicUpdateListIndex)throw"PhysicsUpdateList:element has  in  PhysicsUpdateList.";this._add(t),t._inPhysicUpdateListIndex=this.length++}},{key:"remove",value:function(t){var i=t._inPhysicUpdateListIndex;if(this.length--,i!==this.length){var e=this.elements[this.length];this.elements[i]=e,e._inPhysicUpdateListIndex=i}t._inPhysicUpdateListIndex=-1}}]),e}(_.SingletonList),D=function(){function t(i){a(this,t),this._gravity=new _.Vector3(0,-10,0),this._btVector3Zero=_.ILaya3D.Physics3D._bullet.btVector3_create(0,0,0),this._btDefaultQuaternion=_.ILaya3D.Physics3D._bullet.btQuaternion_create(0,0,0,-1),this._collisionsUtils=new O,this._previousFrameCollisions=[],this._currentFrameCollisions=[],this._currentConstraint={},this._physicsUpdateList=new L,this._characters=[],this._updatedRigidbodies=0,this.maxSubSteps=1,this.fixedTimeStep=1/60,this.maxSubSteps=i.maxSubSteps,this.fixedTimeStep=i.fixedTimeStep;var e=_.ILaya3D.Physics3D._bullet;this._btCollisionConfiguration=e.btDefaultCollisionConfiguration_create(),this._btDispatcher=e.btCollisionDispatcher_create(this._btCollisionConfiguration),this._btBroadphase=e.btDbvtBroadphase_create(),e.btOverlappingPairCache_setInternalGhostPairCallback(e.btDbvtBroadphase_getOverlappingPairCache(this._btBroadphase),e.btGhostPairCallback_create());var o=i.flags;if(o&t.PHYSICSENGINEFLAGS_COLLISIONSONLY)this._btCollisionWorld=new e.btCollisionWorld(this._btDispatcher,this._btBroadphase,this._btCollisionConfiguration);else{if(o&t.PHYSICSENGINEFLAGS_SOFTBODYSUPPORT)throw"PhysicsSimulation:SoftBody processing is not yet available";var n=e.btSequentialImpulseConstraintSolver_create();this._btDiscreteDynamicsWorld=e.btDiscreteDynamicsWorld_create(this._btDispatcher,this._btBroadphase,n,this._btCollisionConfiguration),this._btCollisionWorld=this._btDiscreteDynamicsWorld}this._btDiscreteDynamicsWorld&&(this._btSolverInfo=e.btDynamicsWorld_getSolverInfo(this._btDiscreteDynamicsWorld),this._btDispatchInfo=e.btCollisionWorld_getDispatchInfo(this._btDiscreteDynamicsWorld)),this._btClosestRayResultCallback=e.ClosestRayResultCallback_create(this._btVector3Zero,this._btVector3Zero),this._btAllHitsRayResultCallback=e.AllHitsRayResultCallback_create(this._btVector3Zero,this._btVector3Zero),this._btClosestConvexResultCallback=e.ClosestConvexResultCallback_create(this._btVector3Zero,this._btVector3Zero),this._btAllConvexResultCallback=e.AllConvexResultCallback_create(this._btVector3Zero,this._btVector3Zero),this.setHitsRayResultCallbackFlag(),e.btGImpactCollisionAlgorithm_RegisterAlgorithm(this._btDispatcher)}return r(t,[{key:"continuousCollisionDetection",get:function(){return _.ILaya3D.Physics3D._bullet.btCollisionWorld_get_m_useContinuous(this._btDispatchInfo)},set:function(t){_.ILaya3D.Physics3D._bullet.btCollisionWorld_set_m_useContinuous(this._btDispatchInfo,t)}},{key:"gravity",get:function(){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";return this._gravity},set:function(i){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";this._gravity=i;var e=_.ILaya3D.Physics3D._bullet,o=t._btTempVector30;e.btVector3_setValue(o,-i.x,i.y,i.z),e.btDiscreteDynamicsWorld_setGravity(this._btDiscreteDynamicsWorld,o)}},{key:"speculativeContactRestitution",get:function(){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot Cannot perform this action when the physics engine is set to CollisionsOnly";return _.ILaya3D.Physics3D._bullet.btDiscreteDynamicsWorld_getApplySpeculativeContactRestitution(this._btDiscreteDynamicsWorld)},set:function(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot Cannot perform this action when the physics engine is set to CollisionsOnly";_.ILaya3D.Physics3D._bullet.btDiscreteDynamicsWorld_setApplySpeculativeContactRestitution(this._btDiscreteDynamicsWorld,t)}},{key:"_simulate",value:function(t){this._updatedRigidbodies=0;var i=_.ILaya3D.Physics3D._bullet;this._btDiscreteDynamicsWorld?i.btDiscreteDynamicsWorld_stepSimulation(this._btDiscreteDynamicsWorld,t,this.maxSubSteps,this.fixedTimeStep):i.PerformDiscreteCollisionDetection(this._btCollisionWorld)}},{key:"_destroy",value:function(){var t=_.ILaya3D.Physics3D._bullet;this._btDiscreteDynamicsWorld?(t.btCollisionWorld_destroy(this._btDiscreteDynamicsWorld),this._btDiscreteDynamicsWorld=null):(t.btCollisionWorld_destroy(this._btCollisionWorld),this._btCollisionWorld=null),t.btDbvtBroadphase_destroy(this._btBroadphase),this._btBroadphase=null,t.btCollisionDispatcher_destroy(this._btDispatcher),this._btDispatcher=null,t.btDefaultCollisionConfiguration_destroy(this._btCollisionConfiguration),this._btCollisionConfiguration=null}},{key:"_addPhysicsCollider",value:function(t,i,e){_.ILaya3D.Physics3D._bullet.btCollisionWorld_addCollisionObject(this._btCollisionWorld,t._btColliderObject,i,e)}},{key:"_removePhysicsCollider",value:function(t){_.ILaya3D.Physics3D._bullet.btCollisionWorld_removeCollisionObject(this._btCollisionWorld,t._btColliderObject)}},{key:"_addRigidBody",value:function(t,i,e){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";_.ILaya3D.Physics3D._bullet.btDiscreteDynamicsWorld_addRigidBody(this._btCollisionWorld,t._btColliderObject,i,e)}},{key:"_removeRigidBody",value:function(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";_.ILaya3D.Physics3D._bullet.btDiscreteDynamicsWorld_removeRigidBody(this._btCollisionWorld,t._btColliderObject)}},{key:"_addCharacter",value:function(t,i,e){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";var o=_.ILaya3D.Physics3D._bullet;o.btCollisionWorld_addCollisionObject(this._btCollisionWorld,t._btColliderObject,i,e),o.btDynamicsWorld_addAction(this._btCollisionWorld,t._btKinematicCharacter)}},{key:"_removeCharacter",value:function(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";var i=_.ILaya3D.Physics3D._bullet;i.btCollisionWorld_removeCollisionObject(this._btCollisionWorld,t._btColliderObject),i.btDynamicsWorld_removeAction(this._btCollisionWorld,t._btKinematicCharacter)}},{key:"raycastFromTo",value:function(i,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:_.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,a=_.ILaya3D.Physics3D._bullet,r=this._btClosestRayResultCallback,l=t._btTempVector30,c=t._btTempVector31;if(a.btVector3_setValue(l,-i.x,i.y,i.z),a.btVector3_setValue(c,-e.x,e.y,e.z),a.ClosestRayResultCallback_set_m_rayFromWorld(r,l),a.ClosestRayResultCallback_set_m_rayToWorld(r,c),a.RayResultCallback_set_m_collisionFilterGroup(r,n),a.RayResultCallback_set_m_collisionFilterMask(r,s),a.RayResultCallback_set_m_collisionObject(r,null),a.RayResultCallback_set_m_closestHitFraction(r,1),a.btCollisionWorld_rayTest(this._btCollisionWorld,l,c,r),a.RayResultCallback_hasHit(r)){if(o){o.succeeded=!0,o.collider=p._physicObjectsMap[a.btCollisionObject_getUserIndex(a.RayResultCallback_get_m_collisionObject(r))],o.hitFraction=a.RayResultCallback_get_m_closestHitFraction(r);var h=a.ClosestRayResultCallback_get_m_hitPointWorld(r),u=o.point;u.x=-a.btVector3_x(h),u.y=a.btVector3_y(h),u.z=a.btVector3_z(h);var b=a.ClosestRayResultCallback_get_m_hitNormalWorld(r),d=o.normal;d.x=-a.btVector3_x(b),d.y=a.btVector3_y(b),d.z=a.btVector3_z(b)}return!0}return o&&(o.succeeded=!1),!1}},{key:"raycastAllFromTo",value:function(i,e,o){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:_.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,a=_.ILaya3D.Physics3D._bullet,r=this._btAllHitsRayResultCallback,l=t._btTempVector30,c=t._btTempVector31;o.length=0,a.btVector3_setValue(l,-i.x,i.y,i.z),a.btVector3_setValue(c,-e.x,e.y,e.z),a.AllHitsRayResultCallback_set_m_rayFromWorld(r,l),a.AllHitsRayResultCallback_set_m_rayToWorld(r,c),a.RayResultCallback_set_m_collisionFilterGroup(r,n),a.RayResultCallback_set_m_collisionFilterMask(r,s);var h=a.AllHitsRayResultCallback_get_m_collisionObjects(r),u=a.AllHitsRayResultCallback_get_m_hitPointWorld(r),b=a.AllHitsRayResultCallback_get_m_hitNormalWorld(r),d=a.AllHitsRayResultCallback_get_m_hitFractions(r);a.tBtCollisionObjectArray_clear(h),a.tVector3Array_clear(u),a.tVector3Array_clear(b),a.tScalarArray_clear(d),a.btCollisionWorld_rayTest(this._btCollisionWorld,l,c,r);var y=a.tBtCollisionObjectArray_size(h);if(y>0){this._collisionsUtils.recoverAllHitResultsPool();for(var C=0;C<y;C++){var m=this._collisionsUtils.getHitResult();o.push(m),m.succeeded=!0,m.collider=p._physicObjectsMap[a.btCollisionObject_getUserIndex(a.tBtCollisionObjectArray_at(h,C))],m.hitFraction=a.tScalarArray_at(d,C);var g=a.tVector3Array_at(u,C),f=m.point;f.x=-a.btVector3_x(g),f.y=a.btVector3_y(g),f.z=a.btVector3_z(g);var T=a.tVector3Array_at(b,C),S=m.normal;S.x=-a.btVector3_x(T),S.y=a.btVector3_y(T),S.z=a.btVector3_z(T)}return!0}return!1}},{key:"rayCast",value:function(i){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2147483647,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:_.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,a=i.origin,r=t._tempVector30;return _.Vector3.normalize(i.direction,r),_.Vector3.scale(r,o,r),_.Vector3.add(a,r,r),this.raycastFromTo(a,r,e,n,s)}},{key:"rayCastAll",value:function(i,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2147483647,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:_.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,a=i.origin,r=t._tempVector30;return _.Vector3.normalize(i.direction,r),_.Vector3.scale(r,o,r),_.Vector3.add(a,r,r),this.raycastAllFromTo(a,r,e,n,s)}},{key:"shapeCast",value:function(i,e,o){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:_.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:_.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=_.ILaya3D.Physics3D._bullet,u=this._btClosestConvexResultCallback,b=t._btTempVector30,d=t._btTempVector31,y=t._btTempQuaternion0,C=t._btTempQuaternion1,m=t._btTempTransform0,g=t._btTempTransform1,f=i._btShape;if(h.btVector3_setValue(b,-e.x,e.y,e.z),h.btVector3_setValue(d,-o.x,o.y,o.z),h.ConvexResultCallback_set_m_collisionFilterGroup(u,r),h.ConvexResultCallback_set_m_collisionFilterMask(u,l),h.btTransform_setOrigin(m,b),h.btTransform_setOrigin(g,d),s?(h.btQuaternion_setValue(y,-s.x,s.y,s.z,-s.w),h.btTransform_setRotation(m,y)):h.btTransform_setRotation(m,this._btDefaultQuaternion),a?(h.btQuaternion_setValue(C,-a.x,a.y,a.z,-a.w),h.btTransform_setRotation(g,C)):h.btTransform_setRotation(g,this._btDefaultQuaternion),h.ClosestConvexResultCallback_set_m_hitCollisionObject(u,null),h.ConvexResultCallback_set_m_closestHitFraction(u,1),h.btCollisionWorld_convexSweepTest(this._btCollisionWorld,f,m,g,u,c),h.ConvexResultCallback_hasHit(u)){if(n){n.succeeded=!0,n.collider=p._physicObjectsMap[h.btCollisionObject_getUserIndex(h.ClosestConvexResultCallback_get_m_hitCollisionObject(u))],n.hitFraction=h.ConvexResultCallback_get_m_closestHitFraction(u);var T=h.ClosestConvexResultCallback_get_m_hitPointWorld(u),S=h.ClosestConvexResultCallback_get_m_hitNormalWorld(u),I=n.point,O=n.normal;I.x=-h.btVector3_x(T),I.y=h.btVector3_y(T),I.z=h.btVector3_z(T),O.x=-h.btVector3_x(S),O.y=h.btVector3_y(S),O.z=h.btVector3_z(S)}return!0}return n&&(n.succeeded=!1),!1}},{key:"shapeCastAll",value:function(i,e,o,n){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:_.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:_.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=_.ILaya3D.Physics3D._bullet,u=this._btAllConvexResultCallback,b=t._btTempVector30,d=t._btTempVector31,y=t._btTempQuaternion0,C=t._btTempQuaternion1,m=t._btTempTransform0,g=t._btTempTransform1,f=i._btShape;n.length=0,h.btVector3_setValue(b,-e.x,e.y,e.z),h.btVector3_setValue(d,-o.x,o.y,o.z),h.ConvexResultCallback_set_m_collisionFilterGroup(u,r),h.ConvexResultCallback_set_m_collisionFilterMask(u,l),h.btTransform_setOrigin(m,b),h.btTransform_setOrigin(g,d),s?(h.btQuaternion_setValue(y,-s.x,s.y,s.z,-s.w),h.btTransform_setRotation(m,y)):h.btTransform_setRotation(m,this._btDefaultQuaternion),a?(h.btQuaternion_setValue(C,-a.x,a.y,a.z,-a.w),h.btTransform_setRotation(g,C)):h.btTransform_setRotation(g,this._btDefaultQuaternion);var T=h.AllConvexResultCallback_get_m_collisionObjects(u),S=h.AllConvexResultCallback_get_m_hitPointWorld(u),I=h.AllConvexResultCallback_get_m_hitNormalWorld(u),O=h.AllConvexResultCallback_get_m_hitFractions(u);h.tVector3Array_clear(S),h.tVector3Array_clear(I),h.tScalarArray_clear(O),h.tBtCollisionObjectArray_clear(T),h.btCollisionWorld_convexSweepTest(this._btCollisionWorld,f,m,g,u,c);var v=h.tBtCollisionObjectArray_size(T);if(v>0){this._collisionsUtils.recoverAllHitResultsPool();for(var L=0;L<v;L++){var D=this._collisionsUtils.getHitResult();n.push(D),D.succeeded=!0,D.collider=p._physicObjectsMap[h.btCollisionObject_getUserIndex(h.tBtCollisionObjectArray_at(T,L))],D.hitFraction=h.tScalarArray_at(O,L);var A=h.tVector3Array_at(S,L),R=D.point;R.x=-h.btVector3_x(A),R.y=h.btVector3_y(A),R.z=h.btVector3_z(A);var P=h.tVector3Array_at(I,L),N=D.normal;N.x=-h.btVector3_x(P),N.y=h.btVector3_y(P),N.z=h.btVector3_z(P)}return!0}return!1}},{key:"addConstraint",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._btDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";_.ILaya3D.Physics3D._bullet.btCollisionWorld_addConstraint(this._btDiscreteDynamicsWorld,t._btConstraint,i),this._currentConstraint[t.id]=t}},{key:"removeConstraint",value:function(t){if(!this._btDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";_.ILaya3D.Physics3D._bullet.btCollisionWorld_removeConstraint(this._btDiscreteDynamicsWorld,t._btConstraint),delete this._currentConstraint[t.id]}},{key:"setHitsRayResultCallbackFlag",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=_.ILaya3D.Physics3D._bullet;i.RayResultCallback_set_m_flags(this._btAllHitsRayResultCallback,t),i.RayResultCallback_set_m_flags(this._btClosestRayResultCallback,t)}},{key:"_updatePhysicsTransformFromRender",value:function(){for(var t=this._physicsUpdateList.elements,i=0,e=this._physicsUpdateList.length;i<e;i++){var o=t[i];o._derivePhysicsTransformation(!1),o._inPhysicUpdateListIndex=-1}this._physicsUpdateList.length=0}},{key:"_updateCharacters",value:function(){for(var t=0,i=this._characters.length;t<i;t++){var e=this._characters[t];e._updateTransformComponent(_.ILaya3D.Physics3D._bullet.btCollisionObject_getWorldTransform(e._btColliderObject))}}},{key:"_updateCollisions",value:function(){this._collisionsUtils.recoverAllContactPointsPool();var t=this._currentFrameCollisions;this._currentFrameCollisions=this._previousFrameCollisions,this._currentFrameCollisions.length=0,this._previousFrameCollisions=t;for(var i=_.Stat.loopCount,e=_.ILaya3D.Physics3D._bullet,o=e.btDispatcher_getNumManifolds(this._btDispatcher),n=0;n<o;n++){var s,a=e.btDispatcher_getManifoldByIndexInternal(this._btDispatcher,n),r=p._physicObjectsMap[e.btCollisionObject_getUserIndex(e.btPersistentManifold_getBody0(a))],l=p._physicObjectsMap[e.btCollisionObject_getUserIndex(e.btPersistentManifold_getBody1(a))],c=null,h=null;if((r.isTrigger||l.isTrigger)&&(r.owner._needProcessTriggers||l.owner._needProcessTriggers))for(var u=e.btPersistentManifold_getNumContacts(a),b=0;b<u;b++){var d=e.btPersistentManifold_getContactPoint(a,b),y=e.btManifoldPoint_getDistance(d);if(y<=0){h=(c=this._collisionsUtils.getCollision(r,l)).contacts,(s=c._updateFrame!==i)&&(c._isTrigger=!0,h.length=0);break}}else if((r.owner._needProcessCollisions||l.owner._needProcessCollisions)&&(r._enableProcessCollisions||l._enableProcessCollisions))for(u=e.btPersistentManifold_getNumContacts(a),b=0;b<u;b++)if(d=e.btPersistentManifold_getContactPoint(a,b),(y=e.btManifoldPoint_getDistance(d))<=0){var C=this._collisionsUtils.getContactPoints();C.colliderA=r,C.colliderB=l,C.distance=y;var m=e.btManifoldPoint_get_m_normalWorldOnB(d),g=C.normal;g.x=-e.btVector3_x(m),g.y=e.btVector3_y(m),g.z=e.btVector3_z(m);var f=e.btManifoldPoint_get_m_positionWorldOnA(d),T=C.positionOnA;T.x=-e.btVector3_x(f),T.y=e.btVector3_y(f),T.z=e.btVector3_z(f);var S=e.btManifoldPoint_get_m_positionWorldOnB(d),I=C.positionOnB;I.x=-e.btVector3_x(S),I.y=e.btVector3_y(S),I.z=e.btVector3_z(S),c||(h=(c=this._collisionsUtils.getCollision(r,l)).contacts,(s=c._updateFrame!==i)&&(c._isTrigger=!1,h.length=0)),h.push(C)}c&&s&&(this._currentFrameCollisions.push(c),c._setUpdateFrame(i))}}},{key:"_eventScripts",value:function(){for(var t=_.Stat.loopCount,i=0,e=this._currentFrameCollisions.length;i<e;i++){var o=this._currentFrameCollisions[i],n=o._colliderA,s=o._colliderB;if(!n.destroyed&&!s.destroyed)if(t-o._lastUpdateFrame==1){var a=n.owner,r=a._scripts;if(r)if(o._isTrigger){if(a._needProcessTriggers)for(var l=0,c=r.length;l<c;l++)r[l].onTriggerStay(s)}else if(a._needProcessCollisions)for(l=0,c=r.length;l<c;l++)o.other=s,r[l].onCollisionStay(o);var h=s.owner,u=h._scripts;if(u)if(o._isTrigger){if(h._needProcessTriggers)for(l=0,c=u.length;l<c;l++)u[l].onTriggerStay(n)}else if(h._needProcessCollisions)for(l=0,c=u.length;l<c;l++)o.other=n,u[l].onCollisionStay(o)}else{if(r=(a=n.owner)._scripts)if(o._isTrigger){if(a._needProcessTriggers)for(l=0,c=r.length;l<c;l++)r[l].onTriggerEnter(s)}else if(a._needProcessCollisions)for(l=0,c=r.length;l<c;l++)o.other=s,r[l].onCollisionEnter(o);if(u=(h=s.owner)._scripts)if(o._isTrigger){if(h._needProcessTriggers)for(l=0,c=u.length;l<c;l++)u[l].onTriggerEnter(n)}else if(h._needProcessCollisions)for(l=0,c=u.length;l<c;l++)o.other=n,u[l].onCollisionEnter(o)}}for(i=0,e=this._previousFrameCollisions.length;i<e;i++){var b=this._previousFrameCollisions[i],d=b._colliderA,y=b._colliderB;if(!d.destroyed&&!y.destroyed&&t-b._updateFrame==1){if(this._collisionsUtils.recoverCollision(b),r=(a=d.owner)._scripts)if(b._isTrigger){if(a._needProcessTriggers)for(l=0,c=r.length;l<c;l++)r[l].onTriggerExit(y)}else if(a._needProcessCollisions)for(l=0,c=r.length;l<c;l++)b.other=y,r[l].onCollisionExit(b);if(u=(h=y.owner)._scripts)if(b._isTrigger){if(h._needProcessTriggers)for(l=0,c=u.length;l<c;l++)u[l].onTriggerExit(d)}else if(h._needProcessCollisions)for(l=0,c=u.length;l<c;l++)b.other=d,u[l].onCollisionExit(b)}}for(var C in this._currentConstraint){var m=this._currentConstraint[C],p=m.owner._scripts;if(m.enabled&&m._isBreakConstrained()&&p&&0!=p.length)for(i=0,e=p.length;i<e;i++)p[i].onJointBreak()}}},{key:"clearForces",value:function(){if(!this._btDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";_.ILaya3D.Physics3D._bullet.btDiscreteDynamicsWorld_clearForces(this._btDiscreteDynamicsWorld)}}],[{key:"__init__",value:function(){var i=_.ILaya3D.Physics3D._bullet;t._btTempVector30=i.btVector3_create(0,0,0),t._btTempVector31=i.btVector3_create(0,0,0),t._btTempQuaternion0=i.btQuaternion_create(0,0,0,1),t._btTempQuaternion1=i.btQuaternion_create(0,0,0,1),t._btTempTransform0=i.btTransform_create(),t._btTempTransform1=i.btTransform_create()}},{key:"createConstraint",value:function(){}}]),t}();D.PHYSICSENGINEFLAGS_NONE=0,D.PHYSICSENGINEFLAGS_COLLISIONSONLY=1,D.PHYSICSENGINEFLAGS_SOFTBODYSUPPORT=2,D.PHYSICSENGINEFLAGS_MULTITHREADED=4,D.PHYSICSENGINEFLAGS_USEHARDWAREWHENPOSSIBLE=8,D.SOLVERMODE_RANDMIZE_ORDER=1,D.SOLVERMODE_FRICTION_SEPARATE=2,D.SOLVERMODE_USE_WARMSTARTING=4,D.SOLVERMODE_USE_2_FRICTION_DIRECTIONS=16,D.SOLVERMODE_ENABLE_FRICTION_DIRECTION_CACHING=32,D.SOLVERMODE_DISABLE_VELOCITY_DEPENDENT_FRICTION_DIRECTION=64,D.SOLVERMODE_CACHE_FRIENDLY=128,D.SOLVERMODE_SIMD=256,D.SOLVERMODE_INTERLEAVE_CONTACT_AND_FRICTION_CONSTRAINTS=512,D.SOLVERMODE_ALLOW_ZERO_LENGTH_FRICTION_DIRECTIONS=1024,D.HITSRAYRESULTCALLBACK_FLAG_NONE=0,D.HITSRAYRESULTCALLBACK_FLAG_FILTERBACKFACESS=1,D.HITSRAYRESULTCALLBACK_FLAG_KEEPUNFILIPPEDNORMAL=2,D.HITSRAYRESULTCALLBACK_FLAG_USESUBSIMPLEXCONVEXCASTRAYTEST=4,D.HITSRAYRESULTCALLBACK_FLAG_USEGJKCONVEXCASTRAYTEST=8,D.HITSRAYRESULTCALLBACK_FLAG_TERMINATOR=4294967295,D._tempVector30=new _.Vector3,D.disableSimulation=!1;var A=function(t){n(l,t);var i=s(l);function l(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_.Physics3DUtils.COLLISIONFILTERGROUP_DEFAULTFILTER,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER;return a(this,l),(t=i.call(this,e,o))._isKinematic=!1,t._mass=1,t._gravity=new _.Vector3(0,-10,0),t._angularDamping=0,t._linearDamping=0,t._overrideGravity=!1,t._totalTorque=new _.Vector3(0,0,0),t._totalForce=new _.Vector3(0,0,0),t._linearVelocity=new _.Vector3,t._angularVelocity=new _.Vector3,t._linearFactor=new _.Vector3(1,1,1),t._angularFactor=new _.Vector3(1,1,1),t._detectCollisions=!0,t._controlBySimulation=!0,t}return r(l,[{key:"mass",get:function(){return this._mass},set:function(t){t=Math.max(t,1e-7),this._mass=t,this._isKinematic||this._updateMass(t)}},{key:"isKinematic",get:function(){return this._isKinematic},set:function(t){this._isKinematic=t,this._controlBySimulation=!t;var i=_.ILaya3D.Physics3D._bullet,e=!!(this._simulation&&this._enabled&&this._colliderShape);e&&this._removeFromSimulation();var o=this._btColliderObject,n=i.btCollisionObject_getCollisionFlags(o);t?(n|=p.COLLISIONFLAGS_KINEMATIC_OBJECT,i.btCollisionObject_setCollisionFlags(o,n),i.btCollisionObject_forceActivationState(this._btColliderObject,p.ACTIVATIONSTATE_DISABLE_DEACTIVATION),this._enableProcessCollisions=!1,this._updateMass(0)):((n&p.COLLISIONFLAGS_KINEMATIC_OBJECT)>0&&(n^=p.COLLISIONFLAGS_KINEMATIC_OBJECT),i.btCollisionObject_setCollisionFlags(o,n),i.btCollisionObject_setActivationState(this._btColliderObject,p.ACTIVATIONSTATE_ACTIVE_TAG),this._enableProcessCollisions=!0,this._updateMass(this._mass));var s=l._btVector3Zero;i.btCollisionObject_setInterpolationLinearVelocity(o,s),i.btRigidBody_setLinearVelocity(o,s),i.btCollisionObject_setInterpolationAngularVelocity(o,s),i.btRigidBody_setAngularVelocity(o,s),e&&this._addToSimulation()}},{key:"linearDamping",get:function(){return this._linearDamping},set:function(t){this._linearDamping=t,this._btColliderObject&&_.ILaya3D.Physics3D._bullet.btRigidBody_setDamping(this._btColliderObject,t,this._angularDamping)}},{key:"angularDamping",get:function(){return this._angularDamping},set:function(t){this._angularDamping=t,this._btColliderObject&&_.ILaya3D.Physics3D._bullet.btRigidBody_setDamping(this._btColliderObject,this._linearDamping,t)}},{key:"overrideGravity",get:function(){return this._overrideGravity},set:function(t){this._overrideGravity=t;var i=_.ILaya3D.Physics3D._bullet;if(this._btColliderObject){var e=i.btRigidBody_getFlags(this._btColliderObject);t?0==(e&l._BT_DISABLE_WORLD_GRAVITY)&&i.btRigidBody_setFlags(this._btColliderObject,e|l._BT_DISABLE_WORLD_GRAVITY):(e&l._BT_DISABLE_WORLD_GRAVITY)>0&&i.btRigidBody_setFlags(this._btColliderObject,e^l._BT_DISABLE_WORLD_GRAVITY)}}},{key:"gravity",get:function(){var t=_.ILaya3D.Physics3D._bullet;return l._btGravity=t.btRigidBody_getGravity(this._btColliderObject),_.Utils3D._convertToLayaVec3(l._btGravity,this._gravity,!0),this._gravity},set:function(t){this._gravity=t;var i=_.ILaya3D.Physics3D._bullet;i.btVector3_setValue(l._btGravity,-t.x,t.y,t.z),i.btRigidBody_setGravity(this._btColliderObject,l._btGravity)}},{key:"totalForce",get:function(){if(this._btColliderObject){var t=_.ILaya3D.Physics3D._bullet.btRigidBody_getTotalForce(this._btColliderObject);return _.Utils3D._convertToLayaVec3(t,this._totalForce,!0),this._totalForce}return null}},{key:"linearFactor",get:function(){return this._linearFactor},set:function(t){this._linearFactor=t;var i=l._btTempVector30;_.Utils3D._convertToBulletVec3(t,i,!1),_.ILaya3D.Physics3D._bullet.btRigidBody_setLinearFactor(this._btColliderObject,i)}},{key:"linearVelocity",get:function(){return this._btColliderObject&&_.Utils3D._convertToLayaVec3(_.ILaya3D.Physics3D._bullet.btRigidBody_getLinearVelocity(this._btColliderObject),this._linearVelocity,!0),this._linearVelocity},set:function(t){if(this._linearVelocity=t,this._btColliderObject){var i=l._btTempVector30;_.Utils3D._convertToBulletVec3(t,i,!0),this.isSleeping&&this.wakeUp(),_.ILaya3D.Physics3D._bullet.btRigidBody_setLinearVelocity(this._btColliderObject,i)}}},{key:"angularFactor",get:function(){return this._angularFactor},set:function(t){this._angularFactor=t;var i=l._btTempVector30;_.Utils3D._convertToBulletVec3(t,i,!1),_.ILaya3D.Physics3D._bullet.btRigidBody_setAngularFactor(this._btColliderObject,i)}},{key:"angularVelocity",get:function(){return this._btColliderObject&&_.Utils3D._convertToLayaVec3(_.ILaya3D.Physics3D._bullet.btRigidBody_getAngularVelocity(this._btColliderObject),this._angularVelocity,!0),this._angularVelocity},set:function(t){if(this._angularVelocity=t,this._btColliderObject){var i=l._btTempVector30;_.Utils3D._convertToBulletVec3(t,i,!0),this.isSleeping&&this.wakeUp(),_.ILaya3D.Physics3D._bullet.btRigidBody_setAngularVelocity(this._btColliderObject,i)}}},{key:"totalTorque",get:function(){if(this._btColliderObject){var t=_.ILaya3D.Physics3D._bullet.btRigidBody_getTotalTorque(this._btColliderObject);return _.Utils3D._convertToLayaVec3(t,this._totalTorque,!0),this._totalTorque}return null}},{key:"detectCollisions",get:function(){return this._detectCollisions},set:function(t){this._detectCollisions!==t&&(this._detectCollisions=t,this._colliderShape&&this._enabled&&this._simulation&&(this._simulation._removeRigidBody(this),this._simulation._addRigidBody(this,this._collisionGroup,t?this._canCollideWith:0)))}},{key:"isSleeping",get:function(){return!!this._btColliderObject&&_.ILaya3D.Physics3D._bullet.btCollisionObject_getActivationState(this._btColliderObject)===p.ACTIVATIONSTATE_ISLAND_SLEEPING}},{key:"sleepLinearVelocity",get:function(){return _.ILaya3D.Physics3D._bullet.btRigidBody_getLinearSleepingThreshold(this._btColliderObject)},set:function(t){var i=_.ILaya3D.Physics3D._bullet;i.btRigidBody_setSleepingThresholds(this._btColliderObject,t,i.btRigidBody_getAngularSleepingThreshold(this._btColliderObject))}},{key:"sleepAngularVelocity",get:function(){return _.ILaya3D.Physics3D._bullet.btRigidBody_getAngularSleepingThreshold(this._btColliderObject)},set:function(t){var i=_.ILaya3D.Physics3D._bullet;i.btRigidBody_setSleepingThresholds(this._btColliderObject,i.btRigidBody_getLinearSleepingThreshold(this._btColliderObject),t)}},{key:"btColliderObject",get:function(){return this._btColliderObject}},{key:"constaintRigidbodyA",get:function(){return this._constaintRigidbodyA},set:function(t){this._constaintRigidbodyA=t}},{key:"constaintRigidbodyB",get:function(){return this._constaintRigidbodyB},set:function(t){this._constaintRigidbodyB=t}},{key:"_updateMass",value:function(t){if(this._btColliderObject&&this._colliderShape){var i=_.ILaya3D.Physics3D._bullet;i.btCollisionShape_calculateLocalInertia(this._colliderShape._btShape,t,l._btInertia),i.btRigidBody_setMassProps(this._btColliderObject,t,l._btInertia),i.btRigidBody_updateInertiaTensor(this._btColliderObject)}}},{key:"_onScaleChange",value:function(t){e(o(l.prototype),"_onScaleChange",this).call(this,t),this._updateMass(this._isKinematic?0:this._mass)}},{key:"_derivePhysicsTransformation",value:function(t){var i=_.ILaya3D.Physics3D._bullet,e=this._btColliderObject,o=i.btCollisionObject_getWorldTransform(e),n=l._btTransform0;i.btTransform_equal(n,o),this._innerDerivePhysicsTransformation(n,t),i.btRigidBody_setCenterOfMassTransform(e,n)}},{key:"_onAdded",value:function(){var t=_.ILaya3D.Physics3D._bullet,i=t.layaMotionState_create();t.layaMotionState_set_rigidBodyID(i,this._id),this._btLayaMotionState=i;var n=t.btRigidBodyConstructionInfo_create(0,i,null,l._btVector3Zero),s=t.btRigidBody_create(n);t.btCollisionObject_setUserIndex(s,this.id),this._btColliderObject=s,e(o(l.prototype),"_onAdded",this).call(this),this.mass=this._mass,this.linearFactor=this._linearFactor,this.angularFactor=this._angularFactor,this.linearDamping=this._linearDamping,this.angularDamping=this._angularDamping,this.overrideGravity=this._overrideGravity,this.gravity=this._gravity,this.isKinematic=this._isKinematic,t.btRigidBodyConstructionInfo_destroy(n)}},{key:"_onEnable",value:function(){e(o(l.prototype),"_onEnable",this).call(this),this._constaintRigidbodyA&&this._constaintRigidbodyA.connectedBody._simulation&&(this._constaintRigidbodyA._createConstraint(),this._constaintRigidbodyA._onEnable()),this._constaintRigidbodyB&&this._constaintRigidbodyB.ownBody._simulation&&(this._constaintRigidbodyB._createConstraint(),this._constaintRigidbodyB._onEnable())}},{key:"_onShapeChange",value:function(t){if(e(o(l.prototype),"_onShapeChange",this).call(this,t),this._isKinematic)this._updateMass(0);else{var i=_.ILaya3D.Physics3D._bullet;i.btRigidBody_setCenterOfMassTransform(this._btColliderObject,i.btCollisionObject_getWorldTransform(this._btColliderObject)),this._updateMass(this._mass)}}},{key:"_parse",value:function(t){if(null!=t.friction&&(this.friction=t.friction),null!=t.rollingFriction&&(this.rollingFriction=t.rollingFriction),null!=t.restitution&&(this.restitution=t.restitution),null!=t.isTrigger&&(this.isTrigger=t.isTrigger),null!=t.mass&&(this.mass=t.mass),null!=t.linearDamping&&(this.linearDamping=t.linearDamping),null!=t.angularDamping&&(this.angularDamping=t.angularDamping),null!=t.overrideGravity&&(this.overrideGravity=t.overrideGravity),null!=t.linearFactor){var i=this.linearFactor;i.fromArray(t.linearFactor),this.linearFactor=i}if(null!=t.angularFactor){var n=this.angularFactor;n.fromArray(t.angularFactor),this.angularFactor=n}if(t.gravity){var s=this.gravity;s.fromArray(t.gravity),this.gravity=s}e(o(l.prototype),"_parse",this).call(this,t),this._parseShape(t.shapes),null!=t.isKinematic&&(this.isKinematic=t.isKinematic)}},{key:"_onDestroy",value:function(){_.ILaya3D.Physics3D._bullet.btMotionState_destroy(this._btLayaMotionState),e(o(l.prototype),"_onDestroy",this).call(this),this._btLayaMotionState=null,this._gravity=null,this._totalTorque=null,this._linearVelocity=null,this._angularVelocity=null,this._linearFactor=null,this._angularFactor=null,this.constaintRigidbodyA&&this.constaintRigidbodyA._breakConstrained(),this.constaintRigidbodyB&&(this.constaintRigidbodyB.connectedBody=null,this.constaintRigidbodyB._onDisable())}},{key:"_addToSimulation",value:function(){this._simulation._addRigidBody(this,this._collisionGroup,this._detectCollisions?this._canCollideWith:0)}},{key:"_removeFromSimulation",value:function(){this._simulation._removeRigidBody(this)}},{key:"_cloneTo",value:function(t){e(o(l.prototype),"_cloneTo",this).call(this,t);var i=t;i.isKinematic=this._isKinematic,i.mass=this._mass,i.gravity=this._gravity,i.angularDamping=this._angularDamping,i.linearDamping=this._linearDamping,i.overrideGravity=this._overrideGravity,i.linearVelocity=this._linearVelocity,i.angularVelocity=this._angularVelocity,i.linearFactor=this._linearFactor,i.angularFactor=this._angularFactor,i.detectCollisions=this._detectCollisions}},{key:"applyForce",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var e=_.ILaya3D.Physics3D._bullet,o=l._btTempVector30;if(e.btVector3_setValue(o,-t.x,t.y,t.z),i){var n=l._btTempVector31;e.btVector3_setValue(n,-i.x,i.y,i.z),e.btRigidBody_applyForce(this._btColliderObject,o,n)}else e.btRigidBody_applyCentralForce(this._btColliderObject,o)}},{key:"applyTorque",value:function(t){if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var i=_.ILaya3D.Physics3D._bullet,e=l._btTempVector30;i.btVector3_setValue(e,-t.x,t.y,t.z),i.btRigidBody_applyTorque(this._btColliderObject,e)}},{key:"applyImpulse",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var e=_.ILaya3D.Physics3D._bullet;e.btVector3_setValue(l._btImpulse,-t.x,t.y,t.z),i?(e.btVector3_setValue(l._btImpulseOffset,-i.x,i.y,i.z),e.btRigidBody_applyImpulse(this._btColliderObject,l._btImpulse,l._btImpulseOffset)):e.btRigidBody_applyCentralImpulse(this._btColliderObject,l._btImpulse)}},{key:"applyTorqueImpulse",value:function(t){if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var i=_.ILaya3D.Physics3D._bullet,e=l._btTempVector30;i.btVector3_setValue(e,-t.x,t.y,t.z),i.btRigidBody_applyTorqueImpulse(this._btColliderObject,e)}},{key:"wakeUp",value:function(){this._btColliderObject&&_.ILaya3D.Physics3D._bullet.btCollisionObject_activate(this._btColliderObject,!1)}},{key:"clearForces",value:function(){var t=this._btColliderObject;if(null==t)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var i=_.ILaya3D.Physics3D._bullet;i.btRigidBody_clearForces(t);var e=l._btVector3Zero;i.btCollisionObject_setInterpolationLinearVelocity(t,e),i.btRigidBody_setLinearVelocity(t,e),i.btCollisionObject_setInterpolationAngularVelocity(t,e),i.btRigidBody_setAngularVelocity(t,e)}}],[{key:"__init__",value:function(){var t=_.ILaya3D.Physics3D._bullet;l._btTempVector30=t.btVector3_create(0,0,0),l._btTempVector31=t.btVector3_create(0,0,0),l._btVector3Zero=t.btVector3_create(0,0,0),l._btInertia=t.btVector3_create(0,0,0),l._btImpulse=t.btVector3_create(0,0,0),l._btImpulseOffset=t.btVector3_create(0,0,0),l._btGravity=t.btVector3_create(0,0,0),l._btTransform0=t.btTransform_create()}}]),l}(v);A.TYPE_STATIC=0,A.TYPE_DYNAMIC=1,A.TYPE_KINEMATIC=2,A._BT_DISABLE_WORLD_GRAVITY=1,A._BT_ENABLE_GYROPSCOPIC_FORCE=2;var R=function(i){n(c,i);var l=s(c);function c(t){var i;a(this,c),(i=l.call(this))._anchor=new _.Vector3,i._connectAnchor=new _.Vector3,i._feedbackEnabled=!1,i._getJointFeedBack=!1,i._currentForce=new _.Vector3,i._currentTorque=new _.Vector3,i._constraintType=t;var e=_.Physics3D._bullet;return i._btframATrans=e.btTransform_create(),i._btframBTrans=e.btTransform_create(),e.btTransform_setIdentity(i._btframATrans),e.btTransform_setIdentity(i._btframBTrans),i._btframAPos=e.btVector3_create(0,0,0),i._btframBPos=e.btVector3_create(0,0,0),e.btTransform_setOrigin(i._btframATrans,i._btframAPos),e.btTransform_setOrigin(i._btframBTrans,i._btframBPos),i._breakForce=-1,i._breakTorque=-1,i}return r(c,[{key:"enabled",get:function(){return e(o(c.prototype),"enabled",this)},set:function(i){t(o(c.prototype),"enabled",i,this,!0)}},{key:"appliedImpulse",get:function(){return this._feedbackEnabled||(this._btConstraint.EnableFeedback(!0),this._feedbackEnabled=!0),this._btConstraint.AppliedImpulse}},{key:"connectedBody",get:function(){return this._connectedBody},set:function(t){this._connectedBody=t,t&&(t.constaintRigidbodyB=this)}},{key:"ownBody",get:function(){return this._ownBody},set:function(t){this._ownBody=t,t.constaintRigidbodyA=this}},{key:"currentForce",get:function(){return this._getJointFeedBack||this._getFeedBackInfo(),this._currentForce}},{key:"currentTorque",get:function(){return this._getJointFeedBack||this._getFeedBackInfo(),this._currentTorque}},{key:"breakForce",get:function(){return this._breakForce},set:function(t){this._breakForce=t}},{key:"breakTorque",get:function(){return this._breakTorque},set:function(t){this._breakTorque=t}},{key:"anchor",get:function(){return this._anchor},set:function(t){t.cloneTo(this._anchor),this.setFrames()}},{key:"connectAnchor",get:function(){return this._connectAnchor},set:function(t){t.cloneTo(this._connectAnchor),this.setFrames()}},{key:"setOverrideNumSolverIterations",value:function(t){_.Physics3D._bullet.btTypedConstraint_setOverrideNumSolverIterations(this._btConstraint,t)}},{key:"setConstraintEnabled",value:function(t){_.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,t)}},{key:"_onEnable",value:function(){e(o(c.prototype),"_onEnable",this).call(this),this.enabled=!0}},{key:"_onDisable",value:function(){e(o(c.prototype),"_onDisable",this).call(this),this.enabled=!1}},{key:"setFrames",value:function(){var t=_.Physics3D._bullet;t.btVector3_setValue(this._btframAPos,-this._anchor.x,this.anchor.y,this.anchor.z),t.btVector3_setValue(this._btframBPos,-this._connectAnchor.x,this._connectAnchor.y,this._connectAnchor.z),t.btTransform_setOrigin(this._btframATrans,this._btframAPos),t.btTransform_setOrigin(this._btframBTrans,this._btframBPos)}},{key:"_addToSimulation",value:function(){}},{key:"_removeFromSimulation",value:function(){}},{key:"_createConstraint",value:function(){}},{key:"setConnectRigidBody",value:function(t,i){var e=t&&!!(t._simulation&&t._enabled&&t.colliderShape),o=i&&!!(i._simulation&&i._enabled&&i.colliderShape);if(!e||!o)throw"ownerRigid or connectRigidBody is not in Simulation";t==this._ownBody&&i==this._connectedBody||(!(!this.enabled||!this._simulation)&&this._removeFromSimulation(),this._ownBody=t,this._connectedBody=i,this._ownBody.constaintRigidbodyA=this,this._connectedBody.constaintRigidbodyB=this,this._createConstraint())}},{key:"getcurrentForce",value:function(t){if(!this._btJointFeedBackObj)throw"this Constraint is not simulation";var i=_.Physics3D._bullet,e=i.btJointFeedback_getAppliedForceBodyA(this._btJointFeedBackObj);t.setValue(i.btVector3_x(e),i.btVector3_y(e),i.btVector3_z(e))}},{key:"getcurrentTorque",value:function(t){if(!this._btJointFeedBackObj)throw"this Constraint is not simulation";var i=_.Physics3D._bullet,e=i.btJointFeedback_getAppliedTorqueBodyA(this._btJointFeedBackObj);t.setValue(i.btVector3_x(e),i.btVector3_y(e),i.btVector3_z(e))}},{key:"_onDestroy",value:function(){var t=_.Physics3D._bullet;this._simulation&&this._removeFromSimulation(),this._btConstraint&&this._btJointFeedBackObj&&this._simulation&&(t.btTypedConstraint_destroy(this._btConstraint),t.btJointFeedback_destroy(this._btJointFeedBackObj),this._btJointFeedBackObj=null,this._btConstraint=null),e(o(c.prototype),"_onDisable",this).call(this)}},{key:"_isBreakConstrained",value:function(){if(this._getJointFeedBack=!1,-1==this.breakForce&&-1==this.breakTorque)return!1;this._getFeedBackInfo();var t=-1!=this._breakForce&&_.Vector3.scalarLength(this._currentForce)>this._breakForce,i=-1!=this._breakTorque&&_.Vector3.scalarLength(this._currentTorque)>this._breakTorque;return!(!t&&!i||(this._breakConstrained(),0))}},{key:"_parse",value:function(t){this._anchor.fromArray(t.anchor),this._connectAnchor.fromArray(t.connectAnchor),this.setFrames()}},{key:"_getFeedBackInfo",value:function(){var t=_.Physics3D._bullet,i=t.btJointFeedback_getAppliedForceBodyA(this._btJointFeedBackObj),e=t.btJointFeedback_getAppliedTorqueBodyA(this._btJointFeedBackObj);this._currentTorque.setValue(t.btVector3_x(e),t.btVector3_y(e),t.btVector3_z(e)),this._currentForce.setValue(t.btVector3_x(i),t.btVector3_y(i),t.btVector3_z(i)),this._getJointFeedBack=!0}},{key:"_breakConstrained",value:function(){this.ownBody.constaintRigidbodyA=null,this.connectedBody&&(this.connectedBody.constaintRigidbodyB=null),this.destroy()}}]),c}(_.Component);R.CONSTRAINT_POINT2POINT_CONSTRAINT_TYPE=3,R.CONSTRAINT_HINGE_CONSTRAINT_TYPE=4,R.CONSTRAINT_CONETWIST_CONSTRAINT_TYPE=5,R.CONSTRAINT_D6_CONSTRAINT_TYPE=6,R.CONSTRAINT_SLIDER_CONSTRAINT_TYPE=7,R.CONSTRAINT_CONTACT_CONSTRAINT_TYPE=8,R.CONSTRAINT_D6_SPRING_CONSTRAINT_TYPE=9,R.CONSTRAINT_GEAR_CONSTRAINT_TYPE=10,R.CONSTRAINT_FIXED_CONSTRAINT_TYPE=11,R.CONSTRAINT_MAX_CONSTRAINT_TYPE=12,R.CONSTRAINT_CONSTRAINT_ERP=1,R.CONSTRAINT_CONSTRAINT_STOP_ERP=2,R.CONSTRAINT_CONSTRAINT_CFM=3,R.CONSTRAINT_CONSTRAINT_STOP_CFM=4,R.tempForceV3=new _.Vector3;var P=function(t){n(l,t);var i=s(l);function l(){var t;a(this,l),(t=i.call(this,R.CONSTRAINT_D6_SPRING_CONSTRAINT_TYPE))._axis=new _.Vector3,t._secondaryAxis=new _.Vector3,t._minLinearLimit=new _.Vector3,t._maxLinearLimit=new _.Vector3,t._minAngularLimit=new _.Vector3,t._maxAngularLimit=new _.Vector3,t._linearLimitSpring=new _.Vector3,t._angularLimitSpring=new _.Vector3,t._linearBounce=new _.Vector3,t._angularBounce=new _.Vector3,t._linearDamp=new _.Vector3,t._angularDamp=new _.Vector3,t._xMotion=0,t._yMotion=0,t._zMotion=0,t._angularXMotion=0,t._angularYMotion=0,t._angularZMotion=0;var e=_.Physics3D._bullet;return t._btAxis=e.btVector3_create(-1,0,0),t._btSecondaryAxis=e.btVector3_create(0,1,0),t}return r(l,[{key:"axis",get:function(){return this._axis}},{key:"secondaryAxis",get:function(){return this._secondaryAxis}},{key:"maxAngularLimit",get:function(){return this._maxAngularLimit},set:function(t){t.cloneTo(this._maxAngularLimit)}},{key:"minAngularLimit",get:function(){return this._minAngularLimit},set:function(t){t.cloneTo(this._minAngularLimit)}},{key:"maxLinearLimit",get:function(){return this._maxLinearLimit},set:function(t){t.cloneTo(this._maxLinearLimit)}},{key:"minLinearLimit",get:function(){return this._minLinearLimit},set:function(t){t.cloneTo(this._minLinearLimit)}},{key:"XMotion",get:function(){return this._xMotion},set:function(t){this._xMotion!=t&&(this._xMotion=t,this.setLimit(l.MOTION_LINEAR_INDEX_X,t,-this._maxLinearLimit.x,-this._minLinearLimit.x))}},{key:"YMotion",get:function(){return this._yMotion},set:function(t){this._yMotion!=t&&(this._yMotion=t,this.setLimit(l.MOTION_LINEAR_INDEX_Y,t,this._minLinearLimit.y,this._maxLinearLimit.y))}},{key:"ZMotion",get:function(){return this._zMotion},set:function(t){this._zMotion!=t&&(this._zMotion=t,this.setLimit(l.MOTION_LINEAR_INDEX_Z,t,this._minLinearLimit.z,this._maxLinearLimit.z))}},{key:"angularXMotion",get:function(){return this._angularXMotion},set:function(t){this._angularXMotion!=t&&(this._angularXMotion=t,this.setLimit(l.MOTION_ANGULAR_INDEX_X,t,-this._maxAngularLimit.x,-this._minAngularLimit.x))}},{key:"angularYMotion",get:function(){return this._angularYMotion},set:function(t){this._angularYMotion!=t&&(this._angularYMotion=t,this.setLimit(l.MOTION_ANGULAR_INDEX_Y,t,this._minAngularLimit.y,this._maxAngularLimit.y))}},{key:"angularZMotion",get:function(){return this._angularZMotion},set:function(t){this._angularZMotion!=t&&(this._angularZMotion=t,this.setLimit(l.MOTION_ANGULAR_INDEX_Z,t,this._minAngularLimit.z,this._maxAngularLimit.z))}},{key:"linearLimitSpring",get:function(){return this._linearLimitSpring},set:function(t){_.Vector3.equals(this._linearLimitSpring,t)||(t.cloneTo(this._linearLimitSpring),this.setSpring(l.MOTION_LINEAR_INDEX_X,t.x),this.setSpring(l.MOTION_LINEAR_INDEX_Y,t.y),this.setSpring(l.MOTION_LINEAR_INDEX_Z,t.z))}},{key:"angularLimitSpring",get:function(){return this._angularLimitSpring},set:function(t){_.Vector3.equals(this._angularLimitSpring,t)||(t.cloneTo(this._angularLimitSpring),this.setSpring(l.MOTION_ANGULAR_INDEX_X,t.x),this.setSpring(l.MOTION_ANGULAR_INDEX_Y,t.y),this.setSpring(l.MOTION_ANGULAR_INDEX_Z,t.z))}},{key:"linearBounce",get:function(){return this._linearBounce},set:function(t){_.Vector3.equals(this._linearBounce,t)||(t.cloneTo(this._linearBounce),this.setBounce(l.MOTION_LINEAR_INDEX_X,t.x),this.setBounce(l.MOTION_LINEAR_INDEX_Y,t.y),this.setBounce(l.MOTION_LINEAR_INDEX_Z,t.z))}},{key:"angularBounce",get:function(){return this._angularBounce},set:function(t){_.Vector3.equals(this._angularBounce,t)||(t.cloneTo(this._angularBounce),this.setBounce(l.MOTION_ANGULAR_INDEX_X,t.x),this.setBounce(l.MOTION_ANGULAR_INDEX_Y,t.y),this.setBounce(l.MOTION_ANGULAR_INDEX_Z,t.z))}},{key:"linearDamp",get:function(){return this._linearDamp},set:function(t){_.Vector3.equals(this._linearDamp,t)||(t.cloneTo(this._linearDamp),this.setDamping(l.MOTION_LINEAR_INDEX_X,t.x),this.setDamping(l.MOTION_LINEAR_INDEX_Y,t.y),this.setDamping(l.MOTION_LINEAR_INDEX_Z,t.z))}},{key:"angularDamp",get:function(){return this._angularDamp},set:function(t){_.Vector3.equals(this._angularDamp,t)||(t.cloneTo(this._angularDamp),this.setDamping(l.MOTION_ANGULAR_INDEX_X,t.x),this.setDamping(l.MOTION_ANGULAR_INDEX_Y,t.y),this.setDamping(l.MOTION_ANGULAR_INDEX_Z,t.z))}},{key:"anchor",get:function(){return this._anchor},set:function(t){t.cloneTo(this._anchor),this.setFrames()}},{key:"connectAnchor",get:function(){return this._connectAnchor},set:function(t){t.cloneTo(this._connectAnchor),this.setFrames()}},{key:"setAxis",value:function(t,i){if(this._btConstraint){var e=_.Physics3D._bullet;this._axis.setValue(t.x,t.y,t.y),this._secondaryAxis.setValue(i.x,i.y,i.z),this._btAxis=e.btVector3_setValue(-t.x,t.y,t.z),this._btSecondaryAxis=e.btVector3_setValue(-i.x,i.y,i.z),e.btGeneric6DofSpring2Constraint_setAxis(this._btConstraint,this._btAxis,this._btSecondaryAxis)}}},{key:"setLimit",value:function(t,i,e,o){if(this._btConstraint){var n=_.Physics3D._bullet;switch(i){case l.CONFIG_MOTION_TYPE_LOCKED:n.btGeneric6DofSpring2Constraint_setLimit(this._btConstraint,t,0,0);break;case l.CONFIG_MOTION_TYPE_LIMITED:e<o&&n.btGeneric6DofSpring2Constraint_setLimit(this._btConstraint,t,e,o);break;case l.CONFIG_MOTION_TYPE_FREE:n.btGeneric6DofSpring2Constraint_setLimit(this._btConstraint,t,1,0);break;default:throw"No Type of Axis Motion"}}}},{key:"setSpring",value:function(t,i){var e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._btConstraint){var o=_.Physics3D._bullet,n=i>0;o.btGeneric6DofSpring2Constraint_enableSpring(this._btConstraint,t,n),n&&o.btGeneric6DofSpring2Constraint_setStiffness(this._btConstraint,t,i,e)}}},{key:"setBounce",value:function(t,i){this._btConstraint&&(i=i<=0?0:i,_.Physics3D._bullet.btGeneric6DofSpring2Constraint_setBounce(this._btConstraint,t,i))}},{key:"setDamping",value:function(t,i){var e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._btConstraint&&(i=i<=0?0:i,_.Physics3D._bullet.btGeneric6DofSpring2Constraint_setDamping(this._btConstraint,t,i,e))}},{key:"setEquilibriumPoint",value:function(t,i){_.Physics3D._bullet.btGeneric6DofSpring2Constraint_setEquilibriumPoint(this._btConstraint,t,i)}},{key:"enableMotor",value:function(t,i){_.Physics3D._bullet.btGeneric6DofSpring2Constraint_enableMotor(this._btConstraint,t,i)}},{key:"setServo",value:function(t,i){_.Physics3D._bullet.btGeneric6DofSpring2Constraint_setServo(this._btConstraint,t,i)}},{key:"setTargetVelocity",value:function(t,i){_.Physics3D._bullet.btGeneric6DofSpring2Constraint_setTargetVelocity(this._btConstraint,t,i)}},{key:"setTargetPosition",value:function(t,i){_.Physics3D._bullet.btGeneric6DofSpring2Constraint_setServoTarget(this._btConstraint,t,i)}},{key:"setMaxMotorForce",value:function(t,i){_.Physics3D._bullet.btGeneric6DofSpring2Constraint_setMaxMotorForce(this._btConstraint,t,i)}},{key:"setParam",value:function(t,i,e){_.Physics3D._bullet.btTypedConstraint_setParam(this._btConstraint,t,i,e)}},{key:"setFrames",value:function(){e(o(l.prototype),"setFrames",this).call(this);var t=_.Physics3D._bullet;this._btConstraint&&t.btGeneric6DofSpring2Constraint_setFrames(this._btConstraint,this._btframATrans,this._btframBTrans)}},{key:"_addToSimulation",value:function(){this._simulation&&this._simulation.addConstraint(this,this.enabled)}},{key:"_removeFromSimulation",value:function(){this._simulation.removeConstraint(this),this._simulation=null}},{key:"_createConstraint",value:function(){var t=_.Physics3D._bullet;this._btConstraint=t.btGeneric6DofSpring2Constraint_create(this.ownBody.btColliderObject,this._btframAPos,this.connectedBody.btColliderObject,this._btframBPos,l.RO_XYZ),this._btJointFeedBackObj=t.btJointFeedback_create(this._btConstraint),t.btTypedConstraint_setJointFeedback(this._btConstraint,this._btJointFeedBackObj),this._simulation=this.owner._scene.physicsSimulation,this._initAllConstraintInfo(),this._addToSimulation(),_.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!0)}},{key:"_initAllConstraintInfo",value:function(){this.setLimit(l.MOTION_LINEAR_INDEX_X,this._xMotion,-this._maxLinearLimit.x,-this._minLinearLimit.x),this.setLimit(l.MOTION_LINEAR_INDEX_Y,this._yMotion,this._minLinearLimit.y,this._maxLinearLimit.y),this.setLimit(l.MOTION_LINEAR_INDEX_Z,this._zMotion,this._minLinearLimit.z,this._maxLinearLimit.z),this.setLimit(l.MOTION_ANGULAR_INDEX_X,this._angularXMotion,-this._maxAngularLimit.x,-this._minAngularLimit.x),this.setLimit(l.MOTION_ANGULAR_INDEX_Y,this._angularYMotion,this._minAngularLimit.y,this._maxAngularLimit.y),this.setLimit(l.MOTION_ANGULAR_INDEX_Z,this._angularZMotion,this._minAngularLimit.z,this._maxAngularLimit.z),this.setSpring(l.MOTION_LINEAR_INDEX_X,this._linearLimitSpring.x),this.setSpring(l.MOTION_LINEAR_INDEX_Y,this._linearLimitSpring.y),this.setSpring(l.MOTION_LINEAR_INDEX_Z,this._linearLimitSpring.z),this.setSpring(l.MOTION_ANGULAR_INDEX_X,this._angularLimitSpring.x),this.setSpring(l.MOTION_ANGULAR_INDEX_Y,this._angularLimitSpring.y),this.setSpring(l.MOTION_ANGULAR_INDEX_Z,this._angularLimitSpring.z),this.setBounce(l.MOTION_LINEAR_INDEX_X,this._linearBounce.x),this.setBounce(l.MOTION_LINEAR_INDEX_Y,this._linearBounce.y),this.setBounce(l.MOTION_LINEAR_INDEX_Z,this._linearBounce.z),this.setBounce(l.MOTION_ANGULAR_INDEX_X,this._angularBounce.x),this.setBounce(l.MOTION_ANGULAR_INDEX_Y,this._angularBounce.y),this.setBounce(l.MOTION_ANGULAR_INDEX_Z,this._angularBounce.z),this.setDamping(l.MOTION_LINEAR_INDEX_X,this._linearDamp.x),this.setDamping(l.MOTION_LINEAR_INDEX_Y,this._linearDamp.y),this.setDamping(l.MOTION_LINEAR_INDEX_Z,this._linearDamp.z),this.setDamping(l.MOTION_ANGULAR_INDEX_X,this._angularDamp.x),this.setDamping(l.MOTION_ANGULAR_INDEX_Y,this._angularDamp.y),this.setDamping(l.MOTION_ANGULAR_INDEX_Z,this._angularDamp.z),this.setFrames(),this.setEquilibriumPoint(0,0)}},{key:"_onAdded",value:function(){e(o(l.prototype),"_onAdded",this).call(this)}},{key:"_onEnable",value:function(){this._btConstraint&&(e(o(l.prototype),"_onEnable",this).call(this),this._btConstraint&&_.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!0))}},{key:"_onDisable",value:function(){e(o(l.prototype),"_onDisable",this).call(this),!this.connectedBody&&this._simulation&&this._removeFromSimulation(),this._btConstraint&&_.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!1)}},{key:"_parse",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e(o(l.prototype),"_parse",this).call(this,t),this._axis.fromArray(t.axis),this._secondaryAxis.fromArray(t.secondaryAxis);var n=t.linearLimit;this._minLinearLimit.setValue(-n,-n,-n),this._maxLinearLimit.setValue(n,n,n);var s=t.linearLimitSpring;this._linearLimitSpring.setValue(s,s,s);var a=t.linearLimitDamper;this._linearDamp.setValue(a,a,a);var r=t.linearLimitBounciness;this._linearBounce.setValue(r,r,r);var _=t.lowAngularXLimit,c=t.highAngularXLimit,h=t.angularYLimit,u=t.angularZLimit;this._minAngularLimit.setValue(_,-h,-u),this._maxAngularLimit.setValue(c,h,u);var b=t.highAngularXLimitBounciness,d=t.angularYLimitBounciness,y=t.angularZLimitBounciness;this._angularBounce.setValue(b,d,y);var C=t.angularXLimitSpring,m=t.angularYZLimitSpring;this._angularLimitSpring.setValue(C,m,m);var p=t.angularXLimitDamper,g=t.angularYZLimitDamper;this._angularDamp.setValue(p,g,g),this.XMotion=t.xMotion,this.YMotion=t.yMotion,this.ZMotion=t.zMotion,this.angularXMotion=t.angularXMotion,this.angularYMotion=t.angularYMotion,this.angularZMotion=t.angularZMotion,-1!=t.rigidbodyID&&-1!=t.connectRigidbodyID&&(i.component.push(this),i.data.push(t)),null!=t.breakForce&&(this.breakForce=t.breakForce),null!=t.breakTorque&&(this.breakTorque=t.breakTorque)}},{key:"_parseInteractive",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=i[t.rigidbodyID].getComponent(A),o=i[t.connectRigidbodyID].getComponent(A);this.ownBody=e,this.connectedBody=o}},{key:"_onDestroy",value:function(){e(o(l.prototype),"_onDestroy",this).call(this)}}]),l}(R);P.CONFIG_MOTION_TYPE_LOCKED=0,P.CONFIG_MOTION_TYPE_LIMITED=1,P.CONFIG_MOTION_TYPE_FREE=2,P.MOTION_LINEAR_INDEX_X=0,P.MOTION_LINEAR_INDEX_Y=1,P.MOTION_LINEAR_INDEX_Z=2,P.MOTION_ANGULAR_INDEX_X=3,P.MOTION_ANGULAR_INDEX_Y=4,P.MOTION_ANGULAR_INDEX_Z=5,P.RO_XYZ=0,P.RO_XZY=1,P.RO_YXZ=2,P.RO_YZX=3,P.RO_ZXY=4,P.RO_ZYX=5;var N=function(t){n(e,t);var i=s(e);function e(t,o){var n;a(this,e),(n=i.call(this))._normal=t,n._offset=o,n._type=c.SHAPETYPES_STATICPLANE;var s=_.ILaya3D.Physics3D._bullet;return s.btVector3_setValue(e._btNormal,-t.x,t.y,t.z),n._btShape=s.btStaticPlaneShape_create(e._btNormal,o),n}return r(e,[{key:"clone",value:function(){var t=new e(this._normal,this._offset);return this.cloneTo(t),t}}],[{key:"__init__",value:function(){e._btNormal=_.ILaya3D.Physics3D._bullet.btVector3_create(0,0,0)}}]),e}(c);l.BoxColliderShape=h,l.BulletInteractive=g,l.CapsuleColliderShape=u,l.CharacterController=f,l.ColliderShape=c,l.Collision=T,l.CollisionTool=O,l.CompoundColliderShape=b,l.ConeColliderShape=d,l.ConfigurableConstraint=P,l.Constraint3D=function(){return function t(){a(this,t)}}(),l.ConstraintComponent=R,l.ContactPoint=S,l.CylinderColliderShape=y,l.FixedConstraint=function(t){n(l,t);var i=s(l);function l(){var t;return a(this,l),(t=i.call(this,R.CONSTRAINT_FIXED_CONSTRAINT_TYPE)).breakForce=-1,t.breakTorque=-1,t}return r(l,[{key:"_addToSimulation",value:function(){this._simulation&&this._simulation.addConstraint(this,this.enabled)}},{key:"_removeFromSimulation",value:function(){this._simulation.removeConstraint(this),this._simulation=null}},{key:"_createConstraint",value:function(){if(this.ownBody&&this.ownBody._simulation&&this.connectedBody&&this.connectedBody._simulation){var t=_.Physics3D._bullet;this._btConstraint=t.btFixedConstraint_create(this.ownBody.btColliderObject,this._btframATrans,this.connectedBody.btColliderObject,this._btframBTrans),this._btJointFeedBackObj=t.btJointFeedback_create(this._btConstraint),t.btTypedConstraint_setJointFeedback(this._btConstraint,this._btJointFeedBackObj),this._simulation=this.owner._scene.physicsSimulation,this._addToSimulation(),_.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!0)}}},{key:"_onAdded",value:function(){e(o(l.prototype),"_onAdded",this).call(this)}},{key:"_onEnable",value:function(){this._btConstraint&&(e(o(l.prototype),"_onEnable",this).call(this),this._btConstraint&&_.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!0))}},{key:"_onDisable",value:function(){e(o(l.prototype),"_onDisable",this).call(this),this.connectedBody||this._removeFromSimulation(),this._btConstraint&&_.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!1)}},{key:"_onDestroy",value:function(){e(o(l.prototype),"_onDestroy",this).call(this)}},{key:"_parse",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e(o(l.prototype),"_parse",this).call(this,t),-1!=t.rigidbodyID&&-1!=t.connectRigidbodyID&&(i.component.push(this),i.data.push(t)),null!=t.breakForce&&(this.breakForce=t.breakForce),null!=t.breakTorque&&(this.breakTorque=t.breakTorque)}},{key:"_parseInteractive",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=i[t.rigidbodyID].getComponent(A),o=i[t.connectRigidbodyID].getComponent(A);this.ownBody=e,this.connectedBody=o}}]),l}(R),l.HitResult=I,l.MeshColliderShape=C,l.PhysicsCollider=function(t){n(l,t);var i=s(l);function l(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_.Physics3DUtils.COLLISIONFILTERGROUP_DEFAULTFILTER,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER;return a(this,l),(t=i.call(this,e,o))._enableProcessCollisions=!1,t}return r(l,[{key:"_addToSimulation",value:function(){this._simulation._addPhysicsCollider(this,this._collisionGroup,this._canCollideWith)}},{key:"_removeFromSimulation",value:function(){this._simulation._removePhysicsCollider(this)}},{key:"_parse",value:function(t){null!=t.friction&&(this.friction=t.friction),null!=t.rollingFriction&&(this.rollingFriction=t.rollingFriction),null!=t.restitution&&(this.restitution=t.restitution),null!=t.isTrigger&&(this.isTrigger=t.isTrigger),e(o(l.prototype),"_parse",this).call(this,t),this._parseShape(t.shapes)}},{key:"_onAdded",value:function(){var t=_.Physics3D._bullet,i=t.btCollisionObject_create();t.btCollisionObject_setUserIndex(i,this.id),t.btCollisionObject_forceActivationState(i,p.ACTIVATIONSTATE_DISABLE_SIMULATION);var n=t.btCollisionObject_getCollisionFlags(i);this.owner.isStatic?((n&p.COLLISIONFLAGS_KINEMATIC_OBJECT)>0&&(n^=p.COLLISIONFLAGS_KINEMATIC_OBJECT),n|=p.COLLISIONFLAGS_STATIC_OBJECT):((n&p.COLLISIONFLAGS_STATIC_OBJECT)>0&&(n^=p.COLLISIONFLAGS_STATIC_OBJECT),n|=p.COLLISIONFLAGS_KINEMATIC_OBJECT),t.btCollisionObject_setCollisionFlags(i,n),this._btColliderObject=i,e(o(l.prototype),"_onAdded",this).call(this)}}]),l}(v),l.PhysicsComponent=p,l.PhysicsSettings=function(){return function t(){a(this,t),this.flags=0,this.maxSubSteps=1,this.fixedTimeStep=1/60}}(),l.PhysicsSimulation=D,l.PhysicsTriggerComponent=v,l.PhysicsUpdateList=L,l.Rigidbody3D=A,l.SphereColliderShape=m,l.StaticPlaneColliderShape=N}(window.Laya=window.Laya||{},Laya); 
 			});
 		var global = (function () { return this })();	if (!global && typeof GameGlobal !== 'undefined') global = GameGlobal;	var pluginInfoMap = {};	;	global.requirePlugin = global.requirePlugin || function(path) {		    var position = path.indexOf('/');    		var alias = '';    		var pagePath = '';    		if (position !== -1) {    		    alias = path.substr(0, position);    		    pagePath = path.substr(position + 1, path.length);    		}    		else {    		    alias = path;    		}    		if (pluginInfoMap.hasOwnProperty(alias)) {    		    var realPath = '';    		    if (pagePath.length === 0) {    		        realPath =  '__plugin__/' + pluginInfoMap[alias].appid;    		        return require(realPath);    		    } else {    		        realPath = '__plugin__/' + pluginInfoMap[alias].appid + '/' + pagePath;    		        return require(realPath);    		    }    		}    		else {    		    console.error('not found alias: ', alias);    		    throw new Error('Plugin ' + alias + ' is not defined.')    		}	};	define("wasm/game.js", function(require, module, exports){ 			
"use strict"; 
 			}); 	require("game.js");
 	